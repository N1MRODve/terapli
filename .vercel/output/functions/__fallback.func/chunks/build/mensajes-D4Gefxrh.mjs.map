{"version":3,"file":"mensajes-D4Gefxrh.mjs","sources":["../../../../../../components/MensajeCard.vue","../../../../../../components/MensajeInput.vue","../../../../../../pages/terapeuta/mensajes.vue","../../../../../../composables/useMensajes.ts"],"sourcesContent":null,"names":["class","__props","remitente","_attrs","ssrInterpolate","texto","ssrRenderClass","_ssrInterpolate","fecha","date","Date","ahora","diferencia","getTime","minutos","Math","floor","horas","dias","toLocaleDateString","day","month","year","getFullYear","formatearFecha","visto","enviarMensaje","enviarMensajeApi","useMensajeria","contenido","ref","enviando","puedeEnviar","computed","textoLimpio","value","trim","length","_ssrRenderAttrs","_mergeProps","_ssrRenderAttr","placeholder","ssrIncludeBooleanAttr","ssrRenderStyle","_push","_ssrIncludeBooleanAttr","conversaciones","mensajes","loadingConversaciones","loadingMensajes","listarConversaciones","supabase","useSupabaseClient","user","useSupabaseUser","loading","error","canal","listarConversacionesAlternativo","async","data","fetchError","from","select","or","id","order","ascending","conversacionesMap","Map","forEach","m","esRemitente","remitente_id","otroUsuarioId","destinatario_id","otroUsuario","destinatario","has","set","otro_usuario_id","otro_usuario_nombre","nombre","otro_usuario_avatar","avatar_url","ultimo_mensaje","mensaje","ultimo_mensaje_fecha","created_at","mensajes_no_vistos","get","Array","values","e","message","console","listarConversacion","participanteId","enviar","destinatarioId","sesionId","insertError","insert","sesion_id","single","push","marcarVistos","updateError","update","eq","map","rpc","usuario_id","warn","contarNoVistos","count","countError","head","suscribirseAConversacion","channel","on","event","schema","table","filter","payload","new","subscribe","desuscribirse","removeChannel","useMensajes","getUserId","useSupabase","pacienteSeleccionado","mensajesContainer","esMensajeMio","handleMensajeEnviado","nextTick","scrollTop","scrollHeight","obtenerIniciales","split","n","slice","join","toUpperCase","watch","deep","_unref","_ssrRenderList","conv","ssrRenderAttr","_ssrRenderClass","key","_parent","onMensajeEnviado"],"mappings":"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"}