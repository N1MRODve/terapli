import{v as e,h as a,i as t,s as r}from"./server.mjs";import{u as s}from"./useCitas-DyEZH6RI.mjs";import{_ as o}from"./_plugin-vue_export-helper-1tPrXgE0.mjs";import{_ as d}from"./AgendaTerapeuta-CKiuOLqn.mjs";import{_ as n}from"./ModalNuevaCita-QWHLrbsw.mjs";import{M as l}from"./ModalDetallesCita-BtNMrRBN.mjs";import"../routes/renderer.mjs";import"../nitro/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"../_/shared.cjs.prod.mjs";import"node:stream";import"devalue";import"@supabase/ssr";import"@vercel/analytics/nuxt";import"./useSupabaseClient-DykwVqLQ.mjs";import"./ArrowsPointingOutIcon-BV3CcMOB.mjs";import"./useSupabase-CA5R4uuJ.mjs";import"./CheckCircleIcon-CT9fzVFs.mjs";import"./CalendarIcon-BrsGHJBC.mjs";import"./TicketIcon-zZdrc71S.mjs";import"./MagnifyingGlassIcon-GsbNDyPZ.mjs";import"./UserIcon-CrHYaeI9.mjs";import"./ExclamationTriangleIcon-DQdM2y0F.mjs";import"./UserGroupIcon-BhthmHUw.mjs";import"./ClockIcon-BxdFtPqx.mjs";import"./XCircleIcon-BCxujS_I.mjs";import"./ExclamationCircleIcon-DhXgUVTW.mjs";import"./XMarkIcon-DCLwyE-W.mjs";const i={pendiente:{border:"border-amber-200 dark:border-amber-800",bg:"bg-white dark:bg-zinc-800",badge:"bg-amber-400 dark:bg-amber-500",dot:"bg-amber-400 dark:bg-amber-500",hover:"hover:bg-amber-50 dark:hover:bg-amber-950/20"},confirmada:{border:"border-emerald-200 dark:border-emerald-800",bg:"bg-white dark:bg-zinc-800",badge:"bg-emerald-400 dark:bg-emerald-500",dot:"bg-emerald-400 dark:bg-emerald-500",hover:"hover:bg-emerald-50 dark:hover:bg-emerald-950/20"},cancelada:{border:"border-rose-200 dark:border-rose-800",bg:"bg-white dark:bg-zinc-800",badge:"bg-rose-400 dark:bg-rose-500",dot:"bg-rose-400 dark:bg-rose-500",hover:"hover:bg-rose-50 dark:hover:bg-rose-950/20"},realizada:{border:"border-blue-200 dark:border-blue-800",bg:"bg-white dark:bg-zinc-800",badge:"bg-blue-400 dark:bg-blue-500",dot:"bg-blue-400 dark:bg-blue-500",hover:"hover:bg-blue-50 dark:hover:bg-blue-950/20"}},formatearMesAnio=e=>new Date(e+"T00:00:00").toLocaleDateString("es-ES",{month:"long",year:"numeric"}),formatearDiaSemana=e=>new Date(e+"T00:00:00").toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"short"}),obtenerTituloAgenda=(e,a)=>{const t="string"==typeof a?a:a.toISOString().split("T")[0];switch(e){case"dia":return(e=>new Date(e+"T00:00:00").toLocaleDateString("es-ES",{day:"2-digit",month:"long",year:"numeric"}))(t);case"semana":return`${formatearMesAnio(t)} â€” Semana ${(e=>{const a=new Date(e+"T00:00:00"),t=new Date(a.getFullYear(),0,1),r=a.getTime()-t.getTime();return Math.ceil((r/864e5+t.getDay()+1)/7)})(t)}`;case"mes":return formatearMesAnio(t);default:return""}},c=e.defineComponent({__name:"AgendaHeader",__ssrInlineRender:!0,props:{vista:{},fechaActual:{},darkMode:{type:Boolean}},emits:["update:vista","update:fechaActual","update:darkMode","nueva-cita"],setup(a,{emit:t}){const s=a,o=e.computed(()=>obtenerTituloAgenda(s.vista,s.fechaActual));return(t,s,d,n)=>{s(`<header${r.ssrRenderAttrs(e.mergeProps({class:"sticky top-0 z-20 bg-white/70 dark:bg-gray-950/70 backdrop-blur-md border-b border-cafe/10 dark:border-gray-800 shadow-sm"},n))} data-v-9c60bdb2><div class="px-4 py-2.5 sm:px-6 lg:px-6" data-v-9c60bdb2><div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3" data-v-9c60bdb2><div class="flex items-center gap-2.5" data-v-9c60bdb2><div class="flex items-center gap-0.5" data-v-9c60bdb2><button class="px-2.5 py-1.5 border border-cafe/20 dark:border-gray-700 rounded-lg hover:bg-terracota/10 dark:hover:bg-gray-800 hover:border-terracota transition-all duration-200" aria-label="Periodo anterior" data-v-9c60bdb2><svg class="w-4 h-4 text-cafe dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-9c60bdb2><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" data-v-9c60bdb2></path></svg></button><button class="px-3.5 py-1.5 mx-1 border border-cafe/20 dark:border-gray-700 rounded-lg hover:bg-terracota/10 dark:hover:bg-gray-800 hover:border-terracota transition-all duration-200 text-sm font-medium text-cafe dark:text-gray-300" data-v-9c60bdb2> Hoy </button><button class="px-2.5 py-1.5 border border-cafe/20 dark:border-gray-700 rounded-lg hover:bg-terracota/10 dark:hover:bg-gray-800 hover:border-terracota transition-all duration-200" aria-label="Periodo siguiente" data-v-9c60bdb2><svg class="w-4 h-4 text-cafe dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-9c60bdb2><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" data-v-9c60bdb2></path></svg></button></div><h1 class="text-lg sm:text-xl font-serif font-bold text-cafe dark:text-gray-100 ml-1" data-v-9c60bdb2>${r.ssrInterpolate(o.value)}</h1></div><div class="flex items-center gap-2.5 w-full sm:w-auto" data-v-9c60bdb2><div class="flex border border-cafe/20 dark:border-gray-700 rounded-xl overflow-hidden shadow-xs" data-v-9c60bdb2><button class="${r.ssrRenderClass(["px-3 py-1.5 text-sm font-medium transition-all duration-200","dia"===a.vista?"bg-terracota text-white shadow-sm":"bg-white dark:bg-gray-900 text-cafe dark:text-gray-300 hover:bg-terracota/10 dark:hover:bg-gray-800"])}" aria-label="Vista de dÃ­a" data-v-9c60bdb2> ğŸ“… DÃ­a </button><button class="${r.ssrRenderClass(["px-3 py-1.5 text-sm font-medium transition-all duration-200 border-l border-cafe/10 dark:border-gray-700","semana"===a.vista?"bg-terracota text-white shadow-sm":"bg-white dark:bg-gray-900 text-cafe dark:text-gray-300 hover:bg-terracota/10 dark:hover:bg-gray-800"])}" aria-label="Vista de semana" data-v-9c60bdb2> ğŸ“† Semana </button><button class="${r.ssrRenderClass(["px-3 py-1.5 text-sm font-medium transition-all duration-200 border-l border-cafe/10 dark:border-gray-700","mes"===a.vista?"bg-terracota text-white shadow-sm":"bg-white dark:bg-gray-900 text-cafe dark:text-gray-300 hover:bg-terracota/10 dark:hover:bg-gray-800"])}" aria-label="Vista de mes" data-v-9c60bdb2> ğŸ—“ï¸ Mes </button></div><button class="flex items-center gap-2 px-2.5 py-1.5 border border-cafe/20 dark:border-gray-700 rounded-xl hover:bg-terracota/10 dark:hover:bg-gray-800 hover:border-terracota transition-all duration-200"${r.ssrRenderAttr("aria-label",a.darkMode?"Desactivar modo oscuro":"Activar modo oscuro")} data-v-9c60bdb2>`),a.darkMode?s('<span class="text-lg" data-v-9c60bdb2>ğŸŒ™</span>'):s('<span class="text-lg" data-v-9c60bdb2>â˜€ï¸</span>'),s('</button><button class="flex items-center gap-2 px-4 py-1.5 bg-terracota hover:bg-terracota/90 text-white rounded-xl transition-all duration-200 shadow-sm hover:shadow-md font-medium text-sm" data-v-9c60bdb2><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-9c60bdb2><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" data-v-9c60bdb2></path></svg> Nueva Cita </button></div></div></div></header>')}}}),v=c.setup;c.setup=(a,t)=>{const r=e.useSSRContext();return(r.modules||(r.modules=new Set)).add("components/agenda/AgendaHeader.vue"),v?v(a,t):void 0};const u=Object.assign(o(c,[["__scopeId","data-v-9c60bdb2"]]),{__name:"AgendaHeader"}),p=e.defineComponent({__name:"AgendaFilters",__ssrInlineRender:!0,props:{filtros:{},terapeutas:{},pacientes:{}},emits:["update:filtros","update:busqueda"],setup(a,{emit:t}){const s=a,o=t,d=e.ref(""),n=e.ref(!1),l=[{value:"online",label:"Online",emoji:"ğŸ’»"},{value:"presencial",label:"Presencial",emoji:"ğŸ¢"}],i=e.computed({get:()=>s.filtros.pacienteId||"",set:e=>actualizarFiltro("pacienteId",e||void 0)}),c=e.computed({get:()=>s.filtros.modalidad||"",set:e=>actualizarFiltro("modalidad",e||void 0)}),v=e.computed({get:()=>s.filtros.fechaDesde||"",set:e=>actualizarFiltro("fechaDesde",e||void 0)}),u=e.computed({get:()=>s.filtros.fechaHasta||"",set:e=>actualizarFiltro("fechaHasta",e||void 0)}),p=e.computed(()=>{let e=0;return i.value&&e++,c.value&&e++,(v.value||u.value)&&e++,e}),actualizarFiltro=(e,a)=>{o("update:filtros",{...s.filtros,[e]:a})};return(t,s,o,g)=>{s(`<div${r.ssrRenderAttrs(e.mergeProps({class:"bg-white/60 dark:bg-gray-950/60 backdrop-blur-sm border-b border-cafe/5 dark:border-gray-800 shadow-sm"},g))} data-v-fb697357><div class="px-4 py-2 sm:px-6 lg:px-6 space-y-2" data-v-fb697357><div class="flex items-center gap-3" data-v-fb697357><div class="flex-1 relative" data-v-fb697357><input${r.ssrRenderAttr("value",d.value)} type="text" placeholder="Buscar por paciente, terapeuta, notas..." class="w-full px-3 py-1.5 pl-9 text-sm border border-cafe/20 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-terracota focus:border-terracota bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-all" data-v-fb697357><svg class="absolute left-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-cafe/50 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-fb697357><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" data-v-fb697357></path></svg></div><button class="${r.ssrRenderClass([{"bg-terracota/10 border-terracota text-terracota":p.value>0},"flex items-center gap-1.5 px-3 py-1.5 text-sm border border-cafe/20 dark:border-gray-700 rounded-lg hover:bg-terracota/10 dark:hover:bg-gray-800 hover:border-terracota transition-all duration-200"])}" data-v-fb697357><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-fb697357><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" data-v-fb697357></path></svg><span data-v-fb697357>Filtros</span>`),p.value>0?s(`<span class="px-1.5 py-0.5 bg-terracota text-white text-xs rounded-full" data-v-fb697357>${r.ssrInterpolate(p.value)}</span>`):s("\x3c!----\x3e"),s("</button>"),p.value>0||d.value?s('<button class="px-3 py-1.5 text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-950/30 rounded-lg transition-all duration-200" data-v-fb697357> Limpiar </button>'):s("\x3c!----\x3e"),s("</div>"),n.value?(s(`<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 pt-2" data-v-fb697357><div data-v-fb697357><label class="block text-xs font-medium text-cafe/70 dark:text-gray-300 mb-1" data-v-fb697357> Paciente </label><select class="w-full px-3 py-1.5 text-sm border border-cafe/20 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-terracota focus:border-terracota bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100" data-v-fb697357><option value="" data-v-fb697357${r.ssrIncludeBooleanAttr(Array.isArray(i.value)?r.ssrLooseContain(i.value,""):r.ssrLooseEqual(i.value,""))?" selected":""}>Todos los pacientes</option>\x3c!--[--\x3e`),r.ssrRenderList(a.pacientes,e=>{s(`<option${r.ssrRenderAttr("value",e.id)} data-v-fb697357${r.ssrIncludeBooleanAttr(Array.isArray(i.value)?r.ssrLooseContain(i.value,e.id):r.ssrLooseEqual(i.value,e.id))?" selected":""}>${r.ssrInterpolate(e.nombre)}</option>`)}),s(`\x3c!--]--\x3e</select></div><div data-v-fb697357><label class="block text-xs font-medium text-cafe/70 dark:text-gray-300 mb-1" data-v-fb697357> Modalidad </label><select class="w-full px-3 py-1.5 text-sm border border-cafe/20 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-terracota focus:border-terracota bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100" data-v-fb697357><option value="" data-v-fb697357${r.ssrIncludeBooleanAttr(Array.isArray(c.value)?r.ssrLooseContain(c.value,""):r.ssrLooseEqual(c.value,""))?" selected":""}>Todas las modalidades</option>\x3c!--[--\x3e`),r.ssrRenderList(l,e=>{s(`<option${r.ssrRenderAttr("value",e.value)} data-v-fb697357${r.ssrIncludeBooleanAttr(Array.isArray(c.value)?r.ssrLooseContain(c.value,e.value):r.ssrLooseEqual(c.value,e.value))?" selected":""}>${r.ssrInterpolate(e.emoji)} ${r.ssrInterpolate(e.label)}</option>`)}),s(`\x3c!--]--\x3e</select></div><div data-v-fb697357><label class="block text-xs font-medium text-cafe/70 dark:text-gray-300 mb-1" data-v-fb697357> Rango de fechas </label><div class="flex gap-2" data-v-fb697357><input${r.ssrRenderAttr("value",v.value)} type="date" class="flex-1 px-3 py-1.5 text-sm border border-cafe/20 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-terracota focus:border-terracota bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100" data-v-fb697357><input${r.ssrRenderAttr("value",u.value)} type="date" class="flex-1 px-3 py-1.5 text-sm border border-cafe/20 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-terracota focus:border-terracota bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100" data-v-fb697357></div></div></div>`)):s("\x3c!----\x3e"),s("</div></div>")}}}),g=p.setup;p.setup=(a,t)=>{const r=e.useSSRContext();return(r.modules||(r.modules=new Set)).add("components/agenda/AgendaFilters.vue"),g?g(a,t):void 0};const b=Object.assign(o(p,[["__scopeId","data-v-fb697357"]]),{__name:"AgendaFilters"}),m=e.defineComponent({__name:"AgendaLegend",__ssrInlineRender:!0,setup(a){const t=[{key:"pendiente",label:"Pendiente",emoji:"ğŸŸ¡",bgClass:"bg-yellow-100",textClass:"text-yellow-800"},{key:"confirmada",label:"Confirmada",emoji:"ğŸŸ¢",bgClass:"bg-green-100",textClass:"text-green-700"},{key:"realizada",label:"Realizada",emoji:"ğŸ”µ",bgClass:"bg-blue-100",textClass:"text-blue-700"},{key:"cancelada",label:"Cancelada",emoji:"ğŸ”´",bgClass:"bg-red-100",textClass:"text-red-700"}];return(a,s,o,d)=>{s(`<div${r.ssrRenderAttrs(e.mergeProps({class:"flex flex-wrap gap-2 items-center py-1.5"},d))} data-v-5f57fa35>\x3c!--[--\x3e`),r.ssrRenderList(t,e=>{s(`<div class="${r.ssrRenderClass(["flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium transition-all duration-200 hover:scale-105",e.bgClass,e.textClass])}" data-v-5f57fa35><span class="text-base" data-v-5f57fa35>${r.ssrInterpolate(e.emoji)}</span><span data-v-5f57fa35>${r.ssrInterpolate(e.label)}</span></div>`)}),s("\x3c!--]--\x3e</div>")}}}),x=m.setup;m.setup=(a,t)=>{const r=e.useSSRContext();return(r.modules||(r.modules=new Set)).add("components/agenda/AgendaLegend.vue"),x?x(a,t):void 0};const f=Object.assign(o(m,[["__scopeId","data-v-5f57fa35"]]),{__name:"AgendaLegend"}),h=e.defineComponent({__name:"AgendaEventCard",__ssrInlineRender:!0,props:{event:{},compact:{type:Boolean},draggable:{type:Boolean}},emits:["open","menu"],setup(a,{emit:t}){const s=a;e.computed(()=>i[s.event.estado]||i.cancelada);const o=e.computed(()=>`${s.event.horaInicio} â€“ ${s.event.horaFin}`),d=e.computed(()=>s.event.horaInicio),n=e.computed(()=>s.event.pacienteNombre||"Paciente sin nombre");e.computed(()=>({pendiente:"ğŸŸ¡",confirmada:"ğŸŸ¢",cancelada:"ğŸ”´",completada:"âšª",realizada:"ğŸ”µ"}[s.event.estado]||"âšª"));const l=e.computed(()=>s.event.bono&&void 0!==s.event.bono.sesionesRestantes),c=e.computed(()=>{if(!s.event.bono)return"green";const e=s.event.bono.sesionesRestantes||0;return 0===e?"red":1===e?"orange":e<=2?"yellow":"green"});return(t,s,i,v)=>{s(`<div${r.ssrRenderAttrs(e.mergeProps({class:"agenda-event group","data-estado":a.event.estado,"data-compact":a.compact,draggable:a.draggable,role:"button",tabindex:"0",title:`${n.value} - ${o.value}`},v))} data-v-720e5f4d><div class="${r.ssrRenderClass(["flex flex-col justify-center",a.compact?"gap-0.5":"gap-1"])}" data-v-720e5f4d><span class="hora" data-v-720e5f4d>${r.ssrInterpolate(a.compact?d.value:o.value)}</span><span class="nombre" data-v-720e5f4d><span class="estado-dot" data-v-720e5f4d></span> ${r.ssrInterpolate(n.value)}</span>`),a.compact?s("\x3c!----\x3e"):(s('<div class="info-adicional" data-v-720e5f4d>'),a.event.modalidad?(s('<span class="modalidad" data-v-720e5f4d>'),"online"===a.event.modalidad?s("<span data-v-720e5f4d>ğŸ’»</span>"):s("<span data-v-720e5f4d>ğŸ¥</span>"),s(` ${r.ssrInterpolate("online"===a.event.modalidad?"Online":"Presencial")}</span>`)):s("\x3c!----\x3e"),a.event.areaTerapeutica?s(`<span class="area" data-v-720e5f4d>${r.ssrInterpolate(a.event.areaTerapeutica)}</span>`):s("\x3c!----\x3e"),l.value?s(`<span class="bono-info"${r.ssrRenderAttr("data-color",c.value)} data-v-720e5f4d>${r.ssrInterpolate(a.event.bono.sesionesRestantes)}/${r.ssrInterpolate(a.event.bono.sesionesTotales)} sesiones </span>`):s("\x3c!----\x3e"),a.event.notas||a.event.terapeuta?(s('<div class="indicadores" data-v-720e5f4d>'),a.event.notas?s('<span title="Tiene notas" data-v-720e5f4d>ğŸ“</span>'):s("\x3c!----\x3e"),a.event.terapeuta?s(`<span${r.ssrRenderAttr("title",`Terapeuta: ${a.event.terapeuta.nombre}`)} data-v-720e5f4d>ğŸ‘¤</span>`):s("\x3c!----\x3e"),s("</div>")):s("\x3c!----\x3e"),s("</div>")),s("</div>"),a.compact?s("\x3c!----\x3e"):s('<button class="menu-btn" aria-label="Abrir menÃº de acciones" type="button" data-v-720e5f4d><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20" data-v-720e5f4d><path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z" data-v-720e5f4d></path></svg></button>'),s("</div>")}}}),y=h.setup;h.setup=(a,t)=>{const r=e.useSSRContext();return(r.modules||(r.modules=new Set)).add("components/agenda/AgendaEventCard.vue"),y?y(a,t):void 0};const k=Object.assign(o(h,[["__scopeId","data-v-720e5f4d"]]),{__name:"AgendaEventCard"}),w=e.defineComponent({__name:"AgendaGrid",__ssrInlineRender:!0,props:{eventos:{},vista:{},fechaActual:{},cargando:{type:Boolean},draggable:{type:Boolean}},emits:["evento-click","evento-menu","slot-click","evento-drop"],setup(a,{emit:t}){const s=a;e.ref(null);const o=e.ref("normal"),d=e.ref(null),n=e.ref("0px"),l=e.ref(!1),i=e.ref(new Set),c=((e="08:00",a="20:00",t=30)=>{const r=[],[s,o]=e.split(":").map(Number),[d,n]=a.split(":").map(Number);let l=s,i=o;for(;l<d||l===d&&i<n;)r.push(`${String(l).padStart(2,"0")}:${String(i).padStart(2,"0")}`),i+=t,i>=60&&(l++,i-=60);return r})("08:00","22:30",30);e.computed(()=>{switch(o.value){case"compact":return"h-8";case"normal":default:return"h-10";case"comfortable":return"h-16"}});const v=e.computed(()=>{const e=s.fechaActual.toISOString().split("T")[0];if("dia"===s.vista)return[e];if("semana"===s.vista){const a=(e=>{const a=new Date(e+"T00:00:00"),t=a.getDay(),r=0===t?-6:1-t;return a.setDate(a.getDate()+r),a.toISOString().split("T")[0]})(e);return Array.from({length:7},(e,t)=>((e,a)=>{const t=new Date(e+"T00:00:00");return t.setDate(t.getDate()+a),t.toISOString().split("T")[0]})(a,t))}{const e=new Date(s.fechaActual.getFullYear(),s.fechaActual.getMonth(),1),a=new Date(s.fechaActual.getFullYear(),s.fechaActual.getMonth()+1,0);let t=e.getDay();t=0===t?6:t-1;let r=a.getDay();r=0===r?6:r-1;const o=[];for(let a=t-1;a>=0;a--){const t=new Date(e);t.setDate(t.getDate()-(a+1)),o.push(t.toISOString().split("T")[0])}for(let t=new Date(e);t<=a;t.setDate(t.getDate()+1))o.push(t.toISOString().split("T")[0]);const d=6-r;for(let e=1;e<=d;e++){const t=new Date(a);t.setDate(t.getDate()+e),o.push(t.toISOString().split("T")[0])}return o}}),u=e.computed(()=>{const e=new Map;return s.eventos.forEach(a=>{const t=a.fecha;e.has(t)||e.set(t,[]),e.get(t).push(a)}),e.forEach((e,a)=>{e.sort((e,a)=>e.horaInicio.localeCompare(a.horaInicio))}),e}),obtenerEventosEnSlot=(e,a)=>(u.value.get(e)||[]).filter(e=>e.horaInicio===a),esFechaHoy=e=>e===(new Date).toISOString().split("T")[0],esMesActual=e=>{const a=new Date(e+"T00:00:00");return a.getMonth()===s.fechaActual.getMonth()&&a.getFullYear()===s.fechaActual.getFullYear()},calcularAlturaEvento=(e,a)=>{try{const t=new Date(`1970-01-01T${e}:00`),r=(new Date(`1970-01-01T${a}:00`).getTime()-t.getTime())/6e4,s="compact"===o.value?2.25:"normal"===o.value?3.5:5;return`${r*(s/30)}rem`}catch{return"2.5rem"}},calcularTopEvento=(e,a)=>{try{const t=new Date(`1970-01-01T${e}:00`),r=new Date(`1970-01-01T${a}:00`),s=(t.getTime()-r.getTime())/6e4;if(s<=0)return"0";const d="compact"===o.value?2.25:"normal"===o.value?3.5:5;return s*(d/30)+"rem"}catch{return"0"}},esCitaActiva=e=>i.value.has(e);return e.watch([()=>s.vista,()=>s.cargando,o],()=>{s.cargando||setTimeout(()=>{"mes"===s.vista?(async()=>{if(await e.nextTick(),"mes"!==s.vista)return;const a=(new Date).toISOString().split("T")[0],t=(void 0).querySelector(".agenda-mes-grid"),r=(void 0).querySelector(`[data-fecha="${a}"]`);r&&t&&r.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})})():(async()=>{if(await e.nextTick(),!d.value||s.cargando)return;const a=new Date,t=`${String(a.getHours()).padStart(2,"0")}:${String(30*Math.floor(a.getMinutes()/30)).padStart(2,"0")}`,r=c.findIndex(e=>e>=t);if(-1!==r){const e="compact"===o.value?40:"normal"===o.value?56:80,a=Math.max(0,(r-2)*e);d.value.scrollTop=a}})()},100)}),(t,s,d,i)=>{s(`<div${r.ssrRenderAttrs(e.mergeProps({class:"flex-1 flex flex-col overflow-hidden bg-[#FFF9F6] dark:bg-gray-900"},i))} data-v-e146059a>`),a.cargando?s('<div class="flex items-center justify-center h-full" data-v-e146059a><div class="text-center space-y-3" data-v-e146059a><div class="w-12 h-12 border-4 border-terracota/20 border-t-terracota rounded-full animate-spin mx-auto" data-v-e146059a></div><p class="text-cafe/60 dark:text-gray-400" data-v-e146059a>Cargando agenda...</p></div></div>'):s("\x3c!----\x3e"),a.cargando?s("\x3c!----\x3e"):s(`<div class="agenda-controls" data-v-e146059a><div class="leyenda-estados" data-v-e146059a><div class="estado" data-v-e146059a><span class="dot" data-color="pendiente" data-v-e146059a></span><span data-v-e146059a>Pendiente</span></div><div class="estado" data-v-e146059a><span class="dot" data-color="confirmada" data-v-e146059a></span><span data-v-e146059a>Confirmada</span></div><div class="estado" data-v-e146059a><span class="dot" data-color="realizada" data-v-e146059a></span><span data-v-e146059a>Realizada</span></div><div class="estado" data-v-e146059a><span class="dot" data-color="cancelada" data-v-e146059a></span><span data-v-e146059a>Cancelada</span></div></div><div class="zoom-toggle" data-v-e146059a><span class="text-xs text-cafe/60" data-v-e146059a>Zoom:</span><button class="${r.ssrRenderClass(["px-2 py-1 rounded-md transition-all","compact"===o.value?"bg-terracota text-white":"hover:bg-terracota/10"])}" data-v-e146059a> Compacto </button><button class="${r.ssrRenderClass(["px-2 py-1 rounded-md transition-all","normal"===o.value?"bg-terracota text-white":"hover:bg-terracota/10"])}" data-v-e146059a> Normal </button><button class="${r.ssrRenderClass(["px-2 py-1 rounded-md transition-all","comfortable"===o.value?"bg-terracota text-white":"hover:bg-terracota/10"])}" data-v-e146059a> CÃ³modo </button></div></div>`),a.cargando||"dia"!==a.vista?s("\x3c!----\x3e"):(s('<div class="agenda-container" data-v-e146059a><div class="agenda-grid-dia" data-v-e146059a>'),l.value?s(`<div class="linea-tiempo-actual" style="${r.ssrRenderStyle({top:n.value})}" data-v-e146059a><div class="circulo-tiempo" data-v-e146059a></div><div class="texto-tiempo" data-v-e146059a>${r.ssrInterpolate((new Date).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}))}</div></div>`):s("\x3c!----\x3e"),s("\x3c!--[--\x3e"),r.ssrRenderList(e.unref(c),(e,a)=>{s(`<div class="${r.ssrRenderClass([a%2==0?"bg-white":"bg-[#FFFAF7]","agenda-cell-dia"])}" style="${r.ssrRenderStyle({minHeight:"compact"===o.value?"2.5rem":"normal"===o.value?"3.5rem":"5rem"})}" data-v-e146059a><div class="hora-dia" data-v-e146059a>${r.ssrInterpolate(e)}</div><div class="eventos-container" data-v-e146059a>\x3c!--[--\x3e`),r.ssrRenderList(obtenerEventosEnSlot(v.value[0],e),(e,a)=>{s(`<div class="${r.ssrRenderClass([{"cita-activa":esCitaActiva(e.id)},"agenda-event-dia"])}"${r.ssrRenderAttr("data-estado",e.estado)} style="${r.ssrRenderStyle({"--event-height":calcularAlturaEvento(e.horaInicio,e.horaFin)})}" data-v-e146059a><span class="hora" data-v-e146059a>${r.ssrInterpolate(e.horaInicio)} - ${r.ssrInterpolate(e.horaFin)}</span><span class="nombre" data-v-e146059a>${r.ssrInterpolate(e.pacienteNombre)}</span>`),"compact"!==o.value?(s('<div class="info-extra" data-v-e146059a>'),e.modalidad?s(`<span class="text-[10px]" data-v-e146059a>${r.ssrInterpolate("online"===e.modalidad?"ğŸ’»":"ğŸ¥")}</span>`):s("\x3c!----\x3e"),e.areaTerapeutica?s(`<span class="text-[10px] text-cafe/60" data-v-e146059a>${r.ssrInterpolate(e.areaTerapeutica)}</span>`):s("\x3c!----\x3e"),s("</div>")):s("\x3c!----\x3e"),s(`<div class="tooltip" data-v-e146059a><div class="font-semibold" data-v-e146059a>${r.ssrInterpolate(e.pacienteNombre)}</div><div data-v-e146059a>${r.ssrInterpolate(e.horaInicio)} - ${r.ssrInterpolate(e.horaFin)}</div>`),e.modalidad?s(`<div data-v-e146059a>${r.ssrInterpolate("online"===e.modalidad?"ğŸ’» Online":"ğŸ¥ Presencial")}</div>`):s("\x3c!----\x3e"),e.areaTerapeutica?s(`<div class="text-[10px] opacity-80" data-v-e146059a>${r.ssrInterpolate(e.areaTerapeutica)}</div>`):s("\x3c!----\x3e"),s("</div></div>")}),s("\x3c!--]--\x3e</div></div>")}),s("\x3c!--]--\x3e</div></div>")),a.cargando||"semana"!==a.vista?s("\x3c!----\x3e"):(s('<div class="agenda-container" data-v-e146059a><div class="agenda-days" data-v-e146059a><div class="col-span-1" data-v-e146059a></div>\x3c!--[--\x3e'),r.ssrRenderList(v.value,a=>{s(`<div class="${r.ssrRenderClass([esFechaHoy(a)?"bg-terracota/5 border-b-2 border-terracota":"","py-2 px-1"])}" data-v-e146059a><div class="text-xs font-medium text-cafe/70" data-v-e146059a>${r.ssrInterpolate(e.unref(formatearDiaSemana)(a).split(",")[0])}</div><div class="text-sm font-bold text-cafe" data-v-e146059a>${r.ssrInterpolate(new Date(a+"T00:00:00").getDate())}</div></div>`)}),s('\x3c!--]--\x3e</div><div class="agenda-grid" data-v-e146059a>'),l.value?s(`<div class="linea-tiempo-actual" style="${r.ssrRenderStyle({top:n.value,left:"0",right:"0",gridColumn:"1 / -1"})}" data-v-e146059a><div class="circulo-tiempo" data-v-e146059a></div><div class="texto-tiempo" data-v-e146059a>${r.ssrInterpolate((new Date).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}))}</div></div>`):s("\x3c!----\x3e"),s("\x3c!--[--\x3e"),r.ssrRenderList(e.unref(c),(e,a)=>{s(`\x3c!--[--\x3e<div class="agenda-hours" data-v-e146059a>${r.ssrInterpolate(e)}</div>\x3c!--[--\x3e`),r.ssrRenderList(v.value,t=>{s(`<div class="${r.ssrRenderClass([a%2==0?"bg-white":"bg-[#FFFAF7]","agenda-cell"])}" data-v-e146059a>\x3c!--[--\x3e`),r.ssrRenderList(obtenerEventosEnSlot(t,e),a=>{s(`<div class="${r.ssrRenderClass([{"cita-activa":esCitaActiva(a.id)},"agenda-event"])}"${r.ssrRenderAttr("data-estado",a.estado)} style="${r.ssrRenderStyle({"--event-height":calcularAlturaEvento(a.horaInicio,a.horaFin),top:calcularTopEvento(a.horaInicio,e)})}" data-v-e146059a><span class="hora" data-v-e146059a>${r.ssrInterpolate(a.horaInicio)} - ${r.ssrInterpolate(a.horaFin)}</span><span class="nombre" data-v-e146059a>${r.ssrInterpolate(a.pacienteNombre)}</span><div class="tooltip" data-v-e146059a><div class="font-semibold" data-v-e146059a>${r.ssrInterpolate(a.pacienteNombre)}</div><div data-v-e146059a>${r.ssrInterpolate(a.horaInicio)} - ${r.ssrInterpolate(a.horaFin)}</div>`),a.modalidad?s(`<div data-v-e146059a>${r.ssrInterpolate("online"===a.modalidad?"ğŸ’» Online":"ğŸ¥ Presencial")}</div>`):s("\x3c!----\x3e"),a.areaTerapeutica?s(`<div class="text-[10px] opacity-80" data-v-e146059a>${r.ssrInterpolate(a.areaTerapeutica)}</div>`):s("\x3c!----\x3e"),s("</div></div>")}),s("\x3c!--]--\x3e</div>")}),s("\x3c!--]--\x3e\x3c!--]--\x3e")}),s("\x3c!--]--\x3e</div></div>")),a.cargando||"mes"!==a.vista?s("\x3c!----\x3e"):(s('<div class="agenda-mes-container" data-v-e146059a><div class="agenda-mes-grid" data-v-e146059a>\x3c!--[--\x3e'),r.ssrRenderList(["Lun","Mar","MiÃ©","Jue","Vie","SÃ¡b","Dom"],e=>{s(`<div class="agenda-mes-header" data-v-e146059a>${r.ssrInterpolate(e)}</div>`)}),s("\x3c!--]--\x3e\x3c!--[--\x3e"),r.ssrRenderList(v.value,e=>{s(`<div${r.ssrRenderAttr("data-fecha",e)} class="${r.ssrRenderClass([[esFechaHoy(e)?"dia-hoy":"",esMesActual(e)?"":"dia-otro-mes"],"agenda-dia-mes"])}" data-v-e146059a><div class="agenda-dia-header" data-v-e146059a><span class="dia-numero" data-v-e146059a>${r.ssrInterpolate(new Date(e+"T00:00:00").getDate())}</span><div class="flex items-center gap-1" data-v-e146059a>`),(u.value.get(e)||[]).length>0?s(`<span class="contador-citas"${r.ssrRenderAttr("title",`${(u.value.get(e)||[]).length} cita${(u.value.get(e)||[]).length>1?"s":""}`)} data-v-e146059a>${r.ssrInterpolate((u.value.get(e)||[]).length)}</span>`):s("\x3c!----\x3e"),esFechaHoy(e)?s('<span class="dia-hoy-badge" data-v-e146059a>Hoy</span>'):s("\x3c!----\x3e"),s('</div></div><div class="agenda-dia-eventos" data-v-e146059a>\x3c!--[--\x3e'),r.ssrRenderList((u.value.get(e)||[]).slice(0,2),e=>{s(r.ssrRenderComponent(k,{key:e.id,event:e,compact:!0,onOpen:a=>t.$emit("evento-click",e.id)},null,d))}),s("\x3c!--]--\x3e"),(u.value.get(e)||[]).length>2?s(`<button class="mas-eventos"${r.ssrRenderAttr("title",`Ver todas las ${(u.value.get(e)||[]).length} citas de este dÃ­a`)} data-v-e146059a> +${r.ssrInterpolate((u.value.get(e)||[]).length-2)} mÃ¡s </button>`):s("\x3c!----\x3e"),s("</div></div>")}),s("\x3c!--]--\x3e</div></div>")),s("</div>")}}}),I=w.setup;w.setup=(a,t)=>{const r=e.useSSRContext();return(r.modules||(r.modules=new Set)).add("components/agenda/AgendaGrid.vue"),I?I(a,t):void 0};const $=Object.assign(o(w,[["__scopeId","data-v-e146059a"]]),{__name:"AgendaGrid"}),C=e.defineComponent({__name:"index",__ssrInlineRender:!0,props:{legacyFallback:{type:Boolean}},setup(o){a(),t();const{getCitasRango:i}=s(),c=e.ref([]),v=e.ref(!1),p=e.ref(null),g=e.ref("semana"),m=e.ref(new Date),x=e.ref(!1),h=e.ref({}),y=e.ref(""),k=e.ref(!1),w=e.ref(!1),I=e.ref(null),C=e.ref(null),R=e.ref(!1),S=e.ref({x:0,y:0}),_=e.ref(null),A=e.computed(()=>c.value?.length?c.value.map(e=>({id:e.cita_id||e.id,pacienteNombre:e.paciente_nombre||"Sin paciente",pacienteId:e.paciente_id,estado:e.estado,fecha:e.fecha_cita,horaInicio:e.hora_inicio?.substring(0,5)||e.hora_inicio,horaFin:e.hora_fin?.substring(0,5)||e.hora_fin,modalidad:e.modalidad,bono:e.bono_id?{id:e.bono_id,sesionesRestantes:e.bono_sesiones_restantes,sesionesTotales:e.bono_sesiones_totales}:null,terapeuta:e.terapeuta_id?{id:e.terapeuta_id,nombre:e.terapeuta_nombre}:void 0,notas:e.observaciones||void 0,areaTerapeutica:e.paciente_area||void 0,tipoSesion:e.tipo_sesion||void 0})):[]),D=e.computed(()=>{let e=A.value;if(y.value.trim()){const a=y.value.toLowerCase();e=e.filter(e=>e.pacienteNombre.toLowerCase().includes(a)||e.terapeuta?.nombre.toLowerCase().includes(a)||e.notas?.toLowerCase().includes(a))}return h.value.estados?.length&&(e=e.filter(e=>h.value.estados.includes(e.estado))),h.value.terapeutaId&&(e=e.filter(e=>e.terapeuta?.id===h.value.terapeutaId)),h.value.pacienteId&&(e=e.filter(e=>e.pacienteId===h.value.pacienteId)),h.value.modalidad&&(e=e.filter(e=>e.modalidad===h.value.modalidad)),h.value.fechaDesde&&(e=e.filter(e=>e.fecha>=h.value.fechaDesde)),h.value.fechaHasta&&(e=e.filter(e=>e.fecha<=h.value.fechaHasta)),e}),T=e.computed(()=>[]),j=e.computed(()=>{const e=new Map;return c.value?.forEach(a=>{a.paciente_id&&e.set(a.paciente_id,{id:a.paciente_id,nombre:a.paciente_nombre||"Sin nombre"})}),Array.from(e.values())}),cargarCitas=async()=>{try{v.value=!0,p.value=null;let e,a;if("dia"===g.value)e=a=m.value.toISOString().split("T")[0];else if("semana"===g.value){const t=new Date(m.value);t.setDate(t.getDate()-t.getDay()),e=t.toISOString().split("T")[0];const r=new Date(t);r.setDate(r.getDate()+6),a=r.toISOString().split("T")[0]}else{const t=new Date(m.value.getFullYear(),m.value.getMonth(),1),r=new Date(m.value.getFullYear(),m.value.getMonth()+1,0);e=t.toISOString().split("T")[0],a=r.toISOString().split("T")[0]}const t=await i(e,a);c.value=t.filter(e=>"cancelada"!==e.estado&&"borrador"!==e.estado&&null!==e.estado)}catch(e){console.error("âŒ Error al cargar citas:",e),p.value=e.message}finally{v.value=!1}};e.watch(g,e=>{cargarCitas()}),e.watch(m,()=>{cargarCitas()}),e.watch(m,e=>{}),e.watch(x,e=>{}),e.watch(h,e=>{},{deep:!0});const abrirModalNuevaCita=()=>{C.value=null,k.value=!0},crearCitaEnSlot=e=>{D.value.some(a=>a.fecha===e.date&&a.horaInicio===e.horaInicio)||(C.value=e,k.value=!0)},abrirDetalles=e=>{I.value=e,w.value=!0},abrirMenu=(e,a)=>{_.value=e,S.value={x:a.clientX,y:a.clientY},R.value=!0},moverCita=async(e,a)=>{try{console.log("Reprogramar cita:",e,a),await cargarCitas()}catch(e){console.error("Error al reprogramar cita:",e),alert("No se pudo reprogramar la cita. Intenta nuevamente.")}};return(e,a,t,s)=>{a(`<div${r.ssrRenderAttrs(s)} data-v-644cee40>`),o.legacyFallback?a(r.ssrRenderComponent(d,null,null,t)):(a(`<div class="${r.ssrRenderClass([{dark:x.value},"h-screen flex flex-col overflow-hidden bg-[#FFF9F6] dark:bg-gray-950"])}" data-v-644cee40>`),a(r.ssrRenderComponent(u,{vista:g.value,"onUpdate:vista":e=>g.value=e,fechaActual:m.value,"onUpdate:fechaActual":e=>m.value=e,darkMode:x.value,"onUpdate:darkMode":e=>x.value=e,onNuevaCita:abrirModalNuevaCita},null,t)),a(r.ssrRenderComponent(b,{filtros:h.value,"onUpdate:filtros":e=>h.value=e,"onUpdate:busqueda":e=>y.value=e,terapeutas:T.value,pacientes:j.value},null,t)),a('<div class="px-4 py-2 bg-white/60 dark:bg-gray-950/60 backdrop-blur-sm border-b border-cafe/5 dark:border-gray-800" data-v-644cee40>'),a(r.ssrRenderComponent(f,null,null,t)),a("</div>"),a(r.ssrRenderComponent($,{eventos:D.value,vista:g.value,fechaActual:m.value,cargando:v.value,draggable:!0,onEventoClick:abrirDetalles,onEventoMenu:abrirMenu,onSlotClick:crearCitaEnSlot,onEventoDrop:moverCita},null,t)),a(r.ssrRenderComponent(n,{modelValue:k.value,"onUpdate:modelValue":e=>k.value=e,"fecha-inicial":C.value?.date,"hora-inicial":C.value?.horaInicio,onGuardado:cargarCitas},null,t)),a(r.ssrRenderComponent(l,{isOpen:w.value,citaId:I.value,onClose:e=>{w.value=!1,I.value=null},onActualizado:cargarCitas,onEliminado:cargarCitas},null,t)),r.ssrRenderTeleport(a,e=>{R.value?e(`<div style="${r.ssrRenderStyle({top:`${S.value.y}px`,left:`${S.value.x}px`})}" class="fixed z-50 bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-700 rounded-lg shadow-lg py-1 min-w-[180px]" data-v-644cee40><button class="w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-800 transition" data-v-644cee40> Ver detalles </button><button class="w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-800 transition" data-v-644cee40> Reprogramar </button><button class="w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-800 transition text-red-600" data-v-644cee40> Cancelar cita </button></div>`):e("\x3c!----\x3e")},"body",!1,t),a('<div class="fixed bottom-4 right-4 bg-gray-900/90 dark:bg-gray-100/90 text-white dark:text-gray-900 px-3 py-2 rounded-lg text-xs opacity-0 hover:opacity-100 transition-opacity" data-v-644cee40><kbd data-v-644cee40>j/k</kbd> navegar Â· <kbd data-v-644cee40>t</kbd> hoy Â· <kbd data-v-644cee40>1/2/3</kbd> vistas Â· <kbd data-v-644cee40>n</kbd> nueva Â· <kbd data-v-644cee40>f</kbd> buscar </div></div>')),a("</div>")}}}),R=C.setup;C.setup=(a,t)=>{const r=e.useSSRContext();return(r.modules||(r.modules=new Set)).add("pages/agenda/index.vue"),R?R(a,t):void 0};const S=o(C,[["__scopeId","data-v-644cee40"]]);export{S as default};
//# sourceMappingURL=index-DbsQQ3hW.mjs.map
