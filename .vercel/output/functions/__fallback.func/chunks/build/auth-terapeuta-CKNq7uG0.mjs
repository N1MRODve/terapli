import{x as e}from"../nitro/nitro.mjs";import{k as r,e as o,n as a}from"./server.mjs";import{u as t}from"./useSupabaseClient-DykwVqLQ.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"../routes/renderer.mjs";import"../_/shared.cjs.prod.mjs";import"node:stream";import"@supabase/ssr";import"@vercel/analytics/nuxt";const i=r(async(r,i)=>{let n,s;if(!r.path.startsWith("/terapeuta")||"/terapeuta/login"===r.path)return;const l=o(),p=t();if(!l.value)return console.log("[Middleware] Usuario no autenticado, redirigiendo a login"),a("/terapeuta/login",{replace:!0});try{const r=l.value?.id||l.value?.sub;if(!r)return console.error("[Middleware] No se pudo obtener el ID del usuario:",l.value),a("/terapeuta/login",{replace:!0});const{data:o,error:t}=([n,s]=e(()=>p.from("profiles").select("rol, nombre").eq("id",r).single()),n=await n,s(),n);if(t)return console.error("[Middleware] Error al obtener perfil:",t),a("/terapeuta/login",{replace:!0});const i=o?.rol;if(!i||!["terapeuta","psicologa","admin","coordinadora"].includes(i))return console.log(`[Middleware] Usuario con rol '${i}' sin acceso, redirigiendo a home`),a("/",{replace:!0});console.log(`[Middleware] Acceso autorizado para: ${o?.nombre||"profesional"} (${i})`)}catch(e){return console.error("[Middleware] Error inesperado:",e),a("/terapeuta/login",{replace:!0})}});export{i as default};
//# sourceMappingURL=auth-terapeuta-CKNq7uG0.mjs.map
