import{_ as e}from"./nuxt-link-C_f1d2Rj.mjs";import{v as a,a as t,e as r,s as o}from"./server.mjs";import{_ as s}from"./_plugin-vue_export-helper-1tPrXgE0.mjs";import{M as n}from"./ModalDetallesCita-Db71gcxb.mjs";import{u as i}from"./useSupabaseClient-DykwVqLQ.mjs";import"../nitro/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"../routes/renderer.mjs";import"../_/shared.cjs.prod.mjs";import"../virtual/_commonjsHelpers.mjs";import"node:stream";import"../_/index2.mjs";import"@supabase/supabase-js";import"@vercel/analytics/nuxt";import"./XCircleIcon-BCxujS_I.mjs";import"./CheckCircleIcon-CT9fzVFs.mjs";import"./ExclamationCircleIcon-DhXgUVTW.mjs";import"./CalendarIcon-BrsGHJBC.mjs";import"./XMarkIcon-DCLwyE-W.mjs";import"./UserIcon-CrHYaeI9.mjs";import"./ClockIcon-BxdFtPqx.mjs";import"./TicketIcon-zZdrc71S.mjs";const l=a.defineComponent({__name:"SessionCard",__ssrInlineRender:!0,props:{id:{},hora:{},pacienteNombre:{},modalidad:{},estado:{},isNext:{type:Boolean}},emits:["click","confirmar"],setup(e,{emit:t}){const r=e,s={presencial:{label:"Presencial",icon:"üè•",class:"bg-blue-100 text-blue-700 border-blue-200"},online:{label:"Online",icon:"üíª",class:"bg-purple-100 text-purple-700 border-purple-200"},virtual:{label:"Online",icon:"üíª",class:"bg-purple-100 text-purple-700 border-purple-200"},telefonica:{label:"Tel√©fono",icon:"üìû",class:"bg-amber-100 text-amber-700 border-amber-200"}},n={pendiente:{label:"Pendiente",class:"bg-amber-100 text-amber-800 border-amber-300"},confirmada:{label:"Confirmada",class:"bg-emerald-100 text-emerald-800 border-emerald-300"},realizada:{label:"Realizada",class:"bg-blue-100 text-blue-800 border-blue-300"},cancelada:{label:"Cancelada",class:"bg-red-100 text-red-800 border-red-300"}},i=a.computed(()=>s[r.modalidad]||s.presencial),l=a.computed(()=>n[r.estado]||n.pendiente);return(t,s,n,d)=>{s(`<div${o.ssrRenderAttrs(a.mergeProps({class:["relative flex items-center gap-4 p-4 rounded-xl border bg-white cursor-pointer transition-all duration-200 hover:shadow-md hover:border-violet-200 group",{"ring-2 ring-violet-400 ring-offset-2 shadow-lg border-violet-300":e.isNext,"border-gray-100":!e.isNext}]},d))}>`),e.isNext?s('<div class="absolute -top-2 left-4 px-2 py-0.5 text-[10px] font-bold uppercase tracking-wider bg-violet-600 text-white rounded-full shadow-sm"> Pr√≥xima </div>'):s("\x3c!----\x3e"),s(`<div class="flex-shrink-0 w-16 text-center"><p class="text-2xl font-bold text-gray-900">${o.ssrInterpolate(e.hora)}</p></div><div class="w-px h-12 bg-gray-200"></div><div class="flex-1 min-w-0"><p class="text-base font-semibold text-gray-900 truncate">${o.ssrInterpolate(e.pacienteNombre)}</p><div class="flex items-center gap-2 mt-1.5"><span class="${o.ssrRenderClass([a.unref(i).class,"inline-flex items-center gap-1 px-2 py-0.5 text-xs font-medium rounded-full border"])}"><span class="text-[10px]">${o.ssrInterpolate(a.unref(i).icon)}</span> ${o.ssrInterpolate(a.unref(i).label)}</span><span class="${o.ssrRenderClass([a.unref(l).class,"inline-flex items-center px-2 py-0.5 text-xs font-medium rounded-full border"])}">${o.ssrInterpolate(a.unref(l).label)}</span></div></div><div class="flex items-center gap-2">`),"pendiente"===r.estado?s('<button class="px-3 py-1.5 text-xs font-medium bg-emerald-500 text-white rounded-lg opacity-0 group-hover:opacity-100 hover:bg-emerald-600 transition-all shadow-sm" title="Confirmar cita"> Confirmar </button>'):s("\x3c!----\x3e"),s('<button class="p-2 text-gray-400 hover:text-violet-600 hover:bg-violet-50 rounded-lg transition-colors" title="Ver detalles"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></button></div></div>')}}}),d=l.setup;l.setup=(e,t)=>{const r=a.useSSRContext();return(r.modules||(r.modules=new Set)).add("components/dashboard/SessionCard.vue"),d?d(e,t):void 0};const c=Object.assign(l,{__name:"DashboardSessionCard"}),p=a.defineComponent({__name:"PatientCard",__ssrInlineRender:!0,props:{id:{},nombre:{},ultimaSesion:{},proximaCita:{},sesionesUsadas:{},sesionesTotales:{},estadoBono:{}},emits:["click"],setup(e,{emit:t}){const r=e,s=a.computed(()=>{if(!r.nombre)return"?";const e=r.nombre.split(" ").filter(Boolean);return e.length>=2?(e[0][0]+e[1][0]).toUpperCase():e[0]?.substring(0,2).toUpperCase()||"?"}),n=a.computed(()=>{const e=["bg-violet-500","bg-blue-500","bg-emerald-500","bg-amber-500","bg-rose-500","bg-cyan-500","bg-indigo-500","bg-teal-500"];return e[(r.nombre?.charCodeAt(0)||0)%e.length]}),i=a.computed(()=>r.sesionesTotales&&0!==r.sesionesTotales?Math.round((r.sesionesUsadas||0)/r.sesionesTotales*100):0),l={activo:{label:"Bono activo",class:"text-emerald-600 bg-emerald-50",icon:"‚úì"},por_agotar:{label:"Por agotar",class:"text-amber-600 bg-amber-50",icon:"!"},sin_bono:{label:"Sin bono",class:"text-gray-500 bg-gray-50",icon:"‚Äì"},agotado:{label:"Bono agotado",class:"text-red-600 bg-red-50",icon:"‚úó"}},d=a.computed(()=>l[r.estadoBono||"sin_bono"]),c=a.computed(()=>{if(!r.ultimaSesion)return"Sin sesiones";const e=new Date(r.ultimaSesion),a=new Date,t=Math.floor((a.getTime()-e.getTime())/864e5);return 0===t?"Hoy":1===t?"Ayer":t<7?`Hace ${t} d√≠as`:e.toLocaleDateString("es-ES",{day:"numeric",month:"short"})});return(t,r,l,p)=>{r(`<div${o.ssrRenderAttrs(a.mergeProps({class:"flex items-center gap-4 p-4 bg-white rounded-xl border border-gray-100 cursor-pointer transition-all duration-200 hover:shadow-md hover:border-violet-200 group"},p))}><div class="${o.ssrRenderClass([a.unref(n),"flex-shrink-0 w-12 h-12 rounded-full flex items-center justify-center text-white font-bold text-sm shadow-sm"])}">${o.ssrInterpolate(a.unref(s))}</div><div class="flex-1 min-w-0"><p class="font-semibold text-gray-900 truncate">${o.ssrInterpolate(e.nombre)}</p><div class="flex items-center gap-3 mt-1 text-sm"><span class="text-gray-500 flex items-center gap-1"><svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> ${o.ssrInterpolate(a.unref(c))}</span>`),a.unref(d)?r(`<span class="${o.ssrRenderClass([a.unref(d).class,"inline-flex items-center gap-1 px-2 py-0.5 text-xs font-medium rounded-full"])}">${o.ssrInterpolate(a.unref(d).label)}</span>`):r("\x3c!----\x3e"),r("</div>"),e.sesionesTotales&&e.sesionesTotales>0?r(`<div class="mt-2"><div class="flex items-center justify-between text-xs text-gray-500 mb-1"><span>Sesiones del bono</span><span class="font-medium">${o.ssrInterpolate(e.sesionesUsadas||0)}/${o.ssrInterpolate(e.sesionesTotales)}</span></div><div class="h-1.5 bg-gray-100 rounded-full overflow-hidden"><div class="${o.ssrRenderClass([{"bg-emerald-500":a.unref(i)<75,"bg-amber-500":a.unref(i)>=75&&a.unref(i)<100,"bg-red-500":a.unref(i)>=100},"h-full rounded-full transition-all duration-500"])}" style="${o.ssrRenderStyle({width:`${Math.min(a.unref(i),100)}%`})}"></div></div></div>`):r("\x3c!----\x3e"),r('</div><button class="flex-shrink-0 p-2 text-gray-400 hover:text-violet-600 hover:bg-violet-50 rounded-lg transition-colors" title="Ver perfil"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></button></div>')}}}),u=p.setup;p.setup=(e,t)=>{const r=a.useSSRContext();return(r.modules||(r.modules=new Set)).add("components/dashboard/PatientCard.vue"),u?u(e,t):void 0};const v=Object.assign(p,{__name:"DashboardPatientCard"}),m=a.defineComponent({__name:"MetricCard",__ssrInlineRender:!0,props:{value:{},label:{},sublabel:{},icon:{},variant:{},to:{}},setup(e){const t={purple:{bg:"bg-gradient-to-br from-violet-50 to-purple-50",border:"border-violet-200/60",icon:"bg-violet-100 text-violet-600",value:"text-violet-900",label:"text-violet-700/80"},green:{bg:"bg-gradient-to-br from-emerald-50 to-teal-50",border:"border-emerald-200/60",icon:"bg-emerald-100 text-emerald-600",value:"text-emerald-900",label:"text-emerald-700/80"},blue:{bg:"bg-gradient-to-br from-blue-50 to-indigo-50",border:"border-blue-200/60",icon:"bg-blue-100 text-blue-600",value:"text-blue-900",label:"text-blue-700/80"},amber:{bg:"bg-gradient-to-br from-amber-50 to-orange-50",border:"border-amber-200/60",icon:"bg-amber-100 text-amber-600",value:"text-amber-900",label:"text-amber-700/80"},neutral:{bg:"bg-gradient-to-br from-gray-50 to-slate-50",border:"border-gray-200/60",icon:"bg-gray-100 text-gray-600",value:"text-gray-900",label:"text-gray-700/80"}};return(r,s,n,i)=>{o.ssrRenderVNode(s,a.createVNode(a.resolveDynamicComponent(e.to?"NuxtLink":"div"),a.mergeProps({to:e.to,class:["relative p-5 rounded-2xl border transition-all duration-200",[t[e.variant||"purple"].bg,t[e.variant||"purple"].border,e.to?"hover:shadow-lg hover:scale-[1.02] cursor-pointer group":""]]},i),{default:a.withCtx((r,s,n,i)=>{if(!s)return[a.createVNode("div",{class:["w-10 h-10 rounded-xl flex items-center justify-center mb-3 transition-transform",[t[e.variant||"purple"].icon,e.to?"group-hover:scale-110":""]]},[a.createVNode("span",{class:"text-xl"},a.toDisplayString(e.icon),1)],2),a.createVNode("p",{class:["text-3xl font-bold tracking-tight",t[e.variant||"purple"].value]},a.toDisplayString(e.value),3),a.createVNode("p",{class:["text-sm font-medium mt-1",t[e.variant||"purple"].label]},a.toDisplayString(e.label),3),e.sublabel?(a.openBlock(),a.createBlock("p",{key:0,class:["text-xs mt-0.5 font-medium",t[e.variant||"purple"].label]},a.toDisplayString(e.sublabel),3)):a.createCommentVNode("",!0),e.to?(a.openBlock(),a.createBlock("div",{key:1,class:"absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity"},[(a.openBlock(),a.createBlock("svg",{class:["w-5 h-5",t[e.variant||"purple"].label],fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a.createVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],2))])):a.createCommentVNode("",!0)];s(`<div class="${o.ssrRenderClass([[t[e.variant||"purple"].icon,e.to?"group-hover:scale-110":""],"w-10 h-10 rounded-xl flex items-center justify-center mb-3 transition-transform"])}"${i}><span class="text-xl"${i}>${o.ssrInterpolate(e.icon)}</span></div><p class="${o.ssrRenderClass([t[e.variant||"purple"].value,"text-3xl font-bold tracking-tight"])}"${i}>${o.ssrInterpolate(e.value)}</p><p class="${o.ssrRenderClass([t[e.variant||"purple"].label,"text-sm font-medium mt-1"])}"${i}>${o.ssrInterpolate(e.label)}</p>`),e.sublabel?s(`<p class="${o.ssrRenderClass([t[e.variant||"purple"].label,"text-xs mt-0.5 font-medium"])}"${i}>${o.ssrInterpolate(e.sublabel)}</p>`):s("\x3c!----\x3e"),e.to?s(`<div class="absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity"${i}><svg class="${o.ssrRenderClass([t[e.variant||"purple"].label,"w-5 h-5"])}" fill="none" stroke="currentColor" viewBox="0 0 24 24"${i}><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"${i}></path></svg></div>`):s("\x3c!----\x3e")}),_:1}),n)}}}),g=m.setup;m.setup=(e,t)=>{const r=a.useSSRContext();return(r.modules||(r.modules=new Set)).add("components/dashboard/MetricCard.vue"),g?g(e,t):void 0};const b=Object.assign(m,{__name:"DashboardMetricCard"}),x=a.defineComponent({__name:"ReminderCard",__ssrInlineRender:!0,props:{id:{},tipo:{},mensaje:{},paciente:{},fecha:{},hora:{},urgente:{type:Boolean},accion:{}},emits:["accion"],setup(e,{emit:t}){const r=e,s={confirmacion:{icon:"üìÖ",bgClass:"bg-amber-50 border-amber-200",bgClassUrgent:"bg-red-50 border-red-300 ring-2 ring-red-200",iconBg:"bg-amber-100",iconBgUrgent:"bg-red-100",textClass:"text-amber-900",textClassUrgent:"text-red-900",accionLabel:"Confirmar",accionClass:"bg-amber-500 hover:bg-amber-600 text-white",accionClassUrgent:"bg-red-500 hover:bg-red-600 text-white"},pago:{icon:"üí≥",bgClass:"bg-emerald-50 border-emerald-200",bgClassUrgent:"bg-emerald-50 border-emerald-200",iconBg:"bg-emerald-100",iconBgUrgent:"bg-emerald-100",textClass:"text-emerald-900",textClassUrgent:"text-emerald-900",accionLabel:"Ver pago",accionClass:"bg-emerald-500 hover:bg-emerald-600 text-white",accionClassUrgent:"bg-emerald-500 hover:bg-emerald-600 text-white"},clinico:{icon:"üìù",bgClass:"bg-blue-50 border-blue-200",bgClassUrgent:"bg-blue-50 border-blue-200",iconBg:"bg-blue-100",iconBgUrgent:"bg-blue-100",textClass:"text-blue-900",textClassUrgent:"text-blue-900",accionLabel:"Ver",accionClass:"bg-blue-500 hover:bg-blue-600 text-white",accionClassUrgent:"bg-blue-500 hover:bg-blue-600 text-white"},bono:{icon:"üéüÔ∏è",bgClass:"bg-violet-50 border-violet-200",bgClassUrgent:"bg-violet-50 border-violet-200",iconBg:"bg-violet-100",iconBgUrgent:"bg-violet-100",textClass:"text-violet-900",textClassUrgent:"text-violet-900",accionLabel:"Ver bono",accionClass:"bg-violet-500 hover:bg-violet-600 text-white",accionClassUrgent:"bg-violet-500 hover:bg-violet-600 text-white"},general:{icon:"üîî",bgClass:"bg-gray-50 border-gray-200",bgClassUrgent:"bg-gray-50 border-gray-200",iconBg:"bg-gray-100",iconBgUrgent:"bg-gray-100",textClass:"text-gray-900",textClassUrgent:"text-gray-900",accionLabel:"Ver",accionClass:"bg-gray-500 hover:bg-gray-600 text-white",accionClassUrgent:"bg-gray-500 hover:bg-gray-600 text-white"}},n=a.computed(()=>s[r.tipo]||s.general),i=a.computed(()=>r.urgente?n.value.bgClassUrgent:n.value.bgClass),l=a.computed(()=>r.urgente?n.value.iconBgUrgent:n.value.iconBg),d=a.computed(()=>r.urgente?n.value.textClassUrgent:n.value.textClass),c=a.computed(()=>r.urgente?n.value.accionClassUrgent:n.value.accionClass),p=a.computed(()=>r.paciente&&(r.fecha||r.hora)?null:r.mensaje);return(t,r,s,u)=>{r(`<div${o.ssrRenderAttrs(a.mergeProps({class:["flex items-center gap-3 p-3 rounded-xl border transition-all duration-200 hover:shadow-sm cursor-pointer group",a.unref(i)]},u))} data-v-7055149d><div class="${o.ssrRenderClass([a.unref(l),"relative flex-shrink-0 w-10 h-10 rounded-lg flex items-center justify-center text-lg"])}" data-v-7055149d>`),e.urgente?r('<span class="text-base" data-v-7055149d>‚ö†Ô∏è</span>'):r(`<span data-v-7055149d>${o.ssrInterpolate(a.unref(n).icon)}</span>`),r('</div><div class="flex-1 min-w-0" data-v-7055149d>'),e.paciente&&(e.fecha||e.hora)?(r(`\x3c!--[--\x3e<div class="flex items-center gap-2" data-v-7055149d><p class="${o.ssrRenderClass([a.unref(d),"font-medium truncate"])}" data-v-7055149d>${o.ssrInterpolate(e.paciente)}</p>`),e.urgente?r('<span class="flex-shrink-0 inline-flex items-center px-1.5 py-0.5 text-[10px] font-bold uppercase tracking-wider bg-red-500 text-white rounded-full animate-pulse" data-v-7055149d> Urgente </span>'):r("\x3c!----\x3e"),r(`</div><p class="${o.ssrRenderClass([e.urgente?"text-red-700":"text-gray-600","text-sm flex items-center gap-2 mt-0.5"])}" data-v-7055149d>`),"confirmacion"===e.tipo?r("<span data-v-7055149d>Confirmar cita</span>"):"pago"===e.tipo?r("<span data-v-7055149d>Pago pendiente</span>"):"bono"===e.tipo?r("<span data-v-7055149d>Bono por agotar</span>"):r(`<span data-v-7055149d>${o.ssrInterpolate(e.mensaje)}</span>`),e.fecha||e.hora?r(`<span class="${o.ssrRenderClass(e.urgente?"text-red-400":"text-gray-400")}" data-v-7055149d>‚Ä¢</span>`):r("\x3c!----\x3e"),e.fecha||e.hora?r(`<span class="font-semibold" data-v-7055149d>${o.ssrInterpolate(e.fecha)} ${o.ssrInterpolate(e.hora)}</span>`):r("\x3c!----\x3e"),r("</p>\x3c!--]--\x3e")):r(`<p class="${o.ssrRenderClass([a.unref(d),"text-sm leading-relaxed"])}" data-v-7055149d>${o.ssrInterpolate(a.unref(p)||e.mensaje)}</p>`),r("</div>"),e.accion?r(`<button class="${o.ssrRenderClass([[a.unref(c),e.urgente?"opacity-100":"opacity-0 group-hover:opacity-100"],"flex-shrink-0 px-3 py-1.5 text-xs font-medium rounded-lg transition-all shadow-sm"])}" data-v-7055149d>${o.ssrInterpolate(a.unref(n).accionLabel)}</button>`):r("\x3c!----\x3e"),r(`<svg class="${o.ssrRenderClass([e.urgente?"text-red-400 opacity-100":"text-gray-400 opacity-50 group-hover:opacity-100","w-4 h-4 flex-shrink-0 transition-opacity"])}" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-7055149d><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" data-v-7055149d></path></svg></div>`)}}}),f=x.setup;x.setup=(e,t)=>{const r=a.useSSRContext();return(r.modules||(r.modules=new Set)).add("components/dashboard/ReminderCard.vue"),f?f(e,t):void 0};const h=Object.assign(s(x,[["__scopeId","data-v-7055149d"]]),{__name:"DashboardReminderCard"}),y=a.defineComponent({__name:"dashboard",__ssrInlineRender:!0,setup(s){const l=i(),d=t();r();const p=a.ref(null),u=a.ref(!0),m=a.ref(!0),g=a.ref([]),x=a.ref([]),f=a.ref(0),y=a.ref(0),w=a.ref(0),C=a.ref(!1),k=a.ref(null),_=a.ref(!1),j=a.ref(!1),$=a.ref(0),S=a.ref(0),R=a.ref([]),B=a.ref(!0),D=a.computed(()=>(new Date).toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long"})),I=a.computed(()=>_.value?g.value:g.value.slice(0,5));function isSameDay(e,a){return e.getFullYear()===a.getFullYear()&&e.getMonth()===a.getMonth()&&e.getDate()===a.getDate()}function getRelativeDateTime(e,a){const t=new Date,r=new Date(`${e}T${a}:00`),o=(r.getTime()-t.getTime())/36e5;if(isSameDay(r,t))return`Hoy ${a}`;if(function(e,a){const t=new Date(a);return t.setDate(t.getDate()+1),isSameDay(e,t)}(r,t))return`Ma√±ana ${a}`;if(o>0&&o<168){const e=r.toLocaleDateString("es-ES",{weekday:"long"});return`${e.charAt(0).toUpperCase()+e.slice(1)} ${a}`}return`${function(e){return e.toLocaleDateString("es-ES",{day:"numeric",month:"short"})}(r)} ${a}`}const M=a.computed(()=>R.value.map(e=>{let a=e.fechaCita&&e.horaCita?getRelativeDateTime(e.fechaCita,e.horaCita):void 0,t="confirmacion"===e.tipo&&function(e,a){if(!e||!a)return!1;const t=new Date,r=(new Date(`${e}T${a}:00`).getTime()-t.getTime())/36e5;return r>0&&r<24}(e.fechaCita,e.horaCita),r="",o="";if(a){const e=a.split(" ");o=e.pop()||"",r=e.join(" ")}return{id:e.id,tipo:e.tipo,mensaje:e.mensaje,paciente:e.paciente,fecha:r,hora:o,urgente:t,accion:e.accion}})),V=a.computed(()=>[...M.value].sort((e,a)=>{if(e.urgente&&!a.urgente)return-1;if(!e.urgente&&a.urgente)return 1;const t=e.fecha||e.hora,r=a.fecha||a.hora;return t&&!r?-1:!t&&r?1:0})),U=a.computed(()=>j.value?V.value:V.value.slice(0,4)),navegarAPaciente=e=>{d.push(`/terapeuta/pacientes/${e}`)},abrirDetalles=e=>{k.value=e,C.value=!0},cerrarModalDetalles=()=>{C.value=!1,k.value=null,cargarSesiones()},confirmarCitaRapido=async e=>{try{const{error:a}=await l.from("citas").update({estado:"confirmada",updated_at:(new Date).toISOString()}).eq("id",e);if(a)throw a;const t=g.value.findIndex(a=>a.id===e);-1!==t&&(g.value[t].estado="confirmada"),await generarRecordatorios()}catch(e){console.error("Error al confirmar cita:",e),alert("Error al confirmar la cita")}};async function cargarSesiones(){u.value=!0;try{const e=new Date;e.setHours(0,0,0,0);const a=new Date(e);a.setDate(a.getDate()+7);const{data:t,error:r}=await l.from("citas").select("\n        id,\n        paciente_id,\n        fecha_cita,\n        hora_inicio,\n        modalidad,\n        estado,\n        observaciones,\n        pacientes (\n          id,\n          nombre_completo,\n          email\n        )\n      ").in("estado",["pendiente","confirmada"]).gte("fecha_cita",e.toISOString().split("T")[0]).lte("fecha_cita",a.toISOString().split("T")[0]).order("fecha_cita",{ascending:!0}).order("hora_inicio",{ascending:!0});if(r)throw r;g.value=(t||[]).map(e=>({id:e.id,hora_inicio:e.hora_inicio?e.hora_inicio.substring(0,5):"--:--",paciente_nombre:e.pacientes?.nombre_completo||e.pacientes?.email||"Paciente",modalidad:e.modalidad||"presencial",estado:e.estado||"pendiente",observaciones:e.observaciones}))}catch(e){console.error("Error al cargar sesiones:",e),g.value=[]}finally{u.value=!1}}async function generarRecordatorios(){B.value=!0;const e=[];try{const a=new Date,t=new Date(a);t.setHours(0,0,0,0);const r=t.toISOString().split("T")[0],o=new Date(t);o.setDate(t.getDate()+3);const s=o.toISOString().split("T")[0],{data:n}=await l.from("citas").select("\n        id,\n        fecha_cita,\n        hora_inicio,\n        pacientes (\n          nombre_completo\n        )\n      ").eq("estado","pendiente").gte("fecha_cita",r).lte("fecha_cita",s).order("fecha_cita",{ascending:!0}).order("hora_inicio",{ascending:!0});n?.forEach(t=>{const o=t.hora_inicio?.substring(0,5)||"00:00",s=t.fecha_cita;if(s===r){const[e,t]=o.split(":").map(Number),r=new Date(a);if(r.setHours(e,t,0,0),r<a)return}e.push({id:t.id,tipo:"confirmacion",mensaje:`Confirmar cita de ${t.pacientes?.nombre_completo||"paciente"}`,paciente:t.pacientes?.nombre_completo||"Paciente",fechaCita:s,horaCita:o,accion:"confirmar"})});const{data:i}=await l.from("citas").select("\n        id,\n        fecha_cita,\n        hora_inicio,\n        pacientes (\n          nombre_completo\n        )\n      ").lt("fecha_cita",r).neq("estado","completada").neq("estado","cancelada").neq("estado","realizada").order("fecha_cita",{ascending:!1}).limit(3);i?.forEach(a=>{const t=new Date(a.fecha_cita).toLocaleDateString("es-ES",{day:"numeric",month:"short"});e.push({id:a.id,tipo:"clinico",mensaje:`Revisa la sesi√≥n pendiente de ${a.pacientes?.nombre_completo||"paciente"} del ${t}`,paciente:a.pacientes?.nombre_completo||"Paciente",accion:"ver"})});const{data:d}=await l.from("bonos").select("\n        id,\n        sesiones_restantes,\n        pacientes (\n          nombre_completo\n        )\n      ").eq("estado","activo").lte("sesiones_restantes",2).gt("sesiones_restantes",0).limit(3);d?.forEach(a=>{e.push({id:a.id,tipo:"bono",mensaje:`El bono est√° por agotarse (quedan ${a.sesiones_restantes} sesiones)`,paciente:a.pacientes?.nombre_completo||"Paciente",accion:"ver"})}),R.value=e.slice(0,8)}catch(e){console.error("Error al generar recordatorios:",e),R.value=[]}finally{B.value=!1}}const handleRecordatorioAccion=async e=>{"confirmacion"===e.tipo&&"confirmar"===e.accion&&e.id?(await confirmarCitaRapido(e.id),await generarRecordatorios()):"clinico"===e.tipo&&e.id&&abrirDetalles(e.id)};return(t,r,s,i)=>{const l=e,d=c,R=v,M=b,T=h,N=n;var P;r(`<div${o.ssrRenderAttrs(a.mergeProps({class:"dashboard-terapeuta min-h-screen bg-gradient-to-br from-gray-50 via-white to-violet-50/30"},i))} data-v-ea049a3c><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8" data-v-ea049a3c><header class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8" data-v-ea049a3c><div data-v-ea049a3c><h1 class="text-3xl font-bold text-gray-900 tracking-tight" data-v-ea049a3c> Dashboard </h1><p class="text-gray-500 mt-1 flex items-center gap-2" data-v-ea049a3c><span data-v-ea049a3c>Bienvenida de nuevo,</span><span class="font-medium text-gray-700" data-v-ea049a3c>${o.ssrInterpolate(a.unref(p)?.nombre||"Karem")}</span><span class="text-xl" data-v-ea049a3c>üëã</span></p></div><div class="flex items-center gap-3" data-v-ea049a3c><button class="inline-flex items-center gap-2 px-5 py-2.5 bg-violet-600 text-white rounded-xl font-medium hover:bg-violet-700 transition-all shadow-lg shadow-violet-200 hover:shadow-violet-300 hover:-translate-y-0.5" data-v-ea049a3c><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-ea049a3c><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" data-v-ea049a3c></path></svg> Nueva Cita </button><button class="inline-flex items-center gap-2 px-5 py-2.5 bg-white text-gray-700 rounded-xl font-medium border border-gray-200 hover:border-violet-300 hover:text-violet-700 transition-all hover:-translate-y-0.5" data-v-ea049a3c><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-ea049a3c><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" data-v-ea049a3c></path></svg> Nuevo Paciente </button></div></header><div class="grid grid-cols-1 lg:grid-cols-3 gap-6 lg:gap-8" data-v-ea049a3c><section class="lg:col-span-2 bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden" data-v-ea049a3c><div class="flex items-center justify-between px-6 py-4 border-b border-gray-100 bg-gradient-to-r from-violet-50/50 to-transparent" data-v-ea049a3c><div class="flex items-center gap-3" data-v-ea049a3c><div class="w-10 h-10 rounded-xl bg-violet-100 flex items-center justify-center" data-v-ea049a3c><svg class="w-5 h-5 text-violet-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-ea049a3c><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" data-v-ea049a3c></path></svg></div><div data-v-ea049a3c><h2 class="text-lg font-semibold text-gray-900" data-v-ea049a3c>Pr√≥ximas Sesiones</h2><p class="text-sm text-gray-500" data-v-ea049a3c>${o.ssrInterpolate(a.unref(D))}</p></div></div>`),r(o.ssrRenderComponent(l,{to:"/terapeuta/agenda",class:"inline-flex items-center gap-1 text-sm font-medium text-violet-600 hover:text-violet-700 transition-colors"},{default:a.withCtx((e,t,r,o)=>{if(!t)return[a.createTextVNode(" Ver agenda "),(a.openBlock(),a.createBlock("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a.createVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})]))];t(` Ver agenda <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-ea049a3c${o}><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" data-v-ea049a3c${o}></path></svg>`)}),_:1},s)),r('</div><div class="p-4" data-v-ea049a3c>'),a.unref(u)?r('<div class="flex flex-col items-center justify-center py-12" data-v-ea049a3c><div class="w-10 h-10 border-3 border-violet-200 border-t-violet-600 rounded-full animate-spin mb-3" data-v-ea049a3c></div><p class="text-sm text-gray-500" data-v-ea049a3c>Cargando sesiones...</p></div>'):0===a.unref(g).length?r('<div class="flex flex-col items-center justify-center py-12 text-center" data-v-ea049a3c><div class="w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mb-4" data-v-ea049a3c><svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-ea049a3c><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" data-v-ea049a3c></path></svg></div><p class="text-gray-600 font-medium" data-v-ea049a3c>No hay sesiones programadas</p><p class="text-sm text-gray-400 mt-1" data-v-ea049a3c>Las pr√≥ximas citas aparecer√°n aqu√≠</p><button class="mt-4 px-4 py-2 text-sm font-medium text-violet-600 hover:text-violet-700 hover:bg-violet-50 rounded-lg transition-colors" data-v-ea049a3c> + Agendar una cita </button></div>'):(r('<div class="space-y-3" data-v-ea049a3c>\x3c!--[--\x3e'),o.ssrRenderList(a.unref(I),(e,a)=>{r(o.ssrRenderComponent(d,{key:e.id,id:e.id,hora:e.hora_inicio,"paciente-nombre":e.paciente_nombre,modalidad:e.modalidad,estado:e.estado,"is-next":0===a,onClick:abrirDetalles,onConfirmar:confirmarCitaRapido},null,s))}),r("\x3c!--]--\x3e"),a.unref(g).length>5&&!a.unref(_)?r(`<button class="w-full py-3 text-sm font-medium text-violet-600 hover:text-violet-700 hover:bg-violet-50 rounded-xl transition-colors flex items-center justify-center gap-2" data-v-ea049a3c><span data-v-ea049a3c>Ver ${o.ssrInterpolate(a.unref(g).length-5)} sesiones m√°s</span><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-ea049a3c><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" data-v-ea049a3c></path></svg></button>`):r("\x3c!----\x3e"),a.unref(_)&&a.unref(g).length>5?r('<button class="w-full py-3 text-sm font-medium text-gray-500 hover:text-gray-700 hover:bg-gray-50 rounded-xl transition-colors flex items-center justify-center gap-2" data-v-ea049a3c><span data-v-ea049a3c>Mostrar menos</span><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-ea049a3c><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" data-v-ea049a3c></path></svg></button>'):r("\x3c!----\x3e"),r("</div>")),r('</div></section><section class="bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden" data-v-ea049a3c><div class="flex items-center justify-between px-6 py-4 border-b border-gray-100 bg-gradient-to-r from-blue-50/50 to-transparent" data-v-ea049a3c><div class="flex items-center gap-3" data-v-ea049a3c><div class="w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center" data-v-ea049a3c><svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-ea049a3c><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" data-v-ea049a3c></path></svg></div><h2 class="text-lg font-semibold text-gray-900" data-v-ea049a3c>Pacientes</h2></div>'),r(o.ssrRenderComponent(l,{to:"/terapeuta/pacientes",class:"inline-flex items-center gap-1 text-sm font-medium text-blue-600 hover:text-blue-700 transition-colors"},{default:a.withCtx((e,t,r,o)=>{if(!t)return[a.createTextVNode(" Ver todos "),(a.openBlock(),a.createBlock("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a.createVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})]))];t(` Ver todos <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-ea049a3c${o}><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" data-v-ea049a3c${o}></path></svg>`)}),_:1},s)),r('</div><div class="p-4" data-v-ea049a3c>'),a.unref(m)?r('<div class="flex flex-col items-center justify-center py-8" data-v-ea049a3c><div class="w-8 h-8 border-2 border-blue-200 border-t-blue-600 rounded-full animate-spin mb-2" data-v-ea049a3c></div><p class="text-sm text-gray-500" data-v-ea049a3c>Cargando...</p></div>'):0===a.unref(x).length?r('<div class="flex flex-col items-center justify-center py-8 text-center" data-v-ea049a3c><div class="w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center mb-3" data-v-ea049a3c><svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-ea049a3c><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" data-v-ea049a3c></path></svg></div><p class="text-gray-500 text-sm" data-v-ea049a3c>Sin pacientes activos</p></div>'):(r('<div class="space-y-3" data-v-ea049a3c>\x3c!--[--\x3e'),o.ssrRenderList(a.unref(x),e=>{r(o.ssrRenderComponent(R,{key:e.id,id:e.id,nombre:e.nombre_completo,"ultima-sesion":e.ultima_sesion,"sesiones-usadas":e.sesiones_usadas,"sesiones-totales":e.sesiones_totales,"estado-bono":e.estado_bono,onClick:navegarAPaciente},null,s))}),r("\x3c!--]--\x3e</div>")),r('</div></section></div><div class="grid grid-cols-1 lg:grid-cols-3 gap-6 lg:gap-8 mt-8" data-v-ea049a3c><section class="lg:col-span-2 bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden" data-v-ea049a3c><div class="flex items-center gap-3 px-6 py-4 border-b border-gray-100" data-v-ea049a3c><div class="w-10 h-10 rounded-xl bg-gradient-to-br from-violet-100 to-purple-100 flex items-center justify-center" data-v-ea049a3c><svg class="w-5 h-5 text-violet-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-ea049a3c><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" data-v-ea049a3c></path></svg></div><h2 class="text-lg font-semibold text-gray-900" data-v-ea049a3c>Anal√≠tica del Profesional</h2></div><div class="p-6" data-v-ea049a3c><div class="grid grid-cols-2 lg:grid-cols-4 gap-4" data-v-ea049a3c>'),r(o.ssrRenderComponent(M,{value:a.unref(f),label:"Pacientes activos",icon:"üë•",variant:"blue"},null,s)),r(o.ssrRenderComponent(M,{value:a.unref(y),label:"Sesiones este mes",icon:"üìÖ",variant:"purple"},null,s)),r(o.ssrRenderComponent(M,{value:`${a.unref(w)}%`,label:"Asistencia promedio",icon:"‚úì",variant:"neutral"},null,s)),r(o.ssrRenderComponent(M,{value:`${P=a.unref($),P.toFixed(2)}‚Ç¨`,label:"Pagos confirmados",sublabel:`${a.unref(S)} ${1===a.unref(S)?"bono":"bonos"}`,icon:"üí∂",variant:"green",to:"/terapeuta/sesiones"},null,s)),r('</div></div></section><section class="bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden" data-v-ea049a3c><div class="flex items-center justify-between px-6 py-4 border-b border-gray-100" data-v-ea049a3c><div class="flex items-center gap-3" data-v-ea049a3c><div class="w-10 h-10 rounded-xl bg-amber-100 flex items-center justify-center" data-v-ea049a3c><svg class="w-5 h-5 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-ea049a3c><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" data-v-ea049a3c></path></svg></div><h2 class="text-lg font-semibold text-gray-900" data-v-ea049a3c>Recordatorios</h2></div>'),a.unref(B)?r("\x3c!----\x3e"):r('<button class="p-2 text-gray-400 hover:text-violet-600 hover:bg-violet-50 rounded-lg transition-colors" title="Actualizar recordatorios" data-v-ea049a3c><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-ea049a3c><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" data-v-ea049a3c></path></svg></button>'),r('</div><div class="p-4" data-v-ea049a3c>'),a.unref(B)?r('<div class="flex flex-col items-center justify-center py-8" data-v-ea049a3c><div class="w-8 h-8 border-2 border-amber-200 border-t-amber-600 rounded-full animate-spin mb-2" data-v-ea049a3c></div><p class="text-sm text-gray-500" data-v-ea049a3c>Cargando...</p></div>'):0===a.unref(V).length?r('<div class="flex flex-col items-center justify-center py-8 text-center" data-v-ea049a3c><div class="w-12 h-12 rounded-full bg-emerald-100 flex items-center justify-center mb-3" data-v-ea049a3c><svg class="w-6 h-6 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-ea049a3c><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" data-v-ea049a3c></path></svg></div><p class="text-gray-600 font-medium" data-v-ea049a3c>Todo al d√≠a</p><p class="text-sm text-gray-400 mt-1" data-v-ea049a3c>No hay recordatorios pendientes</p></div>'):(r('<div class="space-y-2" data-v-ea049a3c>\x3c!--[--\x3e'),o.ssrRenderList(a.unref(U),(e,a)=>{r(o.ssrRenderComponent(T,{key:e.id||a,id:e.id,tipo:e.tipo,mensaje:e.mensaje,paciente:e.paciente,fecha:e.fecha,hora:e.hora,urgente:e.urgente,accion:e.accion,onAccion:handleRecordatorioAccion},null,s))}),r("\x3c!--]--\x3e"),a.unref(V).length>4?r(`<button class="w-full py-2 text-sm font-medium text-gray-500 hover:text-gray-700 hover:bg-gray-50 rounded-lg transition-colors" data-v-ea049a3c>${o.ssrInterpolate(a.unref(j)?"Mostrar menos":`Ver ${a.unref(V).length-4} m√°s`)}</button>`):r("\x3c!----\x3e"),r("</div>")),r("</div></section></div></div>"),r(o.ssrRenderComponent(N,{"is-open":a.unref(C),"cita-id":a.unref(k),onClose:cerrarModalDetalles,onCitaActualizada:cargarSesiones,onActualizado:cargarSesiones},null,s)),r("</div>")}}}),w=y.setup;y.setup=(e,t)=>{const r=a.useSSRContext();return(r.modules||(r.modules=new Set)).add("pages/terapeuta/dashboard.vue"),w?w(e,t):void 0};const C=s(y,[["__scopeId","data-v-ea049a3c"]]);export{C as default};
//# sourceMappingURL=dashboard-CLhnCtMc.mjs.map
