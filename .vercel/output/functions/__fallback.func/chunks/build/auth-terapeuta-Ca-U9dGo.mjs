import{x as e}from"../nitro/nitro.mjs";import{k as r,e as o,n as t}from"./server.mjs";import{u as a}from"./useSupabaseClient-DykwVqLQ.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"entities/lib/decode.js";import"../routes/renderer.mjs";import"../_/shared.cjs.prod.mjs";import"estree-walker";import"source-map-js";import"node:stream";import"devalue";import"@supabase/ssr";import"@vercel/analytics/nuxt";const i=r(async(r,i)=>{let s,n;if(!r.path.startsWith("/terapeuta")||"/terapeuta/login"===r.path)return;const l=o(),p=a();if(!l.value)return console.log("[Middleware] Usuario no autenticado, redirigiendo a login"),t("/terapeuta/login",{replace:!0});try{const r=l.value?.id||l.value?.sub;if(!r)return console.error("[Middleware] No se pudo obtener el ID del usuario:",l.value),t("/terapeuta/login",{replace:!0});const{data:o,error:a}=([s,n]=e(()=>p.from("profiles").select("rol, nombre").eq("id",r).single()),s=await s,n(),s);if(a)return console.error("[Middleware] Error al obtener perfil:",a),t("/terapeuta/login",{replace:!0});const i=o?.rol;if(!i||!["terapeuta","psicologa","admin","coordinadora"].includes(i))return console.log(`[Middleware] Usuario con rol '${i}' sin acceso, redirigiendo a home`),t("/",{replace:!0});console.log(`[Middleware] Acceso autorizado para: ${o?.nombre||"profesional"} (${i})`)}catch(e){return console.error("[Middleware] Error inesperado:",e),t("/terapeuta/login",{replace:!0})}});export{i as default};
//# sourceMappingURL=auth-terapeuta-Ca-U9dGo.mjs.map
