import{defineComponent as a,ref as e,computed as r,watch as t,useSSRContext as d}from"vue";import{ssrRenderTeleport as o,ssrInterpolate as i,ssrRenderAttr as l,ssrRenderList as n,ssrRenderClass as s,ssrIncludeBooleanAttr as c,ssrLooseContain as v,ssrLooseEqual as u}from"vue/server-renderer";import{u as p}from"./useCitas-DyEZH6RI.mjs";import{u as g}from"./useSupabaseClient-DykwVqLQ.mjs";import{_ as b}from"./_plugin-vue_export-helper-1tPrXgE0.mjs";const f=a({__name:"ModalEditarCita",__ssrInlineRender:!0,props:{isOpen:{type:Boolean},citaId:{}},emits:["close","actualizado"],setup(a,{emit:d}){const b=a,f=g(),{getCitasPorDia:y}=p(),x=e(null),m=e(!1),h=e(!1),k=e(!1),w=e({fecha_cita:"",hora_inicio:"",hora_fin:"",duracion:60,modalidad:"presencial",estado:"pendiente",observaciones:""}),_=r(()=>{if(!w.value.fecha_cita)return"";return new Date(w.value.fecha_cita+"T00:00:00").toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}),$=r(()=>{const a=new Date,e=[],formatearFecha=a=>a.toISOString().split("T")[0];e.push({label:"Hoy",fecha:formatearFecha(a)});const r=new Date(a);r.setDate(r.getDate()+1),e.push({label:"MaÃ±ana",fecha:formatearFecha(r)});const t=["Lun","Mar","MiÃ©","Jue","Vie"];let d=new Date(a),o=0;for(;o<5;){d.setDate(d.getDate()+1);const a=d.getDay();a>=1&&a<=5&&(e.push({label:`${t[a-1]} ${d.getDate()}`,fecha:formatearFecha(d)}),o++)}return e}),C=["08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00","18:30","19:00","19:30","20:00","20:30","21:00","21:30","22:00"],cargarCita=async()=>{var a,e;if(console.log("ğŸ” [ModalEditarCita] Cargando cita con ID:",b.citaId),b.citaId)try{m.value=!0;const{data:r,error:t}=await f.from("citas").select("\n        *,\n        paciente:pacientes!citas_paciente_id_fkey (\n          id,\n          nombre_completo,\n          email,\n          telefono\n        )\n      ").eq("id",b.citaId).single();if(t)throw console.error("âŒ [ModalEditarCita] Error en query:",t),t;console.log("âœ… [ModalEditarCita] Cita cargada:",r),r&&(x.value=r,w.value={fecha_cita:r.fecha_cita,hora_inicio:(null==(a=r.hora_inicio)?void 0:a.substring(0,5))||"",hora_fin:(null==(e=r.hora_fin)?void 0:e.substring(0,5))||"",duracion:r.duracion||60,modalidad:r.modalidad||"presencial",estado:r.estado||"pendiente",observaciones:r.observaciones||""},console.log("ğŸ“ [ModalEditarCita] Formulario llenado:",w.value))}catch(a){console.error("ğŸ’¥ [ModalEditarCita] Error al cargar cita:",a)}finally{m.value=!1}else console.warn("âš ï¸ [ModalEditarCita] No hay citaId proporcionado")},horaAMinutos=a=>{if(!a||!a.includes(":"))return 0;const[e,r]=a.split(":").map(Number);return 60*(e||0)+(r||0)};return t(()=>w.value.hora_inicio,a=>{if(a&&w.value.duracion){const[e,r]=a.split(":").map(Number),t=60*(e||0)+(r||0)+w.value.duracion,d=Math.floor(t/60),o=t%60;w.value.hora_fin=`${String(d).padStart(2,"0")}:${String(o).padStart(2,"0")}`}}),t(()=>w.value.duracion,a=>{if(w.value.hora_inicio&&a){const[e,r]=w.value.hora_inicio.split(":").map(Number),t=60*(e||0)+(r||0)+a,d=Math.floor(t/60),o=t%60;w.value.hora_fin=`${String(d).padStart(2,"0")}:${String(o).padStart(2,"0")}`}}),t([()=>w.value.fecha_cita,()=>w.value.hora_inicio,()=>w.value.hora_fin],()=>{(async()=>{if(w.value.fecha_cita&&w.value.hora_inicio&&w.value.hora_fin)try{const a=(await y(w.value.fecha_cita)).filter(a=>"cancelada"!==a.estado&&a.id!==b.citaId),e=w.value.hora_inicio,r=w.value.hora_fin;k.value=a.some(a=>{var t,d;const o=null==(t=a.hora_inicio)?void 0:t.substring(0,5),i=null==(d=a.hora_fin)?void 0:d.substring(0,5),l=horaAMinutos(e),n=horaAMinutos(r),s=horaAMinutos(o),c=horaAMinutos(i);return l>=s&&l<c||n>s&&n<=c||l<=s&&n>=c})}catch(a){console.error("Error al verificar conflicto:",a),k.value=!1}else k.value=!1})()}),t(()=>b.isOpen,a=>{console.log("ğŸ‘ï¸ [ModalEditarCita] Modal abierto:",a,"citaId:",b.citaId),a&&b.citaId&&cargarCita()}),t(()=>b.citaId,a=>{console.log("ğŸ”„ [ModalEditarCita] citaId cambiÃ³ a:",a),b.isOpen&&a&&cargarCita()}),(e,r,t,d)=>{o(r,e=>{var r;a.isOpen?(e('<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" data-v-90d0f873><div class="bg-white dark:bg-gray-900 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden" data-v-90d0f873><div class="px-6 py-4 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20" data-v-90d0f873><div data-v-90d0f873><h2 class="text-2xl font-bold text-gray-900 dark:text-white" data-v-90d0f873>âœï¸ Editar Cita</h2>'),x.value?e(`<p class="text-sm text-gray-600 dark:text-gray-400 mt-1" data-v-90d0f873>${i((null==(r=x.value.paciente)?void 0:r.nombre_completo)||x.value.paciente_nombre)}</p>`):e("\x3c!----\x3e"),e('</div><button class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors" aria-label="Cerrar" data-v-90d0f873><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-90d0f873><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" data-v-90d0f873></path></svg></button></div>'),m.value?e('<div class="p-12 flex flex-col items-center justify-center" data-v-90d0f873><div class="w-12 h-12 border-4 border-purple-200 border-t-purple-600 rounded-full animate-spin mb-4" data-v-90d0f873></div><p class="text-gray-600 dark:text-gray-400" data-v-90d0f873>Cargando...</p></div>'):x.value?(e(`<form class="px-6 py-4 overflow-y-auto max-h-[calc(90vh-200px)]" data-v-90d0f873><div class="space-y-6" data-v-90d0f873><div data-v-90d0f873><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" data-v-90d0f873> ğŸ“… Fecha </label><div class="space-y-2" data-v-90d0f873><input${l("value",w.value.fecha_cita)} type="date" required class="w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-800 dark:text-white cursor-pointer" data-v-90d0f873><div class="flex gap-2 flex-wrap" data-v-90d0f873>\x3c!--[--\x3e`),n($.value,(a,r)=>{e(`<button type="button" class="${s(["text-xs px-3 py-1.5 rounded-lg border transition-all",w.value.fecha_cita===a.fecha?"bg-purple-600 text-white border-purple-600 font-semibold":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 border-gray-300 dark:border-gray-600 hover:border-purple-500 hover:bg-purple-50 dark:hover:bg-purple-900/20"])}" data-v-90d0f873>${i(a.label)}</button>`)}),e(`\x3c!--]--\x3e</div><p class="text-xs text-gray-500 dark:text-gray-400 capitalize" data-v-90d0f873>${i(_.value)}</p></div></div><div class="grid grid-cols-1 md:grid-cols-3 gap-4" data-v-90d0f873><div class="md:col-span-2" data-v-90d0f873><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" data-v-90d0f873> ğŸ• Hora Inicio </label><div class="space-y-3" data-v-90d0f873><div class="grid grid-cols-4 sm:grid-cols-6 gap-2 max-h-48 overflow-y-auto p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg border border-gray-200 dark:border-gray-700" data-v-90d0f873>\x3c!--[--\x3e`),n(C,a=>{e(`<button type="button" class="${s(["px-3 py-2 text-sm font-medium rounded-lg transition-all border-2",w.value.hora_inicio===a?"bg-purple-600 text-white border-purple-600 shadow-md transform scale-105":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 border-gray-200 dark:border-gray-600 hover:border-purple-500 hover:bg-purple-50 dark:hover:bg-purple-900/20 hover:shadow"])}" data-v-90d0f873>${i(a)}</button>`)}),e(`\x3c!--]--\x3e</div><details class="text-xs" data-v-90d0f873><summary class="cursor-pointer text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 select-none flex items-center gap-1" data-v-90d0f873><span data-v-90d0f873>âŒ¨ï¸</span><span data-v-90d0f873>Ingresar hora manualmente</span></summary><div class="mt-2" data-v-90d0f873><input${l("value",w.value.hora_inicio)} type="time" required step="1800" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-800 dark:text-white" data-v-90d0f873></div></details></div></div><div data-v-90d0f873><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" data-v-90d0f873> â±ï¸ DuraciÃ³n (min) </label><select class="w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-800 dark:text-white" data-v-90d0f873><option${l("value",30)} data-v-90d0f873${c(Array.isArray(w.value.duracion)?v(w.value.duracion,30):u(w.value.duracion,30))?" selected":""}>30 min</option><option${l("value",45)} data-v-90d0f873${c(Array.isArray(w.value.duracion)?v(w.value.duracion,45):u(w.value.duracion,45))?" selected":""}>45 min</option><option${l("value",60)} data-v-90d0f873${c(Array.isArray(w.value.duracion)?v(w.value.duracion,60):u(w.value.duracion,60))?" selected":""}>60 min</option><option${l("value",90)} data-v-90d0f873${c(Array.isArray(w.value.duracion)?v(w.value.duracion,90):u(w.value.duracion,90))?" selected":""}>90 min</option></select></div><div data-v-90d0f873><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" data-v-90d0f873> ğŸ•‘ Hora Fin </label><input${l("value",w.value.hora_fin)} type="time" required readonly step="1800" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-800 dark:text-white" data-v-90d0f873></div></div>`),k.value?e('<div class="p-4 bg-yellow-50 dark:bg-yellow-900/20 border-2 border-yellow-300 dark:border-yellow-700 rounded-lg" data-v-90d0f873><div class="flex items-start gap-3" data-v-90d0f873><span class="text-2xl" data-v-90d0f873>âš ï¸</span><div data-v-90d0f873><div class="font-semibold text-yellow-800 dark:text-yellow-300 mb-1" data-v-90d0f873> Conflicto de Horario </div><div class="text-sm text-yellow-700 dark:text-yellow-400" data-v-90d0f873> Ya existe otra cita en este horario. Por favor, selecciona otro horario. </div></div></div></div>'):e("\x3c!----\x3e"),e('<div data-v-90d0f873><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" data-v-90d0f873> ğŸ’» Modalidad </label><div class="grid grid-cols-3 gap-3" data-v-90d0f873>\x3c!--[--\x3e'),n([{valor:"presencial",icono:"ğŸ¥",nombre:"Presencial"},{valor:"online",icono:"ğŸ’»",nombre:"Online"},{valor:"telefonica",icono:"ğŸ“",nombre:"TelÃ©fono"}],a=>{e(`<button type="button" class="${s(["p-3 border-2 rounded-lg transition-all",w.value.modalidad===a.valor?"border-purple-600 bg-purple-50 dark:bg-purple-900/20":"border-gray-300 dark:border-gray-700 hover:border-purple-400"])}" data-v-90d0f873><div class="text-2xl mb-1" data-v-90d0f873>${i(a.icono)}</div><div class="text-sm font-medium text-gray-900 dark:text-white" data-v-90d0f873>${i(a.nombre)}</div></button>`)}),e('\x3c!--]--\x3e</div></div><div data-v-90d0f873><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" data-v-90d0f873> ğŸ“Š Estado </label><div class="grid grid-cols-2 md:grid-cols-4 gap-3" data-v-90d0f873>\x3c!--[--\x3e'),n([{valor:"pendiente",icono:"â³",nombre:"Pendiente"},{valor:"confirmada",icono:"âœ…",nombre:"Confirmada"},{valor:"realizada",icono:"âœ“",nombre:"Realizada"},{valor:"cancelada",icono:"âŒ",nombre:"Cancelada"}],a=>{e(`<button type="button" class="${s(["p-2 border-2 rounded-lg transition-all",w.value.estado===a.valor?"border-purple-600 bg-purple-50 dark:bg-purple-900/20":"border-gray-300 dark:border-gray-700 hover:border-purple-400"])}" data-v-90d0f873><div class="text-xl mb-1" data-v-90d0f873>${i(a.icono)}</div><div class="text-xs font-medium text-gray-900 dark:text-white" data-v-90d0f873>${i(a.nombre)}</div></button>`)}),e(`\x3c!--]--\x3e</div></div><div data-v-90d0f873><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" data-v-90d0f873> ğŸ“ Observaciones </label><textarea rows="3" placeholder="Notas adicionales sobre la cita..." class="w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-800 dark:text-white" data-v-90d0f873>${i(w.value.observaciones)}</textarea></div></div></form>`)):e("\x3c!----\x3e"),e(`<div class="px-6 py-4 border-t border-gray-200 dark:border-gray-800 flex gap-3 bg-gray-50 dark:bg-gray-800" data-v-90d0f873><button type="button" class="flex-1 px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors font-medium" data-v-90d0f873> Cancelar </button><button${c(h.value||k.value)?" disabled":""} class="${s(["flex-1 px-4 py-2 rounded-lg font-medium transition-colors",h.value||k.value?"bg-gray-400 dark:bg-gray-600 text-gray-200 cursor-not-allowed":"bg-purple-600 hover:bg-purple-700 text-white"])}" data-v-90d0f873>`),h.value?e("<span data-v-90d0f873>Guardando...</span>"):e("<span data-v-90d0f873>ğŸ’¾ Guardar Cambios</span>"),e("</button></div></div></div>")):e("\x3c!----\x3e")},"body",!1,t)}}}),y=f.setup;f.setup=(a,e)=>{const r=d();return(r.modules||(r.modules=new Set)).add("components/ModalEditarCita.vue"),y?y(a,e):void 0};const x=Object.assign(b(f,[["__scopeId","data-v-90d0f873"]]),{__name:"ModalEditarCita"});export{x as _};
//# sourceMappingURL=ModalEditarCita-Dnm8mnH7.mjs.map
