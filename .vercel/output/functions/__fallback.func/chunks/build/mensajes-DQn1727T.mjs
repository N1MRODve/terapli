import{v as e,e as r,s as t,_ as o}from"./server.mjs";import{u as s}from"./useSupabaseClient-DykwVqLQ.mjs";import{u as n}from"./useSupabase-CA5R4uuJ.mjs";import"entities/lib/decode.js";import"estree-walker";import"source-map-js";import"../nitro/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"../routes/renderer.mjs";import"@vue/compiler-dom";import"../_/shared.cjs.prod.mjs";import"@vue/compiler-ssr";import"node:stream";import"devalue";import"@supabase/ssr";import"@vercel/analytics/nuxt";const a=e.defineComponent({__name:"mensajes",__ssrInlineRender:!0,setup(a){const l=s();r();const{getUserId:i}=n(),d=e.ref([]),c=e.ref(null),p=e.ref(""),obtenerIniciales=e=>e.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2),enviarMensajeInterno=async()=>{if(p.value.trim()&&c.value)try{const e=i();if(!e)return void alert("❌ No estás autenticado");const{error:r}=await l.from("mensajes").insert({remitente_id:e,destinatario_id:c.value.id,mensaje:p.value,visto:!1});if(r)throw r;alert("✅ Mensaje enviado exitosamente"),p.value=""}catch(e){console.error("Error:",e),alert("❌ Error al enviar mensaje")}},abrirWhatsApp=()=>{if(!p.value.trim()||!c.value.telefono)return;const e=c.value.telefono.replace(/\D/g,""),r=encodeURIComponent(p.value);(void 0).open(`https://wa.me/${e}?text=${r}`,"_blank")};return(r,s,n,a)=>{const l=o,i=e.resolveComponent("Icon");s(`<div${t.ssrRenderAttrs(a)}>`),s(t.ssrRenderComponent(l,{name:"coordinacion"},{default:e.withCtx((r,o,s,n)=>{if(!o)return[e.createVNode("div",{class:"mb-8"},[e.createVNode("h1",{class:"text-3xl font-lora font-bold text-[#5D4A44] mb-2"}," Mensajería "),e.createVNode("p",{class:"text-[#8B7470]"}," Comunicación con pacientes y terapeutas ")]),e.createVNode("div",{class:"bg-white rounded-xl shadow-md border border-[#E8DFD8] p-6 mb-6"},[e.createVNode("label",{class:"block text-sm font-medium text-[#5D4A44] mb-3"}," Seleccionar paciente "),e.withDirectives(e.createVNode("select",{"onUpdate:modelValue":r=>e.isRef(c)?c.value=r:null,class:"w-full px-4 py-3 border border-[#E8DFD8] rounded-lg focus:ring-2 focus:ring-[#D8AFA0] focus:border-transparent"},[e.createVNode("option",{value:""},"-- Selecciona un paciente --"),(e.openBlock(!0),e.createBlock(e.Fragment,null,e.renderList(e.unref(d),r=>(e.openBlock(),e.createBlock("option",{key:r.id,value:r},e.toDisplayString(r.nombre),9,["value"]))),128))],8,["onUpdate:modelValue"]),[[e.vModelSelect,e.unref(c)]])]),e.unref(c)?(e.openBlock(),e.createBlock("div",{key:0,class:"bg-white rounded-xl shadow-md border border-[#E8DFD8] p-6"},[e.createVNode("div",{class:"mb-4 flex items-center space-x-3"},[e.createVNode("div",{class:"w-12 h-12 rounded-full bg-gradient-to-br from-[#D8AFA0] to-[#C49484] flex items-center justify-center"},[e.createVNode("span",{class:"text-white font-semibold"},e.toDisplayString(obtenerIniciales(e.unref(c).nombre)),1)]),e.createVNode("div",null,[e.createVNode("p",{class:"font-semibold text-[#5D4A44]"},e.toDisplayString(e.unref(c).nombre),1),e.createVNode("p",{class:"text-sm text-[#8B7470]"},e.toDisplayString(e.unref(c).telefono),1)])]),e.withDirectives(e.createVNode("textarea",{"onUpdate:modelValue":r=>e.isRef(p)?p.value=r:null,placeholder:"Escribe tu mensaje aquí...",rows:"5",class:"w-full px-4 py-3 border border-[#E8DFD8] rounded-lg focus:ring-2 focus:ring-[#D8AFA0] focus:border-transparent resize-none mb-4"},null,8,["onUpdate:modelValue"]),[[e.vModelText,e.unref(p)]]),e.createVNode("div",{class:"flex space-x-3"},[e.createVNode("button",{onClick:enviarMensajeInterno,disabled:!e.unref(p).trim(),class:"flex-1 px-6 py-3 bg-[#D8AFA0] text-white rounded-lg hover:bg-[#C49484] transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[e.createVNode(i,{name:"heroicons:paper-airplane",class:"w-5 h-5"}),e.createVNode("span",null,"Enviar mensaje interno")],8,["disabled"]),e.createVNode("button",{onClick:abrirWhatsApp,disabled:!e.unref(p).trim(),class:"flex-1 px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[e.createVNode(i,{name:"heroicons:chat-bubble-oval-left-ellipsis",class:"w-5 h-5"}),e.createVNode("span",null,"Abrir WhatsApp")],8,["disabled"])])])):(e.openBlock(),e.createBlock("div",{key:1,class:"bg-white rounded-xl shadow-md border border-[#E8DFD8] p-12 text-center"},[e.createVNode(i,{name:"heroicons:chat-bubble-left-right",class:"w-20 h-20 mx-auto text-[#D8AFA0] opacity-30 mb-4"}),e.createVNode("p",{class:"text-[#8B7470]"},"Selecciona un paciente para comenzar")]))];o(`<div class="mb-8"${n}><h1 class="text-3xl font-lora font-bold text-[#5D4A44] mb-2"${n}> Mensajería </h1><p class="text-[#8B7470]"${n}> Comunicación con pacientes y terapeutas </p></div><div class="bg-white rounded-xl shadow-md border border-[#E8DFD8] p-6 mb-6"${n}><label class="block text-sm font-medium text-[#5D4A44] mb-3"${n}> Seleccionar paciente </label><select class="w-full px-4 py-3 border border-[#E8DFD8] rounded-lg focus:ring-2 focus:ring-[#D8AFA0] focus:border-transparent"${n}><option value=""${t.ssrIncludeBooleanAttr(Array.isArray(e.unref(c))?t.ssrLooseContain(e.unref(c),""):t.ssrLooseEqual(e.unref(c),""))?" selected":""}${n}>-- Selecciona un paciente --</option>\x3c!--[--\x3e`),t.ssrRenderList(e.unref(d),r=>{o(`<option${t.ssrRenderAttr("value",r)}${t.ssrIncludeBooleanAttr(Array.isArray(e.unref(c))?t.ssrLooseContain(e.unref(c),r):t.ssrLooseEqual(e.unref(c),r))?" selected":""}${n}>${t.ssrInterpolate(r.nombre)}</option>`)}),o("\x3c!--]--\x3e</select></div>"),e.unref(c)?(o(`<div class="bg-white rounded-xl shadow-md border border-[#E8DFD8] p-6"${n}><div class="mb-4 flex items-center space-x-3"${n}><div class="w-12 h-12 rounded-full bg-gradient-to-br from-[#D8AFA0] to-[#C49484] flex items-center justify-center"${n}><span class="text-white font-semibold"${n}>${t.ssrInterpolate(obtenerIniciales(e.unref(c).nombre))}</span></div><div${n}><p class="font-semibold text-[#5D4A44]"${n}>${t.ssrInterpolate(e.unref(c).nombre)}</p><p class="text-sm text-[#8B7470]"${n}>${t.ssrInterpolate(e.unref(c).telefono)}</p></div></div><textarea placeholder="Escribe tu mensaje aquí..." rows="5" class="w-full px-4 py-3 border border-[#E8DFD8] rounded-lg focus:ring-2 focus:ring-[#D8AFA0] focus:border-transparent resize-none mb-4"${n}>${t.ssrInterpolate(e.unref(p))}</textarea><div class="flex space-x-3"${n}><button${t.ssrIncludeBooleanAttr(!e.unref(p).trim())?" disabled":""} class="flex-1 px-6 py-3 bg-[#D8AFA0] text-white rounded-lg hover:bg-[#C49484] transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"${n}>`),o(t.ssrRenderComponent(i,{name:"heroicons:paper-airplane",class:"w-5 h-5"},null,s,n)),o(`<span${n}>Enviar mensaje interno</span></button><button${t.ssrIncludeBooleanAttr(!e.unref(p).trim())?" disabled":""} class="flex-1 px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"${n}>`),o(t.ssrRenderComponent(i,{name:"heroicons:chat-bubble-oval-left-ellipsis",class:"w-5 h-5"},null,s,n)),o(`<span${n}>Abrir WhatsApp</span></button></div></div>`)):(o(`<div class="bg-white rounded-xl shadow-md border border-[#E8DFD8] p-12 text-center"${n}>`),o(t.ssrRenderComponent(i,{name:"heroicons:chat-bubble-left-right",class:"w-20 h-20 mx-auto text-[#D8AFA0] opacity-30 mb-4"},null,s,n)),o(`<p class="text-[#8B7470]"${n}>Selecciona un paciente para comenzar</p></div>`))}),_:1},n)),s("</div>")}}}),l=a.setup;a.setup=(r,t)=>{const o=e.useSSRContext();return(o.modules||(o.modules=new Set)).add("pages/coordinacion/mensajes.vue"),l?l(r,t):void 0};export{a as default};
//# sourceMappingURL=mensajes-DQn1727T.mjs.map
