import{a as e,e as t,v as a,s as r}from"./server.mjs";import{r as s}from"./PencilIcon-BKWXEWgS.mjs";import{r as n}from"./TicketIcon-zZdrc71S.mjs";import{r as o}from"./TrashIcon-3HGFGGDp.mjs";import{r as l}from"./ExclamationTriangleIcon-DQdM2y0F.mjs";import{r as d}from"./ClockIcon-BxdFtPqx.mjs";import{r as i}from"./CalendarIcon-BrsGHJBC.mjs";import{r as c}from"./ExclamationCircleIcon-DhXgUVTW.mjs";import{r as u}from"./BellAlertIcon-DDdTQQDY.mjs";import{r as p,a as m,b as v}from"./EyeIcon-DitB8rgo.mjs";import{_ as b}from"./ModalNuevaCita-CAxtnDaO.mjs";import{u as f}from"./useSupabase-DfFg84CY.mjs";import{u as x}from"./useBonos-B2-LOzOF.mjs";import{u as g}from"./useCitas-DyEZH6RI.mjs";import{u as h}from"./useToast-CW-71pJZ.mjs";import{_ as y}from"./_plugin-vue_export-helper-1tPrXgE0.mjs";import{u as w}from"./useSupabaseClient-DykwVqLQ.mjs";import{r as _}from"./CheckCircleIcon-CT9fzVFs.mjs";import{r as C}from"./XCircleIcon-Cr4IlpzV.mjs";import{r as $}from"./XMarkIcon-DCLwyE-W.mjs";import{r as R}from"./DocumentTextIcon-O51EkPyw.mjs";import{r as I}from"./CalendarDaysIcon-f8DhK37e.mjs";import{r as k}from"./EnvelopeIcon-DxfgYjQB.mjs";import{r as A}from"./PhoneIcon-acGzPaDV.mjs";import{L as D,D as S}from"./index-CBInS3QI.mjs";import{Chart as E,CategoryScale as F,LinearScale as B,PointElement as P,LineElement as j,ArcElement as M,Title as L,Tooltip as q,Legend as V,Filler as T}from"chart.js";import{r as z}from"./ChartBarIcon-BEEST7f0.mjs";import{r as N}from"./PlusIcon-CHLzv-V9.mjs";import{r as O}from"./UserGroupIcon-BhthmHUw.mjs";import{r as H}from"./ClipboardDocumentListIcon-tIc_vSd1.mjs";import{r as G}from"./MagnifyingGlassIcon-GsbNDyPZ.mjs";import{r as Q}from"./FunnelIcon-y4UDP9oS.mjs";import{r as U}from"./ChevronDownIcon-CvdhRGll.mjs";import{r as W}from"./CurrencyDollarIcon-COwB3mCA.mjs";import{r as Z}from"./ChevronRightIcon-4xxNHuWW.mjs";import"../routes/renderer.mjs";import"../nitro/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"../_/shared.cjs.prod.mjs";import"../virtual/_commonjsHelpers.mjs";import"node:stream";import"../_/index2.mjs";import"@supabase/supabase-js";import"@vercel/analytics/nuxt";import"./UserIcon-CrHYaeI9.mjs";import"./CheckBadgeIcon-DjhxLc-3.mjs";function render$6(e,t){return a.openBlock(),a.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[a.createElementVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75"})])}function render$5(e,t){return a.openBlock(),a.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[a.createElementVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})])}function render$4(e,t){return a.openBlock(),a.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[a.createElementVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M11.35 3.836c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m8.9-4.414c.376.023.75.05 1.124.08 1.131.094 1.976 1.057 1.976 2.192V16.5A2.25 2.25 0 0 1 18 18.75h-2.25m-7.5-10.5H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V18.75m-7.5-10.5h6.375c.621 0 1.125.504 1.125 1.125v9.375m-8.25-3 1.5 1.5 3-3.75"})])}function render$3(e,t){return a.openBlock(),a.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[a.createElementVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m.75 12 3 3m0 0 3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})])}function render$2(e,t){return a.openBlock(),a.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[a.createElementVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3.75 9.776c.112-.017.227-.026.344-.026h15.812c.117 0 .232.009.344.026m-16.5 0a2.25 2.25 0 0 0-1.883 2.542l.857 6a2.25 2.25 0 0 0 2.227 1.932H19.05a2.25 2.25 0 0 0 2.227-1.932l.857-6a2.25 2.25 0 0 0-1.883-2.542m-16.5 0V6A2.25 2.25 0 0 1 6 3.75h3.879a1.5 1.5 0 0 1 1.06.44l2.122 2.12a1.5 1.5 0 0 0 1.06.44H18A2.25 2.25 0 0 1 20.25 9v.776"})])}function render$1(e,t){return a.openBlock(),a.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[a.createElementVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6a2.25 2.25 0 0 1-2.25-2.25V6ZM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25V18a2.25 2.25 0 0 1-2.25 2.25H6A2.25 2.25 0 0 1 3.75 18v-2.25ZM13.5 6a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 6v2.25A2.25 2.25 0 0 1 18 10.5h-2.25a2.25 2.25 0 0 1-2.25-2.25V6ZM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25H18a2.25 2.25 0 0 1 2.25 2.25V18A2.25 2.25 0 0 1 18 20.25h-2.25A2.25 2.25 0 0 1 13.5 18v-2.25Z"})])}function render(e,t){return a.openBlock(),a.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[a.createElementVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 0 1-1.125-1.125M3.375 19.5h7.5c.621 0 1.125-.504 1.125-1.125m-9.75 0V5.625m0 12.75v-1.5c0-.621.504-1.125 1.125-1.125m18.375 2.625V5.625m0 12.75c0 .621-.504 1.125-1.125 1.125m1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125m0 3.75h-7.5A1.125 1.125 0 0 1 12 18.375m9.75-12.75c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125m19.5 0v1.5c0 .621-.504 1.125-1.125 1.125M2.25 5.625v1.5c0 .621.504 1.125 1.125 1.125m0 0h17.25m-17.25 0h7.5c.621 0 1.125.504 1.125 1.125M3.375 8.25c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125m17.25-3.75h-7.5c-.621 0-1.125.504-1.125 1.125m8.625-1.125c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125m-17.25 0h7.5m-7.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125M12 10.875v-1.5m0 1.5c0 .621-.504 1.125-1.125 1.125M12 10.875c0 .621.504 1.125 1.125 1.125m-2.25 0c.621 0 1.125.504 1.125 1.125M13.125 12h7.5m-7.5 0c-.621 0-1.125.504-1.125 1.125M20.625 12c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125m-17.25 0h7.5M12 14.625v-1.5m0 1.5c0 .621-.504 1.125-1.125 1.125M12 14.625c0 .621.504 1.125 1.125 1.125m-2.25 0c.621 0 1.125.504 1.125 1.125m0 1.5v-1.5m0 0c0-.621.504-1.125 1.125-1.125m0 0h7.5"})])}const X={__name:"PacienteCard",__ssrInlineRender:!0,props:{paciente:{type:Object,required:!0}},emits:["editar","eliminar","ver-citas","gestionar-bonos","editar-cita","ver-ficha"],setup(e,{emit:t}){const p=e,m=a.ref(!1),v=a.computed(()=>{const e=p.paciente.nombre||"Sin nombre";if("Sin nombre"===e)return"Sin nombre";const t=e.trim().split(" ");return t.length>2?`${t[0]} ${t[1]} ${t[t.length-1].charAt(0)}.`:e}),b=a.computed(()=>{const e=p.paciente.nombre||"";if(!e)return"??";const t=e.trim().split(" ");return`${t[0]?.charAt(0)||"?"}${t[1]?.charAt(0)||""}`.toUpperCase()}),f=a.computed(()=>{if(!p.paciente.activo)return"#9CA3AF";if(p.paciente.en_pausa)return"#F59E0B";const e=["#8B5CF6","#EC4899","#06B6D4","#10B981","#6366F1","#F97316"];return e[p.paciente.id.charCodeAt(0)%e.length]}),x=a.computed(()=>p.paciente.activo?p.paciente.en_pausa?"ring-amber-300":"ring-purple-200":"ring-gray-300"),g=a.computed(()=>p.paciente.activo?p.paciente.en_pausa?"bg-amber-500":"bg-green-500":"bg-gray-400"),h=a.computed(()=>p.paciente.activo?p.paciente.en_pausa?"Pausa":"Activo":"Finalizado"),y=a.computed(()=>p.paciente.activo?p.paciente.en_pausa?"bg-amber-100 text-amber-700":"bg-green-100 text-green-700":"bg-gray-100 text-gray-600"),w=a.computed(()=>{if(!p.paciente.ultima_sesion)return"Sin registro";const e=new Date(p.paciente.ultima_sesion),t=new Date,a=Math.floor((t-e)/864e5);return 0===a?"Hoy":1===a?"Ayer":a<7?`Hace ${a} d√≠as`:a<30?`Hace ${Math.floor(a/7)} sem`:e.toLocaleDateString("es-ES",{day:"numeric",month:"short"})}),_=a.computed(()=>{if(!p.paciente.ultima_sesion)return"bg-gray-300";const e=I.value;return e<=7?"bg-green-500":e<=14?"bg-blue-500":e<=30?"bg-amber-500":"bg-red-500"}),C=a.computed(()=>{if(!p.paciente.ultima_sesion)return"text-gray-400";const e=I.value;return e<=14?"text-gray-600":e<=30?"text-amber-600":"text-red-600 font-medium"}),$=a.computed(()=>{if(!p.paciente.proxima_sesion)return null;try{let e=p.paciente.proxima_sesion;e.includes("T")||(e+="T00:00:00");const t=new Date(e);return isNaN(t.getTime())?null:t.toLocaleDateString("es-ES",{weekday:"short",day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})}catch{return null}}),R=a.computed(()=>p.paciente.total_sesiones||0),I=a.computed(()=>{if(!p.paciente.ultima_sesion)return 0;const e=new Date(p.paciente.ultima_sesion),t=new Date;return Math.floor((t-e)/864e5)}),k=a.computed(()=>!(!p.paciente.activo||p.paciente.en_pausa)&&I.value>30),A=a.computed(()=>p.paciente.bono_activo||null),D=a.computed(()=>{if(!A.value?.tipo)return"";return{otro:"Demanda",quincenal:"Quinc.",semanal:"Semanal",mensual:"Mensual"}[A.value.tipo]||A.value.tipo}),S=a.computed(()=>A.value?.sesiones_totales||0),E=a.computed(()=>A.value?S.value-A.value.sesiones_restantes:0),F=a.computed(()=>A.value&&0!==S.value?Math.round(E.value/S.value*100):0),B=a.computed(()=>{if(!A.value)return"bg-gray-400";const e=A.value.sesiones_restantes;return 0===e||1===e?"bg-red-500":2===e?"bg-amber-500":"bg-purple-500"}),P=a.computed(()=>{if(!A.value)return"bg-gray-50";const e=A.value.sesiones_restantes;return 0===e||1===e?"bg-red-50 border border-red-100":2===e?"bg-amber-50 border border-amber-100":"bg-purple-50 border border-purple-100"}),j=a.computed(()=>{if(!A.value)return"text-gray-600";const e=A.value.sesiones_restantes;return 0===e?"text-red-600":e<=2?"text-amber-600":"text-gray-700"}),M=a.computed(()=>{if(!A.value)return"text-gray-400";const e=A.value.sesiones_restantes;return e<=1?"text-red-500":2===e?"text-amber-500":"text-purple-500"}),L=a.computed(()=>{if(!A.value?.fecha_fin)return"‚Äî";try{return new Date(A.value.fecha_fin).toLocaleDateString("es-ES",{day:"numeric",month:"short"})}catch{return"‚Äî"}}),q=a.computed(()=>{if(!A.value?.fecha_fin)return"‚Äî";try{const e=new Date(A.value.fecha_fin),t=new Date,a=Math.floor((e-t)/864e5);return a<0?"Vencido":0===a?"Vence hoy":1===a?"Vence ma√±ana":a<=7?`Vence en ${a}d`:`Hasta ${L.value}`}catch{return"‚Äî"}}),V=a.computed(()=>{if(!A.value?.fecha_fin)return"text-gray-400";const e=new Date(A.value.fecha_fin),t=new Date,a=Math.floor((e-t)/864e5);return a<0?"text-red-600 font-medium":a<=7?"text-amber-600 font-medium":"text-gray-500"}),T=a.computed(()=>!!A.value&&1===A.value.sesiones_restantes),z=a.computed(()=>!!A.value&&2===A.value.sesiones_restantes),N=a.computed(()=>T.value||z.value||k.value);return(t,p,S,L)=>{p(`<article${r.ssrRenderAttrs(a.mergeProps({class:"bg-white rounded-xl border border-gray-100 p-4 hover:shadow-lg hover:border-purple-200 transition-all duration-200 group relative cursor-pointer focus-within:ring-2 focus-within:ring-purple-500 focus-within:ring-offset-2",role:"article","aria-label":`Ficha de ${a.unref(v)}`,tabindex:"0"},L))}><div class="absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 group-focus-within:opacity-100 transition-all duration-200 z-10" role="toolbar"><button class="w-8 h-8 p-1.5 bg-white text-gray-600 rounded-lg hover:bg-purple-50 hover:text-purple-600 transition-colors shadow-sm border border-gray-200" title="Editar paciente">`),p(r.ssrRenderComponent(a.unref(s),{class:"w-full h-full"},null,S)),p('</button><button class="w-8 h-8 p-1.5 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors shadow-sm" title="Gestionar bonos">'),p(r.ssrRenderComponent(a.unref(n),{class:"w-full h-full"},null,S)),p('</button><button class="w-6 h-6 p-1 bg-gray-50 text-gray-400 rounded hover:bg-red-50 hover:text-red-500 transition-colors ml-1" title="Eliminar">'),p(r.ssrRenderComponent(a.unref(o),{class:"w-full h-full"},null,S)),p("</button></div>"),a.unref(m)?(p('<div class="absolute top-0 left-0 right-0 bottom-0 bg-white/95 backdrop-blur-sm rounded-xl flex flex-col items-center justify-center z-20 p-4">'),p(r.ssrRenderComponent(a.unref(l),{class:"w-8 h-8 text-red-500 mb-2"},null,S)),p(`<p class="text-sm text-gray-700 text-center mb-3">¬øEliminar a ${r.ssrInterpolate(a.unref(v))}?</p><div class="flex gap-2"><button class="px-3 py-1.5 text-sm text-gray-600 hover:text-gray-800 transition-colors"> Cancelar </button><button class="px-3 py-1.5 text-sm bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors"> Eliminar </button></div></div>`)):p("\x3c!----\x3e"),p(`<div class="flex items-start gap-3 mb-3"><div class="relative flex-shrink-0"><div class="${r.ssrRenderClass([a.unref(x),"w-12 h-12 rounded-full flex items-center justify-center text-white font-bold text-lg ring-2 ring-offset-1"])}" style="${r.ssrRenderStyle({backgroundColor:a.unref(f)})}">${r.ssrInterpolate(a.unref(b))}</div><span class="${r.ssrRenderClass([a.unref(g),"absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 rounded-full border-2 border-white"])}"></span></div><div class="flex-1 min-w-0 pt-0.5"><h3 class="font-semibold text-gray-900 text-base leading-tight truncate pr-16">${r.ssrInterpolate(a.unref(v))}</h3><div class="flex items-center gap-2 mt-1"><span class="${r.ssrRenderClass([a.unref(y),"inline-flex items-center px-2 py-0.5 text-xs font-medium rounded-full"])}">${r.ssrInterpolate(a.unref(h))}</span>`),e.paciente.area_de_acompanamiento?p(`<span class="text-xs text-gray-400 truncate">${r.ssrInterpolate(e.paciente.area_de_acompanamiento)}</span>`):p("\x3c!----\x3e"),p(`</div></div></div><div class="${r.ssrRenderClass([a.unref($)?"bg-purple-50 border border-purple-100":"bg-amber-50 border border-amber-100","mb-3 p-2.5 rounded-lg"])}"><div class="flex items-center gap-2">`),p(r.ssrRenderComponent(a.unref(d),{class:["w-4 h-4 flex-shrink-0",a.unref($)?"text-purple-500":"text-amber-500"]},null,S)),p('<div class="flex-1 min-w-0"><p class="text-xs text-gray-500 mb-0.5">Pr√≥xima cita</p>'),a.unref($)?p(`<button class="text-sm font-semibold text-purple-700 hover:text-purple-800 transition-colors truncate block w-full text-left">${r.ssrInterpolate(a.unref($))}</button>`):p('<p class="text-sm font-medium text-amber-700">Sin cita programada</p>'),p(`</div></div></div><div class="grid grid-cols-2 gap-2 text-xs"><div class="flex items-center gap-1.5"><div class="${r.ssrRenderClass([a.unref(_),"w-2 h-2 rounded-full flex-shrink-0"])}"></div>`),p(r.ssrRenderComponent(a.unref(i),{class:"w-3.5 h-3.5 text-gray-400"},null,S)),p(`<span class="${r.ssrRenderClass(a.unref(C))}">${r.ssrInterpolate(a.unref(w))}</span></div><div class="flex items-center gap-1.5 text-gray-500 justify-end"><span>${r.ssrInterpolate(a.unref(R))} sesiones</span></div>`),a.unref(A)?(p(`<div class="${r.ssrRenderClass([a.unref(P),"col-span-2 mt-2 p-2 rounded-lg"])}"><div class="flex items-center justify-between mb-1.5"><div class="flex items-center gap-1.5">`),p(r.ssrRenderComponent(a.unref(n),{class:["w-3.5 h-3.5 flex-shrink-0",a.unref(M)]},null,S)),p(`<span class="${r.ssrRenderClass([a.unref(j),"font-medium text-xs"])}">${r.ssrInterpolate(a.unref(D))}</span></div><div class="flex items-center gap-1.5"><span class="${r.ssrRenderClass([a.unref(V),"text-xs"])}">${r.ssrInterpolate(a.unref(q))}</span></div></div><div class="relative h-2 bg-gray-200 rounded-full overflow-hidden"><div class="${r.ssrRenderClass([a.unref(B),"absolute left-0 top-0 h-full rounded-full transition-all duration-300"])}" style="${r.ssrRenderStyle({width:a.unref(F)+"%"})}"></div></div><div class="flex justify-between mt-1"><span class="${r.ssrRenderClass([a.unref(j),"text-[10px]"])}">${r.ssrInterpolate(a.unref(E))} usadas </span><span class="${r.ssrRenderClass([a.unref(j),"text-[10px] font-semibold"])}">${r.ssrInterpolate(a.unref(A).sesiones_restantes)} restantes </span></div></div>`)):p("\x3c!----\x3e"),p("</div>"),a.unref(N)?(p('<div class="mt-2.5 pt-2.5 border-t border-gray-100">'),a.unref(T)?(p('<div class="flex items-center gap-1.5 px-2 py-1.5 bg-red-50 rounded-md text-xs">'),p(r.ssrRenderComponent(a.unref(l),{class:"w-3.5 h-3.5 text-red-500"},null,S)),p('<span class="text-red-700 font-medium">√öltima sesi√≥n del bono</span></div>')):a.unref(z)?(p('<div class="flex items-center gap-1.5 px-2 py-1.5 bg-amber-50 rounded-md text-xs">'),p(r.ssrRenderComponent(a.unref(c),{class:"w-3.5 h-3.5 text-amber-500"},null,S)),p(`<span class="text-amber-700 font-medium">${r.ssrInterpolate(a.unref(A).sesiones_restantes)} sesiones restantes</span></div>`)):a.unref(k)?(p('<div class="flex items-center gap-1.5 px-2 py-1.5 bg-red-50 rounded-md text-xs">'),p(r.ssrRenderComponent(a.unref(u),{class:"w-3.5 h-3.5 text-red-500"},null,S)),p(`<span class="text-red-700 font-medium">${r.ssrInterpolate(a.unref(I))} d√≠as sin sesi√≥n</span></div>`)):p("\x3c!----\x3e"),p("</div>")):p("\x3c!----\x3e"),p("</article>")}}},Y=X.setup;X.setup=(e,t)=>{const r=a.useSSRContext();return(r.modules||(r.modules=new Set)).add("components/PacienteCard.vue"),Y?Y(e,t):void 0};const J={__name:"PacienteTabla",__ssrInlineRender:!0,props:{pacientes:{type:Array,required:!0}},emits:["ver-ficha","editar","gestionar-bonos","ver-preview"],setup(e){const getAvatarColor=e=>{if(!e.activo)return"#9CA3AF";if(e.en_pausa)return"#F59E0B";const t=["#8B5CF6","#EC4899","#06B6D4","#10B981","#6366F1","#F97316"];return t[e.id.charCodeAt(0)%t.length]},getEstadoClasses=e=>e.activo?e.en_pausa?"bg-amber-100 text-amber-700":"bg-green-100 text-green-700":"bg-gray-100 text-gray-600",getDiasInactividad=e=>{if(!e.ultima_sesion)return 999;const t=new Date(e.ultima_sesion),a=new Date;return Math.floor((a-t)/864e5)},getUltimaSesionIndicador=e=>{if(!e.ultima_sesion)return"bg-gray-300";const t=getDiasInactividad(e);return t<=7?"bg-green-500":t<=14?"bg-blue-500":t<=30?"bg-amber-500":"bg-red-500"},getUltimaSesionTextClass=e=>{if(!e.ultima_sesion)return"text-gray-400";const t=getDiasInactividad(e);return t<=14?"text-gray-600":t<=30?"text-amber-600":"text-red-600 font-medium"},getBonoPercent=e=>{if(!e||0===e.sesiones_totales)return 0;const t=e.sesiones_totales-e.sesiones_restantes;return Math.round(t/e.sesiones_totales*100)},getBonoTextClass=e=>e?e.sesiones_restantes<=1?"text-red-600":2===e.sesiones_restantes?"text-amber-600":"text-gray-700":"text-gray-600";return(t,o,l,d)=>{o(`<div${r.ssrRenderAttrs(a.mergeProps({class:"overflow-x-auto"},d))}><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> Paciente </th><th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> Estado </th><th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> Pr√≥xima cita </th><th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> √öltima sesi√≥n </th><th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> Bono </th><th scope="col" class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"> Acciones </th></tr></thead><tbody class="bg-white divide-y divide-gray-100">\x3c!--[--\x3e`),r.ssrRenderList(e.pacientes,e=>{var t;o(`<tr class="hover:bg-gray-50 cursor-pointer transition-colors"><td class="px-4 py-3 whitespace-nowrap"><div class="flex items-center gap-3"><div class="w-8 h-8 rounded-full flex items-center justify-center text-white text-xs font-bold flex-shrink-0" style="${r.ssrRenderStyle({backgroundColor:getAvatarColor(e)})}">${r.ssrInterpolate((e=>{if(!e)return"??";const t=e.trim().split(" ");return`${t[0]?.charAt(0)||"?"}${t[1]?.charAt(0)||""}`.toUpperCase()})(e.nombre))}</div><div class="min-w-0"><p class="text-sm font-medium text-gray-900 truncate max-w-[200px]">${r.ssrInterpolate(e.nombre||"Sin nombre")}</p>`),e.area_de_acompanamiento?o(`<p class="text-xs text-gray-500 truncate max-w-[200px]">${r.ssrInterpolate(e.area_de_acompanamiento)}</p>`):o("\x3c!----\x3e"),o(`</div></div></td><td class="px-4 py-3 whitespace-nowrap"><span class="${r.ssrRenderClass([getEstadoClasses(e),"inline-flex items-center px-2 py-0.5 text-xs font-medium rounded-full"])}">${r.ssrInterpolate((e=>e.activo?e.en_pausa?"Pausa":"Activo":"Finalizado")(e))}</span></td><td class="px-4 py-3 whitespace-nowrap">`),e.proxima_sesion?o(`<div class="flex items-center gap-1.5"><div class="w-2 h-2 rounded-full bg-purple-500"></div><span class="text-sm text-gray-900">${r.ssrInterpolate((e=>{if(!e)return null;try{let t=e;t.includes("T")||(t+="T00:00:00");const a=new Date(t);return isNaN(a.getTime())?null:a.toLocaleDateString("es-ES",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})}catch{return null}})(e.proxima_sesion))}</span></div>`):o('<span class="text-sm text-amber-600 font-medium">Sin cita</span>'),o(`</td><td class="px-4 py-3 whitespace-nowrap"><div class="flex items-center gap-1.5"><div class="${r.ssrRenderClass([getUltimaSesionIndicador(e),"w-2 h-2 rounded-full"])}"></div><span class="${r.ssrRenderClass([getUltimaSesionTextClass(e),"text-sm"])}">${r.ssrInterpolate((e=>{if(!e)return"Sin registro";const t=new Date(e),a=new Date,r=Math.floor((a-t)/864e5);return 0===r?"Hoy":1===r?"Ayer":r<7?`Hace ${r}d`:r<30?`Hace ${Math.floor(r/7)}sem`:t.toLocaleDateString("es-ES",{day:"numeric",month:"short"})})(e.ultima_sesion))}</span></div></td><td class="px-4 py-3 whitespace-nowrap">`),e.bono_activo?o(`<div class="flex items-center gap-2"><div class="w-16 h-1.5 bg-gray-200 rounded-full overflow-hidden"><div class="${r.ssrRenderClass([(t=e.bono_activo,t?t.sesiones_restantes<=1?"bg-red-500":2===t.sesiones_restantes?"bg-amber-500":"bg-purple-500":"bg-gray-400"),"h-full rounded-full"])}" style="${r.ssrRenderStyle({width:getBonoPercent(e.bono_activo)+"%"})}"></div></div><span class="${r.ssrRenderClass([getBonoTextClass(e.bono_activo),"text-xs font-medium"])}">${r.ssrInterpolate(e.bono_activo.sesiones_restantes)}/${r.ssrInterpolate(e.bono_activo.sesiones_totales)}</span></div>`):o('<span class="text-xs text-gray-400">‚Äî</span>'),o('</td><td class="px-4 py-3 whitespace-nowrap text-right"><div class="flex items-center justify-end gap-1"><button class="p-1.5 text-gray-400 hover:text-purple-600 hover:bg-purple-50 rounded transition-colors" title="Editar">'),o(r.ssrRenderComponent(a.unref(s),{class:"w-4 h-4"},null,l)),o('</button><button class="p-1.5 text-gray-400 hover:text-purple-600 hover:bg-purple-50 rounded transition-colors" title="Bonos">'),o(r.ssrRenderComponent(a.unref(n),{class:"w-4 h-4"},null,l)),o('</button><button class="p-1.5 text-gray-400 hover:text-purple-600 hover:bg-purple-50 rounded transition-colors" title="Vista r√°pida">'),o(r.ssrRenderComponent(a.unref(v),{class:"w-4 h-4"},null,l)),o("</button></div></td></tr>")}),o("\x3c!--]--\x3e</tbody></table>"),0===e.pacientes.length?o('<div class="py-12 text-center"><p class="text-sm text-gray-500">No hay pacientes que mostrar</p></div>'):o("\x3c!----\x3e"),o("</div>")}}},K=J.setup;J.setup=(e,t)=>{const r=a.useSSRContext();return(r.modules||(r.modules=new Set)).add("components/PacienteTabla.vue"),K?K(e,t):void 0};const ee={__name:"ModalNuevoPaciente",__ssrInlineRender:!0,props:{mostrar:{type:Boolean,default:!1}},emits:["cerrar","paciente-creado"],setup(e,{emit:s}){const n=e;f(),x(),g(),t();const o=a.ref({nombre:"",apellido:"",email:"",telefono:"",fecha_nacimiento:"",tipo_bono:"",primera_sesion:"",activo:!0,notas_iniciales:"",crear_bono:!1,bono_monto:0,bono_renovacion_automatica:!1}),l=a.ref(!1),d=a.ref(""),i={otro:60,quincenal:100,semanal:160,mensual:180},c=a.computed(()=>{const e=o.value.tipo_bono;if(!e)return 0;return{otro:1,quincenal:2,semanal:4,mensual:4}[e]||0}),u=a.computed(()=>({otro:"A Demanda",quincenal:"Quincenal",semanal:"Semanal",mensual:"Mensual"}[o.value.tipo_bono]||"No seleccionado")),p=a.computed(()=>{const e=c.value,t=o.value.bono_monto;return!e||!t||e<=0?"0.00":(t/e).toFixed(2)}),m=a.computed(()=>{const e=o.value.tipo_bono;return e&&i[e]||0}),v=a.computed(()=>"otro"===o.value.tipo_bono),b=a.computed(()=>{const e=new Date,t=[],formatearDateTime=(e,t)=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}T${t}`,a=new Date(e);a.setDate(a.getDate()+1),t.push({label:"üåÖ Ma√±ana 10:00",datetime:formatearDateTime(a,"10:00")});const r=new Date(e),s=(8-r.getDay())%7;r.setDate(r.getDate()+(s||7)),t.push({label:"üìÖ Pr√≥ximo Lun 09:00",datetime:formatearDateTime(r,"09:00")});const n=new Date(e);return n.setDate(n.getDate()+7),t.push({label:"üóìÔ∏è En 7 d√≠as 16:00",datetime:formatearDateTime(n,"16:00")}),t}),h=a.computed(()=>{const e=o.value.nombre&&o.value.apellido&&o.value.email&&o.value.tipo_bono&&o.value.primera_sesion;return o.value.crear_bono?e&&o.value.bono_monto>0:e});a.watch(()=>o.value.tipo_bono,e=>{"otro"===e?(o.value.crear_bono=!1,o.value.bono_monto=0):o.value.crear_bono&&0===o.value.bono_monto&&(o.value.bono_monto=i[e]||0)}),a.watch(()=>o.value.crear_bono,e=>{e&&o.value.tipo_bono&&0===o.value.bono_monto&&(o.value.bono_monto=i[o.value.tipo_bono]||0)}),a.watch(()=>n.mostrar,e=>{e&&resetearFormulario()});const resetearFormulario=()=>{o.value={nombre:"",apellido:"",email:"",telefono:"",fecha_nacimiento:"",tipo_bono:"",primera_sesion:"",activo:!0,notas_iniciales:"",crear_bono:!1,bono_monto:0,bono_renovacion_automatica:!1},d.value=""};return(t,s,n,i)=>{e.mostrar?(s(`<div${r.ssrRenderAttrs(a.mergeProps({class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},i))}><div class="bg-white/95 backdrop-blur-lg rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto border border-white/30"><div class="sticky top-0 bg-gradient-to-r from-[#5550F2]/5 via-[#027368]/5 to-[#04BF9D]/5 backdrop-blur-md border-b border-neutral-200 px-6 py-4 flex justify-between items-center shadow-sm"><h2 class="text-2xl font-[&#39;Elms_Sans&#39;] text-neutral-800 font-semibold"> Nuevo Paciente </h2><button class="text-neutral-600 hover:text-[#027368] transition-colors p-2 hover:bg-white/50 rounded-lg" aria-label="Cerrar modal"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div><form class="px-6 py-6 space-y-6 bg-gradient-to-b from-white/50 to-transparent"><div class="space-y-4"><h3 class="text-lg font-[&#39;Elms_Sans&#39;] text-neutral-800 font-semibold"> Informaci√≥n Personal </h3><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label for="nombre" class="block text-sm font-medium text-neutral-700 mb-1"> Nombre <span class="text-red-500">*</span></label><input id="nombre"${r.ssrRenderAttr("value",o.value.nombre)} type="text" required class="w-full px-4 py-2 border border-neutral-300 rounded-xl focus:ring-2 focus:ring-[#027368]/20 focus:border-[#027368] bg-white/90 backdrop-blur-sm transition-all shadow-sm" placeholder="Nombre del paciente"></div><div><label for="apellido" class="block text-sm font-medium text-neutral-700 mb-1"> Apellido <span class="text-red-500">*</span></label><input id="apellido"${r.ssrRenderAttr("value",o.value.apellido)} type="text" required class="w-full px-4 py-2 border border-neutral-300 rounded-xl focus:ring-2 focus:ring-[#027368]/20 focus:border-[#027368] bg-white/90 backdrop-blur-sm transition-all shadow-sm" placeholder="Apellido(s) del paciente"></div><div><label for="email" class="block text-sm font-medium text-neutral-700 mb-1"> Email <span class="text-red-500">*</span></label><input id="email"${r.ssrRenderAttr("value",o.value.email)} type="email" required class="w-full px-4 py-2 border border-neutral-300 rounded-xl focus:ring-2 focus:ring-[#027368]/20 focus:border-[#027368] bg-white/90 backdrop-blur-sm transition-all shadow-sm" placeholder="correo@ejemplo.com"></div><div><label for="telefono" class="block text-sm font-medium text-neutral-700 mb-1"> Tel√©fono </label><input id="telefono"${r.ssrRenderAttr("value",o.value.telefono)} type="tel" class="w-full px-4 py-2 border border-neutral-300 rounded-xl focus:ring-2 focus:ring-[#027368]/20 focus:border-[#027368] bg-white/90 backdrop-blur-sm transition-all shadow-sm" placeholder="+52 123 456 7890"></div><div><label for="fecha_nacimiento" class="block text-sm font-medium text-[#2D3748] mb-1"> Fecha de Nacimiento </label><div class="relative"><input id="fecha_nacimiento"${r.ssrRenderAttr("value",o.value.fecha_nacimiento)} type="date" class="w-full px-4 py-2 pr-12 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white cursor-pointer"><button type="button" class="absolute right-2 top-1/2 -translate-y-1/2 p-2 text-[#5550F2] hover:text-[#2D3748] transition-colors" title="Abrir calendario"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg></button></div><p class="text-xs text-cafe/60 mt-1"> üí° Puedes escribir la fecha o usar el calendario </p></div></div></div><div class="space-y-4 pt-4 border-t border-neutral-200"><h3 class="text-lg font-[&#39;Elms_Sans&#39;] text-neutral-800 font-semibold"> Informaci√≥n Terap√©utica </h3><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label for="tipo_bono" class="block text-sm font-medium text-[#2D3748] mb-1"> Tipo de Bono <span class="text-red-500">*</span></label><select id="tipo_bono" required class="w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white"><option value=""${r.ssrIncludeBooleanAttr(Array.isArray(o.value.tipo_bono)?r.ssrLooseContain(o.value.tipo_bono,""):r.ssrLooseEqual(o.value.tipo_bono,""))?" selected":""}>Selecciona tipo de bono</option><option value="otro"${r.ssrIncludeBooleanAttr(Array.isArray(o.value.tipo_bono)?r.ssrLooseContain(o.value.tipo_bono,"otro"):r.ssrLooseEqual(o.value.tipo_bono,"otro"))?" selected":""}>A Demanda (1 sesi√≥n - 60‚Ç¨ - sin compromiso)</option><option value="quincenal"${r.ssrIncludeBooleanAttr(Array.isArray(o.value.tipo_bono)?r.ssrLooseContain(o.value.tipo_bono,"quincenal"):r.ssrLooseEqual(o.value.tipo_bono,"quincenal"))?" selected":""}>Quincenal (2 sesiones/mes - 100‚Ç¨)</option><option value="semanal"${r.ssrIncludeBooleanAttr(Array.isArray(o.value.tipo_bono)?r.ssrLooseContain(o.value.tipo_bono,"semanal"):r.ssrLooseEqual(o.value.tipo_bono,"semanal"))?" selected":""}>Semanal (4 sesiones/mes - 160‚Ç¨)</option><option value="mensual"${r.ssrIncludeBooleanAttr(Array.isArray(o.value.tipo_bono)?r.ssrLooseContain(o.value.tipo_bono,"mensual"):r.ssrLooseEqual(o.value.tipo_bono,"mensual"))?" selected":""}>Mensual</option></select><p class="text-xs text-cafe/60 mt-1"> üé´ Define el tipo de bono del paciente </p></div><div><label for="primera_sesion" class="block text-sm font-medium text-[#2D3748] mb-1"> Primera Sesi√≥n <span class="text-red-500">*</span></label><div class="relative"><input id="primera_sesion"${r.ssrRenderAttr("value",o.value.primera_sesion)} type="datetime-local" required step="1800" class="w-full px-4 py-2 pr-12 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white cursor-pointer"><button type="button" class="absolute right-2 top-1/2 -translate-y-1/2 p-2 text-[#5550F2] hover:text-[#2D3748] transition-colors" title="Abrir selector de fecha y hora"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></button></div><div class="flex gap-2 flex-wrap mt-2">\x3c!--[--\x3e`),r.ssrRenderList(a.unref(b),(e,t)=>{s(`<button type="button" class="${r.ssrRenderClass(["text-xs px-3 py-1.5 rounded-lg border transition-all",o.value.primera_sesion===e.datetime?"bg-[#5550F2] text-white border-[#5550F2] font-semibold":"bg-white text-[#2D3748] border-[#5550F2]/30 hover:border-[#5550F2] hover:bg-[#5550F2]/10"])}">${r.ssrInterpolate(e.label)}</button>`)}),s('\x3c!--]--\x3e</div><p class="text-xs text-cafe/60 mt-1"> üí° Puedes escribir la fecha/hora o usar el selector </p></div></div></div><div class="space-y-4 pt-4 border-t border-[#5550F2]/30"><div class="border-t pt-6"><h3 class="text-lg font-serif text-[#2D3748] font-semibold mb-2"> üí≥ Bono Inicial (Opcional) </h3>'),a.unref(v)?s('<div class="bg-amber-50 border-2 border-amber-200 rounded-lg p-4 mb-3"><div class="flex items-start gap-3"><span class="text-2xl">‚ÑπÔ∏è</span><div><p class="text-sm font-semibold text-amber-900 mb-1"> Sesi√≥n &quot;A Demanda&quot; seleccionada </p><p class="text-sm text-amber-800"> Las sesiones a demanda son <strong>sin compromiso</strong> y se pagan individualmente (60‚Ç¨ por sesi√≥n). No es necesario crear un bono prepagado. </p></div></div></div>'):s('<p class="text-sm text-cafe/70 mb-3"> Crea un bono prepagado para que el paciente empiece su tratamiento. Podr√°s confirmar el pago despu√©s. </p>'),s(`<label class="${r.ssrRenderClass([a.unref(v)?"bg-gray-100 border-2 border-gray-200 cursor-not-allowed opacity-60":"bg-purple-50 border-2 border-purple-200 cursor-pointer hover:bg-purple-100","flex items-center gap-3 p-3 rounded-lg transition-colors"])}"><input${r.ssrIncludeBooleanAttr(Array.isArray(o.value.crear_bono)?r.ssrLooseContain(o.value.crear_bono,null):o.value.crear_bono)?" checked":""} type="checkbox"${r.ssrIncludeBooleanAttr(a.unref(v))?" disabled":""} class="w-5 h-5 text-purple-600 border-gray-300 rounded focus:ring-purple-500 disabled:opacity-50 disabled:cursor-not-allowed"><span class="${r.ssrRenderClass([a.unref(v)?"text-gray-500":"text-purple-700","text-sm font-semibold"])}"> ‚úÖ S√≠, crear bono prepagado para este paciente </span></label></div>`),o.value.crear_bono?(s(`<div class="border-2 border-purple-400/40 rounded-lg p-5 space-y-4 bg-gradient-to-br from-purple-50 to-purple-100/50"><div class="bg-white border-2 border-purple-300 rounded-lg p-4 shadow-sm"><div class="flex items-start gap-3"><div class="w-10 h-10 bg-purple-500 rounded-full flex items-center justify-center flex-shrink-0"><span class="text-white text-xl">üéüÔ∏è</span></div><div class="flex-1"><h4 class="font-semibold text-purple-900 mb-1"> Tipo de Bono: ${r.ssrInterpolate(a.unref(u)||"Selecciona un tipo arriba")}</h4><div class="grid grid-cols-2 gap-3 text-sm"><div class="flex items-center gap-2"><span class="text-purple-600">üìä</span><span class="text-purple-800"><strong>${r.ssrInterpolate(a.unref(c))}</strong> ${r.ssrInterpolate(1===a.unref(c)?"sesi√≥n":"sesiones")}</span></div>`),a.unref(m)>0?s(`<div class="flex items-center gap-2"><span class="text-purple-600">üí∞</span><span class="text-purple-800"> Precio sugerido: <strong>‚Ç¨${r.ssrInterpolate(a.unref(m))}</strong></span></div>`):s("\x3c!----\x3e"),s(`</div><p class="text-xs text-purple-600 mt-2 bg-purple-50 p-2 rounded"> üí° <strong>Tip:</strong> Los precios se calcular√°n autom√°ticamente seg√∫n el tipo de bono </p></div></div></div><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label for="bono_monto" class="block text-sm font-medium text-[#2D3748] mb-1"> Monto Total <span class="text-red-500">*</span></label><div class="relative"><span class="absolute left-3 top-1/2 -translate-y-1/2 text-[#2D3748]/60">‚Ç¨</span><input id="bono_monto"${r.ssrRenderAttr("value",o.value.bono_monto)} type="number" min="0" step="0.01"${r.ssrIncludeBooleanAttr(o.value.crear_bono)?" required":""} placeholder="0.00" class="w-full pl-8 pr-4 py-2 border border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500 bg-white"></div></div><div><label class="block text-sm font-medium text-[#2D3748] mb-1"> Precio por Sesi√≥n </label><div class="px-4 py-2 bg-purple-100 rounded-lg border border-purple-300"><span class="text-lg font-bold text-purple-700">‚Ç¨${r.ssrInterpolate(a.unref(p))}</span></div></div><div class="md:col-span-2"><label class="flex items-start gap-3 p-4 bg-white border-2 border-purple-200 rounded-lg cursor-pointer hover:bg-purple-50 hover:border-purple-300 transition-all"><input${r.ssrIncludeBooleanAttr(Array.isArray(o.value.bono_renovacion_automatica)?r.ssrLooseContain(o.value.bono_renovacion_automatica,null):o.value.bono_renovacion_automatica)?" checked":""} type="checkbox" class="mt-1 w-5 h-5 text-purple-600 border-gray-300 rounded focus:ring-purple-500"><div class="flex-1"><div class="flex items-center gap-2 mb-1"><span class="text-lg">üîÑ</span><span class="text-sm font-semibold text-purple-900"> Renovaci√≥n Autom√°tica </span><span class="ml-auto px-2 py-0.5 bg-purple-100 text-purple-700 text-xs font-medium rounded"> Recomendado </span></div><div class="text-xs text-[#2D3748]/70 space-y-1"><p>‚úì El bono se renovar√° autom√°ticamente cuando se agoten las sesiones o expire</p><p>‚úì Mantiene la continuidad del tratamiento sin interrupciones</p><p>‚úì Puedes desactivar la renovaci√≥n en cualquier momento</p></div></div></label></div></div>`),a.unref(c)>0&&o.value.bono_monto>0?s(`<div class="p-3 bg-white rounded-lg border border-purple-300"><div class="text-xs font-medium text-purple-800 mb-2">üìã Resumen del Bono</div><div class="grid grid-cols-3 gap-2 text-xs"><div><span class="text-[#2D3748]/60">Tipo:</span><span class="font-medium text-[#2D3748] ml-1">${r.ssrInterpolate(a.unref(u))}</span></div><div><span class="text-[#2D3748]/60">Sesiones:</span><span class="font-medium text-[#2D3748] ml-1">${r.ssrInterpolate(a.unref(c))}</span></div><div><span class="text-[#2D3748]/60">Total:</span><span class="font-medium text-[#2D3748] ml-1">‚Ç¨${r.ssrInterpolate(o.value.bono_monto)}</span></div></div></div>`):s("\x3c!----\x3e"),s("</div>")):s("\x3c!----\x3e"),s(`</div><div class="space-y-4 pt-4 border-t border-[#5550F2]/30"><h3 class="text-lg font-serif text-[#2D3748] font-semibold"> Notas Iniciales </h3><div><label for="notas_iniciales" class="block text-sm font-medium text-[#2D3748] mb-1"> Observaciones (Opcional) </label><textarea id="notas_iniciales" rows="3" class="w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white resize-none" placeholder="Observaciones iniciales, motivo de consulta, etc.">${r.ssrInterpolate(o.value.notas_iniciales)}</textarea></div></div>`),d.value?s(`<div class="bg-red-50 border border-red-200 rounded-lg p-4"><p class="text-sm text-red-600">${r.ssrInterpolate(d.value)}</p></div>`):s("\x3c!----\x3e"),s(`<div class="sticky bottom-0 bg-gradient-to-r from-white/95 via-white/90 to-white/95 backdrop-blur-md pt-4 pb-2 border-t border-neutral-200 -mx-6 px-6 mt-6 shadow-sm"><div class="flex justify-between items-center gap-3"><div class="text-xs text-neutral-600"><span class="inline-block w-2 h-2 bg-red-500 rounded-full mr-1"></span> Los campos con * son obligatorios </div><div class="flex gap-3"><button type="button"${r.ssrIncludeBooleanAttr(l.value)?" disabled":""} class="px-6 py-2.5 border-2 border-neutral-300 text-neutral-700 font-medium rounded-xl hover:bg-neutral-50 hover:border-[#027368] transition-all disabled:opacity-50 disabled:cursor-not-allowed"> Cancelar </button><button type="submit"${r.ssrIncludeBooleanAttr(l.value||!a.unref(h))?" disabled":""} class="px-8 py-2.5 bg-gradient-to-r from-[#04BF9D] to-[#027368] text-white font-semibold rounded-xl hover:from-[#027368] hover:to-[#04BF9D] transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 shadow-sm hover:shadow-md">`),l.value?s('<span class="inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></span>'):s("<span>‚úì</span>"),s(` ${r.ssrInterpolate(l.value?"Creando paciente...":"Crear Paciente")}</button></div></div></div></form></div></div>`)):s("\x3c!----\x3e")}}},te=ee.setup;ee.setup=(e,t)=>{const r=a.useSSRContext();return(r.modules||(r.modules=new Set)).add("components/ModalNuevoPaciente.vue"),te?te(e,t):void 0};const ae=Object.assign(ee,{__name:"ModalNuevoPaciente"}),re={__name:"ModalEditarPaciente",__ssrInlineRender:!0,props:{mostrar:{type:Boolean,default:!1},paciente:{type:Object,default:null}},emits:["cerrar","paciente-actualizado"],setup(e,{emit:t}){const s=e,{supabase:n}=f();x();const o=a.ref({nombre:"",apellido:"",email:"",telefono:"",fecha_nacimiento:"",tipo_bono:"",precio_sesion:null,activo:!0,en_pausa:!1,crear_bono:!1,bono_monto:null,bono_renovacion_automatica:!1,bono_sesiones_usadas:0}),l=a.ref(null),d=a.ref(!1),i=a.ref(!1),c=a.computed(()=>{if(!o.value.en_pausa)return 45;const e=(s.paciente?.metadata||{}).fecha_pausa;if(!e)return 45;const t=new Date(e),a=new Date,r=Math.floor((a.getTime()-t.getTime())/864e5);return Math.max(0,45-r)}),u=a.computed(()=>l.value?Math.max(0,l.value.sesiones_totales-(o.value.bono_sesiones_usadas||0)):0),p=a.computed(()=>{const e=o.value.tipo_bono;if(!e)return"Selecciona tipo";return{a_demanda:1,quincenal:2,semanal:4}[e]||0}),m=a.computed(()=>({a_demanda:"A Demanda",quincenal:"Quincenal",semanal:"Semanal"}[o.value.tipo_bono]||"")),v=a.computed(()=>{const e=p.value,t=o.value.bono_monto;return"Selecciona tipo"===e||!t||e<=0?"0.00":(t/e).toFixed(2)}),b=a.ref(!1),g=a.ref("");a.watch(()=>s.mostrar,e=>{e&&s.paciente&&cargarDatosPaciente()});const cargarDatosPaciente=async()=>{const e=s.paciente,t=e.metadata||{},a=(e.nombre_completo||e.nombre||"").split(" "),r=a[0]||t.nombre||"",n=a.slice(1).join(" ")||t.apellido||t.apellido_paterno||"";o.value={nombre:r,apellido:n,email:e.email||"",telefono:e.telefono||"",fecha_nacimiento:t.fecha_nacimiento||"",tipo_bono:e.tipo_bono||"",precio_sesion:e.precio_sesion||null,activo:e.activo??!0,en_pausa:e.en_pausa||t.en_pausa||!1,crear_bono:!1,bono_monto:null,bono_renovacion_automatica:!1,bono_sesiones_usadas:0},g.value="",await cargarBonoActivo()},cargarBonoActivo=async()=>{if(s.paciente?.id){d.value=!0,l.value=null;try{const{data:e,error:t}=await n.from("bonos").select("*").eq("paciente_id",s.paciente.id).in("estado",["activo","pendiente"]).order("created_at",{ascending:!1}).limit(1).single();e&&!t&&(l.value=e,o.value.bono_sesiones_usadas=e.sesiones_usadas||0)}catch(e){console.log("No se encontr√≥ bono activo para el paciente")}finally{d.value=!1}}};return(t,s,n,f)=>{e.mostrar?(s(`<div${r.ssrRenderAttrs(a.mergeProps({class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},f))} data-v-b27bd45f><div class="bg-[#F2F2F2] rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto" data-v-b27bd45f><div class="sticky top-0 bg-[#F2F2F2] border-b border-[#5550F2]/30 px-6 py-4 flex justify-between items-center" data-v-b27bd45f><h2 class="text-2xl font-serif text-[#2D3748] font-semibold" data-v-b27bd45f> Editar Paciente </h2><button class="text-[#2D3748] hover:text-[#5550F2] transition-colors" aria-label="Cerrar modal" data-v-b27bd45f><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-b27bd45f><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" data-v-b27bd45f></path></svg></button></div><form class="px-6 py-6 space-y-6" data-v-b27bd45f><div class="space-y-4" data-v-b27bd45f><h3 class="text-lg font-serif text-[#2D3748] font-semibold" data-v-b27bd45f> Informaci√≥n Personal </h3><div class="grid grid-cols-1 md:grid-cols-2 gap-4" data-v-b27bd45f><div data-v-b27bd45f><label for="nombre" class="block text-sm font-medium text-[#2D3748] mb-1" data-v-b27bd45f> Nombre <span class="text-red-500" data-v-b27bd45f>*</span></label><input id="nombre"${r.ssrRenderAttr("value",o.value.nombre)} type="text" required class="w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white" placeholder="Nombre del paciente" data-v-b27bd45f></div><div data-v-b27bd45f><label for="apellido" class="block text-sm font-medium text-[#2D3748] mb-1" data-v-b27bd45f> Apellido <span class="text-red-500" data-v-b27bd45f>*</span></label><input id="apellido"${r.ssrRenderAttr("value",o.value.apellido)} type="text" required class="w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white" placeholder="Apellido(s) del paciente" data-v-b27bd45f></div><div data-v-b27bd45f><label for="email" class="block text-sm font-medium text-[#2D3748] mb-1" data-v-b27bd45f> Email <span class="text-red-500" data-v-b27bd45f>*</span></label><input id="email"${r.ssrRenderAttr("value",o.value.email)} type="email" required class="w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white" placeholder="correo@ejemplo.com" data-v-b27bd45f></div><div data-v-b27bd45f><label for="telefono" class="block text-sm font-medium text-[#2D3748] mb-1" data-v-b27bd45f> Tel√©fono </label><input id="telefono"${r.ssrRenderAttr("value",o.value.telefono)} type="tel" class="w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white" placeholder="+52 123 456 7890" data-v-b27bd45f></div><div data-v-b27bd45f><label for="fecha_nacimiento" class="block text-sm font-medium text-[#2D3748] mb-1" data-v-b27bd45f> Fecha de Nacimiento </label><input id="fecha_nacimiento"${r.ssrRenderAttr("value",o.value.fecha_nacimiento)} type="date" class="w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white" data-v-b27bd45f></div></div></div><div class="space-y-4 pt-4 border-t border-[#5550F2]/30" data-v-b27bd45f><h3 class="text-lg font-serif text-[#2D3748] font-semibold" data-v-b27bd45f> Informaci√≥n Terap√©utica </h3><div class="grid grid-cols-1 md:grid-cols-2 gap-4" data-v-b27bd45f><div data-v-b27bd45f><label for="tipo_bono" class="block text-sm font-medium text-[#2D3748] mb-1" data-v-b27bd45f> Tipo de Bono <span class="text-red-500" data-v-b27bd45f>*</span></label><select id="tipo_bono" required class="w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white" data-v-b27bd45f><option value="" data-v-b27bd45f${r.ssrIncludeBooleanAttr(Array.isArray(o.value.tipo_bono)?r.ssrLooseContain(o.value.tipo_bono,""):r.ssrLooseEqual(o.value.tipo_bono,""))?" selected":""}>Selecciona tipo de bono</option><option value="a_demanda" data-v-b27bd45f${r.ssrIncludeBooleanAttr(Array.isArray(o.value.tipo_bono)?r.ssrLooseContain(o.value.tipo_bono,"a_demanda"):r.ssrLooseEqual(o.value.tipo_bono,"a_demanda"))?" selected":""}>A Demanda (1 sesi√≥n)</option><option value="quincenal" data-v-b27bd45f${r.ssrIncludeBooleanAttr(Array.isArray(o.value.tipo_bono)?r.ssrLooseContain(o.value.tipo_bono,"quincenal"):r.ssrLooseEqual(o.value.tipo_bono,"quincenal"))?" selected":""}>Quincenal (2 sesiones/mes)</option><option value="semanal" data-v-b27bd45f${r.ssrIncludeBooleanAttr(Array.isArray(o.value.tipo_bono)?r.ssrLooseContain(o.value.tipo_bono,"semanal"):r.ssrLooseEqual(o.value.tipo_bono,"semanal"))?" selected":""}>Semanal (4 sesiones/mes)</option></select></div><div data-v-b27bd45f><label for="precio_sesion" class="block text-sm font-medium text-[#2D3748] mb-1" data-v-b27bd45f> Precio por Sesi√≥n (‚Ç¨) </label><div class="relative" data-v-b27bd45f><span class="absolute left-3 top-1/2 -translate-y-1/2 text-[#2D3748]/60" data-v-b27bd45f>‚Ç¨</span><input id="precio_sesion"${r.ssrRenderAttr("value",o.value.precio_sesion)} type="number" min="0" step="0.01" placeholder="Usar precio del terapeuta" class="w-full pl-8 pr-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white" data-v-b27bd45f></div><p class="text-xs text-[#2D3748]/60 mt-1" data-v-b27bd45f> üí° Precio personalizado para este paciente. Si est√° vac√≠o, se usa el precio seg√∫n frecuencia del terapeuta. </p></div><div data-v-b27bd45f><label for="activo" class="block text-sm font-medium text-[#2D3748] mb-1" data-v-b27bd45f> Estado </label><select id="activo" class="w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white" data-v-b27bd45f><option${r.ssrRenderAttr("value",!0)} data-v-b27bd45f${r.ssrIncludeBooleanAttr(Array.isArray(o.value.activo)?r.ssrLooseContain(o.value.activo,!0):r.ssrLooseEqual(o.value.activo,!0))?" selected":""}>Activo</option><option${r.ssrRenderAttr("value",!1)} data-v-b27bd45f${r.ssrIncludeBooleanAttr(Array.isArray(o.value.activo)?r.ssrLooseContain(o.value.activo,!1):r.ssrLooseEqual(o.value.activo,!1))?" selected":""}>Inactivo</option></select></div><div class="md:col-span-2 space-y-3" data-v-b27bd45f><label class="flex items-center gap-2 cursor-pointer" data-v-b27bd45f><input${r.ssrIncludeBooleanAttr(Array.isArray(o.value.en_pausa)?r.ssrLooseContain(o.value.en_pausa,null):o.value.en_pausa)?" checked":""} type="checkbox" class="w-4 h-4 text-amber-500 border-gray-300 rounded focus:ring-amber-500" data-v-b27bd45f><span class="text-sm font-medium text-[#2D3748]" data-v-b27bd45f> Proceso en pausa temporal </span></label>`),o.value.en_pausa?(s(`<div class="bg-amber-50 border border-amber-200 rounded-lg p-4 space-y-3" data-v-b27bd45f><div class="flex items-start gap-3" data-v-b27bd45f><span class="text-2xl" data-v-b27bd45f>‚è∏Ô∏è</span><div data-v-b27bd45f><p class="font-medium text-amber-800" data-v-b27bd45f>Cuenta en pausa temporal</p><p class="text-sm text-amber-700 mt-1" data-v-b27bd45f> El proceso terapeutico esta pausado. El paciente mantendra su espacio reservado durante <strong data-v-b27bd45f>45 dias</strong>. </p></div></div><div class="bg-white/80 rounded-lg p-3 border border-amber-100" data-v-b27bd45f><div class="flex items-center justify-between mb-2" data-v-b27bd45f><span class="text-sm font-medium text-gray-700" data-v-b27bd45f>Dias restantes:</span><span class="${r.ssrRenderClass([c.value<=7?"text-red-600":"text-amber-600","text-lg font-bold"])}" data-v-b27bd45f>${r.ssrInterpolate(c.value)} dias </span></div><div class="w-full bg-gray-200 rounded-full h-2" data-v-b27bd45f><div class="${r.ssrRenderClass([c.value<=7?"bg-red-500":"bg-amber-500","h-2 rounded-full transition-all"])}" style="${r.ssrRenderStyle({width:`${Math.max(0,c.value/45*100)}%`})}" data-v-b27bd45f></div></div></div><div class="text-xs text-amber-800 space-y-2 bg-amber-100/50 rounded p-3" data-v-b27bd45f><p class="font-medium flex items-center gap-1" data-v-b27bd45f><span data-v-b27bd45f>‚ö†Ô∏è</span> Importante: </p><ul class="list-disc list-inside space-y-1 text-amber-700" data-v-b27bd45f><li data-v-b27bd45f>Pasados los 45 dias, el perfil se <strong data-v-b27bd45f>desactivara automaticamente</strong></li><li data-v-b27bd45f>Se liberara su espacio en la agenda de Psicologa Karem</li><li data-v-b27bd45f>Los datos se eliminaran conforme al <strong data-v-b27bd45f>reglamento de proteccion de datos</strong> para garantizar su privacidad</li><li data-v-b27bd45f>Al reactivar, los precios de las sesiones podrian haberse modificado</li></ul></div><button type="button"${r.ssrIncludeBooleanAttr(i.value)?" disabled":""} class="w-full py-2 px-4 bg-amber-600 text-white text-sm font-medium rounded-lg hover:bg-amber-700 disabled:opacity-50 transition-colors flex items-center justify-center gap-2" data-v-b27bd45f>`),i.value?s('\x3c!--[--\x3e<span class="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin" data-v-b27bd45f></span> Enviando... \x3c!--]--\x3e'):s("\x3c!--[--\x3e<span data-v-b27bd45f>üìß</span> Enviar recordatorio al paciente \x3c!--]--\x3e"),s("</button></div>")):s("\x3c!----\x3e"),s('</div></div></div><div class="space-y-4 pt-4 border-t border-[#5550F2]/30" data-v-b27bd45f><h3 class="text-lg font-serif text-[#2D3748] font-semibold" data-v-b27bd45f> Gesti√≥n de Bonos </h3>'),l.value?(s(`<div class="border-2 border-blue-400/40 rounded-lg p-4 space-y-4 bg-blue-50/30" data-v-b27bd45f><div class="flex items-center justify-between" data-v-b27bd45f><div class="flex items-center gap-2" data-v-b27bd45f><span class="text-xl" data-v-b27bd45f>üé´</span><div data-v-b27bd45f><p class="font-medium text-[#2D3748]" data-v-b27bd45f>Bono ${r.ssrInterpolate(l.value.tipo||"Activo")}</p><p class="text-xs text-[#2D3748]/60" data-v-b27bd45f> Estado: <span class="${r.ssrRenderClass(["activo"===l.value.estado?"text-green-600":"text-amber-600","font-medium capitalize"])}" data-v-b27bd45f>${r.ssrInterpolate(l.value.estado)}</span></p></div></div><span class="${r.ssrRenderClass(["activo"===l.value.estado?"bg-green-100 text-green-700":"bg-amber-100 text-amber-700","px-2 py-1 text-xs font-medium rounded-full"])}" data-v-b27bd45f>${r.ssrInterpolate(l.value.sesiones_restantes)}/${r.ssrInterpolate(l.value.sesiones_totales)} restantes </span></div><div class="grid grid-cols-2 gap-4" data-v-b27bd45f><div data-v-b27bd45f><label class="block text-sm font-medium text-[#2D3748] mb-1" data-v-b27bd45f> Sesiones Totales </label><div class="px-4 py-2 bg-gray-100 border border-gray-300 rounded-lg text-[#2D3748] font-medium" data-v-b27bd45f>${r.ssrInterpolate(l.value.sesiones_totales)}</div></div><div data-v-b27bd45f><label for="sesiones_usadas_bono" class="block text-sm font-medium text-[#2D3748] mb-1" data-v-b27bd45f> Sesiones Consumidas </label><input id="sesiones_usadas_bono"${r.ssrRenderAttr("value",o.value.bono_sesiones_usadas)} type="number" min="0"${r.ssrRenderAttr("max",l.value.sesiones_totales)} class="w-full px-4 py-2 border border-blue-400/50 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white" data-v-b27bd45f></div></div><div class="${r.ssrRenderClass([u.value<=0?"bg-red-50 border border-red-200":"bg-blue-50 border border-blue-200","flex items-center gap-2 p-3 rounded-lg"])}" data-v-b27bd45f><span class="${r.ssrRenderClass(u.value<=0?"text-red-600":"text-blue-600")}" data-v-b27bd45f>${r.ssrInterpolate(u.value<=0?"‚ö†Ô∏è":"‚ÑπÔ∏è")}</span><p class="${r.ssrRenderClass([u.value<=0?"text-red-800":"text-blue-800","text-sm"])}" data-v-b27bd45f><strong data-v-b27bd45f>${r.ssrInterpolate(u.value)}</strong> de ${r.ssrInterpolate(l.value.sesiones_totales)} sesiones disponibles `),o.value.bono_sesiones_usadas!==l.value.sesiones_usadas?s('<span class="text-amber-600 ml-1" data-v-b27bd45f> (modificado) </span>'):s("\x3c!----\x3e"),s('</p></div><p class="text-xs text-[#2D3748]/60" data-v-b27bd45f> üí° Ajusta las sesiones consumidas para sincronizar con datos de otra plataforma o corregir errores. </p></div>')):d.value?s("\x3c!----\x3e"):s('<div class="bg-gray-50 border border-gray-200 rounded-lg p-4 text-center" data-v-b27bd45f><p class="text-sm text-[#2D3748]/70" data-v-b27bd45f> Este paciente no tiene un bono activo. </p></div>'),d.value?s('<div class="flex items-center justify-center py-4" data-v-b27bd45f><div class="w-5 h-5 border-2 border-blue-200 border-t-blue-600 rounded-full animate-spin mr-2" data-v-b27bd45f></div><span class="text-sm text-[#2D3748]/60" data-v-b27bd45f>Cargando bono...</span></div>'):s("\x3c!----\x3e"),s(`<div class="flex items-center justify-between pt-2" data-v-b27bd45f><label class="flex items-center gap-2 cursor-pointer" data-v-b27bd45f><input${r.ssrIncludeBooleanAttr(Array.isArray(o.value.crear_bono)?r.ssrLooseContain(o.value.crear_bono,null):o.value.crear_bono)?" checked":""} type="checkbox" class="w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500" data-v-b27bd45f><span class="text-sm font-medium text-[#2D3748]" data-v-b27bd45f> üé´ Crear nuevo bono para este paciente </span></label></div>`),o.value.crear_bono?(s(`<div class="border-2 border-purple-400/40 rounded-lg p-4 space-y-4 bg-purple-50/30" data-v-b27bd45f><div class="bg-purple-100 border border-purple-300 rounded-lg p-3 flex items-start gap-2" data-v-b27bd45f><svg class="w-5 h-5 text-purple-600 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20" data-v-b27bd45f><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" data-v-b27bd45f></path></svg><div class="text-sm text-purple-800" data-v-b27bd45f><p class="font-medium" data-v-b27bd45f>El bono usar√° el tipo seleccionado arriba: <strong data-v-b27bd45f>${r.ssrInterpolate(m.value||"Selecciona un tipo primero")}</strong></p><p class="text-xs text-purple-700 mt-1" data-v-b27bd45f> Sesiones incluidas: ${r.ssrInterpolate("Selecciona tipo"===p.value?"N/A":p.value)}</p></div></div><div class="grid grid-cols-1 md:grid-cols-2 gap-4" data-v-b27bd45f><div data-v-b27bd45f><label for="bono_monto" class="block text-sm font-medium text-[#2D3748] mb-1" data-v-b27bd45f> Monto Total <span class="text-red-500" data-v-b27bd45f>*</span></label><div class="relative" data-v-b27bd45f><span class="absolute left-3 top-2.5 text-[#2D3748] font-medium" data-v-b27bd45f>‚Ç¨</span><input id="bono_monto"${r.ssrRenderAttr("value",o.value.bono_monto)} type="number" min="0" step="0.01"${r.ssrIncludeBooleanAttr(o.value.crear_bono)?" required":""} class="w-full pl-8 pr-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white" placeholder="0.00" data-v-b27bd45f></div></div><div data-v-b27bd45f><label class="block text-sm font-medium text-[#2D3748] mb-1" data-v-b27bd45f> Precio por Sesi√≥n </label><div class="px-4 py-2 bg-purple-100 border-2 border-purple-300 rounded-lg text-purple-900 font-bold" data-v-b27bd45f> ‚Ç¨${r.ssrInterpolate(v.value)}</div></div><div class="md:col-span-2" data-v-b27bd45f><label class="flex items-center gap-2 cursor-pointer" data-v-b27bd45f><input${r.ssrIncludeBooleanAttr(Array.isArray(o.value.bono_renovacion_automatica)?r.ssrLooseContain(o.value.bono_renovacion_automatica,null):o.value.bono_renovacion_automatica)?" checked":""} type="checkbox" class="w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500" data-v-b27bd45f><span class="text-sm font-medium text-[#2D3748]" data-v-b27bd45f> üîÑ Renovaci√≥n autom√°tica al vencer </span></label><p class="text-xs text-cafe/60 mt-1 ml-6" data-v-b27bd45f> El sistema crear√° un nuevo bono id√©ntico cuando este expire </p></div></div>`),p.value&&o.value.bono_monto?(s(`<div class="bg-white border border-purple-300 rounded-lg p-4" data-v-b27bd45f><p class="text-sm font-medium text-[#2D3748] mb-2" data-v-b27bd45f>üìã Resumen del Bono:</p><div class="text-sm text-cafe/80 space-y-1" data-v-b27bd45f><p data-v-b27bd45f>‚Ä¢ <strong data-v-b27bd45f>Tipo:</strong> ${r.ssrInterpolate(m.value)}</p><p data-v-b27bd45f>‚Ä¢ <strong data-v-b27bd45f>Sesiones:</strong> ${r.ssrInterpolate(p.value)}</p><p data-v-b27bd45f>‚Ä¢ <strong data-v-b27bd45f>Total:</strong> ‚Ç¨${r.ssrInterpolate(o.value.bono_monto.toFixed(2))}</p><p data-v-b27bd45f>‚Ä¢ <strong data-v-b27bd45f>Por sesi√≥n:</strong> ‚Ç¨${r.ssrInterpolate(v.value)}</p>`),o.value.bono_renovacion_automatica?s('<p class="text-purple-700" data-v-b27bd45f>‚Ä¢ ‚úÖ Con renovaci√≥n autom√°tica</p>'):s("\x3c!----\x3e"),s("</div></div>")):s("\x3c!----\x3e"),s("</div>")):s("\x3c!----\x3e"),s("</div>"),g.value?s(`<div class="bg-red-50 border border-red-200 rounded-lg p-4" data-v-b27bd45f><p class="text-sm text-red-600" data-v-b27bd45f>${r.ssrInterpolate(g.value)}</p></div>`):s("\x3c!----\x3e"),s(`<div class="flex justify-end gap-3 pt-4 border-t border-[#5550F2]/30" data-v-b27bd45f><button type="button"${r.ssrIncludeBooleanAttr(b.value)?" disabled":""} class="px-6 py-2 border border-[#5550F2] text-[#2D3748] rounded-lg hover:bg-[#5550F2]/10 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" data-v-b27bd45f> Cancelar </button><button type="submit"${r.ssrIncludeBooleanAttr(b.value)?" disabled":""} class="px-6 py-2 bg-[#5550F2] text-white rounded-lg hover:bg-[#C69F91] transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2" data-v-b27bd45f>`),b.value?s('<span class="inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin" data-v-b27bd45f></span>'):s("\x3c!----\x3e"),s(` ${r.ssrInterpolate(b.value?"Actualizando...":"Guardar Cambios")}</button></div></form></div></div>`)):s("\x3c!----\x3e")}}},se=re.setup;re.setup=(e,t)=>{const r=a.useSSRContext();return(r.modules||(r.modules=new Set)).add("components/ModalEditarPaciente.vue"),se?se(e,t):void 0};const ne=y(re,[["__scopeId","data-v-b27bd45f"]]),oe={__name:"ModalEliminarPaciente",__ssrInlineRender:!0,props:{mostrar:{type:Boolean,default:!1},paciente:{type:Object,default:null}},emits:["cerrar","paciente-eliminado","paciente-desactivado"],setup(e,{emit:t}){const s=e;f();const n=a.ref(!1),o=a.ref(""),l=a.computed(()=>s.paciente?s.paciente.nombre_completo||s.paciente.nombre||s.paciente.email||"este paciente":"");return(t,s,d,i)=>{e.mostrar?(s(`<div${r.ssrRenderAttrs(a.mergeProps({class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},i))} data-v-941153fc><div class="bg-[#F2F2F2] rounded-lg shadow-xl max-w-md w-full" data-v-941153fc><div class="px-6 py-4 border-b border-[#5550F2]/30" data-v-941153fc><div class="flex items-center gap-3" data-v-941153fc><span class="text-3xl" data-v-941153fc>‚ö†Ô∏è</span><h2 class="text-2xl font-serif text-[#2D3748] font-semibold" data-v-941153fc> Eliminar Paciente </h2></div></div><div class="px-6 py-6 space-y-4" data-v-941153fc><p class="text-[#2D3748]" data-v-941153fc> ¬øEst√°s seguro de que deseas eliminar a <strong class="font-semibold" data-v-941153fc>${r.ssrInterpolate(l.value)}</strong>? </p><div class="bg-red-50 border border-red-200 rounded-lg p-4 space-y-2" data-v-941153fc><p class="text-sm text-red-800 font-medium" data-v-941153fc> Esta acci√≥n no se puede deshacer y eliminar√°: </p><ul class="text-sm text-red-700 space-y-1 ml-4 list-disc" data-v-941153fc><li data-v-941153fc>Todos los datos personales del paciente</li><li data-v-941153fc>El historial de sesiones</li><li data-v-941153fc>Las notas terap√©uticas</li><li data-v-941153fc>Las m√©tricas de bienestar</li><li data-v-941153fc>Los bonos asociados</li></ul></div><div class="bg-blue-50 border border-blue-200 rounded-lg p-4" data-v-941153fc><p class="text-sm text-blue-800 font-medium mb-2" data-v-941153fc> üí° Recomendaci√≥n: </p><p class="text-sm text-blue-700 mb-3" data-v-941153fc> En lugar de eliminar, considera <strong data-v-941153fc>desactivar</strong> al paciente. Esto preservar√° el historial para consultas futuras. </p><button type="button"${r.ssrIncludeBooleanAttr(n.value)?" disabled":""} class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-sm" data-v-941153fc> Desactivar en lugar de eliminar </button></div>`),o.value?s(`<div class="bg-red-50 border border-red-200 rounded-lg p-3" data-v-941153fc><p class="text-sm text-red-600" data-v-941153fc>${r.ssrInterpolate(o.value)}</p></div>`):s("\x3c!----\x3e"),s(`</div><div class="px-6 py-4 border-t border-[#5550F2]/30 flex justify-end gap-3" data-v-941153fc><button type="button"${r.ssrIncludeBooleanAttr(n.value)?" disabled":""} class="px-6 py-2 border border-[#5550F2] text-[#2D3748] rounded-lg hover:bg-[#5550F2]/10 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" data-v-941153fc> Cancelar </button><button type="button"${r.ssrIncludeBooleanAttr(n.value)?" disabled":""} class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2" data-v-941153fc>`),n.value?s('<span class="inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin" data-v-941153fc></span>'):s("\x3c!----\x3e"),s(` ${r.ssrInterpolate(n.value?"Eliminando...":"Eliminar Definitivamente")}</button></div></div></div>`)):s("\x3c!----\x3e")}}},le=oe.setup;oe.setup=(e,t)=>{const r=a.useSSRContext();return(r.modules||(r.modules=new Set)).add("components/ModalEliminarPaciente.vue"),le?le(e,t):void 0};const de=y(oe,[["__scopeId","data-v-941153fc"]]),ie=a.defineComponent({__name:"ModalEditarCita",__ssrInlineRender:!0,props:{isOpen:{type:Boolean},citaId:{}},emits:["close","actualizado"],setup(e,{emit:t}){const s=e,n=w(),{getCitasPorDia:o}=g(),l=a.ref(null),d=a.ref(!1),i=a.ref(!1),c=a.ref(!1),u=a.ref({fecha_cita:"",hora_inicio:"",hora_fin:"",duracion:60,modalidad:"presencial",estado:"pendiente",observaciones:""}),p=a.computed(()=>{if(!u.value.fecha_cita)return"";return new Date(u.value.fecha_cita+"T00:00:00").toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}),m=a.computed(()=>{const e=new Date,t=[],formatearFecha=e=>e.toISOString().split("T")[0];t.push({label:"Hoy",fecha:formatearFecha(e)});const a=new Date(e);a.setDate(a.getDate()+1),t.push({label:"Ma√±ana",fecha:formatearFecha(a)});const r=["Lun","Mar","Mi√©","Jue","Vie"];let s=new Date(e),n=0;for(;n<5;){s.setDate(s.getDate()+1);const e=s.getDay();e>=1&&e<=5&&(t.push({label:`${r[e-1]} ${s.getDate()}`,fecha:formatearFecha(s)}),n++)}return t}),v=["08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00","18:30","19:00","19:30","20:00","20:30","21:00","21:30","22:00"],cargarCita=async()=>{if(console.log("üîç [ModalEditarCita] Cargando cita con ID:",s.citaId),s.citaId)try{d.value=!0;const{data:e,error:t}=await n.from("citas").select("\n        *,\n        paciente:pacientes!citas_paciente_id_fkey (\n          id,\n          nombre_completo,\n          email,\n          telefono\n        )\n      ").eq("id",s.citaId).single();if(t)throw console.error("‚ùå [ModalEditarCita] Error en query:",t),t;console.log("‚úÖ [ModalEditarCita] Cita cargada:",e),e&&(l.value=e,u.value={fecha_cita:e.fecha_cita,hora_inicio:e.hora_inicio?.substring(0,5)||"",hora_fin:e.hora_fin?.substring(0,5)||"",duracion:e.duracion||60,modalidad:e.modalidad||"presencial",estado:e.estado||"pendiente",observaciones:e.observaciones||""},console.log("üìù [ModalEditarCita] Formulario llenado:",u.value))}catch(e){console.error("üí• [ModalEditarCita] Error al cargar cita:",e)}finally{d.value=!1}else console.warn("‚ö†Ô∏è [ModalEditarCita] No hay citaId proporcionado")},horaAMinutos=e=>{if(!e||!e.includes(":"))return 0;const[t,a]=e.split(":").map(Number);return 60*(t||0)+(a||0)};return a.watch(()=>u.value.hora_inicio,e=>{if(e&&u.value.duracion){const[t,a]=e.split(":").map(Number),r=60*(t||0)+(a||0)+u.value.duracion,s=Math.floor(r/60),n=r%60;u.value.hora_fin=`${String(s).padStart(2,"0")}:${String(n).padStart(2,"0")}`}}),a.watch(()=>u.value.duracion,e=>{if(u.value.hora_inicio&&e){const[t,a]=u.value.hora_inicio.split(":").map(Number),r=60*(t||0)+(a||0)+e,s=Math.floor(r/60),n=r%60;u.value.hora_fin=`${String(s).padStart(2,"0")}:${String(n).padStart(2,"0")}`}}),a.watch([()=>u.value.fecha_cita,()=>u.value.hora_inicio,()=>u.value.hora_fin],()=>{(async()=>{if(u.value.fecha_cita&&u.value.hora_inicio&&u.value.hora_fin)try{const e=(await o(u.value.fecha_cita)).filter(e=>"cancelada"!==e.estado&&e.id!==s.citaId),t=u.value.hora_inicio,a=u.value.hora_fin;c.value=e.some(e=>{const r=e.hora_inicio?.substring(0,5),s=e.hora_fin?.substring(0,5),n=horaAMinutos(t),o=horaAMinutos(a),l=horaAMinutos(r),d=horaAMinutos(s);return n>=l&&n<d||o>l&&o<=d||n<=l&&o>=d})}catch(e){console.error("Error al verificar conflicto:",e),c.value=!1}else c.value=!1})()}),a.watch(()=>s.isOpen,e=>{console.log("üëÅÔ∏è [ModalEditarCita] Modal abierto:",e,"citaId:",s.citaId),e&&s.citaId&&cargarCita()}),a.watch(()=>s.citaId,e=>{console.log("üîÑ [ModalEditarCita] citaId cambi√≥ a:",e),s.isOpen&&e&&cargarCita()}),(t,a,s,n)=>{r.ssrRenderTeleport(a,t=>{e.isOpen?(t('<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" data-v-e8361a38><div class="bg-white dark:bg-gray-900 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden" data-v-e8361a38><div class="px-6 py-4 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20" data-v-e8361a38><div data-v-e8361a38><h2 class="text-2xl font-bold text-gray-900 dark:text-white" data-v-e8361a38>‚úèÔ∏è Editar Cita</h2>'),l.value?t(`<p class="text-sm text-gray-600 dark:text-gray-400 mt-1" data-v-e8361a38>${r.ssrInterpolate(l.value.paciente?.nombre_completo||l.value.paciente_nombre)}</p>`):t("\x3c!----\x3e"),t('</div><button class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors" aria-label="Cerrar" data-v-e8361a38><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-e8361a38><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" data-v-e8361a38></path></svg></button></div>'),d.value?t('<div class="p-12 flex flex-col items-center justify-center" data-v-e8361a38><div class="w-12 h-12 border-4 border-purple-200 border-t-purple-600 rounded-full animate-spin mb-4" data-v-e8361a38></div><p class="text-gray-600 dark:text-gray-400" data-v-e8361a38>Cargando...</p></div>'):l.value?(t(`<form class="px-6 py-4 overflow-y-auto max-h-[calc(90vh-200px)]" data-v-e8361a38><div class="space-y-6" data-v-e8361a38><div data-v-e8361a38><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" data-v-e8361a38> üìÖ Fecha </label><div class="space-y-2" data-v-e8361a38><input${r.ssrRenderAttr("value",u.value.fecha_cita)} type="date" required class="w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-800 dark:text-white cursor-pointer" data-v-e8361a38><div class="flex gap-2 flex-wrap" data-v-e8361a38>\x3c!--[--\x3e`),r.ssrRenderList(m.value,(e,a)=>{t(`<button type="button" class="${r.ssrRenderClass(["text-xs px-3 py-1.5 rounded-lg border transition-all",u.value.fecha_cita===e.fecha?"bg-purple-600 text-white border-purple-600 font-semibold":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 border-gray-300 dark:border-gray-600 hover:border-purple-500 hover:bg-purple-50 dark:hover:bg-purple-900/20"])}" data-v-e8361a38>${r.ssrInterpolate(e.label)}</button>`)}),t(`\x3c!--]--\x3e</div><p class="text-xs text-gray-500 dark:text-gray-400 capitalize" data-v-e8361a38>${r.ssrInterpolate(p.value)}</p></div></div><div class="grid grid-cols-1 md:grid-cols-3 gap-4" data-v-e8361a38><div class="md:col-span-2" data-v-e8361a38><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" data-v-e8361a38> üïê Hora Inicio </label><div class="space-y-3" data-v-e8361a38><div class="grid grid-cols-4 sm:grid-cols-6 gap-2 max-h-48 overflow-y-auto p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg border border-gray-200 dark:border-gray-700" data-v-e8361a38>\x3c!--[--\x3e`),r.ssrRenderList(v,e=>{t(`<button type="button" class="${r.ssrRenderClass(["px-3 py-2 text-sm font-medium rounded-lg transition-all border-2",u.value.hora_inicio===e?"bg-purple-600 text-white border-purple-600 shadow-md transform scale-105":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 border-gray-200 dark:border-gray-600 hover:border-purple-500 hover:bg-purple-50 dark:hover:bg-purple-900/20 hover:shadow"])}" data-v-e8361a38>${r.ssrInterpolate(e)}</button>`)}),t(`\x3c!--]--\x3e</div><details class="text-xs" data-v-e8361a38><summary class="cursor-pointer text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 select-none flex items-center gap-1" data-v-e8361a38><span data-v-e8361a38>‚å®Ô∏è</span><span data-v-e8361a38>Ingresar hora manualmente</span></summary><div class="mt-2" data-v-e8361a38><input${r.ssrRenderAttr("value",u.value.hora_inicio)} type="time" required step="1800" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-800 dark:text-white" data-v-e8361a38></div></details></div></div><div data-v-e8361a38><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" data-v-e8361a38> ‚è±Ô∏è Duraci√≥n (min) </label><select class="w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-800 dark:text-white" data-v-e8361a38><option${r.ssrRenderAttr("value",30)} data-v-e8361a38${r.ssrIncludeBooleanAttr(Array.isArray(u.value.duracion)?r.ssrLooseContain(u.value.duracion,30):r.ssrLooseEqual(u.value.duracion,30))?" selected":""}>30 min</option><option${r.ssrRenderAttr("value",45)} data-v-e8361a38${r.ssrIncludeBooleanAttr(Array.isArray(u.value.duracion)?r.ssrLooseContain(u.value.duracion,45):r.ssrLooseEqual(u.value.duracion,45))?" selected":""}>45 min</option><option${r.ssrRenderAttr("value",60)} data-v-e8361a38${r.ssrIncludeBooleanAttr(Array.isArray(u.value.duracion)?r.ssrLooseContain(u.value.duracion,60):r.ssrLooseEqual(u.value.duracion,60))?" selected":""}>60 min</option><option${r.ssrRenderAttr("value",90)} data-v-e8361a38${r.ssrIncludeBooleanAttr(Array.isArray(u.value.duracion)?r.ssrLooseContain(u.value.duracion,90):r.ssrLooseEqual(u.value.duracion,90))?" selected":""}>90 min</option></select></div><div data-v-e8361a38><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" data-v-e8361a38> üïë Hora Fin </label><input${r.ssrRenderAttr("value",u.value.hora_fin)} type="time" required readonly step="1800" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-800 dark:text-white" data-v-e8361a38></div></div>`),c.value?t('<div class="p-4 bg-yellow-50 dark:bg-yellow-900/20 border-2 border-yellow-300 dark:border-yellow-700 rounded-lg" data-v-e8361a38><div class="flex items-start gap-3" data-v-e8361a38><span class="text-2xl" data-v-e8361a38>‚ö†Ô∏è</span><div data-v-e8361a38><div class="font-semibold text-yellow-800 dark:text-yellow-300 mb-1" data-v-e8361a38> Conflicto de Horario </div><div class="text-sm text-yellow-700 dark:text-yellow-400" data-v-e8361a38> Ya existe otra cita en este horario. Por favor, selecciona otro horario. </div></div></div></div>'):t("\x3c!----\x3e"),t('<div data-v-e8361a38><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" data-v-e8361a38> üíª Modalidad </label><div class="grid grid-cols-3 gap-3" data-v-e8361a38>\x3c!--[--\x3e'),r.ssrRenderList([{valor:"presencial",icono:"üè•",nombre:"Presencial"},{valor:"online",icono:"üíª",nombre:"Online"},{valor:"telefonica",icono:"üìû",nombre:"Tel√©fono"}],e=>{t(`<button type="button" class="${r.ssrRenderClass(["p-3 border-2 rounded-lg transition-all",u.value.modalidad===e.valor?"border-purple-600 bg-purple-50 dark:bg-purple-900/20":"border-gray-300 dark:border-gray-700 hover:border-purple-400"])}" data-v-e8361a38><div class="text-2xl mb-1" data-v-e8361a38>${r.ssrInterpolate(e.icono)}</div><div class="text-sm font-medium text-gray-900 dark:text-white" data-v-e8361a38>${r.ssrInterpolate(e.nombre)}</div></button>`)}),t('\x3c!--]--\x3e</div></div><div data-v-e8361a38><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" data-v-e8361a38> üìä Estado </label><div class="grid grid-cols-2 md:grid-cols-4 gap-3" data-v-e8361a38>\x3c!--[--\x3e'),r.ssrRenderList([{valor:"pendiente",icono:"‚è≥",nombre:"Pendiente"},{valor:"confirmada",icono:"‚úÖ",nombre:"Confirmada"},{valor:"realizada",icono:"‚úì",nombre:"Realizada"},{valor:"cancelada",icono:"‚ùå",nombre:"Cancelada"}],e=>{t(`<button type="button" class="${r.ssrRenderClass(["p-2 border-2 rounded-lg transition-all",u.value.estado===e.valor?"border-purple-600 bg-purple-50 dark:bg-purple-900/20":"border-gray-300 dark:border-gray-700 hover:border-purple-400"])}" data-v-e8361a38><div class="text-xl mb-1" data-v-e8361a38>${r.ssrInterpolate(e.icono)}</div><div class="text-xs font-medium text-gray-900 dark:text-white" data-v-e8361a38>${r.ssrInterpolate(e.nombre)}</div></button>`)}),t(`\x3c!--]--\x3e</div></div><div data-v-e8361a38><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" data-v-e8361a38> üìù Observaciones </label><textarea rows="3" placeholder="Notas adicionales sobre la cita..." class="w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-800 dark:text-white" data-v-e8361a38>${r.ssrInterpolate(u.value.observaciones)}</textarea></div></div></form>`)):t("\x3c!----\x3e"),t(`<div class="px-6 py-4 border-t border-gray-200 dark:border-gray-800 flex gap-3 bg-gray-50 dark:bg-gray-800" data-v-e8361a38><button type="button" class="flex-1 px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors font-medium" data-v-e8361a38> Cancelar </button><button${r.ssrIncludeBooleanAttr(i.value||c.value)?" disabled":""} class="${r.ssrRenderClass(["flex-1 px-4 py-2 rounded-lg font-medium transition-colors",i.value||c.value?"bg-gray-400 dark:bg-gray-600 text-gray-200 cursor-not-allowed":"bg-purple-600 hover:bg-purple-700 text-white"])}" data-v-e8361a38>`),i.value?t("<span data-v-e8361a38>Guardando...</span>"):t("<span data-v-e8361a38>üíæ Guardar Cambios</span>"),t("</button></div></div></div>")):t("\x3c!----\x3e")},"body",!1,s)}}}),ce=ie.setup;ie.setup=(e,t)=>{const r=a.useSSRContext();return(r.modules||(r.modules=new Set)).add("components/ModalEditarCita.vue"),ce?ce(e,t):void 0};const ue=Object.assign(y(ie,[["__scopeId","data-v-e8361a38"]]),{__name:"ModalEditarCita"}),pe={__name:"ToastContainer",__ssrInlineRender:!0,setup(e){const{toasts:t}=h(),toastClasses=e=>{const t={success:"border-green-200 bg-green-50 text-green-800",error:"border-red-200 bg-red-50 text-red-800",warning:"border-amber-200 bg-amber-50 text-amber-800",info:"border-blue-200 bg-blue-50 text-blue-800"};return t[e]||t.info};return(e,s,n,o)=>{s(`<div${r.ssrRenderAttrs(a.mergeProps({class:"fixed bottom-4 right-4 z-50 flex flex-col gap-3 max-w-sm w-full pointer-events-none",role:"region","aria-live":"polite","aria-label":"Notificaciones"},o))} data-v-4b6dd325>\x3c!--[--\x3e`),r.ssrRenderList(a.unref(t),e=>{s(`<div class="${r.ssrRenderClass([toastClasses(e.type),"pointer-events-auto bg-white rounded-lg shadow-lg border p-4 flex items-start gap-3 transition-all duration-300"])}" role="alert" data-v-4b6dd325><div class="flex-shrink-0" data-v-4b6dd325>`),"success"===e.type?s(r.ssrRenderComponent(a.unref(_),{class:"w-5 h-5","aria-hidden":"true"},null,n)):"error"===e.type?s(r.ssrRenderComponent(a.unref(c),{class:"w-5 h-5","aria-hidden":"true"},null,n)):"warning"===e.type?s(r.ssrRenderComponent(a.unref(l),{class:"w-5 h-5","aria-hidden":"true"},null,n)):s(r.ssrRenderComponent(a.unref(C),{class:"w-5 h-5","aria-hidden":"true"},null,n)),s(`</div><p class="text-sm font-medium flex-1" data-v-4b6dd325>${r.ssrInterpolate(e.message)}</p><button class="min-h-[44px] min-w-[44px] p-2 -mr-2 -mt-2 hover:bg-gray-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-gray-300"${r.ssrRenderAttr("aria-label",`Cerrar notificaci√≥n: ${e.message}`)} data-v-4b6dd325>`),s(r.ssrRenderComponent(a.unref($),{class:"w-4 h-4","aria-hidden":"true"},null,n)),s("</button></div>")}),s("\x3c!--]--\x3e</div>")}}},me=pe.setup;pe.setup=(e,t)=>{const r=a.useSSRContext();return(r.modules||(r.modules=new Set)).add("components/ToastContainer.vue"),me?me(e,t):void 0};const ve=y(pe,[["__scopeId","data-v-4b6dd325"]]),be=a.defineComponent({__name:"FileDropzone",__ssrInlineRender:!0,props:{accept:{default:".csv,.xlsx,.xls"},maxSize:{default:10485760},supportedFormats:{default:"CSV, XLSX"},ariaLabel:{default:"Seleccionar archivo para subir"}},emits:["file-selected","file-removed","error"],setup(e,{expose:t,emit:s}){const n=e,o=s,l=a.ref(null),d=a.ref(!1),i=a.ref(""),c=a.computed(()=>!!i.value),u=a.computed(()=>Math.round(n.maxSize/1048576));return t({removeFile:()=>{l.value=null,i.value="",o("file-removed")}}),(t,s,n,o)=>{s(`<div${r.ssrRenderAttrs(a.mergeProps({class:["relative border-2 border-dashed rounded-xl p-8 transition-all duration-200 text-center",[a.unref(d)?"border-purple-600 bg-purple-50":"border-gray-300 bg-gray-50",a.unref(c)?"border-red-400 bg-red-50":"",a.unref(l)?"border-green-400 bg-green-50":""]]},o))}><div class="mb-4">`),a.unref(l)?s(r.ssrRenderComponent(a.unref(R),{class:"w-12 h-12 mx-auto text-green-600","aria-hidden":"true"},null,n)):s(r.ssrRenderComponent(a.unref(p),{class:["w-12 h-12 mx-auto",a.unref(d)?"text-purple-600":"text-gray-400"],"aria-hidden":"true"},null,n)),s("</div>"),a.unref(l)?(s(`<div class="flex items-center justify-center gap-4"><div class="text-left flex-1"><p class="text-sm font-semibold text-cafe">${r.ssrInterpolate(a.unref(l).name)}</p><p class="text-xs text-gray-500">${r.ssrInterpolate((e=>{if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["Bytes","KB","MB","GB"][t]})(a.unref(l).size))}</p></div><button class="min-h-[44px] min-w-[44px] p-2 text-red-600 hover:bg-red-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-red-300" aria-label="Eliminar archivo">`),s(r.ssrRenderComponent(a.unref($),{class:"w-6 h-6","aria-hidden":"true"},null,n)),s("</button></div>")):(s('<div><p class="text-lg font-medium text-cafe mb-2"> Arrastra tu archivo aqu√≠ </p><p class="text-sm text-gray-500 mb-4"> o haz clic para seleccionar </p><label class="inline-block"><span class="min-h-[44px] px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all font-medium shadow-sm hover:shadow-md cursor-pointer inline-flex items-center gap-2">'),s(r.ssrRenderComponent(a.unref(render$2),{class:"w-5 h-5","aria-hidden":"true"},null,n)),s(`<span>Seleccionar archivo</span></span><input type="file"${r.ssrRenderAttr("accept",e.accept)} class="hidden"${r.ssrRenderAttr("aria-label",e.ariaLabel)}></label><p class="text-xs text-gray-400 mt-4">${r.ssrInterpolate(e.supportedFormats)}</p><p class="text-xs text-gray-400"> Tama√±o m√°ximo: ${r.ssrInterpolate(a.unref(u))}MB </p></div>`)),a.unref(i)?s(`<div class="mt-4 p-3 bg-red-100 border border-red-300 rounded-lg"><p class="text-sm text-red-800 font-medium">${r.ssrInterpolate(a.unref(i))}</p></div>`):s("\x3c!----\x3e"),s("</div>")}}}),fe=be.setup;be.setup=(e,t)=>{const r=a.useSSRContext();return(r.modules||(r.modules=new Set)).add("components/shared/FileDropzone.vue"),fe?fe(e,t):void 0};const xe=Object.assign(be,{__name:"SharedFileDropzone"}),ge=a.defineComponent({__name:"ColumnMappingTable",__ssrInlineRender:!0,props:{detectedColumns:{},mappings:{},validation:{}},emits:["update:mapping"],setup(e,{emit:t}){const s=e,n=[{field:"nombre_completo",label:"Nombre Completo"},{field:"email",label:"Email"},{field:"telefono",label:"Tel√©fono"}],o=[{field:"documento_identidad",label:"Documento de Identidad"},{field:"fecha_nacimiento",label:"Fecha de Nacimiento"},{field:"direccion",label:"Direcci√≥n"},{field:"contacto_emergencia",label:"Contacto de Emergencia"}],d=[{field:"area_de_acompanamiento",label:"√Årea de Acompa√±amiento"},{field:"frecuencia",label:"Frecuencia de Sesiones"},{field:"activo",label:"Estado (Activo/Inactivo)"},{field:"derivacion",label:"Derivaci√≥n"},{field:"medicacion",label:"Medicaci√≥n"},{field:"orientacion_diagnostica",label:"Orientaci√≥n Diagn√≥stica"},{field:"inicio_tratamiento",label:"Inicio del Tratamiento"}],i=[{field:"precio_sesion",label:"Precio por Sesi√≥n"},{field:"comision",label:"Comisi√≥n"},{field:"notas",label:"Notas / Observaciones"}],u=[...n,...o,...d,...i],getMappedField=e=>{const t=s.mappings.find(t=>t.sourceColumn===e);return t?.targetField||""},isFieldUsed=(e,t)=>s.mappings.some(a=>a.targetField===e&&a.sourceColumn!==t),isRequiredField=e=>n.some(t=>t.field===e),p=a.computed(()=>s.mappings.filter(e=>e.targetField).map(e=>e.targetField)),m=a.computed(()=>{if(!s.detectedColumns.length||!p.value.length)return[];const e=Math.min(s.detectedColumns[0]?.sampleValues?.length||0,3),t=[];for(let a=0;a<e;a++){const e={};for(const t of s.mappings)if(t.targetField){const r=s.detectedColumns.find(e=>e.name===t.sourceColumn);e[t.targetField]=r?.sampleValues?.[a]||""}Object.keys(e).length>0&&t.push(e)}return t});return(t,s,b,f)=>{s(`<div${r.ssrRenderAttrs(a.mergeProps({class:"space-y-6"},f))}><div class="bg-blue-50 border border-blue-200 rounded-lg p-4"><div class="flex gap-3">`),s(r.ssrRenderComponent(a.unref(C),{class:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"},null,b)),s('<div><p class="font-semibold text-blue-900 mb-1"> Relaciona las columnas de tu archivo con los campos de Terapl√≠ </p><p class="text-sm text-blue-800"> Hemos detectado autom√°ticamente algunos campos. Revisa y ajusta seg√∫n necesites. </p></div></div></div><div class="overflow-x-auto border border-gray-200 rounded-lg"><table class="w-full text-sm"><thead class="bg-gray-50"><tr><th class="px-4 py-3 text-left font-semibold text-gray-700"> Columna en tu archivo </th><th class="px-4 py-3 text-left font-semibold text-gray-700"> Valores de ejemplo </th><th class="px-4 py-3 text-left font-semibold text-gray-700"> Campo Terapl√≠ </th><th class="px-4 py-3 text-center font-semibold text-gray-700 w-24"> Estado </th></tr></thead><tbody class="divide-y divide-gray-200">\x3c!--[--\x3e'),r.ssrRenderList(e.detectedColumns,e=>{s(`<tr class="hover:bg-gray-50"><td class="px-4 py-3"><span class="font-medium text-gray-900">${r.ssrInterpolate(e.name)}</span></td><td class="px-4 py-3"><div class="flex flex-wrap gap-1 max-w-xs">\x3c!--[--\x3e`),r.ssrRenderList(e.sampleValues.slice(0,3),(e,t)=>{s(`<span class="inline-block px-2 py-0.5 bg-gray-100 text-gray-600 rounded text-xs truncate max-w-[120px]"${r.ssrRenderAttr("title",e)}>${r.ssrInterpolate(e||"(vac√≠o)")}</span>`)}),s(`\x3c!--]--\x3e</div></td><td class="px-4 py-3"><select${r.ssrRenderAttr("value",getMappedField(e.name))} class="${r.ssrRenderClass([{"border-green-400 bg-green-50":getMappedField(e.name)&&isRequiredField(getMappedField(e.name)),"border-blue-300 bg-blue-50":getMappedField(e.name)&&!isRequiredField(getMappedField(e.name))},"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-purple-500 focus:border-purple-500"])}"><option value="">-- No importar --</option><optgroup label="Campos obligatorios">\x3c!--[--\x3e`),r.ssrRenderList(n,t=>{s(`<option${r.ssrRenderAttr("value",t.field)}${r.ssrIncludeBooleanAttr(isFieldUsed(t.field,e.name))?" disabled":""}>${r.ssrInterpolate(t.label)} ${r.ssrInterpolate(isFieldUsed(t.field,e.name)?"(ya usado)":"*")}</option>`)}),s('\x3c!--]--\x3e</optgroup><optgroup label="Contacto">\x3c!--[--\x3e'),r.ssrRenderList(o,t=>{s(`<option${r.ssrRenderAttr("value",t.field)}${r.ssrIncludeBooleanAttr(isFieldUsed(t.field,e.name))?" disabled":""}>${r.ssrInterpolate(t.label)} ${r.ssrInterpolate(isFieldUsed(t.field,e.name)?"(ya usado)":"")}</option>`)}),s('\x3c!--]--\x3e</optgroup><optgroup label="Tratamiento">\x3c!--[--\x3e'),r.ssrRenderList(d,t=>{s(`<option${r.ssrRenderAttr("value",t.field)}${r.ssrIncludeBooleanAttr(isFieldUsed(t.field,e.name))?" disabled":""}>${r.ssrInterpolate(t.label)} ${r.ssrInterpolate(isFieldUsed(t.field,e.name)?"(ya usado)":"")}</option>`)}),s('\x3c!--]--\x3e</optgroup><optgroup label="Otros campos">\x3c!--[--\x3e'),r.ssrRenderList(i,t=>{s(`<option${r.ssrRenderAttr("value",t.field)}${r.ssrIncludeBooleanAttr(isFieldUsed(t.field,e.name))?" disabled":""}>${r.ssrInterpolate(t.label)} ${r.ssrInterpolate(isFieldUsed(t.field,e.name)?"(ya usado)":"")}</option>`)}),s('\x3c!--]--\x3e</optgroup></select></td><td class="px-4 py-3 text-center">'),getMappedField(e.name)&&isRequiredField(getMappedField(e.name))?(s('<span class="inline-flex items-center gap-1 px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium">'),s(r.ssrRenderComponent(a.unref(_),{class:"w-3.5 h-3.5"},null,b)),s(" Obligatorio </span>")):getMappedField(e.name)?(s('<span class="inline-flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-medium">'),s(r.ssrRenderComponent(a.unref(_),{class:"w-3.5 h-3.5"},null,b)),s(" Opcional </span>")):s('<span class="inline-flex items-center gap-1 px-2 py-1 bg-gray-100 text-gray-500 rounded-full text-xs"> No importar </span>'),s("</td></tr>")}),s("\x3c!--]--\x3e</tbody></table></div>"),e.validation?.errors?.length?(s('<div class="bg-red-50 border border-red-200 rounded-lg p-4"><div class="flex gap-3">'),s(r.ssrRenderComponent(a.unref(l),{class:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"},null,b)),s('<div><p class="font-semibold text-red-900 mb-2"> Errores que impiden la importaci√≥n: </p><ul class="list-disc list-inside text-red-800 space-y-1 text-sm">\x3c!--[--\x3e'),r.ssrRenderList(e.validation.errors,(e,t)=>{s(`<li>${r.ssrInterpolate(e)}</li>`)}),s("\x3c!--]--\x3e</ul></div></div></div>")):s("\x3c!----\x3e"),e.validation?.warnings?.length&&!e.validation?.errors?.length?(s('<div class="bg-amber-50 border border-amber-200 rounded-lg p-4"><div class="flex gap-3">'),s(r.ssrRenderComponent(a.unref(c),{class:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"},null,b)),s('<div><p class="font-semibold text-amber-900 mb-2"> Advertencias (puedes continuar): </p><ul class="list-disc list-inside text-amber-800 space-y-1 text-sm">\x3c!--[--\x3e'),r.ssrRenderList(e.validation.warnings,(e,t)=>{s(`<li>${r.ssrInterpolate(e)}</li>`)}),s("\x3c!--]--\x3e</ul></div></div></div>")):s("\x3c!----\x3e"),a.unref(m).length>0?(s('<div class="space-y-3"><h4 class="font-semibold text-gray-900 flex items-center gap-2">'),s(r.ssrRenderComponent(a.unref(v),{class:"w-5 h-5 text-purple-600"},null,b)),s(' Vista previa con el mapeo aplicado </h4><div class="overflow-x-auto border border-gray-200 rounded-lg"><table class="w-full text-sm"><thead class="bg-purple-50"><tr>\x3c!--[--\x3e'),r.ssrRenderList(a.unref(p),e=>{s(`<th class="px-3 py-2 text-left font-medium text-purple-800 whitespace-nowrap">${r.ssrInterpolate((e=>u.find(t=>t.field===e)?.label||e)(e))}</th>`)}),s('\x3c!--]--\x3e</tr></thead><tbody class="divide-y divide-gray-100">\x3c!--[--\x3e'),r.ssrRenderList(a.unref(m),(e,t)=>{s('<tr class="hover:bg-gray-50">\x3c!--[--\x3e'),r.ssrRenderList(a.unref(p),t=>{s(`<td class="px-3 py-2 text-gray-700 whitespace-nowrap">${r.ssrInterpolate(e[t]||"‚Äî")}</td>`)}),s("\x3c!--]--\x3e</tr>")}),s(`\x3c!--]--\x3e</tbody></table></div><p class="text-xs text-gray-500"> Mostrando las primeras ${r.ssrInterpolate(a.unref(m).length)} fila${r.ssrInterpolate(1!==a.unref(m).length?"s":"")} de tu archivo </p></div>`)):s("\x3c!----\x3e"),s("</div>")}}}),he=ge.setup;ge.setup=(e,t)=>{const r=a.useSSRContext();return(r.modules||(r.modules=new Set)).add("components/patients/ColumnMappingTable.vue"),he?he(e,t):void 0};const ye=Object.assign(ge,{__name:"PatientsColumnMappingTable"});const we=a.defineComponent({__name:"PatientsImportModal",__ssrInlineRender:!0,props:{modelValue:{type:Boolean},existingPatients:{default:()=>[]}},emits:["update:modelValue","import-complete"],setup(e,{emit:t}){const s=h(),n=function(){const e=a.ref(null),t=a.ref([]),r=a.ref(null),s=a.ref(null),n=a.ref(!1),o=a.ref(!1),l=a.ref(!1),d=a.ref(null),validateMapping=async()=>{if(!e.value)return d.value="No hay configuraci√≥n de importaci√≥n",!1;o.value=!0,d.value=null;try{const a=await fetch("/api/patients/import/validate-mapping",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({configId:e.value.id,mappings:t.value})});if(!a.ok){const e=await a.json();throw new Error(e.statusMessage||"Error al validar mapeo")}const s=await a.json();return r.value=s.validation,s.validation?.isValid||!1}catch(e){return d.value=e.message||"Error al validar mapeo",console.error("Error en validateMapping:",e),!1}finally{o.value=!1}},i=a.computed(()=>{const e=new Set(t.value.map(e=>e.targetField).filter(e=>""!==e)),a=e.has("nombre_completo"),r=e.has("email")||e.has("telefono");return a&&r});return{config:e,mappings:t,validation:r,importResult:s,detecting:n,validating:o,importing:l,error:d,detectColumns:async a=>{n.value=!0,d.value=null;try{const r=new FormData;r.append("file",a);const s=await fetch("/api/patients/import/detect-columns",{method:"POST",body:r});if(!s.ok){const e=await s.json();throw new Error(e.statusMessage||"Error al detectar columnas")}const n=await s.json();if(!n.success||!n.config)throw new Error("Respuesta inv√°lida del servidor");return e.value=n.config,t.value=n.config.mappings||[],await validateMapping(),!0}catch(e){return d.value=e.message||"Error al detectar columnas",console.error("Error en detectColumns:",e),!1}finally{n.value=!1}},updateMapping:(e,a)=>{const r=t.value.findIndex(t=>t.sourceColumn===e);r>=0?t.value[r]={sourceColumn:e,targetField:a}:t.value.push({sourceColumn:e,targetField:a}),validateMapping()},validateMapping:validateMapping,executeImport:async(a,n)=>{if(!e.value)return d.value="No hay configuraci√≥n de importaci√≥n",!1;if(!r.value?.isValid)return d.value="El mapeo no es v√°lido",!1;l.value=!0,d.value=null;try{const r=new FormData;r.append("file",a),r.append("configId",e.value.id),r.append("action",n),r.append("mappings",JSON.stringify(t.value));const o=await fetch("/api/patients/import/execute",{method:"POST",body:r});if(!o.ok){const e=await o.json();throw new Error(e.statusMessage||"Error al importar pacientes")}const l=await o.json();return s.value=l.results,l.success}catch(e){return d.value=e.message||"Error al importar pacientes",console.error("Error en executeImport:",e),!1}finally{l.value=!1}},reset:()=>{e.value=null,t.value=[],r.value=null,s.value=null,n.value=!1,o.value=!1,l.value=!1,d.value=null},getMappedField:e=>{const a=t.value.find(t=>t.sourceColumn===e);return a?.targetField||""},getPreviewData:()=>{if(!e.value?.detectedColumns)return[];const a=Math.min(e.value.detectedColumns[0]?.sampleValues?.length||0,3),r=[];for(let s=0;s<a;s++){const a={};for(const r of t.value)if(r.targetField){const t=e.value.detectedColumns.find(e=>e.name===r.sourceColumn);a[r.targetField]=t?.sampleValues?.[s]||""}r.push(a)}return r},hasRequiredFields:i}}(),o=a.ref(1),d=a.ref(null),i=a.ref(!1),u=a.ref(!0),m=a.ref(!1),v={nombre_completo:"Nombre Completo",email:"Email",telefono:"Tel√©fono",documento_identidad:"Documento",fecha_nacimiento:"Fecha Nac.",direccion:"Direcci√≥n",contacto_emergencia:"Contacto Emergencia",area_de_acompanamiento:"√Årea",frecuencia:"Frecuencia",activo:"Estado",derivacion:"Derivaci√≥n",medicacion:"Medicaci√≥n",orientacion_diagnostica:"Diagn√≥stico",inicio_tratamiento:"Inicio Trat.",precio_sesion:"Precio",comision:"Comisi√≥n",notas:"Notas"},getFieldLabel=e=>e?v[e]||e:"";a.computed(()=>null!==d.value||null!==n.config.value||o.value>1);const handleFileSelected=e=>{d.value=e,n.error.value=null,s.info("Archivo seleccionado correctamente")},handleFileRemoved=()=>{d.value=null,n.reset()},handleDropzoneError=e=>{s.error(e)},handleMappingUpdate=(e,t)=>{n.updateMapping(e,t)};return(t,s,v,b)=>{const f=xe,x=ye;r.ssrRenderTeleport(s,t=>{e.modelValue?(t(`<div class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50" role="dialog" aria-modal="true" aria-labelledby="import-modal-title" data-v-97261e0d><div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col" data-v-97261e0d><div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between" data-v-97261e0d><div data-v-97261e0d><h2 id="import-modal-title" class="text-2xl font-serif font-bold text-cafe" data-v-97261e0d> Importar Pacientes </h2><p class="text-sm text-gray-500 mt-1" data-v-97261e0d> Paso ${r.ssrInterpolate(a.unref(o))} de 5 </p></div><button class="min-h-[44px] min-w-[44px] p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-gray-300" aria-label="Cerrar modal" data-v-97261e0d>`),t(r.ssrRenderComponent(a.unref($),{class:"w-6 h-6","aria-hidden":"true"},null,v)),t('</button></div><div class="px-6 py-3 bg-gray-50" data-v-97261e0d><div class="flex items-center gap-2" data-v-97261e0d>\x3c!--[--\x3e'),r.ssrRenderList(5,e=>{t(`<div class="${r.ssrRenderClass([e<=a.unref(o)?"bg-purple-600":"bg-gray-200","flex-1 h-2 rounded-full transition-all duration-300"])}" data-v-97261e0d></div>`)}),t(`\x3c!--]--\x3e</div><div class="flex justify-between mt-2 text-xs text-gray-500" data-v-97261e0d><span class="${r.ssrRenderClass({"text-purple-600 font-medium":1===a.unref(o)})}" data-v-97261e0d>Info</span><span class="${r.ssrRenderClass({"text-purple-600 font-medium":2===a.unref(o)})}" data-v-97261e0d>Subir</span><span class="${r.ssrRenderClass({"text-purple-600 font-medium":3===a.unref(o)})}" data-v-97261e0d>Mapear</span><span class="${r.ssrRenderClass({"text-purple-600 font-medium":4===a.unref(o)})}" data-v-97261e0d>Revisar</span><span class="${r.ssrRenderClass({"text-purple-600 font-medium":5===a.unref(o)})}" data-v-97261e0d>Resultado</span></div></div><div class="flex-1 overflow-y-auto p-6" data-v-97261e0d>`),1===a.unref(o)?(t('<div class="space-y-6" data-v-97261e0d><div class="text-center" data-v-97261e0d>'),t(r.ssrRenderComponent(a.unref(render$3),{class:"w-16 h-16 mx-auto text-purple-600 mb-4","aria-hidden":"true"},null,v)),t('<h3 class="text-lg font-semibold text-cafe mb-2" data-v-97261e0d> Paso 1: Prepara tu archivo </h3><p class="text-sm text-gray-600 mb-2 max-w-md mx-auto" data-v-97261e0d> Puedes usar <strong data-v-97261e0d>cualquier Excel o CSV</strong> con tus pacientes. El sistema detectar√° las columnas autom√°ticamente. </p></div><div class="bg-green-50 border border-green-200 rounded-lg p-4 text-sm" data-v-97261e0d><div class="flex gap-3" data-v-97261e0d>'),t(r.ssrRenderComponent(a.unref(_),{class:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5","aria-hidden":"true"},null,v)),t('<div data-v-97261e0d><p class="font-semibold text-green-900 mb-2" data-v-97261e0d>¬øYa tienes un Excel con pacientes?</p><p class="text-green-800" data-v-97261e0d> ¬°Perfecto! Puedes subirlo directamente. En el siguiente paso podr√°s relacionar las columnas de tu archivo con los campos de Terapl√≠. </p></div></div></div><div class="bg-blue-50 border border-blue-200 rounded-lg p-4 text-sm" data-v-97261e0d><div class="flex gap-3" data-v-97261e0d>'),t(r.ssrRenderComponent(a.unref(C),{class:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5","aria-hidden":"true"},null,v)),t(`<div class="space-y-3" data-v-97261e0d><div data-v-97261e0d><p class="font-semibold text-blue-900 mb-1" data-v-97261e0d>Formatos aceptados:</p><p class="text-blue-800" data-v-97261e0d>CSV (.csv) y Excel (.xlsx, .xls)</p><p class="text-xs text-blue-700 mt-1" data-v-97261e0d>Tama√±o m√°ximo: 10MB | M√°ximo 5,000 filas</p></div><div data-v-97261e0d><p class="font-semibold text-blue-900 mb-1" data-v-97261e0d>Campos m√≠nimos necesarios:</p><ul class="list-disc list-inside text-blue-800 space-y-1" data-v-97261e0d><li data-v-97261e0d><strong data-v-97261e0d>Nombre</strong> del paciente (obligatorio)</li><li data-v-97261e0d><strong data-v-97261e0d>Email</strong> o <strong data-v-97261e0d>Tel√©fono</strong> (al menos uno)</li></ul></div><div data-v-97261e0d><p class="font-semibold text-blue-900 mb-1" data-v-97261e0d>Campos adicionales soportados:</p><p class="text-blue-800 text-xs" data-v-97261e0d> Documento de identidad, Direcci√≥n, Fecha de nacimiento, √Årea de tratamiento, Frecuencia, Derivaci√≥n, Medicaci√≥n, Diagn√≥stico, Notas, Precio, y m√°s... </p></div></div></div></div><div class="flex gap-3 justify-center pt-2" data-v-97261e0d><button${r.ssrIncludeBooleanAttr(a.unref(i))?" disabled":""} class="min-h-[44px] px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all text-sm disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2" data-v-97261e0d>`),t(r.ssrRenderComponent(a.unref(R),{class:"w-4 h-4","aria-hidden":"true"},null,v)),t(`<span data-v-97261e0d>Descargar plantilla CSV</span></button><button${r.ssrIncludeBooleanAttr(a.unref(i))?" disabled":""} class="min-h-[44px] px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all text-sm disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2" data-v-97261e0d>`),t(r.ssrRenderComponent(a.unref(R),{class:"w-4 h-4","aria-hidden":"true"},null,v)),t("<span data-v-97261e0d>Descargar plantilla Excel</span></button></div></div>")):t("\x3c!----\x3e"),2===a.unref(o)?(t('<div class="space-y-6" data-v-97261e0d><div class="text-center mb-6" data-v-97261e0d>'),t(r.ssrRenderComponent(a.unref(p),{class:"w-16 h-16 mx-auto text-purple-600 mb-4","aria-hidden":"true"},null,v)),t('<h3 class="text-lg font-semibold text-cafe mb-2" data-v-97261e0d> Paso 2: Sube tu archivo </h3><p class="text-sm text-gray-600 mb-1" data-v-97261e0d> Arrastra tu archivo o haz clic para seleccionarlo </p><p class="text-xs text-gray-500" data-v-97261e0d> Detectaremos las columnas autom√°ticamente </p></div>'),t(r.ssrRenderComponent(f,{onFileSelected:handleFileSelected,onFileRemoved:handleFileRemoved,onError:handleDropzoneError},null,v)),a.unref(d)&&!a.unref(n).detecting.value?(t('<div class="bg-green-50 border border-green-200 rounded-lg p-4 text-sm" data-v-97261e0d><div class="flex gap-3" data-v-97261e0d>'),t(r.ssrRenderComponent(a.unref(_),{class:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5","aria-hidden":"true"},null,v)),t(`<div class="flex-1" data-v-97261e0d><p class="font-semibold text-green-900 mb-1" data-v-97261e0d>Archivo seleccionado correctamente</p><p class="text-green-800" data-v-97261e0d>${r.ssrInterpolate(a.unref(d).name)}</p><p class="text-xs text-green-700 mt-1" data-v-97261e0d> Haz clic en &quot;Detectar columnas&quot; para continuar </p></div></div></div>`)):t("\x3c!----\x3e"),a.unref(n).detecting.value?t('<div class="bg-purple-50 border border-purple-200 rounded-lg p-6" data-v-97261e0d><div class="flex flex-col items-center justify-center gap-4" data-v-97261e0d><div class="animate-spin w-12 h-12 border-4 border-purple-600 border-t-transparent rounded-full" data-v-97261e0d></div><div class="text-center" data-v-97261e0d><p class="text-purple-900 font-medium mb-1" data-v-97261e0d>Analizando archivo...</p><p class="text-sm text-purple-700" data-v-97261e0d>Detectando columnas y sugiriendo mapeo</p></div></div></div>'):t("\x3c!----\x3e"),a.unref(n).error.value?(t('<div class="bg-red-50 border border-red-200 rounded-lg p-4 text-sm" data-v-97261e0d><div class="flex gap-3" data-v-97261e0d>'),t(r.ssrRenderComponent(a.unref(l),{class:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5","aria-hidden":"true"},null,v)),t(`<div data-v-97261e0d><p class="font-semibold text-red-900 mb-1" data-v-97261e0d>Error al procesar archivo</p><p class="text-red-800" data-v-97261e0d>${r.ssrInterpolate(a.unref(n).error.value)}</p></div></div></div>`)):t("\x3c!----\x3e"),t("</div>")):t("\x3c!----\x3e"),3===a.unref(o)?(t('<div class="space-y-6" data-v-97261e0d><div class="text-center mb-6" data-v-97261e0d>'),t(r.ssrRenderComponent(a.unref(render$6),{class:"w-16 h-16 mx-auto text-purple-600 mb-4","aria-hidden":"true"},null,v)),t('<h3 class="text-lg font-semibold text-cafe mb-2" data-v-97261e0d> Paso 3: Mapea las columnas </h3><p class="text-sm text-gray-600" data-v-97261e0d> Relaciona las columnas de tu archivo con los campos de Terapl√≠ </p></div>'),t(r.ssrRenderComponent(x,{"detected-columns":a.unref(n).config.value?.detectedColumns||[],mappings:a.unref(n).mappings.value,validation:a.unref(n).validation.value,"onUpdate:mapping":handleMappingUpdate},null,v)),t("</div>")):t("\x3c!----\x3e"),4===a.unref(o)?(t('<div class="space-y-6" data-v-97261e0d><div class="text-center mb-6" data-v-97261e0d>'),t(r.ssrRenderComponent(a.unref(render$4),{class:"w-16 h-16 mx-auto text-purple-600 mb-4","aria-hidden":"true"},null,v)),t('<h3 class="text-lg font-semibold text-cafe mb-2" data-v-97261e0d> Paso 4: Confirma la importaci√≥n </h3><p class="text-sm text-gray-600" data-v-97261e0d> Revisa el resumen antes de importar </p></div><div class="bg-gray-50 border border-gray-200 rounded-lg p-4" data-v-97261e0d><h4 class="font-semibold text-gray-900 mb-3" data-v-97261e0d>Campos que se importar√°n:</h4><div class="flex flex-wrap gap-2" data-v-97261e0d>\x3c!--[--\x3e'),r.ssrRenderList(a.unref(n).mappings.value.filter(e=>e.targetField),e=>{t('<span class="inline-flex items-center gap-1 px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm" data-v-97261e0d>'),t(r.ssrRenderComponent(a.unref(_),{class:"w-4 h-4"},null,v)),t(` ${r.ssrInterpolate(getFieldLabel(e.targetField))}</span>`)}),t("\x3c!--]--\x3e</div></div>"),a.unref(n).validation.value?.warnings?.length?(t('<div class="bg-amber-50 border border-amber-200 rounded-lg p-4" data-v-97261e0d><div class="flex gap-3" data-v-97261e0d>'),t(r.ssrRenderComponent(a.unref(c),{class:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5","aria-hidden":"true"},null,v)),t('<div data-v-97261e0d><p class="font-semibold text-amber-900 mb-2" data-v-97261e0d>Advertencias:</p><ul class="text-sm text-amber-800 space-y-1" data-v-97261e0d>\x3c!--[--\x3e'),r.ssrRenderList(a.unref(n).validation.value.warnings,(e,a)=>{t(`<li data-v-97261e0d> ‚Ä¢ ${r.ssrInterpolate(e)}</li>`)}),t("\x3c!--]--\x3e</ul></div></div></div>")):t("\x3c!----\x3e"),t(`<div class="bg-blue-50 border border-blue-200 rounded-lg p-4" data-v-97261e0d><label class="flex items-start gap-3 cursor-pointer" data-v-97261e0d><input type="checkbox"${r.ssrIncludeBooleanAttr(Array.isArray(a.unref(u))?r.ssrLooseContain(a.unref(u),null):a.unref(u))?" checked":""} class="mt-1 w-5 h-5 text-purple-600 border-gray-300 rounded focus:ring-2 focus:ring-purple-300 cursor-pointer" data-v-97261e0d><div class="flex-1" data-v-97261e0d><p class="font-semibold text-blue-900 mb-1" data-v-97261e0d> Actualizar pacientes existentes </p><p class="text-sm text-blue-800" data-v-97261e0d> Si un paciente ya existe (mismo email o tel√©fono), actualizar sus datos con la informaci√≥n del archivo. </p><p class="text-xs text-blue-700 mt-1" data-v-97261e0d> Si no marcas esta opci√≥n, los pacientes duplicados se omitir√°n. </p></div></label></div>`),a.unref(n).getPreviewData().length>0?(t('<div class="space-y-3" data-v-97261e0d><h4 class="font-semibold text-gray-900" data-v-97261e0d>Vista previa de datos:</h4><div class="overflow-x-auto border border-gray-200 rounded-lg" data-v-97261e0d><table class="w-full text-sm" data-v-97261e0d><thead class="bg-gray-50" data-v-97261e0d><tr data-v-97261e0d>\x3c!--[--\x3e'),r.ssrRenderList(a.unref(n).mappings.value.filter(e=>e.targetField),e=>{t(`<th class="px-3 py-2 text-left font-medium text-gray-700 whitespace-nowrap" data-v-97261e0d>${r.ssrInterpolate(getFieldLabel(e.targetField))}</th>`)}),t('\x3c!--]--\x3e</tr></thead><tbody class="divide-y divide-gray-100" data-v-97261e0d>\x3c!--[--\x3e'),r.ssrRenderList(a.unref(n).getPreviewData(),(e,s)=>{t("<tr data-v-97261e0d>\x3c!--[--\x3e"),r.ssrRenderList(a.unref(n).mappings.value.filter(e=>e.targetField),a=>{t(`<td class="px-3 py-2 text-gray-600 whitespace-nowrap" data-v-97261e0d>${r.ssrInterpolate(e[a.targetField]||"‚Äî")}</td>`)}),t("\x3c!--]--\x3e</tr>")}),t('\x3c!--]--\x3e</tbody></table></div><p class="text-xs text-gray-500" data-v-97261e0d>Vista previa de las primeras filas</p></div>')):t("\x3c!----\x3e"),t("</div>")):t("\x3c!----\x3e"),5===a.unref(o)?(t('<div class="space-y-6" data-v-97261e0d><div class="text-center mb-6" data-v-97261e0d>'),a.unref(m)?t(r.ssrRenderComponent(a.unref(_),{class:"w-16 h-16 mx-auto text-green-600 mb-4","aria-hidden":"true"},null,v)):t(r.ssrRenderComponent(a.unref(c),{class:"w-16 h-16 mx-auto text-amber-600 mb-4","aria-hidden":"true"},null,v)),t(`<h3 class="text-lg font-semibold text-cafe mb-2" data-v-97261e0d>${r.ssrInterpolate(a.unref(m)?"Importaci√≥n completada con √©xito":"Importaci√≥n completada con advertencias")}</h3><p class="text-sm text-gray-600" data-v-97261e0d>${r.ssrInterpolate(a.unref(m)?"Los pacientes se han importado correctamente":"La importaci√≥n se complet√≥ pero algunos pacientes tienen perfil incompleto")}</p></div>`),a.unref(n).importResult.value?t(`<div class="grid grid-cols-2 md:grid-cols-4 gap-4" data-v-97261e0d><div class="bg-gray-50 rounded-lg p-4 text-center" data-v-97261e0d><p class="text-2xl font-bold text-cafe" data-v-97261e0d>${r.ssrInterpolate(a.unref(n).importResult.value.total)}</p><p class="text-xs text-gray-600" data-v-97261e0d>Total</p></div><div class="bg-green-50 rounded-lg p-4 text-center" data-v-97261e0d><p class="text-2xl font-bold text-green-700" data-v-97261e0d>${r.ssrInterpolate(a.unref(n).importResult.value.created)}</p><p class="text-xs text-gray-600" data-v-97261e0d>Creados</p></div><div class="bg-blue-50 rounded-lg p-4 text-center" data-v-97261e0d><p class="text-2xl font-bold text-blue-700" data-v-97261e0d>${r.ssrInterpolate(a.unref(n).importResult.value.updated)}</p><p class="text-xs text-gray-600" data-v-97261e0d>Actualizados</p></div><div class="bg-gray-100 rounded-lg p-4 text-center" data-v-97261e0d><p class="text-2xl font-bold text-gray-700" data-v-97261e0d>${r.ssrInterpolate(a.unref(n).importResult.value.skipped)}</p><p class="text-xs text-gray-600" data-v-97261e0d>Omitidos</p></div></div>`):t("\x3c!----\x3e"),a.unref(m)?(t('<div class="bg-green-50 border border-green-200 rounded-lg p-4" data-v-97261e0d><div class="flex gap-3" data-v-97261e0d>'),t(r.ssrRenderComponent(a.unref(_),{class:"w-6 h-6 text-green-600 flex-shrink-0 mt-0.5","aria-hidden":"true"},null,v)),t('<div class="flex-1" data-v-97261e0d><p class="font-semibold text-green-900 mb-2" data-v-97261e0d>¬°Importaci√≥n exitosa!</p><p class="text-sm text-green-800" data-v-97261e0d> Los pacientes se han a√±adido a tu lista y ya puedes gestionar sus citas y tratamientos. </p></div></div></div>')):t("\x3c!----\x3e"),a.unref(n).importResult.value?.incompleteProfiles?.length?(t('<div class="bg-amber-50 border border-amber-200 rounded-lg p-4" data-v-97261e0d><div class="flex gap-3" data-v-97261e0d>'),t(r.ssrRenderComponent(a.unref(c),{class:"w-6 h-6 text-amber-600 flex-shrink-0 mt-0.5","aria-hidden":"true"},null,v)),t(`<div class="flex-1" data-v-97261e0d><p class="font-semibold text-amber-900 mb-2" data-v-97261e0d>${r.ssrInterpolate(a.unref(n).importResult.value.incompleteProfiles.length)} paciente${r.ssrInterpolate(1!==a.unref(n).importResult.value.incompleteProfiles.length?"s":"")} con perfil incompleto </p><p class="text-sm text-amber-800 mb-3" data-v-97261e0d> Los siguientes pacientes fueron importados pero les faltan datos importantes: </p><div class="max-h-40 overflow-y-auto space-y-2" data-v-97261e0d>\x3c!--[--\x3e`),r.ssrRenderList(a.unref(n).importResult.value.incompleteProfiles.slice(0,5),e=>{t(`<div class="bg-white border border-amber-200 rounded p-2 text-sm" data-v-97261e0d><span class="font-medium text-amber-900" data-v-97261e0d>${r.ssrInterpolate(e.nombre_completo)}</span><span class="text-amber-700" data-v-97261e0d> ‚Äî Faltan: ${r.ssrInterpolate(e.missingFields.join(", "))}</span></div>`)}),t("\x3c!--]--\x3e"),a.unref(n).importResult.value.incompleteProfiles.length>5?t(`<p class="text-xs text-amber-700 italic" data-v-97261e0d> ... y ${r.ssrInterpolate(a.unref(n).importResult.value.incompleteProfiles.length-5)} m√°s </p>`):t("\x3c!----\x3e"),t('</div><p class="text-xs text-amber-700 mt-3" data-v-97261e0d> üí° Puedes completar esta informaci√≥n editando cada paciente desde la lista. </p></div></div></div>')):t("\x3c!----\x3e"),a.unref(n).importResult.value?.errors?.length?(t('<div class="bg-red-50 border border-red-200 rounded-lg p-4" data-v-97261e0d><h4 class="font-semibold text-red-900 mb-3 flex items-center gap-2" data-v-97261e0d>'),t(r.ssrRenderComponent(a.unref(l),{class:"w-5 h-5","aria-hidden":"true"},null,v)),t(` Errores durante la importaci√≥n (${r.ssrInterpolate(a.unref(n).importResult.value.errors.length)}) </h4><div class="max-h-40 overflow-y-auto space-y-2" data-v-97261e0d>\x3c!--[--\x3e`),r.ssrRenderList(a.unref(n).importResult.value.errors.slice(0,10),(e,a)=>{t(`<div class="bg-white border border-red-200 rounded p-2 text-sm text-red-800" data-v-97261e0d><span class="font-semibold" data-v-97261e0d>Fila ${r.ssrInterpolate(e.row)}:</span> ${r.ssrInterpolate(e.error)}</div>`)}),t("\x3c!--]--\x3e</div></div>")):t("\x3c!----\x3e"),t("</div>")):t("\x3c!----\x3e"),t('</div><div class="px-6 py-4 border-t border-gray-200 flex items-center justify-between bg-gray-50" data-v-97261e0d>'),a.unref(o)>1&&a.unref(o)<5?t(`<button${r.ssrIncludeBooleanAttr(a.unref(n).importing.value||a.unref(n).detecting.value)?" disabled":""} class="min-h-[44px] px-6 py-2.5 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-all font-medium disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-gray-300" data-v-97261e0d> Atr√°s </button>`):t("<div data-v-97261e0d></div>"),t('<div class="flex gap-3" data-v-97261e0d>'),a.unref(o)<5?t(`<button${r.ssrIncludeBooleanAttr(a.unref(n).importing.value)?" disabled":""} class="min-h-[44px] px-6 py-2.5 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all font-medium disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-gray-300" data-v-97261e0d> Cancelar </button>`):t("\x3c!----\x3e"),1===a.unref(o)?t('<button class="min-h-[44px] px-6 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all font-medium shadow-sm hover:shadow-md focus:outline-none focus:ring-2 focus:ring-purple-300" data-v-97261e0d> Continuar </button>'):t("\x3c!----\x3e"),2===a.unref(o)?(t(`<button${r.ssrIncludeBooleanAttr(!a.unref(d)||a.unref(n).detecting.value)?" disabled":""} class="min-h-[44px] px-6 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all font-medium shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-purple-300 flex items-center gap-2" data-v-97261e0d>`),a.unref(n).detecting.value?t('<div class="animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full" data-v-97261e0d></div>'):t("\x3c!----\x3e"),t(`<span data-v-97261e0d>${r.ssrInterpolate(a.unref(n).detecting.value?"Analizando...":"Detectar columnas")}</span></button>`)):t("\x3c!----\x3e"),3===a.unref(o)?t(`<button${r.ssrIncludeBooleanAttr(!a.unref(n).validation.value?.isValid)?" disabled":""} class="min-h-[44px] px-6 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all font-medium shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-purple-300" data-v-97261e0d> Continuar </button>`):t("\x3c!----\x3e"),4===a.unref(o)?(t(`<button${r.ssrIncludeBooleanAttr(a.unref(n).importing.value)?" disabled":""} class="min-h-[44px] px-6 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all font-medium shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-purple-300 flex items-center gap-2" data-v-97261e0d>`),a.unref(n).importing.value?t('<div class="animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full" data-v-97261e0d></div>'):t("\x3c!----\x3e"),t(`<span data-v-97261e0d>${r.ssrInterpolate(a.unref(n).importing.value?"Importando...":"Importar pacientes")}</span></button>`)):t("\x3c!----\x3e"),5===a.unref(o)?t('<button class="min-h-[44px] px-6 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all font-medium shadow-sm hover:shadow-md focus:outline-none focus:ring-2 focus:ring-purple-300" data-v-97261e0d> Finalizar </button>'):t("\x3c!----\x3e"),t("</div></div></div></div>")):t("\x3c!----\x3e")},"body",!1,v)}}}),_e=we.setup;we.setup=(e,t)=>{const r=a.useSSRContext();return(r.modules||(r.modules=new Set)).add("components/patients/PatientsImportModal.vue"),_e?_e(e,t):void 0};const Ce=Object.assign(y(we,[["__scopeId","data-v-97261e0d"]]),{__name:"PatientsImportModal"}),$e=a.defineComponent({__name:"PatientsExportModal",__ssrInlineRender:!0,props:{modelValue:{type:Boolean},totalPatients:{},filteredCount:{},selectedCount:{default:0},hasFilters:{type:Boolean,default:!1},currentFilters:{default:()=>({})},selectedIds:{default:()=>[]}},emits:["update:modelValue"],setup(e,{emit:t}){const s=e,n=a.ref("csv"),o=a.ref("all"),l=a.ref(["nombre_completo","email","telefono","area_de_acompanamiento","frecuencia","activo"]),d=a.ref(!1),i=[{value:"nombre_completo",label:"Nombre Completo"},{value:"email",label:"Email"},{value:"telefono",label:"Tel√©fono"},{value:"area_de_acompanamiento",label:"√Årea"},{value:"frecuencia",label:"Frecuencia"},{value:"activo",label:"Estado"},{value:"ultima_sesion",label:"√öltima Sesi√≥n"},{value:"proxima_sesion",label:"Pr√≥xima Sesi√≥n"},{value:"total_sesiones",label:"Total Sesiones"},{value:"created_at",label:"Fecha de Registro"}];return a.watchEffect(()=>{s.selectedCount>0?o.value="selected":s.hasFilters?o.value="filtered":o.value="all"}),(t,s,c,u)=>{r.ssrRenderTeleport(s,t=>{e.modelValue?(t('<div class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50" role="dialog" aria-modal="true" aria-labelledby="export-modal-title" data-v-797ad56f><div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col" data-v-797ad56f><div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between" data-v-797ad56f><div data-v-797ad56f><h2 id="export-modal-title" class="text-2xl font-serif font-bold text-cafe" data-v-797ad56f> Exportar Pacientes </h2><p class="text-sm text-gray-500 mt-1" data-v-797ad56f> Selecciona las opciones de exportaci√≥n </p></div><button class="min-h-[44px] min-w-[44px] p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-gray-300" aria-label="Cerrar modal" data-v-797ad56f>'),t(r.ssrRenderComponent(a.unref($),{class:"w-6 h-6","aria-hidden":"true"},null,c)),t(`</button></div><div class="flex-1 overflow-y-auto p-6 space-y-6" data-v-797ad56f><div data-v-797ad56f><label class="block text-sm font-semibold text-cafe mb-3" data-v-797ad56f> Formato de archivo </label><div class="flex gap-3" data-v-797ad56f><button class="${r.ssrRenderClass(["csv"===a.unref(n)?"border-purple-600 bg-purple-50 text-purple-600":"border-gray-200 bg-white text-gray-600 hover:border-gray-300","min-h-[44px] flex-1 px-4 py-3 rounded-lg border-2 transition-all font-medium flex items-center justify-center gap-2"])}" data-v-797ad56f>`),t(r.ssrRenderComponent(a.unref(R),{class:"w-5 h-5","aria-hidden":"true"},null,c)),t(`<span data-v-797ad56f>CSV</span></button><button class="${r.ssrRenderClass(["xlsx"===a.unref(n)?"border-purple-600 bg-purple-50 text-purple-600":"border-gray-200 bg-white text-gray-600 hover:border-gray-300","min-h-[44px] flex-1 px-4 py-3 rounded-lg border-2 transition-all font-medium flex items-center justify-center gap-2"])}" data-v-797ad56f>`),t(r.ssrRenderComponent(a.unref(R),{class:"w-5 h-5","aria-hidden":"true"},null,c)),t(`<span data-v-797ad56f>XLSX</span></button></div></div><div data-v-797ad56f><label class="block text-sm font-semibold text-cafe mb-3" data-v-797ad56f> ¬øQu√© pacientes exportar? </label><div class="space-y-2" data-v-797ad56f><label class="${r.ssrRenderClass(["all"===a.unref(o)?"border-purple-600 bg-purple-50":"border-gray-200 bg-white hover:border-gray-300","flex items-center gap-3 p-3 border-2 rounded-lg cursor-pointer transition-all"])}" data-v-797ad56f><input type="radio"${r.ssrIncludeBooleanAttr(r.ssrLooseEqual(a.unref(o),"all"))?" checked":""} value="all" class="w-4 h-4 text-purple-600 border-gray-300 focus:ring-2 focus:ring-purple-300" data-v-797ad56f><div class="flex-1" data-v-797ad56f><p class="font-medium text-cafe" data-v-797ad56f>Todos los pacientes</p><p class="text-xs text-gray-600" data-v-797ad56f>Exportar todos los pacientes (${r.ssrInterpolate(e.totalPatients)})</p></div></label>`),e.hasFilters?t(`<label class="${r.ssrRenderClass(["filtered"===a.unref(o)?"border-purple-600 bg-purple-50":"border-gray-200 bg-white hover:border-gray-300","flex items-center gap-3 p-3 border-2 rounded-lg cursor-pointer transition-all"])}" data-v-797ad56f><input type="radio"${r.ssrIncludeBooleanAttr(r.ssrLooseEqual(a.unref(o),"filtered"))?" checked":""} value="filtered" class="w-4 h-4 text-purple-600 border-gray-300 focus:ring-2 focus:ring-purple-300" data-v-797ad56f><div class="flex-1" data-v-797ad56f><p class="font-medium text-cafe" data-v-797ad56f>Pacientes filtrados</p><p class="text-xs text-gray-600" data-v-797ad56f>Exportar solo los pacientes que cumplen los filtros actuales (${r.ssrInterpolate(e.filteredCount)})</p></div></label>`):t("\x3c!----\x3e"),e.selectedCount>0?t(`<label class="${r.ssrRenderClass(["selected"===a.unref(o)?"border-purple-600 bg-purple-50":"border-gray-200 bg-white hover:border-gray-300","flex items-center gap-3 p-3 border-2 rounded-lg cursor-pointer transition-all"])}" data-v-797ad56f><input type="radio"${r.ssrIncludeBooleanAttr(r.ssrLooseEqual(a.unref(o),"selected"))?" checked":""} value="selected" class="w-4 h-4 text-purple-600 border-gray-300 focus:ring-2 focus:ring-purple-300" data-v-797ad56f><div class="flex-1" data-v-797ad56f><p class="font-medium text-cafe" data-v-797ad56f>Pacientes seleccionados</p><p class="text-xs text-gray-600" data-v-797ad56f>Exportar solo los pacientes seleccionados (${r.ssrInterpolate(e.selectedCount)})</p></div></label>`):t("\x3c!----\x3e"),t('</div></div><div data-v-797ad56f><label class="block text-sm font-semibold text-cafe mb-3" data-v-797ad56f> Campos a exportar </label><div class="grid grid-cols-2 gap-2" data-v-797ad56f>\x3c!--[--\x3e'),r.ssrRenderList(i,e=>{t(`<label class="flex items-center gap-2 p-2 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors" data-v-797ad56f><input type="checkbox"${r.ssrIncludeBooleanAttr(Array.isArray(a.unref(l))?r.ssrLooseContain(a.unref(l),e.value):a.unref(l))?" checked":""}${r.ssrRenderAttr("value",e.value)} class="w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-2 focus:ring-purple-300" data-v-797ad56f><span class="text-sm text-cafe" data-v-797ad56f>${r.ssrInterpolate(e.label)}</span></label>`)}),t(`\x3c!--]--\x3e</div><button class="mt-2 text-xs text-purple-600 hover:text-purple-700 font-medium" data-v-797ad56f>${r.ssrInterpolate(a.unref(l).length===i.length?"Deseleccionar todos":"Seleccionar todos")}</button></div></div><div class="px-6 py-4 border-t border-gray-200 flex items-center justify-between bg-gray-50" data-v-797ad56f><button${r.ssrIncludeBooleanAttr(a.unref(d))?" disabled":""} class="min-h-[44px] px-6 py-2.5 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all font-medium disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-gray-300" data-v-797ad56f> Cancelar </button><button${r.ssrIncludeBooleanAttr(a.unref(d)||0===a.unref(l).length)?" disabled":""} class="min-h-[44px] px-6 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all font-medium shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-purple-300 flex items-center gap-2" data-v-797ad56f>`),a.unref(d)?t("\x3c!----\x3e"):t(r.ssrRenderComponent(a.unref(m),{class:"w-5 h-5","aria-hidden":"true"},null,c)),a.unref(d)?t("<span data-v-797ad56f>Exportando...</span>"):t("<span data-v-797ad56f>Exportar</span>"),t("</button></div></div></div>")):t("\x3c!----\x3e")},"body",!1,c)}}}),Re=$e.setup;$e.setup=(e,t)=>{const r=a.useSSRContext();return(r.modules||(r.modules=new Set)).add("components/patients/PatientsExportModal.vue"),Re?Re(e,t):void 0};const Ie=Object.assign(y($e,[["__scopeId","data-v-797ad56f"]]),{__name:"PatientsExportModal"}),ke={__name:"ModalPreviewPaciente",__ssrInlineRender:!0,props:{mostrar:{type:Boolean,default:!1},paciente:{type:Object,default:null}},emits:["cerrar","ver-ficha","editar","gestionar-bonos"],setup(e){const t=e,s=a.computed(()=>{if(!t.paciente?.nombre)return"??";const e=t.paciente.nombre.trim().split(" ");return`${e[0]?.charAt(0)||"?"}${e[1]?.charAt(0)||""}`.toUpperCase()}),o=a.computed(()=>{if(!t.paciente)return"#9CA3AF";if(!t.paciente.activo)return"#9CA3AF";if(t.paciente.en_pausa)return"#F59E0B";const e=["#8B5CF6","#EC4899","#06B6D4","#10B981","#6366F1","#F97316"];return e[t.paciente.id.charCodeAt(0)%e.length]}),l=a.computed(()=>t.paciente?.activo?t.paciente.en_pausa?"Pausa":"Activo":"Finalizado"),d=a.computed(()=>t.paciente?.activo?t.paciente.en_pausa?"bg-amber-400/20 text-amber-100":"bg-green-400/20 text-green-100":"bg-white/20 text-white"),i=a.computed(()=>{if(!t.paciente?.ultima_sesion)return 999;const e=new Date(t.paciente.ultima_sesion),a=new Date;return Math.floor((a-e)/864e5)}),c=a.computed(()=>{if(!t.paciente?.ultima_sesion)return"Sin registro";const e=new Date(t.paciente.ultima_sesion),a=i.value;return 0===a?"Hoy":1===a?"Ayer":a<7?`Hace ${a} d√≠as`:a<30?`Hace ${Math.floor(a/7)} semanas`:e.toLocaleDateString("es-ES",{day:"numeric",month:"long"})}),u=a.computed(()=>t.paciente?.ultima_sesion?i.value<=7?"bg-green-500":i.value<=14?"bg-blue-500":i.value<=30?"bg-amber-500":"bg-red-500":"bg-gray-300"),p=a.computed(()=>t.paciente?.bono_activo),m=a.computed(()=>{if(!p.value?.tipo)return"";return{otro:"A demanda",quincenal:"Quincenal",semanal:"Semanal",mensual:"Mensual"}[p.value.tipo]||p.value.tipo}),v=a.computed(()=>p.value?p.value.sesiones_totales-p.value.sesiones_restantes:0),b=a.computed(()=>p.value&&0!==p.value.sesiones_totales?Math.round(v.value/p.value.sesiones_totales*100):0),f=a.computed(()=>p.value?p.value.sesiones_restantes<=1?"bg-red-500":2===p.value.sesiones_restantes?"bg-amber-500":"bg-purple-500":"bg-gray-400"),x=a.computed(()=>p.value?p.value.sesiones_restantes<=1?"bg-red-50 border border-red-100":2===p.value.sesiones_restantes?"bg-amber-50 border border-amber-100":"bg-purple-50 border border-purple-100":"bg-gray-50"),g=a.computed(()=>p.value?p.value.sesiones_restantes<=1?"text-red-500":2===p.value.sesiones_restantes?"text-amber-500":"text-purple-500":"text-gray-400"),h=a.computed(()=>p.value?p.value.sesiones_restantes<=1?"text-red-700":2===p.value.sesiones_restantes?"text-amber-700":"text-purple-700":"text-gray-600"),y=a.computed(()=>{if(!p.value?.fecha_fin)return"‚Äî";try{const e=new Date(p.value.fecha_fin),t=new Date,a=Math.floor((e-t)/864e5);return a<0?"Vencido":0===a?"Vence hoy":1===a?"Vence ma√±ana":a<=7?`Vence en ${a}d`:e.toLocaleDateString("es-ES",{day:"numeric",month:"short"})}catch{return"‚Äî"}}),w=a.computed(()=>{if(!p.value?.fecha_fin)return"text-gray-400";const e=new Date(p.value.fecha_fin),t=new Date,a=Math.floor((e-t)/864e5);return a<0?"text-red-600 font-medium":a<=7?"text-amber-600 font-medium":"text-gray-500"});return(t,i,p,_)=>{r.ssrRenderTeleport(i,t=>{e.mostrar&&e.paciente?(t('<div class="fixed inset-0 z-50 overflow-y-auto"><div class="fixed inset-0 bg-black/30 backdrop-blur-sm"></div><div class="relative min-h-screen flex items-center justify-center p-4">'),e.mostrar?(t('<div class="relative bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden"><div class="relative px-6 pt-6 pb-4 bg-gradient-to-br from-purple-500 to-purple-600"><button class="absolute top-4 right-4 p-1.5 text-white/80 hover:text-white hover:bg-white/10 rounded-lg transition-colors">'),t(r.ssrRenderComponent(a.unref($),{class:"w-5 h-5"},null,p)),t(`</button><div class="flex items-center gap-4"><div class="w-16 h-16 rounded-full flex items-center justify-center text-white text-xl font-bold ring-4 ring-white/20" style="${r.ssrRenderStyle({backgroundColor:a.unref(o)})}">${r.ssrInterpolate(a.unref(s))}</div><div class="flex-1 min-w-0"><h2 class="text-xl font-semibold text-white truncate">${r.ssrInterpolate(e.paciente.nombre||"Sin nombre")}</h2><div class="flex items-center gap-2 mt-1"><span class="${r.ssrRenderClass([a.unref(d),"inline-flex items-center px-2 py-0.5 text-xs font-medium rounded-full"])}">${r.ssrInterpolate(a.unref(l))}</span>`),e.paciente.area_de_acompanamiento?t(`<span class="text-sm text-white/70">${r.ssrInterpolate(e.paciente.area_de_acompanamiento)}</span>`):t("\x3c!----\x3e"),t(`</div></div></div></div><div class="px-6 py-4 space-y-4"><div class="${r.ssrRenderClass([e.paciente.proxima_sesion?"bg-purple-50":"bg-amber-50","p-3 rounded-lg"])}"><div class="flex items-center gap-2 mb-1">`),t(r.ssrRenderComponent(a.unref(I),{class:["w-4 h-4",e.paciente.proxima_sesion?"text-purple-500":"text-amber-500"]},null,p)),t('<span class="text-xs font-medium text-gray-500">Pr√≥xima cita</span></div>'),e.paciente.proxima_sesion?t(`<p class="text-sm font-semibold text-purple-700">${r.ssrInterpolate((e=>{if(!e)return null;try{let t=e;t.includes("T")||(t+="T00:00:00");const a=new Date(t);return isNaN(a.getTime())?null:a.toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long",hour:"2-digit",minute:"2-digit"})}catch{return null}})(e.paciente.proxima_sesion))}</p>`):t('<p class="text-sm font-medium text-amber-700">Sin cita programada</p>'),t(`</div><div class="grid grid-cols-2 gap-3"><div class="p-3 bg-gray-50 rounded-lg"><p class="text-xs text-gray-500 mb-0.5">√öltima sesi√≥n</p><div class="flex items-center gap-1.5"><div class="${r.ssrRenderClass([a.unref(u),"w-2 h-2 rounded-full"])}"></div><span class="text-sm font-medium text-gray-900">${r.ssrInterpolate(a.unref(c))}</span></div></div><div class="p-3 bg-gray-50 rounded-lg"><p class="text-xs text-gray-500 mb-0.5">Total sesiones</p><p class="text-sm font-medium text-gray-900">${r.ssrInterpolate(e.paciente.total_sesiones||0)}</p></div></div>`),e.paciente.bono_activo?(t(`<div class="${r.ssrRenderClass([a.unref(x),"p-3 rounded-lg"])}"><div class="flex items-center justify-between mb-2"><div class="flex items-center gap-1.5">`),t(r.ssrRenderComponent(a.unref(n),{class:["w-4 h-4",a.unref(g)]},null,p)),t(`<span class="${r.ssrRenderClass([a.unref(h),"text-sm font-medium"])}">${r.ssrInterpolate(a.unref(m))}</span></div><span class="${r.ssrRenderClass([a.unref(w),"text-xs"])}">${r.ssrInterpolate(a.unref(y))}</span></div><div class="relative h-2 bg-gray-200 rounded-full overflow-hidden mb-1"><div class="${r.ssrRenderClass([a.unref(f),"absolute left-0 top-0 h-full rounded-full transition-all"])}" style="${r.ssrRenderStyle({width:a.unref(b)+"%"})}"></div></div><div class="flex justify-between"><span class="text-xs text-gray-500">${r.ssrInterpolate(a.unref(v))} usadas</span><span class="${r.ssrRenderClass([a.unref(h),"text-xs font-semibold"])}">${r.ssrInterpolate(e.paciente.bono_activo.sesiones_restantes)} restantes </span></div></div>`)):t("\x3c!----\x3e"),t('<div class="flex flex-col gap-2">'),e.paciente.email?(t('<div class="flex items-center gap-2 text-sm text-gray-600">'),t(r.ssrRenderComponent(a.unref(k),{class:"w-4 h-4 text-gray-400"},null,p)),t(`<span class="truncate">${r.ssrInterpolate(e.paciente.email)}</span></div>`)):t("\x3c!----\x3e"),e.paciente.telefono?(t('<div class="flex items-center gap-2 text-sm text-gray-600">'),t(r.ssrRenderComponent(a.unref(A),{class:"w-4 h-4 text-gray-400"},null,p)),t(`<span>${r.ssrInterpolate(e.paciente.telefono)}</span></div>`)):t("\x3c!----\x3e"),t('</div></div><div class="px-6 py-4 bg-gray-50 border-t border-gray-100 flex items-center gap-2"><button class="flex-1 px-4 py-2 bg-purple-600 text-white text-sm font-medium rounded-lg hover:bg-purple-700 transition-colors"> Ver ficha completa </button><button class="px-4 py-2 text-gray-600 text-sm font-medium hover:bg-gray-100 rounded-lg transition-colors"> Editar </button><button class="px-4 py-2 text-gray-600 text-sm font-medium hover:bg-gray-100 rounded-lg transition-colors"> Bonos </button></div></div>')):t("\x3c!----\x3e"),t("</div></div>")):t("\x3c!----\x3e")},"body",!1,p)}}},Ae=ke.setup;ke.setup=(e,t)=>{const r=a.useSSRContext();return(r.modules||(r.modules=new Set)).add("components/ModalPreviewPaciente.vue"),Ae?Ae(e,t):void 0};const De={__name:"pacientes",__ssrInlineRender:!0,setup(s){E.register(F,B,P,j,M,L,q,V,T);const o=e(),d=w(),{getUserId:i}=f();t();const c=h(),u=a.ref(!1),v=a.ref(!1),x=a.ref(!1),g=a.ref(!1),y=a.ref(!1),_=a.ref(!1),C=a.ref(!1),R=a.ref(null),k=a.ref(null),A=a.ref(null),Y=a.ref([]),K=a.ref(!0),ee=a.ref(""),te=a.ref(""),re=a.ref("todos"),se=a.ref(""),oe=a.ref(!1),le=a.ref({sinProximaCita:!1,sinSesionRegistrada:!1,requiereAtencion:!1,citasEstaSemana:!1,bonosPorVencer:!1,pagoPendiente:!1}),ie=a.ref("cards"),ce=a.ref(!1),pe=a.ref<"semana"|"mes"|!0,me=[{valor:"semana",label:"Semana"},{valor:"mes",label:"Mes"},{valor:"trimestre",label:"Trimestre"}],be=a.ref(1),fe=a.ref(24),xe=a.ref(!1),ge=a.ref(null),he=[{valor:"todos",label:"Todos"},{valor:"activo",label:"Activos"},{valor:"pausa",label:"En pausa"},{valor:"finalizado",label:"Finalizados"}],ye=a.computed(()=>({activos:Y.value.filter(e=>e.activo&&!e.en_pausa).length,enPausa:Y.value.filter(e=>e.activo&&e.en_pausa).length,finalizados:Y.value.filter(e=>!e.activo).length})),we=a.computed(()=>he.map(e=>{let t=0;return"todos"===e.valor?t=Y.value.length:"activo"===e.valor?t=ye.value.activos:"pausa"===e.valor?t=ye.value.enPausa:"finalizado"===e.valor&&(t=ye.value.finalizados),{...e,count:t}})),_e=a.computed(()=>{const e=we.value.find(e=>e.valor===re.value);return e?.count||0}),$e=a.computed(()=>{const e=new Set(Y.value.map(e=>e.area_de_acompanamiento).filter(Boolean));return Array.from(e).sort()}),Re=a.computed(()=>""!==se.value||le.value.sinProximaCita||le.value.sinSesionRegistrada||le.value.requiereAtencion||le.value.citasEstaSemana||le.value.bonosPorVencer||le.value.pagoPendiente),Ae=a.computed(()=>{let e=0;return se.value&&e++,le.value.sinProximaCita&&e++,le.value.sinSesionRegistrada&&e++,le.value.requiereAtencion&&e++,le.value.citasEstaSemana&&e++,le.value.bonosPorVencer&&e++,le.value.pagoPendiente&&e++,e}),De=a.computed(()=>Re.value||ee.value||"todos"!==re.value),cargarPacientes=async()=>{K.value=!0;try{const e=i();if(!e)return void(K.value=!1);const{data:t,error:a}=await d.from("pacientes").select("\n        id,\n        created_at,\n        activo,\n        email,\n        nombre_completo,\n        telefono,\n        area_de_acompanamiento,\n        frecuencia,\n        metadata\n      ").eq("terapeuta_id",e).order("created_at",{ascending:!1});if(a)throw a;const r=await Promise.all(t.map(async e=>{const{data:t}=await d.from("citas").select("fecha_cita").eq("paciente_id",e.id).eq("estado","realizada").order("fecha_cita",{ascending:!1}).limit(1).maybeSingle(),{data:a}=await d.from("citas").select("id, fecha_cita, hora_inicio").eq("paciente_id",e.id).in("estado",["pendiente","confirmada"]).gte("fecha_cita",(new Date).toISOString().split("T")[0]).order("fecha_cita",{ascending:!0}).order("hora_inicio",{ascending:!0}).limit(1).maybeSingle(),{count:r}=await d.from("citas").select("*",{count:"exact",head:!0}).eq("paciente_id",e.id).eq("estado","realizada");let s=null;try{const{data:t}=await d.from("bonos").select("id, tipo, estado, sesiones_totales, sesiones_restantes, fecha_fin, created_at").eq("paciente_id",e.id).in("estado",["activo","pendiente"]).order("created_at",{ascending:!1}).limit(1).maybeSingle();s=t}catch(e){console.warn("[Bonos] Error:",e)}let n=0,o=0;s&&(o=s.sesiones_totales,n=o-s.sesiones_restantes);const l=new Date;l.setDate(l.getDate()-7);const{data:i}=await d.from("metricas_bienestar").select("estado_animo, nivel_energia, nivel_estres").eq("paciente_id",e.id).gte("fecha",l.toISOString());let c=3,u=!1,p=50;if(i&&i.length>0){const e=i.reduce((e,t)=>e+t.estado_animo,0)/i.length;c=e,p=Math.round(e/10*100);const t=i.slice(-3);t.length>=3&&(u=t.every(e=>e.estado_animo<=4))}const m=e.nombre_completo||e.metadata?.nombre_completo||e.email;return{id:e.id,nombre:m,email:e.email,telefono:e.telefono,activo:e.activo,en_pausa:e.metadata?.en_pausa||!1,area_de_acompanamiento:e.area_de_acompanamiento,frecuencia:e.frecuencia,ultima_sesion:t?.fecha_cita||null,proxima_sesion:a?`${a.fecha_cita}T${a.hora_inicio}`:null,proxima_cita_id:a?.id||null,total_sesiones:r||0,estado_emocional_promedio:c,evolucion_porcentaje:p,requiere_atencion:u,created_at:e.created_at,bono_activo:s?{tipo:s.tipo,estado:s.estado,fecha_fin:s.fecha_fin,sesiones_completadas:n,sesiones_totales:o,sesiones_restantes:s.sesiones_restantes}:null}}));Y.value=r}catch(e){console.error("Error al cargar pacientes:",e),c.error("Error al cargar los pacientes")}finally{K.value=!1}},bonoPorVencer=e=>{if(!e.bono_activo)return!1;const t=e.bono_activo;if(t.sesiones_restantes<=2)return!0;if(t.fecha_fin){const e=new Date(t.fecha_fin),a=new Date;if(Math.floor((e-a)/864e5)<=7)return!0}return!1},Se=a.computed(()=>{let e=Y.value;if(ee.value){const t=ee.value.toLowerCase();e=e.filter(e=>{const a=(e.nombre||"").toLowerCase(),r=(e.email||"").toLowerCase(),s=(e.telefono||"").toLowerCase(),n=(e.proxima_sesion||"").toLowerCase();return a.includes(t)||r.includes(t)||s.includes(t)||n.includes(t)})}return"todos"!==re.value&&(e=e.filter(e=>"activo"===re.value?e.activo&&!e.en_pausa:"pausa"===re.value?e.activo&&e.en_pausa:"finalizado"!==re.value||!e.activo)),se.value&&(e=e.filter(e=>e.area_de_acompanamiento===se.value)),le.value.sinProximaCita&&(e=e.filter(e=>!e.proxima_sesion)),le.value.sinSesionRegistrada&&(e=e.filter(e=>!e.ultima_sesion)),le.value.requiereAtencion&&(e=e.filter(e=>e.requiere_atencion)),le.value.citasEstaSemana&&(e=e.filter(e=>(e=>{if(!e)return!1;const t=new Date(e),a=new Date,r=new Date(a);r.setDate(a.getDate()-a.getDay()),r.setHours(0,0,0,0);const s=new Date(r);return s.setDate(r.getDate()+7),t>=r&&t<s})(e.proxima_sesion))),le.value.bonosPorVencer&&(e=e.filter(e=>bonoPorVencer(e))),le.value.pagoPendiente&&(e=e.filter(e=>!!e.bono_activo&&"pendiente"===e.bono_activo.estado)),e}),Ee=a.computed(()=>Math.ceil(Se.value.length/fe.value)),Fe=a.computed(()=>{const e=(be.value-1)*fe.value,t=e+fe.value;return Se.value.slice(e,t)});a.watch([ee,re,se,le],()=>{be.value=1},{deep:!0});const Be=a.computed(()=>Y.value.length),Pe=a.computed(()=>Se.value.length),je=a.computed(()=>{const e=[],t=Math.max(1,be.value-2),a=Math.min(Ee.value,be.value+2);for(let r=t;r<=a;r++)e.push(r);return e}),irAFichaPaciente=e=>{const t="object"==typeof e?e.id:e;console.log("[Pacientes] Navegando a ficha:",t),o.push(`/terapeuta/pacientes/${t}`)},cerrarModalNuevo=()=>{u.value=!1},abrirModalEditar=e=>{k.value=e,v.value=!0},cerrarModalEditar=()=>{v.value=!1,k.value=null},abrirModalEliminar=e=>{k.value=e,x.value=!0},cerrarModalEliminar=()=>{x.value=!1,k.value=null},manejarPacienteCreado=async()=>{await cargarPacientes(),c.success("Paciente creado")},manejarPacienteActualizado=async()=>{await cargarPacientes(),c.success("Paciente actualizado")},manejarPacienteEliminado=async e=>{Y.value=Y.value.filter(t=>t.id!==e),c.success("Paciente eliminado")},manejarPacienteDesactivado=async()=>{await cargarPacientes(),c.success("Paciente desactivado")},cerrarModalAsignarCita=()=>{g.value=!1,A.value=null},manejarCitaCreada=async()=>{await cargarPacientes(),cerrarModalAsignarCita(),c.success("Cita asignada")},verCitasPaciente=e=>{o.push(`/agenda?paciente=${e.id}`)},gestionarBonosPaciente=e=>{o.push(`/terapeuta/pacientes/${e.id}/bonos`)},abrirPreview=e=>{ge.value=e,xe.value=!0},cerrarPreview=()=>{xe.value=!1,ge.value=null},handleImportComplete=async()=>{await cargarPacientes(),c.success("Importaci√≥n completada")},Me=a.computed(()=>{const e={};return"todos"!==re.value&&(e.estado=re.value),se.value&&(e.area=se.value),e}),abrirModalEditarCita=e=>{R.value=e,y.value=!0},cerrarModalEditarCita=()=>{y.value=!1,R.value=null},handleCitaActualizada=async()=>{await cargarPacientes(),cerrarModalEditarCita(),c.success("Cita actualizada")},getFechasPeriodo=e=>{const t=new Date,a=new Date(t),r=new Date(t);return"semana"===e?r.setDate(t.getDate()-7):"mes"===e?r.setMonth(t.getMonth()-1):r.setMonth(t.getMonth()-3),{inicio:r,fin:a}},Le=a.computed(()=>{const{inicio:e,fin:t}=getFechasPeriodo(pe.value),a=new Date(e);"semana"===pe.value?a.setDate(a.getDate()-7):"mes"===pe.value?a.setMonth(a.getMonth()-1):a.setMonth(a.getMonth()-3);const r=Y.value,s=r.length,n=r.filter(e=>e.activo&&!e.en_pausa).length,o=r.filter(e=>!e.activo).length,l=r.filter(e=>e.activo&&e.en_pausa).length,d=r.filter(a=>{const r=new Date(a.created_at);return r>=e&&r<=t}).length,i=r.filter(t=>{const r=new Date(t.created_at);return r>=a&&r<e}).length,c=i>0?Math.round((d-i)/i*100):d>0?100:0,u=new Date;u.setDate(u.getDate()-30);const p=r.filter(a=>{if(a.activo)return!1;if(a.ultima_sesion){const r=new Date(a.ultima_sesion);return r>=e&&r<=t}return!1}).length,m=n+p,v=m>0?Math.round(p/m*100):0,b=100-v,f=r.reduce((e,t)=>e+(t.total_sesiones||0),0);return{total:s,activos:n,finalizados:o,enPausa:l,nuevos:d,tendenciaNuevos:c,churn:v,retencion:b,promedioSesiones:n>0?(f/n).toFixed(1):"0",pacientesEnRiesgo:r.filter(e=>{if(!e.activo||e.en_pausa)return!1;const t=!e.proxima_sesion,a=!e.ultima_sesion||new Date(e.ultima_sesion)<u;return t&&a}).length,sinCitaProxima:r.filter(e=>e.activo&&!e.en_pausa&&!e.proxima_sesion).length,bonosPorVencer:r.filter(e=>bonoPorVencer(e)).length}}),qe=a.computed(()=>{const{inicio:e}=getFechasPeriodo(pe.value),t=[],a=[],r=[],s="semana"===pe.value?7:"mes"===pe.value?4:12,n="semana"===pe.value?1:7;for(let o=0;o<s;o++){const s=new Date(e);s.setDate(s.getDate()+o*n),"semana"===pe.value?t.push(s.toLocaleDateString("es-ES",{weekday:"short"})):t.push(s.toLocaleDateString("es-ES",{day:"2-digit",month:"short"}));const l=Y.value.filter(t=>{const a=new Date(t.created_at);return a<=s&&a>=e}).length,d=Y.value.filter(e=>new Date(e.created_at)<=s&&e.activo).length;a.push(l),r.push(d)}return{labels:t,datasets:[{label:"Nuevos",data:a,borderColor:"#10B981",backgroundColor:"rgba(16, 185, 129, 0.1)",fill:!0,tension:.4},{label:"Activos",data:r,borderColor:"#8B5CF6",backgroundColor:"rgba(139, 92, 246, 0.1)",fill:!0,tension:.4}]}}),Ve={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{boxWidth:12,padding:15}}},scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}}},Te=a.computed(()=>{const{activos:e,enPausa:t,finalizados:a}=Le.value;return{labels:["Activos","En Pausa","Finalizados"],datasets:[{data:[e,t,a],backgroundColor:["#8B5CF6","#F59E0B","#6B7280"],borderWidth:0}]}}),ze={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{boxWidth:12,padding:15}}},cutout:"60%"};return a.watch(()=>i(),e=>{e&&0===Y.value.length&&cargarPacientes()}),(e,t,s,o)=>{const d=X,i=J,c=b,f=ae,h=ne,w=de,E=ue,F=ve,B=Ce,P=Ie,j=ke;t(`<div${r.ssrRenderAttrs(o)}><header class="mb-6"><div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-5"><div><h1 class="text-2xl font-semibold text-gray-900"> Pacientes <span class="text-gray-400 font-normal">(${r.ssrInterpolate(a.unref(_e))})</span></h1></div><div class="flex items-center gap-2"><button class="${r.ssrRenderClass([a.unref(ce)?"bg-indigo-600 text-white border-indigo-600 shadow-md":"bg-white text-indigo-700 border-indigo-200 hover:bg-indigo-50","min-h-[40px] px-3 py-2 text-sm font-medium rounded-lg transition-all flex items-center gap-2 border"])}" title="Ver resumen y estad√≠sticas">`),t(r.ssrRenderComponent(a.unref(z),{class:"w-4 h-4"},null,s)),t('<span class="hidden sm:inline">Resumen</span></button><button class="min-h-[40px] px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors flex items-center gap-1.5 text-sm font-medium" aria-label="Importar pacientes">'),t(r.ssrRenderComponent(a.unref(p),{class:"w-4 h-4","aria-hidden":"true"},null,s)),t('<span class="hidden sm:inline">Importar</span></button><button class="min-h-[40px] px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors flex items-center gap-1.5 text-sm font-medium" aria-label="Exportar pacientes">'),t(r.ssrRenderComponent(a.unref(m),{class:"w-4 h-4","aria-hidden":"true"},null,s)),t('<span class="hidden sm:inline">Exportar</span></button><button class="min-h-[40px] px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center gap-2 text-sm font-medium shadow-sm" aria-label="A√±adir nuevo paciente">'),t(r.ssrRenderComponent(a.unref(N),{class:"w-4 h-4","aria-hidden":"true"},null,s)),t("<span>Nuevo</span></button></div></div>"),a.unref(ce)?(t('<div class="bg-white border border-gray-100 rounded-xl p-4 mb-4 overflow-hidden"><div class="flex items-center justify-between mb-4"><h3 class="text-lg font-semibold text-gray-900 flex items-center gap-2">'),t(r.ssrRenderComponent(a.unref(z),{class:"w-5 h-5 text-indigo-500"},null,s)),t(' Estad√≠sticas de Pacientes </h3><div class="flex items-center bg-gray-100 rounded-lg p-1">\x3c!--[--\x3e'),r.ssrRenderList(me,e=>{t(`<button class="${r.ssrRenderClass([pe===e.valor?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900","px-3 py-1.5 text-sm font-medium rounded-md transition-all"])}">${r.ssrInterpolate(e.label)}</button>`)}),t('\x3c!--]--\x3e</div></div><div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4 mb-6"><div class="bg-gradient-to-br from-purple-50 to-violet-50 rounded-xl p-4 border border-purple-100"><div class="flex items-center gap-2 mb-2"><div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center">'),t(r.ssrRenderComponent(a.unref(O),{class:"w-4 h-4 text-purple-600"},null,s)),t(`</div><span class="text-xs font-medium text-purple-600 uppercase">Total</span></div><p class="text-2xl font-bold text-purple-900">${r.ssrInterpolate(a.unref(Le).total)}</p><p class="text-xs text-purple-600 mt-1">${r.ssrInterpolate(a.unref(Le).activos)} activos</p></div><div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-4 border border-green-100"><div class="flex items-center gap-2 mb-2"><div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">`),t(r.ssrRenderComponent(a.unref(N),{class:"w-4 h-4 text-green-600"},null,s)),t(`</div><span class="text-xs font-medium text-green-600 uppercase">Nuevos</span></div><p class="text-2xl font-bold text-green-900">${r.ssrInterpolate(a.unref(Le).nuevos)}</p><p class="text-xs text-green-600 mt-1"><span class="${r.ssrRenderClass(a.unref(Le).tendenciaNuevos>=0?"text-green-600":"text-red-600")}">${r.ssrInterpolate(a.unref(Le).tendenciaNuevos>=0?"+":"")}${r.ssrInterpolate(a.unref(Le).tendenciaNuevos)}% </span> vs per√≠odo ant. </p></div><div class="bg-gradient-to-br from-red-50 to-rose-50 rounded-xl p-4 border border-red-100"><div class="flex items-center gap-2 mb-2"><div class="w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center">`),t(r.ssrRenderComponent(a.unref(m),{class:"w-4 h-4 text-red-600 rotate-90"},null,s)),t(`</div><span class="text-xs font-medium text-red-600 uppercase">Churn</span></div><p class="text-2xl font-bold text-red-900">${r.ssrInterpolate(a.unref(Le).churn)}%</p><p class="text-xs text-red-600 mt-1">${r.ssrInterpolate(a.unref(Le).finalizados)} finalizados</p></div><div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-4 border border-blue-100"><div class="flex items-center gap-2 mb-2"><div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center"><svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg></div><span class="text-xs font-medium text-blue-600 uppercase">Retenci√≥n</span></div><p class="text-2xl font-bold text-blue-900">${r.ssrInterpolate(a.unref(Le).retencion)}%</p><p class="text-xs text-blue-600 mt-1">Pacientes que contin√∫an</p></div><div class="bg-gradient-to-br from-amber-50 to-orange-50 rounded-xl p-4 border border-amber-100"><div class="flex items-center gap-2 mb-2"><div class="w-8 h-8 bg-amber-100 rounded-lg flex items-center justify-center">`),t(r.ssrRenderComponent(a.unref(H),{class:"w-4 h-4 text-amber-600"},null,s)),t(`</div><span class="text-xs font-medium text-amber-600 uppercase">Prom. Sesiones</span></div><p class="text-2xl font-bold text-amber-900">${r.ssrInterpolate(a.unref(Le).promedioSesiones)}</p><p class="text-xs text-amber-600 mt-1">Por paciente</p></div></div><div class="grid grid-cols-1 lg:grid-cols-2 gap-6"><div class="bg-gray-50 rounded-xl p-4"><h4 class="text-sm font-semibold text-gray-700 mb-3">Evoluci√≥n de Pacientes</h4><div class="h-48">`),a.unref(qe)?t(r.ssrRenderComponent(a.unref(D),{data:a.unref(qe),options:Ve},null,s)):t("\x3c!----\x3e"),t('</div></div><div class="bg-gray-50 rounded-xl p-4"><h4 class="text-sm font-semibold text-gray-700 mb-3">Distribuci√≥n por Estado</h4><div class="h-48">'),a.unref(Te)?t(r.ssrRenderComponent(a.unref(S),{data:a.unref(Te),options:ze},null,s)):t("\x3c!----\x3e"),t('</div></div></div><div class="mt-6 bg-gradient-to-r from-rose-50 to-red-50 rounded-xl p-4 border border-red-100"><div class="flex items-start gap-3"><div class="w-10 h-10 bg-red-100 rounded-xl flex items-center justify-center flex-shrink-0">'),t(r.ssrRenderComponent(a.unref(l),{class:"w-5 h-5 text-red-600"},null,s)),t(`</div><div class="flex-1"><h4 class="text-sm font-semibold text-gray-800 mb-1">An√°lisis de Churn</h4><p class="text-xs text-gray-600 mb-2">${r.ssrInterpolate(a.unref(Le).pacientesEnRiesgo)} pacientes no han tenido sesi√≥n en los √∫ltimos 30 d√≠as y podr√≠an estar en riesgo de abandono. </p><div class="flex flex-wrap gap-2"><span class="px-2 py-1 bg-white rounded text-xs font-medium text-red-700">${r.ssrInterpolate(a.unref(Le).sinCitaProxima)} sin cita programada </span><span class="px-2 py-1 bg-white rounded text-xs font-medium text-amber-700">${r.ssrInterpolate(a.unref(Le).bonosPorVencer)} con bono por vencer </span></div></div></div></div></div>`)):t("\x3c!----\x3e"),t(`<div class="space-y-4"><div class="relative"><input${r.ssrRenderAttr("value",a.unref(te))} type="text" placeholder="Buscar por nombre, email o tel√©fono..." class="w-full h-11 px-4 pl-10 bg-white border border-gray-200 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition-all text-sm placeholder-gray-400" aria-label="Buscar pacientes">`),t(r.ssrRenderComponent(a.unref(G),{class:"w-4 h-4 absolute left-3.5 top-1/2 -translate-y-1/2 text-gray-400","aria-hidden":"true"},null,s)),a.unref(ee)?(t('<button class="absolute right-3 top-1/2 -translate-y-1/2 p-1 text-gray-400 hover:text-gray-600 rounded" aria-label="Limpiar b√∫squeda">'),t(r.ssrRenderComponent(a.unref($),{class:"w-4 h-4"},null,s)),t("</button>")):t("\x3c!----\x3e"),t('</div><div class="flex items-center justify-between border-b border-gray-100"><nav class="flex gap-1 -mb-px" role="tablist">\x3c!--[--\x3e'),r.ssrRenderList(a.unref(we),e=>{t(`<button class="${r.ssrRenderClass([a.unref(re)===e.valor?"text-purple-600":"text-gray-500 hover:text-gray-700","px-4 py-2.5 text-sm font-medium transition-colors relative"])}"${r.ssrRenderAttr("aria-selected",a.unref(re)===e.valor)} role="tab"><span>${r.ssrInterpolate(e.label)}</span><span class="${r.ssrRenderClass([a.unref(re)===e.valor?"text-purple-500":"text-gray-400","ml-1.5 text-xs"])}">${r.ssrInterpolate(e.count)}</span>`),a.unref(re)===e.valor?t('<span class="absolute bottom-0 left-0 right-0 h-0.5 bg-purple-600 rounded-full"></span>'):t("\x3c!----\x3e"),t("</button>")}),t(`\x3c!--]--\x3e</nav><button class="${r.ssrRenderClass([a.unref(Re)?"text-purple-600 bg-purple-50":"text-gray-500 hover:text-gray-700 hover:bg-gray-50","flex items-center gap-1.5 px-3 py-2 text-sm font-medium rounded-lg transition-colors"])}">`),t(r.ssrRenderComponent(a.unref(Q),{class:"w-4 h-4"},null,s)),t('<span class="hidden sm:inline">Filtros</span>'),a.unref(Ae)>0?t(`<span class="w-5 h-5 flex items-center justify-center text-xs font-semibold bg-purple-600 text-white rounded-full">${r.ssrInterpolate(a.unref(Ae))}</span>`):t("\x3c!----\x3e"),t(r.ssrRenderComponent(a.unref(U),{class:["w-4 h-4 transition-transform",{"rotate-180":a.unref(oe)}]},null,s)),t("</button></div>"),a.unref(oe)?(t(`<div class="bg-gray-50 rounded-lg p-4"><div class="flex flex-wrap items-center gap-3"><select class="h-9 px-3 bg-white border border-gray-200 rounded-lg text-sm text-gray-700 focus:border-purple-500 focus:ring-1 focus:ring-purple-500/20" aria-label="Filtrar por √°rea"><option value=""${r.ssrIncludeBooleanAttr(Array.isArray(a.unref(se))?r.ssrLooseContain(a.unref(se),""):r.ssrLooseEqual(a.unref(se),""))?" selected":""}>Todas las √°reas</option>\x3c!--[--\x3e`),r.ssrRenderList(a.unref($e),e=>{t(`<option${r.ssrRenderAttr("value",e)}${r.ssrIncludeBooleanAttr(Array.isArray(a.unref(se))?r.ssrLooseContain(a.unref(se),e):r.ssrLooseEqual(a.unref(se),e))?" selected":""}>${r.ssrInterpolate(e)}</option>`)}),t(`\x3c!--]--\x3e</select><button class="${r.ssrRenderClass([a.unref(le).sinProximaCita?"bg-orange-100 text-orange-700 border border-orange-200":"bg-white text-gray-600 border border-gray-200 hover:border-gray-300","h-9 px-3 rounded-lg text-sm font-medium transition-all flex items-center gap-1.5"])}">`),t(r.ssrRenderComponent(a.unref(I),{class:"w-4 h-4"},null,s)),t(` Sin pr√≥xima cita </button><button class="${r.ssrRenderClass([a.unref(le).sinSesionRegistrada?"bg-amber-100 text-amber-700 border border-amber-200":"bg-white text-gray-600 border border-gray-200 hover:border-gray-300","h-9 px-3 rounded-lg text-sm font-medium transition-all flex items-center gap-1.5"])}">`),t(r.ssrRenderComponent(a.unref(H),{class:"w-4 h-4"},null,s)),t(` Sin sesi√≥n </button><button class="${r.ssrRenderClass([a.unref(le).requiereAtencion?"bg-red-100 text-red-700 border border-red-200":"bg-white text-gray-600 border border-gray-200 hover:border-gray-300","h-9 px-3 rounded-lg text-sm font-medium transition-all flex items-center gap-1.5"])}">`),t(r.ssrRenderComponent(a.unref(l),{class:"w-4 h-4"},null,s)),t(` Requiere atenci√≥n </button><button class="${r.ssrRenderClass([a.unref(le).citasEstaSemana?"bg-purple-100 text-purple-700 border border-purple-200":"bg-white text-gray-600 border border-gray-200 hover:border-gray-300","h-9 px-3 rounded-lg text-sm font-medium transition-all flex items-center gap-1.5"])}">`),t(r.ssrRenderComponent(a.unref(I),{class:"w-4 h-4"},null,s)),t(` Citas esta semana </button><button class="${r.ssrRenderClass([a.unref(le).bonosPorVencer?"bg-amber-100 text-amber-700 border border-amber-200":"bg-white text-gray-600 border border-gray-200 hover:border-gray-300","h-9 px-3 rounded-lg text-sm font-medium transition-all flex items-center gap-1.5"])}">`),t(r.ssrRenderComponent(a.unref(n),{class:"w-4 h-4"},null,s)),t(` Bonos por vencer </button><button class="${r.ssrRenderClass([a.unref(le).pagoPendiente?"bg-green-100 text-green-700 border border-green-200":"bg-white text-gray-600 border border-gray-200 hover:border-gray-300","h-9 px-3 rounded-lg text-sm font-medium transition-all flex items-center gap-1.5"])}">`),t(r.ssrRenderComponent(a.unref(W),{class:"w-4 h-4"},null,s)),t(" Pago pendiente </button>"),a.unref(Re)?t('<button class="h-9 px-3 text-sm text-gray-500 hover:text-gray-700 transition-colors"> Limpiar </button>'):t("\x3c!----\x3e"),t("</div></div>")):t("\x3c!----\x3e"),t('</div></header><div class="flex items-center justify-between mb-4"><p class="text-sm text-gray-500">'),a.unref(Pe)===a.unref(Be)?t(`<span>${r.ssrInterpolate(a.unref(Be))} pacientes</span>`):t(`<span>${r.ssrInterpolate(a.unref(Pe))} de ${r.ssrInterpolate(a.unref(Be))} pacientes</span>`),a.unref(Ee)>1?t(`<span class="ml-2 text-gray-400"> (p√°gina ${r.ssrInterpolate(a.unref(be))} de ${r.ssrInterpolate(a.unref(Ee))}) </span>`):t("\x3c!----\x3e"),t(`</p><div class="flex items-center gap-1 bg-gray-100 rounded-lg p-1"><button class="${r.ssrRenderClass(["cards"===a.unref(ie)?"bg-white shadow-sm text-purple-600":"text-gray-500 hover:text-gray-700","p-1.5 rounded transition-colors"])}" title="Vista de tarjetas">`),t(r.ssrRenderComponent(a.unref(render$1),{class:"w-4 h-4"},null,s)),t(`</button><button class="${r.ssrRenderClass(["tabla"===a.unref(ie)?"bg-white shadow-sm text-purple-600":"text-gray-500 hover:text-gray-700","p-1.5 rounded transition-colors"])}" title="Vista de tabla">`),t(r.ssrRenderComponent(a.unref(render),{class:"w-4 h-4"},null,s)),t("</button></div></div><section>"),a.unref(K)?t('<div class="flex flex-col items-center justify-center py-20" role="status"><div class="w-8 h-8 border-2 border-purple-600 border-t-transparent rounded-full animate-spin mb-4"></div><p class="text-sm text-gray-500">Cargando pacientes...</p></div>'):0===a.unref(Fe).length?(t('<div class="flex flex-col items-center justify-center py-20 text-center"><div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4">'),t(r.ssrRenderComponent(a.unref(O),{class:"w-8 h-8 text-gray-400"},null,s)),t(`</div><h3 class="text-lg font-medium text-gray-900 mb-1">${r.ssrInterpolate(a.unref(De)?"Sin resultados":"Sin pacientes")}</h3><p class="text-sm text-gray-500 mb-4 max-w-sm">${r.ssrInterpolate(a.unref(De)?"Prueba ajustando los filtros de b√∫squeda":"Comienza a√±adiendo tu primer paciente")}</p>`),a.unref(De)?t('<button class="px-4 py-2 text-gray-600 text-sm font-medium hover:text-gray-900 transition-colors"> Limpiar filtros </button>'):t('<button class="px-4 py-2 bg-purple-600 text-white text-sm font-medium rounded-lg hover:bg-purple-700 transition-colors"> A√±adir paciente </button>'),t("</div>")):"cards"===a.unref(ie)?(t('<div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-4" role="list">\x3c!--[--\x3e'),r.ssrRenderList(a.unref(Fe),e=>{t('<div class="relative group" role="listitem">'),t(r.ssrRenderComponent(d,{paciente:e,onVerFicha:irAFichaPaciente,onEditar:abrirModalEditar,onEliminar:abrirModalEliminar,onVerCitas:verCitasPaciente,onGestionarBonos:gestionarBonosPaciente,onEditarCita:abrirModalEditarCita},null,s)),e.activo&&!e.en_pausa?(t(`<button class="absolute bottom-4 right-4 min-h-[44px] min-w-[44px] h-11 px-4 bg-purple-600 text-white text-sm font-medium rounded-lg shadow-md hover:bg-purple-700 active:bg-purple-800 transition-all flex items-center justify-center gap-2 opacity-0 group-hover:opacity-100 pointer-events-none group-hover:pointer-events-auto z-10"${r.ssrRenderAttr("aria-label",`Asignar cita a ${e.nombre}`)}>`),t(r.ssrRenderComponent(a.unref(I),{class:"w-5 h-5"},null,s)),t('<span class="hidden sm:inline">Cita</span></button>')):t("\x3c!----\x3e"),t("</div>")}),t("\x3c!--]--\x3e</div>")):"tabla"===a.unref(ie)?(t('<div class="bg-white rounded-xl border border-gray-200 overflow-hidden">'),t(r.ssrRenderComponent(i,{pacientes:a.unref(Fe),onVerFicha:irAFichaPaciente,onEditar:abrirModalEditar,onGestionarBonos:gestionarBonosPaciente,onVerPreview:abrirPreview},null,s)),t("</div>")):t("\x3c!----\x3e"),a.unref(Ee)>1?(t(`<nav class="mt-6 flex items-center justify-center gap-2" role="navigation" aria-label="Paginaci√≥n"><button${r.ssrIncludeBooleanAttr(1===a.unref(be))?" disabled":""} class="min-h-[44px] min-w-[44px] p-2 rounded-lg border border-gray-200 text-gray-600 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center" aria-label="P√°gina anterior">`),t(r.ssrRenderComponent(a.unref(render$5),{class:"w-5 h-5"},null,s)),t('</button><div class="flex items-center gap-1">'),a.unref(be)>3?t('<button class="min-h-[44px] min-w-[44px] px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-50 transition-colors"> 1 </button>'):t("\x3c!----\x3e"),a.unref(be)>4?t('<span class="px-2 text-gray-400">...</span>'):t("\x3c!----\x3e"),t("\x3c!--[--\x3e"),r.ssrRenderList(a.unref(je),e=>{t(`<button class="${r.ssrRenderClass([e===a.unref(be)?"bg-purple-600 text-white":"text-gray-600 hover:bg-gray-50","min-h-[44px] min-w-[44px] px-3 py-2 rounded-lg text-sm font-medium transition-colors"])}">${r.ssrInterpolate(e)}</button>`)}),t("\x3c!--]--\x3e"),a.unref(be)<a.unref(Ee)-3?t('<span class="px-2 text-gray-400">...</span>'):t("\x3c!----\x3e"),a.unref(be)<a.unref(Ee)-2?t(`<button class="min-h-[44px] min-w-[44px] px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-50 transition-colors">${r.ssrInterpolate(a.unref(Ee))}</button>`):t("\x3c!----\x3e"),t(`</div><button${r.ssrIncludeBooleanAttr(a.unref(be)===a.unref(Ee))?" disabled":""} class="min-h-[44px] min-w-[44px] p-2 rounded-lg border border-gray-200 text-gray-600 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center" aria-label="P√°gina siguiente">`),t(r.ssrRenderComponent(a.unref(Z),{class:"w-5 h-5"},null,s)),t("</button></nav>")):t("\x3c!----\x3e"),t("</section>"),t(r.ssrRenderComponent(c,{mostrar:a.unref(g),"paciente-preseleccionado":a.unref(A),onCerrar:cerrarModalAsignarCita,onCitaCreada:manejarCitaCreada},null,s)),t(r.ssrRenderComponent(f,{mostrar:a.unref(u),onCerrar:cerrarModalNuevo,onPacienteCreado:manejarPacienteCreado},null,s)),t(r.ssrRenderComponent(h,{mostrar:a.unref(v),paciente:a.unref(k),onCerrar:cerrarModalEditar,onPacienteActualizado:manejarPacienteActualizado},null,s)),t(r.ssrRenderComponent(w,{mostrar:a.unref(x),paciente:a.unref(k),onCerrar:cerrarModalEliminar,onPacienteEliminado:manejarPacienteEliminado,onPacienteDesactivado:manejarPacienteDesactivado},null,s)),t(r.ssrRenderComponent(E,{isOpen:a.unref(y),citaId:a.unref(R),onClose:cerrarModalEditarCita,onActualizado:handleCitaActualizada},null,s)),t(r.ssrRenderComponent(F,null,null,s)),t(r.ssrRenderComponent(B,{modelValue:a.unref(_),"onUpdate:modelValue":e=>a.isRef(_)?_.value=e:null,"existing-patients":a.unref(Y),onImportComplete:handleImportComplete},null,s)),t(r.ssrRenderComponent(P,{modelValue:a.unref(C),"onUpdate:modelValue":e=>a.isRef(C)?C.value=e:null,"total-patients":a.unref(Be),"filtered-count":a.unref(Fe).length,"has-filters":a.unref(Re)||"todos"!==a.unref(re)||""!==a.unref(ee),"current-filters":a.unref(Me)},null,s)),t(r.ssrRenderComponent(j,{mostrar:a.unref(xe),paciente:a.unref(ge),onCerrar:cerrarPreview,onVerFicha:e=>{cerrarPreview(),irAFichaPaciente(e)},onEditar:e=>{cerrarPreview(),abrirModalEditar(e)},onGestionarBonos:e=>{cerrarPreview(),gestionarBonosPaciente(e)}},null,s)),t("</div>")}}},Se=De.setup;De.setup=(e,t)=>{const r=a.useSSRContext();return(r.modules||(r.modules=new Set)).add("pages/terapeuta/pacientes.vue"),Se?Se(e,t):void 0};export{De as default};
//# sourceMappingURL=pacientes-B87gpmK2.mjs.map
