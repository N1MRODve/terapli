import{x as e}from"../nitro/nitro.mjs";import{i as r,e as o,n as t}from"./server.mjs";import{u as a}from"./useSupabaseClient-DykwVqLQ.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"vue";import"../routes/renderer.mjs";import"vue/server-renderer";import"unhead/server";import"devalue";import"unhead/plugins";import"unhead/utils";import"vue-router";import"@supabase/ssr";import"@vercel/analytics/nuxt";const i=r(async(r,i)=>{var n,l;let s,p;if(!r.path.startsWith("/terapeuta")||"/terapeuta/login"===r.path)return;const u=o(),d=a();if(!u.value)return console.log("[Middleware] Usuario no autenticado, redirigiendo a login"),t("/terapeuta/login",{replace:!0});try{const r=(null==(n=u.value)?void 0:n.id)||(null==(l=u.value)?void 0:l.sub);if(!r)return console.error("[Middleware] No se pudo obtener el ID del usuario:",u.value),t("/terapeuta/login",{replace:!0});const{data:o,error:a}=([s,p]=e(()=>d.from("profiles").select("rol, nombre").eq("id",r).single()),s=await s,p(),s);if(a)return console.error("[Middleware] Error al obtener perfil:",a),t("/terapeuta/login",{replace:!0});const i=null==o?void 0:o.rol;if(!i||!["terapeuta","psicologa","admin","coordinadora"].includes(i))return console.log(`[Middleware] Usuario con rol '${i}' sin acceso, redirigiendo a home`),t("/",{replace:!0});console.log(`[Middleware] Acceso autorizado para: ${(null==o?void 0:o.nombre)||"profesional"} (${i})`)}catch(e){return console.error("[Middleware] Error inesperado:",e),t("/terapeuta/login",{replace:!0})}});export{i as default};
//# sourceMappingURL=auth-terapeuta-Uctz27u8.mjs.map
