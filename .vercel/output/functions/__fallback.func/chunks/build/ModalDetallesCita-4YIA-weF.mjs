import{defineComponent as a,ref as e,watch as t,computed as d,createVNode as l,resolveDynamicComponent as o,unref as i,useSSRContext as s}from"vue";import{ssrRenderTeleport as r,ssrRenderClass as c,ssrRenderVNode as n,ssrInterpolate as v,ssrRenderComponent as u,ssrRenderStyle as p,ssrRenderAttr as b,ssrIncludeBooleanAttr as m,ssrLooseContain as g,ssrLooseEqual as x}from"vue/server-renderer";import{u as f}from"./useSupabaseClient-DykwVqLQ.mjs";import{XCircleIcon as h,CheckCircleIcon as y,ExclamationCircleIcon as w,CalendarIcon as _,XMarkIcon as $,UserIcon as k,ClockIcon as C,VideoCameraIcon as I,MapPinIcon as z,TicketIcon as j,DocumentTextIcon as D,PencilSquareIcon as A}from"@heroicons/vue/24/outline";import{_ as S}from"./_plugin-vue_export-helper-1tPrXgE0.mjs";const q=a({__name:"ModalDetallesCita",__ssrInlineRender:!0,props:{citaId:{}},emits:["close","cita-actualizada","cita-eliminada"],setup(a,{emit:s}){const S=a,q=f(),E=e(null),M=e(null),P=e(null),B=e(!1),L=e(!1),N=e({fecha_cita:"",hora_inicio:"",hora_fin:"",modalidad:"",observaciones:"",estado:""});t(()=>S.citaId,(a,e)=>{console.log("üëÄ Watch citaId cambi√≥:",{oldId:e,newId:a}),a?(async()=>{var a,e;if(console.log("üîç cargarCita - citaId:",S.citaId),S.citaId)try{B.value=!0,console.log("‚è≥ Cargando cita...");const{data:t,error:d}=await q.from("citas").select("\n        *,\n        paciente:pacientes(\n          id,\n          nombre_completo,\n          email,\n          telefono,\n          frecuencia\n        )\n      ").eq("id",S.citaId).single();if(console.log("üìä Resultado query cita:",{citaData:t,citaError:d}),d)throw console.error("‚ùå Error detallado:",JSON.stringify(d,null,2)),d;if(E.value=t,M.value=t.paciente,console.log("‚úÖ Cita cargada:",E.value),console.log("üë§ Paciente:",M.value),t.bono_id){console.log("üéüÔ∏è Cargando bono:",t.bono_id);const{data:a,error:e}=await q.from("bonos").select("*").eq("id",t.bono_id).single();if(console.log("üìä Resultado query bono:",{bonoData:a,bonoError:e}),!e){P.value=a,console.log("‚úÖ Bono cargado:",P.value);const{data:e,error:d}=await q.from("citas").select("id, fecha_cita, hora_inicio").eq("bono_id",t.bono_id).eq("sesion_descontada",!0).order("fecha_cita",{ascending:!0}).order("hora_inicio",{ascending:!0});if(!d&&e){const a=e.findIndex(a=>a.id===S.citaId);-1!==a&&(P.value.numero_sesion=a+1,console.log("üìç N√∫mero de sesi√≥n:",P.value.numero_sesion))}}}N.value={fecha_cita:t.fecha_cita,hora_inicio:(null==(a=t.hora_inicio)?void 0:a.substring(0,5))||"",hora_fin:(null==(e=t.hora_fin)?void 0:e.substring(0,5))||"",modalidad:t.modalidad,observaciones:t.observaciones||"",estado:t.estado}}catch(a){console.error("‚ùå Error al cargar cita:",a)}finally{B.value=!1,console.log("üèÅ Carga finalizada. Estado:",{cita:E.value,paciente:M.value,bono:P.value})}else console.log("‚ö†Ô∏è No hay citaId, cancelando carga")})():(console.log("üßπ Limpiando estado del modal"),E.value=null,M.value=null,P.value=null)},{immediate:!0});const R=d(()=>{var a;if(!(null==(a=E.value)?void 0:a.fecha_cita))return"";return new Date(E.value.fecha_cita+"T00:00:00").toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}),V=d(()=>{var a;return{pendiente:"bg-yellow-100 text-yellow-800 border-yellow-300",confirmada:"bg-emerald-100 text-emerald-800 border-emerald-300",realizada:"bg-blue-100 text-blue-800 border-blue-300",cancelada:"bg-red-100 text-red-800 border-red-300"}[null==(a=E.value)?void 0:a.estado]||"bg-gray-100 text-gray-800"}),H=d(()=>{var a;return{pendiente:"from-yellow-500 to-amber-600",confirmada:"from-emerald-500 to-teal-600",realizada:"from-blue-500 to-indigo-600",cancelada:"from-red-500 to-rose-600"}[null==(a=E.value)?void 0:a.estado]||"from-indigo-500 to-purple-600"}),O=d(()=>{var a;const e=null==(a=E.value)?void 0:a.estado;return{pendiente:w,confirmada:y,realizada:y,cancelada:h}[e]||_}),T=d(()=>{var a,e;return{pendiente:"Pendiente",confirmada:"Confirmada",realizada:"Realizada",cancelada:"Cancelada"}[null==(a=E.value)?void 0:a.estado]||(null==(e=E.value)?void 0:e.estado)||""});return(e,t,d,s)=>{r(t,e=>{var t,s,r,f,h,y;a.citaId?(e(`<div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4" data-v-66c26338><div class="bg-white rounded-2xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-hidden" data-v-66c26338><div class="${c(["sticky top-0 bg-gradient-to-r px-6 py-4 flex items-center justify-between transition-all duration-300",E.value?H.value:"from-indigo-500 to-purple-600"])}" data-v-66c26338><div class="flex items-center gap-3" data-v-66c26338>`),n(e,l(o(E.value?O.value:i(_)),{class:"w-7 h-7 text-white"},null),d),e(`<div data-v-66c26338><h2 class="text-xl font-bold text-white" data-v-66c26338>${v(L.value?"Editar Cita":"Detalles de la Cita")}</h2><p class="text-xs text-white/80 mt-0.5" data-v-66c26338>${v(L.value?"Modifica los datos de la sesi√≥n":"Informaci√≥n completa de la sesi√≥n")}</p></div></div><button class="text-white/90 hover:text-white transition-colors" aria-label="Cerrar" data-v-66c26338>`),e(u(i($),{class:"w-6 h-6"},null,d)),e("</button></div>"),B.value?e('<div class="p-12 flex flex-col items-center justify-center bg-gray-50" data-v-66c26338><div class="w-12 h-12 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin mb-4" data-v-66c26338></div><p class="text-gray-600" data-v-66c26338>Cargando detalles...</p></div>'):E.value?(e('<div class="px-6 py-5 overflow-y-auto max-h-[calc(90vh-180px)] space-y-4 bg-gray-50" data-v-66c26338>'),L.value?e(`<form class="space-y-4" data-v-66c26338><div data-v-66c26338><label class="block text-sm font-semibold text-gray-700 mb-2" data-v-66c26338>Fecha de la cita</label><input${b("value",N.value.fecha_cita)} type="date" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white transition-all" data-v-66c26338></div><div class="grid grid-cols-2 gap-4" data-v-66c26338><div data-v-66c26338><label class="block text-sm font-semibold text-gray-700 mb-2" data-v-66c26338>Hora de inicio</label><input${b("value",N.value.hora_inicio)} type="time" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white transition-all" data-v-66c26338></div><div data-v-66c26338><label class="block text-sm font-semibold text-gray-700 mb-2" data-v-66c26338>Hora de fin</label><input${b("value",N.value.hora_fin)} type="time" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white transition-all" data-v-66c26338></div></div><div class="grid grid-cols-2 gap-4" data-v-66c26338><div data-v-66c26338><label class="block text-sm font-semibold text-gray-700 mb-2" data-v-66c26338>Modalidad</label><select required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white transition-all" data-v-66c26338><option value="presencial" data-v-66c26338${m(Array.isArray(N.value.modalidad)?g(N.value.modalidad,"presencial"):x(N.value.modalidad,"presencial"))?" selected":""}>Presencial</option><option value="virtual" data-v-66c26338${m(Array.isArray(N.value.modalidad)?g(N.value.modalidad,"virtual"):x(N.value.modalidad,"virtual"))?" selected":""}>Virtual</option><option value="telefonica" data-v-66c26338${m(Array.isArray(N.value.modalidad)?g(N.value.modalidad,"telefonica"):x(N.value.modalidad,"telefonica"))?" selected":""}>Telef√≥nica</option></select></div><div data-v-66c26338><label class="block text-sm font-semibold text-gray-700 mb-2" data-v-66c26338>Estado</label><select required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white transition-all" data-v-66c26338><option value="pendiente" data-v-66c26338${m(Array.isArray(N.value.estado)?g(N.value.estado,"pendiente"):x(N.value.estado,"pendiente"))?" selected":""}>Pendiente</option><option value="confirmada" data-v-66c26338${m(Array.isArray(N.value.estado)?g(N.value.estado,"confirmada"):x(N.value.estado,"confirmada"))?" selected":""}>Confirmada</option><option value="realizada" data-v-66c26338${m(Array.isArray(N.value.estado)?g(N.value.estado,"realizada"):x(N.value.estado,"realizada"))?" selected":""}>Realizada</option><option value="cancelada" data-v-66c26338${m(Array.isArray(N.value.estado)?g(N.value.estado,"cancelada"):x(N.value.estado,"cancelada"))?" selected":""}>Cancelada</option></select></div></div><div data-v-66c26338><label class="block text-sm font-semibold text-gray-700 mb-2" data-v-66c26338>Observaciones</label><textarea rows="4" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white resize-none transition-all" placeholder="Notas adicionales sobre la cita..." data-v-66c26338>${v(N.value.observaciones)}</textarea></div></form>`):(e('\x3c!--[--\x3e<div class="bg-white rounded-xl p-5 shadow-sm border border-gray-200" data-v-66c26338><div class="flex items-start justify-between mb-4" data-v-66c26338><div class="flex items-center gap-3" data-v-66c26338><div class="w-12 h-12 bg-gradient-to-br from-indigo-100 to-purple-100 rounded-full flex items-center justify-center" data-v-66c26338>'),e(u(i(k),{class:"w-6 h-6 text-indigo-600"},null,d)),e(`</div><div data-v-66c26338><h3 class="font-semibold text-gray-500 text-xs uppercase tracking-wide mb-1" data-v-66c26338>Paciente</h3><p class="text-xl font-bold text-gray-900" data-v-66c26338>${v((null==(t=M.value)?void 0:t.nombre_completo)||"Sin nombre")}</p></div></div><span class="${c(["px-4 py-2 text-sm font-bold rounded-full shadow-md border-2",V.value])}" data-v-66c26338>${v(T.value.toUpperCase())}</span></div><div class="flex flex-wrap gap-3 text-sm text-gray-600" data-v-66c26338>`),(null==(s=M.value)?void 0:s.email)?e(`<div class="flex items-center gap-2" data-v-66c26338><svg class="w-4 h-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-66c26338><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" data-v-66c26338></path></svg><span data-v-66c26338>${v(M.value.email)}</span></div>`):e("\x3c!----\x3e"),(null==(r=M.value)?void 0:r.telefono)?e(`<div class="flex items-center gap-2" data-v-66c26338><svg class="w-4 h-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-66c26338><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" data-v-66c26338></path></svg><span data-v-66c26338>${v(M.value.telefono)}</span></div>`):e("\x3c!----\x3e"),(null==(f=M.value)?void 0:f.frecuencia)?(e('<div class="flex items-center gap-2 capitalize" data-v-66c26338>'),e(u(i(C),{class:"w-4 h-4 text-gray-400"},null,d)),e(`<span data-v-66c26338>${v(M.value.frecuencia)}</span></div>`)):e("\x3c!----\x3e"),e('</div></div><div class="grid grid-cols-1 md:grid-cols-2 gap-3" data-v-66c26338><div class="bg-white rounded-xl p-4 shadow-sm border border-gray-200" data-v-66c26338><div class="flex items-center gap-2 mb-2" data-v-66c26338>'),e(u(i(_),{class:"w-5 h-5 text-blue-500"},null,d)),e(`<p class="text-xs font-semibold text-gray-500 uppercase tracking-wider" data-v-66c26338>Fecha</p></div><p class="font-bold text-gray-900 capitalize" data-v-66c26338>${v(R.value)}</p></div><div class="bg-white rounded-xl p-4 shadow-sm border border-gray-200" data-v-66c26338><div class="flex items-center gap-2 mb-2" data-v-66c26338>`),e(u(i(C),{class:"w-5 h-5 text-green-500"},null,d)),e(`<p class="text-xs font-semibold text-gray-500 uppercase tracking-wider" data-v-66c26338>Horario</p></div><p class="font-bold text-gray-900" data-v-66c26338>${v(null==(h=E.value.hora_inicio)?void 0:h.substring(0,5))} - ${v(null==(y=E.value.hora_fin)?void 0:y.substring(0,5))}</p></div><div class="bg-white rounded-xl p-4 shadow-sm border border-gray-200" data-v-66c26338><div class="flex items-center gap-2 mb-2" data-v-66c26338>`),n(e,l(o("virtual"===E.value.modalidad?i(I):i(z)),{class:"w-5 h-5 text-purple-500"},null),d),e(`<p class="text-xs font-semibold text-gray-500 uppercase tracking-wider" data-v-66c26338>Modalidad</p></div><p class="font-bold text-gray-900 capitalize" data-v-66c26338>${v(E.value.modalidad||"No especificada")}</p></div><div class="bg-white rounded-xl p-4 shadow-sm border border-gray-200" data-v-66c26338><div class="flex items-center gap-2 mb-2" data-v-66c26338>`),e(u(i(C),{class:"w-5 h-5 text-orange-500"},null,d)),e(`<p class="text-xs font-semibold text-gray-500 uppercase tracking-wider" data-v-66c26338>Duraci√≥n</p></div><p class="font-bold text-gray-900" data-v-66c26338>${v(E.value.duracion_minutos||60)} minutos</p></div></div>`),P.value?(e('<div class="bg-gradient-to-br from-emerald-50 via-teal-50 to-cyan-50 rounded-xl p-5 shadow-sm border border-emerald-200" data-v-66c26338><div class="flex items-start justify-between mb-4" data-v-66c26338><div class="flex items-center gap-3" data-v-66c26338><div class="w-10 h-10 bg-emerald-500 rounded-full flex items-center justify-center" data-v-66c26338>'),e(u(i(j),{class:"w-5 h-5 text-white"},null,d)),e('</div><div data-v-66c26338><h3 class="font-bold text-emerald-900 text-lg" data-v-66c26338>Bono Activo</h3><p class="text-xs text-emerald-700" data-v-66c26338>Informaci√≥n del paquete de sesiones</p></div></div>'),P.value.numero_sesion?e(`<div class="bg-white px-4 py-2 rounded-full border-2 border-emerald-400 shadow-sm" data-v-66c26338><span class="text-sm font-black text-emerald-700" data-v-66c26338>Sesi√≥n #${v(P.value.numero_sesion)}</span></div>`):e("\x3c!----\x3e"),e(`</div><div class="grid grid-cols-3 gap-4 mb-4" data-v-66c26338><div class="bg-white rounded-lg p-3 text-center" data-v-66c26338><p class="text-xs text-emerald-600 mb-1 font-medium" data-v-66c26338>Tipo</p><p class="font-bold text-emerald-900 capitalize text-lg" data-v-66c26338>${v(P.value.tipo||"Individual")}</p></div><div class="bg-white rounded-lg p-3 text-center" data-v-66c26338><p class="text-xs text-emerald-600 mb-1 font-medium" data-v-66c26338>Disponibles</p><p class="font-bold text-emerald-900 text-lg" data-v-66c26338>${v(P.value.sesiones_restantes)}</p></div><div class="bg-white rounded-lg p-3 text-center" data-v-66c26338><p class="text-xs text-emerald-600 mb-1 font-medium" data-v-66c26338>Total</p><p class="font-bold text-emerald-900 text-lg" data-v-66c26338>${v(P.value.sesiones_totales)}</p></div></div><div class="bg-white/70 backdrop-blur rounded-lg p-3" data-v-66c26338><div class="flex items-center justify-between text-xs text-emerald-700 mb-2" data-v-66c26338><span class="font-semibold" data-v-66c26338>Progreso del bono</span><span class="font-bold text-sm" data-v-66c26338>${v(Math.round((P.value.sesiones_totales-P.value.sesiones_restantes)/P.value.sesiones_totales*100))}% </span></div><div class="h-3 bg-emerald-100 rounded-full overflow-hidden" data-v-66c26338><div class="h-full bg-gradient-to-r from-emerald-500 to-teal-500 transition-all duration-500 rounded-full" style="${p({width:(P.value.sesiones_totales-P.value.sesiones_restantes)/P.value.sesiones_totales*100+"%"})}" data-v-66c26338></div></div></div></div>`)):e("\x3c!----\x3e"),E.value.observaciones?(e('<div class="bg-amber-50 rounded-xl p-5 shadow-sm border border-amber-200" data-v-66c26338><div class="flex items-center gap-2 mb-3" data-v-66c26338>'),e(u(i(D),{class:"w-5 h-5 text-amber-600"},null,d)),e(`<h3 class="font-bold text-amber-900" data-v-66c26338>Observaciones</h3></div><p class="text-sm text-amber-900 whitespace-pre-wrap leading-relaxed" data-v-66c26338>${v(E.value.observaciones)}</p></div>`)):e("\x3c!----\x3e"),e(`<div class="text-xs text-gray-400 space-y-1 pt-3 border-t border-gray-200" data-v-66c26338><p class="font-mono" data-v-66c26338>ID: ${v(E.value.id)}</p><p data-v-66c26338>Creada: ${v(new Date(E.value.created_at).toLocaleString("es-ES",{dateStyle:"full",timeStyle:"short"}))}</p>`),E.value.updated_at?e(`<p data-v-66c26338>√öltima modificaci√≥n: ${v(new Date(E.value.updated_at).toLocaleString("es-ES",{dateStyle:"full",timeStyle:"short"}))}</p>`):e("\x3c!----\x3e"),e("</div>\x3c!--]--\x3e")),e("</div>")):e(`<div class="p-12 text-center bg-gray-50" data-v-66c26338><div class="w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-4" data-v-66c26338><svg class="w-8 h-8 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-66c26338><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" data-v-66c26338></path></svg></div><p class="text-gray-600 font-medium" data-v-66c26338>No se encontraron datos de la cita</p><p class="text-gray-400 text-sm mt-1" data-v-66c26338>ID: ${v(a.citaId)}</p><div class="mt-4 text-xs text-left bg-white p-4 rounded border border-gray-200" data-v-66c26338><p class="font-mono" data-v-66c26338>DEBUG:</p><p class="font-mono" data-v-66c26338>cargando: ${v(B.value)}</p><p class="font-mono" data-v-66c26338>cita: ${v(E.value?"existe":"null")}</p><p class="font-mono" data-v-66c26338>citaId prop: ${v(a.citaId)}</p></div></div>`),e('<div class="px-6 py-4 border-t border-gray-200 flex gap-3 bg-white" data-v-66c26338>'),L.value?e(`\x3c!--[--\x3e<button type="button" class="flex-1 px-5 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-colors font-semibold text-sm" data-v-66c26338> Cancelar </button><button type="button"${m(B.value)?" disabled":""} class="flex-1 px-5 py-3 bg-gradient-to-r from-emerald-500 to-teal-600 text-white rounded-xl hover:from-emerald-600 hover:to-teal-700 transition-all font-semibold text-sm disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-emerald-200" data-v-66c26338>${v(B.value?"Guardando...":"Guardar Cambios")}</button>\x3c!--]--\x3e`):(e('\x3c!--[--\x3e<button class="flex-1 px-5 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-colors font-semibold text-sm" data-v-66c26338> Cerrar </button><button class="flex-1 px-5 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-xl hover:from-indigo-600 hover:to-purple-700 transition-all font-semibold text-sm flex items-center justify-center gap-2 shadow-lg shadow-indigo-200" data-v-66c26338>'),e(u(i(A),{class:"w-5 h-5"},null,d)),e(" Editar Cita </button>\x3c!--]--\x3e")),e("</div></div></div>")):e("\x3c!----\x3e")},"body",!1,d)}}}),E=q.setup;q.setup=(a,e)=>{const t=s();return(t.modules||(t.modules=new Set)).add("components/ModalDetallesCita.vue"),E?E(a,e):void 0};const M=Object.assign(S(q,[["__scopeId","data-v-66c26338"]]),{__name:"ModalDetallesCita"});export{M};
//# sourceMappingURL=ModalDetallesCita-4YIA-weF.mjs.map
