import{v as e,h as a,a as t,s}from"./server.mjs";import{u as r}from"./useCitas-DyEZH6RI.mjs";import{_ as o,A as n,g as d,a as l,i,f as c,C as v,r as p}from"./AgendaTerapeuta-ryhLBHQZ.mjs";import{_ as u}from"./_plugin-vue_export-helper-1tPrXgE0.mjs";import{_ as m}from"./ModalNuevaCita-CXmg5Qpz.mjs";import{M as f}from"./ModalDetallesCita-Db71gcxb.mjs";import"../routes/renderer.mjs";import"../nitro/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"../_/shared.cjs.prod.mjs";import"../virtual/_commonjsHelpers.mjs";import"node:stream";import"../_/index2.mjs";import"@supabase/supabase-js";import"@vercel/analytics/nuxt";import"./useSupabaseClient-DykwVqLQ.mjs";import"./ModalNuevaCitaEnhanced-CK2odB5s.mjs";import"./usePacientes-BPAABr51.mjs";import"./CheckCircleIcon-DZf4GX3q.mjs";import"./FunnelIcon-Cg1OAnfP.mjs";import"./ClipboardDocumentListIcon-tIc_vSd1.mjs";import"./PlusIcon-CHLzv-V9.mjs";import"./MagnifyingGlassIcon-GsbNDyPZ.mjs";import"./XMarkIcon-DCLwyE-W.mjs";import"./UserIcon-CrHYaeI9.mjs";import"./useSupabase-DfFg84CY.mjs";import"./CheckCircleIcon-CT9fzVFs.mjs";import"./CalendarIcon-BrsGHJBC.mjs";import"./TicketIcon-zZdrc71S.mjs";import"./PhoneIcon-DdGFuEYy.mjs";import"./ExclamationTriangleIcon-DQdM2y0F.mjs";import"./UserGroupIcon-BhthmHUw.mjs";import"./ClockIcon-BxdFtPqx.mjs";import"./XCircleIcon-BCxujS_I.mjs";import"./CheckBadgeIcon-DjhxLc-3.mjs";import"./ExclamationCircleIcon-DhXgUVTW.mjs";const g=e.defineComponent({__name:"AgendaFilters",__ssrInlineRender:!0,props:{filtros:{},terapeutas:{},pacientes:{}},emits:["update:filtros","update:busqueda"],setup(a,{emit:t}){const r=a,o=t,n=e.ref(""),d=e.ref(!1),l=[{value:"online",label:"Online",emoji:"ğŸ’»"},{value:"presencial",label:"Presencial",emoji:"ğŸ¢"}],i=e.computed({get:()=>r.filtros.pacienteId||"",set:e=>actualizarFiltro("pacienteId",e||void 0)}),c=e.computed({get:()=>r.filtros.modalidad||"",set:e=>actualizarFiltro("modalidad",e||void 0)}),v=e.computed({get:()=>r.filtros.fechaDesde||"",set:e=>actualizarFiltro("fechaDesde",e||void 0)}),p=e.computed({get:()=>r.filtros.fechaHasta||"",set:e=>actualizarFiltro("fechaHasta",e||void 0)}),u=e.computed(()=>{let e=0;return i.value&&e++,c.value&&e++,(v.value||p.value)&&e++,e}),actualizarFiltro=(e,a)=>{o("update:filtros",{...r.filtros,[e]:a})};return(t,r,o,m)=>{r(`<div${s.ssrRenderAttrs(e.mergeProps({class:"bg-white/60 dark:bg-gray-950/60 backdrop-blur-sm border-b border-cafe/5 dark:border-gray-800 shadow-sm"},m))} data-v-b7fec026><div class="px-4 py-2 sm:px-6 lg:px-6 space-y-2" data-v-b7fec026><div class="flex items-center gap-3" data-v-b7fec026><div class="flex-1 relative" data-v-b7fec026><input${s.ssrRenderAttr("value",n.value)} type="text" placeholder="Buscar por paciente, terapeuta, notas..." class="w-full px-3 py-1.5 pl-9 text-sm border border-cafe/20 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-300 focus:border-purple-600 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-all" data-v-b7fec026><svg class="absolute left-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-cafe/50 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-b7fec026><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" data-v-b7fec026></path></svg></div><button class="${s.ssrRenderClass([{"bg-purple-600/10 border-purple-600 text-purple-600":u.value>0},"flex items-center gap-1.5 px-3 py-1.5 text-sm border border-cafe/20 dark:border-gray-700 rounded-lg hover:bg-purple-600/10 dark:hover:bg-gray-800 hover:border-purple-600 transition-all duration-200"])}" data-v-b7fec026><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-b7fec026><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" data-v-b7fec026></path></svg><span data-v-b7fec026>Filtros</span>`),u.value>0?r(`<span class="px-1.5 py-0.5 bg-purple-600 text-white text-xs rounded-full" data-v-b7fec026>${s.ssrInterpolate(u.value)}</span>`):r("\x3c!----\x3e"),r("</button>"),u.value>0||n.value?r('<button class="px-3 py-1.5 text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-950/30 rounded-lg transition-all duration-200" data-v-b7fec026> Limpiar </button>'):r("\x3c!----\x3e"),r("</div>"),d.value?(r(`<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 pt-2" data-v-b7fec026><div data-v-b7fec026><label class="block text-xs font-medium text-cafe/70 dark:text-gray-300 mb-1" data-v-b7fec026> Paciente </label><select class="w-full px-3 py-1.5 text-sm border border-cafe/20 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-300 focus:border-purple-600 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100" data-v-b7fec026><option value="" data-v-b7fec026${s.ssrIncludeBooleanAttr(Array.isArray(i.value)?s.ssrLooseContain(i.value,""):s.ssrLooseEqual(i.value,""))?" selected":""}>Todos los pacientes</option>\x3c!--[--\x3e`),s.ssrRenderList(a.pacientes,e=>{r(`<option${s.ssrRenderAttr("value",e.id)} data-v-b7fec026${s.ssrIncludeBooleanAttr(Array.isArray(i.value)?s.ssrLooseContain(i.value,e.id):s.ssrLooseEqual(i.value,e.id))?" selected":""}>${s.ssrInterpolate(e.nombre)}</option>`)}),r(`\x3c!--]--\x3e</select></div><div data-v-b7fec026><label class="block text-xs font-medium text-cafe/70 dark:text-gray-300 mb-1" data-v-b7fec026> Modalidad </label><select class="w-full px-3 py-1.5 text-sm border border-cafe/20 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-300 focus:border-purple-600 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100" data-v-b7fec026><option value="" data-v-b7fec026${s.ssrIncludeBooleanAttr(Array.isArray(c.value)?s.ssrLooseContain(c.value,""):s.ssrLooseEqual(c.value,""))?" selected":""}>Todas las modalidades</option>\x3c!--[--\x3e`),s.ssrRenderList(l,e=>{r(`<option${s.ssrRenderAttr("value",e.value)} data-v-b7fec026${s.ssrIncludeBooleanAttr(Array.isArray(c.value)?s.ssrLooseContain(c.value,e.value):s.ssrLooseEqual(c.value,e.value))?" selected":""}>${s.ssrInterpolate(e.emoji)} ${s.ssrInterpolate(e.label)}</option>`)}),r(`\x3c!--]--\x3e</select></div><div data-v-b7fec026><label class="block text-xs font-medium text-cafe/70 dark:text-gray-300 mb-1" data-v-b7fec026> Rango de fechas </label><div class="flex gap-2" data-v-b7fec026><input${s.ssrRenderAttr("value",v.value)} type="date" class="flex-1 px-3 py-1.5 text-sm border border-cafe/20 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-300 focus:border-purple-600 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100" data-v-b7fec026><input${s.ssrRenderAttr("value",p.value)} type="date" class="flex-1 px-3 py-1.5 text-sm border border-cafe/20 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-300 focus:border-purple-600 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100" data-v-b7fec026></div></div></div>`)):r("\x3c!----\x3e"),r("</div></div>")}}}),b=g.setup;g.setup=(a,t)=>{const s=e.useSSRContext();return(s.modules||(s.modules=new Set)).add("components/agenda/AgendaFilters.vue"),b?b(a,t):void 0};const x=Object.assign(u(g,[["__scopeId","data-v-b7fec026"]]),{__name:"AgendaFilters"}),h=e.defineComponent({__name:"AgendaLeyendaFiltrable",__ssrInlineRender:!0,props:{citas:{},filtrosActivos:{default:()=>[]}},emits:["update:filtros","filtrar"],setup(a,{emit:t}){const r=a,o=e.ref(new Set(r.filtrosActivos)),n=[{key:"pendiente",label:"Pendientes",color:"#F59E0B",bgColor:"rgba(245, 158, 11, 0.08)",bgColorActive:"rgba(245, 158, 11, 0.15)",borderColorActive:"#F59E0B"},{key:"confirmada",label:"Confirmadas",color:"#10B981",bgColor:"rgba(16, 185, 129, 0.08)",bgColorActive:"rgba(16, 185, 129, 0.15)",borderColorActive:"#10B981"},{key:"realizada",label:"Realizadas",color:"#6366F1",bgColor:"rgba(99, 102, 241, 0.08)",bgColorActive:"rgba(99, 102, 241, 0.15)",borderColorActive:"#6366F1"},{key:"cancelada",label:"Canceladas",color:"#EF4444",bgColor:"rgba(239, 68, 68, 0.08)",bgColorActive:"rgba(239, 68, 68, 0.15)",borderColorActive:"#EF4444"}],d=e.computed(()=>r.citas.length),l=e.computed(()=>0===o.value.size?r.citas.length:r.citas.filter(e=>o.value.has(e.estado)).length),estaActivo=e=>o.value.has(e),i=e.computed(()=>o.value.size>0);return(a,t,o,c)=>{t(`<div${s.ssrRenderAttrs(e.mergeProps({class:"filter-container"},c))} data-v-5c8bd0ad><div class="filter-header" data-v-5c8bd0ad><span class="filter-label" data-v-5c8bd0ad>Estado</span>`),i.value?t(`<div class="filter-count" data-v-5c8bd0ad>${s.ssrInterpolate(l.value)}/${s.ssrInterpolate(d.value)}</div>`):t("\x3c!----\x3e"),i.value?t('<button class="filter-clear" data-v-5c8bd0ad> Limpiar </button>'):t("\x3c!----\x3e"),t('</div><div class="filter-pills" data-v-5c8bd0ad>\x3c!--[--\x3e'),s.ssrRenderList(n,e=>{t(`<button class="${s.ssrRenderClass([{active:estaActivo(e.key)},"filter-pill"])}" style="${s.ssrRenderStyle({"--pill-color":e.color,"--pill-bg":estaActivo(e.key)?e.bgColorActive:e.bgColor,"--pill-border":estaActivo(e.key)?e.borderColorActive:"transparent"})}" data-v-5c8bd0ad><span class="pill-dot" style="${s.ssrRenderStyle({backgroundColor:e.color})}" data-v-5c8bd0ad></span><span class="pill-label" data-v-5c8bd0ad>${s.ssrInterpolate(e.label)}</span><span class="pill-count" data-v-5c8bd0ad>${s.ssrInterpolate((e=>r.citas.filter(a=>a.estado===e).length)(e.key))}</span></button>`)}),t("\x3c!--]--\x3e</div>"),i.value&&0===l.value?t('<div class="filter-empty" data-v-5c8bd0ad><p data-v-5c8bd0ad>No hay citas con los estados seleccionados</p><button data-v-5c8bd0ad>Ver todas</button></div>'):t("\x3c!----\x3e"),t("</div>")}}}),y=h.setup;h.setup=(a,t)=>{const s=e.useSSRContext();return(s.modules||(s.modules=new Set)).add("components/agenda/AgendaLeyendaFiltrable.vue"),y?y(a,t):void 0};const I=Object.assign(u(h,[["__scopeId","data-v-5c8bd0ad"]]),{__name:"AgendaLeyendaFiltrable"}),$=e.defineComponent({__name:"AgendaEventCard",__ssrInlineRender:!0,props:{event:{},compact:{type:Boolean},draggable:{type:Boolean},confirmando:{type:Boolean}},emits:["open","menu","confirmar"],setup(a,{emit:t}){const r=a;e.computed(()=>v[r.event.estado]||v.cancelada);const o=e.computed(()=>`${r.event.horaInicio} â€“ ${r.event.horaFin}`),n=e.computed(()=>r.event.horaInicio),d=e.computed(()=>r.event.pacienteNombre||"Paciente sin nombre");e.computed(()=>({pendiente:"ğŸŸ¡",confirmada:"ğŸŸ¢",cancelada:"ğŸ”´",completada:"âšª",realizada:"ğŸ”µ"}[r.event.estado]||"âšª"));const l=e.computed(()=>r.event.bono&&void 0!==r.event.bono.sesionesRestantes),i=e.computed(()=>{if(!r.event.bono)return"green";const e=r.event.bono.sesionesRestantes||0;return 0===e?"red":1===e?"orange":e<=2?"yellow":"green"}),c=e.computed(()=>{const e="pendiente"===r.event.estado?"pendiente":"confirmada"===r.event.estado?"confirmada":"realizada"===r.event.estado?"realizada":"cancelada",a="online"===r.event.modalidad?"online":"presencial",t=r.event.terapeuta?.nombre?`, con ${r.event.terapeuta.nombre}`:"";return`Cita ${e} de ${d.value}, ${o.value}, ${a}${t}. Pulsa para ver detalles${"pendiente"===r.event.estado?" o confirmar":""}.`}),u=e.computed(()=>"pendiente"===r.event.estado);return(t,r,v,m)=>{r(`<div${s.ssrRenderAttrs(e.mergeProps({class:["agenda-event group",{confirmando:a.confirmando}],"data-estado":a.event.estado,"data-compact":a.compact,draggable:a.draggable,role:"button",tabindex:"0","aria-label":c.value,title:`${d.value} - ${o.value}. Click para ver detalles.`},m))} data-v-6a204a48><div class="${s.ssrRenderClass(["flex flex-col justify-center",a.compact?"gap-0.5":"gap-1"])}" data-v-6a204a48><span class="hora" data-v-6a204a48>${s.ssrInterpolate(a.compact?n.value:o.value)}</span><span class="nombre" data-v-6a204a48><span class="estado-dot" data-v-6a204a48></span> ${s.ssrInterpolate(d.value)}</span>`),a.compact?r("\x3c!----\x3e"):(r('<div class="info-adicional" data-v-6a204a48>'),a.event.modalidad?(r('<span class="modalidad" data-v-6a204a48>'),"online"===a.event.modalidad?r("<span data-v-6a204a48>ğŸ’»</span>"):r("<span data-v-6a204a48>ğŸ¥</span>"),r(` ${s.ssrInterpolate("online"===a.event.modalidad?"Online":"Presencial")}</span>`)):r("\x3c!----\x3e"),a.event.areaTerapeutica?r(`<span class="area" data-v-6a204a48>${s.ssrInterpolate(a.event.areaTerapeutica)}</span>`):r("\x3c!----\x3e"),l.value?r(`<span class="bono-info"${s.ssrRenderAttr("data-color",i.value)} data-v-6a204a48>${s.ssrInterpolate(a.event.bono.sesionesRestantes)}/${s.ssrInterpolate(a.event.bono.sesionesTotales)} sesiones </span>`):r("\x3c!----\x3e"),a.event.notas||a.event.terapeuta?(r('<div class="indicadores" data-v-6a204a48>'),a.event.notas?r('<span title="Tiene notas" data-v-6a204a48>ğŸ“</span>'):r("\x3c!----\x3e"),a.event.terapeuta?r(`<span${s.ssrRenderAttr("title",`Terapeuta: ${a.event.terapeuta.nombre}`)} data-v-6a204a48>ğŸ‘¤</span>`):r("\x3c!----\x3e"),r("</div>")):r("\x3c!----\x3e"),r("</div>")),r("</div>"),!a.compact&&u.value?(r(`<button class="${s.ssrRenderClass([{confirming:a.confirmando},"confirm-btn"])}"${s.ssrIncludeBooleanAttr(a.confirmando)?" disabled":""}${s.ssrRenderAttr("aria-label",`Confirmar cita de ${d.value}`)}${s.ssrRenderAttr("title",a.confirmando?"Confirmando...":"Confirmar cita rÃ¡pidamente")} type="button" data-v-6a204a48>`),a.confirmando?r('<svg class="w-3.5 h-3.5 animate-spin" fill="none" viewBox="0 0 24 24" data-v-6a204a48><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" data-v-6a204a48></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" data-v-6a204a48></path></svg>'):r(s.ssrRenderComponent(e.unref(p),{class:"w-3.5 h-3.5"},null,v)),r("</button>")):r("\x3c!----\x3e"),a.compact?r("\x3c!----\x3e"):r('<button class="menu-btn" aria-label="Abrir menÃº de acciones" type="button" data-v-6a204a48><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20" data-v-6a204a48><path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z" data-v-6a204a48></path></svg></button>'),r("</div>")}}}),C=$.setup;$.setup=(a,t)=>{const s=e.useSSRContext();return(s.modules||(s.modules=new Set)).add("components/agenda/AgendaEventCard.vue"),C?C(a,t):void 0};const k=Object.assign(u($,[["__scopeId","data-v-6a204a48"]]),{__name:"AgendaEventCard"}),w=e.defineComponent({__name:"AgendaGrid",__ssrInlineRender:!0,props:{eventos:{},vista:{},fechaActual:{},cargando:{type:Boolean},draggable:{type:Boolean}},emits:["evento-click","evento-menu","slot-click","evento-drop"],setup(a,{emit:t}){const r=a;e.ref(null);const o=e.ref(null),n=e.ref("0px"),v=e.ref(!1),p=e.ref(new Set),u=d("08:00","22:30",30);e.computed(()=>"h-8");const m=e.computed(()=>{const e=r.fechaActual.toISOString().split("T")[0];if("dia"===r.vista)return[e];if("5dias"===r.vista)return Array.from({length:5},(a,t)=>l(e,t));if("semana"===r.vista){const a=i(e);return Array.from({length:7},(e,t)=>l(a,t))}{const e=new Date(r.fechaActual.getFullYear(),r.fechaActual.getMonth(),1),a=new Date(r.fechaActual.getFullYear(),r.fechaActual.getMonth()+1,0);let t=e.getDay();t=0===t?6:t-1;let s=a.getDay();s=0===s?6:s-1;const o=[];for(let a=t-1;a>=0;a--){const t=new Date(e);t.setDate(t.getDate()-(a+1)),o.push(t.toISOString().split("T")[0])}for(let t=new Date(e);t<=a;t.setDate(t.getDate()+1))o.push(t.toISOString().split("T")[0]);const n=6-s;for(let e=1;e<=n;e++){const t=new Date(a);t.setDate(t.getDate()+e),o.push(t.toISOString().split("T")[0])}return o}}),f=e.computed(()=>{const e=new Map;return r.eventos.forEach(a=>{const t=a.fecha;e.has(t)||e.set(t,[]),e.get(t).push(a)}),e.forEach((e,a)=>{e.sort((e,a)=>e.horaInicio.localeCompare(a.horaInicio))}),e}),obtenerEventosEnSlot=(e,a)=>(f.value.get(e)||[]).filter(e=>e.horaInicio===a),esFechaHoy=e=>e===(new Date).toISOString().split("T")[0],esMesActual=e=>{const a=new Date(e+"T00:00:00");return a.getMonth()===r.fechaActual.getMonth()&&a.getFullYear()===r.fechaActual.getFullYear()},calcularAlturaEvento=(e,a)=>{try{const t=new Date(`1970-01-01T${e}:00`),s=(new Date(`1970-01-01T${a}:00`).getTime()-t.getTime())/6e4;return`${s*(2.25/30)}rem`}catch{return"2.5rem"}},calcularTopEvento=(e,a)=>{try{const t=new Date(`1970-01-01T${e}:00`),s=new Date(`1970-01-01T${a}:00`),r=(t.getTime()-s.getTime())/6e4;if(r<=0)return"0";return r*(2.25/30)+"rem"}catch{return"0"}},esCitaActiva=e=>p.value.has(e);return e.watch([()=>r.vista,()=>r.cargando],()=>{r.cargando||setTimeout(()=>{"mes"===r.vista?(async()=>{if(await e.nextTick(),"mes"!==r.vista)return;const a=(new Date).toISOString().split("T")[0],t=(void 0).querySelector(".agenda-mes-grid"),s=(void 0).querySelector(`[data-fecha="${a}"]`);s&&t&&s.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})})():(async()=>{if(await e.nextTick(),!o.value||r.cargando)return;const a=new Date,t=`${String(a.getHours()).padStart(2,"0")}:${String(30*Math.floor(a.getMinutes()/30)).padStart(2,"0")}`,s=u.findIndex(e=>e>=t);if(-1!==s){const e=40,a=Math.max(0,(s-2)*e);o.value.scrollTop=a}})()},100)}),(t,r,o,d)=>{r(`<div${s.ssrRenderAttrs(e.mergeProps({class:"flex-1 flex flex-col overflow-hidden bg-[#FFF9F6] dark:bg-gray-900"},d))} data-v-cf723e89>`),a.cargando?r('<div class="flex items-center justify-center h-full" data-v-cf723e89><div class="text-center space-y-3" data-v-cf723e89><div class="w-12 h-12 border-4 border-purple-600/20 border-t-purple-600 rounded-full animate-spin mx-auto" data-v-cf723e89></div><p class="text-cafe/60 dark:text-gray-400" data-v-cf723e89>Cargando agenda...</p></div></div>'):r("\x3c!----\x3e"),a.cargando?r("\x3c!----\x3e"):r('<div class="agenda-controls" data-v-cf723e89><div class="leyenda-estados" data-v-cf723e89><div class="estado" data-v-cf723e89><span class="dot" data-color="pendiente" data-v-cf723e89></span><span data-v-cf723e89>Pendiente</span></div><div class="estado" data-v-cf723e89><span class="dot" data-color="confirmada" data-v-cf723e89></span><span data-v-cf723e89>Confirmada</span></div><div class="estado" data-v-cf723e89><span class="dot" data-color="realizada" data-v-cf723e89></span><span data-v-cf723e89>Realizada</span></div><div class="estado" data-v-cf723e89><span class="dot" data-color="cancelada" data-v-cf723e89></span><span data-v-cf723e89>Cancelada</span></div></div></div>'),a.cargando||"dia"!==a.vista?r("\x3c!----\x3e"):(r('<div class="agenda-container" data-v-cf723e89><div class="agenda-grid-dia" data-v-cf723e89>'),v.value?r(`<div class="linea-tiempo-actual" style="${s.ssrRenderStyle({top:n.value})}" data-v-cf723e89><div class="circulo-tiempo" data-v-cf723e89></div><div class="texto-tiempo" data-v-cf723e89>${s.ssrInterpolate((new Date).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}))}</div></div>`):r("\x3c!----\x3e"),r("\x3c!--[--\x3e"),s.ssrRenderList(e.unref(u),(e,a)=>{r(`<div class="${s.ssrRenderClass([a%2==0?"bg-white":"bg-[#FFFAF7]","agenda-cell-dia group"])}" style="${s.ssrRenderStyle({minHeight:"2.5rem"})}" data-v-cf723e89><div class="hora-dia" data-v-cf723e89>${s.ssrInterpolate(e)}</div><div class="eventos-container" data-v-cf723e89>\x3c!--[--\x3e`),s.ssrRenderList(obtenerEventosEnSlot(m.value[0],e),(e,a)=>{r(`<div class="${s.ssrRenderClass([{"cita-activa":esCitaActiva(e.id)},"agenda-event-dia"])}"${s.ssrRenderAttr("data-estado",e.estado)} style="${s.ssrRenderStyle({"--event-height":calcularAlturaEvento(e.horaInicio,e.horaFin)})}" data-v-cf723e89><span class="hora" data-v-cf723e89>${s.ssrInterpolate(e.horaInicio)} - ${s.ssrInterpolate(e.horaFin)}</span><span class="nombre" data-v-cf723e89>${s.ssrInterpolate(e.pacienteNombre)}</span><div class="tooltip" data-v-cf723e89><div class="font-semibold" data-v-cf723e89>${s.ssrInterpolate(e.pacienteNombre)}</div><div data-v-cf723e89>${s.ssrInterpolate(e.horaInicio)} - ${s.ssrInterpolate(e.horaFin)}</div>`),e.modalidad?r(`<div data-v-cf723e89>${s.ssrInterpolate("online"===e.modalidad?"ğŸ’» Online":"ğŸ¥ Presencial")}</div>`):r("\x3c!----\x3e"),e.areaTerapeutica?r(`<div class="text-[10px] opacity-80" data-v-cf723e89>${s.ssrInterpolate(e.areaTerapeutica)}</div>`):r("\x3c!----\x3e"),r("</div></div>")}),r("\x3c!--]--\x3e"),0===obtenerEventosEnSlot(m.value[0],e).length?r('<div class="add-slot-indicator" data-v-cf723e89><span class="add-icon" data-v-cf723e89>+</span><span class="add-text" data-v-cf723e89>Nueva cita</span></div>'):r("\x3c!----\x3e"),r("</div></div>")}),r("\x3c!--]--\x3e</div></div>")),a.cargando||"semana"!==a.vista&&"5dias"!==a.vista?r("\x3c!----\x3e"):(r(`<div class="agenda-container" data-v-cf723e89><div class="agenda-days" style="${s.ssrRenderStyle({gridTemplateColumns:`3rem repeat(${m.value.length}, 1fr)`})}" data-v-cf723e89><div data-v-cf723e89></div>\x3c!--[--\x3e`),s.ssrRenderList(m.value,a=>{r(`<div class="${s.ssrRenderClass([esFechaHoy(a)?"bg-purple-600/5 border-b-2 border-purple-600":"","py-2 px-1"])}" data-v-cf723e89><div class="text-xs font-medium text-cafe/70" data-v-cf723e89>${s.ssrInterpolate(e.unref(c)(a).split(",")[0])}</div><div class="text-sm font-bold text-cafe" data-v-cf723e89>${s.ssrInterpolate(new Date(a+"T00:00:00").getDate())}</div></div>`)}),r(`\x3c!--]--\x3e</div><div class="agenda-grid" style="${s.ssrRenderStyle({gridTemplateColumns:`3rem repeat(${m.value.length}, 1fr)`})}" data-v-cf723e89>`),v.value?r(`<div class="linea-tiempo-actual" style="${s.ssrRenderStyle({top:n.value,left:"0",right:"0",gridColumn:"1 / -1"})}" data-v-cf723e89><div class="circulo-tiempo" data-v-cf723e89></div><div class="texto-tiempo" data-v-cf723e89>${s.ssrInterpolate((new Date).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}))}</div></div>`):r("\x3c!----\x3e"),r("\x3c!--[--\x3e"),s.ssrRenderList(e.unref(u),(e,a)=>{r(`\x3c!--[--\x3e<div class="agenda-hours" data-v-cf723e89>${s.ssrInterpolate(e)}</div>\x3c!--[--\x3e`),s.ssrRenderList(m.value,t=>{r(`<div class="${s.ssrRenderClass([a%2==0?"bg-white":"bg-[#FFFAF7]","agenda-cell"])}" data-v-cf723e89>\x3c!--[--\x3e`),s.ssrRenderList(obtenerEventosEnSlot(t,e),a=>{r(`<div class="${s.ssrRenderClass([{"cita-activa":esCitaActiva(a.id)},"agenda-event"])}"${s.ssrRenderAttr("data-estado",a.estado)} style="${s.ssrRenderStyle({"--event-height":calcularAlturaEvento(a.horaInicio,a.horaFin),top:calcularTopEvento(a.horaInicio,e)})}" data-v-cf723e89><span class="hora" data-v-cf723e89>${s.ssrInterpolate(a.horaInicio)} - ${s.ssrInterpolate(a.horaFin)}</span><span class="nombre" data-v-cf723e89>${s.ssrInterpolate(a.pacienteNombre)}</span><div class="tooltip" data-v-cf723e89><div class="font-semibold" data-v-cf723e89>${s.ssrInterpolate(a.pacienteNombre)}</div><div data-v-cf723e89>${s.ssrInterpolate(a.horaInicio)} - ${s.ssrInterpolate(a.horaFin)}</div>`),a.modalidad?r(`<div data-v-cf723e89>${s.ssrInterpolate("online"===a.modalidad?"ğŸ’» Online":"ğŸ¥ Presencial")}</div>`):r("\x3c!----\x3e"),a.areaTerapeutica?r(`<div class="text-[10px] opacity-80" data-v-cf723e89>${s.ssrInterpolate(a.areaTerapeutica)}</div>`):r("\x3c!----\x3e"),r("</div></div>")}),r("\x3c!--]--\x3e</div>")}),r("\x3c!--]--\x3e\x3c!--]--\x3e")}),r("\x3c!--]--\x3e</div></div>")),a.cargando||"mes"!==a.vista?r("\x3c!----\x3e"):(r('<div class="agenda-mes-container" data-v-cf723e89><div class="agenda-mes-grid" data-v-cf723e89>\x3c!--[--\x3e'),s.ssrRenderList(["Lun","Mar","MiÃ©","Jue","Vie","SÃ¡b","Dom"],e=>{r(`<div class="agenda-mes-header" data-v-cf723e89>${s.ssrInterpolate(e)}</div>`)}),r("\x3c!--]--\x3e\x3c!--[--\x3e"),s.ssrRenderList(m.value,e=>{r(`<div${s.ssrRenderAttr("data-fecha",e)} class="${s.ssrRenderClass([[esFechaHoy(e)?"dia-hoy":"",esMesActual(e)?"":"dia-otro-mes"],"agenda-dia-mes"])}" data-v-cf723e89><div class="agenda-dia-header" data-v-cf723e89><span class="dia-numero" data-v-cf723e89>${s.ssrInterpolate(new Date(e+"T00:00:00").getDate())}</span><div class="flex items-center gap-1" data-v-cf723e89>`),(f.value.get(e)||[]).length>0?r(`<span class="contador-citas"${s.ssrRenderAttr("title",`${(f.value.get(e)||[]).length} cita${(f.value.get(e)||[]).length>1?"s":""}`)} data-v-cf723e89>${s.ssrInterpolate((f.value.get(e)||[]).length)}</span>`):r("\x3c!----\x3e"),esFechaHoy(e)?r('<span class="dia-hoy-badge" data-v-cf723e89>Hoy</span>'):r("\x3c!----\x3e"),r('</div></div><div class="agenda-dia-eventos" data-v-cf723e89>\x3c!--[--\x3e'),s.ssrRenderList((f.value.get(e)||[]).slice(0,2),e=>{r(s.ssrRenderComponent(k,{key:e.id,event:e,compact:!0,onOpen:a=>t.$emit("evento-click",e.id)},null,o))}),r("\x3c!--]--\x3e"),(f.value.get(e)||[]).length>2?r(`<button class="mas-eventos"${s.ssrRenderAttr("title",`Ver todas las ${(f.value.get(e)||[]).length} citas de este dÃ­a`)} data-v-cf723e89> +${s.ssrInterpolate((f.value.get(e)||[]).length-2)} mÃ¡s </button>`):r("\x3c!----\x3e"),r('</div><span class="add-indicator" data-v-cf723e89>+</span></div>')}),r("\x3c!--]--\x3e</div></div>")),r("</div>")}}}),R=w.setup;w.setup=(a,t)=>{const s=e.useSSRContext();return(s.modules||(s.modules=new Set)).add("components/agenda/AgendaGrid.vue"),R?R(a,t):void 0};const A=Object.assign(u(w,[["__scopeId","data-v-cf723e89"]]),{__name:"AgendaGrid"}),S=e.defineComponent({__name:"index",__ssrInlineRender:!0,props:{legacyFallback:{type:Boolean}},setup(d){a(),t();const{getCitasRango:l}=r(),i=e.ref([]),c=e.ref(!1),v=e.ref(null),p=e.ref("semana"),u=e.ref(new Date),g=e.ref(!1),b=e.ref({}),h=e.ref(""),y=e.ref(!1),$=e.ref(!1),C=e.ref(null),k=e.ref(null),w=e.ref(!1),R=e.ref({x:0,y:0}),S=e.ref(null),_=e.computed(()=>i.value?.length?i.value.map(e=>({id:e.cita_id||e.id,pacienteNombre:e.paciente_nombre||"Sin paciente",pacienteId:e.paciente_id,estado:e.estado,fecha:e.fecha_cita,horaInicio:e.hora_inicio?.substring(0,5)||e.hora_inicio,horaFin:e.hora_fin?.substring(0,5)||e.hora_fin,modalidad:e.modalidad,bono:e.bono_id?{id:e.bono_id,sesionesRestantes:e.bono_sesiones_restantes,sesionesTotales:e.bono_sesiones_totales}:null,terapeuta:e.terapeuta_id?{id:e.terapeuta_id,nombre:e.terapeuta_nombre}:void 0,notas:e.observaciones||void 0,areaTerapeutica:e.paciente_area||void 0,tipoSesion:e.tipo_sesion||void 0})):[]),D=e.computed(()=>{let e=_.value;if(h.value.trim()){const a=h.value.toLowerCase();e=e.filter(e=>e.pacienteNombre.toLowerCase().includes(a)||e.terapeuta?.nombre.toLowerCase().includes(a)||e.notas?.toLowerCase().includes(a))}return b.value.estados?.length&&(e=e.filter(e=>b.value.estados.includes(e.estado))),b.value.terapeutaId&&(e=e.filter(e=>e.terapeuta?.id===b.value.terapeutaId)),b.value.pacienteId&&(e=e.filter(e=>e.pacienteId===b.value.pacienteId)),b.value.modalidad&&(e=e.filter(e=>e.modalidad===b.value.modalidad)),b.value.fechaDesde&&(e=e.filter(e=>e.fecha>=b.value.fechaDesde)),b.value.fechaHasta&&(e=e.filter(e=>e.fecha<=b.value.fechaHasta)),e}),T=e.computed(()=>[]),j=e.computed(()=>{const e=new Map;return i.value?.forEach(a=>{a.paciente_id&&e.set(a.paciente_id,{id:a.paciente_id,nombre:a.paciente_nombre||"Sin nombre"})}),Array.from(e.values())}),cargarCitas=async()=>{try{c.value=!0,v.value=null;let e,a;if("dia"===p.value)e=a=u.value.toISOString().split("T")[0];else if("5dias"===p.value){e=u.value.toISOString().split("T")[0];const t=new Date(u.value);t.setDate(t.getDate()+4),a=t.toISOString().split("T")[0]}else if("semana"===p.value){const t=new Date(u.value);t.setDate(t.getDate()-t.getDay()),e=t.toISOString().split("T")[0];const s=new Date(t);s.setDate(s.getDate()+6),a=s.toISOString().split("T")[0]}else{const t=new Date(u.value.getFullYear(),u.value.getMonth(),1),s=new Date(u.value.getFullYear(),u.value.getMonth()+1,0);e=t.toISOString().split("T")[0],a=s.toISOString().split("T")[0]}const t=await l(e,a);i.value=t.filter(e=>"cancelada"!==e.estado&&"borrador"!==e.estado&&null!==e.estado)}catch(e){console.error("âŒ Error al cargar citas:",e),v.value=e.message}finally{c.value=!1}};e.watch(p,e=>{cargarCitas()}),e.watch(u,()=>{cargarCitas()}),e.watch(u,e=>{}),e.watch(g,e=>{}),e.watch(b,e=>{},{deep:!0});const abrirModalNuevaCita=()=>{k.value=null,y.value=!0},crearCitaEnSlot=e=>{D.value.some(a=>a.fecha===e.date&&a.horaInicio===e.horaInicio)||(k.value=e,y.value=!0)},abrirDetalles=e=>{C.value=e,$.value=!0},abrirMenu=(e,a)=>{S.value=e,R.value={x:a.clientX,y:a.clientY},w.value=!0},moverCita=async(e,a)=>{try{console.log("Reprogramar cita:",e,a),await cargarCitas()}catch(e){console.error("Error al reprogramar cita:",e),alert("No se pudo reprogramar la cita. Intenta nuevamente.")}};return(e,a,t,r)=>{a(`<div${s.ssrRenderAttrs(r)} data-v-20bc017e>`),d.legacyFallback?a(s.ssrRenderComponent(o,null,null,t)):(a(`<div class="${s.ssrRenderClass([{dark:g.value},"agenda-main-container"])}" data-v-20bc017e>`),a(s.ssrRenderComponent(n,{vista:p.value,"onUpdate:vista":e=>p.value=e,fechaActual:u.value,"onUpdate:fechaActual":e=>u.value=e,darkMode:g.value,"onUpdate:darkMode":e=>g.value=e,onNuevaCita:abrirModalNuevaCita},null,t)),a(s.ssrRenderComponent(x,{filtros:b.value,"onUpdate:filtros":e=>b.value=e,"onUpdate:busqueda":e=>h.value=e,terapeutas:T.value,pacientes:j.value},null,t)),a('<div class="filter-section" data-v-20bc017e>'),a(s.ssrRenderComponent(I,{citas:_.value,"filtros-activos":b.value.estados||[],onFiltrar:e=>{b.value.estados=e.length>0?e:void 0}},null,t)),a("</div>"),a(s.ssrRenderComponent(A,{eventos:D.value,vista:p.value,fechaActual:u.value,cargando:c.value,draggable:!0,onEventoClick:abrirDetalles,onEventoMenu:abrirMenu,onSlotClick:crearCitaEnSlot,onEventoDrop:moverCita},null,t)),a(s.ssrRenderComponent(m,{modelValue:y.value,"onUpdate:modelValue":e=>y.value=e,"fecha-preseleccionada":k.value?.date,"hora-preseleccionada":k.value?.horaInicio,onCitaCreada:cargarCitas,onCerrar:e=>{y.value=!1,k.value=null}},null,t)),a(s.ssrRenderComponent(f,{isOpen:$.value,citaId:C.value,onClose:e=>{$.value=!1,C.value=null},onActualizado:cargarCitas,onEliminado:cargarCitas},null,t)),s.ssrRenderTeleport(a,e=>{w.value?e(`<div style="${s.ssrRenderStyle({top:`${R.value.y}px`,left:`${R.value.x}px`})}" class="fixed z-50 bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-700 rounded-lg shadow-lg py-1 min-w-[180px]" data-v-20bc017e><button class="w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-800 transition" data-v-20bc017e> Ver detalles </button><button class="w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-800 transition" data-v-20bc017e> Reprogramar </button><button class="w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-800 transition text-red-600" data-v-20bc017e> Cancelar cita </button></div>`):e("\x3c!----\x3e")},"body",!1,t),a('<div class="fixed bottom-4 right-4 bg-gray-900/90 dark:bg-gray-100/90 text-white dark:text-gray-900 px-3 py-2 rounded-lg text-xs opacity-0 hover:opacity-100 transition-opacity" data-v-20bc017e><kbd data-v-20bc017e>â†/â†’</kbd> navegar Â· <kbd data-v-20bc017e>t</kbd> hoy Â· <kbd data-v-20bc017e>1/2/3/4</kbd> vistas Â· <kbd data-v-20bc017e>n</kbd> nueva Â· <kbd data-v-20bc017e>f</kbd> buscar </div></div>')),a("</div>")}}}),_=S.setup;S.setup=(a,t)=>{const s=e.useSSRContext();return(s.modules||(s.modules=new Set)).add("pages/agenda/index.vue"),_?_(a,t):void 0};const D=u(S,[["__scopeId","data-v-20bc017e"]]);export{D as default};
//# sourceMappingURL=index-Dwlh0F9P.mjs.map
