import { ref, computed, mergeProps, unref, useSSRContext } from 'vue';
import { ssrRenderAttrs, ssrInterpolate, ssrRenderAttr, ssrIncludeBooleanAttr, ssrLooseContain, ssrLooseEqual, ssrRenderList, ssrRenderClass, ssrRenderStyle } from 'vue/server-renderer';
import { u as useSupabaseClient } from './useSupabaseClient-DykwVqLQ.mjs';
import { a as useRouter } from './server.mjs';
import '../nitro/nitro.mjs';
import 'node:http';
import 'node:https';
import 'node:events';
import 'node:buffer';
import 'node:fs';
import 'node:path';
import 'node:crypto';
import '../routes/renderer.mjs';
import 'vue-bundle-renderer/runtime';
import 'unhead/server';
import 'devalue';
import 'unhead/plugins';
import 'unhead/utils';
import 'vue-router';
import '@supabase/ssr';
import '@vercel/analytics/nuxt';

const _sfc_main = {
  __name: "pacientes",
  __ssrInlineRender: true,
  setup(__props) {
    useSupabaseClient();
    useRouter();
    const cargando = ref(true);
    const pacientes = ref([]);
    const terapeutas = ref([]);
    const busqueda = ref("");
    const filtroEstado = ref("");
    const filtroTerapeuta = ref("");
    const mostrarModalNuevoPaciente = ref(false);
    const guardando = ref(false);
    const nuevoPaciente = ref({
      nombre_completo: "",
      email: "",
      telefono: "+34 ",
      terapeuta_id: null,
      notas: "",
      activo: true,
      tiene_bono_existente: false,
      bono: {
        tipo: "",
        sesiones_totales: 0,
        sesiones_consumidas: 0,
        fecha_compra: null,
        monto_total: 0,
        estado_pago: "pagado"
      }
    });
    const totalPacientes = computed(() => pacientes.value.length);
    const pacientesActivos = computed(
      () => pacientes.value.filter((p) => p.estado === "activo" || p.activo).length
    );
    const bonosActivos = computed(
      () => pacientes.value.filter((p) => p.bono_activo && p.bono_activo.sesiones_restantes > 0).length
    );
    const bonosPorAgotar = computed(
      () => pacientes.value.filter((p) => p.bono_activo && p.bono_activo.sesiones_restantes <= 1).length
    );
    const pacientesFiltrados = computed(() => {
      let resultado = [...pacientes.value];
      if (busqueda.value.trim()) {
        const query = busqueda.value.toLowerCase();
        resultado = resultado.filter(
          (p) => p.nombre_completo?.toLowerCase().includes(query) || p.email?.toLowerCase().includes(query) || p.telefono?.includes(query)
        );
      }
      if (filtroEstado.value === "activo") {
        resultado = resultado.filter((p) => p.estado === "activo" || p.activo);
      } else if (filtroEstado.value === "inactivo") {
        resultado = resultado.filter((p) => p.estado === "inactivo" || !p.activo);
      }
      if (filtroTerapeuta.value) {
        resultado = resultado.filter((p) => p.terapeuta_id === filtroTerapeuta.value);
      }
      return resultado;
    });
    const obtenerIniciales = (nombre) => {
      if (!nombre) return "PA";
      return nombre.split(" ").map((n) => n[0]).join("").toUpperCase().substring(0, 2);
    };
    const getEstadoClasses = (estado) => {
      const estadoNormalizado = estado?.toLowerCase() || "inactivo";
      if (estadoNormalizado === "activo") return "bg-green-100 text-green-700";
      return "bg-gray-100 text-gray-700";
    };
    const getEstadoLabel = (estado) => {
      const estadoNormalizado = estado?.toLowerCase() || "inactivo";
      if (estadoNormalizado === "activo") return "Activo";
      return "Inactivo";
    };
    const formatearFechaCorta = (fecha) => {
      if (!fecha) return "No especificada";
      const date = new Date(fecha);
      return date.toLocaleDateString("es-ES", {
        day: "2-digit",
        month: "short",
        year: "numeric"
      });
    };
    const pacienteSeleccionado = ref(null);
    const mostrarModalDetalle = ref(false);
    const modoEdicion = ref(false);
    const datosEdicion = ref({});
    const guardandoEdicion = ref(false);
    return (_ctx, _push, _parent, _attrs) => {
      _push(`<div${ssrRenderAttrs(mergeProps({ class: "min-h-screen bg-gray-50 p-6 space-y-6" }, _attrs))}><div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6"><div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4"><div><h1 class="text-2xl font-serif font-bold text-cafe">Gestión de Pacientes</h1><p class="text-sm text-gray-600 mt-1">${ssrInterpolate(unref(totalPacientes))} pacientes registrados · ${ssrInterpolate(unref(pacientesActivos))} activos </p></div><div class="flex flex-wrap items-center gap-3"><div class="relative flex-1 min-w-[300px]"><svg class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg><input${ssrRenderAttr("value", unref(busqueda))} type="text" placeholder="Buscar por nombre, email o teléfono..." class="w-full px-4 py-2.5 pl-10 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-terracota/20 transition-all duration-200"></div><button class="px-4 py-2.5 bg-terracota text-white rounded-lg hover:bg-terracota/90 transition-all duration-200 text-sm font-medium whitespace-nowrap flex items-center gap-2 shadow-sm"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg><span>Nuevo Paciente</span></button></div></div><div class="flex flex-wrap gap-3 mt-4 pt-4 border-t border-gray-100"><select class="px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-terracota/20 transition-all duration-200"><option value=""${ssrIncludeBooleanAttr(Array.isArray(unref(filtroEstado)) ? ssrLooseContain(unref(filtroEstado), "") : ssrLooseEqual(unref(filtroEstado), "")) ? " selected" : ""}>Todos los estados</option><option value="activo"${ssrIncludeBooleanAttr(Array.isArray(unref(filtroEstado)) ? ssrLooseContain(unref(filtroEstado), "activo") : ssrLooseEqual(unref(filtroEstado), "activo")) ? " selected" : ""}>Activos</option><option value="inactivo"${ssrIncludeBooleanAttr(Array.isArray(unref(filtroEstado)) ? ssrLooseContain(unref(filtroEstado), "inactivo") : ssrLooseEqual(unref(filtroEstado), "inactivo")) ? " selected" : ""}>Inactivos</option></select><select class="px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-terracota/20 transition-all duration-200"><option value=""${ssrIncludeBooleanAttr(Array.isArray(unref(filtroTerapeuta)) ? ssrLooseContain(unref(filtroTerapeuta), "") : ssrLooseEqual(unref(filtroTerapeuta), "")) ? " selected" : ""}>Todos los terapeutas</option><!--[-->`);
      ssrRenderList(unref(terapeutas), (terapeuta) => {
        _push(`<option${ssrRenderAttr("value", terapeuta.id)}${ssrIncludeBooleanAttr(Array.isArray(unref(filtroTerapeuta)) ? ssrLooseContain(unref(filtroTerapeuta), terapeuta.id) : ssrLooseEqual(unref(filtroTerapeuta), terapeuta.id)) ? " selected" : ""}>${ssrInterpolate(terapeuta.nombre)}</option>`);
      });
      _push(`<!--]--></select>`);
      if (unref(busqueda) || unref(filtroEstado) || unref(filtroTerapeuta)) {
        _push(`<button class="px-3 py-2 text-sm text-gray-600 hover:text-cafe transition-colors"> Limpiar filtros </button>`);
      } else {
        _push(`<!---->`);
      }
      _push(`</div></div><div class="grid grid-cols-2 md:grid-cols-4 gap-4"><div class="bg-white rounded-xl p-5 border border-gray-100 shadow-sm hover:shadow-md transition-all"><div class="flex items-center gap-3"><div class="p-3 bg-terracota/10 rounded-lg"><svg class="w-6 h-6 text-terracota" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg></div><div><div class="text-2xl font-bold text-cafe">${ssrInterpolate(unref(totalPacientes))}</div><div class="text-xs text-gray-600">Total pacientes</div></div></div></div><div class="bg-white rounded-xl p-5 border border-gray-100 shadow-sm hover:shadow-md transition-all"><div class="flex items-center gap-3"><div class="p-3 bg-green-100 rounded-lg"><svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div><div><div class="text-2xl font-bold text-green-700">${ssrInterpolate(unref(pacientesActivos))}</div><div class="text-xs text-green-600/80">Activos</div></div></div></div><div class="bg-white rounded-xl p-5 border border-gray-100 shadow-sm hover:shadow-md transition-all"><div class="flex items-center gap-3"><div class="p-3 bg-purple-100 rounded-lg"><svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path></svg></div><div><div class="text-2xl font-bold text-purple-700">${ssrInterpolate(unref(bonosActivos))}</div><div class="text-xs text-purple-600/80">Bonos activos</div></div></div></div><div class="bg-white rounded-xl p-5 border border-gray-100 shadow-sm hover:shadow-md transition-all"><div class="flex items-center gap-3"><div class="p-3 bg-orange-100 rounded-lg"><svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg></div><div><div class="text-2xl font-bold text-orange-600">${ssrInterpolate(unref(bonosPorAgotar))}</div><div class="text-xs text-orange-600/80">Bonos por agotar</div></div></div></div></div>`);
      if (unref(cargando)) {
        _push(`<div class="bg-white rounded-xl shadow-sm border border-gray-100 p-12"><div class="text-center text-gray-400 animate-pulse"><svg class="w-12 h-12 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><p>Cargando pacientes...</p></div></div>`);
      } else if (unref(pacientesFiltrados).length === 0) {
        _push(`<div class="bg-white rounded-xl shadow-sm border border-gray-100 p-12"><div class="text-center text-gray-400"><svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg><h3 class="text-xl font-semibold text-cafe mb-2"> No se encontraron pacientes </h3><p class="text-gray-600 mb-4">${ssrInterpolate(unref(busqueda) ? "Intenta con otros términos de búsqueda" : "Comienza agregando tu primer paciente")}</p></div></div>`);
      } else {
        _push(`<div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"><div class="overflow-x-auto"><table class="w-full"><thead class="bg-gray-50 border-b border-gray-200"><tr><th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"> Paciente </th><th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"> Contacto </th><th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"> Terapeuta </th><th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"> Estado Bono </th><th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"> Sesiones </th><th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"> Estado </th><th class="px-6 py-4 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider"> Acciones </th></tr></thead><tbody class="divide-y divide-gray-100"><!--[-->`);
        ssrRenderList(unref(pacientesFiltrados), (paciente) => {
          _push(`<tr class="hover:bg-gray-50 transition-colors cursor-pointer"><td class="px-6 py-4"><div class="flex items-center gap-3"><div class="w-10 h-10 rounded-full bg-gradient-to-br from-terracota to-cafe flex items-center justify-center flex-shrink-0"><span class="text-white text-sm font-semibold">${ssrInterpolate(obtenerIniciales(paciente.nombre_completo))}</span></div><div class="min-w-0"><p class="font-medium text-cafe truncate">${ssrInterpolate(paciente.nombre_completo)}</p><p class="text-sm text-gray-500 truncate">${ssrInterpolate(paciente.area_de_acompanamiento || "Sin área")}</p></div></div></td><td class="px-6 py-4"><div class="space-y-1"><p class="text-sm text-gray-700 flex items-center gap-2"><svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg><span class="truncate">${ssrInterpolate(paciente.email)}</span></p>`);
          if (paciente.telefono) {
            _push(`<p class="text-sm text-gray-700 flex items-center gap-2"><svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path></svg> ${ssrInterpolate(paciente.telefono)}</p>`);
          } else {
            _push(`<!---->`);
          }
          _push(`</div></td><td class="px-6 py-4">`);
          if (paciente.terapeuta_nombre) {
            _push(`<span class="text-sm text-gray-700">${ssrInterpolate(paciente.terapeuta_nombre)}</span>`);
          } else {
            _push(`<span class="text-sm text-gray-400 italic">Sin asignar</span>`);
          }
          _push(`</td><td class="px-6 py-4">`);
          if (paciente.bono_activo) {
            _push(`<div class="space-y-2"><div class="flex items-center gap-2"><span class="${ssrRenderClass([{
              "text-red-600": paciente.bono_activo.sesiones_restantes === 0,
              "text-orange-600": paciente.bono_activo.sesiones_restantes === 1,
              "text-amber-600": paciente.bono_activo.sesiones_restantes === 2,
              "text-verde": paciente.bono_activo.sesiones_restantes > 2
            }, "text-sm font-semibold"])}">${ssrInterpolate(paciente.bono_activo.sesiones_restantes)}/${ssrInterpolate(paciente.bono_activo.sesiones_totales)}</span></div><div class="w-24 h-1.5 bg-gray-200 rounded-full overflow-hidden"><div class="${ssrRenderClass([{
              "bg-red-500": paciente.bono_activo.sesiones_restantes === 0,
              "bg-orange-500": paciente.bono_activo.sesiones_restantes === 1,
              "bg-amber-500": paciente.bono_activo.sesiones_restantes === 2,
              "bg-verde": paciente.bono_activo.sesiones_restantes > 2
            }, "h-full transition-all duration-300 rounded-full"])}" style="${ssrRenderStyle({ width: `${paciente.bono_activo.sesiones_restantes / paciente.bono_activo.sesiones_totales * 100}%` })}"></div></div>`);
            if (paciente.bono_activo.sesiones_restantes <= 1) {
              _push(`<div class="flex items-center gap-1 text-xs font-medium text-orange-600"><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg> ${ssrInterpolate(paciente.bono_activo.sesiones_restantes === 0 ? "Agotado" : "Renovar")}</div>`);
            } else {
              _push(`<!---->`);
            }
            _push(`</div>`);
          } else {
            _push(`<span class="text-sm text-gray-400 italic">Sin bono</span>`);
          }
          _push(`</td><td class="px-6 py-4"><div class="text-sm"><p class="font-medium text-cafe">${ssrInterpolate(paciente.total_citas || 0)}</p><p class="text-xs text-gray-500">${ssrInterpolate(paciente.sesiones_completadas || 0)} completadas</p></div></td><td class="px-6 py-4"><span class="${ssrRenderClass([getEstadoClasses(paciente.estado), "inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium"])}">${ssrInterpolate(getEstadoLabel(paciente.estado))}</span></td><td class="px-6 py-4"><div class="flex items-center justify-end gap-2"><button class="p-2 text-green-600 hover:bg-green-50 rounded-lg transition-all" title="WhatsApp"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.890-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"></path></svg></button><button class="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-all" title="Ver detalles"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg></button><button class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-all" title="Eliminar paciente"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button></div></td></tr>`);
        });
        _push(`<!--]--></tbody></table></div></div>`);
      }
      if (unref(mostrarModalDetalle) && unref(pacienteSeleccionado)) {
        _push(`<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"><div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col"><div class="bg-white border-b border-gray-200 px-6 py-5 flex items-center justify-between"><div class="flex items-center gap-4"><div class="w-14 h-14 rounded-full bg-gradient-to-br from-terracota to-cafe flex items-center justify-center text-white font-bold text-xl flex-shrink-0">${ssrInterpolate(obtenerIniciales(unref(pacienteSeleccionado).nombre_completo))}</div><div><h2 class="text-2xl font-serif font-bold text-cafe">${ssrInterpolate(unref(pacienteSeleccionado).nombre_completo)}</h2><p class="text-gray-600 text-sm">${ssrInterpolate(unref(modoEdicion) ? "Editando información del paciente" : "Información del paciente")}</p></div></div><div class="flex items-center gap-2">`);
        if (!unref(modoEdicion)) {
          _push(`<button class="p-2 hover:bg-gray-100 rounded-lg transition-colors text-gray-500 hover:text-terracota" title="Editar paciente"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg></button>`);
        } else {
          _push(`<!---->`);
        }
        _push(`<button class="p-2 hover:bg-gray-100 rounded-lg transition-colors text-gray-500 hover:text-gray-700"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div></div><div class="flex-1 overflow-y-auto p-6 space-y-6">`);
        if (unref(modoEdicion)) {
          _push(`<div class="space-y-6"><div class="flex items-start gap-3 p-4 bg-blue-50 border border-blue-200 rounded-lg"><svg class="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><div class="flex-1"><p class="text-sm font-semibold text-blue-800">Modo de edición activado</p><p class="text-xs text-blue-700 mt-0.5">Modifica los campos necesarios y guarda los cambios</p></div></div><div><h3 class="text-base font-semibold text-cafe mb-4 flex items-center gap-2 border-b border-gray-200 pb-2"><svg class="w-5 h-5 text-terracota" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg> Información Personal </h3><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label class="block text-xs text-gray-700 mb-2 font-medium uppercase tracking-wide"> Nombre Completo <span class="text-red-500">*</span></label><input${ssrRenderAttr("value", unref(datosEdicion).nombre_completo)} type="text" required class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-terracota/20 focus:border-terracota transition-all" placeholder="Nombre completo del paciente"></div><div><label class="block text-xs text-gray-700 mb-2 font-medium uppercase tracking-wide"> Email <span class="text-red-500">*</span></label><input${ssrRenderAttr("value", unref(datosEdicion).email)} type="email" required class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-terracota/20 focus:border-terracota transition-all" placeholder="correo@ejemplo.com"></div><div><label class="block text-xs text-gray-700 mb-2 font-medium uppercase tracking-wide"> Teléfono </label><input${ssrRenderAttr("value", unref(datosEdicion).telefono)} type="tel" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-terracota/20 focus:border-terracota transition-all" placeholder="+34 600 000 000"></div><div><label class="block text-xs text-gray-700 mb-2 font-medium uppercase tracking-wide"> Terapeuta Asignado </label><select class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-terracota/20 focus:border-terracota transition-all"><option${ssrRenderAttr("value", null)}${ssrIncludeBooleanAttr(Array.isArray(unref(datosEdicion).terapeuta_id) ? ssrLooseContain(unref(datosEdicion).terapeuta_id, null) : ssrLooseEqual(unref(datosEdicion).terapeuta_id, null)) ? " selected" : ""}>Sin asignar</option><!--[-->`);
          ssrRenderList(unref(terapeutas), (terapeuta) => {
            _push(`<option${ssrRenderAttr("value", terapeuta.id)}${ssrIncludeBooleanAttr(Array.isArray(unref(datosEdicion).terapeuta_id) ? ssrLooseContain(unref(datosEdicion).terapeuta_id, terapeuta.id) : ssrLooseEqual(unref(datosEdicion).terapeuta_id, terapeuta.id)) ? " selected" : ""}>${ssrInterpolate(terapeuta.nombre)}</option>`);
          });
          _push(`<!--]--></select></div><div><label class="block text-xs text-gray-700 mb-2 font-medium uppercase tracking-wide"> Área de Acompañamiento </label><input${ssrRenderAttr("value", unref(datosEdicion).area_de_acompanamiento)} type="text" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-terracota/20 focus:border-terracota transition-all" placeholder="Ej: Ansiedad, Depresión, etc."></div><div><label class="block text-xs text-gray-700 mb-2 font-medium uppercase tracking-wide"> Frecuencia </label><select class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-terracota/20 focus:border-terracota transition-all"><option value=""${ssrIncludeBooleanAttr(Array.isArray(unref(datosEdicion).frecuencia) ? ssrLooseContain(unref(datosEdicion).frecuencia, "") : ssrLooseEqual(unref(datosEdicion).frecuencia, "")) ? " selected" : ""}>Seleccionar...</option><option value="semanal"${ssrIncludeBooleanAttr(Array.isArray(unref(datosEdicion).frecuencia) ? ssrLooseContain(unref(datosEdicion).frecuencia, "semanal") : ssrLooseEqual(unref(datosEdicion).frecuencia, "semanal")) ? " selected" : ""}>Semanal</option><option value="quincenal"${ssrIncludeBooleanAttr(Array.isArray(unref(datosEdicion).frecuencia) ? ssrLooseContain(unref(datosEdicion).frecuencia, "quincenal") : ssrLooseEqual(unref(datosEdicion).frecuencia, "quincenal")) ? " selected" : ""}>Quincenal</option><option value="mensual"${ssrIncludeBooleanAttr(Array.isArray(unref(datosEdicion).frecuencia) ? ssrLooseContain(unref(datosEdicion).frecuencia, "mensual") : ssrLooseEqual(unref(datosEdicion).frecuencia, "mensual")) ? " selected" : ""}>Mensual</option><option value="ocasional"${ssrIncludeBooleanAttr(Array.isArray(unref(datosEdicion).frecuencia) ? ssrLooseContain(unref(datosEdicion).frecuencia, "ocasional") : ssrLooseEqual(unref(datosEdicion).frecuencia, "ocasional")) ? " selected" : ""}>Ocasional</option></select></div></div></div><div><h3 class="text-base font-semibold text-cafe mb-4 flex items-center gap-2 border-b border-gray-200 pb-2"><svg class="w-5 h-5 text-terracota" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> Estado del Paciente </h3><div class="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200"><input${ssrIncludeBooleanAttr(Array.isArray(unref(datosEdicion).activo) ? ssrLooseContain(unref(datosEdicion).activo, null) : unref(datosEdicion).activo) ? " checked" : ""} type="checkbox" id="activo-edicion" class="w-5 h-5 text-terracota border-gray-300 rounded focus:ring-2 focus:ring-terracota"><label for="activo-edicion" class="text-sm font-medium text-cafe cursor-pointer"> Paciente activo </label><span class="text-xs text-gray-500 ml-auto">${ssrInterpolate(unref(datosEdicion).activo ? "El paciente está activo" : "El paciente está inactivo")}</span></div></div><div class="flex items-center justify-end gap-3 pt-4 border-t border-gray-200"><button${ssrIncludeBooleanAttr(unref(guardandoEdicion)) ? " disabled" : ""} class="px-6 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors font-medium disabled:opacity-50"> Cancelar </button><button${ssrIncludeBooleanAttr(unref(guardandoEdicion)) ? " disabled" : ""} class="px-6 py-2.5 bg-terracota text-white rounded-lg hover:bg-terracota/90 transition-colors font-medium flex items-center gap-2 shadow-sm disabled:opacity-50">`);
          if (unref(guardandoEdicion)) {
            _push(`<svg class="animate-spin w-4 h-4" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>`);
          } else {
            _push(`<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>`);
          }
          _push(`<span>${ssrInterpolate(unref(guardandoEdicion) ? "Guardando..." : "Guardar Cambios")}</span></button></div></div>`);
        } else {
          _push(`<div><div class="flex flex-wrap items-center justify-between gap-4 pb-6 border-b border-gray-200"><div class="flex flex-wrap items-center gap-3"><span class="${ssrRenderClass([getEstadoClasses(unref(pacienteSeleccionado).estado), "inline-flex items-center px-3 py-1.5 rounded-full text-sm font-medium"])}"><svg class="w-3 h-3 mr-1.5" fill="currentColor" viewBox="0 0 20 20"><circle cx="10" cy="10" r="6"></circle></svg> ${ssrInterpolate(getEstadoLabel(unref(pacienteSeleccionado).estado))}</span>`);
          if (unref(pacienteSeleccionado).bono_activo) {
            _push(`<span class="inline-flex items-center px-3 py-1.5 rounded-full text-sm font-medium bg-purple-100 text-purple-700"><svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"></path></svg> Bono: ${ssrInterpolate(unref(pacienteSeleccionado).bono_activo.sesiones_restantes)}/${ssrInterpolate(unref(pacienteSeleccionado).bono_activo.sesiones_totales)}</span>`);
          } else {
            _push(`<!---->`);
          }
          _push(`</div><div class="flex gap-2">`);
          if (unref(pacienteSeleccionado).telefono) {
            _push(`<button class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm flex items-center gap-2 shadow-sm"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.890-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"></path></svg><span>WhatsApp</span></button>`);
          } else {
            _push(`<!---->`);
          }
          _push(`<button class="px-4 py-2 bg-terracota text-white rounded-lg hover:bg-terracota/90 transition-colors text-sm flex items-center gap-2 shadow-sm"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg><span>Historial Completo</span></button></div></div><div><h3 class="text-base font-semibold text-cafe mb-4 flex items-center gap-2 border-b border-gray-200 pb-2"><svg class="w-5 h-5 text-terracota" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg> Información Personal </h3><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div class="p-4 bg-gray-50 rounded-lg border border-gray-100"><p class="text-xs text-gray-500 mb-1.5 font-medium uppercase tracking-wide">Nombre Completo</p><p class="text-sm text-cafe font-semibold">${ssrInterpolate(unref(pacienteSeleccionado).nombre_completo || "No especificado")}</p></div><div class="p-4 bg-gray-50 rounded-lg border border-gray-100"><p class="text-xs text-gray-500 mb-1.5 font-medium uppercase tracking-wide">Email</p><p class="text-sm text-cafe break-all">${ssrInterpolate(unref(pacienteSeleccionado).email || "No especificado")}</p></div><div class="p-4 bg-gray-50 rounded-lg border border-gray-100"><p class="text-xs text-gray-500 mb-1.5 font-medium uppercase tracking-wide">Teléfono</p><p class="text-sm text-cafe">${ssrInterpolate(unref(pacienteSeleccionado).telefono || "No especificado")}</p></div><div class="p-4 bg-gray-50 rounded-lg border border-gray-100"><p class="text-xs text-gray-500 mb-1.5 font-medium uppercase tracking-wide">Terapeuta Asignado</p><p class="text-sm text-cafe font-semibold">${ssrInterpolate(unref(pacienteSeleccionado).terapeuta_nombre || "Sin asignar")}</p></div><div class="p-4 bg-gray-50 rounded-lg border border-gray-100"><p class="text-xs text-gray-500 mb-1.5 font-medium uppercase tracking-wide">Área de Acompañamiento</p><p class="text-sm text-cafe">${ssrInterpolate(unref(pacienteSeleccionado).area_de_acompanamiento || "No especificado")}</p></div><div class="p-4 bg-gray-50 rounded-lg border border-gray-100"><p class="text-xs text-gray-500 mb-1.5 font-medium uppercase tracking-wide">Frecuencia</p><p class="text-sm text-cafe capitalize">${ssrInterpolate(unref(pacienteSeleccionado).frecuencia || "No especificada")}</p></div></div></div><div><h3 class="text-base font-semibold text-cafe mb-4 flex items-center gap-2 border-b border-gray-200 pb-2"><svg class="w-5 h-5 text-terracota" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg> Estadísticas de Sesiones </h3><div class="grid grid-cols-2 md:grid-cols-4 gap-4"><div class="p-5 bg-gradient-to-br from-blue-50 to-blue-100/50 rounded-lg border border-blue-200 text-center"><p class="text-3xl font-bold text-blue-700">${ssrInterpolate(unref(pacienteSeleccionado).total_citas || 0)}</p><p class="text-xs text-blue-600 mt-1.5 font-medium">Total Citas</p></div><div class="p-5 bg-gradient-to-br from-green-50 to-green-100/50 rounded-lg border border-green-200 text-center"><p class="text-3xl font-bold text-green-700">${ssrInterpolate(unref(pacienteSeleccionado).sesiones_completadas || 0)}</p><p class="text-xs text-green-600 mt-1.5 font-medium">Completadas</p></div><div class="p-5 bg-gradient-to-br from-purple-50 to-purple-100/50 rounded-lg border border-purple-200 text-center"><p class="text-3xl font-bold text-purple-700">${ssrInterpolate(unref(pacienteSeleccionado).bono_activo ? unref(pacienteSeleccionado).bono_activo.sesiones_restantes : 0)}</p><p class="text-xs text-purple-600 mt-1.5 font-medium">Restantes</p></div><div class="p-5 bg-gradient-to-br from-orange-50 to-orange-100/50 rounded-lg border border-orange-200 text-center"><p class="text-3xl font-bold text-orange-700">${ssrInterpolate(unref(pacienteSeleccionado).bono_activo ? unref(pacienteSeleccionado).bono_activo.sesiones_totales : 0)}</p><p class="text-xs text-orange-600 mt-1.5 font-medium">Total Bono</p></div></div></div>`);
          if (unref(pacienteSeleccionado).bono_activo) {
            _push(`<div><h3 class="text-base font-semibold text-cafe mb-4 flex items-center gap-2 border-b border-gray-200 pb-2"><svg class="w-5 h-5 text-terracota" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"></path></svg> Bono Activo </h3><div class="p-6 bg-gradient-to-br from-gray-50 to-white rounded-lg border border-gray-200"><div class="flex items-center justify-between mb-5"><div><p class="text-xs text-gray-500 mb-1.5 font-medium uppercase tracking-wide">Progreso del Bono</p><p class="text-2xl font-bold text-cafe">${ssrInterpolate(unref(pacienteSeleccionado).bono_activo.sesiones_restantes)} / ${ssrInterpolate(unref(pacienteSeleccionado).bono_activo.sesiones_totales)}</p><p class="text-sm text-gray-600 mt-0.5">sesiones disponibles</p></div><div class="text-right"><p class="text-xs text-gray-500 mb-1.5 font-medium uppercase tracking-wide">Consumido</p><p class="text-3xl font-bold text-terracota">${ssrInterpolate(Math.round((unref(pacienteSeleccionado).bono_activo.sesiones_totales - unref(pacienteSeleccionado).bono_activo.sesiones_restantes) / unref(pacienteSeleccionado).bono_activo.sesiones_totales * 100))}% </p></div></div><div class="mb-5"><div class="flex justify-between text-xs text-gray-600 mb-2"><span class="font-medium">${ssrInterpolate(unref(pacienteSeleccionado).bono_activo.sesiones_totales - unref(pacienteSeleccionado).bono_activo.sesiones_restantes)} usadas</span><span class="font-medium">${ssrInterpolate(unref(pacienteSeleccionado).bono_activo.sesiones_restantes)} restantes</span></div><div class="w-full h-3 bg-gray-200 rounded-full overflow-hidden"><div class="${ssrRenderClass([{
              "bg-red-500": unref(pacienteSeleccionado).bono_activo.sesiones_restantes === 0,
              "bg-orange-500": unref(pacienteSeleccionado).bono_activo.sesiones_restantes === 1,
              "bg-amber-500": unref(pacienteSeleccionado).bono_activo.sesiones_restantes === 2,
              "bg-verde": unref(pacienteSeleccionado).bono_activo.sesiones_restantes > 2
            }, "h-full transition-all duration-500 rounded-full"])}" style="${ssrRenderStyle({ width: `${(unref(pacienteSeleccionado).bono_activo.sesiones_totales - unref(pacienteSeleccionado).bono_activo.sesiones_restantes) / unref(pacienteSeleccionado).bono_activo.sesiones_totales * 100}%` })}"></div></div></div>`);
            if (unref(pacienteSeleccionado).bono_activo.sesiones_restantes <= 1) {
              _push(`<div class="flex items-start gap-3 p-4 bg-orange-50 border border-orange-200 rounded-lg mb-5"><svg class="w-5 h-5 text-orange-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg><div class="flex-1"><p class="text-sm font-semibold text-orange-800">${ssrInterpolate(unref(pacienteSeleccionado).bono_activo.sesiones_restantes === 0 ? "Bono agotado" : "Solo queda 1 sesión")}</p><p class="text-xs text-orange-700 mt-0.5">Se recomienda renovar el bono para continuar las sesiones</p></div></div>`);
            } else {
              _push(`<!---->`);
            }
            _push(`<div class="grid grid-cols-2 gap-4 pt-5 border-t border-gray-200"><div><p class="text-xs text-gray-500 mb-1.5 font-medium uppercase tracking-wide">Fecha de Compra</p><p class="text-sm font-semibold text-cafe">${ssrInterpolate(formatearFechaCorta(unref(pacienteSeleccionado).bono_activo.created_at))}</p></div><div><p class="text-xs text-gray-500 mb-1.5 font-medium uppercase tracking-wide">Estado</p><span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-green-100 text-green-700 capitalize">${ssrInterpolate(unref(pacienteSeleccionado).bono_activo.estado)}</span></div></div></div></div>`);
          } else {
            _push(`<div><div class="p-8 bg-gray-50 rounded-lg border-2 border-dashed border-gray-200 text-center"><svg class="w-16 h-16 mx-auto text-gray-300 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"></path></svg><p class="text-gray-600 font-medium mb-1">Sin bono activo</p><p class="text-sm text-gray-500">El paciente no tiene un bono de sesiones activo</p></div></div>`);
          }
          if (unref(pacienteSeleccionado).metadata) {
            _push(`<div><h3 class="text-base font-semibold text-cafe mb-4 flex items-center gap-2 border-b border-gray-200 pb-2"><svg class="w-5 h-5 text-terracota" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg> Información Adicional </h3><div class="p-4 bg-gray-50 rounded-lg border border-gray-100"><pre class="text-xs text-gray-700 whitespace-pre-wrap overflow-x-auto font-mono">${ssrInterpolate(JSON.stringify(unref(pacienteSeleccionado).metadata, null, 2))}</pre></div></div>`);
          } else {
            _push(`<!---->`);
          }
          _push(`<div><h3 class="text-base font-semibold text-cafe mb-4 flex items-center gap-2 border-b border-gray-200 pb-2"><svg class="w-5 h-5 text-terracota" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg> Fechas del Sistema </h3><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div class="p-4 bg-gray-50 rounded-lg border border-gray-100"><p class="text-xs text-gray-500 mb-1.5 font-medium uppercase tracking-wide">Fecha de Registro</p><p class="text-sm text-cafe font-semibold">${ssrInterpolate(formatearFechaCorta(unref(pacienteSeleccionado).created_at))}</p></div>`);
          if (unref(pacienteSeleccionado).updated_at) {
            _push(`<div class="p-4 bg-gray-50 rounded-lg border border-gray-100"><p class="text-xs text-gray-500 mb-1.5 font-medium uppercase tracking-wide">Última Actualización</p><p class="text-sm text-cafe font-semibold">${ssrInterpolate(formatearFechaCorta(unref(pacienteSeleccionado).updated_at))}</p></div>`);
          } else {
            _push(`<!---->`);
          }
          _push(`</div></div><div class="p-4 bg-blue-50/50 border border-blue-100 rounded-lg"><div class="flex items-center gap-2"><svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14"></path></svg><p class="text-xs text-blue-700 font-medium uppercase tracking-wide">ID del Paciente</p></div><code class="mt-2 block px-3 py-2 bg-white border border-blue-200 rounded text-xs text-blue-800 font-mono break-all">${ssrInterpolate(unref(pacienteSeleccionado).id)}</code></div></div>`);
        }
        _push(`</div><div class="bg-white border-t border-gray-200 px-6 py-4 flex items-center justify-between gap-3"><button class="px-6 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors font-medium"> Cerrar </button>`);
        if (!unref(modoEdicion)) {
          _push(`<button class="px-6 py-2.5 bg-terracota text-white rounded-lg hover:bg-terracota/90 transition-colors font-medium flex items-center gap-2 shadow-sm"><span>Ver Historial Completo</span><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></button>`);
        } else {
          _push(`<!---->`);
        }
        _push(`</div></div></div>`);
      } else {
        _push(`<!---->`);
      }
      if (unref(mostrarModalNuevoPaciente)) {
        _push(`<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"><div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"><div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between"><h2 class="text-xl font-serif font-bold text-cafe">Crear Nuevo Paciente</h2><button class="p-2 hover:bg-gray-100 rounded-lg transition-colors"><svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div><form class="p-6 space-y-6"><div class="space-y-4"><h3 class="text-sm font-semibold text-cafe uppercase tracking-wide">Información Personal</h3><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label class="block text-sm font-medium text-cafe mb-1"> Nombre Completo <span class="text-red-500">*</span></label><input${ssrRenderAttr("value", unref(nuevoPaciente).nombre_completo)} type="text" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-terracota/20 focus:border-terracota transition-all" placeholder="Ej: Juan Pérez García"></div><div><label class="block text-sm font-medium text-cafe mb-1"> Email <span class="text-red-500">*</span></label><input${ssrRenderAttr("value", unref(nuevoPaciente).email)} type="email" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-terracota/20 focus:border-terracota transition-all" placeholder="correo@ejemplo.com"></div><div><label class="block text-sm font-medium text-cafe mb-1"> Teléfono <span class="text-red-500">*</span></label><input${ssrRenderAttr("value", unref(nuevoPaciente).telefono)} type="tel" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-terracota/20 focus:border-terracota transition-all" placeholder="+34 612 345 678"></div></div></div><div class="space-y-4"><h3 class="text-sm font-semibold text-cafe uppercase tracking-wide">Asignación</h3><div><label class="block text-sm font-medium text-cafe mb-1"> Terapeuta Asignado </label><select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-terracota/20 focus:border-terracota transition-all"><option${ssrRenderAttr("value", null)}${ssrIncludeBooleanAttr(Array.isArray(unref(nuevoPaciente).terapeuta_id) ? ssrLooseContain(unref(nuevoPaciente).terapeuta_id, null) : ssrLooseEqual(unref(nuevoPaciente).terapeuta_id, null)) ? " selected" : ""}>Sin asignar</option><!--[-->`);
        ssrRenderList(unref(terapeutas), (terapeuta) => {
          _push(`<option${ssrRenderAttr("value", terapeuta.id)}${ssrIncludeBooleanAttr(Array.isArray(unref(nuevoPaciente).terapeuta_id) ? ssrLooseContain(unref(nuevoPaciente).terapeuta_id, terapeuta.id) : ssrLooseEqual(unref(nuevoPaciente).terapeuta_id, terapeuta.id)) ? " selected" : ""}>${ssrInterpolate(terapeuta.nombre)}</option>`);
        });
        _push(`<!--]--></select></div></div><div class="space-y-4 bg-amber-50 border border-amber-200 rounded-lg p-4"><div class="flex items-start gap-2"><svg class="w-5 h-5 text-amber-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><div class="flex-1"><h3 class="text-sm font-semibold text-amber-800 uppercase tracking-wide">Migración de Datos (Opcional)</h3><p class="text-xs text-amber-700 mt-1">Si el paciente viene con un bono existente, completa esta información</p></div><input${ssrIncludeBooleanAttr(Array.isArray(unref(nuevoPaciente).tiene_bono_existente) ? ssrLooseContain(unref(nuevoPaciente).tiene_bono_existente, null) : unref(nuevoPaciente).tiene_bono_existente) ? " checked" : ""} type="checkbox" id="tiene_bono" class="w-4 h-4 text-terracota border-amber-300 rounded focus:ring-terracota mt-0.5"></div>`);
        if (unref(nuevoPaciente).tiene_bono_existente) {
          _push(`<div class="space-y-4 pt-2"><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label class="block text-sm font-medium text-cafe mb-1"> Tipo de Bono <span class="text-red-500">*</span></label><select required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-terracota/20 focus:border-terracota transition-all"><option value=""${ssrIncludeBooleanAttr(Array.isArray(unref(nuevoPaciente).bono.tipo) ? ssrLooseContain(unref(nuevoPaciente).bono.tipo, "") : ssrLooseEqual(unref(nuevoPaciente).bono.tipo, "")) ? " selected" : ""}>Seleccionar...</option><option value="semanal"${ssrIncludeBooleanAttr(Array.isArray(unref(nuevoPaciente).bono.tipo) ? ssrLooseContain(unref(nuevoPaciente).bono.tipo, "semanal") : ssrLooseEqual(unref(nuevoPaciente).bono.tipo, "semanal")) ? " selected" : ""}>Semanal (4 sesiones/mes)</option><option value="quincenal"${ssrIncludeBooleanAttr(Array.isArray(unref(nuevoPaciente).bono.tipo) ? ssrLooseContain(unref(nuevoPaciente).bono.tipo, "quincenal") : ssrLooseEqual(unref(nuevoPaciente).bono.tipo, "quincenal")) ? " selected" : ""}>Quincenal (2 sesiones/mes)</option><option value="mensual"${ssrIncludeBooleanAttr(Array.isArray(unref(nuevoPaciente).bono.tipo) ? ssrLooseContain(unref(nuevoPaciente).bono.tipo, "mensual") : ssrLooseEqual(unref(nuevoPaciente).bono.tipo, "mensual")) ? " selected" : ""}>Mensual (1 sesión/mes)</option></select></div><div><label class="block text-sm font-medium text-cafe mb-1"> Sesiones Totales </label><input${ssrRenderAttr("value", unref(nuevoPaciente).bono.sesiones_totales)} type="number" disabled class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100 text-gray-600 cursor-not-allowed" placeholder="Selecciona tipo de bono"><p class="text-xs text-gray-500 mt-1">Se asigna automáticamente</p></div><div><label class="block text-sm font-medium text-cafe mb-1"> Sesiones ya Consumidas <span class="text-red-500">*</span></label><input${ssrRenderAttr("value", unref(nuevoPaciente).bono.sesiones_consumidas)} type="number" min="0"${ssrRenderAttr("max", unref(nuevoPaciente).bono.sesiones_totales || 0)} required${ssrIncludeBooleanAttr(!unref(nuevoPaciente).bono.tipo) ? " disabled" : ""} class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-terracota/20 focus:border-terracota transition-all disabled:bg-gray-100 disabled:cursor-not-allowed" placeholder="Ej: 2"><p class="text-xs text-gray-500 mt-1"> Sesiones restantes: ${ssrInterpolate((unref(nuevoPaciente).bono.sesiones_totales || 0) - (unref(nuevoPaciente).bono.sesiones_consumidas || 0))}</p></div><div><label class="block text-sm font-medium text-cafe mb-1"> Fecha del Último Pago </label><input${ssrRenderAttr("value", unref(nuevoPaciente).bono.fecha_compra)} type="date" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-terracota/20 focus:border-terracota transition-all"></div><div><label class="block text-sm font-medium text-cafe mb-1"> Monto Pagado (€) </label><div class="relative"><span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">€</span><input${ssrRenderAttr("value", unref(nuevoPaciente).bono.monto_total)} type="number" min="0" step="0.01" class="w-full px-3 py-2 pl-8 border border-gray-300 rounded-lg focus:ring-2 focus:ring-terracota/20 focus:border-terracota transition-all" placeholder="0.00"></div></div><div><label class="block text-sm font-medium text-cafe mb-1"> Estado del Pago </label><select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-terracota/20 focus:border-terracota transition-all"><option value="pagado"${ssrIncludeBooleanAttr(Array.isArray(unref(nuevoPaciente).bono.estado_pago) ? ssrLooseContain(unref(nuevoPaciente).bono.estado_pago, "pagado") : ssrLooseEqual(unref(nuevoPaciente).bono.estado_pago, "pagado")) ? " selected" : ""}>Pagado</option><option value="pendiente"${ssrIncludeBooleanAttr(Array.isArray(unref(nuevoPaciente).bono.estado_pago) ? ssrLooseContain(unref(nuevoPaciente).bono.estado_pago, "pendiente") : ssrLooseEqual(unref(nuevoPaciente).bono.estado_pago, "pendiente")) ? " selected" : ""}>Pendiente</option><option value="parcial"${ssrIncludeBooleanAttr(Array.isArray(unref(nuevoPaciente).bono.estado_pago) ? ssrLooseContain(unref(nuevoPaciente).bono.estado_pago, "parcial") : ssrLooseEqual(unref(nuevoPaciente).bono.estado_pago, "parcial")) ? " selected" : ""}>Pago Parcial</option></select></div></div><div class="bg-white rounded-lg p-3 border border-amber-200"><p class="text-xs font-medium text-gray-600 mb-2">Resumen del Bono:</p><div class="flex items-center gap-3"><div class="flex-1"><div class="flex justify-between text-xs text-gray-600 mb-1"><span>${ssrInterpolate(unref(nuevoPaciente).bono.sesiones_consumidas || 0)} consumidas</span><span>${ssrInterpolate((unref(nuevoPaciente).bono.sesiones_totales || 0) - (unref(nuevoPaciente).bono.sesiones_consumidas || 0))} restantes</span></div><div class="w-full h-2 bg-gray-200 rounded-full overflow-hidden"><div class="h-full bg-terracota transition-all duration-300" style="${ssrRenderStyle({
            width: `${unref(nuevoPaciente).bono.sesiones_totales > 0 ? unref(nuevoPaciente).bono.sesiones_consumidas / unref(nuevoPaciente).bono.sesiones_totales * 100 : 0}%`
          })}"></div></div></div><div class="text-right"><p class="text-lg font-bold text-terracota">${ssrInterpolate((unref(nuevoPaciente).bono.sesiones_totales || 0) - (unref(nuevoPaciente).bono.sesiones_consumidas || 0))}</p><p class="text-xs text-gray-500">de ${ssrInterpolate(unref(nuevoPaciente).bono.sesiones_totales || 0)}</p></div></div></div></div>`);
        } else {
          _push(`<!---->`);
        }
        _push(`</div><div class="space-y-4"><h3 class="text-sm font-semibold text-cafe uppercase tracking-wide">Información Adicional</h3><div><label class="block text-sm font-medium text-cafe mb-1"> Notas </label><textarea rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-terracota/20 focus:border-terracota transition-all resize-none" placeholder="Notas adicionales sobre el paciente...">${ssrInterpolate(unref(nuevoPaciente).notas)}</textarea></div><div class="flex items-center gap-2"><input${ssrIncludeBooleanAttr(Array.isArray(unref(nuevoPaciente).activo) ? ssrLooseContain(unref(nuevoPaciente).activo, null) : unref(nuevoPaciente).activo) ? " checked" : ""} type="checkbox" id="activo" class="w-4 h-4 text-terracota border-gray-300 rounded focus:ring-terracota"><label for="activo" class="text-sm font-medium text-cafe cursor-pointer"> Paciente Activo </label></div></div><div class="flex items-center justify-end gap-3 pt-4 border-t border-gray-200"><button type="button" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"> Cancelar </button><button type="submit"${ssrIncludeBooleanAttr(unref(guardando)) ? " disabled" : ""} class="px-4 py-2 text-sm font-medium text-white bg-terracota rounded-lg hover:bg-terracota/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2">`);
        if (unref(guardando)) {
          _push(`<svg class="animate-spin w-4 h-4" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>`);
        } else {
          _push(`<!---->`);
        }
        _push(`<span>${ssrInterpolate(unref(guardando) ? "Creando..." : "Crear Paciente")}</span></button></div></form></div></div>`);
      } else {
        _push(`<!---->`);
      }
      _push(`</div>`);
    };
  }
};
const _sfc_setup = _sfc_main.setup;
_sfc_main.setup = (props, ctx) => {
  const ssrContext = useSSRContext();
  (ssrContext.modules || (ssrContext.modules = /* @__PURE__ */ new Set())).add("pages/coordinadora/pacientes.vue");
  return _sfc_setup ? _sfc_setup(props, ctx) : void 0;
};

export { _sfc_main as default };
//# sourceMappingURL=pacientes-Q2Wjet9i.mjs.map
