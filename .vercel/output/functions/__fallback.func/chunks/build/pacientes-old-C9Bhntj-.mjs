import{ref as e,computed as a,mergeProps as t,unref as s,defineComponent as o,watch as r,useSSRContext as n}from"vue";import{ssrRenderAttrs as d,ssrInterpolate as i,ssrRenderAttr as l,ssrIncludeBooleanAttr as c,ssrLooseContain as v,ssrLooseEqual as p,ssrRenderList as b,ssrRenderClass as f,ssrRenderComponent as x,ssrRenderStyle as u}from"vue/server-renderer";import{u as m}from"./useSupabaseClient-DykwVqLQ.mjs";import{_ as g}from"./_plugin-vue_export-helper-1tPrXgE0.mjs";import{a as h}from"./server.mjs";import"../nitro/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"../routes/renderer.mjs";import"unhead/server";import"devalue";import"unhead/plugins";import"unhead/utils";import"vue-router";import"@supabase/ssr";import"@vercel/analytics/nuxt";const y=o({__name:"BonosPaciente",__ssrInlineRender:!0,props:{pacienteId:{}},emits:["renovar-bono","ver-detalles","crear-bono","confirmar-pago","revertir-pago"],setup(s){const o=s,n=m(),c=e([]),v=e(!0),p=e(!1),x=a(()=>c.value.filter(e=>("activo"===e.estado||"pendiente"===e.estado)&&e.sesiones_restantes>0)),g=a(()=>c.value.filter(e=>"finalizado"===e.estado||"cancelado"===e.estado||0===e.sesiones_restantes));r(()=>o.pacienteId,()=>{o.pacienteId&&(async()=>{v.value=!0;try{const{data:e,error:a}=await n.from("bonos").select("*").eq("paciente_id",o.pacienteId).order("created_at",{ascending:!1});if(a)throw a;c.value=e||[]}catch(e){console.error("Error al cargar bonos:",e)}finally{v.value=!1}})()},{immediate:!1});const getBonoCantidadSesiones=e=>{const a=e.sesiones_totales||0;return 1===a?"Bono de 1 sesiÃ³n":a<=4?`Bono de ${a} sesiones`:a<=8?`Bono Semanal (${a} sesiones)`:`Bono Quincenal (${a} sesiones)`},calcularPorcentajeProgreso=e=>{const a=e.sesiones_totales||0,t=a-(e.sesiones_restantes||0);return 0===a?0:Math.round(t/a*100)},estaProximoAgotar=e=>{const a=e.sesiones_restantes||0;return("activo"===e.estado||"pendiente"===e.estado)&&a>0&&a<=2},getEstadoLabel=e=>"finalizado"===e.estado||"cancelado"===e.estado?"Finalizado":0===e.sesiones_restantes?"Agotado":estaProximoAgotar(e)?"Por agotar":"pendiente"===e.estado?"Pendiente":"Activo",getEstadoBadgeClasses=e=>{const a=getEstadoLabel(e);return"Activo"===a?"bg-green-100 text-green-700":"Por agotar"===a?"bg-yellow-100 text-yellow-700":"Pendiente"===a?"bg-blue-100 text-blue-700":"Agotado"===a||"Finalizado"===a?"bg-gray-100 text-gray-600":"bg-blue-100 text-blue-700"},getProgressColorClass=e=>{const a=calcularPorcentajeProgreso(e);return a>=80?"bg-gradient-to-r from-red-400 to-red-600":a>=50?"bg-gradient-to-r from-yellow-400 to-yellow-600":"bg-gradient-to-r from-green-400 to-green-600"},formatearPrecio=e=>new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR"}).format(e||0),formatearFecha=e=>e?new Date(e).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}):"Sin fecha";return(e,a,s,o)=>{a(`<div${d(t({class:"bg-gradient-to-br from-white to-cafe/5 rounded-2xl p-6 md:p-8 shadow-lg border border-cafe/10 space-y-6 transition-all duration-300"},o))} data-v-be9820b5><div class="border-b border-cafe/10 pb-5" data-v-be9820b5><div class="flex items-center gap-3 mb-2" data-v-be9820b5><div class="w-10 h-10 rounded-xl bg-gradient-to-br from-terracota/20 to-terracota/10 flex items-center justify-center" data-v-be9820b5><span class="text-xl" data-v-be9820b5>ğŸ«</span></div><h3 class="font-serif text-2xl font-bold text-cafe" data-v-be9820b5>Bonos del Paciente</h3></div><p class="text-sm text-cafe/60 ml-13" data-v-be9820b5>GestiÃ³n y seguimiento de sesiones contratadas</p></div>`),v.value?a(`<div class="text-center py-16" data-v-be9820b5><div class="relative inline-block" data-v-be9820b5><div class="w-12 h-12 border-4 border-terracota/20 border-t-terracota rounded-full animate-spin" data-v-be9820b5></div><div class="absolute inset-0 w-12 h-12 border-4 border-transparent border-b-cafe/20 rounded-full animate-spin" style="${u({"animation-duration":"1.5s","animation-direction":"reverse"})}" data-v-be9820b5></div></div><p class="mt-4 text-sm text-cafe/60 font-medium" data-v-be9820b5>Cargando informaciÃ³n de bonos...</p></div>`):x.value.length>0?(a(`<div class="space-y-4" data-v-be9820b5><div class="flex items-center justify-between mb-2" data-v-be9820b5><h4 class="text-sm font-semibold text-cafe/70 uppercase tracking-wider" data-v-be9820b5>Bonos Activos</h4><span class="px-3 py-1 bg-green-50 text-green-700 text-xs font-semibold rounded-full" data-v-be9820b5>${i(x.value.length)} ${i(1===x.value.length?"bono":"bonos")}</span></div><div class="grid grid-cols-1 gap-4" data-v-be9820b5>\x3c!--[--\x3e`),b(x.value,e=>{a(`<div class="group bg-white rounded-2xl shadow-md hover:shadow-xl transition-all duration-300 hover:-translate-y-1 border border-cafe/10 overflow-hidden" data-v-be9820b5><div class="bg-gradient-to-r from-terracota/5 via-white to-terracota/5 px-6 py-4 border-b border-cafe/5" data-v-be9820b5><div class="flex items-start justify-between gap-4" data-v-be9820b5><div class="flex-1" data-v-be9820b5><div class="flex items-center gap-3 mb-2" data-v-be9820b5><div class="w-10 h-10 rounded-xl bg-gradient-to-br from-terracota to-terracota/80 flex items-center justify-center shadow-sm" data-v-be9820b5><span class="text-white text-lg" data-v-be9820b5>ğŸŸï¸</span></div><div data-v-be9820b5><h5 class="text-base font-bold text-cafe" data-v-be9820b5>${i(getBonoCantidadSesiones(e))}</h5><p class="text-xs text-cafe/60 flex items-center gap-1.5" data-v-be9820b5><span data-v-be9820b5>ğŸ“…</span><span data-v-be9820b5>Creado ${i(formatearFecha(e.created_at))}</span></p></div></div></div><div class="flex flex-col items-end gap-2" data-v-be9820b5><span class="${f([getEstadoBadgeClasses(e),"px-3 py-1.5 rounded-full text-xs font-bold uppercase tracking-wide shadow-sm backdrop-blur-sm transition-all duration-200"])}" data-v-be9820b5>${i(getEstadoLabel(e))}</span>`),e.pagado?a(`<span class="px-3 py-1.5 rounded-full text-xs font-bold uppercase tracking-wide shadow-sm bg-gradient-to-r from-green-100 to-emerald-100 text-green-700 border border-green-200"${l("title",`Pagado el ${formatearFecha(e.fecha_pago)}`)} data-v-be9820b5> âœ“ Pagado </span>`):a('<span class="px-3 py-1.5 rounded-full text-xs font-bold uppercase tracking-wide shadow-sm bg-gradient-to-r from-yellow-100 to-orange-100 text-orange-700 border border-orange-200 animate-pulse" title="Pendiente de confirmaciÃ³n de pago" data-v-be9820b5> ğŸ’³ Sin pagar </span>'),a(`</div></div></div><div class="px-6 py-5 space-y-5" data-v-be9820b5><div class="bg-gradient-to-br from-cafe/5 to-transparent rounded-xl p-4 space-y-3 border border-cafe/5" data-v-be9820b5><div class="flex justify-between items-center" data-v-be9820b5><span class="text-sm text-cafe/70 flex items-center gap-2" data-v-be9820b5><span class="w-6 h-6 rounded-lg bg-cafe/10 flex items-center justify-center text-xs" data-v-be9820b5>ğŸ“Š</span> Total de sesiones </span><span class="font-bold text-cafe text-lg" data-v-be9820b5>${i(e.sesiones_totales||0)}</span></div><div class="flex justify-between items-center" data-v-be9820b5><span class="text-sm text-cafe/70 flex items-center gap-2" data-v-be9820b5><span class="w-6 h-6 rounded-lg bg-terracota/10 flex items-center justify-center text-xs" data-v-be9820b5>âœ“</span> Sesiones usadas </span><span class="font-bold text-terracota text-lg" data-v-be9820b5>${i((e.sesiones_totales||0)-(e.sesiones_restantes||0))}</span></div><div class="flex justify-between items-center" data-v-be9820b5><span class="text-sm text-cafe/70 flex items-center gap-2" data-v-be9820b5><span class="w-6 h-6 rounded-lg bg-green-100 flex items-center justify-center text-xs" data-v-be9820b5>â³</span> Sesiones restantes </span><span class="font-bold text-green-700 text-lg" data-v-be9820b5>${i(e.sesiones_restantes||0)}</span></div><div class="pt-3 border-t border-cafe/10" data-v-be9820b5><div class="flex justify-between items-center" data-v-be9820b5><span class="text-sm text-cafe/70 flex items-center gap-2" data-v-be9820b5><span class="w-6 h-6 rounded-lg bg-cafe/10 flex items-center justify-center text-xs" data-v-be9820b5>ğŸ’°</span> Precio total </span><span class="font-bold text-cafe text-lg" data-v-be9820b5>${i(formatearPrecio(e.monto_total))}</span></div><div class="flex justify-between items-center mt-2" data-v-be9820b5><span class="text-xs text-cafe/60 pl-8" data-v-be9820b5>Precio por sesiÃ³n</span><span class="text-sm text-cafe/80 font-medium" data-v-be9820b5>${i(formatearPrecio((e.monto_total||0)/(e.sesiones_totales||1)))}</span></div></div></div><div class="space-y-2" data-v-be9820b5><div class="flex justify-between items-center text-xs" data-v-be9820b5><span class="text-cafe/70 font-medium" data-v-be9820b5>Progreso de sesiones</span><span class="text-cafe font-bold" data-v-be9820b5>${i(calcularPorcentajeProgreso(e))}%</span></div><div class="relative h-3 bg-gray-100 rounded-full overflow-hidden shadow-inner" data-v-be9820b5><div class="${f([getProgressColorClass(e),"absolute inset-y-0 left-0 rounded-full transition-all duration-700 ease-out shadow-sm"])}" style="${u({width:`${calcularPorcentajeProgreso(e)}%`})}" data-v-be9820b5><div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent" data-v-be9820b5></div></div></div></div><div class="space-y-3" data-v-be9820b5>`),estaProximoAgotar(e)?a(`<div class="bg-gradient-to-r from-yellow-50 to-orange-50 border-l-4 border-yellow-500 rounded-r-xl p-4 flex items-start gap-3 shadow-sm" data-v-be9820b5><div class="w-8 h-8 rounded-lg bg-yellow-500 flex items-center justify-center flex-shrink-0 shadow-sm" data-v-be9820b5><span class="text-white text-lg" data-v-be9820b5>âš ï¸</span></div><div class="flex-1" data-v-be9820b5><p class="text-sm font-bold text-yellow-900 mb-1" data-v-be9820b5>Bono prÃ³ximo a agotar</p><p class="text-xs text-yellow-800" data-v-be9820b5> Quedan <span class="font-bold" data-v-be9820b5>${i((e=>e.sesiones_restantes||0)(e))}</span> sesiones disponibles </p></div></div>`):a("\x3c!----\x3e"),e.pagado||"activo"!==e.estado&&"pendiente"!==e.estado?a("\x3c!----\x3e"):a('<div class="bg-gradient-to-r from-orange-50 to-red-50 border-l-4 border-orange-500 rounded-r-xl p-4 flex items-start gap-3 shadow-sm" data-v-be9820b5><div class="w-8 h-8 rounded-lg bg-orange-500 flex items-center justify-center flex-shrink-0 shadow-sm" data-v-be9820b5><span class="text-white text-lg" data-v-be9820b5>ğŸ’³</span></div><div class="flex-1" data-v-be9820b5><p class="text-sm font-bold text-orange-900 mb-1" data-v-be9820b5>Pendiente de pago</p><p class="text-xs text-orange-800" data-v-be9820b5> Este bono aÃºn no ha sido pagado. El paciente puede usar las sesiones y pagar al final, o confirma el pago ahora. </p></div></div>'),a('</div><div class="space-y-3 pt-2" data-v-be9820b5>'),e.pagado?a('<div class="grid grid-cols-2 gap-3" data-v-be9820b5><button class="group bg-gradient-to-r from-terracota to-orange-500 text-white hover:from-terracota/90 hover:to-orange-600 rounded-xl py-3 px-4 text-sm font-semibold transition-all duration-300 shadow-md hover:shadow-xl hover:-translate-y-0.5 flex items-center justify-center gap-2" data-v-be9820b5><span class="text-base group-hover:rotate-180 transition-transform duration-500" data-v-be9820b5>ğŸ”„</span><span data-v-be9820b5>Renovar</span></button><button class="group bg-gradient-to-r from-red-500 to-red-600 text-white hover:from-red-600 hover:to-red-700 rounded-xl py-3 px-4 text-sm font-semibold transition-all duration-300 shadow-md hover:shadow-xl hover:-translate-y-0.5 flex items-center justify-center gap-2" title="Desmarcar como pagado (en caso de error)" data-v-be9820b5><span class="text-base group-hover:scale-110 transition-transform duration-300" data-v-be9820b5>â†©ï¸</span><span data-v-be9820b5>Revertir pago</span></button></div>'):a('<div class="grid grid-cols-2 gap-3" data-v-be9820b5><button class="group bg-gradient-to-r from-green-600 to-emerald-600 text-white hover:from-green-700 hover:to-emerald-700 rounded-xl py-3 px-4 text-sm font-semibold transition-all duration-300 shadow-md hover:shadow-xl hover:-translate-y-0.5 flex items-center justify-center gap-2 col-span-2" data-v-be9820b5><span class="text-base group-hover:scale-110 transition-transform duration-300" data-v-be9820b5>ğŸ’³</span><span data-v-be9820b5>Confirmar pago</span></button></div>'),a('<div class="grid grid-cols-1" data-v-be9820b5><button class="group bg-cafe/10 text-cafe hover:bg-cafe/20 rounded-xl py-3 px-4 text-sm font-semibold transition-all duration-300 border border-cafe/20 hover:border-cafe/40 flex items-center justify-center gap-2" data-v-be9820b5><span class="text-base group-hover:scale-110 transition-transform duration-300" data-v-be9820b5>ğŸ‘ï¸</span><span data-v-be9820b5>Ver detalles</span></button></div></div></div></div>')}),a("\x3c!--]--\x3e</div></div>")):a('<div class="text-center bg-gradient-to-br from-white to-gray-50 rounded-2xl py-16 px-6 border-2 border-dashed border-cafe/20" data-v-be9820b5><div class="w-20 h-20 mx-auto mb-6 rounded-2xl bg-gradient-to-br from-terracota/10 to-terracota/5 flex items-center justify-center" data-v-be9820b5><span class="text-5xl" data-v-be9820b5>ğŸ«</span></div><h4 class="text-xl font-bold text-cafe mb-3" data-v-be9820b5>No hay bonos activos</h4><p class="text-sm text-cafe/60 mb-6 max-w-sm mx-auto" data-v-be9820b5> Este paciente no tiene bonos registrados en este momento. Puedes crear uno nuevo para comenzar. </p><button class="group inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-terracota to-orange-500 text-white rounded-xl hover:from-terracota/90 hover:to-orange-600 transition-all duration-300 font-semibold text-sm shadow-lg hover:shadow-xl hover:-translate-y-1" data-v-be9820b5><span class="group-hover:rotate-90 transition-transform duration-300" data-v-be9820b5>â•</span><span data-v-be9820b5>Crear Nuevo Bono</span></button></div>'),!v.value&&g.value.length>0?(a(`<div class="pt-8 border-t border-cafe/10" data-v-be9820b5><button class="group flex items-center justify-between w-full text-left bg-gradient-to-r from-cafe/5 to-transparent hover:from-cafe/10 rounded-xl px-5 py-4 transition-all duration-300" data-v-be9820b5><div class="flex items-center gap-3" data-v-be9820b5><div class="w-8 h-8 rounded-lg bg-cafe/10 flex items-center justify-center" data-v-be9820b5><span class="text-sm" data-v-be9820b5>ğŸ“¦</span></div><div data-v-be9820b5><span class="font-bold text-cafe text-sm" data-v-be9820b5>Historial de bonos finalizados</span><span class="ml-2 px-2 py-0.5 bg-gray-200 text-gray-700 rounded-full text-xs font-semibold" data-v-be9820b5>${i(g.value.length)}</span></div></div><span class="${f([{"rotate-180":p.value},"text-lg transition-transform duration-300 text-cafe/60 group-hover:text-cafe"])}" data-v-be9820b5> â–¼ </span></button><div class="mt-4 space-y-3 animate-fadeIn" style="${u(p.value?null:{display:"none"})}" data-v-be9820b5>\x3c!--[--\x3e`),b(g.value,e=>{a(`<div class="group bg-white border border-gray-200 hover:border-cafe/30 rounded-xl p-5 transition-all duration-300 hover:shadow-md" data-v-be9820b5><div class="flex items-start justify-between gap-4" data-v-be9820b5><div class="flex-1" data-v-be9820b5><div class="flex items-center gap-2 mb-2" data-v-be9820b5><div class="w-8 h-8 rounded-lg bg-gray-100 flex items-center justify-center" data-v-be9820b5><span class="text-sm" data-v-be9820b5>ğŸ</span></div><p class="text-sm font-bold text-cafe" data-v-be9820b5>${i(getBonoCantidadSesiones(e))}</p></div><p class="text-xs text-cafe/60 mb-1 flex items-center gap-1.5" data-v-be9820b5><span data-v-be9820b5>ğŸ“…</span><span data-v-be9820b5>Finalizado el ${i(formatearFecha(e.updated_at))}</span></p><div class="flex items-center gap-4 mt-3" data-v-be9820b5><div class="flex items-center gap-1.5 text-xs" data-v-be9820b5><span class="text-cafe/60" data-v-be9820b5>Sesiones:</span><span class="font-bold text-cafe" data-v-be9820b5>${i((e.sesiones_totales||0)-(e.sesiones_restantes||0))} / ${i(e.sesiones_totales||0)}</span></div><div class="flex items-center gap-1.5 text-xs" data-v-be9820b5><span class="text-cafe/60" data-v-be9820b5>Monto:</span><span class="font-bold text-cafe" data-v-be9820b5>${i(formatearPrecio(e.monto_total))}</span></div></div></div><span class="px-3 py-1.5 bg-gray-100 text-gray-600 rounded-full text-xs font-bold uppercase tracking-wide" data-v-be9820b5> Finalizado </span></div></div>`)}),a("\x3c!--]--\x3e</div></div>")):a("\x3c!----\x3e"),a("</div>")}}}),w=y.setup;y.setup=(e,a)=>{const t=n();return(t.modules||(t.modules=new Set)).add("components/BonosPaciente.vue"),w?w(e,a):void 0};const _=Object.assign(g(y,[["__scopeId","data-v-be9820b5"]]),{__name:"BonosPaciente"}),$={__name:"pacientes-old",__ssrInlineRender:!0,setup(o){const r=m();h();const n=e(!0),u=e([]),g=e([]),y=e(""),w=e(""),$=e(""),j=e("nombre"),A=e(1),P=e(!1),E=e(null);e(null);const k=e(0),C=a(()=>u.value.length),S=a(()=>u.value.filter(e=>"activo"===e.estado||e.activo).length),B=a(()=>0===g.value.length?0:Math.round(C.value/g.value.length)),D=a(()=>u.value.filter(e=>e.bono_activo&&e.bono_activo.sesiones_restantes>0).length),I=a(()=>{let e=[...u.value];if(y.value.trim()){const a=y.value.toLowerCase();e=e.filter(e=>{var t,s,o,r;return(null==(t=e.nombre_completo)?void 0:t.toLowerCase().includes(a))||(null==(s=e.email)?void 0:s.toLowerCase().includes(a))||(null==(o=e.telefono)?void 0:o.includes(a))||(null==(r=e.terapeuta_nombre)?void 0:r.toLowerCase().includes(a))})}"activo"===w.value?e=e.filter(e=>"activo"===e.estado||e.activo):"inactivo"===w.value?e=e.filter(e=>"inactivo"===e.estado||!e.activo):"pausa"===w.value&&(e=e.filter(e=>"pausa"===e.estado)),$.value&&(e=e.filter(e=>e.terapeuta_id===$.value)),"nombre"===j.value?e.sort((e,a)=>(e.nombre_completo||"").localeCompare(a.nombre_completo||"")):"fecha"===j.value?e.sort((e,a)=>{const t=e.ultima_cita?new Date(e.ultima_cita):new Date(0);return(a.ultima_cita?new Date(a.ultima_cita):new Date(0))-t}):"citas"===j.value&&e.sort((e,a)=>(a.total_citas||0)-(e.total_citas||0));const a=12*(A.value-1),t=a+12;return e.slice(a,t)}),z=a(()=>{const e=u.value.length;return Math.ceil(e/12)}),obtenerIniciales=e=>e?e.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2):"PA",formatearFecha=e=>{if(!e)return"Sin registro";return new Date(e).toLocaleDateString("es-ES",{day:"numeric",month:"short",year:"numeric"})},getEstadoClasses=e=>{const a=(null==e?void 0:e.toLowerCase())||"inactivo";return"activo"===a?"bg-green-100 text-green-700":"pausa"===a||"en pausa"===a?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-700"},getEstadoLabel=e=>{const a=(null==e?void 0:e.toLowerCase())||"inactivo";return"activo"===a?"Activo":"pausa"===a||"en pausa"===a?"En pausa":"Inactivo"},handleRenovarBono=e=>{console.log("Renovar bono:",e),alert("Funcionalidad de renovaciÃ³n de bono prÃ³ximamente disponible")},handleVerDetallesBono=e=>{console.log("Ver detalles de bono:",e),alert(`Detalles del bono: ${e.sesiones_totales} sesiones - ${e.sesiones_usadas} usadas`)},handleCrearBono=()=>{console.log("Crear nuevo bono para:",E.value),alert("Funcionalidad de creaciÃ³n de bono prÃ³ximamente disponible")},handleConfirmarPago=async e=>{var a;console.log("Confirmar pago de bono:",e);const t=prompt("MÃ©todo de pago:\n1. Transferencia\n2. Tarjeta\n3. Efectivo\n4. Bizum\n5. PayPal\n6. Otro\n\nIngrese el nÃºmero del mÃ©todo:","1");if(!t)return;const s={1:"transferencia",2:"tarjeta",3:"efectivo",4:"bizum",5:"paypal",6:"otro"}[t]||"transferencia";try{const{data:t,error:o}=await r.rpc("confirmar_pago_bono",{p_bono_id:e.id,p_metodo_pago:s});if(o)throw o;t&&t.success?(alert(`âœ… Pago confirmado correctamente\n\nMÃ©todo: ${s}\nFecha: ${(new Date).toLocaleDateString("es-ES")}`),k.value++,(null==(a=E.value)?void 0:a.id)&&await cargarDetallesPaciente(E.value)):alert(`âŒ Error: ${(null==t?void 0:t.error)||"No se pudo confirmar el pago"}`)}catch(e){console.error("Error al confirmar pago:",e),alert(`âŒ Error al confirmar el pago: ${e.message}`)}},handleRevertirPago=async e=>{var a;console.log("Revertir pago de bono:",e);if(confirm('âš ï¸ Â¿EstÃ¡s seguro de que quieres revertir el pago de este bono?\n\nEsta acciÃ³n marcarÃ¡ el bono como "NO PAGADO" y eliminarÃ¡:\n- Fecha de pago\n- MÃ©todo de pago\n- Registro de quiÃ©n confirmÃ³ el pago\n\nEsta acciÃ³n es Ãºtil si marcaste el pago por error.'))try{const{data:t,error:s}=await r.rpc("revertir_pago_bono",{p_bono_id:e.id});if(s)throw s;t&&t.success?(alert('âœ… Pago revertido correctamente\n\nEl bono ahora estÃ¡ marcado como "NO PAGADO"'),k.value++,(null==(a=E.value)?void 0:a.id)&&await cargarDetallesPaciente(E.value)):alert(`âŒ Error: ${(null==t?void 0:t.error)||"No se pudo revertir el pago"}`)}catch(e){console.error("Error al revertir pago:",e),alert(`âŒ Error al revertir el pago: ${e.message}`)}},cargarDetallesPaciente=async e=>{try{const{data:a,error:t}=await r.from("sesiones").select("id, fecha, hora_inicio, hora_fin, estado, notas_terapeuta").eq("paciente_id",e).order("fecha",{ascending:!1}).limit(5);if(t)throw t;E.value&&(E.value.ultimas_sesiones=(null==a?void 0:a.map(e=>({id:e.id,fecha_cita:e.fecha,hora_inicio:e.hora_inicio,hora_fin:e.hora_fin,estado:e.estado,notas:e.notas_terapeuta})))||[])}catch(e){console.error("Error al cargar detalles del paciente:",e)}};return(e,a,o,r)=>{var u;const m=_;a(`<div${d(t({class:"space-y-6"},r))} data-v-ef92321c><div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6" data-v-ef92321c><div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4" data-v-ef92321c><div data-v-ef92321c><h1 class="text-2xl font-serif font-bold text-cafe" data-v-ef92321c>GestiÃ³n de Pacientes</h1><p class="text-sm text-gray-600 mt-1" data-v-ef92321c>${i(s(C))} pacientes registrados â€” ${i(s(S))} activos </p></div><div class="flex flex-wrap items-center gap-3" data-v-ef92321c><div class="relative flex-1 min-w-[250px]" data-v-ef92321c><input${l("value",s(y))} type="text" placeholder="Buscar por nombre, email, terapeuta o telÃ©fono..." class="w-full px-4 py-2 pl-10 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-terracota/20 transition-all duration-200" data-v-ef92321c><span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400" data-v-ef92321c> ğŸ” </span></div><button class="px-4 py-2 bg-terracota text-white rounded-lg hover:bg-terracota/90 transition-all duration-200 text-sm font-medium whitespace-nowrap flex items-center gap-2" data-v-ef92321c><span data-v-ef92321c>â•</span><span data-v-ef92321c>Nuevo Paciente</span></button></div></div><div class="flex flex-wrap gap-3 mt-4 pt-4 border-t border-gray-100" data-v-ef92321c><select class="px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-terracota/20 transition-all duration-200" data-v-ef92321c><option value="" data-v-ef92321c${c(Array.isArray(s(w))?v(s(w),""):p(s(w),""))?" selected":""}>Todos los estados</option><option value="activo" data-v-ef92321c${c(Array.isArray(s(w))?v(s(w),"activo"):p(s(w),"activo"))?" selected":""}>âœ… Activos</option><option value="inactivo" data-v-ef92321c${c(Array.isArray(s(w))?v(s(w),"inactivo"):p(s(w),"inactivo"))?" selected":""}>â¸ï¸ Inactivos</option><option value="pausa" data-v-ef92321c${c(Array.isArray(s(w))?v(s(w),"pausa"):p(s(w),"pausa"))?" selected":""}>â¸ï¸ En pausa</option></select><select class="px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-terracota/20 transition-all duration-200" data-v-ef92321c><option value="" data-v-ef92321c${c(Array.isArray(s($))?v(s($),""):p(s($),""))?" selected":""}>Todos los terapeutas</option>\x3c!--[--\x3e`),b(s(g),e=>{a(`<option${l("value",e.id)} data-v-ef92321c${c(Array.isArray(s($))?v(s($),e.id):p(s($),e.id))?" selected":""}>${i(e.nombre)}</option>`)}),a(`\x3c!--]--\x3e</select><select class="px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-terracota/20 transition-all duration-200" data-v-ef92321c><option value="nombre" data-v-ef92321c${c(Array.isArray(s(j))?v(s(j),"nombre"):p(s(j),"nombre"))?" selected":""}>Ordenar por nombre</option><option value="fecha" data-v-ef92321c${c(Array.isArray(s(j))?v(s(j),"fecha"):p(s(j),"fecha"))?" selected":""}>Fecha Ãºltima sesiÃ³n</option><option value="citas" data-v-ef92321c${c(Array.isArray(s(j))?v(s(j),"citas"):p(s(j),"citas"))?" selected":""}>MÃ¡s citas</option></select></div></div><div class="grid grid-cols-2 md:grid-cols-4 gap-4" data-v-ef92321c><div class="bg-terracota/5 rounded-xl p-4 border border-terracota/10 transition-all duration-300 hover:shadow-md" data-v-ef92321c><div class="flex items-center gap-3" data-v-ef92321c><div class="text-3xl" data-v-ef92321c>ğŸ‘¥</div><div class="flex-1" data-v-ef92321c><div class="text-2xl font-bold text-cafe" data-v-ef92321c>${i(s(C))}</div><div class="text-sm text-cafe/60" data-v-ef92321c>Total pacientes</div></div></div></div><div class="bg-green-50 rounded-xl p-4 border border-green-100 transition-all duration-300 hover:shadow-md" data-v-ef92321c><div class="flex items-center gap-3" data-v-ef92321c><div class="text-3xl" data-v-ef92321c>ğŸŸ¢</div><div class="flex-1" data-v-ef92321c><div class="text-2xl font-bold text-green-700" data-v-ef92321c>${i(s(S))}</div><div class="text-sm text-green-600/80" data-v-ef92321c>Activos</div></div></div></div><div class="bg-blue-50 rounded-xl p-4 border border-blue-100 transition-all duration-300 hover:shadow-md" data-v-ef92321c><div class="flex items-center gap-3" data-v-ef92321c><div class="text-3xl" data-v-ef92321c>ğŸ§‘â€âš•ï¸</div><div class="flex-1" data-v-ef92321c><div class="text-2xl font-bold text-blue-700" data-v-ef92321c>${i(s(B))}</div><div class="text-sm text-blue-600/80" data-v-ef92321c>Prom. por terapeuta</div></div></div></div><div class="bg-purple-50 rounded-xl p-4 border border-purple-100 transition-all duration-300 hover:shadow-md" data-v-ef92321c><div class="flex items-center gap-3" data-v-ef92321c><div class="text-3xl" data-v-ef92321c>ğŸ’³</div><div class="flex-1" data-v-ef92321c><div class="text-2xl font-bold text-purple-700" data-v-ef92321c>${i(s(D))}</div><div class="text-sm text-purple-600/80" data-v-ef92321c>Bonos activos</div></div></div></div></div>`),s(n)?a('<div class="bg-white rounded-xl shadow-sm border border-gray-100 p-12" data-v-ef92321c><div class="text-center text-gray-400 animate-pulse" data-v-ef92321c><span class="text-4xl block mb-2" data-v-ef92321c>â³</span><p data-v-ef92321c>Cargando pacientes...</p></div></div>'):0===s(I).length?(a(`<div class="bg-white rounded-xl shadow-sm border border-gray-100 p-12" data-v-ef92321c><div class="text-center text-gray-400" data-v-ef92321c><span class="text-6xl block mb-4" data-v-ef92321c>ğŸ‘¥</span><h3 class="text-xl font-semibold text-cafe mb-2" data-v-ef92321c> No se encontraron pacientes </h3><p class="text-gray-600 mb-4" data-v-ef92321c>${i(s(y)?"Intenta con otros tÃ©rminos de bÃºsqueda":"Comienza agregando tu primer paciente")}</p>`),s(y)?a("\x3c!----\x3e"):a('<button class="inline-flex items-center px-4 py-2 bg-terracota text-white rounded-lg hover:bg-terracota/90 transition-all duration-200" data-v-ef92321c> + Crear Primer Paciente </button>'),a("</div></div>")):(a('<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" data-v-ef92321c>\x3c!--[--\x3e'),b(s(I),e=>{a(`<div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-lg transition-all duration-300 cursor-pointer transform hover:-translate-y-1" data-v-ef92321c><div class="flex items-start gap-4 mb-4" data-v-ef92321c><div class="w-16 h-16 rounded-full bg-gradient-to-br from-terracota to-cafe flex items-center justify-center flex-shrink-0 shadow-md" data-v-ef92321c><span class="text-white text-xl font-semibold" data-v-ef92321c>${i(obtenerIniciales(e.nombre_completo))}</span></div><div class="flex-1 min-w-0" data-v-ef92321c><h3 class="font-semibold text-cafe text-lg truncate" data-v-ef92321c>${i(e.nombre_completo)}</h3><p class="text-sm text-gray-600 truncate" data-v-ef92321c>${i(e.email)}</p>`),e.telefono?a(`<p class="text-sm text-gray-500 mt-1" data-v-ef92321c> ğŸ“± ${i(e.telefono)}</p>`):a("\x3c!----\x3e"),a("</div></div>"),e.terapeuta_nombre?a(`<div class="mb-3 flex items-center gap-2 text-sm bg-cafe/5 px-3 py-2 rounded-lg" data-v-ef92321c><span class="text-cafe/60" data-v-ef92321c>ğŸ§‘â€âš•ï¸</span><span class="text-cafe font-medium" data-v-ef92321c>${i(e.terapeuta_nombre)}</span></div>`):a("\x3c!----\x3e"),a('<div class="space-y-2 mb-4" data-v-ef92321c>'),e.area_de_acompanamiento?a(`<div class="flex items-center gap-2 text-sm" data-v-ef92321c><span class="text-gray-400" data-v-ef92321c>ğŸ¯</span><span class="text-gray-700 truncate" data-v-ef92321c>${i(e.area_de_acompanamiento)}</span></div>`):a("\x3c!----\x3e"),a(`<div class="flex items-center gap-2 text-sm" data-v-ef92321c><span class="text-gray-400" data-v-ef92321c>ğŸ“…</span><span class="text-gray-700" data-v-ef92321c>${i(e.total_citas||0)} sesiones</span></div>`),e.ultima_cita?a(`<div class="flex items-center gap-2 text-sm" data-v-ef92321c><span class="text-gray-400" data-v-ef92321c>ğŸ•</span><span class="text-gray-700" data-v-ef92321c>Ãšltima: ${i(formatearFecha(e.ultima_cita))}</span></div>`):a("\x3c!----\x3e"),e.proxima_cita?a(`<div class="flex items-center gap-2 text-sm" data-v-ef92321c><span class="text-gray-400" data-v-ef92321c>ğŸ“†</span><span class="text-gray-700" data-v-ef92321c>PrÃ³xima: ${i(formatearFecha(e.proxima_cita))}</span></div>`):a("\x3c!----\x3e"),a(`</div><div class="flex items-center justify-between pt-4 border-t border-gray-100" data-v-ef92321c><span class="${f([getEstadoClasses(e.estado),"px-3 py-1 rounded-full text-xs font-medium transition-all duration-200"])}" data-v-ef92321c>${i(getEstadoLabel(e.estado))}</span><div class="flex gap-2" data-v-ef92321c><button class="p-2 text-terracota hover:bg-terracota/10 rounded-lg transition-all duration-200" title="Ver agenda" data-v-ef92321c> ï¿½ </button><button class="p-2 text-green-600 hover:bg-green-50 rounded-lg transition-all duration-200" title="Abrir WhatsApp" data-v-ef92321c> ğŸ’¬ </button><button class="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-200" title="Ver detalles" data-v-ef92321c> ğŸ‘ï¸ </button></div></div></div>`)}),a("\x3c!--]--\x3e</div>")),s(I).length>0&&s(z)>1?(a('<div class="flex justify-center gap-2" data-v-ef92321c>\x3c!--[--\x3e'),b(s(z),e=>{a(`<button class="${f([s(A)===e?"bg-terracota text-white shadow-md":"bg-white border border-gray-200 text-cafe hover:bg-gray-50","px-4 py-2 rounded-lg transition-all duration-200"])}" data-v-ef92321c>${i(e)}</button>`)}),a("\x3c!--]--\x3e</div>")):a("\x3c!----\x3e"),s(P)&&s(E)?(a(`<div class="fixed right-0 top-0 h-screen w-full md:w-2/3 lg:w-1/2 bg-white rounded-l-3xl shadow-2xl shadow-black/5 z-50 overflow-y-auto scroll-smooth" role="dialog" aria-modal="true" aria-labelledby="panel-title" tabindex="0" data-v-ef92321c><div class="sticky top-0 bg-white/80 backdrop-blur-md pb-6 pt-8 px-8 md:px-10 border-b border-cafe/10 z-10" data-v-ef92321c><div class="flex items-start justify-between gap-6" data-v-ef92321c><div class="flex items-center gap-5 flex-1" data-v-ef92321c><div class="w-16 h-16 rounded-full bg-cafe text-white flex items-center justify-center text-xl font-bold shadow-sm flex-shrink-0" data-v-ef92321c>${i(obtenerIniciales(s(E).nombre_completo))}</div><div class="flex-1 min-w-0" data-v-ef92321c><h2 id="panel-title" class="font-serif text-2xl font-bold text-cafe mb-2 truncate" data-v-ef92321c>${i(s(E).nombre_completo)}</h2><div class="flex items-center gap-3 flex-wrap" data-v-ef92321c><span class="${f([getEstadoClasses(s(E).estado),"inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold"])}" data-v-ef92321c>${i(getEstadoLabel(s(E).estado))}</span>`),s(E).terapeuta_nombre?a(`<span class="text-sm text-cafe/70" data-v-ef92321c> ğŸ§‘â€âš•ï¸ ${i(s(E).terapeuta_nombre)}</span>`):a("\x3c!----\x3e"),a(`</div></div></div><button class="text-cafe/40 hover:text-cafe transition-all duration-200 text-2xl leading-none w-10 h-10 rounded-full flex items-center justify-center hover:bg-cafe/5 hover:rotate-90" aria-label="Cerrar panel" data-v-ef92321c> âœ• </button></div></div><div class="p-8 md:p-10 space-y-8" data-v-ef92321c><section class="bg-white border border-cafe/10 rounded-xl p-5 shadow-sm hover:shadow-md transition-all duration-300 hover:-translate-y-1" data-v-ef92321c><h3 class="font-serif font-semibold text-cafe text-lg mb-4 flex items-center gap-2" data-v-ef92321c><span class="text-xl" data-v-ef92321c>ğŸ“</span><span data-v-ef92321c>InformaciÃ³n de Contacto</span></h3><div class="space-y-3" data-v-ef92321c><div class="flex items-center gap-3 text-cafe/80" data-v-ef92321c><span class="w-6 text-lg" data-v-ef92321c>âœ‰ï¸</span><span class="text-sm" data-v-ef92321c>${i(s(E).email)}</span></div>`),s(E).telefono?a(`<div class="flex items-center gap-3 text-cafe/80" data-v-ef92321c><span class="w-6 text-lg" data-v-ef92321c>ğŸ“±</span><span class="text-sm" data-v-ef92321c>${i(s(E).telefono)}</span></div>`):a("\x3c!----\x3e"),a("</div></section>"),s(E).area_de_acompanamiento?a(`<section class="bg-blue-50/50 rounded-xl p-4 border border-blue-100 transition-all duration-300 hover:shadow-md" data-v-ef92321c><h3 class="font-serif font-semibold text-cafe text-lg mb-3 flex items-center gap-2" data-v-ef92321c><span class="text-xl" data-v-ef92321c>ğŸ¯</span><span data-v-ef92321c>Ãrea de AcompaÃ±amiento</span></h3><p class="text-cafe text-sm leading-relaxed" data-v-ef92321c>${i(s(E).area_de_acompanamiento)}</p></section>`):a("\x3c!----\x3e"),a(`<section class="bg-green-50/50 rounded-xl p-5 border border-green-100 transition-all duration-300 hover:shadow-md" data-v-ef92321c><h3 class="font-serif font-semibold text-cafe text-lg mb-4 flex items-center gap-2" data-v-ef92321c><span class="text-xl" data-v-ef92321c>ï¿½</span><span data-v-ef92321c>EstadÃ­sticas</span></h3><div class="space-y-4" data-v-ef92321c><div class="flex items-center justify-between" data-v-ef92321c><span class="text-sm text-cafe/70" data-v-ef92321c>Total de sesiones</span><span class="text-3xl font-bold text-cafe" data-v-ef92321c>${i(s(E).total_citas||0)}</span></div><div class="flex items-center justify-between" data-v-ef92321c><span class="text-sm text-cafe/70" data-v-ef92321c>Completadas</span><span class="text-lg font-semibold text-green-700" data-v-ef92321c>${i(s(E).sesiones_completadas||0)}</span></div>`),s(E).proxima_cita?a(`<div class="flex items-center gap-2 pt-2 border-t border-green-200" data-v-ef92321c><span class="text-lg" data-v-ef92321c>ğŸ“…</span><div data-v-ef92321c><p class="text-xs text-cafe/60 uppercase tracking-wide" data-v-ef92321c>PrÃ³xima sesiÃ³n</p><p class="text-sm font-medium text-cafe" data-v-ef92321c>${i(formatearFecha(s(E).proxima_cita))}</p></div></div>`):a("\x3c!----\x3e"),a("</div></section>"),s(E).bono_activo?a(`<section class="bg-white border border-cafe/10 rounded-xl p-5 shadow-sm hover:shadow-md transition-all duration-300 hover:-translate-y-1" data-v-ef92321c><h3 class="font-serif font-semibold text-cafe text-lg mb-4 flex items-center gap-2" data-v-ef92321c><span class="text-xl" data-v-ef92321c>ï¿½</span><span data-v-ef92321c>Bono Activo</span></h3><div class="space-y-3" data-v-ef92321c><div class="flex justify-between items-center p-4 bg-purple-50 rounded-lg" data-v-ef92321c><span class="text-sm text-cafe/70" data-v-ef92321c>Sesiones disponibles</span><span class="text-2xl font-bold text-purple-700" data-v-ef92321c>${i(s(E).bono_activo.sesiones_restantes)}</span></div><div class="flex justify-between items-center text-sm text-cafe/70" data-v-ef92321c><span data-v-ef92321c>Fecha de compra</span><span class="font-medium" data-v-ef92321c>${i(formatearFecha(s(E).bono_activo.fecha_compra))}</span></div></div></section>`):a("\x3c!----\x3e"),a('<section class="bg-white border border-cafe/10 rounded-xl p-5 shadow-sm hover:shadow-md transition-all duration-300" data-v-ef92321c><h3 class="font-serif font-semibold text-cafe text-lg mb-5 flex items-center gap-2" data-v-ef92321c><span class="text-xl" data-v-ef92321c>ğŸ•“</span><span data-v-ef92321c>Historial de Sesiones</span></h3>'),(null==(u=s(E).ultimas_sesiones)?void 0:u.length)?(a('<div class="space-y-4" data-v-ef92321c>\x3c!--[--\x3e'),b(s(E).ultimas_sesiones,(e,t)=>{a(`<div class="flex gap-4 group" data-v-ef92321c><div class="flex flex-col items-center" data-v-ef92321c><div class="${f([{"bg-green-500":"completada"===e.estado,"bg-red-500":"cancelada"===e.estado,"bg-yellow-500":"pendiente"===e.estado,"bg-blue-500":"confirmada"===e.estado},"w-3 h-3 rounded-full mt-1.5 flex-shrink-0"])}" data-v-ef92321c></div>`),t<s(E).ultimas_sesiones.length-1?a('<div class="w-px h-full bg-cafe/10 mt-1" data-v-ef92321c></div>'):a("\x3c!----\x3e"),a(`</div><div class="flex-1 pb-6" data-v-ef92321c><div class="flex items-start justify-between gap-3" data-v-ef92321c><div class="flex-1" data-v-ef92321c><p class="text-sm font-medium text-cafe" data-v-ef92321c>${i(formatearFecha(e.fecha_cita))}</p><p class="text-xs text-cafe/60 mt-0.5" data-v-ef92321c>${i(e.hora_inicio)} - ${i(e.hora_fin)}</p></div><span class="${f([{"text-green-700 bg-green-100":"completada"===e.estado,"text-red-700 bg-red-100":"cancelada"===e.estado,"text-yellow-700 bg-yellow-100":"pendiente"===e.estado,"text-blue-700 bg-blue-100":"confirmada"===e.estado},"text-xs font-semibold px-2 py-1 rounded-full whitespace-nowrap"])}" data-v-ef92321c>${i(e.estado)}</span></div>`),e.notas?a(`<p class="text-xs text-cafe/70 mt-2 leading-relaxed" data-v-ef92321c>${i(e.notas)}</p>`):a("\x3c!----\x3e"),a("</div></div>")}),a("\x3c!--]--\x3e</div>")):a('<div class="text-center py-8" data-v-ef92321c><span class="text-4xl block mb-3 opacity-50" data-v-ef92321c>ğŸ“…</span><p class="text-sm text-cafe/60" data-v-ef92321c>No hay sesiones registradas aÃºn</p></div>'),a("</section>"),s(E).id?a(x(m,{key:`bonos-${s(E).id}-${s(k)}`,"paciente-id":s(E).id,onRenovarBono:handleRenovarBono,onVerDetalles:handleVerDetallesBono,onCrearBono:handleCrearBono,onConfirmarPago:handleConfirmarPago,onRevertirPago:handleRevertirPago},null,o)):a("\x3c!----\x3e"),a('<section class="grid grid-cols-1 md:grid-cols-3 gap-3 pt-4" data-v-ef92321c><button class="px-4 py-3 bg-yellow-500 hover:bg-yellow-600 text-white rounded-xl font-medium flex items-center justify-center gap-2 shadow-sm transition-all duration-200 hover:shadow-md hover:-translate-y-0.5" data-v-ef92321c><span class="text-lg" data-v-ef92321c>ğŸ””</span><span class="text-sm" data-v-ef92321c>Recordatorio</span></button><button class="px-4 py-3 bg-terracota hover:bg-terracota/90 text-white rounded-xl font-medium flex items-center justify-center gap-2 shadow-sm transition-all duration-200 hover:shadow-md hover:-translate-y-0.5" data-v-ef92321c><span class="text-lg" data-v-ef92321c>ğŸ“…</span><span class="text-sm" data-v-ef92321c>Ver Agenda</span></button><button class="px-4 py-3 bg-green-500 hover:bg-green-600 text-white rounded-xl font-medium flex items-center justify-center gap-2 shadow-sm transition-all duration-200 hover:shadow-md hover:-translate-y-0.5" data-v-ef92321c><span class="text-lg" data-v-ef92321c>ğŸ’¬</span><span class="text-sm" data-v-ef92321c>WhatsApp</span></button></section></div></div>')):a("\x3c!----\x3e"),s(P)?a('<div class="fixed inset-0 bg-black/30 backdrop-blur-sm z-40" data-v-ef92321c></div>'):a("\x3c!----\x3e"),a("</div>")}}},j=$.setup;$.setup=(e,a)=>{const t=n();return(t.modules||(t.modules=new Set)).add("pages/coordinadora/pacientes-old.vue"),j?j(e,a):void 0};const A=g($,[["__scopeId","data-v-ef92321c"]]);export{A as default};
//# sourceMappingURL=pacientes-old-C9Bhntj-.mjs.map
