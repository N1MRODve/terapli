import{v as e,a,e as t,s as r}from"./server.mjs";import{_ as s}from"./_plugin-vue_export-helper-1tPrXgE0.mjs";import{r as o}from"./TicketIcon-zZdrc71S.mjs";import{r as n}from"./PencilIcon-BKWXEWgS.mjs";import{r as l}from"./TrashIcon-3HGFGGDp.mjs";import{r as d}from"./CalendarIcon-BrsGHJBC.mjs";import{r as i}from"./ClockIcon-BxdFtPqx.mjs";import{r as c}from"./ExclamationTriangleIcon-DQdM2y0F.mjs";import{r as u}from"./BellAlertIcon-DDdTQQDY.mjs";import{_ as p}from"./ModalNuevaCita-CAxtnDaO.mjs";import{u as v}from"./useSupabase-DfFg84CY.mjs";import{u as b}from"./useBonos-B2-LOzOF.mjs";import{u as m}from"./useCitas-DyEZH6RI.mjs";import{u as f}from"./useSupabaseClient-DykwVqLQ.mjs";import{r as x}from"./CheckCircleIcon-CT9fzVFs.mjs";import{r as g}from"./XCircleIcon-Cr4IlpzV.mjs";import{r as h}from"./XMarkIcon-DCLwyE-W.mjs";import{r as y,a as w,b as _}from"./EyeIcon-D0b66TCN.mjs";import{r as C}from"./DocumentTextIcon-O51EkPyw.mjs";import{r as $}from"./PlusIcon-CHLzv-V9.mjs";import{r as I}from"./MagnifyingGlassIcon-GsbNDyPZ.mjs";import{r as R}from"./FunnelIcon-y4UDP9oS.mjs";import{r as k}from"./ChevronDownIcon-CvdhRGll.mjs";import{r as A}from"./CalendarDaysIcon-f8DhK37e.mjs";import{r as D}from"./ClipboardDocumentListIcon-tIc_vSd1.mjs";import{r as E}from"./UserGroupIcon-BhthmHUw.mjs";import"../routes/renderer.mjs";import"../nitro/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"../_/shared.cjs.prod.mjs";import"../virtual/_commonjsHelpers.mjs";import"node:stream";import"../_/index2.mjs";import"@supabase/supabase-js";import"@vercel/analytics/nuxt";import"./UserIcon-CrHYaeI9.mjs";import"./PhoneIcon-acGzPaDV.mjs";import"./CheckBadgeIcon-DjhxLc-3.mjs";const S=e.ref([]);let F=0;const useToast=()=>{const addToast=(e,a,t=5e3)=>{const r=++F,s={id:r,type:e,message:a,duration:t};return S.value.push(s),t>0&&setTimeout(()=>{removeToast(r)},t),r},removeToast=e=>{const a=S.value.findIndex(a=>a.id===e);a>-1&&S.value.splice(a,1)};return{toasts:S,addToast:addToast,removeToast:removeToast,success:(e,a)=>addToast("success",e,a),error:(e,a)=>addToast("error",e,a),warning:(e,a)=>addToast("warning",e,a),info:(e,a)=>addToast("info",e,a)}};function render$4(a,t){return e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e.createElementVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75"})])}function render$3(a,t){return e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e.createElementVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M11.35 3.836c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m8.9-4.414c.376.023.75.05 1.124.08 1.131.094 1.976 1.057 1.976 2.192V16.5A2.25 2.25 0 0 1 18 18.75h-2.25m-7.5-10.5H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V18.75m-7.5-10.5h6.375c.621 0 1.125.504 1.125 1.125v9.375m-8.25-3 1.5 1.5 3-3.75"})])}function render$2(a,t){return e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e.createElementVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m.75 12 3 3m0 0 3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})])}function render$1(a,t){return e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e.createElementVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"})])}function render(a,t){return e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e.createElementVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3.75 9.776c.112-.017.227-.026.344-.026h15.812c.117 0 .232.009.344.026m-16.5 0a2.25 2.25 0 0 0-1.883 2.542l.857 6a2.25 2.25 0 0 0 2.227 1.932H19.05a2.25 2.25 0 0 0 2.227-1.932l.857-6a2.25 2.25 0 0 0-1.883-2.542m-16.5 0V6A2.25 2.25 0 0 1 6 3.75h3.879a1.5 1.5 0 0 1 1.06.44l2.122 2.12a1.5 1.5 0 0 0 1.06.44H18A2.25 2.25 0 0 1 20.25 9v.776"})])}const B={__name:"PacienteCard",__ssrInlineRender:!0,props:{paciente:{type:Object,required:!0}},emits:["editar","eliminar","ver-citas","gestionar-bonos","editar-cita"],setup(a){const t=a,s=e.computed(()=>{const e=t.paciente.nombre||"Sin nombre";if("Sin nombre"===e)return"Sin nombre";const a=e.trim().split(" ");if(a.length>2){return`${a[0]} ${a[1]} ${a[a.length-1].charAt(0)}.`}return e}),p=e.computed(()=>{const e=t.paciente.nombre||"";if(!e)return"??";const a=e.trim().split(" ");return`${a[0]?.charAt(0).toUpperCase()||"?"}${a[1]?.charAt(0).toUpperCase()||""}`}),v=e.computed(()=>{const e=["#5550F2","#C89B8A","#B7C6B0","#A8C5B5","#D4A5A5","#C4B5A0"];return e[t.paciente.id.charCodeAt(0)%e.length]}),b=e.computed(()=>t.paciente.activo?t.paciente.en_pausa?"Pausa":"Activo":"Finalizado"),m=e.computed(()=>t.paciente.activo?t.paciente.en_pausa?"bg-yellow-50 text-yellow-700":"bg-green-50 text-green-700":"bg-gray-100 text-gray-600"),f=e.computed(()=>t.paciente.activo?t.paciente.en_pausa?"bg-yellow-500":"bg-green-500":"bg-gray-400"),x=e.computed(()=>{if(!t.paciente.ultima_sesion)return"Sin registro";const e=new Date(t.paciente.ultima_sesion),a=new Date,r=Math.floor((a-e)/864e5);return 0===r?"Hoy":1===r?"Ayer":r<7?`Hace ${r} dÃ­as`:r<30?`Hace ${Math.floor(r/7)} sem`:e.toLocaleDateString("es-ES",{day:"numeric",month:"short"})}),g=e.computed(()=>{if(!t.paciente.proxima_sesion)return null;try{let e=t.paciente.proxima_sesion;e.includes("T")||(e+="T00:00:00");const a=new Date(e);return isNaN(a.getTime())?null:a.toLocaleDateString("es-ES",{weekday:"short",day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})}catch{return null}}),h=e.computed(()=>t.paciente.total_sesiones||0),y=e.computed(()=>t.paciente.evolucion_porcentaje||0),w=e.computed(()=>{const e=y.value;return e>=70?"bg-green-500":e>=50?"bg-yellow-500":"bg-orange-500"}),_=e.computed(()=>{if(!t.paciente.ultima_sesion)return 0;const e=new Date(t.paciente.ultima_sesion),a=new Date;return Math.floor((a-e)/864e5)}),C=e.computed(()=>!(!t.paciente.activo||t.paciente.en_pausa)&&_.value>30),$=e.computed(()=>t.paciente.bono_activo||null),I=e.computed(()=>{if(!$.value?.tipo)return"";return{otro:"Demanda",quincenal:"Quinc.",semanal:"Semanal",mensual:"Mensual",personalizado:"Pers."}[$.value.tipo]||$.value.tipo}),R=e.computed(()=>{if(!$.value?.estado)return"";return{activo:"Activo",pendiente:"Pend.",vencido:"Vencido",completado:"Complet."}[$.value.estado]||$.value.estado}),k=e.computed(()=>{if(!$.value?.estado)return"bg-gray-100 text-gray-600";return{activo:"bg-green-100 text-green-700",pendiente:"bg-yellow-100 text-yellow-700",vencido:"bg-red-100 text-red-700",completado:"bg-gray-100 text-gray-600"}[$.value.estado]||"bg-gray-100 text-gray-600"}),A=e.computed(()=>{if(!$.value?.fecha_fin)return"â€”";try{return new Date($.value.fecha_fin).toLocaleDateString("es-ES",{day:"numeric",month:"short"})}catch{return"â€”"}}),D=e.computed(()=>{if(!$.value?.fecha_fin)return"text-gray-400";const e=new Date($.value.fecha_fin),a=new Date,t=Math.floor((e-a)/864e5);return t<0?"text-red-600 font-medium":t<=7?"text-orange-600":"text-gray-500"}),E=e.computed(()=>$.value?$.value.sesiones_totales-$.value.sesiones_restantes:0),S=e.computed(()=>$.value?.sesiones_totales||0),F=e.computed(()=>{if(!$.value)return"text-gray-600";const e=$.value.sesiones_restantes;return 0===e?"text-red-600":e<=2?"text-orange-600":"text-gray-700"}),B=e.computed(()=>{if(!$.value)return"text-gray-400";const e=$.value.sesiones_restantes;return e<=1?"text-red-500":2===e?"text-amber-500":"text-purple-500"}),j=e.computed(()=>!!$.value&&1===$.value.sesiones_restantes),P=e.computed(()=>!!$.value&&2===$.value.sesiones_restantes),L=e.computed(()=>j.value||P.value||C.value);return(t,M,q,T)=>{M(`<article${r.ssrRenderAttrs(e.mergeProps({class:"bg-white rounded-xl border border-gray-100 p-5 hover:shadow-md hover:border-gray-200 transition-all duration-200 group relative cursor-pointer focus-within:ring-2 focus-within:ring-purple-600 focus-within:ring-offset-2",role:"article","aria-label":`Ficha de ${e.unref(s)}`,tabindex:"0"},T))} data-v-049f658f><div class="absolute top-3 right-3 flex gap-1 opacity-0 group-hover:opacity-100 group-focus-within:opacity-100 transition-all duration-200 z-10" role="toolbar" aria-label="Acciones del paciente" data-v-049f658f><button class="min-h-[36px] min-w-[36px] p-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors shadow-sm hover:shadow-md focus:ring-2 focus:ring-purple-300 focus:outline-none"${r.ssrRenderAttr("aria-label",`Gestionar bonos de ${e.unref(s)}`)} data-v-049f658f>`),M(r.ssrRenderComponent(e.unref(o),{class:"w-4 h-4","aria-hidden":"true"},null,q)),M(`</button><button class="min-h-[36px] min-w-[36px] p-2 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition-colors shadow-sm hover:shadow-md focus:ring-2 focus:ring-gray-300 focus:outline-none"${r.ssrRenderAttr("aria-label",`Editar informaciÃ³n de ${e.unref(s)}`)} data-v-049f658f>`),M(r.ssrRenderComponent(e.unref(n),{class:"w-4 h-4","aria-hidden":"true"},null,q)),M(`</button><button class="min-h-[36px] min-w-[36px] p-2 bg-gray-100 text-gray-600 rounded-lg hover:bg-red-100 hover:text-red-600 transition-colors shadow-sm hover:shadow-md focus:ring-2 focus:ring-red-300 focus:outline-none"${r.ssrRenderAttr("aria-label",`Eliminar a ${e.unref(s)}`)} data-v-049f658f>`),M(r.ssrRenderComponent(e.unref(l),{class:"w-4 h-4","aria-hidden":"true"},null,q)),M(`</button></div><div class="flex items-center gap-3 mb-4" data-v-049f658f><div class="w-11 h-11 rounded-full flex items-center justify-center text-white font-semibold text-base flex-shrink-0" style="${r.ssrRenderStyle({backgroundColor:e.unref(v)})}"${r.ssrRenderAttr("aria-label",`Avatar de ${e.unref(s)}`)} data-v-049f658f>${r.ssrInterpolate(e.unref(p))}</div><div class="flex-1 min-w-0" data-v-049f658f><div class="flex items-center gap-2" data-v-049f658f><h3 class="font-medium text-base text-gray-900 truncate" data-v-049f658f>${r.ssrInterpolate(e.unref(s))}</h3><span class="${r.ssrRenderClass([e.unref(m),"inline-flex items-center gap-1 px-2 py-0.5 text-xs font-medium rounded-full flex-shrink-0"])}" data-v-049f658f><span class="${r.ssrRenderClass([e.unref(f),"w-1.5 h-1.5 rounded-full"])}" data-v-049f658f></span> ${r.ssrInterpolate(e.unref(b))}</span></div></div></div><div class="space-y-2 text-sm text-gray-600" data-v-049f658f><div class="flex items-center gap-2" data-v-049f658f>`),M(r.ssrRenderComponent(e.unref(d),{class:"w-4 h-4 text-gray-400 flex-shrink-0"},null,q)),M(`<span class="${r.ssrRenderClass({"text-gray-400":!a.paciente.ultima_sesion})}" data-v-049f658f>${r.ssrInterpolate(e.unref(x))}</span></div><div class="flex items-center gap-2" data-v-049f658f>`),M(r.ssrRenderComponent(e.unref(i),{class:"w-4 h-4 text-gray-400 flex-shrink-0"},null,q)),e.unref(g)?M(`<button class="text-purple-600 hover:text-purple-700 hover:underline transition-colors focus:outline-none focus:ring-1 focus:ring-purple-300 rounded px-1 -mx-1"${r.ssrRenderAttr("aria-label",`Editar cita: ${e.unref(g)}`)} data-v-049f658f>${r.ssrInterpolate(e.unref(g))}</button>`):M('<span class="text-gray-400" data-v-049f658f>Sin cita programada</span>'),M("</div>"),e.unref($)?(M('<div class="flex items-center gap-2" data-v-049f658f>'),M(r.ssrRenderComponent(e.unref(o),{class:["w-4 h-4 flex-shrink-0",e.unref(B)]},null,q)),M(`<span class="flex items-center gap-1.5 flex-wrap" data-v-049f658f><span class="${r.ssrRenderClass([e.unref(F),"font-medium"])}" data-v-049f658f>${r.ssrInterpolate(e.unref(I))} ${r.ssrInterpolate(e.unref(E))}/${r.ssrInterpolate(e.unref(S))}</span><span class="text-gray-400" data-v-049f658f>Â·</span><span class="${r.ssrRenderClass([e.unref(D),"text-xs"])}" data-v-049f658f> Vence ${r.ssrInterpolate(e.unref(A))}</span>`),"activo"!==e.unref($).estado?M(`<span class="${r.ssrRenderClass([e.unref(k),"px-1.5 py-0.5 text-xs font-medium rounded"])}" data-v-049f658f>${r.ssrInterpolate(e.unref(R))}</span>`):M("\x3c!----\x3e"),M("</span></div>")):M("\x3c!----\x3e"),M("</div>"),e.unref(L)?(M('<div class="mt-3" data-v-049f658f>'),e.unref(j)?(M('<div class="flex items-center gap-2 px-3 py-2 bg-red-50 border border-red-100 rounded-lg text-xs" data-v-049f658f>'),M(r.ssrRenderComponent(e.unref(c),{class:"w-4 h-4 text-red-500 flex-shrink-0"},null,q)),M('<span class="text-red-700 font-medium" data-v-049f658f> Ãšltima sesiÃ³n del bono </span></div>')):e.unref(P)?(M('<div class="flex items-center gap-2 px-3 py-2 bg-amber-50 border border-amber-100 rounded-lg text-xs" data-v-049f658f>'),M(r.ssrRenderComponent(e.unref(render$1),{class:"w-4 h-4 text-amber-500 flex-shrink-0"},null,q)),M(`<span class="text-amber-700 font-medium" data-v-049f658f> Quedan ${r.ssrInterpolate(e.unref($).sesiones_restantes)} sesiones </span></div>`)):e.unref(C)?(M('<div class="flex items-center gap-2 px-3 py-2 bg-red-50 border border-red-100 rounded-lg text-xs" data-v-049f658f>'),M(r.ssrRenderComponent(e.unref(u),{class:"w-4 h-4 text-red-500 flex-shrink-0"},null,q)),M(`<span class="text-red-700 font-medium" data-v-049f658f>${r.ssrInterpolate(e.unref(_))} dÃ­as sin sesiÃ³n </span></div>`)):M("\x3c!----\x3e"),M("</div>")):M("\x3c!----\x3e"),M(`<div class="mt-3 pt-3 border-t border-gray-50 flex items-center justify-between text-xs text-gray-400" data-v-049f658f><span data-v-049f658f>${r.ssrInterpolate(e.unref(h))} sesiones completadas</span>`),e.unref(y)>0?M(`<span class="flex items-center gap-1" data-v-049f658f><span class="${r.ssrRenderClass([e.unref(w),"w-1.5 h-1.5 rounded-full"])}" data-v-049f658f></span> ${r.ssrInterpolate(e.unref(y))}% </span>`):M("\x3c!----\x3e"),M("</div></article>")}}},j=B.setup;B.setup=(a,t)=>{const r=e.useSSRContext();return(r.modules||(r.modules=new Set)).add("components/PacienteCard.vue"),j?j(a,t):void 0};const P=s(B,[["__scopeId","data-v-049f658f"]]),L={__name:"ModalNuevoPaciente",__ssrInlineRender:!0,props:{mostrar:{type:Boolean,default:!1}},emits:["cerrar","paciente-creado"],setup(a,{emit:s}){const o=a;v(),b(),m(),t();const n=e.ref({nombre:"",apellido:"",email:"",telefono:"",fecha_nacimiento:"",tipo_bono:"",primera_sesion:"",activo:!0,notas_iniciales:"",crear_bono:!1,bono_monto:0,bono_renovacion_automatica:!1}),l=e.ref(!1),d=e.ref(""),i={otro:60,quincenal:100,semanal:160,mensual:180},c=e.computed(()=>{const e=n.value.tipo_bono;if(!e)return 0;return{otro:1,quincenal:2,semanal:4,mensual:4}[e]||0}),u=e.computed(()=>({otro:"A Demanda",quincenal:"Quincenal",semanal:"Semanal",mensual:"Mensual"}[n.value.tipo_bono]||"No seleccionado")),p=e.computed(()=>{const e=c.value,a=n.value.bono_monto;return!e||!a||e<=0?"0.00":(a/e).toFixed(2)}),f=e.computed(()=>{const e=n.value.tipo_bono;return e&&i[e]||0}),x=e.computed(()=>"otro"===n.value.tipo_bono),g=e.computed(()=>{const e=new Date,a=[],formatearDateTime=(e,a)=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}T${a}`,t=new Date(e);t.setDate(t.getDate()+1),a.push({label:"ğŸŒ… MaÃ±ana 10:00",datetime:formatearDateTime(t,"10:00")});const r=new Date(e),s=(8-r.getDay())%7;r.setDate(r.getDate()+(s||7)),a.push({label:"ğŸ“… PrÃ³ximo Lun 09:00",datetime:formatearDateTime(r,"09:00")});const o=new Date(e);return o.setDate(o.getDate()+7),a.push({label:"ğŸ—“ï¸ En 7 dÃ­as 16:00",datetime:formatearDateTime(o,"16:00")}),a}),h=e.computed(()=>{const e=n.value.nombre&&n.value.apellido&&n.value.email&&n.value.tipo_bono&&n.value.primera_sesion;return n.value.crear_bono?e&&n.value.bono_monto>0:e});e.watch(()=>n.value.tipo_bono,e=>{"otro"===e?(n.value.crear_bono=!1,n.value.bono_monto=0):n.value.crear_bono&&0===n.value.bono_monto&&(n.value.bono_monto=i[e]||0)}),e.watch(()=>n.value.crear_bono,e=>{e&&n.value.tipo_bono&&0===n.value.bono_monto&&(n.value.bono_monto=i[n.value.tipo_bono]||0)}),e.watch(()=>o.mostrar,e=>{e&&resetearFormulario()});const resetearFormulario=()=>{n.value={nombre:"",apellido:"",email:"",telefono:"",fecha_nacimiento:"",tipo_bono:"",primera_sesion:"",activo:!0,notas_iniciales:"",crear_bono:!1,bono_monto:0,bono_renovacion_automatica:!1},d.value=""};return(t,s,o,i)=>{a.mostrar?(s(`<div${r.ssrRenderAttrs(e.mergeProps({class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},i))}><div class="bg-white/95 backdrop-blur-lg rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto border border-white/30"><div class="sticky top-0 bg-gradient-to-r from-[#5550F2]/5 via-[#027368]/5 to-[#04BF9D]/5 backdrop-blur-md border-b border-neutral-200 px-6 py-4 flex justify-between items-center shadow-sm"><h2 class="text-2xl font-[&#39;Elms_Sans&#39;] text-neutral-800 font-semibold"> Nuevo Paciente </h2><button class="text-neutral-600 hover:text-[#027368] transition-colors p-2 hover:bg-white/50 rounded-lg" aria-label="Cerrar modal"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div><form class="px-6 py-6 space-y-6 bg-gradient-to-b from-white/50 to-transparent"><div class="space-y-4"><h3 class="text-lg font-[&#39;Elms_Sans&#39;] text-neutral-800 font-semibold"> InformaciÃ³n Personal </h3><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label for="nombre" class="block text-sm font-medium text-neutral-700 mb-1"> Nombre <span class="text-red-500">*</span></label><input id="nombre"${r.ssrRenderAttr("value",n.value.nombre)} type="text" required class="w-full px-4 py-2 border border-neutral-300 rounded-xl focus:ring-2 focus:ring-[#027368]/20 focus:border-[#027368] bg-white/90 backdrop-blur-sm transition-all shadow-sm" placeholder="Nombre del paciente"></div><div><label for="apellido" class="block text-sm font-medium text-neutral-700 mb-1"> Apellido <span class="text-red-500">*</span></label><input id="apellido"${r.ssrRenderAttr("value",n.value.apellido)} type="text" required class="w-full px-4 py-2 border border-neutral-300 rounded-xl focus:ring-2 focus:ring-[#027368]/20 focus:border-[#027368] bg-white/90 backdrop-blur-sm transition-all shadow-sm" placeholder="Apellido(s) del paciente"></div><div><label for="email" class="block text-sm font-medium text-neutral-700 mb-1"> Email <span class="text-red-500">*</span></label><input id="email"${r.ssrRenderAttr("value",n.value.email)} type="email" required class="w-full px-4 py-2 border border-neutral-300 rounded-xl focus:ring-2 focus:ring-[#027368]/20 focus:border-[#027368] bg-white/90 backdrop-blur-sm transition-all shadow-sm" placeholder="correo@ejemplo.com"></div><div><label for="telefono" class="block text-sm font-medium text-neutral-700 mb-1"> TelÃ©fono </label><input id="telefono"${r.ssrRenderAttr("value",n.value.telefono)} type="tel" class="w-full px-4 py-2 border border-neutral-300 rounded-xl focus:ring-2 focus:ring-[#027368]/20 focus:border-[#027368] bg-white/90 backdrop-blur-sm transition-all shadow-sm" placeholder="+52 123 456 7890"></div><div><label for="fecha_nacimiento" class="block text-sm font-medium text-[#2D3748] mb-1"> Fecha de Nacimiento </label><div class="relative"><input id="fecha_nacimiento"${r.ssrRenderAttr("value",n.value.fecha_nacimiento)} type="date" class="w-full px-4 py-2 pr-12 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white cursor-pointer"><button type="button" class="absolute right-2 top-1/2 -translate-y-1/2 p-2 text-[#5550F2] hover:text-[#2D3748] transition-colors" title="Abrir calendario"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg></button></div><p class="text-xs text-cafe/60 mt-1"> ğŸ’¡ Puedes escribir la fecha o usar el calendario </p></div></div></div><div class="space-y-4 pt-4 border-t border-neutral-200"><h3 class="text-lg font-[&#39;Elms_Sans&#39;] text-neutral-800 font-semibold"> InformaciÃ³n TerapÃ©utica </h3><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label for="tipo_bono" class="block text-sm font-medium text-[#2D3748] mb-1"> Tipo de Bono <span class="text-red-500">*</span></label><select id="tipo_bono" required class="w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white"><option value=""${r.ssrIncludeBooleanAttr(Array.isArray(n.value.tipo_bono)?r.ssrLooseContain(n.value.tipo_bono,""):r.ssrLooseEqual(n.value.tipo_bono,""))?" selected":""}>Selecciona tipo de bono</option><option value="otro"${r.ssrIncludeBooleanAttr(Array.isArray(n.value.tipo_bono)?r.ssrLooseContain(n.value.tipo_bono,"otro"):r.ssrLooseEqual(n.value.tipo_bono,"otro"))?" selected":""}>A Demanda (1 sesiÃ³n - 60â‚¬ - sin compromiso)</option><option value="quincenal"${r.ssrIncludeBooleanAttr(Array.isArray(n.value.tipo_bono)?r.ssrLooseContain(n.value.tipo_bono,"quincenal"):r.ssrLooseEqual(n.value.tipo_bono,"quincenal"))?" selected":""}>Quincenal (2 sesiones/mes - 100â‚¬)</option><option value="semanal"${r.ssrIncludeBooleanAttr(Array.isArray(n.value.tipo_bono)?r.ssrLooseContain(n.value.tipo_bono,"semanal"):r.ssrLooseEqual(n.value.tipo_bono,"semanal"))?" selected":""}>Semanal (4 sesiones/mes - 160â‚¬)</option><option value="mensual"${r.ssrIncludeBooleanAttr(Array.isArray(n.value.tipo_bono)?r.ssrLooseContain(n.value.tipo_bono,"mensual"):r.ssrLooseEqual(n.value.tipo_bono,"mensual"))?" selected":""}>Mensual</option></select><p class="text-xs text-cafe/60 mt-1"> ğŸ« Define el tipo de bono del paciente </p></div><div><label for="primera_sesion" class="block text-sm font-medium text-[#2D3748] mb-1"> Primera SesiÃ³n <span class="text-red-500">*</span></label><div class="relative"><input id="primera_sesion"${r.ssrRenderAttr("value",n.value.primera_sesion)} type="datetime-local" required step="1800" class="w-full px-4 py-2 pr-12 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white cursor-pointer"><button type="button" class="absolute right-2 top-1/2 -translate-y-1/2 p-2 text-[#5550F2] hover:text-[#2D3748] transition-colors" title="Abrir selector de fecha y hora"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></button></div><div class="flex gap-2 flex-wrap mt-2">\x3c!--[--\x3e`),r.ssrRenderList(e.unref(g),(e,a)=>{s(`<button type="button" class="${r.ssrRenderClass(["text-xs px-3 py-1.5 rounded-lg border transition-all",n.value.primera_sesion===e.datetime?"bg-[#5550F2] text-white border-[#5550F2] font-semibold":"bg-white text-[#2D3748] border-[#5550F2]/30 hover:border-[#5550F2] hover:bg-[#5550F2]/10"])}">${r.ssrInterpolate(e.label)}</button>`)}),s('\x3c!--]--\x3e</div><p class="text-xs text-cafe/60 mt-1"> ğŸ’¡ Puedes escribir la fecha/hora o usar el selector </p></div></div></div><div class="space-y-4 pt-4 border-t border-[#5550F2]/30"><div class="border-t pt-6"><h3 class="text-lg font-serif text-[#2D3748] font-semibold mb-2"> ğŸ’³ Bono Inicial (Opcional) </h3>'),e.unref(x)?s('<div class="bg-amber-50 border-2 border-amber-200 rounded-lg p-4 mb-3"><div class="flex items-start gap-3"><span class="text-2xl">â„¹ï¸</span><div><p class="text-sm font-semibold text-amber-900 mb-1"> SesiÃ³n &quot;A Demanda&quot; seleccionada </p><p class="text-sm text-amber-800"> Las sesiones a demanda son <strong>sin compromiso</strong> y se pagan individualmente (60â‚¬ por sesiÃ³n). No es necesario crear un bono prepagado. </p></div></div></div>'):s('<p class="text-sm text-cafe/70 mb-3"> Crea un bono prepagado para que el paciente empiece su tratamiento. PodrÃ¡s confirmar el pago despuÃ©s. </p>'),s(`<label class="${r.ssrRenderClass([e.unref(x)?"bg-gray-100 border-2 border-gray-200 cursor-not-allowed opacity-60":"bg-purple-50 border-2 border-purple-200 cursor-pointer hover:bg-purple-100","flex items-center gap-3 p-3 rounded-lg transition-colors"])}"><input${r.ssrIncludeBooleanAttr(Array.isArray(n.value.crear_bono)?r.ssrLooseContain(n.value.crear_bono,null):n.value.crear_bono)?" checked":""} type="checkbox"${r.ssrIncludeBooleanAttr(e.unref(x))?" disabled":""} class="w-5 h-5 text-purple-600 border-gray-300 rounded focus:ring-purple-500 disabled:opacity-50 disabled:cursor-not-allowed"><span class="${r.ssrRenderClass([e.unref(x)?"text-gray-500":"text-purple-700","text-sm font-semibold"])}"> âœ… SÃ­, crear bono prepagado para este paciente </span></label></div>`),n.value.crear_bono?(s(`<div class="border-2 border-purple-400/40 rounded-lg p-5 space-y-4 bg-gradient-to-br from-purple-50 to-purple-100/50"><div class="bg-white border-2 border-purple-300 rounded-lg p-4 shadow-sm"><div class="flex items-start gap-3"><div class="w-10 h-10 bg-purple-500 rounded-full flex items-center justify-center flex-shrink-0"><span class="text-white text-xl">ğŸŸï¸</span></div><div class="flex-1"><h4 class="font-semibold text-purple-900 mb-1"> Tipo de Bono: ${r.ssrInterpolate(e.unref(u)||"Selecciona un tipo arriba")}</h4><div class="grid grid-cols-2 gap-3 text-sm"><div class="flex items-center gap-2"><span class="text-purple-600">ğŸ“Š</span><span class="text-purple-800"><strong>${r.ssrInterpolate(e.unref(c))}</strong> ${r.ssrInterpolate(1===e.unref(c)?"sesiÃ³n":"sesiones")}</span></div>`),e.unref(f)>0?s(`<div class="flex items-center gap-2"><span class="text-purple-600">ğŸ’°</span><span class="text-purple-800"> Precio sugerido: <strong>â‚¬${r.ssrInterpolate(e.unref(f))}</strong></span></div>`):s("\x3c!----\x3e"),s(`</div><p class="text-xs text-purple-600 mt-2 bg-purple-50 p-2 rounded"> ğŸ’¡ <strong>Tip:</strong> Los precios se calcularÃ¡n automÃ¡ticamente segÃºn el tipo de bono </p></div></div></div><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label for="bono_monto" class="block text-sm font-medium text-[#2D3748] mb-1"> Monto Total <span class="text-red-500">*</span></label><div class="relative"><span class="absolute left-3 top-1/2 -translate-y-1/2 text-[#2D3748]/60">â‚¬</span><input id="bono_monto"${r.ssrRenderAttr("value",n.value.bono_monto)} type="number" min="0" step="0.01"${r.ssrIncludeBooleanAttr(n.value.crear_bono)?" required":""} placeholder="0.00" class="w-full pl-8 pr-4 py-2 border border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500 bg-white"></div></div><div><label class="block text-sm font-medium text-[#2D3748] mb-1"> Precio por SesiÃ³n </label><div class="px-4 py-2 bg-purple-100 rounded-lg border border-purple-300"><span class="text-lg font-bold text-purple-700">â‚¬${r.ssrInterpolate(e.unref(p))}</span></div></div><div class="md:col-span-2"><label class="flex items-start gap-3 p-4 bg-white border-2 border-purple-200 rounded-lg cursor-pointer hover:bg-purple-50 hover:border-purple-300 transition-all"><input${r.ssrIncludeBooleanAttr(Array.isArray(n.value.bono_renovacion_automatica)?r.ssrLooseContain(n.value.bono_renovacion_automatica,null):n.value.bono_renovacion_automatica)?" checked":""} type="checkbox" class="mt-1 w-5 h-5 text-purple-600 border-gray-300 rounded focus:ring-purple-500"><div class="flex-1"><div class="flex items-center gap-2 mb-1"><span class="text-lg">ğŸ”„</span><span class="text-sm font-semibold text-purple-900"> RenovaciÃ³n AutomÃ¡tica </span><span class="ml-auto px-2 py-0.5 bg-purple-100 text-purple-700 text-xs font-medium rounded"> Recomendado </span></div><div class="text-xs text-[#2D3748]/70 space-y-1"><p>âœ“ El bono se renovarÃ¡ automÃ¡ticamente cuando se agoten las sesiones o expire</p><p>âœ“ Mantiene la continuidad del tratamiento sin interrupciones</p><p>âœ“ Puedes desactivar la renovaciÃ³n en cualquier momento</p></div></div></label></div></div>`),e.unref(c)>0&&n.value.bono_monto>0?s(`<div class="p-3 bg-white rounded-lg border border-purple-300"><div class="text-xs font-medium text-purple-800 mb-2">ğŸ“‹ Resumen del Bono</div><div class="grid grid-cols-3 gap-2 text-xs"><div><span class="text-[#2D3748]/60">Tipo:</span><span class="font-medium text-[#2D3748] ml-1">${r.ssrInterpolate(e.unref(u))}</span></div><div><span class="text-[#2D3748]/60">Sesiones:</span><span class="font-medium text-[#2D3748] ml-1">${r.ssrInterpolate(e.unref(c))}</span></div><div><span class="text-[#2D3748]/60">Total:</span><span class="font-medium text-[#2D3748] ml-1">â‚¬${r.ssrInterpolate(n.value.bono_monto)}</span></div></div></div>`):s("\x3c!----\x3e"),s("</div>")):s("\x3c!----\x3e"),s(`</div><div class="space-y-4 pt-4 border-t border-[#5550F2]/30"><h3 class="text-lg font-serif text-[#2D3748] font-semibold"> Notas Iniciales </h3><div><label for="notas_iniciales" class="block text-sm font-medium text-[#2D3748] mb-1"> Observaciones (Opcional) </label><textarea id="notas_iniciales" rows="3" class="w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white resize-none" placeholder="Observaciones iniciales, motivo de consulta, etc.">${r.ssrInterpolate(n.value.notas_iniciales)}</textarea></div></div>`),d.value?s(`<div class="bg-red-50 border border-red-200 rounded-lg p-4"><p class="text-sm text-red-600">${r.ssrInterpolate(d.value)}</p></div>`):s("\x3c!----\x3e"),s(`<div class="sticky bottom-0 bg-gradient-to-r from-white/95 via-white/90 to-white/95 backdrop-blur-md pt-4 pb-2 border-t border-neutral-200 -mx-6 px-6 mt-6 shadow-sm"><div class="flex justify-between items-center gap-3"><div class="text-xs text-neutral-600"><span class="inline-block w-2 h-2 bg-red-500 rounded-full mr-1"></span> Los campos con * son obligatorios </div><div class="flex gap-3"><button type="button"${r.ssrIncludeBooleanAttr(l.value)?" disabled":""} class="px-6 py-2.5 border-2 border-neutral-300 text-neutral-700 font-medium rounded-xl hover:bg-neutral-50 hover:border-[#027368] transition-all disabled:opacity-50 disabled:cursor-not-allowed"> Cancelar </button><button type="submit"${r.ssrIncludeBooleanAttr(l.value||!e.unref(h))?" disabled":""} class="px-8 py-2.5 bg-gradient-to-r from-[#04BF9D] to-[#027368] text-white font-semibold rounded-xl hover:from-[#027368] hover:to-[#04BF9D] transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 shadow-sm hover:shadow-md">`),l.value?s('<span class="inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></span>'):s("<span>âœ“</span>"),s(` ${r.ssrInterpolate(l.value?"Creando paciente...":"Crear Paciente")}</button></div></div></div></form></div></div>`)):s("\x3c!----\x3e")}}},M=L.setup;L.setup=(a,t)=>{const r=e.useSSRContext();return(r.modules||(r.modules=new Set)).add("components/ModalNuevoPaciente.vue"),M?M(a,t):void 0};const q=Object.assign(L,{__name:"ModalNuevoPaciente"}),T={__name:"ModalEditarPaciente",__ssrInlineRender:!0,props:{mostrar:{type:Boolean,default:!1},paciente:{type:Object,default:null}},emits:["cerrar","paciente-actualizado"],setup(a,{emit:t}){const s=a,{supabase:o}=v();b();const n=e.ref({nombre:"",apellido:"",email:"",telefono:"",fecha_nacimiento:"",tipo_bono:"",precio_sesion:null,activo:!0,en_pausa:!1,crear_bono:!1,bono_monto:null,bono_renovacion_automatica:!1,bono_sesiones_usadas:0}),l=e.ref(null),d=e.ref(!1),i=e.ref(!1),c=e.computed(()=>{if(!n.value.en_pausa)return 45;const e=(s.paciente?.metadata||{}).fecha_pausa;if(!e)return 45;const a=new Date(e),t=new Date,r=Math.floor((t.getTime()-a.getTime())/864e5);return Math.max(0,45-r)}),u=e.computed(()=>l.value?Math.max(0,l.value.sesiones_totales-(n.value.bono_sesiones_usadas||0)):0),p=e.computed(()=>{const e=n.value.tipo_bono;if(!e)return"Selecciona tipo";return{a_demanda:1,quincenal:2,semanal:4}[e]||0}),m=e.computed(()=>({a_demanda:"A Demanda",quincenal:"Quincenal",semanal:"Semanal"}[n.value.tipo_bono]||"")),f=e.computed(()=>{const e=p.value,a=n.value.bono_monto;return"Selecciona tipo"===e||!a||e<=0?"0.00":(a/e).toFixed(2)}),x=e.ref(!1),g=e.ref("");e.watch(()=>s.mostrar,e=>{e&&s.paciente&&cargarDatosPaciente()});const cargarDatosPaciente=async()=>{const e=s.paciente,a=e.metadata||{},t=(e.nombre_completo||e.nombre||"").split(" "),r=t[0]||a.nombre||"",o=t.slice(1).join(" ")||a.apellido||a.apellido_paterno||"";n.value={nombre:r,apellido:o,email:e.email||"",telefono:e.telefono||"",fecha_nacimiento:a.fecha_nacimiento||"",tipo_bono:e.tipo_bono||"",precio_sesion:e.precio_sesion||null,activo:e.activo??!0,en_pausa:e.en_pausa||a.en_pausa||!1,crear_bono:!1,bono_monto:null,bono_renovacion_automatica:!1,bono_sesiones_usadas:0},g.value="",await cargarBonoActivo()},cargarBonoActivo=async()=>{if(s.paciente?.id){d.value=!0,l.value=null;try{const{data:e,error:a}=await o.from("bonos").select("*").eq("paciente_id",s.paciente.id).in("estado",["activo","pendiente"]).order("created_at",{ascending:!1}).limit(1).single();e&&!a&&(l.value=e,n.value.bono_sesiones_usadas=e.sesiones_usadas||0)}catch(e){console.log("No se encontrÃ³ bono activo para el paciente")}finally{d.value=!1}}};return(t,s,o,v)=>{a.mostrar?(s(`<div${r.ssrRenderAttrs(e.mergeProps({class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},v))} data-v-b27bd45f><div class="bg-[#F2F2F2] rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto" data-v-b27bd45f><div class="sticky top-0 bg-[#F2F2F2] border-b border-[#5550F2]/30 px-6 py-4 flex justify-between items-center" data-v-b27bd45f><h2 class="text-2xl font-serif text-[#2D3748] font-semibold" data-v-b27bd45f> Editar Paciente </h2><button class="text-[#2D3748] hover:text-[#5550F2] transition-colors" aria-label="Cerrar modal" data-v-b27bd45f><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-b27bd45f><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" data-v-b27bd45f></path></svg></button></div><form class="px-6 py-6 space-y-6" data-v-b27bd45f><div class="space-y-4" data-v-b27bd45f><h3 class="text-lg font-serif text-[#2D3748] font-semibold" data-v-b27bd45f> InformaciÃ³n Personal </h3><div class="grid grid-cols-1 md:grid-cols-2 gap-4" data-v-b27bd45f><div data-v-b27bd45f><label for="nombre" class="block text-sm font-medium text-[#2D3748] mb-1" data-v-b27bd45f> Nombre <span class="text-red-500" data-v-b27bd45f>*</span></label><input id="nombre"${r.ssrRenderAttr("value",n.value.nombre)} type="text" required class="w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white" placeholder="Nombre del paciente" data-v-b27bd45f></div><div data-v-b27bd45f><label for="apellido" class="block text-sm font-medium text-[#2D3748] mb-1" data-v-b27bd45f> Apellido <span class="text-red-500" data-v-b27bd45f>*</span></label><input id="apellido"${r.ssrRenderAttr("value",n.value.apellido)} type="text" required class="w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white" placeholder="Apellido(s) del paciente" data-v-b27bd45f></div><div data-v-b27bd45f><label for="email" class="block text-sm font-medium text-[#2D3748] mb-1" data-v-b27bd45f> Email <span class="text-red-500" data-v-b27bd45f>*</span></label><input id="email"${r.ssrRenderAttr("value",n.value.email)} type="email" required class="w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white" placeholder="correo@ejemplo.com" data-v-b27bd45f></div><div data-v-b27bd45f><label for="telefono" class="block text-sm font-medium text-[#2D3748] mb-1" data-v-b27bd45f> TelÃ©fono </label><input id="telefono"${r.ssrRenderAttr("value",n.value.telefono)} type="tel" class="w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white" placeholder="+52 123 456 7890" data-v-b27bd45f></div><div data-v-b27bd45f><label for="fecha_nacimiento" class="block text-sm font-medium text-[#2D3748] mb-1" data-v-b27bd45f> Fecha de Nacimiento </label><input id="fecha_nacimiento"${r.ssrRenderAttr("value",n.value.fecha_nacimiento)} type="date" class="w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white" data-v-b27bd45f></div></div></div><div class="space-y-4 pt-4 border-t border-[#5550F2]/30" data-v-b27bd45f><h3 class="text-lg font-serif text-[#2D3748] font-semibold" data-v-b27bd45f> InformaciÃ³n TerapÃ©utica </h3><div class="grid grid-cols-1 md:grid-cols-2 gap-4" data-v-b27bd45f><div data-v-b27bd45f><label for="tipo_bono" class="block text-sm font-medium text-[#2D3748] mb-1" data-v-b27bd45f> Tipo de Bono <span class="text-red-500" data-v-b27bd45f>*</span></label><select id="tipo_bono" required class="w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white" data-v-b27bd45f><option value="" data-v-b27bd45f${r.ssrIncludeBooleanAttr(Array.isArray(n.value.tipo_bono)?r.ssrLooseContain(n.value.tipo_bono,""):r.ssrLooseEqual(n.value.tipo_bono,""))?" selected":""}>Selecciona tipo de bono</option><option value="a_demanda" data-v-b27bd45f${r.ssrIncludeBooleanAttr(Array.isArray(n.value.tipo_bono)?r.ssrLooseContain(n.value.tipo_bono,"a_demanda"):r.ssrLooseEqual(n.value.tipo_bono,"a_demanda"))?" selected":""}>A Demanda (1 sesiÃ³n)</option><option value="quincenal" data-v-b27bd45f${r.ssrIncludeBooleanAttr(Array.isArray(n.value.tipo_bono)?r.ssrLooseContain(n.value.tipo_bono,"quincenal"):r.ssrLooseEqual(n.value.tipo_bono,"quincenal"))?" selected":""}>Quincenal (2 sesiones/mes)</option><option value="semanal" data-v-b27bd45f${r.ssrIncludeBooleanAttr(Array.isArray(n.value.tipo_bono)?r.ssrLooseContain(n.value.tipo_bono,"semanal"):r.ssrLooseEqual(n.value.tipo_bono,"semanal"))?" selected":""}>Semanal (4 sesiones/mes)</option></select></div><div data-v-b27bd45f><label for="precio_sesion" class="block text-sm font-medium text-[#2D3748] mb-1" data-v-b27bd45f> Precio por SesiÃ³n (â‚¬) </label><div class="relative" data-v-b27bd45f><span class="absolute left-3 top-1/2 -translate-y-1/2 text-[#2D3748]/60" data-v-b27bd45f>â‚¬</span><input id="precio_sesion"${r.ssrRenderAttr("value",n.value.precio_sesion)} type="number" min="0" step="0.01" placeholder="Usar precio del terapeuta" class="w-full pl-8 pr-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white" data-v-b27bd45f></div><p class="text-xs text-[#2D3748]/60 mt-1" data-v-b27bd45f> ğŸ’¡ Precio personalizado para este paciente. Si estÃ¡ vacÃ­o, se usa el precio segÃºn frecuencia del terapeuta. </p></div><div data-v-b27bd45f><label for="activo" class="block text-sm font-medium text-[#2D3748] mb-1" data-v-b27bd45f> Estado </label><select id="activo" class="w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white" data-v-b27bd45f><option${r.ssrRenderAttr("value",!0)} data-v-b27bd45f${r.ssrIncludeBooleanAttr(Array.isArray(n.value.activo)?r.ssrLooseContain(n.value.activo,!0):r.ssrLooseEqual(n.value.activo,!0))?" selected":""}>Activo</option><option${r.ssrRenderAttr("value",!1)} data-v-b27bd45f${r.ssrIncludeBooleanAttr(Array.isArray(n.value.activo)?r.ssrLooseContain(n.value.activo,!1):r.ssrLooseEqual(n.value.activo,!1))?" selected":""}>Inactivo</option></select></div><div class="md:col-span-2 space-y-3" data-v-b27bd45f><label class="flex items-center gap-2 cursor-pointer" data-v-b27bd45f><input${r.ssrIncludeBooleanAttr(Array.isArray(n.value.en_pausa)?r.ssrLooseContain(n.value.en_pausa,null):n.value.en_pausa)?" checked":""} type="checkbox" class="w-4 h-4 text-amber-500 border-gray-300 rounded focus:ring-amber-500" data-v-b27bd45f><span class="text-sm font-medium text-[#2D3748]" data-v-b27bd45f> Proceso en pausa temporal </span></label>`),n.value.en_pausa?(s(`<div class="bg-amber-50 border border-amber-200 rounded-lg p-4 space-y-3" data-v-b27bd45f><div class="flex items-start gap-3" data-v-b27bd45f><span class="text-2xl" data-v-b27bd45f>â¸ï¸</span><div data-v-b27bd45f><p class="font-medium text-amber-800" data-v-b27bd45f>Cuenta en pausa temporal</p><p class="text-sm text-amber-700 mt-1" data-v-b27bd45f> El proceso terapeutico esta pausado. El paciente mantendra su espacio reservado durante <strong data-v-b27bd45f>45 dias</strong>. </p></div></div><div class="bg-white/80 rounded-lg p-3 border border-amber-100" data-v-b27bd45f><div class="flex items-center justify-between mb-2" data-v-b27bd45f><span class="text-sm font-medium text-gray-700" data-v-b27bd45f>Dias restantes:</span><span class="${r.ssrRenderClass([c.value<=7?"text-red-600":"text-amber-600","text-lg font-bold"])}" data-v-b27bd45f>${r.ssrInterpolate(c.value)} dias </span></div><div class="w-full bg-gray-200 rounded-full h-2" data-v-b27bd45f><div class="${r.ssrRenderClass([c.value<=7?"bg-red-500":"bg-amber-500","h-2 rounded-full transition-all"])}" style="${r.ssrRenderStyle({width:`${Math.max(0,c.value/45*100)}%`})}" data-v-b27bd45f></div></div></div><div class="text-xs text-amber-800 space-y-2 bg-amber-100/50 rounded p-3" data-v-b27bd45f><p class="font-medium flex items-center gap-1" data-v-b27bd45f><span data-v-b27bd45f>âš ï¸</span> Importante: </p><ul class="list-disc list-inside space-y-1 text-amber-700" data-v-b27bd45f><li data-v-b27bd45f>Pasados los 45 dias, el perfil se <strong data-v-b27bd45f>desactivara automaticamente</strong></li><li data-v-b27bd45f>Se liberara su espacio en la agenda de Psicologa Karem</li><li data-v-b27bd45f>Los datos se eliminaran conforme al <strong data-v-b27bd45f>reglamento de proteccion de datos</strong> para garantizar su privacidad</li><li data-v-b27bd45f>Al reactivar, los precios de las sesiones podrian haberse modificado</li></ul></div><button type="button"${r.ssrIncludeBooleanAttr(i.value)?" disabled":""} class="w-full py-2 px-4 bg-amber-600 text-white text-sm font-medium rounded-lg hover:bg-amber-700 disabled:opacity-50 transition-colors flex items-center justify-center gap-2" data-v-b27bd45f>`),i.value?s('\x3c!--[--\x3e<span class="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin" data-v-b27bd45f></span> Enviando... \x3c!--]--\x3e'):s("\x3c!--[--\x3e<span data-v-b27bd45f>ğŸ“§</span> Enviar recordatorio al paciente \x3c!--]--\x3e"),s("</button></div>")):s("\x3c!----\x3e"),s('</div></div></div><div class="space-y-4 pt-4 border-t border-[#5550F2]/30" data-v-b27bd45f><h3 class="text-lg font-serif text-[#2D3748] font-semibold" data-v-b27bd45f> GestiÃ³n de Bonos </h3>'),l.value?(s(`<div class="border-2 border-blue-400/40 rounded-lg p-4 space-y-4 bg-blue-50/30" data-v-b27bd45f><div class="flex items-center justify-between" data-v-b27bd45f><div class="flex items-center gap-2" data-v-b27bd45f><span class="text-xl" data-v-b27bd45f>ğŸ«</span><div data-v-b27bd45f><p class="font-medium text-[#2D3748]" data-v-b27bd45f>Bono ${r.ssrInterpolate(l.value.tipo||"Activo")}</p><p class="text-xs text-[#2D3748]/60" data-v-b27bd45f> Estado: <span class="${r.ssrRenderClass(["activo"===l.value.estado?"text-green-600":"text-amber-600","font-medium capitalize"])}" data-v-b27bd45f>${r.ssrInterpolate(l.value.estado)}</span></p></div></div><span class="${r.ssrRenderClass(["activo"===l.value.estado?"bg-green-100 text-green-700":"bg-amber-100 text-amber-700","px-2 py-1 text-xs font-medium rounded-full"])}" data-v-b27bd45f>${r.ssrInterpolate(l.value.sesiones_restantes)}/${r.ssrInterpolate(l.value.sesiones_totales)} restantes </span></div><div class="grid grid-cols-2 gap-4" data-v-b27bd45f><div data-v-b27bd45f><label class="block text-sm font-medium text-[#2D3748] mb-1" data-v-b27bd45f> Sesiones Totales </label><div class="px-4 py-2 bg-gray-100 border border-gray-300 rounded-lg text-[#2D3748] font-medium" data-v-b27bd45f>${r.ssrInterpolate(l.value.sesiones_totales)}</div></div><div data-v-b27bd45f><label for="sesiones_usadas_bono" class="block text-sm font-medium text-[#2D3748] mb-1" data-v-b27bd45f> Sesiones Consumidas </label><input id="sesiones_usadas_bono"${r.ssrRenderAttr("value",n.value.bono_sesiones_usadas)} type="number" min="0"${r.ssrRenderAttr("max",l.value.sesiones_totales)} class="w-full px-4 py-2 border border-blue-400/50 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white" data-v-b27bd45f></div></div><div class="${r.ssrRenderClass([u.value<=0?"bg-red-50 border border-red-200":"bg-blue-50 border border-blue-200","flex items-center gap-2 p-3 rounded-lg"])}" data-v-b27bd45f><span class="${r.ssrRenderClass(u.value<=0?"text-red-600":"text-blue-600")}" data-v-b27bd45f>${r.ssrInterpolate(u.value<=0?"âš ï¸":"â„¹ï¸")}</span><p class="${r.ssrRenderClass([u.value<=0?"text-red-800":"text-blue-800","text-sm"])}" data-v-b27bd45f><strong data-v-b27bd45f>${r.ssrInterpolate(u.value)}</strong> de ${r.ssrInterpolate(l.value.sesiones_totales)} sesiones disponibles `),n.value.bono_sesiones_usadas!==l.value.sesiones_usadas?s('<span class="text-amber-600 ml-1" data-v-b27bd45f> (modificado) </span>'):s("\x3c!----\x3e"),s('</p></div><p class="text-xs text-[#2D3748]/60" data-v-b27bd45f> ğŸ’¡ Ajusta las sesiones consumidas para sincronizar con datos de otra plataforma o corregir errores. </p></div>')):d.value?s("\x3c!----\x3e"):s('<div class="bg-gray-50 border border-gray-200 rounded-lg p-4 text-center" data-v-b27bd45f><p class="text-sm text-[#2D3748]/70" data-v-b27bd45f> Este paciente no tiene un bono activo. </p></div>'),d.value?s('<div class="flex items-center justify-center py-4" data-v-b27bd45f><div class="w-5 h-5 border-2 border-blue-200 border-t-blue-600 rounded-full animate-spin mr-2" data-v-b27bd45f></div><span class="text-sm text-[#2D3748]/60" data-v-b27bd45f>Cargando bono...</span></div>'):s("\x3c!----\x3e"),s(`<div class="flex items-center justify-between pt-2" data-v-b27bd45f><label class="flex items-center gap-2 cursor-pointer" data-v-b27bd45f><input${r.ssrIncludeBooleanAttr(Array.isArray(n.value.crear_bono)?r.ssrLooseContain(n.value.crear_bono,null):n.value.crear_bono)?" checked":""} type="checkbox" class="w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500" data-v-b27bd45f><span class="text-sm font-medium text-[#2D3748]" data-v-b27bd45f> ğŸ« Crear nuevo bono para este paciente </span></label></div>`),n.value.crear_bono?(s(`<div class="border-2 border-purple-400/40 rounded-lg p-4 space-y-4 bg-purple-50/30" data-v-b27bd45f><div class="bg-purple-100 border border-purple-300 rounded-lg p-3 flex items-start gap-2" data-v-b27bd45f><svg class="w-5 h-5 text-purple-600 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20" data-v-b27bd45f><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" data-v-b27bd45f></path></svg><div class="text-sm text-purple-800" data-v-b27bd45f><p class="font-medium" data-v-b27bd45f>El bono usarÃ¡ el tipo seleccionado arriba: <strong data-v-b27bd45f>${r.ssrInterpolate(m.value||"Selecciona un tipo primero")}</strong></p><p class="text-xs text-purple-700 mt-1" data-v-b27bd45f> Sesiones incluidas: ${r.ssrInterpolate("Selecciona tipo"===p.value?"N/A":p.value)}</p></div></div><div class="grid grid-cols-1 md:grid-cols-2 gap-4" data-v-b27bd45f><div data-v-b27bd45f><label for="bono_monto" class="block text-sm font-medium text-[#2D3748] mb-1" data-v-b27bd45f> Monto Total <span class="text-red-500" data-v-b27bd45f>*</span></label><div class="relative" data-v-b27bd45f><span class="absolute left-3 top-2.5 text-[#2D3748] font-medium" data-v-b27bd45f>â‚¬</span><input id="bono_monto"${r.ssrRenderAttr("value",n.value.bono_monto)} type="number" min="0" step="0.01"${r.ssrIncludeBooleanAttr(n.value.crear_bono)?" required":""} class="w-full pl-8 pr-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white" placeholder="0.00" data-v-b27bd45f></div></div><div data-v-b27bd45f><label class="block text-sm font-medium text-[#2D3748] mb-1" data-v-b27bd45f> Precio por SesiÃ³n </label><div class="px-4 py-2 bg-purple-100 border-2 border-purple-300 rounded-lg text-purple-900 font-bold" data-v-b27bd45f> â‚¬${r.ssrInterpolate(f.value)}</div></div><div class="md:col-span-2" data-v-b27bd45f><label class="flex items-center gap-2 cursor-pointer" data-v-b27bd45f><input${r.ssrIncludeBooleanAttr(Array.isArray(n.value.bono_renovacion_automatica)?r.ssrLooseContain(n.value.bono_renovacion_automatica,null):n.value.bono_renovacion_automatica)?" checked":""} type="checkbox" class="w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500" data-v-b27bd45f><span class="text-sm font-medium text-[#2D3748]" data-v-b27bd45f> ğŸ”„ RenovaciÃ³n automÃ¡tica al vencer </span></label><p class="text-xs text-cafe/60 mt-1 ml-6" data-v-b27bd45f> El sistema crearÃ¡ un nuevo bono idÃ©ntico cuando este expire </p></div></div>`),p.value&&n.value.bono_monto?(s(`<div class="bg-white border border-purple-300 rounded-lg p-4" data-v-b27bd45f><p class="text-sm font-medium text-[#2D3748] mb-2" data-v-b27bd45f>ğŸ“‹ Resumen del Bono:</p><div class="text-sm text-cafe/80 space-y-1" data-v-b27bd45f><p data-v-b27bd45f>â€¢ <strong data-v-b27bd45f>Tipo:</strong> ${r.ssrInterpolate(m.value)}</p><p data-v-b27bd45f>â€¢ <strong data-v-b27bd45f>Sesiones:</strong> ${r.ssrInterpolate(p.value)}</p><p data-v-b27bd45f>â€¢ <strong data-v-b27bd45f>Total:</strong> â‚¬${r.ssrInterpolate(n.value.bono_monto.toFixed(2))}</p><p data-v-b27bd45f>â€¢ <strong data-v-b27bd45f>Por sesiÃ³n:</strong> â‚¬${r.ssrInterpolate(f.value)}</p>`),n.value.bono_renovacion_automatica?s('<p class="text-purple-700" data-v-b27bd45f>â€¢ âœ… Con renovaciÃ³n automÃ¡tica</p>'):s("\x3c!----\x3e"),s("</div></div>")):s("\x3c!----\x3e"),s("</div>")):s("\x3c!----\x3e"),s("</div>"),g.value?s(`<div class="bg-red-50 border border-red-200 rounded-lg p-4" data-v-b27bd45f><p class="text-sm text-red-600" data-v-b27bd45f>${r.ssrInterpolate(g.value)}</p></div>`):s("\x3c!----\x3e"),s(`<div class="flex justify-end gap-3 pt-4 border-t border-[#5550F2]/30" data-v-b27bd45f><button type="button"${r.ssrIncludeBooleanAttr(x.value)?" disabled":""} class="px-6 py-2 border border-[#5550F2] text-[#2D3748] rounded-lg hover:bg-[#5550F2]/10 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" data-v-b27bd45f> Cancelar </button><button type="submit"${r.ssrIncludeBooleanAttr(x.value)?" disabled":""} class="px-6 py-2 bg-[#5550F2] text-white rounded-lg hover:bg-[#C69F91] transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2" data-v-b27bd45f>`),x.value?s('<span class="inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin" data-v-b27bd45f></span>'):s("\x3c!----\x3e"),s(` ${r.ssrInterpolate(x.value?"Actualizando...":"Guardar Cambios")}</button></div></form></div></div>`)):s("\x3c!----\x3e")}}},z=T.setup;T.setup=(a,t)=>{const r=e.useSSRContext();return(r.modules||(r.modules=new Set)).add("components/ModalEditarPaciente.vue"),z?z(a,t):void 0};const V=s(T,[["__scopeId","data-v-b27bd45f"]]),N={__name:"ModalEliminarPaciente",__ssrInlineRender:!0,props:{mostrar:{type:Boolean,default:!1},paciente:{type:Object,default:null}},emits:["cerrar","paciente-eliminado","paciente-desactivado"],setup(a,{emit:t}){const s=a;v();const o=e.ref(!1),n=e.ref(""),l=e.computed(()=>s.paciente?s.paciente.nombre_completo||s.paciente.nombre||s.paciente.email||"este paciente":"");return(t,s,d,i)=>{a.mostrar?(s(`<div${r.ssrRenderAttrs(e.mergeProps({class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},i))} data-v-941153fc><div class="bg-[#F2F2F2] rounded-lg shadow-xl max-w-md w-full" data-v-941153fc><div class="px-6 py-4 border-b border-[#5550F2]/30" data-v-941153fc><div class="flex items-center gap-3" data-v-941153fc><span class="text-3xl" data-v-941153fc>âš ï¸</span><h2 class="text-2xl font-serif text-[#2D3748] font-semibold" data-v-941153fc> Eliminar Paciente </h2></div></div><div class="px-6 py-6 space-y-4" data-v-941153fc><p class="text-[#2D3748]" data-v-941153fc> Â¿EstÃ¡s seguro de que deseas eliminar a <strong class="font-semibold" data-v-941153fc>${r.ssrInterpolate(l.value)}</strong>? </p><div class="bg-red-50 border border-red-200 rounded-lg p-4 space-y-2" data-v-941153fc><p class="text-sm text-red-800 font-medium" data-v-941153fc> Esta acciÃ³n no se puede deshacer y eliminarÃ¡: </p><ul class="text-sm text-red-700 space-y-1 ml-4 list-disc" data-v-941153fc><li data-v-941153fc>Todos los datos personales del paciente</li><li data-v-941153fc>El historial de sesiones</li><li data-v-941153fc>Las notas terapÃ©uticas</li><li data-v-941153fc>Las mÃ©tricas de bienestar</li><li data-v-941153fc>Los bonos asociados</li></ul></div><div class="bg-blue-50 border border-blue-200 rounded-lg p-4" data-v-941153fc><p class="text-sm text-blue-800 font-medium mb-2" data-v-941153fc> ğŸ’¡ RecomendaciÃ³n: </p><p class="text-sm text-blue-700 mb-3" data-v-941153fc> En lugar de eliminar, considera <strong data-v-941153fc>desactivar</strong> al paciente. Esto preservarÃ¡ el historial para consultas futuras. </p><button type="button"${r.ssrIncludeBooleanAttr(o.value)?" disabled":""} class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-sm" data-v-941153fc> Desactivar en lugar de eliminar </button></div>`),n.value?s(`<div class="bg-red-50 border border-red-200 rounded-lg p-3" data-v-941153fc><p class="text-sm text-red-600" data-v-941153fc>${r.ssrInterpolate(n.value)}</p></div>`):s("\x3c!----\x3e"),s(`</div><div class="px-6 py-4 border-t border-[#5550F2]/30 flex justify-end gap-3" data-v-941153fc><button type="button"${r.ssrIncludeBooleanAttr(o.value)?" disabled":""} class="px-6 py-2 border border-[#5550F2] text-[#2D3748] rounded-lg hover:bg-[#5550F2]/10 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" data-v-941153fc> Cancelar </button><button type="button"${r.ssrIncludeBooleanAttr(o.value)?" disabled":""} class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2" data-v-941153fc>`),o.value?s('<span class="inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin" data-v-941153fc></span>'):s("\x3c!----\x3e"),s(` ${r.ssrInterpolate(o.value?"Eliminando...":"Eliminar Definitivamente")}</button></div></div></div>`)):s("\x3c!----\x3e")}}},O=N.setup;N.setup=(a,t)=>{const r=e.useSSRContext();return(r.modules||(r.modules=new Set)).add("components/ModalEliminarPaciente.vue"),O?O(a,t):void 0};const H=s(N,[["__scopeId","data-v-941153fc"]]),G=e.defineComponent({__name:"ModalEditarCita",__ssrInlineRender:!0,props:{isOpen:{type:Boolean},citaId:{}},emits:["close","actualizado"],setup(a,{emit:t}){const s=a,o=f(),{getCitasPorDia:n}=m(),l=e.ref(null),d=e.ref(!1),i=e.ref(!1),c=e.ref(!1),u=e.ref({fecha_cita:"",hora_inicio:"",hora_fin:"",duracion:60,modalidad:"presencial",estado:"pendiente",observaciones:""}),p=e.computed(()=>{if(!u.value.fecha_cita)return"";return new Date(u.value.fecha_cita+"T00:00:00").toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}),v=e.computed(()=>{const e=new Date,a=[],formatearFecha=e=>e.toISOString().split("T")[0];a.push({label:"Hoy",fecha:formatearFecha(e)});const t=new Date(e);t.setDate(t.getDate()+1),a.push({label:"MaÃ±ana",fecha:formatearFecha(t)});const r=["Lun","Mar","MiÃ©","Jue","Vie"];let s=new Date(e),o=0;for(;o<5;){s.setDate(s.getDate()+1);const e=s.getDay();e>=1&&e<=5&&(a.push({label:`${r[e-1]} ${s.getDate()}`,fecha:formatearFecha(s)}),o++)}return a}),b=["08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00","18:30","19:00","19:30","20:00","20:30","21:00","21:30","22:00"],cargarCita=async()=>{if(console.log("ğŸ” [ModalEditarCita] Cargando cita con ID:",s.citaId),s.citaId)try{d.value=!0;const{data:e,error:a}=await o.from("citas").select("\n        *,\n        paciente:pacientes!citas_paciente_id_fkey (\n          id,\n          nombre_completo,\n          email,\n          telefono\n        )\n      ").eq("id",s.citaId).single();if(a)throw console.error("âŒ [ModalEditarCita] Error en query:",a),a;console.log("âœ… [ModalEditarCita] Cita cargada:",e),e&&(l.value=e,u.value={fecha_cita:e.fecha_cita,hora_inicio:e.hora_inicio?.substring(0,5)||"",hora_fin:e.hora_fin?.substring(0,5)||"",duracion:e.duracion||60,modalidad:e.modalidad||"presencial",estado:e.estado||"pendiente",observaciones:e.observaciones||""},console.log("ğŸ“ [ModalEditarCita] Formulario llenado:",u.value))}catch(e){console.error("ğŸ’¥ [ModalEditarCita] Error al cargar cita:",e)}finally{d.value=!1}else console.warn("âš ï¸ [ModalEditarCita] No hay citaId proporcionado")},horaAMinutos=e=>{if(!e||!e.includes(":"))return 0;const[a,t]=e.split(":").map(Number);return 60*(a||0)+(t||0)};return e.watch(()=>u.value.hora_inicio,e=>{if(e&&u.value.duracion){const[a,t]=e.split(":").map(Number),r=60*(a||0)+(t||0)+u.value.duracion,s=Math.floor(r/60),o=r%60;u.value.hora_fin=`${String(s).padStart(2,"0")}:${String(o).padStart(2,"0")}`}}),e.watch(()=>u.value.duracion,e=>{if(u.value.hora_inicio&&e){const[a,t]=u.value.hora_inicio.split(":").map(Number),r=60*(a||0)+(t||0)+e,s=Math.floor(r/60),o=r%60;u.value.hora_fin=`${String(s).padStart(2,"0")}:${String(o).padStart(2,"0")}`}}),e.watch([()=>u.value.fecha_cita,()=>u.value.hora_inicio,()=>u.value.hora_fin],()=>{(async()=>{if(u.value.fecha_cita&&u.value.hora_inicio&&u.value.hora_fin)try{const e=(await n(u.value.fecha_cita)).filter(e=>"cancelada"!==e.estado&&e.id!==s.citaId),a=u.value.hora_inicio,t=u.value.hora_fin;c.value=e.some(e=>{const r=e.hora_inicio?.substring(0,5),s=e.hora_fin?.substring(0,5),o=horaAMinutos(a),n=horaAMinutos(t),l=horaAMinutos(r),d=horaAMinutos(s);return o>=l&&o<d||n>l&&n<=d||o<=l&&n>=d})}catch(e){console.error("Error al verificar conflicto:",e),c.value=!1}else c.value=!1})()}),e.watch(()=>s.isOpen,e=>{console.log("ğŸ‘ï¸ [ModalEditarCita] Modal abierto:",e,"citaId:",s.citaId),e&&s.citaId&&cargarCita()}),e.watch(()=>s.citaId,e=>{console.log("ğŸ”„ [ModalEditarCita] citaId cambiÃ³ a:",e),s.isOpen&&e&&cargarCita()}),(e,t,s,o)=>{r.ssrRenderTeleport(t,e=>{a.isOpen?(e('<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" data-v-e8361a38><div class="bg-white dark:bg-gray-900 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden" data-v-e8361a38><div class="px-6 py-4 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20" data-v-e8361a38><div data-v-e8361a38><h2 class="text-2xl font-bold text-gray-900 dark:text-white" data-v-e8361a38>âœï¸ Editar Cita</h2>'),l.value?e(`<p class="text-sm text-gray-600 dark:text-gray-400 mt-1" data-v-e8361a38>${r.ssrInterpolate(l.value.paciente?.nombre_completo||l.value.paciente_nombre)}</p>`):e("\x3c!----\x3e"),e('</div><button class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors" aria-label="Cerrar" data-v-e8361a38><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-e8361a38><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" data-v-e8361a38></path></svg></button></div>'),d.value?e('<div class="p-12 flex flex-col items-center justify-center" data-v-e8361a38><div class="w-12 h-12 border-4 border-purple-200 border-t-purple-600 rounded-full animate-spin mb-4" data-v-e8361a38></div><p class="text-gray-600 dark:text-gray-400" data-v-e8361a38>Cargando...</p></div>'):l.value?(e(`<form class="px-6 py-4 overflow-y-auto max-h-[calc(90vh-200px)]" data-v-e8361a38><div class="space-y-6" data-v-e8361a38><div data-v-e8361a38><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" data-v-e8361a38> ğŸ“… Fecha </label><div class="space-y-2" data-v-e8361a38><input${r.ssrRenderAttr("value",u.value.fecha_cita)} type="date" required class="w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-800 dark:text-white cursor-pointer" data-v-e8361a38><div class="flex gap-2 flex-wrap" data-v-e8361a38>\x3c!--[--\x3e`),r.ssrRenderList(v.value,(a,t)=>{e(`<button type="button" class="${r.ssrRenderClass(["text-xs px-3 py-1.5 rounded-lg border transition-all",u.value.fecha_cita===a.fecha?"bg-purple-600 text-white border-purple-600 font-semibold":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 border-gray-300 dark:border-gray-600 hover:border-purple-500 hover:bg-purple-50 dark:hover:bg-purple-900/20"])}" data-v-e8361a38>${r.ssrInterpolate(a.label)}</button>`)}),e(`\x3c!--]--\x3e</div><p class="text-xs text-gray-500 dark:text-gray-400 capitalize" data-v-e8361a38>${r.ssrInterpolate(p.value)}</p></div></div><div class="grid grid-cols-1 md:grid-cols-3 gap-4" data-v-e8361a38><div class="md:col-span-2" data-v-e8361a38><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" data-v-e8361a38> ğŸ• Hora Inicio </label><div class="space-y-3" data-v-e8361a38><div class="grid grid-cols-4 sm:grid-cols-6 gap-2 max-h-48 overflow-y-auto p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg border border-gray-200 dark:border-gray-700" data-v-e8361a38>\x3c!--[--\x3e`),r.ssrRenderList(b,a=>{e(`<button type="button" class="${r.ssrRenderClass(["px-3 py-2 text-sm font-medium rounded-lg transition-all border-2",u.value.hora_inicio===a?"bg-purple-600 text-white border-purple-600 shadow-md transform scale-105":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 border-gray-200 dark:border-gray-600 hover:border-purple-500 hover:bg-purple-50 dark:hover:bg-purple-900/20 hover:shadow"])}" data-v-e8361a38>${r.ssrInterpolate(a)}</button>`)}),e(`\x3c!--]--\x3e</div><details class="text-xs" data-v-e8361a38><summary class="cursor-pointer text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 select-none flex items-center gap-1" data-v-e8361a38><span data-v-e8361a38>âŒ¨ï¸</span><span data-v-e8361a38>Ingresar hora manualmente</span></summary><div class="mt-2" data-v-e8361a38><input${r.ssrRenderAttr("value",u.value.hora_inicio)} type="time" required step="1800" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-800 dark:text-white" data-v-e8361a38></div></details></div></div><div data-v-e8361a38><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" data-v-e8361a38> â±ï¸ DuraciÃ³n (min) </label><select class="w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-800 dark:text-white" data-v-e8361a38><option${r.ssrRenderAttr("value",30)} data-v-e8361a38${r.ssrIncludeBooleanAttr(Array.isArray(u.value.duracion)?r.ssrLooseContain(u.value.duracion,30):r.ssrLooseEqual(u.value.duracion,30))?" selected":""}>30 min</option><option${r.ssrRenderAttr("value",45)} data-v-e8361a38${r.ssrIncludeBooleanAttr(Array.isArray(u.value.duracion)?r.ssrLooseContain(u.value.duracion,45):r.ssrLooseEqual(u.value.duracion,45))?" selected":""}>45 min</option><option${r.ssrRenderAttr("value",60)} data-v-e8361a38${r.ssrIncludeBooleanAttr(Array.isArray(u.value.duracion)?r.ssrLooseContain(u.value.duracion,60):r.ssrLooseEqual(u.value.duracion,60))?" selected":""}>60 min</option><option${r.ssrRenderAttr("value",90)} data-v-e8361a38${r.ssrIncludeBooleanAttr(Array.isArray(u.value.duracion)?r.ssrLooseContain(u.value.duracion,90):r.ssrLooseEqual(u.value.duracion,90))?" selected":""}>90 min</option></select></div><div data-v-e8361a38><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" data-v-e8361a38> ğŸ•‘ Hora Fin </label><input${r.ssrRenderAttr("value",u.value.hora_fin)} type="time" required readonly step="1800" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-800 dark:text-white" data-v-e8361a38></div></div>`),c.value?e('<div class="p-4 bg-yellow-50 dark:bg-yellow-900/20 border-2 border-yellow-300 dark:border-yellow-700 rounded-lg" data-v-e8361a38><div class="flex items-start gap-3" data-v-e8361a38><span class="text-2xl" data-v-e8361a38>âš ï¸</span><div data-v-e8361a38><div class="font-semibold text-yellow-800 dark:text-yellow-300 mb-1" data-v-e8361a38> Conflicto de Horario </div><div class="text-sm text-yellow-700 dark:text-yellow-400" data-v-e8361a38> Ya existe otra cita en este horario. Por favor, selecciona otro horario. </div></div></div></div>'):e("\x3c!----\x3e"),e('<div data-v-e8361a38><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" data-v-e8361a38> ğŸ’» Modalidad </label><div class="grid grid-cols-3 gap-3" data-v-e8361a38>\x3c!--[--\x3e'),r.ssrRenderList([{valor:"presencial",icono:"ğŸ¥",nombre:"Presencial"},{valor:"online",icono:"ğŸ’»",nombre:"Online"},{valor:"telefonica",icono:"ğŸ“",nombre:"TelÃ©fono"}],a=>{e(`<button type="button" class="${r.ssrRenderClass(["p-3 border-2 rounded-lg transition-all",u.value.modalidad===a.valor?"border-purple-600 bg-purple-50 dark:bg-purple-900/20":"border-gray-300 dark:border-gray-700 hover:border-purple-400"])}" data-v-e8361a38><div class="text-2xl mb-1" data-v-e8361a38>${r.ssrInterpolate(a.icono)}</div><div class="text-sm font-medium text-gray-900 dark:text-white" data-v-e8361a38>${r.ssrInterpolate(a.nombre)}</div></button>`)}),e('\x3c!--]--\x3e</div></div><div data-v-e8361a38><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" data-v-e8361a38> ğŸ“Š Estado </label><div class="grid grid-cols-2 md:grid-cols-4 gap-3" data-v-e8361a38>\x3c!--[--\x3e'),r.ssrRenderList([{valor:"pendiente",icono:"â³",nombre:"Pendiente"},{valor:"confirmada",icono:"âœ…",nombre:"Confirmada"},{valor:"realizada",icono:"âœ“",nombre:"Realizada"},{valor:"cancelada",icono:"âŒ",nombre:"Cancelada"}],a=>{e(`<button type="button" class="${r.ssrRenderClass(["p-2 border-2 rounded-lg transition-all",u.value.estado===a.valor?"border-purple-600 bg-purple-50 dark:bg-purple-900/20":"border-gray-300 dark:border-gray-700 hover:border-purple-400"])}" data-v-e8361a38><div class="text-xl mb-1" data-v-e8361a38>${r.ssrInterpolate(a.icono)}</div><div class="text-xs font-medium text-gray-900 dark:text-white" data-v-e8361a38>${r.ssrInterpolate(a.nombre)}</div></button>`)}),e(`\x3c!--]--\x3e</div></div><div data-v-e8361a38><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" data-v-e8361a38> ğŸ“ Observaciones </label><textarea rows="3" placeholder="Notas adicionales sobre la cita..." class="w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-800 dark:text-white" data-v-e8361a38>${r.ssrInterpolate(u.value.observaciones)}</textarea></div></div></form>`)):e("\x3c!----\x3e"),e(`<div class="px-6 py-4 border-t border-gray-200 dark:border-gray-800 flex gap-3 bg-gray-50 dark:bg-gray-800" data-v-e8361a38><button type="button" class="flex-1 px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors font-medium" data-v-e8361a38> Cancelar </button><button${r.ssrIncludeBooleanAttr(i.value||c.value)?" disabled":""} class="${r.ssrRenderClass(["flex-1 px-4 py-2 rounded-lg font-medium transition-colors",i.value||c.value?"bg-gray-400 dark:bg-gray-600 text-gray-200 cursor-not-allowed":"bg-purple-600 hover:bg-purple-700 text-white"])}" data-v-e8361a38>`),i.value?e("<span data-v-e8361a38>Guardando...</span>"):e("<span data-v-e8361a38>ğŸ’¾ Guardar Cambios</span>"),e("</button></div></div></div>")):e("\x3c!----\x3e")},"body",!1,s)}}}),Q=G.setup;G.setup=(a,t)=>{const r=e.useSSRContext();return(r.modules||(r.modules=new Set)).add("components/ModalEditarCita.vue"),Q?Q(a,t):void 0};const U=Object.assign(s(G,[["__scopeId","data-v-e8361a38"]]),{__name:"ModalEditarCita"}),X={__name:"ToastContainer",__ssrInlineRender:!0,setup(a){const{toasts:t}=useToast(),toastClasses=e=>{const a={success:"border-green-200 bg-green-50 text-green-800",error:"border-red-200 bg-red-50 text-red-800",warning:"border-amber-200 bg-amber-50 text-amber-800",info:"border-blue-200 bg-blue-50 text-blue-800"};return a[e]||a.info};return(a,s,o,n)=>{s(`<div${r.ssrRenderAttrs(e.mergeProps({class:"fixed bottom-4 right-4 z-50 flex flex-col gap-3 max-w-sm w-full pointer-events-none",role:"region","aria-live":"polite","aria-label":"Notificaciones"},n))} data-v-4b6dd325>\x3c!--[--\x3e`),r.ssrRenderList(e.unref(t),a=>{s(`<div class="${r.ssrRenderClass([toastClasses(a.type),"pointer-events-auto bg-white rounded-lg shadow-lg border p-4 flex items-start gap-3 transition-all duration-300"])}" role="alert" data-v-4b6dd325><div class="flex-shrink-0" data-v-4b6dd325>`),"success"===a.type?s(r.ssrRenderComponent(e.unref(x),{class:"w-5 h-5","aria-hidden":"true"},null,o)):"error"===a.type?s(r.ssrRenderComponent(e.unref(render$1),{class:"w-5 h-5","aria-hidden":"true"},null,o)):"warning"===a.type?s(r.ssrRenderComponent(e.unref(c),{class:"w-5 h-5","aria-hidden":"true"},null,o)):s(r.ssrRenderComponent(e.unref(g),{class:"w-5 h-5","aria-hidden":"true"},null,o)),s(`</div><p class="text-sm font-medium flex-1" data-v-4b6dd325>${r.ssrInterpolate(a.message)}</p><button class="min-h-[44px] min-w-[44px] p-2 -mr-2 -mt-2 hover:bg-gray-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-gray-300"${r.ssrRenderAttr("aria-label",`Cerrar notificaciÃ³n: ${a.message}`)} data-v-4b6dd325>`),s(r.ssrRenderComponent(e.unref(h),{class:"w-4 h-4","aria-hidden":"true"},null,o)),s("</button></div>")}),s("\x3c!--]--\x3e</div>")}}},Y=X.setup;X.setup=(a,t)=>{const r=e.useSSRContext();return(r.modules||(r.modules=new Set)).add("components/ToastContainer.vue"),Y?Y(a,t):void 0};const Z=s(X,[["__scopeId","data-v-4b6dd325"]]),J=e.defineComponent({__name:"FileDropzone",__ssrInlineRender:!0,props:{accept:{default:".csv,.xlsx,.xls"},maxSize:{default:10485760},supportedFormats:{default:"CSV, XLSX"},ariaLabel:{default:"Seleccionar archivo para subir"}},emits:["file-selected","file-removed","error"],setup(a,{expose:t,emit:s}){const o=a,n=s,l=e.ref(null),d=e.ref(!1),i=e.ref(""),c=e.computed(()=>!!i.value),u=e.computed(()=>Math.round(o.maxSize/1048576));return t({removeFile:()=>{l.value=null,i.value="",n("file-removed")}}),(t,s,o,n)=>{s(`<div${r.ssrRenderAttrs(e.mergeProps({class:["relative border-2 border-dashed rounded-xl p-8 transition-all duration-200 text-center",[e.unref(d)?"border-purple-600 bg-purple-50":"border-gray-300 bg-gray-50",e.unref(c)?"border-red-400 bg-red-50":"",e.unref(l)?"border-green-400 bg-green-50":""]]},n))}><div class="mb-4">`),e.unref(l)?s(r.ssrRenderComponent(e.unref(C),{class:"w-12 h-12 mx-auto text-green-600","aria-hidden":"true"},null,o)):s(r.ssrRenderComponent(e.unref(y),{class:["w-12 h-12 mx-auto",e.unref(d)?"text-purple-600":"text-gray-400"],"aria-hidden":"true"},null,o)),s("</div>"),e.unref(l)?(s(`<div class="flex items-center justify-center gap-4"><div class="text-left flex-1"><p class="text-sm font-semibold text-cafe">${r.ssrInterpolate(e.unref(l).name)}</p><p class="text-xs text-gray-500">${r.ssrInterpolate((e=>{if(0===e)return"0 Bytes";const a=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,a)*100)/100+" "+["Bytes","KB","MB","GB"][a]})(e.unref(l).size))}</p></div><button class="min-h-[44px] min-w-[44px] p-2 text-red-600 hover:bg-red-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-red-300" aria-label="Eliminar archivo">`),s(r.ssrRenderComponent(e.unref(h),{class:"w-6 h-6","aria-hidden":"true"},null,o)),s("</button></div>")):(s('<div><p class="text-lg font-medium text-cafe mb-2"> Arrastra tu archivo aquÃ­ </p><p class="text-sm text-gray-500 mb-4"> o haz clic para seleccionar </p><label class="inline-block"><span class="min-h-[44px] px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all font-medium shadow-sm hover:shadow-md cursor-pointer inline-flex items-center gap-2">'),s(r.ssrRenderComponent(e.unref(render),{class:"w-5 h-5","aria-hidden":"true"},null,o)),s(`<span>Seleccionar archivo</span></span><input type="file"${r.ssrRenderAttr("accept",a.accept)} class="hidden"${r.ssrRenderAttr("aria-label",a.ariaLabel)}></label><p class="text-xs text-gray-400 mt-4">${r.ssrInterpolate(a.supportedFormats)}</p><p class="text-xs text-gray-400"> TamaÃ±o mÃ¡ximo: ${r.ssrInterpolate(e.unref(u))}MB </p></div>`)),e.unref(i)?s(`<div class="mt-4 p-3 bg-red-100 border border-red-300 rounded-lg"><p class="text-sm text-red-800 font-medium">${r.ssrInterpolate(e.unref(i))}</p></div>`):s("\x3c!----\x3e"),s("</div>")}}}),K=J.setup;J.setup=(a,t)=>{const r=e.useSSRContext();return(r.modules||(r.modules=new Set)).add("components/shared/FileDropzone.vue"),K?K(a,t):void 0};const W=Object.assign(J,{__name:"SharedFileDropzone"}),ee=e.defineComponent({__name:"ColumnMappingTable",__ssrInlineRender:!0,props:{detectedColumns:{},mappings:{},validation:{}},emits:["update:mapping"],setup(a,{emit:t}){const s=a,o=[{field:"nombre_completo",label:"Nombre Completo"},{field:"email",label:"Email"},{field:"telefono",label:"TelÃ©fono"}],n=[{field:"documento_identidad",label:"Documento de Identidad"},{field:"fecha_nacimiento",label:"Fecha de Nacimiento"},{field:"direccion",label:"DirecciÃ³n"},{field:"contacto_emergencia",label:"Contacto de Emergencia"}],l=[{field:"area_de_acompanamiento",label:"Ãrea de AcompaÃ±amiento"},{field:"frecuencia",label:"Frecuencia de Sesiones"},{field:"activo",label:"Estado (Activo/Inactivo)"},{field:"derivacion",label:"DerivaciÃ³n"},{field:"medicacion",label:"MedicaciÃ³n"},{field:"orientacion_diagnostica",label:"OrientaciÃ³n DiagnÃ³stica"},{field:"inicio_tratamiento",label:"Inicio del Tratamiento"}],d=[{field:"precio_sesion",label:"Precio por SesiÃ³n"},{field:"comision",label:"ComisiÃ³n"},{field:"notas",label:"Notas / Observaciones"}],i=[...o,...n,...l,...d],getMappedField=e=>{const a=s.mappings.find(a=>a.sourceColumn===e);return a?.targetField||""},isFieldUsed=(e,a)=>s.mappings.some(t=>t.targetField===e&&t.sourceColumn!==a),isRequiredField=e=>o.some(a=>a.field===e),u=e.computed(()=>s.mappings.filter(e=>e.targetField).map(e=>e.targetField)),p=e.computed(()=>{if(!s.detectedColumns.length||!u.value.length)return[];const e=Math.min(s.detectedColumns[0]?.sampleValues?.length||0,3),a=[];for(let t=0;t<e;t++){const e={};for(const a of s.mappings)if(a.targetField){const r=s.detectedColumns.find(e=>e.name===a.sourceColumn);e[a.targetField]=r?.sampleValues?.[t]||""}Object.keys(e).length>0&&a.push(e)}return a});return(t,s,v,b)=>{s(`<div${r.ssrRenderAttrs(e.mergeProps({class:"space-y-6"},b))}><div class="bg-blue-50 border border-blue-200 rounded-lg p-4"><div class="flex gap-3">`),s(r.ssrRenderComponent(e.unref(g),{class:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"},null,v)),s('<div><p class="font-semibold text-blue-900 mb-1"> Relaciona las columnas de tu archivo con los campos de TeraplÃ­ </p><p class="text-sm text-blue-800"> Hemos detectado automÃ¡ticamente algunos campos. Revisa y ajusta segÃºn necesites. </p></div></div></div><div class="overflow-x-auto border border-gray-200 rounded-lg"><table class="w-full text-sm"><thead class="bg-gray-50"><tr><th class="px-4 py-3 text-left font-semibold text-gray-700"> Columna en tu archivo </th><th class="px-4 py-3 text-left font-semibold text-gray-700"> Valores de ejemplo </th><th class="px-4 py-3 text-left font-semibold text-gray-700"> Campo TeraplÃ­ </th><th class="px-4 py-3 text-center font-semibold text-gray-700 w-24"> Estado </th></tr></thead><tbody class="divide-y divide-gray-200">\x3c!--[--\x3e'),r.ssrRenderList(a.detectedColumns,a=>{s(`<tr class="hover:bg-gray-50"><td class="px-4 py-3"><span class="font-medium text-gray-900">${r.ssrInterpolate(a.name)}</span></td><td class="px-4 py-3"><div class="flex flex-wrap gap-1 max-w-xs">\x3c!--[--\x3e`),r.ssrRenderList(a.sampleValues.slice(0,3),(e,a)=>{s(`<span class="inline-block px-2 py-0.5 bg-gray-100 text-gray-600 rounded text-xs truncate max-w-[120px]"${r.ssrRenderAttr("title",e)}>${r.ssrInterpolate(e||"(vacÃ­o)")}</span>`)}),s(`\x3c!--]--\x3e</div></td><td class="px-4 py-3"><select${r.ssrRenderAttr("value",getMappedField(a.name))} class="${r.ssrRenderClass([{"border-green-400 bg-green-50":getMappedField(a.name)&&isRequiredField(getMappedField(a.name)),"border-blue-300 bg-blue-50":getMappedField(a.name)&&!isRequiredField(getMappedField(a.name))},"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-purple-500 focus:border-purple-500"])}"><option value="">-- No importar --</option><optgroup label="Campos obligatorios">\x3c!--[--\x3e`),r.ssrRenderList(o,e=>{s(`<option${r.ssrRenderAttr("value",e.field)}${r.ssrIncludeBooleanAttr(isFieldUsed(e.field,a.name))?" disabled":""}>${r.ssrInterpolate(e.label)} ${r.ssrInterpolate(isFieldUsed(e.field,a.name)?"(ya usado)":"*")}</option>`)}),s('\x3c!--]--\x3e</optgroup><optgroup label="Contacto">\x3c!--[--\x3e'),r.ssrRenderList(n,e=>{s(`<option${r.ssrRenderAttr("value",e.field)}${r.ssrIncludeBooleanAttr(isFieldUsed(e.field,a.name))?" disabled":""}>${r.ssrInterpolate(e.label)} ${r.ssrInterpolate(isFieldUsed(e.field,a.name)?"(ya usado)":"")}</option>`)}),s('\x3c!--]--\x3e</optgroup><optgroup label="Tratamiento">\x3c!--[--\x3e'),r.ssrRenderList(l,e=>{s(`<option${r.ssrRenderAttr("value",e.field)}${r.ssrIncludeBooleanAttr(isFieldUsed(e.field,a.name))?" disabled":""}>${r.ssrInterpolate(e.label)} ${r.ssrInterpolate(isFieldUsed(e.field,a.name)?"(ya usado)":"")}</option>`)}),s('\x3c!--]--\x3e</optgroup><optgroup label="Otros campos">\x3c!--[--\x3e'),r.ssrRenderList(d,e=>{s(`<option${r.ssrRenderAttr("value",e.field)}${r.ssrIncludeBooleanAttr(isFieldUsed(e.field,a.name))?" disabled":""}>${r.ssrInterpolate(e.label)} ${r.ssrInterpolate(isFieldUsed(e.field,a.name)?"(ya usado)":"")}</option>`)}),s('\x3c!--]--\x3e</optgroup></select></td><td class="px-4 py-3 text-center">'),getMappedField(a.name)&&isRequiredField(getMappedField(a.name))?(s('<span class="inline-flex items-center gap-1 px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium">'),s(r.ssrRenderComponent(e.unref(x),{class:"w-3.5 h-3.5"},null,v)),s(" Obligatorio </span>")):getMappedField(a.name)?(s('<span class="inline-flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-medium">'),s(r.ssrRenderComponent(e.unref(x),{class:"w-3.5 h-3.5"},null,v)),s(" Opcional </span>")):s('<span class="inline-flex items-center gap-1 px-2 py-1 bg-gray-100 text-gray-500 rounded-full text-xs"> No importar </span>'),s("</td></tr>")}),s("\x3c!--]--\x3e</tbody></table></div>"),a.validation?.errors?.length?(s('<div class="bg-red-50 border border-red-200 rounded-lg p-4"><div class="flex gap-3">'),s(r.ssrRenderComponent(e.unref(c),{class:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"},null,v)),s('<div><p class="font-semibold text-red-900 mb-2"> Errores que impiden la importaciÃ³n: </p><ul class="list-disc list-inside text-red-800 space-y-1 text-sm">\x3c!--[--\x3e'),r.ssrRenderList(a.validation.errors,(e,a)=>{s(`<li>${r.ssrInterpolate(e)}</li>`)}),s("\x3c!--]--\x3e</ul></div></div></div>")):s("\x3c!----\x3e"),a.validation?.warnings?.length&&!a.validation?.errors?.length?(s('<div class="bg-amber-50 border border-amber-200 rounded-lg p-4"><div class="flex gap-3">'),s(r.ssrRenderComponent(e.unref(render$1),{class:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"},null,v)),s('<div><p class="font-semibold text-amber-900 mb-2"> Advertencias (puedes continuar): </p><ul class="list-disc list-inside text-amber-800 space-y-1 text-sm">\x3c!--[--\x3e'),r.ssrRenderList(a.validation.warnings,(e,a)=>{s(`<li>${r.ssrInterpolate(e)}</li>`)}),s("\x3c!--]--\x3e</ul></div></div></div>")):s("\x3c!----\x3e"),e.unref(p).length>0?(s('<div class="space-y-3"><h4 class="font-semibold text-gray-900 flex items-center gap-2">'),s(r.ssrRenderComponent(e.unref(_),{class:"w-5 h-5 text-purple-600"},null,v)),s(' Vista previa con el mapeo aplicado </h4><div class="overflow-x-auto border border-gray-200 rounded-lg"><table class="w-full text-sm"><thead class="bg-purple-50"><tr>\x3c!--[--\x3e'),r.ssrRenderList(e.unref(u),e=>{s(`<th class="px-3 py-2 text-left font-medium text-purple-800 whitespace-nowrap">${r.ssrInterpolate((e=>i.find(a=>a.field===e)?.label||e)(e))}</th>`)}),s('\x3c!--]--\x3e</tr></thead><tbody class="divide-y divide-gray-100">\x3c!--[--\x3e'),r.ssrRenderList(e.unref(p),(a,t)=>{s('<tr class="hover:bg-gray-50">\x3c!--[--\x3e'),r.ssrRenderList(e.unref(u),e=>{s(`<td class="px-3 py-2 text-gray-700 whitespace-nowrap">${r.ssrInterpolate(a[e]||"â€”")}</td>`)}),s("\x3c!--]--\x3e</tr>")}),s(`\x3c!--]--\x3e</tbody></table></div><p class="text-xs text-gray-500"> Mostrando las primeras ${r.ssrInterpolate(e.unref(p).length)} fila${r.ssrInterpolate(1!==e.unref(p).length?"s":"")} de tu archivo </p></div>`)):s("\x3c!----\x3e"),s("</div>")}}}),ae=ee.setup;ee.setup=(a,t)=>{const r=e.useSSRContext();return(r.modules||(r.modules=new Set)).add("components/patients/ColumnMappingTable.vue"),ae?ae(a,t):void 0};const te=Object.assign(ee,{__name:"PatientsColumnMappingTable"});const re=e.defineComponent({__name:"PatientsImportModal",__ssrInlineRender:!0,props:{modelValue:{type:Boolean},existingPatients:{default:()=>[]}},emits:["update:modelValue","import-complete"],setup(a,{emit:t}){const s=useToast(),o=function(){const a=e.ref(null),t=e.ref([]),r=e.ref(null),s=e.ref(null),o=e.ref(!1),n=e.ref(!1),l=e.ref(!1),d=e.ref(null),validateMapping=async()=>{if(!a.value)return d.value="No hay configuraciÃ³n de importaciÃ³n",!1;n.value=!0,d.value=null;try{const e=await fetch("/api/patients/import/validate-mapping",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({configId:a.value.id,mappings:t.value})});if(!e.ok){const a=await e.json();throw new Error(a.statusMessage||"Error al validar mapeo")}const s=await e.json();return r.value=s.validation,s.validation?.isValid||!1}catch(e){return d.value=e.message||"Error al validar mapeo",console.error("Error en validateMapping:",e),!1}finally{n.value=!1}},i=e.computed(()=>{const e=new Set(t.value.map(e=>e.targetField).filter(e=>""!==e)),a=e.has("nombre_completo"),r=e.has("email")||e.has("telefono");return a&&r});return{config:a,mappings:t,validation:r,importResult:s,detecting:o,validating:n,importing:l,error:d,detectColumns:async e=>{o.value=!0,d.value=null;try{const r=new FormData;r.append("file",e);const s=await fetch("/api/patients/import/detect-columns",{method:"POST",body:r});if(!s.ok){const e=await s.json();throw new Error(e.statusMessage||"Error al detectar columnas")}const o=await s.json();if(!o.success||!o.config)throw new Error("Respuesta invÃ¡lida del servidor");return a.value=o.config,t.value=o.config.mappings||[],await validateMapping(),!0}catch(e){return d.value=e.message||"Error al detectar columnas",console.error("Error en detectColumns:",e),!1}finally{o.value=!1}},updateMapping:(e,a)=>{const r=t.value.findIndex(a=>a.sourceColumn===e);r>=0?t.value[r]={sourceColumn:e,targetField:a}:t.value.push({sourceColumn:e,targetField:a}),validateMapping()},validateMapping:validateMapping,executeImport:async(e,o)=>{if(!a.value)return d.value="No hay configuraciÃ³n de importaciÃ³n",!1;if(!r.value?.isValid)return d.value="El mapeo no es vÃ¡lido",!1;l.value=!0,d.value=null;try{const r=new FormData;r.append("file",e),r.append("configId",a.value.id),r.append("action",o),r.append("mappings",JSON.stringify(t.value));const n=await fetch("/api/patients/import/execute",{method:"POST",body:r});if(!n.ok){const e=await n.json();throw new Error(e.statusMessage||"Error al importar pacientes")}const l=await n.json();return s.value=l.results,l.success}catch(e){return d.value=e.message||"Error al importar pacientes",console.error("Error en executeImport:",e),!1}finally{l.value=!1}},reset:()=>{a.value=null,t.value=[],r.value=null,s.value=null,o.value=!1,n.value=!1,l.value=!1,d.value=null},getMappedField:e=>{const a=t.value.find(a=>a.sourceColumn===e);return a?.targetField||""},getPreviewData:()=>{if(!a.value?.detectedColumns)return[];const e=Math.min(a.value.detectedColumns[0]?.sampleValues?.length||0,3),r=[];for(let s=0;s<e;s++){const e={};for(const r of t.value)if(r.targetField){const t=a.value.detectedColumns.find(e=>e.name===r.sourceColumn);e[r.targetField]=t?.sampleValues?.[s]||""}r.push(e)}return r},hasRequiredFields:i}}(),n=e.ref(1),l=e.ref(null),d=e.ref(!1),i=e.ref(!0),u=e.ref(!1),p={nombre_completo:"Nombre Completo",email:"Email",telefono:"TelÃ©fono",documento_identidad:"Documento",fecha_nacimiento:"Fecha Nac.",direccion:"DirecciÃ³n",contacto_emergencia:"Contacto Emergencia",area_de_acompanamiento:"Ãrea",frecuencia:"Frecuencia",activo:"Estado",derivacion:"DerivaciÃ³n",medicacion:"MedicaciÃ³n",orientacion_diagnostica:"DiagnÃ³stico",inicio_tratamiento:"Inicio Trat.",precio_sesion:"Precio",comision:"ComisiÃ³n",notas:"Notas"},getFieldLabel=e=>e?p[e]||e:"";e.computed(()=>null!==l.value||null!==o.config.value||n.value>1);const handleFileSelected=e=>{l.value=e,o.error.value=null,s.info("Archivo seleccionado correctamente")},handleFileRemoved=()=>{l.value=null,o.reset()},handleDropzoneError=e=>{s.error(e)},handleMappingUpdate=(e,a)=>{o.updateMapping(e,a)};return(t,s,p,v)=>{const b=W,m=te;r.ssrRenderTeleport(s,t=>{a.modelValue?(t(`<div class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50" role="dialog" aria-modal="true" aria-labelledby="import-modal-title" data-v-97261e0d><div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col" data-v-97261e0d><div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between" data-v-97261e0d><div data-v-97261e0d><h2 id="import-modal-title" class="text-2xl font-serif font-bold text-cafe" data-v-97261e0d> Importar Pacientes </h2><p class="text-sm text-gray-500 mt-1" data-v-97261e0d> Paso ${r.ssrInterpolate(e.unref(n))} de 5 </p></div><button class="min-h-[44px] min-w-[44px] p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-gray-300" aria-label="Cerrar modal" data-v-97261e0d>`),t(r.ssrRenderComponent(e.unref(h),{class:"w-6 h-6","aria-hidden":"true"},null,p)),t('</button></div><div class="px-6 py-3 bg-gray-50" data-v-97261e0d><div class="flex items-center gap-2" data-v-97261e0d>\x3c!--[--\x3e'),r.ssrRenderList(5,a=>{t(`<div class="${r.ssrRenderClass([a<=e.unref(n)?"bg-purple-600":"bg-gray-200","flex-1 h-2 rounded-full transition-all duration-300"])}" data-v-97261e0d></div>`)}),t(`\x3c!--]--\x3e</div><div class="flex justify-between mt-2 text-xs text-gray-500" data-v-97261e0d><span class="${r.ssrRenderClass({"text-purple-600 font-medium":1===e.unref(n)})}" data-v-97261e0d>Info</span><span class="${r.ssrRenderClass({"text-purple-600 font-medium":2===e.unref(n)})}" data-v-97261e0d>Subir</span><span class="${r.ssrRenderClass({"text-purple-600 font-medium":3===e.unref(n)})}" data-v-97261e0d>Mapear</span><span class="${r.ssrRenderClass({"text-purple-600 font-medium":4===e.unref(n)})}" data-v-97261e0d>Revisar</span><span class="${r.ssrRenderClass({"text-purple-600 font-medium":5===e.unref(n)})}" data-v-97261e0d>Resultado</span></div></div><div class="flex-1 overflow-y-auto p-6" data-v-97261e0d>`),1===e.unref(n)?(t('<div class="space-y-6" data-v-97261e0d><div class="text-center" data-v-97261e0d>'),t(r.ssrRenderComponent(e.unref(render$2),{class:"w-16 h-16 mx-auto text-purple-600 mb-4","aria-hidden":"true"},null,p)),t('<h3 class="text-lg font-semibold text-cafe mb-2" data-v-97261e0d> Paso 1: Prepara tu archivo </h3><p class="text-sm text-gray-600 mb-2 max-w-md mx-auto" data-v-97261e0d> Puedes usar <strong data-v-97261e0d>cualquier Excel o CSV</strong> con tus pacientes. El sistema detectarÃ¡ las columnas automÃ¡ticamente. </p></div><div class="bg-green-50 border border-green-200 rounded-lg p-4 text-sm" data-v-97261e0d><div class="flex gap-3" data-v-97261e0d>'),t(r.ssrRenderComponent(e.unref(x),{class:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5","aria-hidden":"true"},null,p)),t('<div data-v-97261e0d><p class="font-semibold text-green-900 mb-2" data-v-97261e0d>Â¿Ya tienes un Excel con pacientes?</p><p class="text-green-800" data-v-97261e0d> Â¡Perfecto! Puedes subirlo directamente. En el siguiente paso podrÃ¡s relacionar las columnas de tu archivo con los campos de TeraplÃ­. </p></div></div></div><div class="bg-blue-50 border border-blue-200 rounded-lg p-4 text-sm" data-v-97261e0d><div class="flex gap-3" data-v-97261e0d>'),t(r.ssrRenderComponent(e.unref(g),{class:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5","aria-hidden":"true"},null,p)),t(`<div class="space-y-3" data-v-97261e0d><div data-v-97261e0d><p class="font-semibold text-blue-900 mb-1" data-v-97261e0d>Formatos aceptados:</p><p class="text-blue-800" data-v-97261e0d>CSV (.csv) y Excel (.xlsx, .xls)</p><p class="text-xs text-blue-700 mt-1" data-v-97261e0d>TamaÃ±o mÃ¡ximo: 10MB | MÃ¡ximo 5,000 filas</p></div><div data-v-97261e0d><p class="font-semibold text-blue-900 mb-1" data-v-97261e0d>Campos mÃ­nimos necesarios:</p><ul class="list-disc list-inside text-blue-800 space-y-1" data-v-97261e0d><li data-v-97261e0d><strong data-v-97261e0d>Nombre</strong> del paciente (obligatorio)</li><li data-v-97261e0d><strong data-v-97261e0d>Email</strong> o <strong data-v-97261e0d>TelÃ©fono</strong> (al menos uno)</li></ul></div><div data-v-97261e0d><p class="font-semibold text-blue-900 mb-1" data-v-97261e0d>Campos adicionales soportados:</p><p class="text-blue-800 text-xs" data-v-97261e0d> Documento de identidad, DirecciÃ³n, Fecha de nacimiento, Ãrea de tratamiento, Frecuencia, DerivaciÃ³n, MedicaciÃ³n, DiagnÃ³stico, Notas, Precio, y mÃ¡s... </p></div></div></div></div><div class="flex gap-3 justify-center pt-2" data-v-97261e0d><button${r.ssrIncludeBooleanAttr(e.unref(d))?" disabled":""} class="min-h-[44px] px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all text-sm disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2" data-v-97261e0d>`),t(r.ssrRenderComponent(e.unref(C),{class:"w-4 h-4","aria-hidden":"true"},null,p)),t(`<span data-v-97261e0d>Descargar plantilla CSV</span></button><button${r.ssrIncludeBooleanAttr(e.unref(d))?" disabled":""} class="min-h-[44px] px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all text-sm disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2" data-v-97261e0d>`),t(r.ssrRenderComponent(e.unref(C),{class:"w-4 h-4","aria-hidden":"true"},null,p)),t("<span data-v-97261e0d>Descargar plantilla Excel</span></button></div></div>")):t("\x3c!----\x3e"),2===e.unref(n)?(t('<div class="space-y-6" data-v-97261e0d><div class="text-center mb-6" data-v-97261e0d>'),t(r.ssrRenderComponent(e.unref(y),{class:"w-16 h-16 mx-auto text-purple-600 mb-4","aria-hidden":"true"},null,p)),t('<h3 class="text-lg font-semibold text-cafe mb-2" data-v-97261e0d> Paso 2: Sube tu archivo </h3><p class="text-sm text-gray-600 mb-1" data-v-97261e0d> Arrastra tu archivo o haz clic para seleccionarlo </p><p class="text-xs text-gray-500" data-v-97261e0d> Detectaremos las columnas automÃ¡ticamente </p></div>'),t(r.ssrRenderComponent(b,{onFileSelected:handleFileSelected,onFileRemoved:handleFileRemoved,onError:handleDropzoneError},null,p)),e.unref(l)&&!e.unref(o).detecting.value?(t('<div class="bg-green-50 border border-green-200 rounded-lg p-4 text-sm" data-v-97261e0d><div class="flex gap-3" data-v-97261e0d>'),t(r.ssrRenderComponent(e.unref(x),{class:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5","aria-hidden":"true"},null,p)),t(`<div class="flex-1" data-v-97261e0d><p class="font-semibold text-green-900 mb-1" data-v-97261e0d>Archivo seleccionado correctamente</p><p class="text-green-800" data-v-97261e0d>${r.ssrInterpolate(e.unref(l).name)}</p><p class="text-xs text-green-700 mt-1" data-v-97261e0d> Haz clic en &quot;Detectar columnas&quot; para continuar </p></div></div></div>`)):t("\x3c!----\x3e"),e.unref(o).detecting.value?t('<div class="bg-purple-50 border border-purple-200 rounded-lg p-6" data-v-97261e0d><div class="flex flex-col items-center justify-center gap-4" data-v-97261e0d><div class="animate-spin w-12 h-12 border-4 border-purple-600 border-t-transparent rounded-full" data-v-97261e0d></div><div class="text-center" data-v-97261e0d><p class="text-purple-900 font-medium mb-1" data-v-97261e0d>Analizando archivo...</p><p class="text-sm text-purple-700" data-v-97261e0d>Detectando columnas y sugiriendo mapeo</p></div></div></div>'):t("\x3c!----\x3e"),e.unref(o).error.value?(t('<div class="bg-red-50 border border-red-200 rounded-lg p-4 text-sm" data-v-97261e0d><div class="flex gap-3" data-v-97261e0d>'),t(r.ssrRenderComponent(e.unref(c),{class:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5","aria-hidden":"true"},null,p)),t(`<div data-v-97261e0d><p class="font-semibold text-red-900 mb-1" data-v-97261e0d>Error al procesar archivo</p><p class="text-red-800" data-v-97261e0d>${r.ssrInterpolate(e.unref(o).error.value)}</p></div></div></div>`)):t("\x3c!----\x3e"),t("</div>")):t("\x3c!----\x3e"),3===e.unref(n)?(t('<div class="space-y-6" data-v-97261e0d><div class="text-center mb-6" data-v-97261e0d>'),t(r.ssrRenderComponent(e.unref(render$4),{class:"w-16 h-16 mx-auto text-purple-600 mb-4","aria-hidden":"true"},null,p)),t('<h3 class="text-lg font-semibold text-cafe mb-2" data-v-97261e0d> Paso 3: Mapea las columnas </h3><p class="text-sm text-gray-600" data-v-97261e0d> Relaciona las columnas de tu archivo con los campos de TeraplÃ­ </p></div>'),t(r.ssrRenderComponent(m,{"detected-columns":e.unref(o).config.value?.detectedColumns||[],mappings:e.unref(o).mappings.value,validation:e.unref(o).validation.value,"onUpdate:mapping":handleMappingUpdate},null,p)),t("</div>")):t("\x3c!----\x3e"),4===e.unref(n)?(t('<div class="space-y-6" data-v-97261e0d><div class="text-center mb-6" data-v-97261e0d>'),t(r.ssrRenderComponent(e.unref(render$3),{class:"w-16 h-16 mx-auto text-purple-600 mb-4","aria-hidden":"true"},null,p)),t('<h3 class="text-lg font-semibold text-cafe mb-2" data-v-97261e0d> Paso 4: Confirma la importaciÃ³n </h3><p class="text-sm text-gray-600" data-v-97261e0d> Revisa el resumen antes de importar </p></div><div class="bg-gray-50 border border-gray-200 rounded-lg p-4" data-v-97261e0d><h4 class="font-semibold text-gray-900 mb-3" data-v-97261e0d>Campos que se importarÃ¡n:</h4><div class="flex flex-wrap gap-2" data-v-97261e0d>\x3c!--[--\x3e'),r.ssrRenderList(e.unref(o).mappings.value.filter(e=>e.targetField),a=>{t('<span class="inline-flex items-center gap-1 px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm" data-v-97261e0d>'),t(r.ssrRenderComponent(e.unref(x),{class:"w-4 h-4"},null,p)),t(` ${r.ssrInterpolate(getFieldLabel(a.targetField))}</span>`)}),t("\x3c!--]--\x3e</div></div>"),e.unref(o).validation.value?.warnings?.length?(t('<div class="bg-amber-50 border border-amber-200 rounded-lg p-4" data-v-97261e0d><div class="flex gap-3" data-v-97261e0d>'),t(r.ssrRenderComponent(e.unref(render$1),{class:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5","aria-hidden":"true"},null,p)),t('<div data-v-97261e0d><p class="font-semibold text-amber-900 mb-2" data-v-97261e0d>Advertencias:</p><ul class="text-sm text-amber-800 space-y-1" data-v-97261e0d>\x3c!--[--\x3e'),r.ssrRenderList(e.unref(o).validation.value.warnings,(e,a)=>{t(`<li data-v-97261e0d> â€¢ ${r.ssrInterpolate(e)}</li>`)}),t("\x3c!--]--\x3e</ul></div></div></div>")):t("\x3c!----\x3e"),t(`<div class="bg-blue-50 border border-blue-200 rounded-lg p-4" data-v-97261e0d><label class="flex items-start gap-3 cursor-pointer" data-v-97261e0d><input type="checkbox"${r.ssrIncludeBooleanAttr(Array.isArray(e.unref(i))?r.ssrLooseContain(e.unref(i),null):e.unref(i))?" checked":""} class="mt-1 w-5 h-5 text-purple-600 border-gray-300 rounded focus:ring-2 focus:ring-purple-300 cursor-pointer" data-v-97261e0d><div class="flex-1" data-v-97261e0d><p class="font-semibold text-blue-900 mb-1" data-v-97261e0d> Actualizar pacientes existentes </p><p class="text-sm text-blue-800" data-v-97261e0d> Si un paciente ya existe (mismo email o telÃ©fono), actualizar sus datos con la informaciÃ³n del archivo. </p><p class="text-xs text-blue-700 mt-1" data-v-97261e0d> Si no marcas esta opciÃ³n, los pacientes duplicados se omitirÃ¡n. </p></div></label></div>`),e.unref(o).getPreviewData().length>0?(t('<div class="space-y-3" data-v-97261e0d><h4 class="font-semibold text-gray-900" data-v-97261e0d>Vista previa de datos:</h4><div class="overflow-x-auto border border-gray-200 rounded-lg" data-v-97261e0d><table class="w-full text-sm" data-v-97261e0d><thead class="bg-gray-50" data-v-97261e0d><tr data-v-97261e0d>\x3c!--[--\x3e'),r.ssrRenderList(e.unref(o).mappings.value.filter(e=>e.targetField),e=>{t(`<th class="px-3 py-2 text-left font-medium text-gray-700 whitespace-nowrap" data-v-97261e0d>${r.ssrInterpolate(getFieldLabel(e.targetField))}</th>`)}),t('\x3c!--]--\x3e</tr></thead><tbody class="divide-y divide-gray-100" data-v-97261e0d>\x3c!--[--\x3e'),r.ssrRenderList(e.unref(o).getPreviewData(),(a,s)=>{t("<tr data-v-97261e0d>\x3c!--[--\x3e"),r.ssrRenderList(e.unref(o).mappings.value.filter(e=>e.targetField),e=>{t(`<td class="px-3 py-2 text-gray-600 whitespace-nowrap" data-v-97261e0d>${r.ssrInterpolate(a[e.targetField]||"â€”")}</td>`)}),t("\x3c!--]--\x3e</tr>")}),t('\x3c!--]--\x3e</tbody></table></div><p class="text-xs text-gray-500" data-v-97261e0d>Vista previa de las primeras filas</p></div>')):t("\x3c!----\x3e"),t("</div>")):t("\x3c!----\x3e"),5===e.unref(n)?(t('<div class="space-y-6" data-v-97261e0d><div class="text-center mb-6" data-v-97261e0d>'),e.unref(u)?t(r.ssrRenderComponent(e.unref(x),{class:"w-16 h-16 mx-auto text-green-600 mb-4","aria-hidden":"true"},null,p)):t(r.ssrRenderComponent(e.unref(render$1),{class:"w-16 h-16 mx-auto text-amber-600 mb-4","aria-hidden":"true"},null,p)),t(`<h3 class="text-lg font-semibold text-cafe mb-2" data-v-97261e0d>${r.ssrInterpolate(e.unref(u)?"ImportaciÃ³n completada con Ã©xito":"ImportaciÃ³n completada con advertencias")}</h3><p class="text-sm text-gray-600" data-v-97261e0d>${r.ssrInterpolate(e.unref(u)?"Los pacientes se han importado correctamente":"La importaciÃ³n se completÃ³ pero algunos pacientes tienen perfil incompleto")}</p></div>`),e.unref(o).importResult.value?t(`<div class="grid grid-cols-2 md:grid-cols-4 gap-4" data-v-97261e0d><div class="bg-gray-50 rounded-lg p-4 text-center" data-v-97261e0d><p class="text-2xl font-bold text-cafe" data-v-97261e0d>${r.ssrInterpolate(e.unref(o).importResult.value.total)}</p><p class="text-xs text-gray-600" data-v-97261e0d>Total</p></div><div class="bg-green-50 rounded-lg p-4 text-center" data-v-97261e0d><p class="text-2xl font-bold text-green-700" data-v-97261e0d>${r.ssrInterpolate(e.unref(o).importResult.value.created)}</p><p class="text-xs text-gray-600" data-v-97261e0d>Creados</p></div><div class="bg-blue-50 rounded-lg p-4 text-center" data-v-97261e0d><p class="text-2xl font-bold text-blue-700" data-v-97261e0d>${r.ssrInterpolate(e.unref(o).importResult.value.updated)}</p><p class="text-xs text-gray-600" data-v-97261e0d>Actualizados</p></div><div class="bg-gray-100 rounded-lg p-4 text-center" data-v-97261e0d><p class="text-2xl font-bold text-gray-700" data-v-97261e0d>${r.ssrInterpolate(e.unref(o).importResult.value.skipped)}</p><p class="text-xs text-gray-600" data-v-97261e0d>Omitidos</p></div></div>`):t("\x3c!----\x3e"),e.unref(u)?(t('<div class="bg-green-50 border border-green-200 rounded-lg p-4" data-v-97261e0d><div class="flex gap-3" data-v-97261e0d>'),t(r.ssrRenderComponent(e.unref(x),{class:"w-6 h-6 text-green-600 flex-shrink-0 mt-0.5","aria-hidden":"true"},null,p)),t('<div class="flex-1" data-v-97261e0d><p class="font-semibold text-green-900 mb-2" data-v-97261e0d>Â¡ImportaciÃ³n exitosa!</p><p class="text-sm text-green-800" data-v-97261e0d> Los pacientes se han aÃ±adido a tu lista y ya puedes gestionar sus citas y tratamientos. </p></div></div></div>')):t("\x3c!----\x3e"),e.unref(o).importResult.value?.incompleteProfiles?.length?(t('<div class="bg-amber-50 border border-amber-200 rounded-lg p-4" data-v-97261e0d><div class="flex gap-3" data-v-97261e0d>'),t(r.ssrRenderComponent(e.unref(render$1),{class:"w-6 h-6 text-amber-600 flex-shrink-0 mt-0.5","aria-hidden":"true"},null,p)),t(`<div class="flex-1" data-v-97261e0d><p class="font-semibold text-amber-900 mb-2" data-v-97261e0d>${r.ssrInterpolate(e.unref(o).importResult.value.incompleteProfiles.length)} paciente${r.ssrInterpolate(1!==e.unref(o).importResult.value.incompleteProfiles.length?"s":"")} con perfil incompleto </p><p class="text-sm text-amber-800 mb-3" data-v-97261e0d> Los siguientes pacientes fueron importados pero les faltan datos importantes: </p><div class="max-h-40 overflow-y-auto space-y-2" data-v-97261e0d>\x3c!--[--\x3e`),r.ssrRenderList(e.unref(o).importResult.value.incompleteProfiles.slice(0,5),e=>{t(`<div class="bg-white border border-amber-200 rounded p-2 text-sm" data-v-97261e0d><span class="font-medium text-amber-900" data-v-97261e0d>${r.ssrInterpolate(e.nombre_completo)}</span><span class="text-amber-700" data-v-97261e0d> â€” Faltan: ${r.ssrInterpolate(e.missingFields.join(", "))}</span></div>`)}),t("\x3c!--]--\x3e"),e.unref(o).importResult.value.incompleteProfiles.length>5?t(`<p class="text-xs text-amber-700 italic" data-v-97261e0d> ... y ${r.ssrInterpolate(e.unref(o).importResult.value.incompleteProfiles.length-5)} mÃ¡s </p>`):t("\x3c!----\x3e"),t('</div><p class="text-xs text-amber-700 mt-3" data-v-97261e0d> ğŸ’¡ Puedes completar esta informaciÃ³n editando cada paciente desde la lista. </p></div></div></div>')):t("\x3c!----\x3e"),e.unref(o).importResult.value?.errors?.length?(t('<div class="bg-red-50 border border-red-200 rounded-lg p-4" data-v-97261e0d><h4 class="font-semibold text-red-900 mb-3 flex items-center gap-2" data-v-97261e0d>'),t(r.ssrRenderComponent(e.unref(c),{class:"w-5 h-5","aria-hidden":"true"},null,p)),t(` Errores durante la importaciÃ³n (${r.ssrInterpolate(e.unref(o).importResult.value.errors.length)}) </h4><div class="max-h-40 overflow-y-auto space-y-2" data-v-97261e0d>\x3c!--[--\x3e`),r.ssrRenderList(e.unref(o).importResult.value.errors.slice(0,10),(e,a)=>{t(`<div class="bg-white border border-red-200 rounded p-2 text-sm text-red-800" data-v-97261e0d><span class="font-semibold" data-v-97261e0d>Fila ${r.ssrInterpolate(e.row)}:</span> ${r.ssrInterpolate(e.error)}</div>`)}),t("\x3c!--]--\x3e</div></div>")):t("\x3c!----\x3e"),t("</div>")):t("\x3c!----\x3e"),t('</div><div class="px-6 py-4 border-t border-gray-200 flex items-center justify-between bg-gray-50" data-v-97261e0d>'),e.unref(n)>1&&e.unref(n)<5?t(`<button${r.ssrIncludeBooleanAttr(e.unref(o).importing.value||e.unref(o).detecting.value)?" disabled":""} class="min-h-[44px] px-6 py-2.5 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-all font-medium disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-gray-300" data-v-97261e0d> AtrÃ¡s </button>`):t("<div data-v-97261e0d></div>"),t('<div class="flex gap-3" data-v-97261e0d>'),e.unref(n)<5?t(`<button${r.ssrIncludeBooleanAttr(e.unref(o).importing.value)?" disabled":""} class="min-h-[44px] px-6 py-2.5 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all font-medium disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-gray-300" data-v-97261e0d> Cancelar </button>`):t("\x3c!----\x3e"),1===e.unref(n)?t('<button class="min-h-[44px] px-6 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all font-medium shadow-sm hover:shadow-md focus:outline-none focus:ring-2 focus:ring-purple-300" data-v-97261e0d> Continuar </button>'):t("\x3c!----\x3e"),2===e.unref(n)?(t(`<button${r.ssrIncludeBooleanAttr(!e.unref(l)||e.unref(o).detecting.value)?" disabled":""} class="min-h-[44px] px-6 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all font-medium shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-purple-300 flex items-center gap-2" data-v-97261e0d>`),e.unref(o).detecting.value?t('<div class="animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full" data-v-97261e0d></div>'):t("\x3c!----\x3e"),t(`<span data-v-97261e0d>${r.ssrInterpolate(e.unref(o).detecting.value?"Analizando...":"Detectar columnas")}</span></button>`)):t("\x3c!----\x3e"),3===e.unref(n)?t(`<button${r.ssrIncludeBooleanAttr(!e.unref(o).validation.value?.isValid)?" disabled":""} class="min-h-[44px] px-6 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all font-medium shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-purple-300" data-v-97261e0d> Continuar </button>`):t("\x3c!----\x3e"),4===e.unref(n)?(t(`<button${r.ssrIncludeBooleanAttr(e.unref(o).importing.value)?" disabled":""} class="min-h-[44px] px-6 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all font-medium shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-purple-300 flex items-center gap-2" data-v-97261e0d>`),e.unref(o).importing.value?t('<div class="animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full" data-v-97261e0d></div>'):t("\x3c!----\x3e"),t(`<span data-v-97261e0d>${r.ssrInterpolate(e.unref(o).importing.value?"Importando...":"Importar pacientes")}</span></button>`)):t("\x3c!----\x3e"),5===e.unref(n)?t('<button class="min-h-[44px] px-6 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all font-medium shadow-sm hover:shadow-md focus:outline-none focus:ring-2 focus:ring-purple-300" data-v-97261e0d> Finalizar </button>'):t("\x3c!----\x3e"),t("</div></div></div></div>")):t("\x3c!----\x3e")},"body",!1,p)}}}),se=re.setup;re.setup=(a,t)=>{const r=e.useSSRContext();return(r.modules||(r.modules=new Set)).add("components/patients/PatientsImportModal.vue"),se?se(a,t):void 0};const oe=Object.assign(s(re,[["__scopeId","data-v-97261e0d"]]),{__name:"PatientsImportModal"}),ne=e.defineComponent({__name:"PatientsExportModal",__ssrInlineRender:!0,props:{modelValue:{type:Boolean},totalPatients:{},filteredCount:{},selectedCount:{default:0},hasFilters:{type:Boolean,default:!1},currentFilters:{default:()=>({})},selectedIds:{default:()=>[]}},emits:["update:modelValue"],setup(a,{emit:t}){const s=a,o=e.ref("csv"),n=e.ref("all"),l=e.ref(["nombre_completo","email","telefono","area_de_acompanamiento","frecuencia","activo"]),d=e.ref(!1),i=[{value:"nombre_completo",label:"Nombre Completo"},{value:"email",label:"Email"},{value:"telefono",label:"TelÃ©fono"},{value:"area_de_acompanamiento",label:"Ãrea"},{value:"frecuencia",label:"Frecuencia"},{value:"activo",label:"Estado"},{value:"ultima_sesion",label:"Ãšltima SesiÃ³n"},{value:"proxima_sesion",label:"PrÃ³xima SesiÃ³n"},{value:"total_sesiones",label:"Total Sesiones"},{value:"created_at",label:"Fecha de Registro"}];return e.watchEffect(()=>{s.selectedCount>0?n.value="selected":s.hasFilters?n.value="filtered":n.value="all"}),(t,s,c,u)=>{r.ssrRenderTeleport(s,t=>{a.modelValue?(t('<div class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50" role="dialog" aria-modal="true" aria-labelledby="export-modal-title" data-v-797ad56f><div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col" data-v-797ad56f><div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between" data-v-797ad56f><div data-v-797ad56f><h2 id="export-modal-title" class="text-2xl font-serif font-bold text-cafe" data-v-797ad56f> Exportar Pacientes </h2><p class="text-sm text-gray-500 mt-1" data-v-797ad56f> Selecciona las opciones de exportaciÃ³n </p></div><button class="min-h-[44px] min-w-[44px] p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-gray-300" aria-label="Cerrar modal" data-v-797ad56f>'),t(r.ssrRenderComponent(e.unref(h),{class:"w-6 h-6","aria-hidden":"true"},null,c)),t(`</button></div><div class="flex-1 overflow-y-auto p-6 space-y-6" data-v-797ad56f><div data-v-797ad56f><label class="block text-sm font-semibold text-cafe mb-3" data-v-797ad56f> Formato de archivo </label><div class="flex gap-3" data-v-797ad56f><button class="${r.ssrRenderClass(["csv"===e.unref(o)?"border-purple-600 bg-purple-50 text-purple-600":"border-gray-200 bg-white text-gray-600 hover:border-gray-300","min-h-[44px] flex-1 px-4 py-3 rounded-lg border-2 transition-all font-medium flex items-center justify-center gap-2"])}" data-v-797ad56f>`),t(r.ssrRenderComponent(e.unref(C),{class:"w-5 h-5","aria-hidden":"true"},null,c)),t(`<span data-v-797ad56f>CSV</span></button><button class="${r.ssrRenderClass(["xlsx"===e.unref(o)?"border-purple-600 bg-purple-50 text-purple-600":"border-gray-200 bg-white text-gray-600 hover:border-gray-300","min-h-[44px] flex-1 px-4 py-3 rounded-lg border-2 transition-all font-medium flex items-center justify-center gap-2"])}" data-v-797ad56f>`),t(r.ssrRenderComponent(e.unref(C),{class:"w-5 h-5","aria-hidden":"true"},null,c)),t(`<span data-v-797ad56f>XLSX</span></button></div></div><div data-v-797ad56f><label class="block text-sm font-semibold text-cafe mb-3" data-v-797ad56f> Â¿QuÃ© pacientes exportar? </label><div class="space-y-2" data-v-797ad56f><label class="${r.ssrRenderClass(["all"===e.unref(n)?"border-purple-600 bg-purple-50":"border-gray-200 bg-white hover:border-gray-300","flex items-center gap-3 p-3 border-2 rounded-lg cursor-pointer transition-all"])}" data-v-797ad56f><input type="radio"${r.ssrIncludeBooleanAttr(r.ssrLooseEqual(e.unref(n),"all"))?" checked":""} value="all" class="w-4 h-4 text-purple-600 border-gray-300 focus:ring-2 focus:ring-purple-300" data-v-797ad56f><div class="flex-1" data-v-797ad56f><p class="font-medium text-cafe" data-v-797ad56f>Todos los pacientes</p><p class="text-xs text-gray-600" data-v-797ad56f>Exportar todos los pacientes (${r.ssrInterpolate(a.totalPatients)})</p></div></label>`),a.hasFilters?t(`<label class="${r.ssrRenderClass(["filtered"===e.unref(n)?"border-purple-600 bg-purple-50":"border-gray-200 bg-white hover:border-gray-300","flex items-center gap-3 p-3 border-2 rounded-lg cursor-pointer transition-all"])}" data-v-797ad56f><input type="radio"${r.ssrIncludeBooleanAttr(r.ssrLooseEqual(e.unref(n),"filtered"))?" checked":""} value="filtered" class="w-4 h-4 text-purple-600 border-gray-300 focus:ring-2 focus:ring-purple-300" data-v-797ad56f><div class="flex-1" data-v-797ad56f><p class="font-medium text-cafe" data-v-797ad56f>Pacientes filtrados</p><p class="text-xs text-gray-600" data-v-797ad56f>Exportar solo los pacientes que cumplen los filtros actuales (${r.ssrInterpolate(a.filteredCount)})</p></div></label>`):t("\x3c!----\x3e"),a.selectedCount>0?t(`<label class="${r.ssrRenderClass(["selected"===e.unref(n)?"border-purple-600 bg-purple-50":"border-gray-200 bg-white hover:border-gray-300","flex items-center gap-3 p-3 border-2 rounded-lg cursor-pointer transition-all"])}" data-v-797ad56f><input type="radio"${r.ssrIncludeBooleanAttr(r.ssrLooseEqual(e.unref(n),"selected"))?" checked":""} value="selected" class="w-4 h-4 text-purple-600 border-gray-300 focus:ring-2 focus:ring-purple-300" data-v-797ad56f><div class="flex-1" data-v-797ad56f><p class="font-medium text-cafe" data-v-797ad56f>Pacientes seleccionados</p><p class="text-xs text-gray-600" data-v-797ad56f>Exportar solo los pacientes seleccionados (${r.ssrInterpolate(a.selectedCount)})</p></div></label>`):t("\x3c!----\x3e"),t('</div></div><div data-v-797ad56f><label class="block text-sm font-semibold text-cafe mb-3" data-v-797ad56f> Campos a exportar </label><div class="grid grid-cols-2 gap-2" data-v-797ad56f>\x3c!--[--\x3e'),r.ssrRenderList(i,a=>{t(`<label class="flex items-center gap-2 p-2 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors" data-v-797ad56f><input type="checkbox"${r.ssrIncludeBooleanAttr(Array.isArray(e.unref(l))?r.ssrLooseContain(e.unref(l),a.value):e.unref(l))?" checked":""}${r.ssrRenderAttr("value",a.value)} class="w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-2 focus:ring-purple-300" data-v-797ad56f><span class="text-sm text-cafe" data-v-797ad56f>${r.ssrInterpolate(a.label)}</span></label>`)}),t(`\x3c!--]--\x3e</div><button class="mt-2 text-xs text-purple-600 hover:text-purple-700 font-medium" data-v-797ad56f>${r.ssrInterpolate(e.unref(l).length===i.length?"Deseleccionar todos":"Seleccionar todos")}</button></div></div><div class="px-6 py-4 border-t border-gray-200 flex items-center justify-between bg-gray-50" data-v-797ad56f><button${r.ssrIncludeBooleanAttr(e.unref(d))?" disabled":""} class="min-h-[44px] px-6 py-2.5 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all font-medium disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-gray-300" data-v-797ad56f> Cancelar </button><button${r.ssrIncludeBooleanAttr(e.unref(d)||0===e.unref(l).length)?" disabled":""} class="min-h-[44px] px-6 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all font-medium shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-purple-300 flex items-center gap-2" data-v-797ad56f>`),e.unref(d)?t("\x3c!----\x3e"):t(r.ssrRenderComponent(e.unref(w),{class:"w-5 h-5","aria-hidden":"true"},null,c)),e.unref(d)?t("<span data-v-797ad56f>Exportando...</span>"):t("<span data-v-797ad56f>Exportar</span>"),t("</button></div></div></div>")):t("\x3c!----\x3e")},"body",!1,c)}}}),le=ne.setup;ne.setup=(a,t)=>{const r=e.useSSRContext();return(r.modules||(r.modules=new Set)).add("components/patients/PatientsExportModal.vue"),le?le(a,t):void 0};const de=Object.assign(s(ne,[["__scopeId","data-v-797ad56f"]]),{__name:"PatientsExportModal"}),ie={__name:"pacientes",__ssrInlineRender:!0,setup(s){const o=a(),n=f(),{getUserId:l}=v();t();const d=useToast(),i=e.ref(!1),u=e.ref(!1),b=e.ref(!1),m=e.ref(!1),x=e.ref(!1),g=e.ref(!1),_=e.ref(!1),C=e.ref(null),S=e.ref(null),F=e.ref(null),B=e.ref([]),j=e.ref(!0),L=e.ref(""),M=e.ref(""),T=e.ref("todos"),z=e.ref(""),N=e.ref(!1),O=e.ref({sinProximaCita:!1,sinSesionRegistrada:!1,requiereAtencion:!1}),G=[{valor:"todos",label:"Todos"},{valor:"activo",label:"Activos"},{valor:"pausa",label:"En pausa"},{valor:"finalizado",label:"Finalizados"}],Q=e.computed(()=>({activos:B.value.filter(e=>e.activo&&!e.en_pausa).length,enPausa:B.value.filter(e=>e.activo&&e.en_pausa).length,finalizados:B.value.filter(e=>!e.activo).length})),X=e.computed(()=>G.map(e=>{let a=0;return"todos"===e.valor?a=B.value.length:"activo"===e.valor?a=Q.value.activos:"pausa"===e.valor?a=Q.value.enPausa:"finalizado"===e.valor&&(a=Q.value.finalizados),{...e,count:a}})),Y=e.computed(()=>{const e=X.value.find(e=>e.valor===T.value);return e?.count||0}),J=e.computed(()=>{const e=new Set(B.value.map(e=>e.area_de_acompanamiento).filter(Boolean));return Array.from(e).sort()}),K=e.computed(()=>""!==z.value||O.value.sinProximaCita||O.value.sinSesionRegistrada||O.value.requiereAtencion),W=e.computed(()=>{let e=0;return z.value&&e++,O.value.sinProximaCita&&e++,O.value.sinSesionRegistrada&&e++,O.value.requiereAtencion&&e++,e}),ee=e.computed(()=>K.value||L.value||"todos"!==T.value),cargarPacientes=async()=>{j.value=!0;try{const e=l();if(!e)return void(j.value=!1);const{data:a,error:t}=await n.from("pacientes").select("\n        id,\n        created_at,\n        activo,\n        email,\n        nombre_completo,\n        telefono,\n        area_de_acompanamiento,\n        frecuencia,\n        metadata\n      ").eq("terapeuta_id",e).order("created_at",{ascending:!1});if(t)throw t;const r=await Promise.all(a.map(async e=>{const{data:a}=await n.from("citas").select("fecha_cita").eq("paciente_id",e.id).eq("estado","realizada").order("fecha_cita",{ascending:!1}).limit(1).maybeSingle(),{data:t}=await n.from("citas").select("id, fecha_cita, hora_inicio").eq("paciente_id",e.id).in("estado",["pendiente","confirmada"]).gte("fecha_cita",(new Date).toISOString().split("T")[0]).order("fecha_cita",{ascending:!0}).order("hora_inicio",{ascending:!0}).limit(1).maybeSingle(),{count:r}=await n.from("citas").select("*",{count:"exact",head:!0}).eq("paciente_id",e.id).eq("estado","realizada");let s=null;try{const{data:a}=await n.from("bonos").select("id, tipo, estado, sesiones_totales, sesiones_restantes, fecha_fin, created_at").eq("paciente_id",e.id).in("estado",["activo","pendiente"]).order("created_at",{ascending:!1}).limit(1).maybeSingle();s=a}catch(e){console.warn("[Bonos] Error:",e)}let o=0,l=0;s&&(l=s.sesiones_totales,o=l-s.sesiones_restantes);const d=new Date;d.setDate(d.getDate()-7);const{data:i}=await n.from("metricas_bienestar").select("estado_animo, nivel_energia, nivel_estres").eq("paciente_id",e.id).gte("fecha",d.toISOString());let c=3,u=!1,p=50;if(i&&i.length>0){const e=i.reduce((e,a)=>e+a.estado_animo,0)/i.length;c=e,p=Math.round(e/10*100);const a=i.slice(-3);a.length>=3&&(u=a.every(e=>e.estado_animo<=4))}const v=e.nombre_completo||e.metadata?.nombre_completo||e.email;return{id:e.id,nombre:v,email:e.email,telefono:e.telefono,activo:e.activo,en_pausa:e.metadata?.en_pausa||!1,area_de_acompanamiento:e.area_de_acompanamiento,frecuencia:e.frecuencia,ultima_sesion:a?.fecha_cita||null,proxima_sesion:t?`${t.fecha_cita}T${t.hora_inicio}`:null,proxima_cita_id:t?.id||null,total_sesiones:r||0,estado_emocional_promedio:c,evolucion_porcentaje:p,requiere_atencion:u,created_at:e.created_at,bono_activo:s?{tipo:s.tipo,estado:s.estado,fecha_fin:s.fecha_fin,sesiones_completadas:o,sesiones_totales:l,sesiones_restantes:s.sesiones_restantes}:null}}));B.value=r}catch(e){console.error("Error al cargar pacientes:",e),d.error("Error al cargar los pacientes")}finally{j.value=!1}},ae=e.computed(()=>{let e=B.value;if(L.value){const a=L.value.toLowerCase();e=e.filter(e=>{const t=(e.nombre||"").toLowerCase(),r=(e.email||"").toLowerCase(),s=(e.telefono||"").toLowerCase();return t.includes(a)||r.includes(a)||s.includes(a)})}return"todos"!==T.value&&(e=e.filter(e=>"activo"===T.value?e.activo&&!e.en_pausa:"pausa"===T.value?e.activo&&e.en_pausa:"finalizado"!==T.value||!e.activo)),z.value&&(e=e.filter(e=>e.area_de_acompanamiento===z.value)),O.value.sinProximaCita&&(e=e.filter(e=>!e.proxima_sesion)),O.value.sinSesionRegistrada&&(e=e.filter(e=>!e.ultima_sesion)),O.value.requiereAtencion&&(e=e.filter(e=>e.requiere_atencion)),e}),te=e.computed(()=>B.value.length),cerrarModalNuevo=()=>{i.value=!1},abrirModalEditar=e=>{S.value=e,u.value=!0},cerrarModalEditar=()=>{u.value=!1,S.value=null},abrirModalEliminar=e=>{S.value=e,b.value=!0},cerrarModalEliminar=()=>{b.value=!1,S.value=null},manejarPacienteCreado=async()=>{await cargarPacientes(),d.success("Paciente creado")},manejarPacienteActualizado=async()=>{await cargarPacientes(),d.success("Paciente actualizado")},manejarPacienteEliminado=async e=>{B.value=B.value.filter(a=>a.id!==e),d.success("Paciente eliminado")},manejarPacienteDesactivado=async()=>{await cargarPacientes(),d.success("Paciente desactivado")},cerrarModalAsignarCita=()=>{m.value=!1,F.value=null},manejarCitaCreada=async()=>{await cargarPacientes(),cerrarModalAsignarCita(),d.success("Cita asignada")},verCitasPaciente=e=>{o.push(`/agenda?paciente=${e.id}`)},gestionarBonosPaciente=e=>{o.push(`/terapeuta/pacientes/${e.id}/bonos`)},handleImportComplete=async()=>{await cargarPacientes(),d.success("ImportaciÃ³n completada")},re=e.computed(()=>{const e={};return"todos"!==T.value&&(e.estado=T.value),z.value&&(e.area=z.value),e}),abrirModalEditarCita=e=>{C.value=e,x.value=!0},cerrarModalEditarCita=()=>{x.value=!1,C.value=null},handleCitaActualizada=async()=>{await cargarPacientes(),cerrarModalEditarCita(),d.success("Cita actualizada")};return e.watch(()=>l(),e=>{e&&0===B.value.length&&cargarPacientes()}),(a,t,s,o)=>{const n=P,l=p,d=q,v=V,f=H,G=U,Q=Z,se=oe,ne=de;t(`<div${r.ssrRenderAttrs(o)}><header class="mb-6"><div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-5"><div><h1 class="text-2xl font-semibold text-gray-900"> Pacientes <span class="text-gray-400 font-normal">(${r.ssrInterpolate(e.unref(Y))})</span></h1></div><div class="flex items-center gap-2"><button class="min-h-[40px] px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors flex items-center gap-1.5 text-sm font-medium" aria-label="Importar pacientes">`),t(r.ssrRenderComponent(e.unref(y),{class:"w-4 h-4","aria-hidden":"true"},null,s)),t('<span class="hidden sm:inline">Importar</span></button><button class="min-h-[40px] px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors flex items-center gap-1.5 text-sm font-medium" aria-label="Exportar pacientes">'),t(r.ssrRenderComponent(e.unref(w),{class:"w-4 h-4","aria-hidden":"true"},null,s)),t('<span class="hidden sm:inline">Exportar</span></button><button class="min-h-[40px] px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center gap-2 text-sm font-medium shadow-sm" aria-label="AÃ±adir nuevo paciente">'),t(r.ssrRenderComponent(e.unref($),{class:"w-4 h-4","aria-hidden":"true"},null,s)),t(`<span>Nuevo</span></button></div></div><div class="space-y-4"><div class="relative"><input${r.ssrRenderAttr("value",e.unref(M))} type="text" placeholder="Buscar por nombre, email o telÃ©fono..." class="w-full h-11 px-4 pl-10 bg-white border border-gray-200 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition-all text-sm placeholder-gray-400" aria-label="Buscar pacientes">`),t(r.ssrRenderComponent(e.unref(I),{class:"w-4 h-4 absolute left-3.5 top-1/2 -translate-y-1/2 text-gray-400","aria-hidden":"true"},null,s)),e.unref(L)?(t('<button class="absolute right-3 top-1/2 -translate-y-1/2 p-1 text-gray-400 hover:text-gray-600 rounded" aria-label="Limpiar bÃºsqueda">'),t(r.ssrRenderComponent(e.unref(h),{class:"w-4 h-4"},null,s)),t("</button>")):t("\x3c!----\x3e"),t('</div><div class="flex items-center justify-between border-b border-gray-100"><nav class="flex gap-1 -mb-px" role="tablist">\x3c!--[--\x3e'),r.ssrRenderList(e.unref(X),a=>{t(`<button class="${r.ssrRenderClass([e.unref(T)===a.valor?"text-purple-600":"text-gray-500 hover:text-gray-700","px-4 py-2.5 text-sm font-medium transition-colors relative"])}"${r.ssrRenderAttr("aria-selected",e.unref(T)===a.valor)} role="tab"><span>${r.ssrInterpolate(a.label)}</span><span class="${r.ssrRenderClass([e.unref(T)===a.valor?"text-purple-500":"text-gray-400","ml-1.5 text-xs"])}">${r.ssrInterpolate(a.count)}</span>`),e.unref(T)===a.valor?t('<span class="absolute bottom-0 left-0 right-0 h-0.5 bg-purple-600 rounded-full"></span>'):t("\x3c!----\x3e"),t("</button>")}),t(`\x3c!--]--\x3e</nav><button class="${r.ssrRenderClass([e.unref(K)?"text-purple-600 bg-purple-50":"text-gray-500 hover:text-gray-700 hover:bg-gray-50","flex items-center gap-1.5 px-3 py-2 text-sm font-medium rounded-lg transition-colors"])}">`),t(r.ssrRenderComponent(e.unref(R),{class:"w-4 h-4"},null,s)),t('<span class="hidden sm:inline">Filtros</span>'),e.unref(W)>0?t(`<span class="w-5 h-5 flex items-center justify-center text-xs font-semibold bg-purple-600 text-white rounded-full">${r.ssrInterpolate(e.unref(W))}</span>`):t("\x3c!----\x3e"),t(r.ssrRenderComponent(e.unref(k),{class:["w-4 h-4 transition-transform",{"rotate-180":e.unref(N)}]},null,s)),t("</button></div>"),e.unref(N)?(t(`<div class="bg-gray-50 rounded-lg p-4"><div class="flex flex-wrap items-center gap-3"><select class="h-9 px-3 bg-white border border-gray-200 rounded-lg text-sm text-gray-700 focus:border-purple-500 focus:ring-1 focus:ring-purple-500/20" aria-label="Filtrar por Ã¡rea"><option value=""${r.ssrIncludeBooleanAttr(Array.isArray(e.unref(z))?r.ssrLooseContain(e.unref(z),""):r.ssrLooseEqual(e.unref(z),""))?" selected":""}>Todas las Ã¡reas</option>\x3c!--[--\x3e`),r.ssrRenderList(e.unref(J),a=>{t(`<option${r.ssrRenderAttr("value",a)}${r.ssrIncludeBooleanAttr(Array.isArray(e.unref(z))?r.ssrLooseContain(e.unref(z),a):r.ssrLooseEqual(e.unref(z),a))?" selected":""}>${r.ssrInterpolate(a)}</option>`)}),t(`\x3c!--]--\x3e</select><button class="${r.ssrRenderClass([e.unref(O).sinProximaCita?"bg-orange-100 text-orange-700 border border-orange-200":"bg-white text-gray-600 border border-gray-200 hover:border-gray-300","h-9 px-3 rounded-lg text-sm font-medium transition-all flex items-center gap-1.5"])}">`),t(r.ssrRenderComponent(e.unref(A),{class:"w-4 h-4"},null,s)),t(` Sin prÃ³xima cita </button><button class="${r.ssrRenderClass([e.unref(O).sinSesionRegistrada?"bg-amber-100 text-amber-700 border border-amber-200":"bg-white text-gray-600 border border-gray-200 hover:border-gray-300","h-9 px-3 rounded-lg text-sm font-medium transition-all flex items-center gap-1.5"])}">`),t(r.ssrRenderComponent(e.unref(D),{class:"w-4 h-4"},null,s)),t(` Sin sesiÃ³n </button><button class="${r.ssrRenderClass([e.unref(O).requiereAtencion?"bg-red-100 text-red-700 border border-red-200":"bg-white text-gray-600 border border-gray-200 hover:border-gray-300","h-9 px-3 rounded-lg text-sm font-medium transition-all flex items-center gap-1.5"])}">`),t(r.ssrRenderComponent(e.unref(c),{class:"w-4 h-4"},null,s)),t(" Requiere atenciÃ³n </button>"),e.unref(K)?t('<button class="h-9 px-3 text-sm text-gray-500 hover:text-gray-700 transition-colors"> Limpiar </button>'):t("\x3c!----\x3e"),t("</div></div>")):t("\x3c!----\x3e"),t("</div></header><section>"),e.unref(j)?t('<div class="flex flex-col items-center justify-center py-20" role="status"><div class="w-8 h-8 border-2 border-purple-600 border-t-transparent rounded-full animate-spin mb-4"></div><p class="text-sm text-gray-500">Cargando pacientes...</p></div>'):0===e.unref(ae).length?(t('<div class="flex flex-col items-center justify-center py-20 text-center"><div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4">'),t(r.ssrRenderComponent(e.unref(E),{class:"w-8 h-8 text-gray-400"},null,s)),t(`</div><h3 class="text-lg font-medium text-gray-900 mb-1">${r.ssrInterpolate(e.unref(ee)?"Sin resultados":"Sin pacientes")}</h3><p class="text-sm text-gray-500 mb-4 max-w-sm">${r.ssrInterpolate(e.unref(ee)?"Prueba ajustando los filtros de bÃºsqueda":"Comienza aÃ±adiendo tu primer paciente")}</p>`),e.unref(ee)?t('<button class="px-4 py-2 text-gray-600 text-sm font-medium hover:text-gray-900 transition-colors"> Limpiar filtros </button>'):t('<button class="px-4 py-2 bg-purple-600 text-white text-sm font-medium rounded-lg hover:bg-purple-700 transition-colors"> AÃ±adir paciente </button>'),t("</div>")):(t('<div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-4" role="list">\x3c!--[--\x3e'),r.ssrRenderList(e.unref(ae),a=>{t('<div class="relative group" role="listitem">'),t(r.ssrRenderComponent(n,{paciente:a,onEditar:abrirModalEditar,onEliminar:abrirModalEliminar,onVerCitas:verCitasPaciente,onGestionarBonos:gestionarBonosPaciente,onEditarCita:abrirModalEditarCita},null,s)),a.activo&&!a.en_pausa?(t(`<button class="absolute bottom-4 right-4 h-9 px-3 bg-purple-600 text-white text-sm font-medium rounded-lg shadow-md hover:bg-purple-700 transition-all flex items-center gap-1.5 opacity-0 group-hover:opacity-100 pointer-events-none group-hover:pointer-events-auto z-10"${r.ssrRenderAttr("aria-label",`Asignar cita a ${a.nombre}`)}>`),t(r.ssrRenderComponent(e.unref(A),{class:"w-4 h-4"},null,s)),t('<span class="hidden sm:inline">Cita</span></button>')):t("\x3c!----\x3e"),t("</div>")}),t("\x3c!--]--\x3e</div>")),e.unref(ae).length>0?t(`<footer class="mt-6 pt-4 border-t border-gray-100 flex items-center justify-between text-sm text-gray-500"><span>${r.ssrInterpolate(e.unref(ae).length===e.unref(te)?`${e.unref(te)} pacientes`:`${e.unref(ae).length} de ${e.unref(te)} pacientes`)}</span></footer>`):t("\x3c!----\x3e"),t("</section>"),t(r.ssrRenderComponent(l,{mostrar:e.unref(m),"paciente-preseleccionado":e.unref(F),onCerrar:cerrarModalAsignarCita,onCitaCreada:manejarCitaCreada},null,s)),t(r.ssrRenderComponent(d,{mostrar:e.unref(i),onCerrar:cerrarModalNuevo,onPacienteCreado:manejarPacienteCreado},null,s)),t(r.ssrRenderComponent(v,{mostrar:e.unref(u),paciente:e.unref(S),onCerrar:cerrarModalEditar,onPacienteActualizado:manejarPacienteActualizado},null,s)),t(r.ssrRenderComponent(f,{mostrar:e.unref(b),paciente:e.unref(S),onCerrar:cerrarModalEliminar,onPacienteEliminado:manejarPacienteEliminado,onPacienteDesactivado:manejarPacienteDesactivado},null,s)),t(r.ssrRenderComponent(G,{isOpen:e.unref(x),citaId:e.unref(C),onClose:cerrarModalEditarCita,onActualizado:handleCitaActualizada},null,s)),t(r.ssrRenderComponent(Q,null,null,s)),t(r.ssrRenderComponent(se,{modelValue:e.unref(g),"onUpdate:modelValue":a=>e.isRef(g)?g.value=a:null,"existing-patients":e.unref(B),onImportComplete:handleImportComplete},null,s)),t(r.ssrRenderComponent(ne,{modelValue:e.unref(_),"onUpdate:modelValue":a=>e.isRef(_)?_.value=a:null,"total-patients":e.unref(te),"filtered-count":e.unref(ae).length,"has-filters":e.unref(K)||"todos"!==e.unref(T)||""!==e.unref(L),"current-filters":e.unref(re)},null,s)),t("</div>")}}},ce=ie.setup;ie.setup=(a,t)=>{const r=e.useSSRContext();return(r.modules||(r.modules=new Set)).add("pages/terapeuta/pacientes.vue"),ce?ce(a,t):void 0};export{ie as default};
//# sourceMappingURL=pacientes-BhBdLDwY.mjs.map
