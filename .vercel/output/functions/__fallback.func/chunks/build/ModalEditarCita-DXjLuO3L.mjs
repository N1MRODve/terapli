import{v as a,s as e}from"./server.mjs";import{u as r}from"./useCitas-DyEZH6RI.mjs";import{u as t}from"./useSupabaseClient-DykwVqLQ.mjs";import{_ as d}from"./_plugin-vue_export-helper-1tPrXgE0.mjs";const o=a.defineComponent({__name:"ModalEditarCita",__ssrInlineRender:!0,props:{isOpen:{type:Boolean},citaId:{}},emits:["close","actualizado"],setup(d,{emit:o}){const l=d,s=t(),{getCitasPorDia:i}=r(),n=a.ref(null),c=a.ref(!1),u=a.ref(!1),v=a.ref(!1),p=a.ref({fecha_cita:"",hora_inicio:"",hora_fin:"",duracion:60,modalidad:"presencial",estado:"pendiente",observaciones:""}),g=a.computed(()=>{if(!p.value.fecha_cita)return"";return new Date(p.value.fecha_cita+"T00:00:00").toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}),b=a.computed(()=>{const a=new Date,e=[],formatearFecha=a=>a.toISOString().split("T")[0];e.push({label:"Hoy",fecha:formatearFecha(a)});const r=new Date(a);r.setDate(r.getDate()+1),e.push({label:"MaÃ±ana",fecha:formatearFecha(r)});const t=["Lun","Mar","MiÃ©","Jue","Vie"];let d=new Date(a),o=0;for(;o<5;){d.setDate(d.getDate()+1);const a=d.getDay();a>=1&&a<=5&&(e.push({label:`${t[a-1]} ${d.getDate()}`,fecha:formatearFecha(d)}),o++)}return e}),f=["08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00","18:30","19:00","19:30","20:00","20:30","21:00","21:30","22:00"],cargarCita=async()=>{if(console.log("ğŸ” [ModalEditarCita] Cargando cita con ID:",l.citaId),l.citaId)try{c.value=!0;const{data:a,error:e}=await s.from("citas").select("\n        *,\n        paciente:pacientes!citas_paciente_id_fkey (\n          id,\n          nombre_completo,\n          email,\n          telefono\n        )\n      ").eq("id",l.citaId).single();if(e)throw console.error("âŒ [ModalEditarCita] Error en query:",e),e;console.log("âœ… [ModalEditarCita] Cita cargada:",a),a&&(n.value=a,p.value={fecha_cita:a.fecha_cita,hora_inicio:a.hora_inicio?.substring(0,5)||"",hora_fin:a.hora_fin?.substring(0,5)||"",duracion:a.duracion||60,modalidad:a.modalidad||"presencial",estado:a.estado||"pendiente",observaciones:a.observaciones||""},console.log("ğŸ“ [ModalEditarCita] Formulario llenado:",p.value))}catch(a){console.error("ğŸ’¥ [ModalEditarCita] Error al cargar cita:",a)}finally{c.value=!1}else console.warn("âš ï¸ [ModalEditarCita] No hay citaId proporcionado")},horaAMinutos=a=>{if(!a||!a.includes(":"))return 0;const[e,r]=a.split(":").map(Number);return 60*(e||0)+(r||0)};return a.watch(()=>p.value.hora_inicio,a=>{if(a&&p.value.duracion){const[e,r]=a.split(":").map(Number),t=60*(e||0)+(r||0)+p.value.duracion,d=Math.floor(t/60),o=t%60;p.value.hora_fin=`${String(d).padStart(2,"0")}:${String(o).padStart(2,"0")}`}}),a.watch(()=>p.value.duracion,a=>{if(p.value.hora_inicio&&a){const[e,r]=p.value.hora_inicio.split(":").map(Number),t=60*(e||0)+(r||0)+a,d=Math.floor(t/60),o=t%60;p.value.hora_fin=`${String(d).padStart(2,"0")}:${String(o).padStart(2,"0")}`}}),a.watch([()=>p.value.fecha_cita,()=>p.value.hora_inicio,()=>p.value.hora_fin],()=>{(async()=>{if(p.value.fecha_cita&&p.value.hora_inicio&&p.value.hora_fin)try{const a=(await i(p.value.fecha_cita)).filter(a=>"cancelada"!==a.estado&&a.id!==l.citaId),e=p.value.hora_inicio,r=p.value.hora_fin;v.value=a.some(a=>{const t=a.hora_inicio?.substring(0,5),d=a.hora_fin?.substring(0,5),o=horaAMinutos(e),l=horaAMinutos(r),s=horaAMinutos(t),i=horaAMinutos(d);return o>=s&&o<i||l>s&&l<=i||o<=s&&l>=i})}catch(a){console.error("Error al verificar conflicto:",a),v.value=!1}else v.value=!1})()}),a.watch(()=>l.isOpen,a=>{console.log("ğŸ‘ï¸ [ModalEditarCita] Modal abierto:",a,"citaId:",l.citaId),a&&l.citaId&&cargarCita()}),a.watch(()=>l.citaId,a=>{console.log("ğŸ”„ [ModalEditarCita] citaId cambiÃ³ a:",a),l.isOpen&&a&&cargarCita()}),(a,r,t,o)=>{e.ssrRenderTeleport(r,a=>{d.isOpen?(a('<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" data-v-90d0f873><div class="bg-white dark:bg-gray-900 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden" data-v-90d0f873><div class="px-6 py-4 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20" data-v-90d0f873><div data-v-90d0f873><h2 class="text-2xl font-bold text-gray-900 dark:text-white" data-v-90d0f873>âœï¸ Editar Cita</h2>'),n.value?a(`<p class="text-sm text-gray-600 dark:text-gray-400 mt-1" data-v-90d0f873>${e.ssrInterpolate(n.value.paciente?.nombre_completo||n.value.paciente_nombre)}</p>`):a("\x3c!----\x3e"),a('</div><button class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors" aria-label="Cerrar" data-v-90d0f873><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-90d0f873><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" data-v-90d0f873></path></svg></button></div>'),c.value?a('<div class="p-12 flex flex-col items-center justify-center" data-v-90d0f873><div class="w-12 h-12 border-4 border-purple-200 border-t-purple-600 rounded-full animate-spin mb-4" data-v-90d0f873></div><p class="text-gray-600 dark:text-gray-400" data-v-90d0f873>Cargando...</p></div>'):n.value?(a(`<form class="px-6 py-4 overflow-y-auto max-h-[calc(90vh-200px)]" data-v-90d0f873><div class="space-y-6" data-v-90d0f873><div data-v-90d0f873><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" data-v-90d0f873> ğŸ“… Fecha </label><div class="space-y-2" data-v-90d0f873><input${e.ssrRenderAttr("value",p.value.fecha_cita)} type="date" required class="w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-800 dark:text-white cursor-pointer" data-v-90d0f873><div class="flex gap-2 flex-wrap" data-v-90d0f873>\x3c!--[--\x3e`),e.ssrRenderList(b.value,(r,t)=>{a(`<button type="button" class="${e.ssrRenderClass(["text-xs px-3 py-1.5 rounded-lg border transition-all",p.value.fecha_cita===r.fecha?"bg-purple-600 text-white border-purple-600 font-semibold":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 border-gray-300 dark:border-gray-600 hover:border-purple-500 hover:bg-purple-50 dark:hover:bg-purple-900/20"])}" data-v-90d0f873>${e.ssrInterpolate(r.label)}</button>`)}),a(`\x3c!--]--\x3e</div><p class="text-xs text-gray-500 dark:text-gray-400 capitalize" data-v-90d0f873>${e.ssrInterpolate(g.value)}</p></div></div><div class="grid grid-cols-1 md:grid-cols-3 gap-4" data-v-90d0f873><div class="md:col-span-2" data-v-90d0f873><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" data-v-90d0f873> ğŸ• Hora Inicio </label><div class="space-y-3" data-v-90d0f873><div class="grid grid-cols-4 sm:grid-cols-6 gap-2 max-h-48 overflow-y-auto p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg border border-gray-200 dark:border-gray-700" data-v-90d0f873>\x3c!--[--\x3e`),e.ssrRenderList(f,r=>{a(`<button type="button" class="${e.ssrRenderClass(["px-3 py-2 text-sm font-medium rounded-lg transition-all border-2",p.value.hora_inicio===r?"bg-purple-600 text-white border-purple-600 shadow-md transform scale-105":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 border-gray-200 dark:border-gray-600 hover:border-purple-500 hover:bg-purple-50 dark:hover:bg-purple-900/20 hover:shadow"])}" data-v-90d0f873>${e.ssrInterpolate(r)}</button>`)}),a(`\x3c!--]--\x3e</div><details class="text-xs" data-v-90d0f873><summary class="cursor-pointer text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 select-none flex items-center gap-1" data-v-90d0f873><span data-v-90d0f873>âŒ¨ï¸</span><span data-v-90d0f873>Ingresar hora manualmente</span></summary><div class="mt-2" data-v-90d0f873><input${e.ssrRenderAttr("value",p.value.hora_inicio)} type="time" required step="1800" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-800 dark:text-white" data-v-90d0f873></div></details></div></div><div data-v-90d0f873><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" data-v-90d0f873> â±ï¸ DuraciÃ³n (min) </label><select class="w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-800 dark:text-white" data-v-90d0f873><option${e.ssrRenderAttr("value",30)} data-v-90d0f873${e.ssrIncludeBooleanAttr(Array.isArray(p.value.duracion)?e.ssrLooseContain(p.value.duracion,30):e.ssrLooseEqual(p.value.duracion,30))?" selected":""}>30 min</option><option${e.ssrRenderAttr("value",45)} data-v-90d0f873${e.ssrIncludeBooleanAttr(Array.isArray(p.value.duracion)?e.ssrLooseContain(p.value.duracion,45):e.ssrLooseEqual(p.value.duracion,45))?" selected":""}>45 min</option><option${e.ssrRenderAttr("value",60)} data-v-90d0f873${e.ssrIncludeBooleanAttr(Array.isArray(p.value.duracion)?e.ssrLooseContain(p.value.duracion,60):e.ssrLooseEqual(p.value.duracion,60))?" selected":""}>60 min</option><option${e.ssrRenderAttr("value",90)} data-v-90d0f873${e.ssrIncludeBooleanAttr(Array.isArray(p.value.duracion)?e.ssrLooseContain(p.value.duracion,90):e.ssrLooseEqual(p.value.duracion,90))?" selected":""}>90 min</option></select></div><div data-v-90d0f873><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" data-v-90d0f873> ğŸ•‘ Hora Fin </label><input${e.ssrRenderAttr("value",p.value.hora_fin)} type="time" required readonly step="1800" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-800 dark:text-white" data-v-90d0f873></div></div>`),v.value?a('<div class="p-4 bg-yellow-50 dark:bg-yellow-900/20 border-2 border-yellow-300 dark:border-yellow-700 rounded-lg" data-v-90d0f873><div class="flex items-start gap-3" data-v-90d0f873><span class="text-2xl" data-v-90d0f873>âš ï¸</span><div data-v-90d0f873><div class="font-semibold text-yellow-800 dark:text-yellow-300 mb-1" data-v-90d0f873> Conflicto de Horario </div><div class="text-sm text-yellow-700 dark:text-yellow-400" data-v-90d0f873> Ya existe otra cita en este horario. Por favor, selecciona otro horario. </div></div></div></div>'):a("\x3c!----\x3e"),a('<div data-v-90d0f873><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" data-v-90d0f873> ğŸ’» Modalidad </label><div class="grid grid-cols-3 gap-3" data-v-90d0f873>\x3c!--[--\x3e'),e.ssrRenderList([{valor:"presencial",icono:"ğŸ¥",nombre:"Presencial"},{valor:"online",icono:"ğŸ’»",nombre:"Online"},{valor:"telefonica",icono:"ğŸ“",nombre:"TelÃ©fono"}],r=>{a(`<button type="button" class="${e.ssrRenderClass(["p-3 border-2 rounded-lg transition-all",p.value.modalidad===r.valor?"border-purple-600 bg-purple-50 dark:bg-purple-900/20":"border-gray-300 dark:border-gray-700 hover:border-purple-400"])}" data-v-90d0f873><div class="text-2xl mb-1" data-v-90d0f873>${e.ssrInterpolate(r.icono)}</div><div class="text-sm font-medium text-gray-900 dark:text-white" data-v-90d0f873>${e.ssrInterpolate(r.nombre)}</div></button>`)}),a('\x3c!--]--\x3e</div></div><div data-v-90d0f873><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" data-v-90d0f873> ğŸ“Š Estado </label><div class="grid grid-cols-2 md:grid-cols-4 gap-3" data-v-90d0f873>\x3c!--[--\x3e'),e.ssrRenderList([{valor:"pendiente",icono:"â³",nombre:"Pendiente"},{valor:"confirmada",icono:"âœ…",nombre:"Confirmada"},{valor:"realizada",icono:"âœ“",nombre:"Realizada"},{valor:"cancelada",icono:"âŒ",nombre:"Cancelada"}],r=>{a(`<button type="button" class="${e.ssrRenderClass(["p-2 border-2 rounded-lg transition-all",p.value.estado===r.valor?"border-purple-600 bg-purple-50 dark:bg-purple-900/20":"border-gray-300 dark:border-gray-700 hover:border-purple-400"])}" data-v-90d0f873><div class="text-xl mb-1" data-v-90d0f873>${e.ssrInterpolate(r.icono)}</div><div class="text-xs font-medium text-gray-900 dark:text-white" data-v-90d0f873>${e.ssrInterpolate(r.nombre)}</div></button>`)}),a(`\x3c!--]--\x3e</div></div><div data-v-90d0f873><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" data-v-90d0f873> ğŸ“ Observaciones </label><textarea rows="3" placeholder="Notas adicionales sobre la cita..." class="w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-800 dark:text-white" data-v-90d0f873>${e.ssrInterpolate(p.value.observaciones)}</textarea></div></div></form>`)):a("\x3c!----\x3e"),a(`<div class="px-6 py-4 border-t border-gray-200 dark:border-gray-800 flex gap-3 bg-gray-50 dark:bg-gray-800" data-v-90d0f873><button type="button" class="flex-1 px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors font-medium" data-v-90d0f873> Cancelar </button><button${e.ssrIncludeBooleanAttr(u.value||v.value)?" disabled":""} class="${e.ssrRenderClass(["flex-1 px-4 py-2 rounded-lg font-medium transition-colors",u.value||v.value?"bg-gray-400 dark:bg-gray-600 text-gray-200 cursor-not-allowed":"bg-purple-600 hover:bg-purple-700 text-white"])}" data-v-90d0f873>`),u.value?a("<span data-v-90d0f873>Guardando...</span>"):a("<span data-v-90d0f873>ğŸ’¾ Guardar Cambios</span>"),a("</button></div></div></div>")):a("\x3c!----\x3e")},"body",!1,t)}}}),l=o.setup;o.setup=(e,r)=>{const t=a.useSSRContext();return(t.modules||(t.modules=new Set)).add("components/ModalEditarCita.vue"),l?l(e,r):void 0};const s=Object.assign(d(o,[["__scopeId","data-v-90d0f873"]]),{__name:"ModalEditarCita"});export{s as _};
//# sourceMappingURL=ModalEditarCita-DXjLuO3L.mjs.map
