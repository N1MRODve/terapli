import{v as e,a,s as t}from"./server.mjs";import{u as o}from"./useSupabaseClient-DykwVqLQ.mjs";import{u as s}from"./useSupabase-DfFg84CY.mjs";import{_ as n}from"./PaymentMethodSelector-B6WAV7CR.mjs";import{u as r}from"./useToast-CW-71pJZ.mjs";import{_ as d}from"./ModalNuevoBono-Mje0VtwW.mjs";import{r as l}from"./XMarkIcon-DCLwyE-W.mjs";import{r as i}from"./CheckCircleIcon-CT9fzVFs.mjs";import{r as c}from"./PencilIcon-BKWXEWgS.mjs";import{r as u}from"./PhoneIcon-acGzPaDV.mjs";import{r as p}from"./CalendarDaysIcon-f8DhK37e.mjs";import{r as v}from"./ClockIcon-BxdFtPqx.mjs";import{r as f}from"./TicketIcon-zZdrc71S.mjs";import{r as m}from"./ChevronDownIcon-CvdhRGll.mjs";import{r as g}from"./ExclamationTriangleIcon-DQdM2y0F.mjs";import{r as b}from"./PlusIcon-CHLzv-V9.mjs";import{_ as x}from"./_plugin-vue_export-helper-1tPrXgE0.mjs";function render$3(a,t){return e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e.createElementVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"})])}function render$2(a,t){return e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e.createElementVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m4.5 15.75 7.5-7.5 7.5 7.5"})])}function render$1(a,t){return e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e.createElementVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}),e.createElementVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z"})])}function render(a,t){return e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e.createElementVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m15.75 10.5 4.72-4.72a.75.75 0 0 1 1.28.53v11.38a.75.75 0 0 1-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25h-9A2.25 2.25 0 0 0 2.25 7.5v9a2.25 2.25 0 0 0 2.25 2.25Z"})])}function usePayments(){const a=o(),{userProfile:t}=s(),n=e.ref([]),r=e.ref(!1),d=e.ref(null),l=e.computed(()=>{const e=(new Date).toISOString().split("T")[0],a=n.value.filter(e=>"pagado"===e.estado_pago),t=n.value.filter(e=>"pendiente"===e.estado_pago||!e.estado_pago),o={efectivo:{total:0,cantidad:0},transferencia:{total:0,cantidad:0},bizum:{total:0,cantidad:0},tarjeta:{total:0,cantidad:0},stripe:{total:0,cantidad:0}};return a.forEach(e=>{e.metodo_pago&&o[e.metodo_pago]&&(o[e.metodo_pago].total+=e.precio_sesion||0,o[e.metodo_pago].cantidad+=1)}),{fecha:e,total:a.reduce((e,a)=>e+(a.precio_sesion||0),0),cantidadPagos:a.length,porMetodo:o,pagos:a,pendientes:t}});async function getPaymentsOfDay(e){const o=t.value?.terapeuta_id||t.value?.id;if(!o)return console.warn("[usePayments] No hay terapeuta_id disponible"),[];const s=e||(new Date).toISOString().split("T")[0];r.value=!0,d.value=null;try{const{data:e,error:t}=await a.from("citas").select("\n          id,\n          fecha_cita,\n          hora_inicio,\n          hora_fin,\n          precio_sesion,\n          estado_pago,\n          metodo_pago,\n          fecha_pago,\n          bono_id,\n          estado,\n          paciente:pacientes(id, nombre_completo)\n        ").eq("terapeuta_id",o).eq("fecha_cita",s).in("estado",["confirmada","realizada"]).order("hora_inicio",{ascending:!0});if(t)throw new Error(t.message);const r=(e||[]).map(e=>({id:e.id,paciente_id:e.paciente?.id||"",paciente_nombre:e.paciente?.nombre_completo||"Sin nombre",fecha_cita:e.fecha_cita,hora_inicio:e.hora_inicio,hora_fin:e.hora_fin,precio_sesion:e.precio_sesion,estado_pago:e.estado_pago,metodo_pago:e.metodo_pago,fecha_pago:e.fecha_pago,bono_id:e.bono_id,estado:e.estado}));return n.value=r,r}catch(e){return d.value=e.message,console.error("[usePayments] Error obteniendo pagos:",e),[]}finally{r.value=!1}}async function refreshPaymentsForToday(){await getPaymentsOfDay()}return{pagosDia:n,loading:r,error:d,resumenDia:l,getPaymentsOfDay:getPaymentsOfDay,createPayment:async function(e,t,o,s){r.value=!0,d.value=null;try{const{data:n,error:r}=await a.rpc("fn_registrar_pago_sesion",{p_cita_id:e,p_metodo_pago:t,p_monto:o||null,p_notas:s||null});if(!r)return await refreshPaymentsForToday(),{success:!0,data:n};console.warn("[usePayments] RPC fall√≥, usando fallback:",r.message);const d={estado_pago:"pagado",metodo_pago:t,fecha_pago:(new Date).toISOString(),updated_at:(new Date).toISOString()};void 0!==o&&(d.precio_sesion=o),s&&(d.notas_pago=s);const{error:l}=await a.from("citas").update(d).eq("id",e);if(l)throw new Error(l.message);return await refreshPaymentsForToday(),{success:!0}}catch(e){return d.value=e.message,console.error("[usePayments] Error registrando pago:",e),{success:!1,error:e.message}}finally{r.value=!1}},updatePaymentMethod:async function(e,t){r.value=!0,d.value=null;try{const{error:o}=await a.from("citas").update({metodo_pago:t,updated_at:(new Date).toISOString()}).eq("id",e);if(o)throw new Error(o.message);return await refreshPaymentsForToday(),{success:!0}}catch(e){return d.value=e.message,console.error("[usePayments] Error actualizando m√©todo:",e),{success:!1,error:e.message}}finally{r.value=!1}},undoPayment:async function(e){r.value=!0,d.value=null;try{const{error:t}=await a.from("citas").update({estado_pago:"pendiente",metodo_pago:null,fecha_pago:null,notas_pago:null,updated_at:(new Date).toISOString()}).eq("id",e);if(t)throw new Error(t.message);return await refreshPaymentsForToday(),{success:!0}}catch(e){return d.value=e.message,console.error("[usePayments] Error deshaciendo pago:",e),{success:!1,error:e.message}}finally{r.value=!1}},refreshPaymentsForToday:refreshPaymentsForToday,getPaymentSummary:function(e){const a={efectivo:{total:0,cantidad:0},transferencia:{total:0,cantidad:0},bizum:{total:0,cantidad:0},tarjeta:{total:0,cantidad:0},stripe:{total:0,cantidad:0}},t=e.filter(e=>"pagado"===e.estado_pago);return t.forEach(e=>{e.metodo_pago&&a[e.metodo_pago]&&(a[e.metodo_pago].total+=e.precio_sesion||0,a[e.metodo_pago].cantidad+=1)}),{total:t.reduce((e,a)=>e+(a.precio_sesion||0),0),porMetodo:a}},formatPaymentMethod:function(e){return e?{efectivo:"üíµ Efectivo",transferencia:"üè¶ Transferencia",bizum:"üì± Bizum",tarjeta:"üí≥ Tarjeta",stripe:"‚ö° Stripe"}[e]:"No especificado"},formatPaymentDate:function(e){if(!e)return"";const a=new Date(e),t=new Date,o=new Date(t);o.setDate(o.getDate()-1);const s=a.toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit"}),n=a.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"});return a.toDateString()===t.toDateString()?`Hoy a las ${n}`:a.toDateString()===o.toDateString()?`Ayer a las ${n}`:`${s} a las ${n}`}}}const y=e.defineComponent({__name:"PaymentStatusBadge",__ssrInlineRender:!0,props:{estadoPago:{},metodoPago:{default:null},fechaPago:{default:null},cantidad:{default:null},showActions:{type:Boolean,default:!0},compact:{type:Boolean,default:!1}},emits:["registrar","cambiar","deshacer"],setup(a,{emit:o}){const s=a,{formatPaymentMethod:n,formatPaymentDate:r}=usePayments(),d=e.computed(()=>{switch(s.estadoPago){case"pagado":return{label:"Pagado",icon:"‚úì",bgColor:"bg-green-50",textColor:"text-green-700",borderColor:"border-green-200",iconBg:"bg-green-500"};case"bonificado":return{label:"Bonificado",icon:"üéÅ",bgColor:"bg-blue-50",textColor:"text-blue-700",borderColor:"border-blue-200",iconBg:"bg-blue-500"};case"cancelado":return{label:"Cancelado",icon:"‚úï",bgColor:"bg-gray-50",textColor:"text-gray-500",borderColor:"border-gray-200",iconBg:"bg-gray-400"};default:return{label:"Pendiente",icon:"‚è≥",bgColor:"bg-amber-50",textColor:"text-amber-700",borderColor:"border-amber-200",iconBg:"bg-amber-500"}}}),l=e.computed(()=>"pagado"===s.estadoPago),i=e.computed(()=>!s.estadoPago||"pendiente"===s.estadoPago),c=e.computed(()=>"bonificado"===s.estadoPago),u=e.computed(()=>s.metodoPago?n(s.metodoPago):null),p=e.computed(()=>s.fechaPago?r(s.fechaPago):null),v=e.computed(()=>null===s.cantidad||void 0===s.cantidad?null:`${s.cantidad.toFixed(2)}‚Ç¨`);return(o,s,n,r)=>{s(`<div${t.ssrRenderAttrs(e.mergeProps({class:["rounded-lg border transition-colors",e.unref(d).bgColor,e.unref(d).borderColor,a.compact?"p-2":"p-3"]},r))}><div class="flex items-start justify-between gap-3"><div class="flex items-center gap-2"><span class="${t.ssrRenderClass(["flex items-center justify-center rounded-full text-white",e.unref(d).iconBg,a.compact?"w-5 h-5 text-xs":"w-6 h-6 text-sm"])}" aria-hidden="true">${t.ssrInterpolate(e.unref(d).icon)}</span><div><span class="${t.ssrRenderClass(["font-medium",e.unref(d).textColor,a.compact?"text-sm":"text-base"])}">${t.ssrInterpolate(e.unref(d).label)}</span>`),e.unref(l)&&!a.compact?(s('<p class="text-xs text-gray-500 mt-0.5">'),e.unref(u)?s(`<span>${t.ssrInterpolate(e.unref(u))}</span>`):s("\x3c!----\x3e"),e.unref(p)?s(`<span class="ml-1">¬∑ ${t.ssrInterpolate(e.unref(p))}</span>`):s("\x3c!----\x3e"),s("</p>")):s("\x3c!----\x3e"),e.unref(c)&&!a.compact?s('<p class="text-xs text-blue-600 mt-0.5"> Sesi√≥n cubierta por bono </p>'):s("\x3c!----\x3e"),s("</div></div>"),e.unref(v)&&!a.compact?s(`<div class="text-right"><span class="${t.ssrRenderClass(["font-semibold",e.unref(d).textColor])}">${t.ssrInterpolate(e.unref(v))}</span></div>`):s("\x3c!----\x3e"),s("</div>"),a.showActions&&!a.compact?(s(`<div class="${t.ssrRenderClass([e.unref(d).borderColor,"mt-3 pt-3 border-t flex flex-wrap gap-2"])}">`),e.unref(i)?s('<button type="button" class="flex-1 inline-flex items-center justify-center gap-1.5 px-3 py-2 text-sm font-medium text-white bg-teal-600 rounded-lg hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transition-colors"><span aria-hidden="true">üí≥</span> Registrar pago </button>'):s("\x3c!----\x3e"),e.unref(l)?s('\x3c!--[--\x3e<button type="button" class="inline-flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transition-colors"><span aria-hidden="true">üîÑ</span> Cambiar m√©todo </button><button type="button" class="inline-flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium text-red-600 bg-white border border-red-200 rounded-lg hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors"><span aria-hidden="true">‚Ü©Ô∏è</span> Deshacer </button>\x3c!--]--\x3e'):s("\x3c!----\x3e"),e.unref(c)?s('<p class="text-xs text-blue-600 italic"> Esta sesi√≥n est√° vinculada a un bono activo </p>'):s("\x3c!----\x3e"),s("</div>")):s("\x3c!----\x3e"),s("</div>")}}}),h=y.setup;y.setup=(a,t)=>{const o=e.useSSRContext();return(o.modules||(o.modules=new Set)).add("components/Payment/PaymentStatusBadge.vue"),h?h(a,t):void 0};const _=Object.assign(y,{__name:"PaymentStatusBadge"}),w=e.defineComponent({__name:"PaymentQuickModal",__ssrInlineRender:!0,props:{citaId:{},pacienteNombre:{},cantidad:{},tipoTransaccion:{default:"sesion_unica"},bonoInfo:{default:null},horaInicio:{default:""},metodoPagoActual:{default:null},modoEdicion:{type:Boolean,default:!1}},emits:["confirm","cancel"],setup(a,{emit:o}){const s=a;usePayments();const r=e.ref(s.metodoPagoActual),d=e.ref(!1),l=e.computed(()=>{if(s.bonoInfo){return`Sesi√≥n ${s.bonoInfo.numeroSesion||s.bonoInfo.sesionesTotales-s.bonoInfo.sesionesRestantes+1}/${s.bonoInfo.sesionesTotales} "${s.bonoInfo.nombre}"`}return"Sesi√≥n individual"}),i=e.computed(()=>s.modoEdicion?"Cambiar m√©todo de pago":"Registrar pago"),c=e.computed(()=>`${s.cantidad.toFixed(2)}‚Ç¨`);function handleSelectMethod(e){r.value=e}return(o,s,u,p)=>{const v=n;t.ssrRenderTeleport(s,o=>{o(`<div class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50" role="dialog" aria-modal="true"${t.ssrRenderAttr("aria-labelledby","payment-modal-title")}><div class="w-full max-w-md bg-white rounded-2xl shadow-xl overflow-hidden"><div class="px-5 py-4 bg-gray-50 border-b border-gray-200"><h2 id="payment-modal-title" class="text-lg font-semibold text-gray-900">${t.ssrInterpolate(e.unref(i))}</h2></div><div class="p-5 space-y-5"><div class="text-center pb-4 border-b border-gray-100"><p class="text-3xl font-bold text-gray-900">${t.ssrInterpolate(e.unref(c))}</p><p class="mt-1 text-base text-gray-700">${t.ssrInterpolate(a.pacienteNombre)}</p><p class="text-sm text-gray-500">${t.ssrInterpolate(e.unref(l))} `),a.horaInicio?o(`<span class="ml-1">¬∑ ${t.ssrInterpolate(a.horaInicio)}</span>`):o("\x3c!----\x3e"),o('</p></div><div><label class="block text-sm font-medium text-gray-700 mb-3"> M√©todo de pago </label>'),o(t.ssrRenderComponent(v,{"selected-method":e.unref(r),disabled:e.unref(d),size:"md",onSelect:handleSelectMethod},null,u)),o(`</div></div><div class="px-5 py-4 bg-gray-50 border-t border-gray-200 flex gap-3"><button type="button" class="flex-1 px-4 py-2.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors"${t.ssrIncludeBooleanAttr(e.unref(d))?" disabled":""}> Cancelar </button><button type="button" class="flex-1 px-4 py-2.5 text-sm font-medium text-white bg-teal-600 rounded-lg hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"${t.ssrIncludeBooleanAttr(!e.unref(r)||e.unref(d))?" disabled":""}>`),e.unref(d)?o('<span class="inline-flex items-center gap-2"><svg class="animate-spin h-4 w-4" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path></svg> Procesando... </span>'):o(`<span>${t.ssrInterpolate(a.modoEdicion?"Actualizar":"Confirmar pago")}</span>`),o("</button></div></div></div>")},"body",!1,u)}}}),C=w.setup;w.setup=(a,t)=>{const o=e.useSSRContext();return(o.modules||(o.modules=new Set)).add("components/Payment/PaymentQuickModal.vue"),C?C(a,t):void 0};const I=Object.assign(w,{__name:"PaymentQuickModal"}),$=e.defineComponent({__name:"ModalDetallesCita",__ssrInlineRender:!0,props:{citaId:{}},emits:["close","cita-actualizada","cita-eliminada","actualizado","eliminado"],setup(s,{emit:n}){const x=s,y=n,h=e.ref(!1),w=e.ref(!1),C=e.ref(!1),$=e.ref(!1),S=e.ref(!1),P=e.ref(null),D=e.ref(!0),R=e.ref(!1),A=e.ref(!1),B=e.ref(!1),k=e.ref(!1),E=e.ref(!1),j=e.ref(!1),z=e.ref(!1),M=e.ref(null),T=e.ref(null),q=e.ref(null),V=e.ref(null);a(),usePayments();const{success:N,error:L}=r(),F=e.ref({fecha_cita:"",hora_inicio:"",hora_fin:"",modalidad:"",observaciones:"",estado:""}),O=o();e.watch(D,e=>{localStorage.setItem("modal-seccion-bono",String(e))}),e.watch(R,e=>{localStorage.setItem("modal-seccion-observaciones",String(e))});const cargarCita=async()=>{if(x.citaId)try{B.value=!0;const{data:e,error:a}=await O.from("citas").select("\n        *,\n        paciente:pacientes(\n          id,\n          nombre_completo,\n          email,\n          telefono,\n          frecuencia\n        )\n      ").eq("id",x.citaId).single();if(a)throw a;if(M.value=e,T.value=e.paciente,e.bono_id){const{data:a,error:t}=await O.from("bonos").select("\n          id,\n          tipo,\n          sesiones_totales,\n          sesiones_restantes,\n          monto_total,\n          precio_por_sesion,\n          fecha_inicio,\n          fecha_fin,\n          estado,\n          pagado,\n          created_at,\n          updated_at\n        ").eq("id",e.bono_id).single();if(!t){q.value=a;const{data:t}=await O.from("citas").select("id, fecha_cita, hora_inicio").eq("bono_id",e.bono_id).eq("sesion_descontada",!0).order("fecha_cita",{ascending:!0}).order("hora_inicio",{ascending:!0});if(t){const e=t.findIndex(e=>e.id===x.citaId);-1!==e&&(q.value.numero_sesion=e+1)}}}else q.value=null;if(!e.bono_id&&e.paciente?.id){const{data:a}=await O.from("bonos").select("\n          id,\n          tipo,\n          sesiones_totales,\n          sesiones_restantes,\n          monto_total,\n          precio_por_sesion,\n          fecha_inicio,\n          fecha_fin,\n          estado,\n          pagado,\n          created_at,\n          updated_at\n        ").eq("paciente_id",e.paciente.id).in("estado",["activo","pendiente"]).gt("sesiones_restantes",0).order("created_at",{ascending:!1}).limit(1).maybeSingle();V.value=a}else V.value=null;F.value={fecha_cita:e.fecha_cita,hora_inicio:e.hora_inicio?.substring(0,5)||"",hora_fin:e.hora_fin?.substring(0,5)||"",modalidad:e.modalidad,observaciones:e.observaciones||"",estado:e.estado},C.value=!1,$.value=!1}catch(e){console.error("Error al cargar cita:",e)}finally{B.value=!1}};e.watch(()=>x.citaId,e=>{e?cargarCita():(M.value=null,T.value=null,q.value=null,V.value=null)},{immediate:!0});const U=e.computed(()=>{if(!M.value?.fecha_cita)return"";const e=new Date(M.value.fecha_cita+"T00:00:00"),a=new Date,t=new Date(a);return t.setDate(t.getDate()+1),e.toDateString()===a.toDateString()?"Hoy":e.toDateString()===t.toDateString()?"Ma√±ana":e.toLocaleDateString("es-ES",{weekday:"short",day:"numeric",month:"short"})}),Q=e.computed(()=>{if(!M.value)return"";return`${M.value.hora_inicio?.substring(0,5)||""} - ${M.value.hora_fin?.substring(0,5)||""}`}),W=e.computed(()=>{if(!M.value?.hora_inicio||!M.value?.hora_fin)return 60;const[e,a]=M.value.hora_inicio.split(":").map(Number),[t,o]=M.value.hora_fin.split(":").map(Number);return 60*t+o-(60*e+a)}),Z=e.computed(()=>({presencial:"Presencial",virtual:"Online",telefonica:"Telef√≥nica"}[M.value?.modalidad]||M.value?.modalidad||"-")),G=e.computed(()=>M.value?.estado||"pendiente"),H=e.computed(()=>({pendiente:"bg-amber-100 text-amber-700",confirmada:"bg-emerald-100 text-emerald-700",realizada:"bg-blue-100 text-blue-700",cancelada:"bg-gray-100 text-gray-500"}[G.value]||"bg-gray-100 text-gray-600")),X=e.computed(()=>({pendiente:"Pendiente",confirmada:"Confirmada",realizada:"Realizada",cancelada:"Cancelada"}[G.value]||G.value)),K=e.computed(()=>M.value?.estado_pago||"pendiente"),J=e.computed(()=>"pendiente"===M.value?.estado),Y=e.computed(()=>{if(!M.value)return!1;const e=M.value.estado,a=M.value.estado_pago;return!("confirmada"!==e&&"realizada"!==e||"pendiente"!==a&&a)}),ee=e.computed(()=>{if(!M.value)return!1;const e=M.value.estado;return"confirmada"===e||"pendiente"===e}),ae=e.computed(()=>!!q.value&&(!M.value?.sesion_descontada&&(!(q.value.sesiones_restantes<=0)&&("realizada"===M.value?.estado||"confirmada"===M.value?.estado)))),te=e.computed(()=>!q.value&&(!!V.value&&V.value.sesiones_restantes>0)),oe=e.computed(()=>q.value||V.value),se=e.computed(()=>oe.value?oe.value.sesiones_totales-oe.value.sesiones_restantes:0);e.computed(()=>oe.value?se.value/oe.value.sesiones_totales*100:0);const ne=e.computed(()=>{if(!oe.value?.fecha_fin)return null;return new Date(oe.value.fecha_fin).toLocaleDateString("es-ES",{day:"numeric",month:"short"})}),re=e.computed(()=>{if(!oe.value?.fecha_fin)return!1;const e=new Date(oe.value.fecha_fin),a=new Date,t=Math.floor((e.getTime()-a.getTime())/864e5);return t<=7&&t>=0}),de=e.computed(()=>{if(!oe.value?.fecha_fin)return!1;return new Date(oe.value.fecha_fin)<new Date}),le=e.computed(()=>{if(!oe.value?.tipo)return"Bono";return{semanal:"Semanal",quincenal:"Quincenal",mensual:"Mensual",otro:"Personalizado"}[oe.value.tipo]||oe.value.tipo}),ie=e.computed(()=>M.value?.precio_sesion?M.value.precio_sesion:oe.value?.precio_por_sesion?oe.value.precio_por_sesion:oe.value&&oe.value.monto_total&&oe.value.sesiones_totales?Math.round(oe.value.monto_total/oe.value.sesiones_totales*100)/100:50),ce=e.computed(()=>{if(!oe.value)return null;const e=oe.value.sesiones_totales-oe.value.sesiones_restantes,a=e+1;return{tipo:oe.value.tipo||"Bono",sesionesRestantes:oe.value.sesiones_restantes,sesionesTotales:oe.value.sesiones_totales,sesionesUsadas:e,numeroSesionActual:M.value?.sesion_descontada?e:a,montoTotal:oe.value.monto_total,precioPorSesion:oe.value.precio_por_sesion||oe.value.monto_total/oe.value.sesiones_totales,pagado:oe.value.pagado,estado:oe.value.estado,fechaInicio:oe.value.fecha_inicio,fechaFin:oe.value.fecha_fin,esAsignado:!!q.value,sesionDescontada:M.value?.sesion_descontada}}),ue=e.computed(()=>{if(!T.value?.nombre_completo)return"?";const e=T.value.nombre_completo.split(" ");return e.length>=2?(e[0][0]+e[1][0]).toUpperCase():e[0].substring(0,2).toUpperCase()}),pe=e.computed(()=>q.value?{id:q.value.id,nombre:q.value.tipo||"Bono",sesionesRestantes:q.value.sesiones_restantes,sesionesTotales:q.value.sesiones_totales,numeroSesion:q.value.numero_sesion}:null),handleBonoCreado=async e=>{S.value=!1;try{const a=e.monto_total&&e.sesiones_totales?Number(e.monto_total)/Number(e.sesiones_totales):70;if(x.citaId&&M.value){const{error:t}=await O.from("citas").update({bono_id:e.id,descontar_de_bono:!0,precio_sesion:a,updated_at:(new Date).toISOString()}).eq("id",x.citaId);t?(console.error("Error al asignar bono a cita:",t),L("Bono creado pero no se pudo asignar a la cita")):(M.value.bono_id=e.id,M.value.precio_sesion=a,q.value=e,N(`Bono creado y asignado (${a.toFixed(0)}‚Ç¨/sesi√≥n)`))}else N("Bono creado correctamente");x.citaId&&await cargarCita(x.citaId),y("cita-actualizada"),y("actualizado")}catch(e){console.error("Error en handleBonoCreado:",e),L("Error al procesar el bono")}},handleBonoActualizado=async e=>{if(S.value=!1,P.value=null,N("Bono actualizado correctamente"),x.citaId&&M.value&&e){const a=e.monto_total&&e.sesiones_totales?Number(e.monto_total)/Number(e.sesiones_totales):70;await O.from("citas").update({precio_sesion:a,updated_at:(new Date).toISOString()}).eq("id",x.citaId),M.value.precio_sesion=a}x.citaId&&await cargarCita(x.citaId),y("cita-actualizada"),y("actualizado")},abrirModalPago=()=>{$.value=!1,C.value=!0},abrirCambiarMetodo=()=>{$.value=!0,C.value=!0},handlePagoConfirmado=e=>{M.value&&(M.value.estado_pago="pagado",M.value.metodo_pago=e,M.value.fecha_pago=(new Date).toISOString()),C.value=!1,$.value=!1,y("cita-actualizada"),y("actualizado")},cancelarModalPago=()=>{C.value=!1,$.value=!1};return e.watch(()=>F.value.hora_inicio,e=>{if(A.value&&e){const[a,t]=e.split(":").map(Number),o=60*a+t+60,s=Math.floor(o/60),n=o%60;F.value.hora_fin=`${String(s).padStart(2,"0")}:${String(n).padStart(2,"0")}`}}),(a,o,n,r)=>{const x=_,y=I,V=d;t.ssrRenderTeleport(o,a=>{s.citaId?(a(`<div class="fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4" role="dialog" aria-modal="true" aria-labelledby="modal-title" data-v-4ed07fa5><div class="bg-white rounded-xl shadow-xl w-full max-w-[600px] max-h-[90vh] overflow-hidden flex flex-col" data-v-4ed07fa5><div class="px-5 py-4 border-b border-gray-100 flex items-center justify-between bg-white" data-v-4ed07fa5><div class="flex items-center gap-3" data-v-4ed07fa5><div class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-sm font-semibold text-gray-600" data-v-4ed07fa5>${t.ssrInterpolate(ue.value)}</div><div data-v-4ed07fa5><h2 id="modal-title" class="text-base font-semibold text-gray-900" data-v-4ed07fa5> Sesi√≥n - ${t.ssrInterpolate(T.value?.nombre_completo||"Cargando...")}</h2><span class="${t.ssrRenderClass(["text-xs font-medium px-2 py-0.5 rounded-full",H.value])}" data-v-4ed07fa5>${t.ssrInterpolate(X.value)}</span></div></div><button class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors" aria-label="Cerrar modal" data-v-4ed07fa5>`),a(t.ssrRenderComponent(e.unref(l),{class:"w-5 h-5"},null,n)),a("</button></div>"),B.value?a('<div class="flex-1 flex items-center justify-center p-12" data-v-4ed07fa5><div class="w-8 h-8 border-2 border-gray-200 border-t-gray-600 rounded-full animate-spin" data-v-4ed07fa5></div></div>'):M.value?(a('<div class="flex-1 overflow-y-auto" data-v-4ed07fa5>'),A.value?a(`<form class="p-5 space-y-4" data-v-4ed07fa5><div data-v-4ed07fa5><label class="block text-sm font-medium text-gray-700 mb-1" data-v-4ed07fa5>Fecha</label><input${t.ssrRenderAttr("value",F.value.fecha_cita)} type="date" required class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-gray-400" data-v-4ed07fa5></div><div class="grid grid-cols-2 gap-3" data-v-4ed07fa5><div data-v-4ed07fa5><label class="block text-sm font-medium text-gray-700 mb-1" data-v-4ed07fa5>Inicio</label><input${t.ssrRenderAttr("value",F.value.hora_inicio)} type="time" required class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-gray-400" data-v-4ed07fa5></div><div data-v-4ed07fa5><label class="block text-sm font-medium text-gray-700 mb-1" data-v-4ed07fa5>Fin</label><input${t.ssrRenderAttr("value",F.value.hora_fin)} type="time" required class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-gray-400" data-v-4ed07fa5></div></div><div class="grid grid-cols-2 gap-3" data-v-4ed07fa5><div data-v-4ed07fa5><label class="block text-sm font-medium text-gray-700 mb-1" data-v-4ed07fa5>Modalidad</label><select required class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-gray-400" data-v-4ed07fa5><option value="presencial" data-v-4ed07fa5${t.ssrIncludeBooleanAttr(Array.isArray(F.value.modalidad)?t.ssrLooseContain(F.value.modalidad,"presencial"):t.ssrLooseEqual(F.value.modalidad,"presencial"))?" selected":""}>Presencial</option><option value="virtual" data-v-4ed07fa5${t.ssrIncludeBooleanAttr(Array.isArray(F.value.modalidad)?t.ssrLooseContain(F.value.modalidad,"virtual"):t.ssrLooseEqual(F.value.modalidad,"virtual"))?" selected":""}>Virtual</option><option value="telefonica" data-v-4ed07fa5${t.ssrIncludeBooleanAttr(Array.isArray(F.value.modalidad)?t.ssrLooseContain(F.value.modalidad,"telefonica"):t.ssrLooseEqual(F.value.modalidad,"telefonica"))?" selected":""}>Telef√≥nica</option></select></div><div data-v-4ed07fa5><label class="block text-sm font-medium text-gray-700 mb-1" data-v-4ed07fa5>Estado</label><select required class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-gray-400" data-v-4ed07fa5><option value="pendiente" data-v-4ed07fa5${t.ssrIncludeBooleanAttr(Array.isArray(F.value.estado)?t.ssrLooseContain(F.value.estado,"pendiente"):t.ssrLooseEqual(F.value.estado,"pendiente"))?" selected":""}>Pendiente</option><option value="confirmada" data-v-4ed07fa5${t.ssrIncludeBooleanAttr(Array.isArray(F.value.estado)?t.ssrLooseContain(F.value.estado,"confirmada"):t.ssrLooseEqual(F.value.estado,"confirmada"))?" selected":""}>Confirmada</option><option value="realizada" data-v-4ed07fa5${t.ssrIncludeBooleanAttr(Array.isArray(F.value.estado)?t.ssrLooseContain(F.value.estado,"realizada"):t.ssrLooseEqual(F.value.estado,"realizada"))?" selected":""}>Realizada</option><option value="cancelada" data-v-4ed07fa5${t.ssrIncludeBooleanAttr(Array.isArray(F.value.estado)?t.ssrLooseContain(F.value.estado,"cancelada"):t.ssrLooseEqual(F.value.estado,"cancelada"))?" selected":""}>Cancelada</option></select></div></div><div data-v-4ed07fa5><label class="block text-sm font-medium text-gray-700 mb-1" data-v-4ed07fa5>Observaciones</label><textarea rows="3" class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-gray-400 resize-none" placeholder="Notas adicionales..." data-v-4ed07fa5>${t.ssrInterpolate(F.value.observaciones)}</textarea></div><div class="flex gap-3 pt-2" data-v-4ed07fa5><button type="button" class="flex-1 py-2.5 bg-gray-100 text-gray-700 font-medium rounded-lg hover:bg-gray-200 transition-colors" data-v-4ed07fa5> Cancelar </button><button type="submit"${t.ssrIncludeBooleanAttr(B.value)?" disabled":""} class="flex-1 py-2.5 bg-gray-900 text-white font-medium rounded-lg hover:bg-gray-800 transition-colors disabled:opacity-50" data-v-4ed07fa5>${t.ssrInterpolate(B.value?"Guardando...":"Guardar")}</button></div></form>`):(a('\x3c!--[--\x3e<div class="px-5 py-3 border-b border-gray-100 flex items-center gap-2 flex-wrap" data-v-4ed07fa5>'),ee.value?(a(`<button${t.ssrIncludeBooleanAttr(w.value)?" disabled":""} class="flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium text-blue-700 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors disabled:opacity-50" data-v-4ed07fa5>`),a(t.ssrRenderComponent(e.unref(i),{class:"w-4 h-4"},null,n)),a(` ${t.ssrInterpolate(w.value?"Marcando...":"Marcar realizada")}</button>`)):a("\x3c!----\x3e"),a('<button class="flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors" data-v-4ed07fa5>'),a(t.ssrRenderComponent(e.unref(c),{class:"w-4 h-4"},null,n)),a(" Editar </button>"),T.value?.telefono?(a('<button class="flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors" data-v-4ed07fa5>'),a(t.ssrRenderComponent(e.unref(u),{class:"w-4 h-4"},null,n)),a(" Llamar </button>")):a("\x3c!----\x3e"),a('</div><div class="px-5 py-4 border-b border-gray-100" data-v-4ed07fa5><div class="flex items-center justify-between text-sm" data-v-4ed07fa5><div class="flex items-center gap-4" data-v-4ed07fa5><div class="flex items-center gap-1.5 text-gray-600" data-v-4ed07fa5>'),a(t.ssrRenderComponent(e.unref(p),{class:"w-4 h-4 text-gray-400"},null,n)),a(`<span data-v-4ed07fa5>${t.ssrInterpolate(U.value)}</span></div><div class="flex items-center gap-1.5 text-gray-600" data-v-4ed07fa5>`),a(t.ssrRenderComponent(e.unref(v),{class:"w-4 h-4 text-gray-400"},null,n)),a(`<span data-v-4ed07fa5>${t.ssrInterpolate(Q.value)}</span></div><div class="flex items-center gap-1.5 text-gray-600" data-v-4ed07fa5>`),t.ssrRenderVNode(a,e.createVNode(e.resolveDynamicComponent("virtual"===M.value.modalidad?e.unref(render):e.unref(render$1)),{class:"w-4 h-4 text-gray-400"},null),n),a(`<span data-v-4ed07fa5>${t.ssrInterpolate(Z.value)}</span></div></div><span class="text-gray-500" data-v-4ed07fa5>${t.ssrInterpolate(W.value)} min</span></div></div><div class="mx-5 my-4" data-v-4ed07fa5>`),a(t.ssrRenderComponent(x,{"estado-pago":K.value,"metodo-pago":M.value.metodo_pago,"fecha-pago":M.value.fecha_pago,cantidad:ie.value,"show-actions":Y.value||"pagado"===K.value,onRegistrar:abrirModalPago,onCambiar:abrirCambiarMetodo,onDeshacer:e=>k.value=!0},null,n)),"pendiente"!==K.value||Y.value||"pendiente"!==M.value.estado?a("\x3c!----\x3e"):a('<p class="mt-2 text-xs text-amber-600 text-center" data-v-4ed07fa5> Confirma la cita primero para poder registrar el pago </p>'),k.value?a(`<div class="mt-3 p-3 bg-red-50 border border-red-200 rounded-lg" data-v-4ed07fa5><p class="text-sm text-red-800 mb-3" data-v-4ed07fa5> ¬øEst√°s seguro de deshacer este pago? </p><div class="flex gap-2" data-v-4ed07fa5><button type="button" class="flex-1 px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50"${t.ssrIncludeBooleanAttr(E.value)?" disabled":""} data-v-4ed07fa5> Cancelar </button><button type="button" class="flex-1 px-3 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 disabled:opacity-50"${t.ssrIncludeBooleanAttr(E.value)?" disabled":""} data-v-4ed07fa5>${t.ssrInterpolate(E.value?"Deshaciendo...":"S√≠, deshacer")}</button></div></div>`):a("\x3c!----\x3e"),a("</div>"),C.value?a(t.ssrRenderComponent(y,{"cita-id":M.value.id,"paciente-nombre":T.value?.nombre_completo||"Paciente",cantidad:ie.value,"tipo-transaccion":q.value?"sesion_bono":"sesion_unica","bono-info":pe.value,"hora-inicio":M.value.hora_inicio?.substring(0,5),"metodo-pago-actual":M.value.metodo_pago,"modo-edicion":$.value,onConfirm:handlePagoConfirmado,onCancel:cancelarModalPago},null,n)):a("\x3c!----\x3e"),a(`<div class="mx-5 mb-3" data-v-4ed07fa5><button class="${t.ssrRenderClass([oe.value?"bg-purple-50 hover:bg-purple-100":"bg-gray-50 hover:bg-gray-100","w-full flex items-center justify-between px-4 py-3 rounded-lg transition-colors"])}" data-v-4ed07fa5><div class="flex items-center gap-2" data-v-4ed07fa5>`),a(t.ssrRenderComponent(e.unref(f),{class:["w-4 h-4",oe.value?"text-purple-500":"text-gray-400"]},null,n)),a(`<span class="${t.ssrRenderClass([oe.value?"text-purple-700":"text-gray-700","text-sm font-medium"])}" data-v-4ed07fa5>${t.ssrInterpolate(oe.value?"Bono del paciente":"Sin bono asignado")}</span>`),oe.value?a(`<span class="${t.ssrRenderClass([q.value?"bg-purple-100 text-purple-600":"bg-gray-100 text-gray-500","text-xs px-1.5 py-0.5 rounded"])}" data-v-4ed07fa5>${t.ssrInterpolate(q.value?"Asignado":"Disponible")}</span>`):a("\x3c!----\x3e"),a('</div><div class="flex items-center gap-2" data-v-4ed07fa5>'),oe.value?a(`<span class="text-xs text-gray-500" data-v-4ed07fa5>${t.ssrInterpolate(se.value)}/${t.ssrInterpolate(oe.value.sesiones_totales)}</span>`):a("\x3c!----\x3e"),t.ssrRenderVNode(a,e.createVNode(e.resolveDynamicComponent(D.value?e.unref(render$2):e.unref(m)),{class:"w-4 h-4 text-gray-400"},null),n),a("</div></button>"),D.value?(a('<div class="mt-2 overflow-hidden" data-v-4ed07fa5>'),oe.value&&ce.value?(a(`<div class="p-4 bg-white border border-gray-100 rounded-lg space-y-3" data-v-4ed07fa5><div class="flex items-center justify-between" data-v-4ed07fa5><div class="flex items-center gap-2" data-v-4ed07fa5><span class="text-sm font-semibold text-purple-700" data-v-4ed07fa5>${t.ssrInterpolate(le.value)}</span>`),ce.value.pagado?a('<span class="px-2 py-0.5 text-xs bg-green-100 text-green-700 rounded-full font-medium" data-v-4ed07fa5>Pagado</span>'):a('<span class="px-2 py-0.5 text-xs bg-amber-100 text-amber-700 rounded-full font-medium" data-v-4ed07fa5>Pago pendiente</span>'),a("</div>"),ne.value?a(`<div class="${t.ssrRenderClass([de.value?"text-red-600":re.value?"text-amber-600":"text-gray-500","text-xs font-medium"])}" data-v-4ed07fa5>${t.ssrInterpolate(de.value?"Vencido":`Vence ${ne.value}`)}</div>`):a("\x3c!----\x3e"),a(`</div><div class="grid grid-cols-2 gap-3 p-3 bg-purple-50/50 rounded-lg" data-v-4ed07fa5><div data-v-4ed07fa5><p class="text-xs text-gray-500" data-v-4ed07fa5>Valor del bono</p><p class="text-sm font-semibold text-gray-900" data-v-4ed07fa5>${t.ssrInterpolate(ce.value.montoTotal?.toFixed(2)||"0.00")}‚Ç¨</p></div><div data-v-4ed07fa5><p class="text-xs text-gray-500" data-v-4ed07fa5>Precio por sesi√≥n</p><p class="text-sm font-semibold text-gray-900" data-v-4ed07fa5>${t.ssrInterpolate(ce.value.precioPorSesion?.toFixed(2)||"0.00")}‚Ç¨</p></div></div><div data-v-4ed07fa5><div class="flex items-center justify-between text-xs text-gray-600 mb-1.5" data-v-4ed07fa5><span class="font-medium" data-v-4ed07fa5>Sesiones del bono</span><span class="font-semibold text-purple-700" data-v-4ed07fa5>${t.ssrInterpolate(ce.value.sesionesUsadas)} de ${t.ssrInterpolate(ce.value.sesionesTotales)} usadas</span></div><div class="flex gap-1" data-v-4ed07fa5>\x3c!--[--\x3e`),t.ssrRenderList(ce.value.sesionesTotales,e=>{a(`<div class="${t.ssrRenderClass([[e<=ce.value.sesionesUsadas?"bg-purple-600":"bg-purple-100",e!==ce.value.numeroSesionActual||ce.value.sesionDescontada?"":"ring-2 ring-purple-400 ring-offset-1"],"flex-1 h-3 rounded transition-all"])}"${t.ssrRenderAttr("title",`Sesi√≥n ${e}${e<=ce.value.sesionesUsadas?" (usada)":e===ce.value.numeroSesionActual?" (esta cita)":" (disponible)"}`)} data-v-4ed07fa5></div>`)}),a(`\x3c!--]--\x3e</div><p class="text-xs text-gray-500 mt-1.5" data-v-4ed07fa5>${t.ssrInterpolate(ce.value.sesionesRestantes)} sesiones restantes </p></div>`),ce.value.esAsignado?(a(`<div class="${t.ssrRenderClass([M.value.sesion_descontada?"bg-green-50 border border-green-200":"bg-amber-50 border border-amber-200","p-2.5 rounded-lg"])}" data-v-4ed07fa5><div class="flex items-start gap-2" data-v-4ed07fa5>`),M.value.sesion_descontada?a(t.ssrRenderComponent(e.unref(i),{class:"w-4 h-4 text-green-600 flex-shrink-0 mt-0.5"},null,n)):a(t.ssrRenderComponent(e.unref(g),{class:"w-4 h-4 text-amber-600 flex-shrink-0 mt-0.5"},null,n)),a(`<div data-v-4ed07fa5><p class="${t.ssrRenderClass([M.value.sesion_descontada?"text-green-800":"text-amber-800","text-xs font-medium"])}" data-v-4ed07fa5>`),M.value.sesion_descontada?a(`\x3c!--[--\x3e Sesi√≥n ${t.ssrInterpolate(ce.value.sesionesUsadas)}/${t.ssrInterpolate(ce.value.sesionesTotales)} del bono (ya descontada) \x3c!--]--\x3e`):a(`\x3c!--[--\x3e Esta ser√° la sesi√≥n ${t.ssrInterpolate(ce.value.numeroSesionActual)}/${t.ssrInterpolate(ce.value.sesionesTotales)} del bono \x3c!--]--\x3e`),a("</p>"),M.value.sesion_descontada?a("\x3c!----\x3e"):a('<p class="text-xs text-amber-700 mt-0.5" data-v-4ed07fa5> Se descontar√° cuando confirmes o marques como realizada </p>'),a("</div></div></div>")):a("\x3c!----\x3e"),1!==oe.value.sesiones_restantes||M.value.sesion_descontada?a("\x3c!----\x3e"):(a('<div class="flex items-center gap-2 p-2 bg-orange-50 border border-orange-200 rounded-lg" data-v-4ed07fa5>'),a(t.ssrRenderComponent(e.unref(g),{class:"w-4 h-4 text-orange-500 flex-shrink-0"},null,n)),a('<span class="text-xs text-orange-700 font-medium" data-v-4ed07fa5>¬°√öltima sesi√≥n disponible del bono!</span></div>')),de.value?(a('<div class="flex items-center gap-2 p-2 bg-red-50 border border-red-200 rounded-lg" data-v-4ed07fa5>'),a(t.ssrRenderComponent(e.unref(g),{class:"w-4 h-4 text-red-500 flex-shrink-0"},null,n)),a('<span class="text-xs text-red-700 font-medium" data-v-4ed07fa5>Este bono ha vencido</span></div>')):a("\x3c!----\x3e"),a('<div class="flex items-center gap-2 pt-2 border-t border-gray-100" data-v-4ed07fa5>'),te.value?(a(`<button${t.ssrIncludeBooleanAttr(z.value)?" disabled":""} class="flex-1 flex items-center justify-center gap-1.5 px-3 py-2 text-sm font-medium text-purple-700 bg-purple-50 hover:bg-purple-100 rounded-lg transition-colors disabled:opacity-50" data-v-4ed07fa5>`),a(t.ssrRenderComponent(e.unref(b),{class:"w-4 h-4"},null,n)),a(` ${t.ssrInterpolate(z.value?"Asignando...":"Asignar a esta cita")}</button>`)):a("\x3c!----\x3e"),ae.value?(a(`<button${t.ssrIncludeBooleanAttr(j.value)?" disabled":""} class="flex-1 flex items-center justify-center gap-1.5 px-3 py-2 text-sm font-medium text-white bg-purple-600 hover:bg-purple-700 rounded-lg transition-colors disabled:opacity-50" data-v-4ed07fa5>`),a(t.ssrRenderComponent(e.unref(i),{class:"w-4 h-4"},null,n)),a(` ${t.ssrInterpolate(j.value?"Consumiendo...":"Consumir sesi√≥n")}</button>`)):a("\x3c!----\x3e"),a('<button class="flex items-center gap-1.5 px-3 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors" data-v-4ed07fa5>'),a(t.ssrRenderComponent(e.unref(c),{class:"w-4 h-4"},null,n)),a('<span class="hidden sm:inline" data-v-4ed07fa5>Editar</span></button><button class="flex items-center gap-1.5 px-3 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors" data-v-4ed07fa5>'),a(t.ssrRenderComponent(e.unref(render$3),{class:"w-4 h-4"},null,n)),a('<span class="hidden sm:inline" data-v-4ed07fa5>Ver m√°s</span></button></div></div>')):(a('<div class="p-4 bg-gray-50 border border-gray-100 rounded-lg text-center" data-v-4ed07fa5><p class="text-sm text-gray-500 mb-3" data-v-4ed07fa5>Este paciente no tiene bono activo</p><button class="inline-flex items-center gap-1.5 px-3 py-2 text-sm font-medium text-purple-600 hover:text-purple-700 hover:bg-purple-50 rounded-lg transition-colors" data-v-4ed07fa5>'),a(t.ssrRenderComponent(e.unref(b),{class:"w-4 h-4"},null,n)),a(" Crear bono </button></div>")),a("</div>")):a("\x3c!----\x3e"),a("</div>"),M.value.observaciones?(a('<div class="mx-5 mb-4" data-v-4ed07fa5><button class="w-full flex items-center justify-between px-4 py-3 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors" data-v-4ed07fa5><span class="text-sm font-medium text-gray-700" data-v-4ed07fa5>Observaciones</span>'),t.ssrRenderVNode(a,e.createVNode(e.resolveDynamicComponent(R.value?e.unref(render$2):e.unref(m)),{class:"w-4 h-4 text-gray-400"},null),n),a("</button>"),R.value?a(`<div class="mt-2 px-4 py-3 bg-gray-50 rounded-lg overflow-hidden" data-v-4ed07fa5><p class="text-sm text-gray-700 whitespace-pre-wrap" data-v-4ed07fa5>${t.ssrInterpolate(M.value.observaciones)}</p></div>`):a("\x3c!----\x3e"),a("</div>")):a("\x3c!----\x3e"),a(`<div class="px-5 py-3 border-t border-gray-100 flex items-center justify-between text-xs text-gray-400" data-v-4ed07fa5><span data-v-4ed07fa5>ID: ${t.ssrInterpolate(M.value.id.substring(0,8))}...</span><div class="flex items-center gap-3" data-v-4ed07fa5><button class="hover:text-gray-600 transition-colors" data-v-4ed07fa5>Ver historial</button><span data-v-4ed07fa5>|</span><button class="hover:text-red-500 transition-colors" data-v-4ed07fa5>Cancelar cita</button></div></div>`),J.value?(a(`<div class="px-5 pb-4" data-v-4ed07fa5><button${t.ssrIncludeBooleanAttr(h.value)?" disabled":""} class="w-full py-3 bg-emerald-600 hover:bg-emerald-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 flex items-center justify-center gap-2" data-v-4ed07fa5>`),h.value?a('<svg class="w-5 h-5 animate-spin" fill="none" viewBox="0 0 24 24" data-v-4ed07fa5><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" data-v-4ed07fa5></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z" data-v-4ed07fa5></path></svg>'):a(t.ssrRenderComponent(e.unref(i),{class:"w-5 h-5"},null,n)),a(` ${t.ssrInterpolate(h.value?"Confirmando...":"Confirmar cita")}</button></div>`)):a("\x3c!----\x3e"),a("\x3c!--]--\x3e")),a("</div>")):(a('<div class="flex-1 flex items-center justify-center p-12 text-center" data-v-4ed07fa5><div data-v-4ed07fa5><div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3" data-v-4ed07fa5>'),a(t.ssrRenderComponent(e.unref(l),{class:"w-6 h-6 text-gray-400"},null,n)),a(`</div><p class="text-gray-600 font-medium" data-v-4ed07fa5>No se encontraron datos</p><p class="text-gray-400 text-sm mt-1" data-v-4ed07fa5>ID: ${t.ssrInterpolate(s.citaId?.substring(0,8))}...</p></div></div>`)),a("</div></div>")):a("\x3c!----\x3e"),T.value?a(t.ssrRenderComponent(V,{mostrar:S.value,"paciente-id":T.value.id,"paciente-nombre":T.value.nombre_completo||"Paciente","bono-existente":P.value,onClose:e=>{S.value=!1,P.value=null},onCreated:handleBonoCreado,onUpdated:handleBonoActualizado},null,n)):a("\x3c!----\x3e")},"body",!1,n)}}}),S=$.setup;$.setup=(a,t)=>{const o=e.useSSRContext();return(o.modules||(o.modules=new Set)).add("components/ModalDetallesCita.vue"),S?S(a,t):void 0};const P=Object.assign(x($,[["__scopeId","data-v-4ed07fa5"]]),{__name:"ModalDetallesCita"});export{P as M,usePayments as u};
//# sourceMappingURL=ModalDetallesCita-LTSdOklK.mjs.map
