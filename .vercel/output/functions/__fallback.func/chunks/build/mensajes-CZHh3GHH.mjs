import{e,_ as t}from"./server.mjs";import{defineComponent as r,ref as o,resolveComponent as s,withCtx as a,unref as n,createVNode as l,createBlock as i,withDirectives as d,isRef as c,openBlock as p,Fragment as u,renderList as m,toDisplayString as b,vModelSelect as x,vModelText as f,useSSRContext as v}from"vue";import{ssrRenderAttrs as h,ssrRenderComponent as g,ssrIncludeBooleanAttr as w,ssrLooseContain as D,ssrLooseEqual as $,ssrRenderList as y,ssrRenderAttr as A,ssrInterpolate as j}from"vue/server-renderer";import{u as F}from"./useSupabaseClient-DykwVqLQ.mjs";import{u as E}from"./useSupabase-DljD0dj8.mjs";import"../nitro/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"../routes/renderer.mjs";import"unhead/server";import"devalue";import"unhead/plugins";import"unhead/utils";import"vue-router";import"@supabase/ssr";import"@vercel/analytics/nuxt";const C=r({__name:"mensajes",__ssrInlineRender:!0,setup(r){const v=F();e();const{getUserId:C}=E(),k=o([]),S=o(null),_=o(""),obtenerIniciales=e=>e.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2),enviarMensajeInterno=async()=>{if(_.value.trim()&&S.value)try{const e=C();if(!e)return void alert("❌ No estás autenticado");const{error:t}=await v.from("mensajes").insert({remitente_id:e,destinatario_id:S.value.id,mensaje:_.value,visto:!1});if(t)throw t;alert("✅ Mensaje enviado exitosamente"),_.value=""}catch(e){console.error("Error:",e),alert("❌ Error al enviar mensaje")}},abrirWhatsApp=()=>{if(!_.value.trim()||!S.value.telefono)return;const e=S.value.telefono.replace(/\D/g,""),t=encodeURIComponent(_.value);(void 0).open(`https://wa.me/${e}?text=${t}`,"_blank")};return(e,r,o,v)=>{const F=t,E=s("Icon");r(`<div${h(v)}>`),r(g(F,{name:"coordinacion"},{default:a((e,t,r,o)=>{if(!t)return[l("div",{class:"mb-8"},[l("h1",{class:"text-3xl font-lora font-bold text-[#5D4A44] mb-2"}," Mensajería "),l("p",{class:"text-[#8B7470]"}," Comunicación con pacientes y terapeutas ")]),l("div",{class:"bg-white rounded-xl shadow-md border border-[#E8DFD8] p-6 mb-6"},[l("label",{class:"block text-sm font-medium text-[#5D4A44] mb-3"}," Seleccionar paciente "),d(l("select",{"onUpdate:modelValue":e=>c(S)?S.value=e:null,class:"w-full px-4 py-3 border border-[#E8DFD8] rounded-lg focus:ring-2 focus:ring-[#D8AFA0] focus:border-transparent"},[l("option",{value:""},"-- Selecciona un paciente --"),(p(!0),i(u,null,m(n(k),e=>(p(),i("option",{key:e.id,value:e},b(e.nombre),9,["value"]))),128))],8,["onUpdate:modelValue"]),[[x,n(S)]])]),n(S)?(p(),i("div",{key:0,class:"bg-white rounded-xl shadow-md border border-[#E8DFD8] p-6"},[l("div",{class:"mb-4 flex items-center space-x-3"},[l("div",{class:"w-12 h-12 rounded-full bg-gradient-to-br from-[#D8AFA0] to-[#C49484] flex items-center justify-center"},[l("span",{class:"text-white font-semibold"},b(obtenerIniciales(n(S).nombre)),1)]),l("div",null,[l("p",{class:"font-semibold text-[#5D4A44]"},b(n(S).nombre),1),l("p",{class:"text-sm text-[#8B7470]"},b(n(S).telefono),1)])]),d(l("textarea",{"onUpdate:modelValue":e=>c(_)?_.value=e:null,placeholder:"Escribe tu mensaje aquí...",rows:"5",class:"w-full px-4 py-3 border border-[#E8DFD8] rounded-lg focus:ring-2 focus:ring-[#D8AFA0] focus:border-transparent resize-none mb-4"},null,8,["onUpdate:modelValue"]),[[f,n(_)]]),l("div",{class:"flex space-x-3"},[l("button",{onClick:enviarMensajeInterno,disabled:!n(_).trim(),class:"flex-1 px-6 py-3 bg-[#D8AFA0] text-white rounded-lg hover:bg-[#C49484] transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[l(E,{name:"heroicons:paper-airplane",class:"w-5 h-5"}),l("span",null,"Enviar mensaje interno")],8,["disabled"]),l("button",{onClick:abrirWhatsApp,disabled:!n(_).trim(),class:"flex-1 px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[l(E,{name:"heroicons:chat-bubble-oval-left-ellipsis",class:"w-5 h-5"}),l("span",null,"Abrir WhatsApp")],8,["disabled"])])])):(p(),i("div",{key:1,class:"bg-white rounded-xl shadow-md border border-[#E8DFD8] p-12 text-center"},[l(E,{name:"heroicons:chat-bubble-left-right",class:"w-20 h-20 mx-auto text-[#D8AFA0] opacity-30 mb-4"}),l("p",{class:"text-[#8B7470]"},"Selecciona un paciente para comenzar")]))];t(`<div class="mb-8"${o}><h1 class="text-3xl font-lora font-bold text-[#5D4A44] mb-2"${o}> Mensajería </h1><p class="text-[#8B7470]"${o}> Comunicación con pacientes y terapeutas </p></div><div class="bg-white rounded-xl shadow-md border border-[#E8DFD8] p-6 mb-6"${o}><label class="block text-sm font-medium text-[#5D4A44] mb-3"${o}> Seleccionar paciente </label><select class="w-full px-4 py-3 border border-[#E8DFD8] rounded-lg focus:ring-2 focus:ring-[#D8AFA0] focus:border-transparent"${o}><option value=""${w(Array.isArray(n(S))?D(n(S),""):$(n(S),""))?" selected":""}${o}>-- Selecciona un paciente --</option>\x3c!--[--\x3e`),y(n(k),e=>{t(`<option${A("value",e)}${w(Array.isArray(n(S))?D(n(S),e):$(n(S),e))?" selected":""}${o}>${j(e.nombre)}</option>`)}),t("\x3c!--]--\x3e</select></div>"),n(S)?(t(`<div class="bg-white rounded-xl shadow-md border border-[#E8DFD8] p-6"${o}><div class="mb-4 flex items-center space-x-3"${o}><div class="w-12 h-12 rounded-full bg-gradient-to-br from-[#D8AFA0] to-[#C49484] flex items-center justify-center"${o}><span class="text-white font-semibold"${o}>${j(obtenerIniciales(n(S).nombre))}</span></div><div${o}><p class="font-semibold text-[#5D4A44]"${o}>${j(n(S).nombre)}</p><p class="text-sm text-[#8B7470]"${o}>${j(n(S).telefono)}</p></div></div><textarea placeholder="Escribe tu mensaje aquí..." rows="5" class="w-full px-4 py-3 border border-[#E8DFD8] rounded-lg focus:ring-2 focus:ring-[#D8AFA0] focus:border-transparent resize-none mb-4"${o}>${j(n(_))}</textarea><div class="flex space-x-3"${o}><button${w(!n(_).trim())?" disabled":""} class="flex-1 px-6 py-3 bg-[#D8AFA0] text-white rounded-lg hover:bg-[#C49484] transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"${o}>`),t(g(E,{name:"heroicons:paper-airplane",class:"w-5 h-5"},null,r,o)),t(`<span${o}>Enviar mensaje interno</span></button><button${w(!n(_).trim())?" disabled":""} class="flex-1 px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"${o}>`),t(g(E,{name:"heroicons:chat-bubble-oval-left-ellipsis",class:"w-5 h-5"},null,r,o)),t(`<span${o}>Abrir WhatsApp</span></button></div></div>`)):(t(`<div class="bg-white rounded-xl shadow-md border border-[#E8DFD8] p-12 text-center"${o}>`),t(g(E,{name:"heroicons:chat-bubble-left-right",class:"w-20 h-20 mx-auto text-[#D8AFA0] opacity-30 mb-4"},null,r,o)),t(`<p class="text-[#8B7470]"${o}>Selecciona un paciente para comenzar</p></div>`))}),_:1},o)),r("</div>")}}}),k=C.setup;C.setup=(e,t)=>{const r=v();return(r.modules||(r.modules=new Set)).add("pages/coordinacion/mensajes.vue"),k?k(e,t):void 0};export{C as default};
//# sourceMappingURL=mensajes-CZHh3GHH.mjs.map
