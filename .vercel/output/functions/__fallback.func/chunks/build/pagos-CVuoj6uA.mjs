import{_ as a}from"./nuxt-link-C_f1d2Rj.mjs";import{v as e,s}from"./server.mjs";import{r as t}from"./MagnifyingGlassIcon-GsbNDyPZ.mjs";import{r as n}from"./XMarkIcon-DCLwyE-W.mjs";import{r as o}from"./ClipboardDocumentListIcon-tIc_vSd1.mjs";import{r}from"./PlusIcon-CHLzv-V9.mjs";import{_ as d}from"./_plugin-vue_export-helper-1tPrXgE0.mjs";import{r as i}from"./ClockIcon-BxdFtPqx.mjs";import{r as l}from"./CurrencyEuroIcon-DCwNI2Go.mjs";import{r as c}from"./ExclamationTriangleIcon-DQdM2y0F.mjs";import{r as p}from"./CheckCircleIcon-DZf4GX3q.mjs";import{r as v}from"./CheckCircleIcon-CT9fzVFs.mjs";import{r as u}from"./ChartBarIcon-BEEST7f0.mjs";import{r as m}from"./CalendarIcon-BrsGHJBC.mjs";import{r as f}from"./CheckBadgeIcon-DjhxLc-3.mjs";import{r as b}from"./ChevronRightIcon-4xxNHuWW.mjs";import{u as g}from"./useSupabaseClient-DykwVqLQ.mjs";import"../nitro/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"../routes/renderer.mjs";import"../_/shared.cjs.prod.mjs";import"../virtual/_commonjsHelpers.mjs";import"node:stream";import"../_/index2.mjs";import"@supabase/supabase-js";import"@vercel/analytics/nuxt";function render(a,s){return e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e.createElementVNode("path",{d:"M12 7.5a2.25 2.25 0 1 0 0 4.5 2.25 2.25 0 0 0 0-4.5Z"}),e.createElementVNode("path",{"fill-rule":"evenodd",d:"M1.5 4.875C1.5 3.839 2.34 3 3.375 3h17.25c1.035 0 1.875.84 1.875 1.875v9.75c0 1.036-.84 1.875-1.875 1.875H3.375A1.875 1.875 0 0 1 1.5 14.625v-9.75ZM8.25 9.75a3.75 3.75 0 1 1 7.5 0 3.75 3.75 0 0 1-7.5 0ZM18.75 9a.75.75 0 0 0-.75.75v.008c0 .414.336.75.75.75h.008a.75.75 0 0 0 .75-.75V9.75a.75.75 0 0 0-.75-.75h-.008ZM4.5 9.75A.75.75 0 0 1 5.25 9h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75H5.25a.75.75 0 0 1-.75-.75V9.75Z","clip-rule":"evenodd"}),e.createElementVNode("path",{d:"M2.25 18a.75.75 0 0 0 0 1.5c5.4 0 10.63.722 15.6 2.075 1.19.324 2.4-.558 2.4-1.82V18.75a.75.75 0 0 0-.75-.75H2.25Z"})])}const h=e.defineComponent({__name:"PagosHeader",__ssrInlineRender:!0,props:{busqueda:{default:""},totalPendientes:{default:0},totalConfirmados:{default:0}},emits:["update:busqueda","registrar-pago","nueva-tarea"],setup(a,{emit:d}){const i=a,l=e.ref(i.busqueda);return e.watch(()=>i.busqueda,a=>{l.value=a}),(d,i,c,p)=>{i(`<header${s.ssrRenderAttrs(e.mergeProps({class:"pagos-header"},p))} data-v-a8583995><div class="header-left" data-v-a8583995><div class="header-icon" data-v-a8583995>`),i(s.ssrRenderComponent(e.unref(render),{class:"w-6 h-6 text-white"},null,c)),i('</div><div class="header-text" data-v-a8583995><h1 class="header-title" data-v-a8583995>Pagos y Bonos</h1><p class="header-subtitle" data-v-a8583995>Gestión de cobros y seguimiento financiero</p></div></div><div class="header-center" data-v-a8583995><div class="search-container" data-v-a8583995>'),i(s.ssrRenderComponent(e.unref(t),{class:"search-icon"},null,c)),i(`<input${s.ssrRenderAttr("value",e.unref(l))} type="search" placeholder="Buscar por paciente, bono o referencia..." class="search-input" aria-label="Buscar en pagos" data-v-a8583995>`),e.unref(l)?(i('<button class="search-clear" aria-label="Limpiar búsqueda" data-v-a8583995>'),i(s.ssrRenderComponent(e.unref(n),{class:"w-4 h-4"},null,c)),i("</button>")):i("\x3c!----\x3e"),i(`</div></div><div class="header-right" data-v-a8583995><div class="header-stats" data-v-a8583995><div class="${s.ssrRenderClass([{"has-pending":a.totalPendientes>0},"stat-item"])}" data-v-a8583995><span class="stat-value" data-v-a8583995>${s.ssrInterpolate(a.totalPendientes)}</span><span class="stat-label" data-v-a8583995>Pendientes</span></div><div class="stat-divider" data-v-a8583995></div><div class="stat-item confirmed" data-v-a8583995><span class="stat-value" data-v-a8583995>${s.ssrInterpolate(a.totalConfirmados)}</span><span class="stat-label" data-v-a8583995>Confirmados</span></div></div><button class="action-btn action-btn-secondary" aria-label="Crear nueva tarea" data-v-a8583995>`),i(s.ssrRenderComponent(e.unref(o),{class:"w-4 h-4"},null,c)),i('<span class="hidden sm:inline" data-v-a8583995>Nueva tarea</span></button><button class="action-btn action-btn-primary" aria-label="Registrar nuevo pago" data-v-a8583995>'),i(s.ssrRenderComponent(e.unref(r),{class:"w-4 h-4"},null,c)),i("<span data-v-a8583995>Registrar pago</span></button></div></header>")}}}),_=h.setup;h.setup=(a,s)=>{const t=e.useSSRContext();return(t.modules||(t.modules=new Set)).add("components/pagos/PagosHeader.vue"),_?_(a,s):void 0};const C=Object.assign(d(h,[["__scopeId","data-v-a8583995"]]),{__name:"PagosHeader"}),w=e.defineComponent({__name:"PagosPendientesModule",__ssrInlineRender:!0,props:{bonos:{},cargando:{type:Boolean,default:!1},procesandoConfirmacion:{type:Boolean,default:!1}},emits:["confirmar-pago","ver-detalle"],setup(o,{emit:r}){const d=o,u=e.ref(""),m=e.ref("todos"),f=e.computed(()=>{let a=[...d.bonos];if(u.value.trim()){const e=u.value.toLowerCase().trim();a=a.filter(a=>{const s=(a.paciente_nombre||"").toLowerCase(),t=(a.terapeuta_nombre||"").toLowerCase(),n=(a.tipo_bono||"").toLowerCase();return s.includes(e)||t.includes(e)||n.includes(e)})}return"urgentes"===m.value?a=a.filter(a=>a.sesiones_restantes<=1):"normales"===m.value&&(a=a.filter(a=>a.sesiones_restantes>1)),a}),b=e.computed(()=>d.bonos.length),g=e.computed(()=>d.bonos.reduce((a,e)=>a+(Number(e.monto_total)||0),0)),h=e.computed(()=>f.value.reduce((a,e)=>a+(Number(e.monto_total)||0),0)),_=e.computed(()=>d.bonos.filter(a=>a.sesiones_restantes<=1).length),formatearPrecio=a=>new Intl.NumberFormat("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2}).format(a||0),getUrgenciaClass=a=>0===a?"urgencia-critica":1===a?"urgencia-alta":2===a?"urgencia-media":"urgencia-normal",getEstadoBadgeClass=a=>{switch(a){case"activo":return"badge-activo";case"pendiente":return"badge-pendiente";case"agotado":return"badge-agotado";default:return"badge-default"}};return(r,d,C,w)=>{const x=a;d(`<section${s.ssrRenderAttrs(e.mergeProps({class:"pendientes-module"},w))} data-v-d50e1cf4><header class="module-header" data-v-d50e1cf4><div class="header-info" data-v-d50e1cf4><div class="header-icon" data-v-d50e1cf4>`),d(s.ssrRenderComponent(e.unref(i),{class:"w-6 h-6 text-white"},null,C)),d(`</div><div class="header-text" data-v-d50e1cf4><h2 class="header-title" data-v-d50e1cf4>Bonos Pendientes de Confirmar</h2><p class="header-subtitle" data-v-d50e1cf4>Pagos reportados por terapeutas que requieren confirmación</p></div></div><div class="${s.ssrRenderClass([{"has-pending":e.unref(b)>0},"header-counter"])}" data-v-d50e1cf4><span class="counter-value" data-v-d50e1cf4>${s.ssrInterpolate(e.unref(b))}</span><span class="counter-label" data-v-d50e1cf4>Pendientes</span></div></header><div class="metrics-grid" data-v-d50e1cf4><div class="metric-card metric-monto" data-v-d50e1cf4><div class="metric-icon" data-v-d50e1cf4>`),d(s.ssrRenderComponent(e.unref(l),{class:"w-6 h-6"},null,C)),d(`</div><div class="metric-content" data-v-d50e1cf4><span class="metric-label" data-v-d50e1cf4>Total por Confirmar</span><span class="metric-value" data-v-d50e1cf4>${s.ssrInterpolate(formatearPrecio(e.unref(u)?e.unref(h):e.unref(g)))}€</span>`),e.unref(u)?d(`<span class="metric-detail" data-v-d50e1cf4>de ${s.ssrInterpolate(formatearPrecio(e.unref(g)))}€</span>`):d("\x3c!----\x3e"),d(`</div></div><div class="${s.ssrRenderClass([{"has-urgent":e.unref(_)>0},"metric-card metric-urgentes"])}" data-v-d50e1cf4><div class="metric-icon" data-v-d50e1cf4>`),d(s.ssrRenderComponent(e.unref(c),{class:"w-6 h-6"},null,C)),d(`</div><div class="metric-content" data-v-d50e1cf4><span class="metric-label" data-v-d50e1cf4>Requieren Atención</span><span class="metric-value" data-v-d50e1cf4>${s.ssrInterpolate(e.unref(_))}</span><span class="metric-detail" data-v-d50e1cf4>Pocas sesiones restantes</span></div></div><div class="metric-card metric-confirmados" data-v-d50e1cf4><div class="metric-icon" data-v-d50e1cf4>`),d(s.ssrRenderComponent(e.unref(p),{class:"w-6 h-6"},null,C)),d(`</div><div class="metric-content" data-v-d50e1cf4><span class="metric-label" data-v-d50e1cf4>Resultados</span><span class="metric-value" data-v-d50e1cf4>${s.ssrInterpolate(e.unref(f).length)}</span>`),e.unref(u)||"todos"!==e.unref(m)?d(`<span class="metric-detail" data-v-d50e1cf4> de ${s.ssrInterpolate(e.unref(b))} totales </span>`):d('<span class="metric-detail" data-v-d50e1cf4>Bonos pendientes</span>'),d('</div></div></div><div class="filter-bar" data-v-d50e1cf4><div class="search-container" data-v-d50e1cf4>'),d(s.ssrRenderComponent(e.unref(t),{class:"search-icon"},null,C)),d(`<input${s.ssrRenderAttr("value",e.unref(u))} type="search" placeholder="Buscar paciente, terapeuta o tipo de bono..." class="search-input" aria-label="Buscar en bonos pendientes" data-v-d50e1cf4>`),e.unref(u)?(d('<button class="search-clear" aria-label="Limpiar búsqueda" data-v-d50e1cf4>'),d(s.ssrRenderComponent(e.unref(n),{class:"w-4 h-4"},null,C)),d("</button>")):d("\x3c!----\x3e"),d(`</div><div class="urgency-filters" data-v-d50e1cf4><button class="${s.ssrRenderClass([{active:"todos"===e.unref(m)},"filter-chip"])}" data-v-d50e1cf4> Todos </button><button class="${s.ssrRenderClass([{active:"urgentes"===e.unref(m)},"filter-chip filter-urgente"])}" data-v-d50e1cf4>`),d(s.ssrRenderComponent(e.unref(c),{class:"w-3.5 h-3.5"},null,C)),d(" Urgentes "),e.unref(_)>0?d(`<span class="chip-count" data-v-d50e1cf4>${s.ssrInterpolate(e.unref(_))}</span>`):d("\x3c!----\x3e"),d(`</button><button class="${s.ssrRenderClass([{active:"normales"===e.unref(m)},"filter-chip"])}" data-v-d50e1cf4> Normales </button></div></div><div class="bonos-list" data-v-d50e1cf4>`),o.cargando?(d('<div class="loading-container" data-v-d50e1cf4>\x3c!--[--\x3e'),s.ssrRenderList(3,a=>{d('<div class="loading-skeleton" data-v-d50e1cf4></div>')}),d("\x3c!--]--\x3e</div>")):e.unref(f).length>0?(d("\x3c!--[--\x3e"),s.ssrRenderList(e.unref(f),a=>{d(`<div class="${s.ssrRenderClass([getUrgenciaClass(a.sesiones_restantes),"bono-card"])}" data-v-d50e1cf4><div class="urgencia-indicator" data-v-d50e1cf4></div><div class="bono-avatar" data-v-d50e1cf4><span class="avatar-initials" data-v-d50e1cf4>${s.ssrInterpolate((a=>{if(!a)return"?";const e=a.split(" ");return e.length>=2?`${e[0][0]}${e[1][0]}`.toUpperCase():a.substring(0,2).toUpperCase()})(a.paciente_nombre))}</span>`),a.sesiones_restantes<=1?d(`<div class="${s.ssrRenderClass([{critico:0===a.sesiones_restantes},"urgencia-badge"])}" data-v-d50e1cf4> ! </div>`):d("\x3c!----\x3e"),d(`</div><div class="bono-content" data-v-d50e1cf4><div class="bono-main" data-v-d50e1cf4><h4 class="paciente-nombre" data-v-d50e1cf4>${s.ssrInterpolate(a.paciente_nombre)}</h4><div class="bono-tipo" data-v-d50e1cf4><span class="tipo-dot" data-v-d50e1cf4></span> ${s.ssrInterpolate(a.tipo_bono||"Bono Estándar")}</div></div><div class="bono-info-grid" data-v-d50e1cf4><div class="info-item" data-v-d50e1cf4><span class="info-label" data-v-d50e1cf4>Terapeuta</span><span class="info-value" data-v-d50e1cf4>${s.ssrInterpolate(a.terapeuta_nombre||"No asignado")}</span></div><div class="info-item" data-v-d50e1cf4><span class="info-label" data-v-d50e1cf4>Estado</span><span class="${s.ssrRenderClass([getEstadoBadgeClass(a.estado),"estado-badge"])}" data-v-d50e1cf4><span class="estado-dot" data-v-d50e1cf4></span> ${s.ssrInterpolate(a.estado)}</span></div><div class="info-item" data-v-d50e1cf4><span class="info-label" data-v-d50e1cf4>Sesiones</span><div class="sesiones-display" data-v-d50e1cf4><span class="${s.ssrRenderClass([getUrgenciaClass(a.sesiones_restantes),"sesiones-value"])}" data-v-d50e1cf4>${s.ssrInterpolate(a.sesiones_restantes)}</span><span class="sesiones-total" data-v-d50e1cf4>/ ${s.ssrInterpolate(a.sesiones_totales)}</span></div>`),a.sesiones_restantes<=1?(d(`<div class="${s.ssrRenderClass([getUrgenciaClass(a.sesiones_restantes),"sesiones-warning"])}" data-v-d50e1cf4>`),d(s.ssrRenderComponent(e.unref(c),{class:"w-3 h-3"},null,C)),d(` ${s.ssrInterpolate(0===a.sesiones_restantes?"¡AGOTADO!":"¡ÚLTIMA!")}</div>`)):d("\x3c!----\x3e"),d(`</div><div class="info-item info-monto" data-v-d50e1cf4><span class="info-label" data-v-d50e1cf4>Monto</span><span class="monto-value" data-v-d50e1cf4>${s.ssrInterpolate(formatearPrecio(a.monto_total))}€</span><span class="monto-estado" data-v-d50e1cf4>Por confirmar</span></div></div></div><div class="bono-action" data-v-d50e1cf4><button${s.ssrIncludeBooleanAttr(o.procesandoConfirmacion)?" disabled":""} class="btn-confirmar" aria-label="Confirmar pago" data-v-d50e1cf4>`),d(s.ssrRenderComponent(e.unref(v),{class:"w-5 h-5"},null,C)),d("<span data-v-d50e1cf4>Confirmar</span></button></div></div>")}),d("\x3c!--]--\x3e")):e.unref(u)||"todos"!==e.unref(m)?(d('<div class="empty-state empty-search" data-v-d50e1cf4><div class="empty-icon" data-v-d50e1cf4>'),d(s.ssrRenderComponent(e.unref(t),{class:"w-12 h-12"},null,C)),d('</div><h3 class="empty-title" data-v-d50e1cf4>No se encontraron resultados</h3><p class="empty-description" data-v-d50e1cf4> No hay bonos pendientes que coincidan con tu búsqueda </p><button class="btn-limpiar" data-v-d50e1cf4>'),d(s.ssrRenderComponent(e.unref(n),{class:"w-4 h-4"},null,C)),d(" Limpiar filtros </button></div>")):(d('<div class="empty-state empty-success" data-v-d50e1cf4><div class="empty-icon success" data-v-d50e1cf4>'),d(s.ssrRenderComponent(e.unref(p),{class:"w-12 h-12"},null,C)),d('</div><h3 class="empty-title" data-v-d50e1cf4>¡Todo al día!</h3><p class="empty-description" data-v-d50e1cf4> No hay bonos pendientes de confirmar pago </p>'),d(s.ssrRenderComponent(x,{to:"/coordinadora/pacientes",class:"btn-navegar"},{default:e.withCtx((a,s,t,n)=>{if(!s)return[e.createTextVNode(" Gestionar Pacientes "),(e.openBlock(),e.createBlock("svg",{class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e.createVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})]))];s(` Gestionar Pacientes <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-d50e1cf4${n}><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" data-v-d50e1cf4${n}></path></svg>`)}),_:1},C)),d("</div>")),d("</div></section>")}}}),x=w.setup;w.setup=(a,s)=>{const t=e.useSSRContext();return(t.modules||(t.modules=new Set)).add("components/pagos/PagosPendientesModule.vue"),x?x(a,s):void 0};const $=Object.assign(d(w,[["__scopeId","data-v-d50e1cf4"]]),{__name:"PagosPendientesModule"}),y=e.defineComponent({__name:"PagosHistorialModule",__ssrInlineRender:!0,props:{bonos:{},cargando:{type:Boolean,default:!1},mesesDisponibles:{default:()=>[]},mesSeleccionado:{default:""}},emits:["ver-detalle","cambiar-mes"],setup(a,{emit:o}){const r=a,d=e.ref(""),i=e.ref(r.mesSeleccionado);e.watch(()=>r.mesSeleccionado,a=>{i.value=a});const c=e.computed(()=>{if(!d.value.trim())return r.bonos;const a=d.value.toLowerCase().trim();return r.bonos.filter(e=>{const s=(e.paciente_nombre||"").toLowerCase(),t=(e.terapeuta_nombre||"").toLowerCase(),n=(e.tipo_bono||"").toLowerCase();return s.includes(a)||t.includes(a)||n.includes(a)})}),v=e.computed(()=>r.bonos.length),g=e.computed(()=>r.bonos.reduce((a,e)=>a+(Number(e.monto_total)||0),0)),h=e.computed(()=>c.value.reduce((a,e)=>a+(Number(e.monto_total)||0),0)),_=e.computed(()=>0===r.bonos.length?0:g.value/r.bonos.length),C=e.computed(()=>0===c.value.length?0:h.value/c.value.length),formatearPrecio=a=>new Intl.NumberFormat("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2}).format(a||0);return(o,r,w,x)=>{r(`<section${s.ssrRenderAttrs(e.mergeProps({class:"historial-module"},x))} data-v-9a840a78><header class="module-header" data-v-9a840a78><div class="header-info" data-v-9a840a78><div class="header-icon" data-v-9a840a78>`),r(s.ssrRenderComponent(e.unref(u),{class:"w-6 h-6 text-white"},null,w)),r('</div><div class="header-text" data-v-9a840a78><h2 class="header-title" data-v-9a840a78>Historial de Pagos Confirmados</h2><p class="header-subtitle" data-v-9a840a78>Bonos ya registrados y confirmados por coordinación</p></div></div><div class="mes-selector" data-v-9a840a78>'),r(s.ssrRenderComponent(e.unref(m),{class:"selector-icon"},null,w)),r(`<select class="mes-select" aria-label="Filtrar por mes" data-v-9a840a78><option value="" data-v-9a840a78${s.ssrIncludeBooleanAttr(Array.isArray(e.unref(i))?s.ssrLooseContain(e.unref(i),""):s.ssrLooseEqual(e.unref(i),""))?" selected":""}>Todos los meses</option>\x3c!--[--\x3e`),s.ssrRenderList(a.mesesDisponibles,a=>{r(`<option${s.ssrRenderAttr("value",a.valor)} data-v-9a840a78${s.ssrIncludeBooleanAttr(Array.isArray(e.unref(i))?s.ssrLooseContain(e.unref(i),a.valor):s.ssrLooseEqual(e.unref(i),a.valor))?" selected":""}>${s.ssrInterpolate(a.nombre)}</option>`)}),r('\x3c!--]--\x3e</select></div></header><div class="metrics-grid" data-v-9a840a78><div class="metric-card metric-confirmados" data-v-9a840a78><div class="metric-icon" data-v-9a840a78>'),r(s.ssrRenderComponent(e.unref(f),{class:"w-6 h-6"},null,w)),r(`</div><div class="metric-content" data-v-9a840a78><span class="metric-label" data-v-9a840a78>Bonos Confirmados</span><span class="metric-value" data-v-9a840a78>${s.ssrInterpolate(e.unref(c).length)}</span>`),e.unref(d)?r(`<span class="metric-detail" data-v-9a840a78>de ${s.ssrInterpolate(e.unref(v))} total</span>`):r("\x3c!----\x3e"),r('</div></div><div class="metric-card metric-total" data-v-9a840a78><div class="metric-icon" data-v-9a840a78>'),r(s.ssrRenderComponent(e.unref(l),{class:"w-6 h-6"},null,w)),r(`</div><div class="metric-content" data-v-9a840a78><span class="metric-label" data-v-9a840a78>Total Confirmado</span><span class="metric-value" data-v-9a840a78>${s.ssrInterpolate(formatearPrecio(e.unref(d)?e.unref(h):e.unref(g)))}€</span>`),e.unref(d)?r(`<span class="metric-detail" data-v-9a840a78>de ${s.ssrInterpolate(formatearPrecio(e.unref(g)))}€</span>`):r("\x3c!----\x3e"),r('</div></div><div class="metric-card metric-promedio" data-v-9a840a78><div class="metric-icon" data-v-9a840a78>'),r(s.ssrRenderComponent(e.unref(u),{class:"w-6 h-6"},null,w)),r(`</div><div class="metric-content" data-v-9a840a78><span class="metric-label" data-v-9a840a78>Promedio por Bono</span><span class="metric-value" data-v-9a840a78>${s.ssrInterpolate(formatearPrecio(e.unref(d)?e.unref(C):e.unref(_)))}€</span>`),e.unref(d)?r(`<span class="metric-detail" data-v-9a840a78>de ${s.ssrInterpolate(formatearPrecio(e.unref(_)))}€</span>`):r("\x3c!----\x3e"),r('</div></div></div><div class="search-bar" data-v-9a840a78><div class="search-container" data-v-9a840a78>'),r(s.ssrRenderComponent(e.unref(t),{class:"search-icon"},null,w)),r(`<input${s.ssrRenderAttr("value",e.unref(d))} type="search" placeholder="Buscar paciente, terapeuta o tipo de bono..." class="search-input" aria-label="Buscar en historial" data-v-9a840a78>`),e.unref(d)?(r(`<div class="search-actions" data-v-9a840a78><span class="search-count" data-v-9a840a78>${s.ssrInterpolate(e.unref(c).length)} resultado${s.ssrInterpolate(1!==e.unref(c).length?"s":"")}</span><button class="search-clear" aria-label="Limpiar búsqueda" data-v-9a840a78>`),r(s.ssrRenderComponent(e.unref(n),{class:"w-4 h-4"},null,w)),r("</button></div>")):r("\x3c!----\x3e"),r('</div></div><div class="bonos-list" data-v-9a840a78>'),a.cargando?(r('<div class="loading-container" data-v-9a840a78>\x3c!--[--\x3e'),s.ssrRenderList(4,a=>{r('<div class="loading-skeleton" data-v-9a840a78></div>')}),r("\x3c!--]--\x3e</div>")):e.unref(c).length>0?(r("\x3c!--[--\x3e"),s.ssrRenderList(e.unref(c),a=>{var t;r(`<div class="bono-card" data-v-9a840a78><div class="confirmado-indicator" data-v-9a840a78></div><div class="bono-avatar" data-v-9a840a78><span class="avatar-initials" data-v-9a840a78>${s.ssrInterpolate((a=>{if(!a)return"?";const e=a.split(" ");return e.length>=2?`${e[0][0]}${e[1][0]}`.toUpperCase():a.substring(0,2).toUpperCase()})(a.paciente_nombre))}</span><div class="confirmado-badge" data-v-9a840a78><svg class="w-3 h-3 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3" data-v-9a840a78><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" data-v-9a840a78></path></svg></div></div><div class="bono-content" data-v-9a840a78><div class="bono-main" data-v-9a840a78><h4 class="paciente-nombre" data-v-9a840a78>${s.ssrInterpolate(a.paciente_nombre)}</h4><div class="bono-tipo" data-v-9a840a78><span class="tipo-dot" data-v-9a840a78></span> ${s.ssrInterpolate(a.tipo_bono||"Bono Estándar")}</div></div><div class="bono-info-grid" data-v-9a840a78><div class="info-item" data-v-9a840a78><span class="info-label" data-v-9a840a78>Terapeuta</span><span class="info-value" data-v-9a840a78>${s.ssrInterpolate(a.terapeuta_nombre||"No asignado")}</span></div><div class="info-item" data-v-9a840a78><span class="info-label" data-v-9a840a78>Fecha Pago</span><span class="info-value" data-v-9a840a78>${s.ssrInterpolate((t=a.fecha_pago,t?new Date(t).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"}):"No especificada"))}</span></div><div class="info-item" data-v-9a840a78><span class="info-label" data-v-9a840a78>Sesiones</span><div class="sesiones-display" data-v-9a840a78><span class="sesiones-value" data-v-9a840a78>${s.ssrInterpolate(a.sesiones_restantes)}</span><span class="sesiones-total" data-v-9a840a78>/ ${s.ssrInterpolate(a.sesiones_totales)}</span></div></div><div class="info-item info-monto" data-v-9a840a78><span class="info-label" data-v-9a840a78>Monto</span><span class="monto-value" data-v-9a840a78>${s.ssrInterpolate(formatearPrecio(a.monto_total))}€</span><span class="estado-confirmado" data-v-9a840a78>`),r(s.ssrRenderComponent(e.unref(p),{class:"w-3 h-3"},null,w)),r(' Confirmado </span></div></div></div><div class="bono-arrow" data-v-9a840a78>'),r(s.ssrRenderComponent(e.unref(b),{class:"w-5 h-5"},null,w)),r("</div></div>")}),r("\x3c!--]--\x3e")):e.unref(d)?(r('<div class="empty-state empty-search" data-v-9a840a78><div class="empty-icon" data-v-9a840a78>'),r(s.ssrRenderComponent(e.unref(t),{class:"w-12 h-12"},null,w)),r(`</div><h3 class="empty-title" data-v-9a840a78>No se encontraron resultados</h3><p class="empty-description" data-v-9a840a78> No hay pagos confirmados que coincidan con &quot;${s.ssrInterpolate(e.unref(d))}&quot; </p><button class="btn-limpiar" data-v-9a840a78>`),r(s.ssrRenderComponent(e.unref(n),{class:"w-4 h-4"},null,w)),r(" Limpiar búsqueda </button></div>")):(r('<div class="empty-state empty-no-data" data-v-9a840a78><div class="empty-icon" data-v-9a840a78>'),r(s.ssrRenderComponent(e.unref(u),{class:"w-12 h-12"},null,w)),r(`</div><h3 class="empty-title" data-v-9a840a78>Sin historial de pagos</h3><p class="empty-description" data-v-9a840a78>${s.ssrInterpolate(e.unref(i)?"No hay pagos confirmados en este período":"Aún no se han confirmado pagos")}</p>`),e.unref(i)?(r('<button class="btn-limpiar" data-v-9a840a78>'),r(s.ssrRenderComponent(e.unref(m),{class:"w-4 h-4"},null,w)),r(" Ver todos los meses </button>")):r("\x3c!----\x3e"),r("</div>")),r("</div></section>")}}}),I=y.setup;y.setup=(a,s)=>{const t=e.useSSRContext();return(t.modules||(t.modules=new Set)).add("components/pagos/PagosHistorialModule.vue"),I?I(a,s):void 0};const R=Object.assign(d(y,[["__scopeId","data-v-9a840a78"]]),{__name:"PagosHistorialModule"}),P=e.defineComponent({__name:"pagos",__ssrInlineRender:!0,setup(t){const n=g(),o=e.ref(""),r=e.ref(!0),d=e.ref([]),i=e.ref(!1),l=e.ref(!0),c=e.ref([]),p=e.ref(0),v=e.ref(0),u=e.ref(""),m=e.ref([]),f=e.ref(!1),b=e.ref(null),h=e.computed(()=>d.value.length),_=e.computed(()=>c.value.length),cargarBonosPendientes=async()=>{console.log("[Pagos] Cargando bonos pendientes...");try{if(r.value=!0,!n)return console.error("[Pagos] Cliente Supabase no disponible"),void mostrarToast("Error: Cliente de base de datos no disponible","error");const{data:a,error:e}=await n.from("bonos").select("*").eq("estado_pago","pendiente").in("estado",["activo","pendiente"]).order("created_at",{ascending:!1});if(e)return console.error("[Pagos] Error al cargar bonos pendientes:",e),void mostrarToast(`Error al cargar bonos pendientes: ${e.message}`,"error");if(!a||0===a.length)return console.log("[Pagos] No hay bonos pendientes"),void(d.value=[]);const s=[...new Set(a.map(a=>a.paciente_id).filter(Boolean))];let t=new Map,o=new Map;if(s.length>0){const{data:a}=await n.from("pacientes").select("id, nombre_completo, email, terapeuta_id").in("id",s);if(a){a.forEach(a=>t.set(a.id,a));const e=[...new Set(a.map(a=>a.terapeuta_id).filter(Boolean))];if(e.length>0){const{data:a}=await n.from("terapeutas").select("id, nombre_completo").in("id",e);a&&a.forEach(a=>o.set(a.id,a))}}}d.value=a.map(a=>{const e=a.paciente_id?t.get(a.paciente_id):null,s=e?.terapeuta_id?o.get(e.terapeuta_id):null;return{id:a.id,paciente_id:a.paciente_id,paciente_nombre:e?.nombre_completo||"Sin nombre",paciente_email:e?.email||null,terapeuta_nombre:s?.nombre_completo||null,sesiones_totales:Number(a.sesiones_totales)||0,sesiones_restantes:Number(a.sesiones_restantes)||0,monto_total:Number(a.monto_total)||0,tipo_bono:a.tipo_bono||"Bono Estándar",estado:a.estado||"pendiente",created_at:a.created_at}}),console.log(`[Pagos] ${d.value.length} bonos pendientes cargados`)}catch(a){console.error("[Pagos] Error general:",a),mostrarToast(`Error al cargar bonos: ${a.message}`,"error"),d.value=[]}finally{r.value=!1}},cargarBonosConfirmados=async()=>{console.log("[Pagos] Cargando bonos confirmados...");try{if(l.value=!0,!n)return void console.error("[Pagos] Cliente Supabase no disponible");let a=n.from("bonos").select("*").eq("estado_pago","pagado").order("fecha_pago",{ascending:!1});if(u.value){const[e,s]=u.value.split("-"),t=parseInt(e),n=parseInt(s);if(!isNaN(t)&&!isNaN(n)&&n>=1&&n<=12){const e=new Date(t,n-1,1),s=new Date(t,n,0,23,59,59);a=a.gte("fecha_pago",e.toISOString()).lte("fecha_pago",s.toISOString())}}const{data:e,error:s}=await a;if(s)return console.error("[Pagos] Error al cargar bonos confirmados:",s),void mostrarToast(`Error al cargar historial: ${s.message}`,"error");if(!e||0===e.length)return console.log("[Pagos] No hay bonos confirmados"),c.value=[],p.value=0,void(v.value=0);const t=[...new Set(e.map(a=>a.paciente_id).filter(Boolean))];let o=new Map,r=new Map;if(t.length>0){const{data:a}=await n.from("pacientes").select("id, nombre_completo, email, terapeuta_id").in("id",t);if(a){a.forEach(a=>o.set(a.id,a));const e=[...new Set(a.map(a=>a.terapeuta_id).filter(Boolean))];if(e.length>0){const{data:a}=await n.from("terapeutas").select("id, nombre_completo").in("id",e);a&&a.forEach(a=>r.set(a.id,a))}}}c.value=e.map(a=>{const e=a.paciente_id?o.get(a.paciente_id):null,s=e?.terapeuta_id?r.get(e.terapeuta_id):null;return{id:a.id,paciente_id:a.paciente_id,paciente_nombre:e?.nombre_completo||"Sin nombre",paciente_email:e?.email||null,terapeuta_nombre:s?.nombre_completo||null,sesiones_totales:Number(a.sesiones_totales)||0,sesiones_restantes:Number(a.sesiones_restantes)||0,monto_total:Number(a.monto_total)||0,tipo_bono:a.tipo_bono||"Bono Estándar",fecha_pago:a.fecha_pago,metodo_pago:a.metodo_pago||"No especificado"}}),p.value=c.value.reduce((a,e)=>a+e.monto_total,0),v.value=c.value.length>0?p.value/c.value.length:0,console.log(`[Pagos] ${c.value.length} bonos confirmados cargados`)}catch(a){console.error("[Pagos] Error general:",a),mostrarToast(`Error al cargar historial: ${a.message}`,"error"),c.value=[]}finally{l.value=!1}},confirmarPago=async a=>{if(a&&a.id){console.log("[Pagos] Confirmando pago para bono:",a.id);try{i.value=!0;const e=await $fetch("/api/pagos/confirmar",{method:"POST",body:{bonoId:a.id,metodoPago:"coordinacion"}});if(!e||!e.success)throw new Error("Respuesta inválida del servidor");console.log("[Pagos] Pago confirmado exitosamente"),await Promise.all([cargarBonosPendientes(),cargarBonosConfirmados()]),mostrarToast("Pago confirmado exitosamente","success")}catch(a){console.error("[Pagos] Error al confirmar pago:",a);let e="Error al confirmar pago";401===a.status?e="No tienes permisos para confirmar pagos":403===a.status?e="Acceso denegado":404===a.status?e="El bono no existe o ya fue confirmado":409===a.status?e="El bono ya fue confirmado":a.message&&(e=a.message),mostrarToast(e,"error")}finally{i.value=!1}}else mostrarToast("Datos del bono inválidos","error")},verDetalleBono=a=>{b.value=a,f.value=!0},cambiarMes=a=>{u.value=a,cargarBonosConfirmados()},onRegistrarPago=()=>{console.log("[Pagos] Registrar pago")},onNuevaTarea=()=>{console.log("[Pagos] Nueva tarea")},mostrarToast=(a,e="info")=>{try{const s=(void 0).createElement("div"),t={success:"bg-emerald-600 text-white border-emerald-500",error:"bg-red-500 text-white border-red-400",warning:"bg-amber-500 text-white border-amber-400",info:"bg-neutral-800 text-white border-neutral-600"},n={success:"✓",error:"✕",warning:"⚠",info:"ℹ"};s.className=`fixed top-4 right-4 z-[100] px-5 py-3 rounded-lg shadow-xl flex items-center gap-3 transform translate-x-full transition-transform duration-300 border ${t[e]} max-w-sm`,s.innerHTML=`\n      <span class="text-lg flex-shrink-0">${n[e]}</span>\n      <span class="font-medium text-sm">${a}</span>\n    `,(void 0).body.appendChild(s),requestAnimationFrame(()=>{s.style.transform="translateX(0)"});setTimeout(()=>{s.style.transform="translateX(100%)",setTimeout(()=>{s.parentNode&&(void 0).body.removeChild(s)},300)},"error"===e?5e3:"warning"===e?4e3:3e3),s.addEventListener("click",()=>{s.style.transform="translateX(100%)",setTimeout(()=>{s.parentNode&&(void 0).body.removeChild(s)},300)}),s.style.cursor="pointer"}catch(a){console.error("[Pagos] Error al mostrar toast:",a)}};return(t,n,p,v)=>{const g=a;n(`<div${s.ssrRenderAttrs(e.mergeProps({class:"pagos-page"},v))} data-v-688b729c>`),n(s.ssrRenderComponent(C,{busqueda:e.unref(o),"total-pendientes":e.unref(h),"total-confirmados":e.unref(_),"onUpdate:busqueda":a=>o.value=a,onRegistrarPago:onRegistrarPago,onNuevaTarea:onNuevaTarea},null,p)),n('<div class="pagos-content" data-v-688b729c>'),n(s.ssrRenderComponent($,{bonos:e.unref(d),cargando:e.unref(r),"procesando-confirmacion":e.unref(i),onConfirmarPago:confirmarPago,onVerDetalle:verDetalleBono},null,p)),n(s.ssrRenderComponent(R,{bonos:e.unref(c),cargando:e.unref(l),"meses-disponibles":e.unref(m),"mes-seleccionado":e.unref(u),onVerDetalle:verDetalleBono,onCambiarMes:cambiarMes},null,p)),n("</div>"),s.ssrRenderTeleport(n,a=>{var t,n;e.unref(f)&&e.unref(b)?(a(`<div class="modal-overlay" data-v-688b729c><div class="modal-container" data-v-688b729c><div class="modal-header" data-v-688b729c><div class="modal-avatar" data-v-688b729c><span data-v-688b729c>${s.ssrInterpolate((a=>{if(!a)return"?";const e=a.split(" ");return e.length>=2?`${e[0][0]}${e[1][0]}`.toUpperCase():a.substring(0,2).toUpperCase()})(e.unref(b).paciente_nombre))}</span></div><div class="modal-title-group" data-v-688b729c><h3 class="modal-title" data-v-688b729c>${s.ssrInterpolate(e.unref(b).paciente_nombre)}</h3><p class="modal-subtitle" data-v-688b729c>${s.ssrInterpolate(e.unref(b).tipo_bono||"Bono Estándar")}</p></div><button class="modal-close" data-v-688b729c><svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-688b729c><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" data-v-688b729c></path></svg></button></div><div class="modal-body" data-v-688b729c><div class="detail-grid" data-v-688b729c><div class="detail-item" data-v-688b729c><span class="detail-label" data-v-688b729c>Terapeuta</span><span class="detail-value" data-v-688b729c>${s.ssrInterpolate(e.unref(b).terapeuta_nombre||"No asignado")}</span></div><div class="detail-item" data-v-688b729c><span class="detail-label" data-v-688b729c>Sesiones</span><span class="detail-value" data-v-688b729c>${s.ssrInterpolate(e.unref(b).sesiones_restantes)} / ${s.ssrInterpolate(e.unref(b).sesiones_totales)}</span></div><div class="detail-item" data-v-688b729c><span class="detail-label" data-v-688b729c>Monto Total</span><span class="detail-value monto" data-v-688b729c>${s.ssrInterpolate((n=e.unref(b).monto_total,new Intl.NumberFormat("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2}).format(n||0)))}€</span></div>`),e.unref(b).fecha_pago?a(`<div class="detail-item" data-v-688b729c><span class="detail-label" data-v-688b729c>Fecha de Pago</span><span class="detail-value" data-v-688b729c>${s.ssrInterpolate((t=e.unref(b).fecha_pago,t?new Date(t).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"}):"No especificada"))}</span></div>`):a("\x3c!----\x3e"),e.unref(b).metodo_pago?a(`<div class="detail-item" data-v-688b729c><span class="detail-label" data-v-688b729c>Método de Pago</span><span class="detail-value capitalize" data-v-688b729c>${s.ssrInterpolate(e.unref(b).metodo_pago)}</span></div>`):a("\x3c!----\x3e"),e.unref(b).estado?a(`<div class="detail-item" data-v-688b729c><span class="detail-label" data-v-688b729c>Estado</span><span class="detail-value capitalize" data-v-688b729c>${s.ssrInterpolate(e.unref(b).estado)}</span></div>`):a("\x3c!----\x3e"),a('</div></div><div class="modal-footer" data-v-688b729c><button class="btn-secondary" data-v-688b729c> Cerrar </button>'),e.unref(b).paciente_id?a(s.ssrRenderComponent(g,{to:`/coordinadora/pacientes/${e.unref(b).paciente_id}`,class:"btn-primary"},{default:e.withCtx((a,s,t,n)=>{if(!s)return[e.createTextVNode(" Ver Paciente "),(e.openBlock(),e.createBlock("svg",{class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e.createVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})]))];s(` Ver Paciente <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-688b729c${n}><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" data-v-688b729c${n}></path></svg>`)}),_:1},p)):a("\x3c!----\x3e"),a("</div></div></div>")):a("\x3c!----\x3e")},"body",!1,p),n("</div>")}}}),N=P.setup;P.setup=(a,s)=>{const t=e.useSSRContext();return(t.modules||(t.modules=new Set)).add("pages/coordinadora/pagos.vue"),N?N(a,s):void 0};const B=d(P,[["__scopeId","data-v-688b729c"]]);export{B as default};
//# sourceMappingURL=pagos-CVuoj6uA.mjs.map
