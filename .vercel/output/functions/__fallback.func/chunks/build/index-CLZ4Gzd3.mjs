import{_ as a}from"./PaymentMethodSelector-B6WAV7CR.mjs";import{v as e,s as t}from"./server.mjs";import{u as s}from"./useSupabaseClient-DykwVqLQ.mjs";import{u as o}from"./useSupabase-DfFg84CY.mjs";import{u as r}from"./usePacientes-Cr4i6x1S.mjs";import{r as n}from"./XMarkIcon-DCLwyE-W.mjs";import{r as l}from"./UserIcon-CrHYaeI9.mjs";import{r as d}from"./TicketIcon-zZdrc71S.mjs";import{r as i}from"./CurrencyEuroIcon-DCwNI2Go.mjs";import{r as c}from"./DocumentTextIcon-O51EkPyw.mjs";import{_ as u}from"./_plugin-vue_export-helper-1tPrXgE0.mjs";import"../routes/renderer.mjs";import"../nitro/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"../_/shared.cjs.prod.mjs";import"../virtual/_commonjsHelpers.mjs";import"node:stream";import"../_/index2.mjs";import"@supabase/supabase-js";import"@vercel/analytics/nuxt";function useFacturas(){const a=s(),{userProfile:t}=o(),r=e.ref([]),n=e.ref(null),l=e.ref(!1),d=e.ref(null);function redondear(a){return Math.round(100*a)/100}function validarNIF(a){if(!a)return!1;const e=a.toUpperCase().replace(/[^A-Z0-9]/g,"");if(9!==e.length)return!1;if(/^[0-9]{8}[A-Z]$/.test(e)){const a="TRWAGMYFPDXBNJZSQVHLCKE"[parseInt(e.substring(0,8))%23];return e[8]===a}if(/^[XYZ][0-9]{7}[A-Z]$/.test(e)){let a=e.substring(1,8);"X"===e[0]?a="0"+a:"Y"===e[0]?a="1"+a:"Z"===e[0]&&(a="2"+a);const t="TRWAGMYFPDXBNJZSQVHLCKE"[parseInt(a)%23];return e[8]===t}return!!/^[ABCDEFGHJKLMNPQRSUVW][0-9]{7}[A-J0-9]$/.test(e)}function formatearNIF(a){return a?a.toUpperCase().replace(/[^A-Z0-9]/g,""):""}async function obtenerRegimenIVA(){const e=t.value?.terapeuta_id||t.value?.id;if(!e)return"exento";try{const{data:t,error:s}=await a.from("terapeutas").select("datos_fiscales").eq("id",e).single();return s||!t?"exento":t.datos_fiscales?.regimen_iva||"exento"}catch{return"exento"}}const i=e.computed(()=>r.value.filter(a=>"emitida"===a.estado).reduce((a,e)=>a+e.total,0)),c=e.computed(()=>r.value.filter(a=>"emitida"===a.estado)),u=e.computed(()=>r.value.filter(a=>"anulada"===a.estado));return{facturas:r,facturaActual:n,loading:l,error:d,totalFacturado:i,facturasEmitidas:c,facturasAnuladas:u,calcularImpuestos:function(a,e,t="exento"){let s=0,o=0,r=0,n=0;"empresa"===e?(s=21,o=redondear(.21*a),r=15,n=redondear(.15*a)):"general"===t&&(s=21,o=redondear(.21*a));const l=redondear(a+o-n);return{baseImponible:redondear(a),porcentajeIVA:s,importeIVA:o,porcentajeIRPF:r,importeIRPF:n,total:l}},redondear:redondear,validarNIF:validarNIF,formatearNIF:formatearNIF,crearFactura:async function(e){const s=t.value?.terapeuta_id||t.value?.id;if(!s)return{success:!1,error:"No se encontr贸 el terapeuta"};l.value=!0,d.value=null;try{if("empresa"===e.tipoCliente&&e.receptorNif&&!validarNIF(e.receptorNif))return{success:!1,error:"El NIF/CIF no es v谩lido"};const t=await obtenerRegimenIVA(),{data:o,error:r}=await a.rpc("fn_crear_factura",{p_terapeuta_id:s,p_paciente_id:e.pacienteId||null,p_tipo_cliente:e.tipoCliente,p_receptor_nombre:e.receptorNombre,p_receptor_nif:e.receptorNif?formatearNIF(e.receptorNif):null,p_receptor_direccion:e.receptorDireccion||null,p_concepto:e.concepto,p_base_imponible:e.baseImponible,p_aplicar_iva:"empresa"===e.tipoCliente||"general"===t,p_aplicar_irpf:"empresa"===e.tipoCliente,p_lineas_detalle:e.lineasDetalle||[],p_bono_id:e.bonoId||null,p_pago_id:e.pagoId||null});if(r)throw new Error(r.message);const{data:n,error:l}=await a.from("facturas").select("*").eq("id",o).single();if(l)throw new Error(l.message);return{success:!0,data:n}}catch(a){return d.value=a.message,console.error("[useFacturas] Error creando factura:",a),{success:!1,error:a.message}}finally{l.value=!1}},getFacturas:async function(e={}){const s=t.value?.terapeuta_id||t.value?.id;if(!s)return{success:!1,error:"No se encontr贸 el terapeuta"};l.value=!0,d.value=null;try{let t=a.from("facturas").select("\n          *,\n          paciente:pacientes(id, nombre_completo, email)\n        ").eq("terapeuta_id",s).order("fecha_emision",{ascending:!1});e.fechaDesde&&(t=t.gte("fecha_emision",e.fechaDesde)),e.fechaHasta&&(t=t.lte("fecha_emision",e.fechaHasta)),e.pacienteId&&(t=t.eq("paciente_id",e.pacienteId)),e.estado&&(t=t.eq("estado",e.estado)),e.busqueda&&(t=t.or(`numero_factura.ilike.%${e.busqueda}%,receptor_nombre.ilike.%${e.busqueda}%,concepto.ilike.%${e.busqueda}%`));const{data:o,error:n}=await t;if(n)throw new Error(n.message);return r.value=o||[],{success:!0,data:r.value,total:r.value.length}}catch(a){return d.value=a.message,console.error("[useFacturas] Error obteniendo facturas:",a),{success:!1,error:a.message}}finally{l.value=!1}},getFactura:async function(e){l.value=!0,d.value=null;try{const{data:t,error:s}=await a.from("facturas").select("\n          *,\n          paciente:pacientes(id, nombre_completo, email, telefono)\n        ").eq("id",e).single();if(s)throw new Error(s.message);return n.value=t,{success:!0,data:n.value}}catch(a){return d.value=a.message,console.error("[useFacturas] Error obteniendo factura:",a),{success:!1,error:a.message}}finally{l.value=!1}},anularFactura:async function(e,t){if(!t||t.trim().length<3)return{success:!1,error:"Debe indicar un motivo de anulaci贸n"};l.value=!0,d.value=null;try{const{data:s,error:o}=await a.rpc("fn_anular_factura",{p_factura_id:e,p_motivo:t.trim()});if(o)throw new Error(o.message);if(!s)return{success:!1,error:"No se pudo anular la factura. Puede que ya est茅 anulada."};const n=r.value.findIndex(a=>a.id===e);return-1!==n&&(r.value[n].estado="anulada",r.value[n].motivo_anulacion=t),{success:!0}}catch(a){return d.value=a.message,console.error("[useFacturas] Error anulando factura:",a),{success:!1,error:a.message}}finally{l.value=!1}},getProximoNumero:async function(){const e=t.value?.terapeuta_id||t.value?.id;if(!e)return null;try{const{data:t,error:s}=await a.from("terapeutas").select("numeracion_facturas").eq("id",e).single();if(s||!t)return null;const o=t.numeracion_facturas;if(!o)return null;const r=(new Date).getFullYear(),n=(r>o.anio_actual?1:o.ultimo_numero+1).toString().padStart(4,"0");return`${o.prefijo}-${r}-${n}`}catch{return null}},getDatosFiscales:async function(){const e=t.value?.terapeuta_id||t.value?.id;if(!e)return null;try{const{data:t,error:s}=await a.from("terapeutas").select("datos_fiscales").eq("id",e).single();return s||!t?null:t.datos_fiscales}catch{return null}},guardarDatosFiscales:async function(e){const s=t.value?.terapeuta_id||t.value?.id;if(!s)return{success:!1,error:"No se encontr贸 el terapeuta"};if(e.nif&&!validarNIF(e.nif))return{success:!1,error:"El NIF no es v谩lido"};l.value=!0;try{const{error:t}=await a.from("terapeutas").update({datos_fiscales:{...e,nif:e.nif?formatearNIF(e.nif):""},updated_at:(new Date).toISOString()}).eq("id",s);if(t)throw new Error(t.message);return{success:!0}}catch(a){return console.error("[useFacturas] Error guardando datos fiscales:",a),{success:!1,error:a.message}}finally{l.value=!1}},obtenerRegimenIVA:obtenerRegimenIVA,formatearImporte:function(a){return new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR"}).format(a)},formatearFecha:function(a){return new Date(a).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"})},getEstadoColor:function(a){return{borrador:"bg-gray-100 text-gray-700",emitida:"bg-green-100 text-green-700",anulada:"bg-red-100 text-red-700"}[a]||"bg-gray-100 text-gray-600"},getEstadoTexto:function(a){return{borrador:"Borrador",emitida:"Emitida",anulada:"Anulada"}[a]||a}}}const v=e.defineComponent({__name:"FacturaForm",__ssrInlineRender:!0,props:{baseImponible:{},regimenIVA:{default:"exento"},initialTipoCliente:{default:"particular"},initialDatosEmpresa:{default:()=>({nombre:"",nif:"",direccion:""})}},emits:["update"],setup(a,{emit:s}){const o=a,r=s,n=e.ref(o.initialTipoCliente),l=e.ref({nombre:o.initialDatosEmpresa.nombre,nif:o.initialDatosEmpresa.nif,direccion:o.initialDatosEmpresa.direccion}),d=e.ref(null),{calcularImpuestos:i,formatearImporte:c}=useFacturas(),u=e.computed(()=>i(o.baseImponible,n.value,o.regimenIVA));e.watch([n,l,()=>o.baseImponible],()=>{r("update",{tipoCliente:n.value,datosEmpresa:"empresa"===n.value?l.value:null,calculo:u.value})},{deep:!0,immediate:!0});const v=e.computed(()=>"empresa"===n.value?"IVA 21% + Retenci贸n IRPF 15%":"exento"===o.regimenIVA?"Exento de IVA (Art. 20.1.3潞 LIVA - Servicios sanitarios)":"IVA 21%");return(a,s,o,r)=>{s(`<div${t.ssrRenderAttrs(e.mergeProps({class:"space-y-5"},r))}><div><label class="block text-sm font-medium text-gray-700 mb-3"> Tipo de cliente </label><div class="grid grid-cols-2 gap-3"><label class="${t.ssrRenderClass(["particular"===n.value?"border-purple-500 bg-purple-50":"border-gray-200 hover:border-gray-300","flex items-center gap-3 p-4 border rounded-lg cursor-pointer transition-all"])}"><input type="radio"${t.ssrIncludeBooleanAttr(t.ssrLooseEqual(n.value,"particular"))?" checked":""} value="particular" class="w-4 h-4 text-purple-600 focus:ring-purple-500"><div><span class="text-sm font-medium text-gray-900">Particular</span><p class="text-xs text-gray-500">Persona f铆sica</p></div></label><label class="${t.ssrRenderClass(["empresa"===n.value?"border-purple-500 bg-purple-50":"border-gray-200 hover:border-gray-300","flex items-center gap-3 p-4 border rounded-lg cursor-pointer transition-all"])}"><input type="radio"${t.ssrIncludeBooleanAttr(t.ssrLooseEqual(n.value,"empresa"))?" checked":""} value="empresa" class="w-4 h-4 text-purple-600 focus:ring-purple-500"><div><span class="text-sm font-medium text-gray-900">Empresa</span><p class="text-xs text-gray-500">Persona jur铆dica</p></div></label></div></div>`),"empresa"===n.value?(s(`<div class="space-y-4 overflow-hidden"><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label class="block text-sm font-medium text-gray-700 mb-1"> Raz贸n social <span class="text-red-500">*</span></label><input${t.ssrRenderAttr("value",l.value.nombre)} type="text" placeholder="Nombre de la empresa" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500" required></div><div><label class="block text-sm font-medium text-gray-700 mb-1"> CIF <span class="text-red-500">*</span></label><input${t.ssrRenderAttr("value",l.value.nif)} type="text" placeholder="B12345678" class="${t.ssrRenderClass([d.value?"border-red-300 bg-red-50":"border-gray-300","w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 uppercase"])}" required>`),d.value?s(`<p class="mt-1 text-xs text-red-600">${t.ssrInterpolate(d.value)}</p>`):s("\x3c!----\x3e"),s(`</div></div><div><label class="block text-sm font-medium text-gray-700 mb-1"> Direcci贸n fiscal <span class="text-red-500">*</span></label><input${t.ssrRenderAttr("value",l.value.direccion)} type="text" placeholder="Calle, n煤mero, CP, Ciudad" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500" required></div></div>`)):s("\x3c!----\x3e"),s(`<div class="bg-gray-50 rounded-lg p-4 border border-gray-200"><h4 class="text-sm font-medium text-gray-700 mb-3">Desglose de factura</h4><div class="space-y-2 text-sm"><div class="flex justify-between"><span class="text-gray-600">Base imponible:</span><span class="font-medium text-gray-900">${t.ssrInterpolate(e.unref(c)(u.value.baseImponible))}</span></div><div class="flex justify-between"><span class="text-gray-600"> IVA (${t.ssrInterpolate(u.value.porcentajeIVA)}%): </span><span class="${t.ssrRenderClass([u.value.importeIVA>0?"text-gray-900":"text-gray-400","font-medium"])}">${t.ssrInterpolate(u.value.importeIVA>0?"+":"")}${t.ssrInterpolate(e.unref(c)(u.value.importeIVA))}</span></div>`),"empresa"===n.value?s(`<div class="flex justify-between"><span class="text-gray-600"> Retenci贸n IRPF (${t.ssrInterpolate(u.value.porcentajeIRPF)}%): </span><span class="font-medium text-red-600"> -${t.ssrInterpolate(e.unref(c)(u.value.importeIRPF))}</span></div>`):s("\x3c!----\x3e"),s(`<div class="border-t border-gray-300 my-2"></div><div class="flex justify-between text-base"><span class="font-semibold text-gray-900">TOTAL:</span><span class="font-bold text-purple-600">${t.ssrInterpolate(e.unref(c)(u.value.total))}</span></div></div><p class="mt-3 text-xs text-gray-500 flex items-center gap-1"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> ${t.ssrInterpolate(v.value)}</p></div></div>`)}}}),p=v.setup;v.setup=(a,t)=>{const s=e.useSSRContext();return(s.modules||(s.modules=new Set)).add("components/Factura/FacturaForm.vue"),p?p(a,t):void 0};const b=Object.assign(v,{__name:"FacturaForm"});function usePagosRegistros(){const a=s(),{userProfile:t}=o(),r=e.ref([]),n=e.ref(!1),l=e.ref(null);async function getPagos(e={}){const s=t.value?.terapeuta_id||t.value?.id;if(!s)return{success:!1,error:"No se encontr贸 el terapeuta"};n.value=!0,l.value=null;try{let t=a.from("pagos_registros").select("\n          *,\n          paciente:pacientes(id, nombre_completo, email),\n          bono:bonos(id, tipo, sesiones_totales, monto_total),\n          factura:facturas(id, numero_factura)\n        ").eq("terapeuta_id",s).order("fecha_pago",{ascending:!1}).order("created_at",{ascending:!1});e.fechaDesde&&(t=t.gte("fecha_pago",e.fechaDesde)),e.fechaHasta&&(t=t.lte("fecha_pago",e.fechaHasta)),e.pacienteId&&(t=t.eq("paciente_id",e.pacienteId)),e.metodoPago&&(t=t.eq("metodo_pago",e.metodoPago)),void 0!==e.conFactura&&(t=e.conFactura?t.not("factura_id","is",null):t.is("factura_id",null)),e.busqueda&&(t=t.or(`concepto.ilike.%${e.busqueda}%`));const{data:o,error:n}=await t;if(n)throw new Error(n.message);return r.value=o||[],{success:!0,data:r.value,total:r.value.length}}catch(a){return l.value=a.message,console.error("[usePagosRegistros] Error obteniendo pagos:",a),{success:!1,error:a.message}}finally{n.value=!1}}async function actualizarPago(e,t){n.value=!0,l.value=null;try{const s={updated_at:(new Date).toISOString()};t.fechaPago&&(s.fecha_pago=t.fechaPago),t.monto&&(s.monto=t.monto),t.metodoPago&&(s.metodo_pago=t.metodoPago),void 0!==t.concepto&&(s.concepto=t.concepto),void 0!==t.facturaId&&(s.factura_id=t.facturaId);const{data:o,error:n}=await a.from("pagos_registros").update(s).eq("id",e).select("\n          *,\n          paciente:pacientes(id, nombre_completo, email)\n        ").single();if(n)throw new Error(n.message);const l=r.value.findIndex(a=>a.id===e);return-1!==l&&(r.value[l]=o),{success:!0,data:o}}catch(a){return l.value=a.message,console.error("[usePagosRegistros] Error actualizando pago:",a),{success:!1,error:a.message}}finally{n.value=!1}}function calcularResumen(a){const e=a||r.value,t={efectivo:{total:0,cantidad:0},transferencia:{total:0,cantidad:0},bizum:{total:0,cantidad:0},tarjeta:{total:0,cantidad:0},stripe:{total:0,cantidad:0}};return e.forEach(a=>{a.metodo_pago&&t[a.metodo_pago]&&(t[a.metodo_pago].total+=a.monto,t[a.metodo_pago].cantidad+=1)}),{total:e.reduce((a,e)=>a+e.monto,0),cantidad:e.length,porMetodo:t}}const d=e.computed(()=>r.value.reduce((a,e)=>a+e.monto,0)),i=e.computed(()=>calcularResumen()),c=e.computed(()=>r.value.filter(a=>a.factura_id)),u=e.computed(()=>r.value.filter(a=>!a.factura_id));return{pagos:r,loading:n,error:l,totalPagos:d,resumenActual:i,pagosConFactura:c,pagosSinFactura:u,crearPago:async function(e){const s=t.value?.terapeuta_id||t.value?.id;if(!s)return{success:!1,error:"No se encontr贸 el terapeuta"};if(!e.pacienteId)return{success:!1,error:"Debe seleccionar un paciente"};if(!e.monto||e.monto<=0)return{success:!1,error:"El monto debe ser mayor a 0"};n.value=!0,l.value=null;try{const{data:t,error:o}=await a.from("pagos_registros").insert({terapeuta_id:s,paciente_id:e.pacienteId,fecha_pago:e.fechaPago||(new Date).toISOString().split("T")[0],monto:e.monto,metodo_pago:e.metodoPago,concepto:e.concepto||null,bono_id:e.bonoId||null,factura_id:e.facturaId||null,cita_id:e.citaId||null}).select("\n          *,\n          paciente:pacientes(id, nombre_completo, email)\n        ").single();if(o)throw new Error(o.message);return e.bonoId&&await async function(e,t){try{await a.from("bonos").update({estado_pago:"pagado",metodo_pago:t,fecha_pago:(new Date).toISOString(),pagado:!0,updated_at:(new Date).toISOString()}).eq("id",e)}catch(a){console.error("[usePagosRegistros] Error actualizando bono:",a)}}(e.bonoId,e.metodoPago),r.value.unshift(t),{success:!0,data:t}}catch(a){return l.value=a.message,console.error("[usePagosRegistros] Error creando pago:",a),{success:!1,error:a.message}}finally{n.value=!1}},getPagos:getPagos,getPago:async function(e){n.value=!0,l.value=null;try{const{data:t,error:s}=await a.from("pagos_registros").select("\n          *,\n          paciente:pacientes(id, nombre_completo, email, telefono),\n          bono:bonos(id, tipo, sesiones_totales, sesiones_restantes, monto_total, estado),\n          factura:facturas(id, numero_factura, total, estado)\n        ").eq("id",e).single();if(s)throw new Error(s.message);return{success:!0,data:t}}catch(a){return l.value=a.message,console.error("[usePagosRegistros] Error obteniendo pago:",a),{success:!1,error:a.message}}finally{n.value=!1}},actualizarPago:actualizarPago,eliminarPago:async function(e){n.value=!0,l.value=null;try{const{error:t}=await a.from("pagos_registros").delete().eq("id",e);if(t)throw new Error(t.message);return r.value=r.value.filter(a=>a.id!==e),{success:!0}}catch(a){return l.value=a.message,console.error("[usePagosRegistros] Error eliminando pago:",a),{success:!1,error:a.message}}finally{n.value=!1}},vincularConFactura:async function(a,e){return actualizarPago(a,{facturaId:e})},getBonosPendientesPago:async function(e){try{const{data:t,error:s}=await a.from("bonos").select("id, tipo, monto_total, sesiones_totales, sesiones_restantes, fecha_inicio, fecha_fin, estado").eq("paciente_id",e).in("estado_pago",["pendiente",null]).in("estado",["activo","pendiente"]).order("created_at",{ascending:!1});return s?(console.error("[usePagosRegistros] Error obteniendo bonos:",s),[]):t||[]}catch(a){return console.error("[usePagosRegistros] Error obteniendo bonos:",a),[]}},calcularResumen:calcularResumen,getPagosMes:async function(a,e){return getPagos({fechaDesde:new Date(a,e-1,1).toISOString().split("T")[0],fechaHasta:new Date(a,e,0).toISOString().split("T")[0]})},formatearMetodoPago:function(a){return{efectivo:"Efectivo",transferencia:"Transferencia",bizum:"Bizum",tarjeta:"Tarjeta",stripe:"Stripe"}[a]||a},formatearImporte:function(a){return new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR"}).format(a)},formatearFecha:function(a){return new Date(a).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"})}}}const m=e.defineComponent({__name:"PagoUnificadoModal",__ssrInlineRender:!0,props:{visible:{type:Boolean},pacienteIdPreseleccionado:{default:void 0},bonoIdPreseleccionado:{default:void 0},montoInicial:{default:void 0}},emits:["close","saved"],setup(s,{emit:u}){const v=s,{searchPacientes:p,pacientes:m,loading:f}=r();usePagosRegistros(),useFacturas();const{waitForUser:g}=o(),x=e.ref("datos"),h=e.ref(!1),w=e.ref(!1),y=e.ref(v.pacienteIdPreseleccionado||null),I=e.ref(""),A=e.ref(""),$=e.ref(!1),C=e.ref((new Date).toISOString().split("T")[0]),_=e.ref(v.montoInicial||0),P=e.ref(null),k=e.ref(""),R=e.ref(v.bonoIdPreseleccionado||null),E=e.ref([]),F=e.ref(!1),L=e.ref("particular"),M=e.ref({nombre:"",nif:"",direccion:""}),B=e.ref(null),D=e.ref("exento"),j=e.ref(null);function handleFacturaUpdate(a){L.value=a.tipoCliente,M.value=a.datosEmpresa||{nombre:"",nif:"",direccion:""},B.value=a.calculo}e.watch(A,async a=>{w.value||(await g(),w.value=!0),a.length>=2?(p(a),$.value=!0):0!==a.length||y.value||(p(""),$.value=!0)});const S=e.computed(()=>"datos"===x.value?y.value&&_.value>0&&P.value:"factura"!==x.value||(!F.value||("empresa"!==L.value||M.value.nombre&&M.value.nif&&M.value.direccion)));function formatearImporte(a){return new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR"}).format(a)}return(o,r,u,v)=>{const p=a,g=b;t.ssrRenderTeleport(r,a=>{s.visible?(a(`<div class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50"><div class="w-full max-w-lg bg-white rounded-2xl shadow-xl overflow-hidden flex flex-col max-h-[90vh]"><div class="px-5 py-4 bg-gray-50 border-b border-gray-200 flex items-center justify-between"><div><h2 class="text-lg font-semibold text-gray-900">${t.ssrInterpolate("datos"===x.value?"Nuevo Pago":"factura"===x.value?"Facturaci贸n":"Confirmar")}</h2><p class="text-sm text-gray-500"> Paso ${t.ssrInterpolate("datos"===x.value?"1":"factura"===x.value?"2":"3")} de 3 </p></div><button class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors">`),a(t.ssrRenderComponent(e.unref(n),{class:"w-5 h-5"},null,u)),a('</button></div><div class="flex-1 overflow-y-auto p-5">'),"datos"===x.value?(a('<div class="space-y-5"><div><label class="block text-sm font-medium text-gray-700 mb-2">'),a(t.ssrRenderComponent(e.unref(l),{class:"w-4 h-4 inline mr-1"},null,u)),a(` Paciente <span class="text-red-500">*</span></label><div class="relative"><input${t.ssrRenderAttr("value",A.value)} type="text" placeholder="Buscar paciente..." class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">`),y.value?(a('<button class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600">'),a(t.ssrRenderComponent(e.unref(n),{class:"w-4 h-4"},null,u)),a("</button>")):a("\x3c!----\x3e"),$.value&&!y.value?(a('<div class="absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-48 overflow-y-auto">'),e.unref(f)?a('<div class="p-3 text-center text-gray-500 text-sm"> Buscando... </div>'):0===e.unref(m).length?a('<div class="p-3 text-center text-gray-500 text-sm"> No se encontraron pacientes </div>'):a("\x3c!----\x3e"),a("\x3c!--[--\x3e"),t.ssrRenderList(e.unref(m),e=>{a(`<button class="w-full px-4 py-2 text-left hover:bg-gray-50 flex items-center gap-3"><div class="w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center text-purple-600 text-sm font-medium">${t.ssrInterpolate(e.nombre_completo.charAt(0))}</div><div><p class="text-sm font-medium text-gray-900">${t.ssrInterpolate(e.nombre_completo)}</p><p class="text-xs text-gray-500">${t.ssrInterpolate(e.email)}</p></div></button>`)}),a("\x3c!--]--\x3e</div>")):a("\x3c!----\x3e"),a("</div></div>"),E.value.length>0?(a('<div><label class="block text-sm font-medium text-gray-700 mb-2">'),a(t.ssrRenderComponent(e.unref(d),{class:"w-4 h-4 inline mr-1"},null,u)),a(' Bonos pendientes de pago </label><div class="grid gap-2">\x3c!--[--\x3e'),t.ssrRenderList(E.value,e=>{a(`<button class="${t.ssrRenderClass([R.value===e.id?"border-purple-500 bg-purple-50":"border-gray-200 hover:border-gray-300","w-full p-3 border rounded-lg text-left transition-all"])}"><div class="flex items-center justify-between"><span class="font-medium text-gray-900">${t.ssrInterpolate(e.tipo)}</span><span class="text-purple-600 font-semibold">${t.ssrInterpolate(formatearImporte(e.monto_total))}</span></div><p class="text-xs text-gray-500 mt-1">${t.ssrInterpolate(e.sesiones_totales)} sesiones </p></button>`)}),a("\x3c!--]--\x3e</div></div>")):a("\x3c!----\x3e"),a(`<div class="grid grid-cols-2 gap-4"><div><label class="block text-sm font-medium text-gray-700 mb-2"> Fecha </label><input${t.ssrRenderAttr("value",C.value)} type="date" class="w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"></div><div><label class="block text-sm font-medium text-gray-700 mb-2">`),a(t.ssrRenderComponent(e.unref(i),{class:"w-4 h-4 inline mr-1"},null,u)),a(` Monto <span class="text-red-500">*</span></label><div class="relative"><input${t.ssrRenderAttr("value",_.value)} type="number" step="0.01" min="0" placeholder="0.00" class="w-full px-3 py-2.5 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"><span class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm">EUR</span></div></div></div><div><label class="block text-sm font-medium text-gray-700 mb-2"> M茅todo de pago <span class="text-red-500">*</span></label>`),a(t.ssrRenderComponent(p,{"selected-method":P.value,size:"sm",onSelect:a=>P.value=a},null,u)),a(`</div><div><label class="block text-sm font-medium text-gray-700 mb-2"> Concepto </label><textarea rows="2" placeholder="Describe el pago (opcional)..." class="w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 resize-none">${t.ssrInterpolate(k.value)}</textarea></div></div>`)):"factura"===x.value?(a('<div class="space-y-5"><label class="flex items-center justify-between p-4 bg-gray-50 rounded-lg cursor-pointer"><div class="flex items-center gap-3">'),a(t.ssrRenderComponent(e.unref(c),{class:"w-5 h-5 text-gray-500"},null,u)),a(`<div><span class="font-medium text-gray-900">Generar factura</span><p class="text-xs text-gray-500">Se crear谩 una factura asociada a este pago</p></div></div><input type="checkbox"${t.ssrIncludeBooleanAttr(Array.isArray(F.value)?t.ssrLooseContain(F.value,null):F.value)?" checked":""} class="w-5 h-5 text-purple-600 rounded focus:ring-purple-500"></label>`),F.value&&j.value?a(`<div class="text-sm text-gray-600 bg-purple-50 p-3 rounded-lg"> Pr贸xima factura: <strong class="text-purple-700">${t.ssrInterpolate(j.value)}</strong></div>`):a("\x3c!----\x3e"),F.value?a(t.ssrRenderComponent(g,{"base-imponible":_.value,"regimen-i-v-a":D.value,onUpdate:handleFacturaUpdate},null,u)):a("\x3c!----\x3e"),F.value?a("\x3c!----\x3e"):(a('<div class="text-center py-8 text-gray-500">'),a(t.ssrRenderComponent(e.unref(c),{class:"w-12 h-12 mx-auto mb-3 text-gray-300"},null,u)),a('<p>No se generar谩 factura para este pago</p><p class="text-sm">Puedes generar una factura m谩s tarde desde el historial</p></div>')),a("</div>")):"confirmacion"===x.value?(a(`<div class="space-y-4"><div class="text-center pb-4 border-b border-gray-100"><p class="text-3xl font-bold text-gray-900">${t.ssrInterpolate(formatearImporte(_.value))}</p><p class="text-gray-600 mt-1">${t.ssrInterpolate(I.value)}</p></div><div class="bg-gray-50 rounded-lg p-4 space-y-3 text-sm"><div class="flex justify-between"><span class="text-gray-600">Fecha:</span><span class="font-medium">${t.ssrInterpolate(new Date(C.value).toLocaleDateString("es-ES"))}</span></div><div class="flex justify-between"><span class="text-gray-600">M茅todo:</span><span class="font-medium capitalize">${t.ssrInterpolate(P.value)}</span></div>`),k.value?a(`<div class="flex justify-between"><span class="text-gray-600">Concepto:</span><span class="font-medium truncate ml-4">${t.ssrInterpolate(k.value)}</span></div>`):a("\x3c!----\x3e"),R.value?a('<div class="flex justify-between"><span class="text-gray-600">Bono:</span><span class="text-purple-600 font-medium">Asociado</span></div>'):a("\x3c!----\x3e"),a(`<div class="flex justify-between pt-2 border-t border-gray-200"><span class="text-gray-600">Factura:</span><span class="${t.ssrRenderClass([F.value?"text-green-600":"text-gray-400","font-medium"])}">${t.ssrInterpolate(F.value?"S铆":"No")}</span></div>`),F.value&&B.value?a(`<div class="pt-2 border-t border-gray-200"><div class="flex justify-between text-gray-600"><span>Total factura:</span><span class="font-bold text-purple-600">${t.ssrInterpolate(formatearImporte(B.value.total))}</span></div></div>`):a("\x3c!----\x3e"),a("</div></div>")):a("\x3c!----\x3e"),a('</div><div class="px-5 py-4 bg-gray-50 border-t border-gray-200 flex gap-3">'),"datos"!==x.value?a(`<button class="px-4 py-2.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"${t.ssrIncludeBooleanAttr(h.value)?" disabled":""}> Anterior </button>`):a("\x3c!----\x3e"),"datos"===x.value?a('<button class="px-4 py-2.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"> Cancelar </button>'):a("\x3c!----\x3e"),"confirmacion"!==x.value?a(`<button${t.ssrIncludeBooleanAttr(!S.value)?" disabled":""} class="flex-1 px-4 py-2.5 text-sm font-medium text-white bg-purple-600 rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"> Siguiente </button>`):(a(`<button${t.ssrIncludeBooleanAttr(h.value)?" disabled":""} class="flex-1 px-4 py-2.5 text-sm font-medium text-white bg-green-600 rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 flex items-center justify-center gap-2">`),h.value?a('<svg class="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path></svg>'):a("\x3c!----\x3e"),a(` ${t.ssrInterpolate(h.value?"Guardando...":"Confirmar pago")}</button>`)),a("</div></div></div>")):a("\x3c!----\x3e")},"body",!1,u)}}}),f=m.setup;m.setup=(a,t)=>{const s=e.useSSRContext();return(s.modules||(s.modules=new Set)).add("components/Payment/PagoUnificadoModal.vue"),f?f(a,t):void 0};const g=Object.assign(m,{__name:"PaymentPagoUnificadoModal"}),x=e.defineComponent({__name:"index",__ssrInlineRender:!0,setup(a){const{getPagos:s,loading:n,formatearMetodoPago:l}=usePagosRegistros(),{getFacturas:d,loading:i,formatearImporte:c,formatearFecha:u,getEstadoColor:v,calcularImpuestos:p}=useFacturas(),{pacientes:b}=r();o();const m=e.ref("pagos"),f=e.ref([]),x=e.ref([]),h=e.ref(!1),w=e.ref({fechaDesde:"",fechaHasta:"",pacienteId:"",estado:"",metodoPago:""}),y=e.ref(null),I=[{id:"hoy",label:"Hoy"},{id:"semana",label:"Esta semana"},{id:"mes",label:"Este mes"},{id:"trimestre",label:"Trimestre"},{id:"anio",label:"Este a帽o"}],A=e.ref(1),$=e.ref(1),C=e.ref(0),_=e.ref(0);e.computed(()=>Math.ceil(C.value/20)),e.computed(()=>Math.ceil(_.value/20));const P=e.computed(()=>n.value||i.value),k=e.computed(()=>{const a=f.value.reduce((a,e)=>a+e.monto,0),e=f.value.length,t={};f.value.forEach(a=>{const e=a.metodo_pago||"otro";t[e]||(t[e]={total:0,cantidad:0}),t[e].total+=a.monto,t[e].cantidad+=1});let s={nombre:"-",porcentaje:0};if(e>0){const a=Object.entries(t).sort(([,a],[,e])=>e.cantidad-a.cantidad);if(a.length>0){const[t,o]=a[0];s={nombre:l(t),porcentaje:Math.round(o.cantidad/e*100)}}}return{totalCobrado:a,cantidadPagos:e,promedioPorPago:e>0?a/e:0,metodoMasUsado:s,porMetodo:t}}),R=e.computed(()=>{if(!w.value.fechaDesde&&!w.value.fechaHasta)return"Todos los pagos";const formatFecha=a=>new Date(a).toLocaleDateString("es-ES",{day:"numeric",month:"short"});return w.value.fechaDesde&&w.value.fechaHasta?`${formatFecha(w.value.fechaDesde)} - ${formatFecha(w.value.fechaHasta)}`:w.value.fechaDesde?`Desde ${formatFecha(w.value.fechaDesde)}`:`Hasta ${formatFecha(w.value.fechaHasta)}`}),E=e.computed(()=>f.value.filter(a=>a.paciente_id&&!a.paciente?.nombre_completo)),F=e.computed(()=>E.value.length>0),L=e.ref(!1),M=e.ref(null),B=e.ref(""),D=e.ref(!1);function tieneProblema(a){return null!==a.paciente_id&&!a.paciente?.nombre_completo}async function cargarPagos(){const a=await s({fechaDesde:w.value.fechaDesde||void 0,fechaHasta:w.value.fechaHasta||void 0,pacienteId:w.value.pacienteId||void 0});a.success&&a.data?(f.value=a.data,C.value=a.total||a.data.length):(f.value=[],C.value=0)}async function cargarFacturas(){const a=await d({fechaDesde:w.value.fechaDesde||void 0,fechaHasta:w.value.fechaHasta||void 0,pacienteId:w.value.pacienteId||void 0,estado:w.value.estado||void 0});a.success&&a.data?(x.value=a.data,_.value=a.total||a.data.length):(x.value=[],_.value=0)}function formatearFechaContextual(a){const e=new Date(a),t=new Date,s=new Date;s.setDate(t.getDate()-1);const o=new Date;o.setDate(t.getDate()-7);const r=e.toISOString().split("T")[0],n=t.toISOString().split("T")[0],l=s.toISOString().split("T")[0];return r===n?{texto:"Hoy"}:r===l?{texto:"Ayer"}:e>=o?{texto:e.toLocaleDateString("es-ES",{weekday:"short"}),subtexto:e.toLocaleDateString("es-ES",{day:"numeric",month:"short"})}:{texto:e.toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"})}}function getMetodoIcon(a){return{efectivo:"",transferencia:"",bizum:"",tarjeta:"",stripe:""}[a]||""}function parseConcepto(a){const e=a.concepto||"",t=e;if(e.toLowerCase().includes("bono")||a.bono_id){const s=e.match(/bono:?\s*([^(]+)\s*\((\d+)\)\s*(\(\d+\/\d+\))?/i);if(s){return{tipo:"bono",texto:`${s[1].trim()} ${s[2]}`,progreso:s[3]||"",detalleCompleto:t}}return a.bono_id&&a.bono?{tipo:"bono",texto:a.bono.tipo||"Bono",detalleCompleto:t}:{tipo:"bono",texto:e.replace(/pago\s*(de\s*)?sesi贸n\s*(de\s*)?/gi,"").trim()||"Bono",detalleCompleto:t}}return e.toLowerCase().includes("primera")||e.toLowerCase().includes("inicial")?{tipo:"primera",texto:"Primera consulta",detalleCompleto:t}:e.toLowerCase().includes("familiar")?{tipo:"familiar",texto:"Sesi贸n familiar",detalleCompleto:t}:e.toLowerCase().includes("individual")||e.toLowerCase().includes("sesi贸n suelta")?{tipo:"individual",texto:"Sesi贸n individual",detalleCompleto:t}:{tipo:"otro",texto:e||"-",detalleCompleto:t}}function getConceptoLabel(a){return{bono:"BONO",individual:"INDIV",primera:"1陋",familiar:"FAM",otro:""}[a]||""}const j=e.ref(null),S=e.ref(!1),V=e.ref(null),q=e.ref(!1),N=e.ref({tipoCliente:"particular",receptorNombre:"",receptorNif:"",receptorDireccion:"",concepto:""}),z=e.computed(()=>V.value?p(V.value.monto,N.value.tipoCliente,"exento"):null),H=e.ref(!1),T=e.ref(!1),O=e.ref("mensual"),U=e.ref((new Date).getMonth()+1),G=e.ref((new Date).getFullYear()),Z=e.computed(()=>{const a=x.value.filter(a=>"emitida"===a.estado),e=a.reduce((a,e)=>a+e.total,0),t=a.reduce((a,e)=>a+e.base_imponible,0),s=a.reduce((a,e)=>a+e.importe_iva,0),o=a.reduce((a,e)=>a+e.importe_irpf,0);return{cantidad:a.length,totalFacturado:e,totalBase:t,totalIVA:s,totalIRPF:o,anuladas:x.value.filter(a=>"anulada"===a.estado).length}});function handlePagoCreado(){h.value=!1,cargarPagos(),cargarFacturas()}return e.watch(m,a=>{"pagos"===a?cargarPagos():cargarFacturas()}),e.watch(A,cargarPagos),e.watch($,cargarFacturas),(a,s,o,r)=>{const n=g;s(`<div${t.ssrRenderAttrs(e.mergeProps({class:"pagos-page"},r))} data-v-3a9bae83><header class="page-header" data-v-3a9bae83><div class="header-content" data-v-3a9bae83><h1 data-v-3a9bae83>Pagos y Facturaci贸n</h1><button class="btn-primary" data-v-3a9bae83><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="icon" data-v-3a9bae83><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" data-v-3a9bae83></path></svg> Nuevo Pago </button></div></header><div class="tabs" data-v-3a9bae83><button class="${t.ssrRenderClass(["tab",{active:"pagos"===m.value}])}" data-v-3a9bae83> Pagos `),C.value>0?s(`<span class="tab-count" data-v-3a9bae83>${t.ssrInterpolate(C.value)}</span>`):s("\x3c!----\x3e"),s(`</button><button class="${t.ssrRenderClass(["tab",{active:"facturas"===m.value}])}" data-v-3a9bae83> Facturas `),_.value>0?s(`<span class="tab-count" data-v-3a9bae83>${t.ssrInterpolate(_.value)}</span>`):s("\x3c!----\x3e"),s("</button></div>"),F.value&&"pagos"===m.value?s(`<div class="alerta-huerfanos" data-v-3a9bae83><div class="alerta-icono" data-v-3a9bae83><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" data-v-3a9bae83><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" data-v-3a9bae83></path></svg></div><div class="alerta-contenido" data-v-3a9bae83><p class="alerta-titulo" data-v-3a9bae83>${t.ssrInterpolate(E.value.length)} pago(s) requieren revisi贸n</p><p class="alerta-descripcion" data-v-3a9bae83> Estos pagos tienen un paciente_id pero el paciente ya no existe o fue eliminado. Puedes asignar manualmente un paciente haciendo clic en &quot;Asignar&quot; en la fila correspondiente. </p></div></div>`):s("\x3c!----\x3e"),"pagos"===m.value&&f.value.length>0?s(`<div class="metricas-container" data-v-3a9bae83><div class="metrica-card metrica-principal" data-v-3a9bae83><div class="metrica-icono" data-v-3a9bae83><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" data-v-3a9bae83><path stroke-linecap="round" stroke-linejoin="round" d="M14.25 7.756a4.5 4.5 0 100 8.488M7.5 10.5h5.25m-5.25 3h5.25M21 12a9 9 0 11-18 0 9 9 0 0118 0z" data-v-3a9bae83></path></svg></div><div class="metrica-contenido" data-v-3a9bae83><span class="metrica-valor" data-v-3a9bae83>${t.ssrInterpolate(e.unref(c)(k.value.totalCobrado))}</span><span class="metrica-label" data-v-3a9bae83>Total cobrado</span></div></div><div class="metrica-card" data-v-3a9bae83><div class="metrica-icono metrica-icono-secundario" data-v-3a9bae83><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" data-v-3a9bae83><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z" data-v-3a9bae83></path></svg></div><div class="metrica-contenido" data-v-3a9bae83><span class="metrica-valor" data-v-3a9bae83>${t.ssrInterpolate(k.value.cantidadPagos)}</span><span class="metrica-label" data-v-3a9bae83>Pagos</span></div></div><div class="metrica-card" data-v-3a9bae83><div class="metrica-icono metrica-icono-secundario" data-v-3a9bae83><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" data-v-3a9bae83><path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z" data-v-3a9bae83></path></svg></div><div class="metrica-contenido" data-v-3a9bae83><span class="metrica-valor" data-v-3a9bae83>${t.ssrInterpolate(e.unref(c)(k.value.promedioPorPago))}</span><span class="metrica-label" data-v-3a9bae83>Promedio</span></div></div><div class="metrica-card" data-v-3a9bae83><div class="metrica-icono metrica-icono-secundario" data-v-3a9bae83><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" data-v-3a9bae83><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5z" data-v-3a9bae83></path></svg></div><div class="metrica-contenido" data-v-3a9bae83><span class="metrica-valor" data-v-3a9bae83>${t.ssrInterpolate(k.value.metodoMasUsado.nombre)}</span><span class="metrica-label" data-v-3a9bae83>M茅todo principal (${t.ssrInterpolate(k.value.metodoMasUsado.porcentaje)}%)</span></div></div></div>`):s("\x3c!----\x3e"),"pagos"===m.value?(s('<div class="filtros-rapidos" data-v-3a9bae83>\x3c!--[--\x3e'),t.ssrRenderList(I,a=>{s(`<button class="${t.ssrRenderClass(["chip-filtro",{"chip-activo":y.value===a.id}])}" data-v-3a9bae83>${t.ssrInterpolate(a.label)}</button>`)}),s("\x3c!--]--\x3e</div>")):s("\x3c!----\x3e"),s(`<div class="filtros" data-v-3a9bae83><div class="filtro-grupo" data-v-3a9bae83><label data-v-3a9bae83>Desde</label><input type="date"${t.ssrRenderAttr("value",w.value.fechaDesde)} class="input-date" data-v-3a9bae83></div><div class="filtro-grupo" data-v-3a9bae83><label data-v-3a9bae83>Hasta</label><input type="date"${t.ssrRenderAttr("value",w.value.fechaHasta)} class="input-date" data-v-3a9bae83></div><div class="filtro-grupo" data-v-3a9bae83><label data-v-3a9bae83>Paciente</label><select class="input-select" data-v-3a9bae83><option value="" data-v-3a9bae83${t.ssrIncludeBooleanAttr(Array.isArray(w.value.pacienteId)?t.ssrLooseContain(w.value.pacienteId,""):t.ssrLooseEqual(w.value.pacienteId,""))?" selected":""}>Todos</option>\x3c!--[--\x3e`),t.ssrRenderList(e.unref(b),a=>{s(`<option${t.ssrRenderAttr("value",a.id)} data-v-3a9bae83${t.ssrIncludeBooleanAttr(Array.isArray(w.value.pacienteId)?t.ssrLooseContain(w.value.pacienteId,a.id):t.ssrLooseEqual(w.value.pacienteId,a.id))?" selected":""}>${t.ssrInterpolate(a.nombre_completo)}</option>`)}),s("\x3c!--]--\x3e</select></div>"),"pagos"===m.value?s(`<div class="filtro-grupo" data-v-3a9bae83><label data-v-3a9bae83>M茅todo</label><select class="input-select" data-v-3a9bae83><option value="" data-v-3a9bae83${t.ssrIncludeBooleanAttr(Array.isArray(w.value.metodoPago)?t.ssrLooseContain(w.value.metodoPago,""):t.ssrLooseEqual(w.value.metodoPago,""))?" selected":""}>Todos</option><option value="efectivo" data-v-3a9bae83${t.ssrIncludeBooleanAttr(Array.isArray(w.value.metodoPago)?t.ssrLooseContain(w.value.metodoPago,"efectivo"):t.ssrLooseEqual(w.value.metodoPago,"efectivo"))?" selected":""}>Efectivo</option><option value="transferencia" data-v-3a9bae83${t.ssrIncludeBooleanAttr(Array.isArray(w.value.metodoPago)?t.ssrLooseContain(w.value.metodoPago,"transferencia"):t.ssrLooseEqual(w.value.metodoPago,"transferencia"))?" selected":""}>Transferencia</option><option value="bizum" data-v-3a9bae83${t.ssrIncludeBooleanAttr(Array.isArray(w.value.metodoPago)?t.ssrLooseContain(w.value.metodoPago,"bizum"):t.ssrLooseEqual(w.value.metodoPago,"bizum"))?" selected":""}>Bizum</option><option value="tarjeta" data-v-3a9bae83${t.ssrIncludeBooleanAttr(Array.isArray(w.value.metodoPago)?t.ssrLooseContain(w.value.metodoPago,"tarjeta"):t.ssrLooseEqual(w.value.metodoPago,"tarjeta"))?" selected":""}>Tarjeta</option></select></div>`):s("\x3c!----\x3e"),"facturas"===m.value?s(`<div class="filtro-grupo" data-v-3a9bae83><label data-v-3a9bae83>Estado</label><select class="input-select" data-v-3a9bae83><option value="" data-v-3a9bae83${t.ssrIncludeBooleanAttr(Array.isArray(w.value.estado)?t.ssrLooseContain(w.value.estado,""):t.ssrLooseEqual(w.value.estado,""))?" selected":""}>Todos</option><option value="emitida" data-v-3a9bae83${t.ssrIncludeBooleanAttr(Array.isArray(w.value.estado)?t.ssrLooseContain(w.value.estado,"emitida"):t.ssrLooseEqual(w.value.estado,"emitida"))?" selected":""}>Emitida</option><option value="borrador" data-v-3a9bae83${t.ssrIncludeBooleanAttr(Array.isArray(w.value.estado)?t.ssrLooseContain(w.value.estado,"borrador"):t.ssrLooseEqual(w.value.estado,"borrador"))?" selected":""}>Borrador</option><option value="anulada" data-v-3a9bae83${t.ssrIncludeBooleanAttr(Array.isArray(w.value.estado)?t.ssrLooseContain(w.value.estado,"anulada"):t.ssrLooseEqual(w.value.estado,"anulada"))?" selected":""}>Anulada</option></select></div>`):s("\x3c!----\x3e"),s('<div class="filtro-acciones" data-v-3a9bae83><button class="btn-secondary" data-v-3a9bae83>Filtrar</button><button class="btn-text" data-v-3a9bae83>Limpiar</button></div></div>'),"pagos"===m.value&&f.value.length>0?(s(`<div class="resumen-periodo" data-v-3a9bae83><div class="periodo-info" data-v-3a9bae83><span class="periodo-descripcion" data-v-3a9bae83>${t.ssrInterpolate(R.value)}</span><span class="periodo-total" data-v-3a9bae83>${t.ssrInterpolate(k.value.cantidadPagos)} pagos 路 ${t.ssrInterpolate(e.unref(c)(k.value.totalCobrado))}</span></div><div class="export-dropdown-container" data-v-3a9bae83><button class="btn-exportar" title="Exportar e Informes" data-v-3a9bae83><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" data-v-3a9bae83><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" data-v-3a9bae83></path></svg> Exportar <svg class="${t.ssrRenderClass([{rotated:H.value},"dropdown-arrow"])}" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" data-v-3a9bae83><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" data-v-3a9bae83></path></svg></button>`),H.value?s('<div class="export-dropdown-menu" data-v-3a9bae83><div class="dropdown-section" data-v-3a9bae83><span class="dropdown-section-title" data-v-3a9bae83>Exportar datos</span><button class="dropdown-item" data-v-3a9bae83><span class="dropdown-icon" data-v-3a9bae83></span><span data-v-3a9bae83>CSV simple (pagos)</span></button><button class="dropdown-item" data-v-3a9bae83><span class="dropdown-icon" data-v-3a9bae83></span><span data-v-3a9bae83>Excel contable completo</span></button><button class="dropdown-item" data-v-3a9bae83><span class="dropdown-icon" data-v-3a9bae83></span><span data-v-3a9bae83>Formato software contable</span></button></div><div class="dropdown-divider" data-v-3a9bae83></div><div class="dropdown-section" data-v-3a9bae83><span class="dropdown-section-title" data-v-3a9bae83>Informes PDF</span><button class="dropdown-item" data-v-3a9bae83><span class="dropdown-icon" data-v-3a9bae83></span><span data-v-3a9bae83>Generar informe...</span></button></div></div>'):s("\x3c!----\x3e"),s("</div></div>")):s("\x3c!----\x3e"),"facturas"===m.value&&x.value.length>0?(s(`<div class="metricas-facturas" data-v-3a9bae83><div class="metrica-factura" data-v-3a9bae83><span class="metrica-factura-valor" data-v-3a9bae83>${t.ssrInterpolate(Z.value.cantidad)}</span><span class="metrica-factura-label" data-v-3a9bae83>Emitidas</span></div><div class="metrica-factura metrica-factura-principal" data-v-3a9bae83><span class="metrica-factura-valor" data-v-3a9bae83>${t.ssrInterpolate(e.unref(c)(Z.value.totalFacturado))}</span><span class="metrica-factura-label" data-v-3a9bae83>Total facturado</span></div><div class="metrica-factura" data-v-3a9bae83><span class="metrica-factura-valor" data-v-3a9bae83>${t.ssrInterpolate(e.unref(c)(Z.value.totalBase))}</span><span class="metrica-factura-label" data-v-3a9bae83>Base imponible</span></div>`),Z.value.totalIVA>0?s(`<div class="metrica-factura" data-v-3a9bae83><span class="metrica-factura-valor" data-v-3a9bae83>${t.ssrInterpolate(e.unref(c)(Z.value.totalIVA))}</span><span class="metrica-factura-label" data-v-3a9bae83>IVA repercutido</span></div>`):s("\x3c!----\x3e"),Z.value.totalIRPF>0?s(`<div class="metrica-factura" data-v-3a9bae83><span class="metrica-factura-valor" data-v-3a9bae83>-${t.ssrInterpolate(e.unref(c)(Z.value.totalIRPF))}</span><span class="metrica-factura-label" data-v-3a9bae83>Retenci贸n IRPF</span></div>`):s("\x3c!----\x3e"),s(`<div class="export-dropdown-container" data-v-3a9bae83><button class="btn-exportar" title="Exportar e Informes" data-v-3a9bae83><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" data-v-3a9bae83><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" data-v-3a9bae83></path></svg> Exportar <svg class="${t.ssrRenderClass([{rotated:H.value},"dropdown-arrow"])}" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" data-v-3a9bae83><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" data-v-3a9bae83></path></svg></button>`),H.value?s('<div class="export-dropdown-menu" data-v-3a9bae83><div class="dropdown-section" data-v-3a9bae83><span class="dropdown-section-title" data-v-3a9bae83>Exportar datos</span><button class="dropdown-item" data-v-3a9bae83><span class="dropdown-icon" data-v-3a9bae83></span><span data-v-3a9bae83>CSV facturas</span></button><button class="dropdown-item" data-v-3a9bae83><span class="dropdown-icon" data-v-3a9bae83></span><span data-v-3a9bae83>Excel contable completo</span></button><button class="dropdown-item" data-v-3a9bae83><span class="dropdown-icon" data-v-3a9bae83></span><span data-v-3a9bae83>Formato software contable</span></button></div><div class="dropdown-divider" data-v-3a9bae83></div><div class="dropdown-section" data-v-3a9bae83><span class="dropdown-section-title" data-v-3a9bae83>Informes PDF</span><button class="dropdown-item" data-v-3a9bae83><span class="dropdown-icon" data-v-3a9bae83></span><span data-v-3a9bae83>Generar informe...</span></button></div></div>'):s("\x3c!----\x3e"),s("</div></div>")):s("\x3c!----\x3e"),P.value?s('<div class="loading-state" data-v-3a9bae83><div class="spinner" data-v-3a9bae83></div><p data-v-3a9bae83>Cargando...</p></div>'):"pagos"===m.value?(s('<div class="table-container" data-v-3a9bae83>'),f.value.length>0?(s('<table class="data-table" data-v-3a9bae83><thead data-v-3a9bae83><tr data-v-3a9bae83><th data-v-3a9bae83>Fecha</th><th data-v-3a9bae83>Paciente</th><th data-v-3a9bae83>Concepto</th><th data-v-3a9bae83>M茅todo</th><th class="text-right" data-v-3a9bae83>Monto</th><th class="text-center" data-v-3a9bae83>Acciones</th></tr></thead><tbody data-v-3a9bae83>\x3c!--[--\x3e'),t.ssrRenderList(f.value,a=>{var o;s(`<tr class="${t.ssrRenderClass({"fila-problema":tieneProblema(a)})}" data-v-3a9bae83><td class="fecha-cell" data-v-3a9bae83><div class="fecha-contextual" data-v-3a9bae83><span class="fecha-texto" data-v-3a9bae83>${t.ssrInterpolate(formatearFechaContextual(a.fecha_pago).texto)}</span>`),formatearFechaContextual(a.fecha_pago).subtexto?s(`<span class="fecha-subtexto" data-v-3a9bae83>${t.ssrInterpolate(formatearFechaContextual(a.fecha_pago).subtexto)}</span>`):s("\x3c!----\x3e"),s(`</div></td><td data-v-3a9bae83><span class="${t.ssrRenderClass({"paciente-problema":tieneProblema(a)})}" data-v-3a9bae83>${t.ssrInterpolate(function(a){if(a.paciente?.nombre_completo)return a.paciente.nombre_completo;if(!a.paciente_id)return"Sin paciente";const e=b.value.find(e=>e.id===a.paciente_id);return e?e.nombre_completo:"Paciente no encontrado"}(a))}</span>`),tieneProblema(a)?s('<span class="badge-problema" data-v-3a9bae83>ID hu茅rfano</span>'):s("\x3c!----\x3e"),s('</td><td class="concepto-cell" data-v-3a9bae83><div class="concepto-wrapper" data-v-3a9bae83>'),getConceptoLabel(parseConcepto(a).tipo)?s(`<span class="${t.ssrRenderClass(["concepto-badge",(o=parseConcepto(a).tipo,{bono:"badge-bono",individual:"badge-individual",primera:"badge-primera",familiar:"badge-familiar",otro:"badge-otro"}[o]||"badge-otro")])}" data-v-3a9bae83>${t.ssrInterpolate(getConceptoLabel(parseConcepto(a).tipo))}</span>`):s("\x3c!----\x3e"),s(`<span class="concepto-texto"${t.ssrRenderAttr("title",parseConcepto(a).detalleCompleto)} data-v-3a9bae83>${t.ssrInterpolate(parseConcepto(a).texto)}</span>`),parseConcepto(a).progreso?s(`<span class="concepto-progreso" data-v-3a9bae83>${t.ssrInterpolate(parseConcepto(a).progreso)}</span>`):s("\x3c!----\x3e"),s(`</div></td><td data-v-3a9bae83><span class="metodo-badge" data-v-3a9bae83><span class="metodo-icon" data-v-3a9bae83>${t.ssrInterpolate(getMetodoIcon(a.metodo_pago))}</span> ${t.ssrInterpolate(e.unref(l)(a.metodo_pago))}</span></td><td class="text-right monto" data-v-3a9bae83>${t.ssrInterpolate(e.unref(c)(a.monto))}</td><td class="acciones-cell" data-v-3a9bae83><div class="acciones-wrapper" data-v-3a9bae83>`),tieneProblema(a)?s('<button class="btn-asignar" title="Asignar paciente" data-v-3a9bae83> Asignar </button>'):(s(`<div class="menu-container" data-v-3a9bae83><button class="${t.ssrRenderClass([{"menu-activo":j.value===a.id},"btn-menu"])}" data-v-3a9bae83><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" data-v-3a9bae83><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 12.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 18.75a.75.75 0 110-1.5.75.75 0 010 1.5z" data-v-3a9bae83></path></svg></button>`),j.value===a.id?s('<div class="menu-dropdown" data-v-3a9bae83><button class="menu-item" data-v-3a9bae83><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" data-v-3a9bae83><path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" data-v-3a9bae83></path><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" data-v-3a9bae83></path></svg> Ver detalles </button><button class="menu-item" data-v-3a9bae83><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" data-v-3a9bae83><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" data-v-3a9bae83></path></svg> Generar factura </button><button class="menu-item menu-item-danger" data-v-3a9bae83><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" data-v-3a9bae83><path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" data-v-3a9bae83></path></svg> Eliminar </button></div>'):s("\x3c!----\x3e"),s("</div>")),s("</div></td></tr>")}),s("\x3c!--]--\x3e</tbody></table>")):s('<div class="empty-state" data-v-3a9bae83><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="empty-icon" data-v-3a9bae83><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 00-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 01-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 003 15h-.75M15 10.5a3 3 0 11-6 0 3 3 0 016 0zm3 0h.008v.008H18V10.5zm-12 0h.008v.008H6V10.5z" data-v-3a9bae83></path></svg><p data-v-3a9bae83>No hay pagos registrados</p><button class="btn-primary" data-v-3a9bae83>Registrar primer pago</button></div>'),f.value.length>0?s(`<div class="paginacion" data-v-3a9bae83><button${t.ssrIncludeBooleanAttr(1===A.value)?" disabled":""} class="btn-pag" data-v-3a9bae83> Anterior </button><span class="pag-info" data-v-3a9bae83>P谩gina ${t.ssrInterpolate(A.value)}</span><button${t.ssrIncludeBooleanAttr(f.value.length<20)?" disabled":""} class="btn-pag" data-v-3a9bae83> Siguiente </button></div>`):s("\x3c!----\x3e"),s("</div>")):(s('<div class="table-container" data-v-3a9bae83>'),x.value.length>0?(s('<table class="data-table" data-v-3a9bae83><thead data-v-3a9bae83><tr data-v-3a9bae83><th data-v-3a9bae83>N潞 Factura</th><th data-v-3a9bae83>Fecha</th><th data-v-3a9bae83>Cliente</th><th data-v-3a9bae83>Concepto</th><th class="text-right" data-v-3a9bae83>Base</th><th class="text-right" data-v-3a9bae83>Total</th><th data-v-3a9bae83>Estado</th><th data-v-3a9bae83>Acciones</th></tr></thead><tbody data-v-3a9bae83>\x3c!--[--\x3e'),t.ssrRenderList(x.value,a=>{s(`<tr data-v-3a9bae83><td class="numero-factura" data-v-3a9bae83>${t.ssrInterpolate(a.numero_factura)}</td><td class="fecha" data-v-3a9bae83>${t.ssrInterpolate(e.unref(u)(a.fecha_emision))}</td><td data-v-3a9bae83><div class="cliente-info" data-v-3a9bae83><span class="cliente-nombre" data-v-3a9bae83>${t.ssrInterpolate(a.receptor_nombre)}</span>`),a.receptor_nif?s(`<span class="cliente-nif" data-v-3a9bae83>${t.ssrInterpolate(a.receptor_nif)}</span>`):s("\x3c!----\x3e"),s(`</div></td><td class="concepto" data-v-3a9bae83>${t.ssrInterpolate(a.concepto)}</td><td class="text-right" data-v-3a9bae83>${t.ssrInterpolate(e.unref(c)(a.base_imponible))}</td><td class="text-right monto" data-v-3a9bae83>${t.ssrInterpolate(e.unref(c)(a.total))}</td><td data-v-3a9bae83><span class="${t.ssrRenderClass(["estado-badge",e.unref(v)(a.estado)])}" data-v-3a9bae83>${t.ssrInterpolate(a.estado)}</span></td><td class="acciones" data-v-3a9bae83><button class="btn-icon" title="Descargar PDF" data-v-3a9bae83><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" data-v-3a9bae83><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" data-v-3a9bae83></path></svg></button>`),"emitida"===a.estado?s('<button class="btn-icon btn-danger" title="Anular factura" data-v-3a9bae83><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" data-v-3a9bae83><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" data-v-3a9bae83></path></svg></button>'):s("\x3c!----\x3e"),s("</td></tr>")}),s("\x3c!--]--\x3e</tbody></table>")):s('<div class="empty-state" data-v-3a9bae83><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="empty-icon" data-v-3a9bae83><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" data-v-3a9bae83></path></svg><p data-v-3a9bae83>No hay facturas emitidas</p><p class="text-muted" data-v-3a9bae83>Las facturas se generan al registrar pagos</p></div>'),x.value.length>0?s(`<div class="paginacion" data-v-3a9bae83><button${t.ssrIncludeBooleanAttr(1===$.value)?" disabled":""} class="btn-pag" data-v-3a9bae83> Anterior </button><span class="pag-info" data-v-3a9bae83>P谩gina ${t.ssrInterpolate($.value)}</span><button${t.ssrIncludeBooleanAttr(x.value.length<20)?" disabled":""} class="btn-pag" data-v-3a9bae83> Siguiente </button></div>`):s("\x3c!----\x3e"),s("</div>")),s(t.ssrRenderComponent(n,{visible:h.value,onClose:a=>h.value=!1,onSaved:handlePagoCreado},null,o)),t.ssrRenderTeleport(s,a=>{L.value?(a('<div class="modal-overlay" data-v-3a9bae83><div class="modal-asignar" data-v-3a9bae83><div class="modal-header" data-v-3a9bae83><h3 data-v-3a9bae83>Asignar Paciente</h3><button class="btn-close" data-v-3a9bae83><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" data-v-3a9bae83><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" data-v-3a9bae83></path></svg></button></div><div class="modal-body" data-v-3a9bae83><p class="modal-info" data-v-3a9bae83> Este pago tiene un ID de paciente que ya no existe en el sistema. Selecciona un paciente para asignarlo correctamente. </p>'),M.value?a(`<div class="pago-info-box" data-v-3a9bae83><p data-v-3a9bae83><strong data-v-3a9bae83>Fecha:</strong> ${t.ssrInterpolate(e.unref(u)(M.value.fecha_pago))}</p><p data-v-3a9bae83><strong data-v-3a9bae83>Monto:</strong> ${t.ssrInterpolate(e.unref(c)(M.value.monto))}</p><p data-v-3a9bae83><strong data-v-3a9bae83>Concepto:</strong> ${t.ssrInterpolate(M.value.concepto||"-")}</p><p class="id-huerfano" data-v-3a9bae83><strong data-v-3a9bae83>ID hu茅rfano:</strong> ${t.ssrInterpolate(M.value.paciente_id)}</p></div>`):a("\x3c!----\x3e"),a(`<div class="form-group" data-v-3a9bae83><label for="paciente-select" data-v-3a9bae83>Seleccionar paciente:</label><select id="paciente-select" class="input-select" data-v-3a9bae83><option value="" data-v-3a9bae83${t.ssrIncludeBooleanAttr(Array.isArray(B.value)?t.ssrLooseContain(B.value,""):t.ssrLooseEqual(B.value,""))?" selected":""}>-- Seleccionar --</option>\x3c!--[--\x3e`),t.ssrRenderList(e.unref(b),e=>{a(`<option${t.ssrRenderAttr("value",e.id)} data-v-3a9bae83${t.ssrIncludeBooleanAttr(Array.isArray(B.value)?t.ssrLooseContain(B.value,e.id):t.ssrLooseEqual(B.value,e.id))?" selected":""}>${t.ssrInterpolate(e.nombre_completo)}</option>`)}),a(`\x3c!--]--\x3e</select></div></div><div class="modal-footer" data-v-3a9bae83><button class="btn-secondary" data-v-3a9bae83> Cancelar </button><button class="btn-primary"${t.ssrIncludeBooleanAttr(!B.value||D.value)?" disabled":""} data-v-3a9bae83>`),D.value?a("<span data-v-3a9bae83>Asignando...</span>"):a("<span data-v-3a9bae83>Asignar Paciente</span>"),a("</button></div></div></div>")):a("\x3c!----\x3e")},"body",!1,o),t.ssrRenderTeleport(s,a=>{S.value?(a('<div class="modal-overlay" data-v-3a9bae83><div class="modal-factura" data-v-3a9bae83><div class="modal-header" data-v-3a9bae83><h3 data-v-3a9bae83>Generar Factura</h3><button class="btn-close" data-v-3a9bae83><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" data-v-3a9bae83><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" data-v-3a9bae83></path></svg></button></div><div class="modal-body" data-v-3a9bae83>'),V.value?a(`<div class="factura-pago-info" data-v-3a9bae83><div class="factura-pago-monto" data-v-3a9bae83><span class="monto-label" data-v-3a9bae83>Monto del pago</span><span class="monto-valor" data-v-3a9bae83>${t.ssrInterpolate(e.unref(c)(V.value.monto))}</span></div><div class="factura-pago-fecha" data-v-3a9bae83><span data-v-3a9bae83>${t.ssrInterpolate(e.unref(u)(V.value.fecha_pago))}</span><span class="metodo-badge-small" data-v-3a9bae83>${t.ssrInterpolate(getMetodoIcon(V.value.metodo_pago))} ${t.ssrInterpolate(e.unref(l)(V.value.metodo_pago))}</span></div></div>`):a("\x3c!----\x3e"),a(`<div class="form-group" data-v-3a9bae83><label data-v-3a9bae83>Tipo de cliente</label><div class="tipo-cliente-selector" data-v-3a9bae83><button class="${t.ssrRenderClass(["tipo-btn",{active:"particular"===N.value.tipoCliente}])}" data-v-3a9bae83><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" data-v-3a9bae83><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" data-v-3a9bae83></path></svg> Particular <span class="tipo-info" data-v-3a9bae83>Sin IVA (exento)</span></button><button class="${t.ssrRenderClass(["tipo-btn",{active:"empresa"===N.value.tipoCliente}])}" data-v-3a9bae83><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" data-v-3a9bae83><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 21h19.5m-18-18v18m10.5-18v18m6-13.5V21M6.75 6.75h.75m-.75 3h.75m-.75 3h.75m3-6h.75m-.75 3h.75m-.75 3h.75M6.75 21v-3.375c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21M3 3h12m-.75 4.5H21m-3.75 3.75h.008v.008h-.008v-.008zm0 3h.008v.008h-.008v-.008zm0 3h.008v.008h-.008v-.008z" data-v-3a9bae83></path></svg> Empresa <span class="tipo-info" data-v-3a9bae83>IVA 21% - IRPF 15%</span></button></div></div><div class="form-group" data-v-3a9bae83><label for="receptor-nombre" data-v-3a9bae83>Nombre del receptor *</label><input id="receptor-nombre"${t.ssrRenderAttr("value",N.value.receptorNombre)} type="text" class="input-text" placeholder="Nombre completo o raz贸n social" data-v-3a9bae83></div>`),"empresa"===N.value.tipoCliente?a(`<div class="form-row" data-v-3a9bae83><div class="form-group" data-v-3a9bae83><label for="receptor-nif" data-v-3a9bae83>NIF/CIF *</label><input id="receptor-nif"${t.ssrRenderAttr("value",N.value.receptorNif)} type="text" class="input-text" placeholder="B12345678" data-v-3a9bae83></div><div class="form-group" data-v-3a9bae83><label for="receptor-direccion" data-v-3a9bae83>Direcci贸n</label><input id="receptor-direccion"${t.ssrRenderAttr("value",N.value.receptorDireccion)} type="text" class="input-text" placeholder="Calle, n煤mero, ciudad" data-v-3a9bae83></div></div>`):a("\x3c!----\x3e"),a(`<div class="form-group" data-v-3a9bae83><label for="concepto" data-v-3a9bae83>Concepto *</label><textarea id="concepto" class="input-textarea" rows="2" placeholder="Descripci贸n del servicio" data-v-3a9bae83>${t.ssrInterpolate(N.value.concepto)}</textarea></div>`),z.value?(a(`<div class="factura-resumen" data-v-3a9bae83><div class="resumen-linea" data-v-3a9bae83><span data-v-3a9bae83>Base imponible</span><span data-v-3a9bae83>${t.ssrInterpolate(e.unref(c)(z.value.baseImponible))}</span></div>`),z.value.porcentajeIVA>0?a(`<div class="resumen-linea" data-v-3a9bae83><span data-v-3a9bae83>IVA (${t.ssrInterpolate(z.value.porcentajeIVA)}%)</span><span data-v-3a9bae83>+ ${t.ssrInterpolate(e.unref(c)(z.value.importeIVA))}</span></div>`):a("\x3c!----\x3e"),z.value.porcentajeIRPF>0?a(`<div class="resumen-linea" data-v-3a9bae83><span data-v-3a9bae83>Retenci贸n IRPF (${t.ssrInterpolate(z.value.porcentajeIRPF)}%)</span><span class="text-red" data-v-3a9bae83>- ${t.ssrInterpolate(e.unref(c)(z.value.importeIRPF))}</span></div>`):a("\x3c!----\x3e"),a(`<div class="resumen-linea resumen-total" data-v-3a9bae83><span data-v-3a9bae83>Total factura</span><span data-v-3a9bae83>${t.ssrInterpolate(e.unref(c)(z.value.total))}</span></div></div>`)):a("\x3c!----\x3e"),a(`</div><div class="modal-footer" data-v-3a9bae83><button class="btn-secondary" data-v-3a9bae83> Cancelar </button><button class="btn-primary"${t.ssrIncludeBooleanAttr(!N.value.receptorNombre||!N.value.concepto||q.value)?" disabled":""} data-v-3a9bae83>`),q.value?a("<span data-v-3a9bae83>Generando...</span>"):a("<span data-v-3a9bae83>Generar Factura</span>"),a("</button></div></div></div>")):a("\x3c!----\x3e")},"body",!1,o),t.ssrRenderTeleport(s,a=>{T.value?(a(`<div class="modal-overlay" data-v-3a9bae83><div class="modal-content modal-informe" data-v-3a9bae83><div class="modal-header" data-v-3a9bae83><h3 data-v-3a9bae83>Generar Informe</h3><button class="btn-close" data-v-3a9bae83><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" width="20" height="20" data-v-3a9bae83><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" data-v-3a9bae83></path></svg></button></div><div class="modal-body" data-v-3a9bae83><p class="informe-descripcion" data-v-3a9bae83> Genera un informe PDF con resumen ejecutivo de tu actividad financiera para tu contador o declaraciones fiscales. </p><div class="informe-tipo-selector" data-v-3a9bae83><label class="${t.ssrRenderClass([{selected:"mensual"===O.value},"informe-tipo-option"])}" data-v-3a9bae83><input type="radio"${t.ssrIncludeBooleanAttr(t.ssrLooseEqual(O.value,"mensual"))?" checked":""} value="mensual" data-v-3a9bae83><div class="informe-tipo-content" data-v-3a9bae83><span class="informe-tipo-icon" data-v-3a9bae83></span><span class="informe-tipo-label" data-v-3a9bae83>Mensual</span><span class="informe-tipo-desc" data-v-3a9bae83>Para contador mensual</span></div></label><label class="${t.ssrRenderClass([{selected:"trimestral"===O.value},"informe-tipo-option"])}" data-v-3a9bae83><input type="radio"${t.ssrIncludeBooleanAttr(t.ssrLooseEqual(O.value,"trimestral"))?" checked":""} value="trimestral" data-v-3a9bae83><div class="informe-tipo-content" data-v-3a9bae83><span class="informe-tipo-icon" data-v-3a9bae83></span><span class="informe-tipo-label" data-v-3a9bae83>Trimestral</span><span class="informe-tipo-desc" data-v-3a9bae83>Modelo 303 IVA</span></div></label><label class="${t.ssrRenderClass([{selected:"anual"===O.value},"informe-tipo-option"])}" data-v-3a9bae83><input type="radio"${t.ssrIncludeBooleanAttr(t.ssrLooseEqual(O.value,"anual"))?" checked":""} value="anual" data-v-3a9bae83><div class="informe-tipo-content" data-v-3a9bae83><span class="informe-tipo-icon" data-v-3a9bae83></span><span class="informe-tipo-label" data-v-3a9bae83>Anual</span><span class="informe-tipo-desc" data-v-3a9bae83>Declaraci贸n IRPF</span></div></label></div><div class="informe-periodo-selector" data-v-3a9bae83>`),"mensual"===O.value||"trimestral"===O.value?a(`<div class="form-group" data-v-3a9bae83><label data-v-3a9bae83>Mes</label><select class="form-select" data-v-3a9bae83><option${t.ssrRenderAttr("value",1)} data-v-3a9bae83${t.ssrIncludeBooleanAttr(Array.isArray(U.value)?t.ssrLooseContain(U.value,1):t.ssrLooseEqual(U.value,1))?" selected":""}>Enero</option><option${t.ssrRenderAttr("value",2)} data-v-3a9bae83${t.ssrIncludeBooleanAttr(Array.isArray(U.value)?t.ssrLooseContain(U.value,2):t.ssrLooseEqual(U.value,2))?" selected":""}>Febrero</option><option${t.ssrRenderAttr("value",3)} data-v-3a9bae83${t.ssrIncludeBooleanAttr(Array.isArray(U.value)?t.ssrLooseContain(U.value,3):t.ssrLooseEqual(U.value,3))?" selected":""}>Marzo</option><option${t.ssrRenderAttr("value",4)} data-v-3a9bae83${t.ssrIncludeBooleanAttr(Array.isArray(U.value)?t.ssrLooseContain(U.value,4):t.ssrLooseEqual(U.value,4))?" selected":""}>Abril</option><option${t.ssrRenderAttr("value",5)} data-v-3a9bae83${t.ssrIncludeBooleanAttr(Array.isArray(U.value)?t.ssrLooseContain(U.value,5):t.ssrLooseEqual(U.value,5))?" selected":""}>Mayo</option><option${t.ssrRenderAttr("value",6)} data-v-3a9bae83${t.ssrIncludeBooleanAttr(Array.isArray(U.value)?t.ssrLooseContain(U.value,6):t.ssrLooseEqual(U.value,6))?" selected":""}>Junio</option><option${t.ssrRenderAttr("value",7)} data-v-3a9bae83${t.ssrIncludeBooleanAttr(Array.isArray(U.value)?t.ssrLooseContain(U.value,7):t.ssrLooseEqual(U.value,7))?" selected":""}>Julio</option><option${t.ssrRenderAttr("value",8)} data-v-3a9bae83${t.ssrIncludeBooleanAttr(Array.isArray(U.value)?t.ssrLooseContain(U.value,8):t.ssrLooseEqual(U.value,8))?" selected":""}>Agosto</option><option${t.ssrRenderAttr("value",9)} data-v-3a9bae83${t.ssrIncludeBooleanAttr(Array.isArray(U.value)?t.ssrLooseContain(U.value,9):t.ssrLooseEqual(U.value,9))?" selected":""}>Septiembre</option><option${t.ssrRenderAttr("value",10)} data-v-3a9bae83${t.ssrIncludeBooleanAttr(Array.isArray(U.value)?t.ssrLooseContain(U.value,10):t.ssrLooseEqual(U.value,10))?" selected":""}>Octubre</option><option${t.ssrRenderAttr("value",11)} data-v-3a9bae83${t.ssrIncludeBooleanAttr(Array.isArray(U.value)?t.ssrLooseContain(U.value,11):t.ssrLooseEqual(U.value,11))?" selected":""}>Noviembre</option><option${t.ssrRenderAttr("value",12)} data-v-3a9bae83${t.ssrIncludeBooleanAttr(Array.isArray(U.value)?t.ssrLooseContain(U.value,12):t.ssrLooseEqual(U.value,12))?" selected":""}>Diciembre</option></select></div>`):a("\x3c!----\x3e"),a('<div class="form-group" data-v-3a9bae83><label data-v-3a9bae83>A帽o</label><select class="form-select" data-v-3a9bae83>\x3c!--[--\x3e'),t.ssrRenderList([2024,2025,2026],e=>{a(`<option${t.ssrRenderAttr("value",e)} data-v-3a9bae83${t.ssrIncludeBooleanAttr(Array.isArray(G.value)?t.ssrLooseContain(G.value,e):t.ssrLooseEqual(G.value,e))?" selected":""}>${t.ssrInterpolate(e)}</option>`)}),a(`\x3c!--]--\x3e</select></div></div><div class="informe-preview" data-v-3a9bae83><div class="informe-preview-header" data-v-3a9bae83>Vista previa del informe</div><div class="informe-preview-content" data-v-3a9bae83><div class="preview-item" data-v-3a9bae83><span class="preview-label" data-v-3a9bae83>Tipo:</span><span class="preview-value" data-v-3a9bae83>${t.ssrInterpolate("mensual"===O.value?"Informe Mensual":"trimestral"===O.value?"Informe Trimestral":"Informe Anual")}</span></div><div class="preview-item" data-v-3a9bae83><span class="preview-label" data-v-3a9bae83>Per铆odo:</span><span class="preview-value" data-v-3a9bae83>`),"mensual"===O.value?a(`\x3c!--[--\x3e${t.ssrInterpolate(new Date(G.value,U.value-1).toLocaleDateString("es-ES",{month:"long",year:"numeric"}))}\x3c!--]--\x3e`):"trimestral"===O.value?a(`\x3c!--[--\x3e${t.ssrInterpolate(Math.floor((U.value-1)/3)+1)}潞 Trimestre ${t.ssrInterpolate(G.value)}\x3c!--]--\x3e`):a(`\x3c!--[--\x3e A帽o ${t.ssrInterpolate(G.value)}\x3c!--]--\x3e`),a('</span></div><div class="preview-item" data-v-3a9bae83><span class="preview-label" data-v-3a9bae83>Incluye:</span><span class="preview-value" data-v-3a9bae83>Resumen financiero, desglose por m茅todo, datos fiscales</span></div></div></div></div><div class="modal-footer" data-v-3a9bae83><button class="btn-secondary" data-v-3a9bae83>Cancelar</button><button class="btn-primary" data-v-3a9bae83><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="18" height="18" data-v-3a9bae83><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" data-v-3a9bae83></path></svg> Generar PDF </button></div></div></div>')):a("\x3c!----\x3e")},"body",!1,o),s("</div>")}}}),h=x.setup;x.setup=(a,t)=>{const s=e.useSSRContext();return(s.modules||(s.modules=new Set)).add("pages/terapeuta/pagos/index.vue"),h?h(a,t):void 0};const w=u(x,[["__scopeId","data-v-3a9bae83"]]);export{w as default};
//# sourceMappingURL=index-CLZ4Gzd3.mjs.map
