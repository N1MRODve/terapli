import{defineComponent as a,ref as e,computed as t,watch as r,mergeProps as d,unref as o,nextTick as s,useSSRContext as n}from"vue";import{ssrRenderAttrs as l,ssrRenderComponent as i,ssrRenderClass as c,ssrRenderTeleport as v,ssrRenderStyle as u,ssrInterpolate as b,ssrRenderAttr as g,ssrIncludeBooleanAttr as p,ssrLooseContain as m,ssrLooseEqual as x,ssrRenderList as f}from"vue/server-renderer";import{useRoute as h,useRouter as y}from"vue-router";import{u as k}from"./useCitas-DyEZH6RI.mjs";import{_ as w}from"./_plugin-vue_export-helper-1tPrXgE0.mjs";import{_ as $}from"./AgendaTerapeuta-DO67d38s.mjs";import{_}from"./ModalNuevaCita-6Mm-k6WH.mjs";import{M as D}from"./ModalDetallesCita-4YIA-weF.mjs";import"./useSupabaseClient-DykwVqLQ.mjs";import"./server.mjs";import"../nitro/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"../routes/renderer.mjs";import"unhead/server";import"devalue";import"unhead/plugins";import"unhead/utils";import"@supabase/ssr";import"@vercel/analytics/nuxt";import"@heroicons/vue/24/outline";import"./useSupabase-DljD0dj8.mjs";const S={pendiente:{border:"border-amber-200 dark:border-amber-800",bg:"bg-white dark:bg-zinc-800",badge:"bg-amber-400 dark:bg-amber-500",dot:"bg-amber-400 dark:bg-amber-500",hover:"hover:bg-amber-50 dark:hover:bg-amber-950/20"},confirmada:{border:"border-emerald-200 dark:border-emerald-800",bg:"bg-white dark:bg-zinc-800",badge:"bg-emerald-400 dark:bg-emerald-500",dot:"bg-emerald-400 dark:bg-emerald-500",hover:"hover:bg-emerald-50 dark:hover:bg-emerald-950/20"},cancelada:{border:"border-rose-200 dark:border-rose-800",bg:"bg-white dark:bg-zinc-800",badge:"bg-rose-400 dark:bg-rose-500",dot:"bg-rose-400 dark:bg-rose-500",hover:"hover:bg-rose-50 dark:hover:bg-rose-950/20"},realizada:{border:"border-blue-200 dark:border-blue-800",bg:"bg-white dark:bg-zinc-800",badge:"bg-blue-400 dark:bg-blue-500",dot:"bg-blue-400 dark:bg-blue-500",hover:"hover:bg-blue-50 dark:hover:bg-blue-950/20"}},formatearMesAnio=a=>new Date(a+"T00:00:00").toLocaleDateString("es-ES",{month:"long",year:"numeric"}),formatearDiaSemana=a=>new Date(a+"T00:00:00").toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"short"}),obtenerTituloAgenda=(a,e)=>{const t="string"==typeof e?e:e.toISOString().split("T")[0];switch(a){case"dia":return(a=>new Date(a+"T00:00:00").toLocaleDateString("es-ES",{day:"2-digit",month:"long",year:"numeric"}))(t);case"semana":return`${formatearMesAnio(t)} â€” Semana ${(a=>{const e=new Date(a+"T00:00:00"),t=new Date(e.getFullYear(),0,1),r=e.getTime()-t.getTime();return Math.ceil((r/864e5+t.getDay()+1)/7)})(t)}`;case"mes":return formatearMesAnio(t);default:return""}},I=a({__name:"AgendaHeader",__ssrInlineRender:!0,props:{vista:{},fechaActual:{},darkMode:{type:Boolean}},emits:["update:vista","update:fechaActual","update:darkMode","nueva-cita"],setup(a,{emit:e}){const r=a,o=t(()=>obtenerTituloAgenda(r.vista,r.fechaActual));return(e,t,r,s)=>{t(`<header${l(d({class:"sticky top-0 z-20 bg-white/70 dark:bg-gray-950/70 backdrop-blur-md border-b border-cafe/10 dark:border-gray-800 shadow-sm"},s))} data-v-9c60bdb2><div class="px-4 py-2.5 sm:px-6 lg:px-6" data-v-9c60bdb2><div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3" data-v-9c60bdb2><div class="flex items-center gap-2.5" data-v-9c60bdb2><div class="flex items-center gap-0.5" data-v-9c60bdb2><button class="px-2.5 py-1.5 border border-cafe/20 dark:border-gray-700 rounded-lg hover:bg-terracota/10 dark:hover:bg-gray-800 hover:border-terracota transition-all duration-200" aria-label="Periodo anterior" data-v-9c60bdb2><svg class="w-4 h-4 text-cafe dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-9c60bdb2><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" data-v-9c60bdb2></path></svg></button><button class="px-3.5 py-1.5 mx-1 border border-cafe/20 dark:border-gray-700 rounded-lg hover:bg-terracota/10 dark:hover:bg-gray-800 hover:border-terracota transition-all duration-200 text-sm font-medium text-cafe dark:text-gray-300" data-v-9c60bdb2> Hoy </button><button class="px-2.5 py-1.5 border border-cafe/20 dark:border-gray-700 rounded-lg hover:bg-terracota/10 dark:hover:bg-gray-800 hover:border-terracota transition-all duration-200" aria-label="Periodo siguiente" data-v-9c60bdb2><svg class="w-4 h-4 text-cafe dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-9c60bdb2><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" data-v-9c60bdb2></path></svg></button></div><h1 class="text-lg sm:text-xl font-serif font-bold text-cafe dark:text-gray-100 ml-1" data-v-9c60bdb2>${b(o.value)}</h1></div><div class="flex items-center gap-2.5 w-full sm:w-auto" data-v-9c60bdb2><div class="flex border border-cafe/20 dark:border-gray-700 rounded-xl overflow-hidden shadow-xs" data-v-9c60bdb2><button class="${c(["px-3 py-1.5 text-sm font-medium transition-all duration-200","dia"===a.vista?"bg-terracota text-white shadow-sm":"bg-white dark:bg-gray-900 text-cafe dark:text-gray-300 hover:bg-terracota/10 dark:hover:bg-gray-800"])}" aria-label="Vista de dÃ­a" data-v-9c60bdb2> ğŸ“… DÃ­a </button><button class="${c(["px-3 py-1.5 text-sm font-medium transition-all duration-200 border-l border-cafe/10 dark:border-gray-700","semana"===a.vista?"bg-terracota text-white shadow-sm":"bg-white dark:bg-gray-900 text-cafe dark:text-gray-300 hover:bg-terracota/10 dark:hover:bg-gray-800"])}" aria-label="Vista de semana" data-v-9c60bdb2> ğŸ“† Semana </button><button class="${c(["px-3 py-1.5 text-sm font-medium transition-all duration-200 border-l border-cafe/10 dark:border-gray-700","mes"===a.vista?"bg-terracota text-white shadow-sm":"bg-white dark:bg-gray-900 text-cafe dark:text-gray-300 hover:bg-terracota/10 dark:hover:bg-gray-800"])}" aria-label="Vista de mes" data-v-9c60bdb2> ğŸ—“ï¸ Mes </button></div><button class="flex items-center gap-2 px-2.5 py-1.5 border border-cafe/20 dark:border-gray-700 rounded-xl hover:bg-terracota/10 dark:hover:bg-gray-800 hover:border-terracota transition-all duration-200"${g("aria-label",a.darkMode?"Desactivar modo oscuro":"Activar modo oscuro")} data-v-9c60bdb2>`),a.darkMode?t('<span class="text-lg" data-v-9c60bdb2>ğŸŒ™</span>'):t('<span class="text-lg" data-v-9c60bdb2>â˜€ï¸</span>'),t('</button><button class="flex items-center gap-2 px-4 py-1.5 bg-terracota hover:bg-terracota/90 text-white rounded-xl transition-all duration-200 shadow-sm hover:shadow-md font-medium text-sm" data-v-9c60bdb2><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-9c60bdb2><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" data-v-9c60bdb2></path></svg> Nueva Cita </button></div></div></div></header>')}}}),T=I.setup;I.setup=(a,e)=>{const t=n();return(t.modules||(t.modules=new Set)).add("components/agenda/AgendaHeader.vue"),T?T(a,e):void 0};const A=Object.assign(w(I,[["__scopeId","data-v-9c60bdb2"]]),{__name:"AgendaHeader"}),C=a({__name:"AgendaFilters",__ssrInlineRender:!0,props:{filtros:{},terapeutas:{},pacientes:{}},emits:["update:filtros","update:busqueda"],setup(a,{emit:r}){const o=a,s=r,n=e(""),i=e(!1),v=[{value:"online",label:"Online",emoji:"ğŸ’»"},{value:"presencial",label:"Presencial",emoji:"ğŸ¢"}],u=t({get:()=>o.filtros.pacienteId||"",set:a=>actualizarFiltro("pacienteId",a||void 0)}),h=t({get:()=>o.filtros.modalidad||"",set:a=>actualizarFiltro("modalidad",a||void 0)}),y=t({get:()=>o.filtros.fechaDesde||"",set:a=>actualizarFiltro("fechaDesde",a||void 0)}),k=t({get:()=>o.filtros.fechaHasta||"",set:a=>actualizarFiltro("fechaHasta",a||void 0)}),w=t(()=>{let a=0;return u.value&&a++,h.value&&a++,(y.value||k.value)&&a++,a}),actualizarFiltro=(a,e)=>{s("update:filtros",{...o.filtros,[a]:e})};return(e,t,r,o)=>{t(`<div${l(d({class:"bg-white/60 dark:bg-gray-950/60 backdrop-blur-sm border-b border-cafe/5 dark:border-gray-800 shadow-sm"},o))} data-v-fb697357><div class="px-4 py-2 sm:px-6 lg:px-6 space-y-2" data-v-fb697357><div class="flex items-center gap-3" data-v-fb697357><div class="flex-1 relative" data-v-fb697357><input${g("value",n.value)} type="text" placeholder="Buscar por paciente, terapeuta, notas..." class="w-full px-3 py-1.5 pl-9 text-sm border border-cafe/20 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-terracota focus:border-terracota bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-all" data-v-fb697357><svg class="absolute left-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-cafe/50 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-fb697357><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" data-v-fb697357></path></svg></div><button class="${c([{"bg-terracota/10 border-terracota text-terracota":w.value>0},"flex items-center gap-1.5 px-3 py-1.5 text-sm border border-cafe/20 dark:border-gray-700 rounded-lg hover:bg-terracota/10 dark:hover:bg-gray-800 hover:border-terracota transition-all duration-200"])}" data-v-fb697357><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-fb697357><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" data-v-fb697357></path></svg><span data-v-fb697357>Filtros</span>`),w.value>0?t(`<span class="px-1.5 py-0.5 bg-terracota text-white text-xs rounded-full" data-v-fb697357>${b(w.value)}</span>`):t("\x3c!----\x3e"),t("</button>"),w.value>0||n.value?t('<button class="px-3 py-1.5 text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-950/30 rounded-lg transition-all duration-200" data-v-fb697357> Limpiar </button>'):t("\x3c!----\x3e"),t("</div>"),i.value?(t(`<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 pt-2" data-v-fb697357><div data-v-fb697357><label class="block text-xs font-medium text-cafe/70 dark:text-gray-300 mb-1" data-v-fb697357> Paciente </label><select class="w-full px-3 py-1.5 text-sm border border-cafe/20 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-terracota focus:border-terracota bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100" data-v-fb697357><option value="" data-v-fb697357${p(Array.isArray(u.value)?m(u.value,""):x(u.value,""))?" selected":""}>Todos los pacientes</option>\x3c!--[--\x3e`),f(a.pacientes,a=>{t(`<option${g("value",a.id)} data-v-fb697357${p(Array.isArray(u.value)?m(u.value,a.id):x(u.value,a.id))?" selected":""}>${b(a.nombre)}</option>`)}),t(`\x3c!--]--\x3e</select></div><div data-v-fb697357><label class="block text-xs font-medium text-cafe/70 dark:text-gray-300 mb-1" data-v-fb697357> Modalidad </label><select class="w-full px-3 py-1.5 text-sm border border-cafe/20 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-terracota focus:border-terracota bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100" data-v-fb697357><option value="" data-v-fb697357${p(Array.isArray(h.value)?m(h.value,""):x(h.value,""))?" selected":""}>Todas las modalidades</option>\x3c!--[--\x3e`),f(v,a=>{t(`<option${g("value",a.value)} data-v-fb697357${p(Array.isArray(h.value)?m(h.value,a.value):x(h.value,a.value))?" selected":""}>${b(a.emoji)} ${b(a.label)}</option>`)}),t(`\x3c!--]--\x3e</select></div><div data-v-fb697357><label class="block text-xs font-medium text-cafe/70 dark:text-gray-300 mb-1" data-v-fb697357> Rango de fechas </label><div class="flex gap-2" data-v-fb697357><input${g("value",y.value)} type="date" class="flex-1 px-3 py-1.5 text-sm border border-cafe/20 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-terracota focus:border-terracota bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100" data-v-fb697357><input${g("value",k.value)} type="date" class="flex-1 px-3 py-1.5 text-sm border border-cafe/20 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-terracota focus:border-terracota bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100" data-v-fb697357></div></div></div>`)):t("\x3c!----\x3e"),t("</div></div>")}}}),F=C.setup;C.setup=(a,e)=>{const t=n();return(t.modules||(t.modules=new Set)).add("components/agenda/AgendaFilters.vue"),F?F(a,e):void 0};const M=Object.assign(w(C,[["__scopeId","data-v-fb697357"]]),{__name:"AgendaFilters"}),j=a({__name:"AgendaLegend",__ssrInlineRender:!0,setup(a){const e=[{key:"pendiente",label:"Pendiente",emoji:"ğŸŸ¡",bgClass:"bg-yellow-100",textClass:"text-yellow-800"},{key:"confirmada",label:"Confirmada",emoji:"ğŸŸ¢",bgClass:"bg-green-100",textClass:"text-green-700"},{key:"realizada",label:"Realizada",emoji:"ğŸ”µ",bgClass:"bg-blue-100",textClass:"text-blue-700"},{key:"cancelada",label:"Cancelada",emoji:"ğŸ”´",bgClass:"bg-red-100",textClass:"text-red-700"}];return(a,t,r,o)=>{t(`<div${l(d({class:"flex flex-wrap gap-2 items-center py-1.5"},o))} data-v-5f57fa35>\x3c!--[--\x3e`),f(e,a=>{t(`<div class="${c(["flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium transition-all duration-200 hover:scale-105",a.bgClass,a.textClass])}" data-v-5f57fa35><span class="text-base" data-v-5f57fa35>${b(a.emoji)}</span><span data-v-5f57fa35>${b(a.label)}</span></div>`)}),t("\x3c!--]--\x3e</div>")}}}),O=j.setup;j.setup=(a,e)=>{const t=n();return(t.modules||(t.modules=new Set)).add("components/agenda/AgendaLegend.vue"),O?O(a,e):void 0};const z=Object.assign(w(j,[["__scopeId","data-v-5f57fa35"]]),{__name:"AgendaLegend"}),E=a({__name:"AgendaEventCard",__ssrInlineRender:!0,props:{event:{},compact:{type:Boolean},draggable:{type:Boolean}},emits:["open","menu"],setup(a,{emit:e}){const r=a;t(()=>S[r.event.estado]||S.cancelada);const o=t(()=>`${r.event.horaInicio} â€“ ${r.event.horaFin}`),s=t(()=>r.event.horaInicio),n=t(()=>r.event.pacienteNombre||"Paciente sin nombre");t(()=>({pendiente:"ğŸŸ¡",confirmada:"ğŸŸ¢",cancelada:"ğŸ”´",completada:"âšª",realizada:"ğŸ”µ"}[r.event.estado]||"âšª"));const i=t(()=>r.event.bono&&void 0!==r.event.bono.sesionesRestantes),v=t(()=>{if(!r.event.bono)return"green";const a=r.event.bono.sesionesRestantes||0;return 0===a?"red":1===a?"orange":a<=2?"yellow":"green"});return(e,t,r,u)=>{t(`<div${l(d({class:"agenda-event group","data-estado":a.event.estado,"data-compact":a.compact,draggable:a.draggable,role:"button",tabindex:"0",title:`${n.value} - ${o.value}`},u))} data-v-720e5f4d><div class="${c(["flex flex-col justify-center",a.compact?"gap-0.5":"gap-1"])}" data-v-720e5f4d><span class="hora" data-v-720e5f4d>${b(a.compact?s.value:o.value)}</span><span class="nombre" data-v-720e5f4d><span class="estado-dot" data-v-720e5f4d></span> ${b(n.value)}</span>`),a.compact?t("\x3c!----\x3e"):(t('<div class="info-adicional" data-v-720e5f4d>'),a.event.modalidad?(t('<span class="modalidad" data-v-720e5f4d>'),"online"===a.event.modalidad?t("<span data-v-720e5f4d>ğŸ’»</span>"):t("<span data-v-720e5f4d>ğŸ¥</span>"),t(` ${b("online"===a.event.modalidad?"Online":"Presencial")}</span>`)):t("\x3c!----\x3e"),a.event.areaTerapeutica?t(`<span class="area" data-v-720e5f4d>${b(a.event.areaTerapeutica)}</span>`):t("\x3c!----\x3e"),i.value?t(`<span class="bono-info"${g("data-color",v.value)} data-v-720e5f4d>${b(a.event.bono.sesionesRestantes)}/${b(a.event.bono.sesionesTotales)} sesiones </span>`):t("\x3c!----\x3e"),a.event.notas||a.event.terapeuta?(t('<div class="indicadores" data-v-720e5f4d>'),a.event.notas?t('<span title="Tiene notas" data-v-720e5f4d>ğŸ“</span>'):t("\x3c!----\x3e"),a.event.terapeuta?t(`<span${g("title",`Terapeuta: ${a.event.terapeuta.nombre}`)} data-v-720e5f4d>ğŸ‘¤</span>`):t("\x3c!----\x3e"),t("</div>")):t("\x3c!----\x3e"),t("</div>")),t("</div>"),a.compact?t("\x3c!----\x3e"):t('<button class="menu-btn" aria-label="Abrir menÃº de acciones" type="button" data-v-720e5f4d><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20" data-v-720e5f4d><path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z" data-v-720e5f4d></path></svg></button>'),t("</div>")}}}),R=E.setup;E.setup=(a,e)=>{const t=n();return(t.modules||(t.modules=new Set)).add("components/agenda/AgendaEventCard.vue"),R?R(a,e):void 0};const L=Object.assign(w(E,[["__scopeId","data-v-720e5f4d"]]),{__name:"AgendaEventCard"}),H=a({__name:"AgendaGrid",__ssrInlineRender:!0,props:{eventos:{},vista:{},fechaActual:{},cargando:{type:Boolean},draggable:{type:Boolean}},emits:["evento-click","evento-menu","slot-click","evento-drop"],setup(a,{emit:n}){const v=a;e(null);const p=e("normal"),m=e(null),x=e("0px"),h=e(!1),y=e(new Set),k=((a="08:00",e="20:00",t=30)=>{const r=[],[d,o]=a.split(":").map(Number),[s,n]=e.split(":").map(Number);let l=d,i=o;for(;l<s||l===s&&i<n;)r.push(`${String(l).padStart(2,"0")}:${String(i).padStart(2,"0")}`),i+=t,i>=60&&(l++,i-=60);return r})("08:00","22:30",30);t(()=>{switch(p.value){case"compact":return"h-8";case"normal":default:return"h-10";case"comfortable":return"h-16"}});const w=t(()=>{const a=v.fechaActual.toISOString().split("T")[0];if("dia"===v.vista)return[a];if("semana"===v.vista){const e=(a=>{const e=new Date(a+"T00:00:00"),t=e.getDay(),r=0===t?-6:1-t;return e.setDate(e.getDate()+r),e.toISOString().split("T")[0]})(a);return Array.from({length:7},(a,t)=>((a,e)=>{const t=new Date(a+"T00:00:00");return t.setDate(t.getDate()+e),t.toISOString().split("T")[0]})(e,t))}{const a=new Date(v.fechaActual.getFullYear(),v.fechaActual.getMonth(),1),e=new Date(v.fechaActual.getFullYear(),v.fechaActual.getMonth()+1,0);let t=a.getDay();t=0===t?6:t-1;let r=e.getDay();r=0===r?6:r-1;const d=[];for(let e=t-1;e>=0;e--){const t=new Date(a);t.setDate(t.getDate()-(e+1)),d.push(t.toISOString().split("T")[0])}for(let t=new Date(a);t<=e;t.setDate(t.getDate()+1))d.push(t.toISOString().split("T")[0]);const o=6-r;for(let a=1;a<=o;a++){const t=new Date(e);t.setDate(t.getDate()+a),d.push(t.toISOString().split("T")[0])}return d}}),$=t(()=>{const a=new Map;return v.eventos.forEach(e=>{const t=e.fecha;a.has(t)||a.set(t,[]),a.get(t).push(e)}),a.forEach((a,e)=>{a.sort((a,e)=>a.horaInicio.localeCompare(e.horaInicio))}),a}),obtenerEventosEnSlot=(a,e)=>($.value.get(a)||[]).filter(a=>a.horaInicio===e),esFechaHoy=a=>a===(new Date).toISOString().split("T")[0],esMesActual=a=>{const e=new Date(a+"T00:00:00");return e.getMonth()===v.fechaActual.getMonth()&&e.getFullYear()===v.fechaActual.getFullYear()},calcularAlturaEvento=(a,e)=>{try{const t=new Date(`1970-01-01T${a}:00`),r=(new Date(`1970-01-01T${e}:00`).getTime()-t.getTime())/6e4,d="compact"===p.value?2.25:"normal"===p.value?3.5:5;return`${r*(d/30)}rem`}catch{return"2.5rem"}},calcularTopEvento=(a,e)=>{try{const t=new Date(`1970-01-01T${a}:00`),r=new Date(`1970-01-01T${e}:00`),d=(t.getTime()-r.getTime())/6e4;if(d<=0)return"0";const o="compact"===p.value?2.25:"normal"===p.value?3.5:5;return d*(o/30)+"rem"}catch{return"0"}},esCitaActiva=a=>y.value.has(a);return r([()=>v.vista,()=>v.cargando,p],()=>{v.cargando||setTimeout(()=>{"mes"===v.vista?(async()=>{if(await s(),"mes"!==v.vista)return;const a=(new Date).toISOString().split("T")[0],e=(void 0).querySelector(".agenda-mes-grid"),t=(void 0).querySelector(`[data-fecha="${a}"]`);t&&e&&t.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})})():(async()=>{if(await s(),!m.value||v.cargando)return;const a=new Date,e=`${String(a.getHours()).padStart(2,"0")}:${String(30*Math.floor(a.getMinutes()/30)).padStart(2,"0")}`,t=k.findIndex(a=>a>=e);if(-1!==t){const a="compact"===p.value?40:"normal"===p.value?56:80,e=Math.max(0,(t-2)*a);m.value.scrollTop=e}})()},100)}),(e,t,r,s)=>{t(`<div${l(d({class:"flex-1 flex flex-col overflow-hidden bg-[#FFF9F6] dark:bg-gray-900"},s))} data-v-e146059a>`),a.cargando?t('<div class="flex items-center justify-center h-full" data-v-e146059a><div class="text-center space-y-3" data-v-e146059a><div class="w-12 h-12 border-4 border-terracota/20 border-t-terracota rounded-full animate-spin mx-auto" data-v-e146059a></div><p class="text-cafe/60 dark:text-gray-400" data-v-e146059a>Cargando agenda...</p></div></div>'):t("\x3c!----\x3e"),a.cargando?t("\x3c!----\x3e"):t(`<div class="agenda-controls" data-v-e146059a><div class="leyenda-estados" data-v-e146059a><div class="estado" data-v-e146059a><span class="dot" data-color="pendiente" data-v-e146059a></span><span data-v-e146059a>Pendiente</span></div><div class="estado" data-v-e146059a><span class="dot" data-color="confirmada" data-v-e146059a></span><span data-v-e146059a>Confirmada</span></div><div class="estado" data-v-e146059a><span class="dot" data-color="realizada" data-v-e146059a></span><span data-v-e146059a>Realizada</span></div><div class="estado" data-v-e146059a><span class="dot" data-color="cancelada" data-v-e146059a></span><span data-v-e146059a>Cancelada</span></div></div><div class="zoom-toggle" data-v-e146059a><span class="text-xs text-cafe/60" data-v-e146059a>Zoom:</span><button class="${c(["px-2 py-1 rounded-md transition-all","compact"===p.value?"bg-terracota text-white":"hover:bg-terracota/10"])}" data-v-e146059a> Compacto </button><button class="${c(["px-2 py-1 rounded-md transition-all","normal"===p.value?"bg-terracota text-white":"hover:bg-terracota/10"])}" data-v-e146059a> Normal </button><button class="${c(["px-2 py-1 rounded-md transition-all","comfortable"===p.value?"bg-terracota text-white":"hover:bg-terracota/10"])}" data-v-e146059a> CÃ³modo </button></div></div>`),a.cargando||"dia"!==a.vista?t("\x3c!----\x3e"):(t('<div class="agenda-container" data-v-e146059a><div class="agenda-grid-dia" data-v-e146059a>'),h.value?t(`<div class="linea-tiempo-actual" style="${u({top:x.value})}" data-v-e146059a><div class="circulo-tiempo" data-v-e146059a></div><div class="texto-tiempo" data-v-e146059a>${b((new Date).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}))}</div></div>`):t("\x3c!----\x3e"),t("\x3c!--[--\x3e"),f(o(k),(a,e)=>{t(`<div class="${c([e%2==0?"bg-white":"bg-[#FFFAF7]","agenda-cell-dia"])}" style="${u({minHeight:"compact"===p.value?"2.5rem":"normal"===p.value?"3.5rem":"5rem"})}" data-v-e146059a><div class="hora-dia" data-v-e146059a>${b(a)}</div><div class="eventos-container" data-v-e146059a>\x3c!--[--\x3e`),f(obtenerEventosEnSlot(w.value[0],a),(a,e)=>{t(`<div class="${c([{"cita-activa":esCitaActiva(a.id)},"agenda-event-dia"])}"${g("data-estado",a.estado)} style="${u({"--event-height":calcularAlturaEvento(a.horaInicio,a.horaFin)})}" data-v-e146059a><span class="hora" data-v-e146059a>${b(a.horaInicio)} - ${b(a.horaFin)}</span><span class="nombre" data-v-e146059a>${b(a.pacienteNombre)}</span>`),"compact"!==p.value?(t('<div class="info-extra" data-v-e146059a>'),a.modalidad?t(`<span class="text-[10px]" data-v-e146059a>${b("online"===a.modalidad?"ğŸ’»":"ğŸ¥")}</span>`):t("\x3c!----\x3e"),a.areaTerapeutica?t(`<span class="text-[10px] text-cafe/60" data-v-e146059a>${b(a.areaTerapeutica)}</span>`):t("\x3c!----\x3e"),t("</div>")):t("\x3c!----\x3e"),t(`<div class="tooltip" data-v-e146059a><div class="font-semibold" data-v-e146059a>${b(a.pacienteNombre)}</div><div data-v-e146059a>${b(a.horaInicio)} - ${b(a.horaFin)}</div>`),a.modalidad?t(`<div data-v-e146059a>${b("online"===a.modalidad?"ğŸ’» Online":"ğŸ¥ Presencial")}</div>`):t("\x3c!----\x3e"),a.areaTerapeutica?t(`<div class="text-[10px] opacity-80" data-v-e146059a>${b(a.areaTerapeutica)}</div>`):t("\x3c!----\x3e"),t("</div></div>")}),t("\x3c!--]--\x3e</div></div>")}),t("\x3c!--]--\x3e</div></div>")),a.cargando||"semana"!==a.vista?t("\x3c!----\x3e"):(t('<div class="agenda-container" data-v-e146059a><div class="agenda-days" data-v-e146059a><div class="col-span-1" data-v-e146059a></div>\x3c!--[--\x3e'),f(w.value,a=>{t(`<div class="${c([esFechaHoy(a)?"bg-terracota/5 border-b-2 border-terracota":"","py-2 px-1"])}" data-v-e146059a><div class="text-xs font-medium text-cafe/70" data-v-e146059a>${b(o(formatearDiaSemana)(a).split(",")[0])}</div><div class="text-sm font-bold text-cafe" data-v-e146059a>${b(new Date(a+"T00:00:00").getDate())}</div></div>`)}),t('\x3c!--]--\x3e</div><div class="agenda-grid" data-v-e146059a>'),h.value?t(`<div class="linea-tiempo-actual" style="${u({top:x.value,left:"0",right:"0",gridColumn:"1 / -1"})}" data-v-e146059a><div class="circulo-tiempo" data-v-e146059a></div><div class="texto-tiempo" data-v-e146059a>${b((new Date).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}))}</div></div>`):t("\x3c!----\x3e"),t("\x3c!--[--\x3e"),f(o(k),(a,e)=>{t(`\x3c!--[--\x3e<div class="agenda-hours" data-v-e146059a>${b(a)}</div>\x3c!--[--\x3e`),f(w.value,r=>{t(`<div class="${c([e%2==0?"bg-white":"bg-[#FFFAF7]","agenda-cell"])}" data-v-e146059a>\x3c!--[--\x3e`),f(obtenerEventosEnSlot(r,a),e=>{t(`<div class="${c([{"cita-activa":esCitaActiva(e.id)},"agenda-event"])}"${g("data-estado",e.estado)} style="${u({"--event-height":calcularAlturaEvento(e.horaInicio,e.horaFin),top:calcularTopEvento(e.horaInicio,a)})}" data-v-e146059a><span class="hora" data-v-e146059a>${b(e.horaInicio)} - ${b(e.horaFin)}</span><span class="nombre" data-v-e146059a>${b(e.pacienteNombre)}</span><div class="tooltip" data-v-e146059a><div class="font-semibold" data-v-e146059a>${b(e.pacienteNombre)}</div><div data-v-e146059a>${b(e.horaInicio)} - ${b(e.horaFin)}</div>`),e.modalidad?t(`<div data-v-e146059a>${b("online"===e.modalidad?"ğŸ’» Online":"ğŸ¥ Presencial")}</div>`):t("\x3c!----\x3e"),e.areaTerapeutica?t(`<div class="text-[10px] opacity-80" data-v-e146059a>${b(e.areaTerapeutica)}</div>`):t("\x3c!----\x3e"),t("</div></div>")}),t("\x3c!--]--\x3e</div>")}),t("\x3c!--]--\x3e\x3c!--]--\x3e")}),t("\x3c!--]--\x3e</div></div>")),a.cargando||"mes"!==a.vista?t("\x3c!----\x3e"):(t('<div class="agenda-mes-container" data-v-e146059a><div class="agenda-mes-grid" data-v-e146059a>\x3c!--[--\x3e'),f(["Lun","Mar","MiÃ©","Jue","Vie","SÃ¡b","Dom"],a=>{t(`<div class="agenda-mes-header" data-v-e146059a>${b(a)}</div>`)}),t("\x3c!--]--\x3e\x3c!--[--\x3e"),f(w.value,a=>{t(`<div${g("data-fecha",a)} class="${c([[esFechaHoy(a)?"dia-hoy":"",esMesActual(a)?"":"dia-otro-mes"],"agenda-dia-mes"])}" data-v-e146059a><div class="agenda-dia-header" data-v-e146059a><span class="dia-numero" data-v-e146059a>${b(new Date(a+"T00:00:00").getDate())}</span><div class="flex items-center gap-1" data-v-e146059a>`),($.value.get(a)||[]).length>0?t(`<span class="contador-citas"${g("title",`${($.value.get(a)||[]).length} cita${($.value.get(a)||[]).length>1?"s":""}`)} data-v-e146059a>${b(($.value.get(a)||[]).length)}</span>`):t("\x3c!----\x3e"),esFechaHoy(a)?t('<span class="dia-hoy-badge" data-v-e146059a>Hoy</span>'):t("\x3c!----\x3e"),t('</div></div><div class="agenda-dia-eventos" data-v-e146059a>\x3c!--[--\x3e'),f(($.value.get(a)||[]).slice(0,2),a=>{t(i(L,{key:a.id,event:a,compact:!0,onOpen:t=>e.$emit("evento-click",a.id)},null,r))}),t("\x3c!--]--\x3e"),($.value.get(a)||[]).length>2?t(`<button class="mas-eventos"${g("title",`Ver todas las ${($.value.get(a)||[]).length} citas de este dÃ­a`)} data-v-e146059a> +${b(($.value.get(a)||[]).length-2)} mÃ¡s </button>`):t("\x3c!----\x3e"),t("</div></div>")}),t("\x3c!--]--\x3e</div></div>")),t("</div>")}}}),N=H.setup;H.setup=(a,e)=>{const t=n();return(t.modules||(t.modules=new Set)).add("components/agenda/AgendaGrid.vue"),N?N(a,e):void 0};const B=Object.assign(w(H,[["__scopeId","data-v-e146059a"]]),{__name:"AgendaGrid"}),V=a({__name:"index",__ssrInlineRender:!0,props:{legacyFallback:{type:Boolean}},setup(a){h(),y();const{getCitasRango:d}=k(),o=e([]),s=e(!1),n=e(null),b=e("semana"),g=e(new Date),p=e(!1),m=e({}),x=e(""),f=e(!1),w=e(!1),S=e(null),I=e(null),T=e(!1),C=e({x:0,y:0}),F=e(null),j=t(()=>{var a;return(null==(a=o.value)?void 0:a.length)?o.value.map(a=>{var e,t;return{id:a.cita_id||a.id,pacienteNombre:a.paciente_nombre||"Sin paciente",pacienteId:a.paciente_id,estado:a.estado,fecha:a.fecha_cita,horaInicio:(null==(e=a.hora_inicio)?void 0:e.substring(0,5))||a.hora_inicio,horaFin:(null==(t=a.hora_fin)?void 0:t.substring(0,5))||a.hora_fin,modalidad:a.modalidad,bono:a.bono_id?{id:a.bono_id,sesionesRestantes:a.bono_sesiones_restantes,sesionesTotales:a.bono_sesiones_totales}:null,terapeuta:a.terapeuta_id?{id:a.terapeuta_id,nombre:a.terapeuta_nombre}:void 0,notas:a.observaciones||void 0,areaTerapeutica:a.paciente_area||void 0,tipoSesion:a.tipo_sesion||void 0}}):[]}),O=t(()=>{var a;let e=j.value;if(x.value.trim()){const a=x.value.toLowerCase();e=e.filter(e=>{var t,r;return e.pacienteNombre.toLowerCase().includes(a)||(null==(t=e.terapeuta)?void 0:t.nombre.toLowerCase().includes(a))||(null==(r=e.notas)?void 0:r.toLowerCase().includes(a))})}return(null==(a=m.value.estados)?void 0:a.length)&&(e=e.filter(a=>m.value.estados.includes(a.estado))),m.value.terapeutaId&&(e=e.filter(a=>{var e;return(null==(e=a.terapeuta)?void 0:e.id)===m.value.terapeutaId})),m.value.pacienteId&&(e=e.filter(a=>a.pacienteId===m.value.pacienteId)),m.value.modalidad&&(e=e.filter(a=>a.modalidad===m.value.modalidad)),m.value.fechaDesde&&(e=e.filter(a=>a.fecha>=m.value.fechaDesde)),m.value.fechaHasta&&(e=e.filter(a=>a.fecha<=m.value.fechaHasta)),e}),E=t(()=>[]),R=t(()=>{var a;const e=new Map;return null==(a=o.value)||a.forEach(a=>{a.paciente_id&&e.set(a.paciente_id,{id:a.paciente_id,nombre:a.paciente_nombre||"Sin nombre"})}),Array.from(e.values())}),cargarCitas=async()=>{try{s.value=!0,n.value=null;let a,e;if("dia"===b.value)a=e=g.value.toISOString().split("T")[0];else if("semana"===b.value){const t=new Date(g.value);t.setDate(t.getDate()-t.getDay()),a=t.toISOString().split("T")[0];const r=new Date(t);r.setDate(r.getDate()+6),e=r.toISOString().split("T")[0]}else{const t=new Date(g.value.getFullYear(),g.value.getMonth(),1),r=new Date(g.value.getFullYear(),g.value.getMonth()+1,0);a=t.toISOString().split("T")[0],e=r.toISOString().split("T")[0]}const t=await d(a,e);o.value=t.filter(a=>"cancelada"!==a.estado&&"borrador"!==a.estado&&null!==a.estado)}catch(a){console.error("âŒ Error al cargar citas:",a),n.value=a.message}finally{s.value=!1}};r(b,a=>{cargarCitas()}),r(g,()=>{cargarCitas()}),r(g,a=>{}),r(p,a=>{}),r(m,a=>{},{deep:!0});const abrirModalNuevaCita=()=>{I.value=null,f.value=!0},crearCitaEnSlot=a=>{O.value.some(e=>e.fecha===a.date&&e.horaInicio===a.horaInicio)||(I.value=a,f.value=!0)},abrirDetalles=a=>{S.value=a,w.value=!0},abrirMenu=(a,e)=>{F.value=a,C.value={x:e.clientX,y:e.clientY},T.value=!0},moverCita=async(a,e)=>{try{console.log("Reprogramar cita:",a,e),await cargarCitas()}catch(a){console.error("Error al reprogramar cita:",a),alert("No se pudo reprogramar la cita. Intenta nuevamente.")}};return(e,t,r,d)=>{var o,n;t(`<div${l(d)} data-v-644cee40>`),a.legacyFallback?t(i($,null,null,r)):(t(`<div class="${c([{dark:p.value},"h-screen flex flex-col overflow-hidden bg-[#FFF9F6] dark:bg-gray-950"])}" data-v-644cee40>`),t(i(A,{vista:b.value,"onUpdate:vista":a=>b.value=a,fechaActual:g.value,"onUpdate:fechaActual":a=>g.value=a,darkMode:p.value,"onUpdate:darkMode":a=>p.value=a,onNuevaCita:abrirModalNuevaCita},null,r)),t(i(M,{filtros:m.value,"onUpdate:filtros":a=>m.value=a,"onUpdate:busqueda":a=>x.value=a,terapeutas:E.value,pacientes:R.value},null,r)),t('<div class="px-4 py-2 bg-white/60 dark:bg-gray-950/60 backdrop-blur-sm border-b border-cafe/5 dark:border-gray-800" data-v-644cee40>'),t(i(z,null,null,r)),t("</div>"),t(i(B,{eventos:O.value,vista:b.value,fechaActual:g.value,cargando:s.value,draggable:!0,onEventoClick:abrirDetalles,onEventoMenu:abrirMenu,onSlotClick:crearCitaEnSlot,onEventoDrop:moverCita},null,r)),t(i(_,{modelValue:f.value,"onUpdate:modelValue":a=>f.value=a,"fecha-inicial":null==(o=I.value)?void 0:o.date,"hora-inicial":null==(n=I.value)?void 0:n.horaInicio,onGuardado:cargarCitas},null,r)),t(i(D,{isOpen:w.value,citaId:S.value,onClose:a=>{w.value=!1,S.value=null},onActualizado:cargarCitas,onEliminado:cargarCitas},null,r)),v(t,a=>{T.value?a(`<div style="${u({top:`${C.value.y}px`,left:`${C.value.x}px`})}" class="fixed z-50 bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-700 rounded-lg shadow-lg py-1 min-w-[180px]" data-v-644cee40><button class="w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-800 transition" data-v-644cee40> Ver detalles </button><button class="w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-800 transition" data-v-644cee40> Reprogramar </button><button class="w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-800 transition text-red-600" data-v-644cee40> Cancelar cita </button></div>`):a("\x3c!----\x3e")},"body",!1,r),t('<div class="fixed bottom-4 right-4 bg-gray-900/90 dark:bg-gray-100/90 text-white dark:text-gray-900 px-3 py-2 rounded-lg text-xs opacity-0 hover:opacity-100 transition-opacity" data-v-644cee40><kbd data-v-644cee40>j/k</kbd> navegar Â· <kbd data-v-644cee40>t</kbd> hoy Â· <kbd data-v-644cee40>1/2/3</kbd> vistas Â· <kbd data-v-644cee40>n</kbd> nueva Â· <kbd data-v-644cee40>f</kbd> buscar </div></div>')),t("</div>")}}}),P=V.setup;V.setup=(a,e)=>{const t=n();return(t.modules||(t.modules=new Set)).add("pages/agenda/index.vue"),P?P(a,e):void 0};const Y=w(V,[["__scopeId","data-v-644cee40"]]);export{Y as default};
//# sourceMappingURL=index-DitcmX_u.mjs.map
