import{m as e}from"./index.mjs";import{s as t,u as o,f as r}from"../nitro/nitro.mjs";async function fetchWithRetry(e,t){for(let o=1;o<=3;o++)try{return await fetch(e,t)}catch(r){if(t?.signal?.aborted)throw r;if(3===o)throw console.error(`Error fetching request ${e}`,r,t),r;console.warn(`Retrying fetch attempt ${o+1} for request: ${e}`),await new Promise(e=>setTimeout(e,100*o))}throw new Error("Unreachable code")}const serverSupabaseClient=async n=>{if(!n.context._supabaseClient){const{url:a,key:i,cookiePrefix:s,cookieOptions:c,clientOptions:{auth:f={},global:l={}}}=o(n).public.supabase;n.context._supabaseClient=e.createServerClient(a,i,{auth:f,cookies:{getAll:()=>e.parseCookieHeader(r(n,"Cookie")??""),setAll:e=>function(e,o){const r=e.node.res,headersWritable=()=>!r.headersSent&&!r.writableEnded;if(headersWritable())for(const{name:r,value:n,options:a}of o){if(!headersWritable())break;t(e,r,n,a)}}(n,e)},cookieOptions:{...c,name:s},global:{fetch:fetchWithRetry,...l}})}return n.context._supabaseClient};export{fetchWithRetry as f,serverSupabaseClient as s};
//# sourceMappingURL=serverSupabaseClient.mjs.map
