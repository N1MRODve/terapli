import{createServerClient as e,parseCookieHeader as t}from"@supabase/ssr";import{s as o,u as r,a as s}from"../nitro/nitro.mjs";async function fetchWithRetry(e,t){for(let o=1;o<=3;o++)try{return await fetch(e,t)}catch(r){if(t?.signal?.aborted)throw r;if(3===o)throw console.error(`Error fetching request ${e}`,r,t),r;console.warn(`Retrying fetch attempt ${o+1} for request: ${e}`),await new Promise(e=>setTimeout(e,100*o))}throw new Error("Unreachable code")}const serverSupabaseClient=async a=>{if(!a.context._supabaseClient){const{url:n,key:i,cookiePrefix:c,cookieOptions:f,clientOptions:{auth:l={},global:h={}}}=r(a).public.supabase;a.context._supabaseClient=e(n,i,{auth:l,cookies:{getAll:()=>t(s(a,"Cookie")??""),setAll:e=>function(e,t){const r=e.node.res,headersWritable=()=>!r.headersSent&&!r.writableEnded;if(headersWritable())for(const{name:r,value:s,options:a}of t){if(!headersWritable())break;o(e,r,s,a)}}(a,e)},cookieOptions:{...f,name:c},global:{fetch:fetchWithRetry,...h}})}return a.context._supabaseClient};export{fetchWithRetry as f,serverSupabaseClient as s};
//# sourceMappingURL=serverSupabaseClient.mjs.map
