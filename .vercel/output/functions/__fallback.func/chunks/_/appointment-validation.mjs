const i={pending:["confirmed","canceled"],confirmed:["completed","canceled"],completed:[],canceled:[]},r={pendiente:"pending",confirmada:"confirmed",realizada:"completed",completada:"completed",cancelada:"canceled"},e={pending:"pendiente",confirmed:"confirmada",completed:"realizada",canceled:"cancelada"};function validateStateTransition(a,o){const n=r[o]||o,t=i[r[a]||a];if(!t)return{valid:!1,error:`Estado inicial inválido: ${a}`,errorCode:"INVALID_INITIAL_STATE"};if(!t.includes(n)){return{valid:!1,error:`No se puede cambiar de "${a}" a "${o}". Transiciones permitidas: ${t.map(i=>e[i]).join(", ")}`,errorCode:"INVALID_STATE_TRANSITION",details:{from:a,to:o,allowedTransitions:t}}}return{valid:!0}}function validateAppointmentRules(i){if(!i.fecha_cita)return{valid:!1,error:"La fecha de la cita es obligatoria",errorCode:"MISSING_DATE"};if(!i.hora_inicio)return{valid:!1,error:"La hora de inicio es obligatoria",errorCode:"MISSING_START_TIME"};if(!i.hora_fin)return{valid:!1,error:"La hora de fin es obligatoria",errorCode:"MISSING_END_TIME"};if(!i.terapeuta_id)return{valid:!1,error:"El terapeuta es obligatorio",errorCode:"MISSING_THERAPIST"};const r=function(i,r){const[e,a]=i.split(":").map(Number),[o,n]=r.split(":").map(Number);return 60*o+n-(60*e+a)}(i.hora_inicio.substring(0,5),i.hora_fin.substring(0,5));if(r<=0)return{valid:!1,error:"La hora de fin debe ser posterior a la hora de inicio",errorCode:"INVALID_TIME_RANGE"};if(r<15)return{valid:!1,error:"La duración mínima de una cita es 15 minutos",errorCode:"DURATION_TOO_SHORT",details:{duration:r}};if(r>240)return{valid:!1,error:"La duración máxima de una cita es 4 horas",errorCode:"DURATION_TOO_LONG",details:{duration:r}};if(!/^\d{4}-\d{2}-\d{2}$/.test(i.fecha_cita))return{valid:!1,error:"Formato de fecha inválido. Use YYYY-MM-DD",errorCode:"INVALID_DATE_FORMAT"};const e=/^\d{2}:\d{2}(:\d{2})?$/;return e.test(i.hora_inicio)&&e.test(i.hora_fin)?{valid:!0}:{valid:!1,error:"Formato de hora inválido. Use HH:MM",errorCode:"INVALID_TIME_FORMAT"}}function validateAppointment(i,r=[]){const e=validateAppointmentRules(i);if(!e.valid)return e;const a=function(i,r){const e=r.filter(r=>{return a=r,(e=i).fecha_cita===a.fecha_cita&&e.terapeuta_id===a.terapeuta_id&&"cancelada"!==e.estado&&"cancelada"!==a.estado&&(!e.id||!a.id||e.id!==a.id)&&(o=e.hora_inicio.substring(0,5),n=e.hora_fin.substring(0,5),t=a.hora_inicio.substring(0,5),o<a.hora_fin.substring(0,5)&&t<n);var e,a,o,n,t});if(e.length>0){const r=e[0];return{valid:!1,error:`Conflicto de horario detectado. Ya existe una cita a las ${r.hora_inicio.substring(0,5)}`,errorCode:"TIME_CONFLICT",details:{conflictingAppointment:r,date:i.fecha_cita,time:i.hora_inicio}}}return{valid:!0}}(i,r);return a.valid?{valid:!0}:a}function formatValidationError(i){if(i.valid)return"";let r=i.error||"Error de validación desconocido";if(i.details){const e=i.details;if(e.conflictingAppointment){const i=e.conflictingAppointment;r+=`\n\nCita existente:\n- Hora: ${i.hora_inicio} - ${i.hora_fin}`}e.duration&&(r+=`\n\nDuración: ${e.duration} minutos`)}return r}export{validateAppointment as a,formatValidationError as f,validateStateTransition as v};
//# sourceMappingURL=appointment-validation.mjs.map
