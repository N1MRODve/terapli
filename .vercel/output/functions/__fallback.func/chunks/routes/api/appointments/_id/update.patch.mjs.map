{"version":3,"file":"update.patch.mjs","sources":["../../../../../../../../../server/api/appointments/[id]/update.patch.ts"],"sourcesContent":null,"names":["update_patch","defineEventHandler","async","event","startTime","Date","now","citaId","getRouterParam","createError","statusCode","statusMessage","config","useRuntimeConfig","supabaseUrl","public","supabaseKey","supabaseClient","createServerClient","cookies","get","name","getCookie","set","value","options","setCookie","remove","deleteCookie","data","user","error","userError","auth","getUser","profile","profileError","from","select","eq","id","single","isTerapeuta","rol","isAdmin","isCoordinadora","existingCita","fetchError","terapeuta_id","body","readBody","fecha_cita","hora_inicio","hora_fin","estado","modalidad","ubicacion","enlace_videollamada","observaciones","notas_terapeuta","stateValidation","validateStateTransition","valid","errorCode","details","newFecha","newHoraInicio","newHoraFin","otherAppointments","queryError","neq","console","appointmentToValidate","validation","validateAppointment","warn","formatValidationError","updates","updated_at","toISOString","length","estadoAnterior","estadoNuevo","bono_id","sesion_descontada","bonoActual","bonoError","sesiones_restantes","nuevasSesionesRestantes","nuevoEstadoBono","updateBonoError","update","info","updatedCita","updateError","message","includes","duration","changes","Object","keys","filter","k","success"],"mappings":"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"}