{"version":3,"file":"create.post.mjs","sources":["../../../../../../../../server/api/appointments/create.post.ts"],"sourcesContent":null,"names":["create_post","defineEventHandler","async","event","startTime","Date","now","config","useRuntimeConfig","supabaseUrl","public","supabaseKey","createError","statusCode","statusMessage","supabaseClient","createServerClient","cookies","get","name","getCookie","set","value","options","setCookie","remove","deleteCookie","data","user","error","userError","auth","getUser","profile","profileError","from","select","eq","id","single","isTerapeuta","rol","isAdmin","isCoordinadora","body","readBody","paciente_id","fecha_cita","hora_inicio","hora_fin","modalidad","estado","ubicacion","enlace_videollamada","observaciones","bono_id","descontar_de_bono","terapeuta_id","existingAppointments","queryError","neq","console","validation","validateAppointment","valid","warn","formatValidationError","errorCode","details","bonoIdFinal","descontarDeBono","bonoActivo","bonoActivoError","in","gt","order","ascending","limit","maybeSingle","info","tipo","bonoData","bonoError","tipoBono","_a","toLowerCase","limiteMensual","includes","fechaCitaDate","inicioMes","getFullYear","getMonth","finMes","inicioMesStr","toISOString","split","finMesStr","citasMes","citasMesError","gte","lte","citasEnMes","length","frecuencia","citaData","sesion_descontada","recordatorio_enviado","newAppointment","insertError","insert","message","code","duration","citaId","fecha","hora","terapeuta","success"],"mappings":"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"}