{"version":3,"file":"search.get.mjs","sources":["../../../../../../../../server/api/patients/search.get.ts"],"sourcesContent":null,"names":["search_get","defineEventHandler","async","event","config","useRuntimeConfig","supabaseUrl","public","supabaseKey","createError","statusCode","statusMessage","supabaseClient","createServerClient","cookies","get","name","getCookie","set","value","options","setCookie","remove","deleteCookie","data","user","error","userError","auth","getUser","profile","profileError","from","select","eq","id","single","terapeutaId","rol","getQuery","terapeuta_id","searchTerm","q","trim","toLowerCase","queryBuilder","length","or","pacientes","fetchError","order","ascending","limit","console","ahora","Date","pacientesConBonos","map","p","bonosActivos","bonos","filter","b","estadoValido","estado","tieneSesiones","sesiones_restantes","sesionesRestantesTotal","reduce","sum","proximoVencimiento","fecha_fin","getTime","sort","bonoActivo","a","citas","citasPasadas","c","fecha_cita","citasFuturas","ultimaCita","_a","proximaCita","_b","totalCitas","prioridadScore","diasDesdeUltima","Math","floor","nombre_completo","email","telefono","fecha_nacimiento","bonos_activos","sesiones_restantes_total","proximo_vencimiento","toISOString","ultima_cita","proxima_cita","total_citas","prioridad_score","bono_activo","tipo","sesiones_totales","sesiones_usadas","fecha_inicio","pacientesOrdenados","slice","success","count","total","message"],"mappings":"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"}