import{e as y,g as A,B as j,q as F,r as p,s as C,c as l,b as d,w as E,_ as k,Q as S,o as i,a as t,m as f,p as x,F as B,i as I,k as r,t as c,K as M,v as U}from"#entry";const N={class:"bg-white rounded-xl shadow-md border border-[#E8DFD8] p-6 mb-6"},V=["value"],q={key:0,class:"bg-white rounded-xl shadow-md border border-[#E8DFD8] p-6"},z={class:"mb-4 flex items-center space-x-3"},L={class:"w-12 h-12 rounded-full bg-gradient-to-br from-[#D8AFA0] to-[#C49484] flex items-center justify-center"},R={class:"text-white font-semibold"},W={class:"font-semibold text-[#5D4A44]"},$={class:"text-sm text-[#8B7470]"},K={class:"flex space-x-3"},P=["disabled"],Q=["disabled"],T={key:1,class:"bg-white rounded-xl shadow-md border border-[#E8DFD8] p-12 text-center"},J=y({__name:"mensajes",setup(G){const m=A();j();const{getUserId:v}=F(),b=p([]),o=p(null),n=p(""),h=s=>s.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2),_=async()=>{if(!(!n.value.trim()||!o.value))try{const s=v();if(!s){alert("❌ No estás autenticado");return}const{error:e}=await m.from("mensajes").insert({remitente_id:s,destinatario_id:o.value.id,mensaje:n.value,visto:!1});if(e)throw e;alert("✅ Mensaje enviado exitosamente"),n.value=""}catch(s){console.error("Error:",s),alert("❌ Error al enviar mensaje")}},g=()=>{if(!n.value.trim()||!o.value.telefono)return;const s=o.value.telefono.replace(/\D/g,""),e=encodeURIComponent(n.value);window.open(`https://wa.me/${s}?text=${e}`,"_blank")},w=async()=>{try{const{data:s,error:e}=await m.from("pacientes").select("id, nombre, telefono, email").order("nombre");if(e)throw e;s&&(b.value=s)}catch(s){console.error("Error al cargar pacientes:",s)}};return C(()=>{w()}),(s,e)=>{const u=S("Icon"),D=k;return i(),l("div",null,[d(D,{name:"coordinacion"},{default:E(()=>[e[7]||(e[7]=t("div",{class:"mb-8"},[t("h1",{class:"text-3xl font-lora font-bold text-[#5D4A44] mb-2"}," Mensajería "),t("p",{class:"text-[#8B7470]"}," Comunicación con pacientes y terapeutas ")],-1)),t("div",N,[e[3]||(e[3]=t("label",{class:"block text-sm font-medium text-[#5D4A44] mb-3"}," Seleccionar paciente ",-1)),f(t("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>x(o)?o.value=a:null),class:"w-full px-4 py-3 border border-[#E8DFD8] rounded-lg focus:ring-2 focus:ring-[#D8AFA0] focus:border-transparent"},[e[2]||(e[2]=t("option",{value:""},"-- Selecciona un paciente --",-1)),(i(!0),l(B,null,I(r(b),a=>(i(),l("option",{key:a.id,value:a},c(a.nombre),9,V))),128))],512),[[M,r(o)]])]),r(o)?(i(),l("div",q,[t("div",z,[t("div",L,[t("span",R,c(h(r(o).nombre)),1)]),t("div",null,[t("p",W,c(r(o).nombre),1),t("p",$,c(r(o).telefono),1)])]),f(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=a=>x(n)?n.value=a:null),placeholder:"Escribe tu mensaje aquí...",rows:"5",class:"w-full px-4 py-3 border border-[#E8DFD8] rounded-lg focus:ring-2 focus:ring-[#D8AFA0] focus:border-transparent resize-none mb-4"},null,512),[[U,r(n)]]),t("div",K,[t("button",{onClick:_,disabled:!r(n).trim(),class:"flex-1 px-6 py-3 bg-[#D8AFA0] text-white rounded-lg hover:bg-[#C49484] transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[d(u,{name:"heroicons:paper-airplane",class:"w-5 h-5"}),e[4]||(e[4]=t("span",null,"Enviar mensaje interno",-1))],8,P),t("button",{onClick:g,disabled:!r(n).trim(),class:"flex-1 px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[d(u,{name:"heroicons:chat-bubble-oval-left-ellipsis",class:"w-5 h-5"}),e[5]||(e[5]=t("span",null,"Abrir WhatsApp",-1))],8,Q)])])):(i(),l("div",T,[d(u,{name:"heroicons:chat-bubble-left-right",class:"w-20 h-20 mx-auto text-[#D8AFA0] opacity-30 mb-4"}),e[6]||(e[6]=t("p",{class:"text-[#8B7470]"},"Selecciona un paciente para comenzar",-1))]))]),_:1})])}}});export{J as default};
