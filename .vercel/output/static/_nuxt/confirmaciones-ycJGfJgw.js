import{_ as ge}from"./nuxt-link-CqfhJJkZ.js";import{c as u,o as c,a as e,e as _e,r as x,z as G,J as Q,j as _,t as l,n as h,m as K,af as te,v as we,l as se,T as de,g as ye,B as ke,s as Ce,b as v,k as i,w as q,F as oe,i as ae,h as $e,d as ne,A as je}from"#entry";import{u as Me}from"./useCitas-CnBtv5jB.js";import{_ as De}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as J}from"./ClockIcon-CQZt9cKZ.js";import{r as re}from"./CalendarIcon-mZ3toP8Y.js";import{r as ie}from"./ChatBubbleLeftRightIcon-BSBtNZZQ.js";import{r as le}from"./CheckCircleIcon-Bi0YyG7H.js";function Se(b,g){return c(),u("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m3.75 13.5 10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75Z"})])}function Pe(b,g){return c(),u("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456ZM16.894 20.567 16.5 21.75l-.394-1.183a2.25 2.25 0 0 0-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 0 0 1.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 0 0 1.423 1.423l1.183.394-1.183.394a2.25 2.25 0 0 0-1.423 1.423Z"})])}const Ee={class:"p-6 space-y-5"},Le={class:"bg-gray-50 border border-gray-200 rounded-xl p-4 space-y-2"},Te={class:"flex items-start gap-2"},Be={class:"flex-1"},He={class:"text-sm font-semibold text-cafe"},Re={class:"flex items-start gap-2"},Ue={class:"flex-1"},Ve={class:"text-sm font-semibold text-cafe capitalize"},ze={class:"text-xs text-cafe/70"},Ie={key:0,class:"flex items-start gap-2"},Ne={class:"flex-1"},Ae={class:"text-sm font-semibold text-cafe"},Oe={class:"flex-1"},qe={key:0,class:"space-y-3"},We={class:"space-y-2"},Fe={class:"px-6 py-4 bg-gray-50 border-t border-gray-200 flex gap-3"},Ze=["disabled"],Ge=["disabled"],Ke={key:0,class:"inline-block animate-spin"},Je={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Qe=_e({__name:"ModalCancelarCita",props:{cita:{},isOpen:{type:Boolean}},emits:["close","cancelada"],setup(b,{emit:g}){const w=b,y=g,{cancelarCitaConReintegro:R,cancelarCita:U}=Me(),E=x(""),k=x(!0),P=x(!1),j=G(()=>{if(!w.cita)return 0;const p=new Date(`${w.cita.fecha_cita}T${w.cita.hora_inicio}`),a=new Date,S=p.getTime()-a.getTime();return Math.floor(S/(1e3*60*60))}),M=G(()=>j.value>=24),D=G(()=>w.cita?.bono_id?j.value<24?`La cita est√° a menos de 24 horas (${j.value}h). No se puede reintegrar la sesi√≥n al bono seg√∫n la pol√≠tica de cancelaci√≥n.`:j.value<0?"Esta cita ya ha pasado. La sesi√≥n no se puede reintegrar.":`La cita est√° a ${j.value} horas. Puedes elegir si devolver la sesi√≥n al bono del paciente.`:"Esta cita no tiene bono asociado. Se cancelar√° sin afectar ning√∫n bono."),L=()=>{E.value="",k.value=!0,y("close")},V=async()=>{if(w.cita){P.value=!0;try{let p;if(w.cita.bono_id){const a=M.value&&k.value;p=await R(w.cita.id,w.cita.bono_id,a)}else p=await U(w.cita.id,E.value);p.success?(y("cancelada",p.data),L()):alert(`Error al cancelar cita: ${p.error}`)}catch(p){console.error("Error al cancelar cita:",p),alert(`Error: ${p.message}`)}finally{P.value=!1}}},N=p=>new Date(p).toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"});return(p,a)=>(c(),Q(de,{to:"body"},[b.isOpen&&b.cita?(c(),u("div",{key:0,class:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-[60]",onClick:se(L,["self"])},[e("div",{class:"bg-white rounded-2xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto",onClick:a[3]||(a[3]=se(()=>{},["stop"]))},[e("div",{class:"bg-gradient-to-r from-red-50 to-orange-50 border-b border-red-100 px-6 py-5"},[e("div",{class:"flex items-center justify-between"},[a[5]||(a[5]=e("div",{class:"flex items-center gap-3"},[e("div",{class:"w-12 h-12 rounded-xl bg-red-500 flex items-center justify-center"},[e("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})])]),e("div",null,[e("h3",{class:"text-xl font-bold text-cafe"},"Cancelar Cita"),e("p",{class:"text-sm text-cafe/60"},"Gesti√≥n de sesi√≥n del bono")])],-1)),e("button",{onClick:L,class:"p-2 hover:bg-red-100 rounded-lg transition-colors",title:"Cerrar"},[...a[4]||(a[4]=[e("svg",{class:"w-5 h-5 text-cafe",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),e("div",Ee,[e("div",Le,[e("div",Te,[a[7]||(a[7]=e("svg",{class:"w-5 h-5 text-cafe/60 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1)),e("div",Be,[a[6]||(a[6]=e("p",{class:"text-xs text-cafe/60 font-medium"},"Paciente",-1)),e("p",He,l(b.cita.paciente_nombre||"Sin nombre"),1)])]),e("div",Re,[a[9]||(a[9]=e("svg",{class:"w-5 h-5 text-cafe/60 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),e("div",Ue,[a[8]||(a[8]=e("p",{class:"text-xs text-cafe/60 font-medium"},"Fecha y Hora",-1)),e("p",Ve,l(N(b.cita.fecha_cita)),1),e("p",ze,l(b.cita.hora_inicio)+" - "+l(b.cita.hora_fin),1)])]),b.cita.terapeuta_nombre?(c(),u("div",Ie,[a[11]||(a[11]=e("svg",{class:"w-5 h-5 text-cafe/60 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})],-1)),e("div",Ne,[a[10]||(a[10]=e("p",{class:"text-xs text-cafe/60 font-medium"},"Terapeuta",-1)),e("p",Ae,l(b.cita.terapeuta_nombre),1)])])):_("",!0)]),e("div",{class:h(["flex items-start gap-3 p-4 rounded-xl border-l-4",M.value?"bg-blue-50 border-blue-500":"bg-orange-50 border-orange-500"])},[(c(),u("svg",{class:h(["w-5 h-5 flex-shrink-0 mt-0.5",M.value?"text-blue-600":"text-orange-600"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...a[12]||(a[12]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])],2)),e("div",Oe,[e("p",{class:h(["text-sm font-semibold mb-1",M.value?"text-blue-800":"text-orange-800"])},l(M.value?"‚úì Cancelaci√≥n con anticipaci√≥n":"‚ö†Ô∏è Cancelaci√≥n sin anticipaci√≥n suficiente"),3),e("p",{class:h(["text-xs",M.value?"text-blue-700":"text-orange-700"])},l(D.value),3)])],2),b.cita.bono_id&&M.value?(c(),u("div",qe,[a[15]||(a[15]=e("label",{class:"block text-sm font-semibold text-cafe mb-2"}," ¬øDevolver sesi√≥n al bono? ",-1)),e("div",We,[e("label",{class:h(["flex items-start gap-3 p-4 rounded-xl border-2 cursor-pointer transition-all",k.value?"border-verde bg-verde/5":"border-gray-200 hover:border-verde/50"])},[K(e("input",{type:"radio",value:!0,"onUpdate:modelValue":a[0]||(a[0]=S=>k.value=S),class:"mt-1 text-verde focus:ring-verde"},null,512),[[te,k.value]]),a[13]||(a[13]=e("div",{class:"flex-1"},[e("p",{class:"font-semibold text-cafe text-sm"},"S√≠, devolver sesi√≥n"),e("p",{class:"text-xs text-cafe/70 mt-1"}," La sesi√≥n se reintegrar√° al bono del paciente. Podr√° usarla en otra ocasi√≥n. ")],-1))],2),e("label",{class:h(["flex items-start gap-3 p-4 rounded-xl border-2 cursor-pointer transition-all",k.value?"border-gray-200 hover:border-red-300":"border-red-500 bg-red-50"])},[K(e("input",{type:"radio",value:!1,"onUpdate:modelValue":a[1]||(a[1]=S=>k.value=S),class:"mt-1 text-red-500 focus:ring-red-500"},null,512),[[te,k.value]]),a[14]||(a[14]=e("div",{class:"flex-1"},[e("p",{class:"font-semibold text-cafe text-sm"},"No, descontar sesi√≥n"),e("p",{class:"text-xs text-cafe/70 mt-1"}," La sesi√≥n se descontar√° del bono como si se hubiera realizado. ")],-1))],2)])])):_("",!0),e("div",null,[a[16]||(a[16]=e("label",{class:"block text-sm font-semibold text-cafe mb-2"}," Motivo de cancelaci√≥n (opcional) ",-1)),K(e("textarea",{"onUpdate:modelValue":a[2]||(a[2]=S=>E.value=S),rows:"3",placeholder:"Describe el motivo de la cancelaci√≥n...",class:"w-full px-4 py-2.5 border border-gray-300 rounded-xl focus:ring-2 focus:ring-cafe/20 focus:border-cafe transition-colors resize-none text-sm"},null,512),[[we,E.value]])]),a[17]||(a[17]=e("div",{class:"bg-red-50 border border-red-200 rounded-xl p-4 flex items-start gap-3"},[e("svg",{class:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})]),e("div",{class:"flex-1"},[e("p",{class:"text-sm font-semibold text-red-800 mb-1"}," Esta acci√≥n no se puede deshacer "),e("p",{class:"text-xs text-red-700"}," La cita ser√° marcada como cancelada y ya no aparecer√° en la agenda activa. ")])],-1))]),e("div",Fe,[e("button",{onClick:L,disabled:P.value,class:"flex-1 px-4 py-2.5 bg-white border border-gray-300 text-cafe rounded-xl hover:bg-gray-50 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed"}," Volver ",8,Ze),e("button",{onClick:V,disabled:P.value,class:"flex-1 px-4 py-2.5 bg-red-500 text-white rounded-xl hover:bg-red-600 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[P.value?(c(),u("span",Ke,"‚è≥")):(c(),u("svg",Je,[...a[18]||(a[18]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"},null,-1)])])),e("span",null,l(P.value?"Cancelando...":"Cancelar Cita"),1)],8,Ge)])])])):_("",!0)]))}}),Xe=Object.assign(Qe,{__name:"ModalCancelarCita"}),Ye={class:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden mb-8"},et={class:"px-8 py-6 border-b border-gray-100"},tt={class:"flex items-center justify-between"},st={class:"flex items-center gap-3"},ot={class:"w-12 h-12 bg-arena rounded-xl flex items-center justify-center"},at={class:"px-8 py-6"},nt={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},rt={class:"bg-arena/30 rounded-xl p-4 hover:shadow-sm transition-shadow"},it={class:"flex items-center gap-3"},lt={class:"w-10 h-10 bg-purple-600/10 rounded-lg flex items-center justify-center flex-shrink-0"},dt={class:"flex-1 min-w-0"},ct={class:"text-2xl font-semibold text-cafe"},ut={class:"bg-orange-50/50 rounded-xl p-4 hover:shadow-sm transition-shadow"},pt={class:"flex items-center gap-3"},ft={class:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center flex-shrink-0"},mt={class:"flex-1 min-w-0"},xt={class:"text-2xl font-semibold text-cafe"},ht={class:"bg-verde/10 rounded-xl p-4 hover:shadow-sm transition-shadow"},vt={class:"flex items-center gap-3"},bt={class:"w-10 h-10 bg-verde/20 rounded-lg flex items-center justify-center flex-shrink-0"},gt={class:"flex-1 min-w-0"},_t={class:"text-lg font-semibold text-cafe truncate"},wt={class:"bg-green-50/50 rounded-xl p-4 hover:shadow-sm transition-shadow"},yt={class:"flex items-center gap-3"},kt={class:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0"},Ct={class:"flex-1 min-w-0"},$t={class:"text-2xl font-semibold text-cafe"},jt={key:0,class:"text-center py-12"},Mt={key:1,class:"space-y-3"},Dt={class:"flex items-stretch"},St={class:"flex-1 p-5"},Pt={class:"flex items-center gap-4"},Et={class:"flex-shrink-0"},Lt={class:"flex-1 grid grid-cols-1 md:grid-cols-5 gap-4 items-center"},Tt={class:"md:col-span-2"},Bt={class:"flex items-center gap-2 mb-1"},Ht={class:"font-semibold text-cafe"},Rt={key:0,class:"px-2 py-0.5 bg-purple-600/10 text-purple-600 text-xs font-medium rounded-full"},Ut={key:1,class:"inline-flex items-center gap-1 px-2 py-0.5 bg-green-100 text-green-700 text-xs font-medium rounded-full animate-pulse"},Vt={class:"text-sm text-cafe/60"},zt={class:"text-sm font-medium text-cafe mb-0.5"},It={class:"text-sm text-cafe/60"},Nt={class:"capitalize"},At={class:"text-right"},Ot={class:"flex-shrink-0 flex items-center gap-2"},qt={class:"relative"},Wt=["onClick","title"],Ft={key:1,class:"absolute -top-1 -right-1 flex h-3 w-3"},Zt=["onClick"],Gt=["onClick"],Kt={key:2,class:"text-center py-16"},Jt={class:"inline-flex flex-col items-center gap-4"},Qt={class:"w-20 h-20 bg-verde/10 rounded-2xl flex items-center justify-center"},Xt={class:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden mb-8"},Yt={class:"px-8 py-6 border-b border-gray-100"},es={class:"flex items-center justify-between"},ts={class:"flex items-center gap-3"},ss={class:"w-12 h-12 bg-verde/10 rounded-xl flex items-center justify-center"},os={class:"px-8 py-6"},as={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},ns={class:"bg-verde/10 rounded-xl p-4 hover:shadow-sm transition-shadow"},rs={class:"flex items-center gap-3"},is={class:"w-10 h-10 bg-verde/20 rounded-lg flex items-center justify-center flex-shrink-0"},ls={class:"flex-1 min-w-0"},ds={class:"text-2xl font-semibold text-cafe"},cs={class:"bg-blue-50/50 rounded-xl p-4 hover:shadow-sm transition-shadow"},us={class:"flex items-center gap-3"},ps={class:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0"},fs={class:"flex-1 min-w-0"},ms={class:"text-2xl font-semibold text-cafe"},xs={class:"bg-purple-50/50 rounded-xl p-4 hover:shadow-sm transition-shadow"},hs={class:"flex items-center gap-3"},vs={class:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center flex-shrink-0"},bs={class:"flex-1 min-w-0"},gs={class:"text-2xl font-semibold text-cafe"},_s={class:"bg-amber-50/50 rounded-xl p-4 hover:shadow-sm transition-shadow"},ws={class:"flex items-center gap-3"},ys={class:"w-10 h-10 bg-amber-100 rounded-lg flex items-center justify-center flex-shrink-0"},ks={class:"flex-1 min-w-0"},Cs={class:"text-2xl font-semibold text-cafe"},$s={key:0},js={class:"space-y-3"},Ms={class:"flex items-stretch"},Ds={class:"flex-1 p-5"},Ss={class:"flex items-center gap-4"},Ps={class:"flex-shrink-0 relative"},Es={class:"w-12 h-12 rounded-full bg-verde flex items-center justify-center text-white font-semibold shadow-sm"},Ls={class:"flex-1 grid grid-cols-1 lg:grid-cols-6 gap-3 items-center"},Ts={class:"lg:col-span-2"},Bs={class:"flex items-center gap-2 mb-1"},Hs={class:"font-semibold text-cafe"},Rs={key:0,class:"inline-flex items-center gap-1 px-2 py-0.5 bg-blue-100 text-blue-700 text-xs font-medium rounded-full animate-pulse"},Us={class:"text-sm text-cafe/60"},Vs={class:"text-sm font-medium text-cafe mb-0.5"},zs={class:"text-sm text-cafe/60"},Is={class:"capitalize"},Ns={key:0,class:"flex flex-col gap-1"},As={class:"flex items-center gap-1.5"},Os={class:"flex items-center gap-1"},qs={class:"flex-1 h-1.5 bg-gray-200 rounded-full overflow-hidden"},Ws={key:1,class:"text-xs text-cafe/40 italic"},Fs={class:"flex-shrink-0 flex items-center gap-2"},Zs={key:0,class:"relative"},Gs=["onClick","title"],Ks={key:0,class:"absolute -top-1 -right-1 flex h-3 w-3"},Js=["onClick"],Qs={key:1,class:"text-center py-16"},Xs={class:"inline-flex flex-col items-center gap-4"},Ys={key:0,class:"fixed top-4 right-4 z-[70] animate-[slideIn_0.3s_ease-out]"},eo={class:"flex items-start gap-3"},to={class:"text-2xl"},so={class:"flex-1"},oo={class:"text-sm text-cafe/70"},ao={__name:"confirmaciones",setup(b){const g=ye();ke();const w=x(!0),y=x([]),R=x(0),U=x("--"),E=x(0),k=x(!1),P=x(null),j=x(null),M=x("");x(!1);const D=x([]),L=x(0),V=x(0);x(0),x(0);const N=x(0),p=x({visible:!1,tipo:"success",titulo:"",mensaje:""}),a=(o,t,n="success")=>{p.value={visible:!0,tipo:n,titulo:o,mensaje:t},setTimeout(()=>{p.value.visible=!1},5e3)},S=o=>o?o.split(" ").map(t=>t[0]).join("").toUpperCase().substring(0,2):"PA",W=o=>{if(!o)return"Sin fecha";const t=new Date(o),n=new Date,f=new Date(n);return f.setDate(f.getDate()+1),n.setHours(0,0,0,0),f.setHours(0,0,0,0),t.setHours(0,0,0,0),t.getTime()===n.getTime()?"Hoy":t.getTime()===f.getTime()?"Ma√±ana":t.toLocaleDateString("es-ES",{weekday:"short",day:"numeric",month:"short"})},X=(o,t)=>{if(!o||!t)return"--";const n=new Date,s=new Date(`${o}T${t}`)-n;if(s<0)return"Pasada";const m=Math.floor(s/(1e3*60*60)),C=Math.floor(s%(1e3*60*60)/(1e3*60));if(m<1)return`${C}min`;if(m<24)return`${m}h ${C}min`;{const $=Math.floor(m/24);return`${$} d√≠a${$>1?"s":""}`}},ce=(o,t)=>{if(!o||!t)return!1;const n=new Date,s=new Date(`${o}T${t}`)-n;return s>0&&s<=864e5},ue=(o,t)=>{if(!o||!t)return!1;const n=new Date,s=new Date(`${o}T${t}`)-n;return s>0&&s<=144e5},A=async()=>{try{const o=new Date;o.setHours(0,0,0,0);const t=o.toISOString().split("T")[0],{data:n,error:f}=await g.from("citas").select(`
        id,
        fecha_cita,
        hora_inicio,
        modalidad,
        estado,
        paciente_id,
        terapeuta_id
      `).eq("estado","pendiente").gte("fecha_cita",t).order("fecha_cita",{ascending:!0}).order("hora_inicio",{ascending:!0}).limit(50);if(f)throw f;if(!n||n.length===0){y.value=[],R.value=0,U.value="--",E.value=0;return}const s=[...new Set(n.map(d=>d.paciente_id))],m=[...new Set(n.map(d=>d.terapeuta_id).filter(Boolean))],{data:C}=await g.from("pacientes").select("id, nombre_completo, telefono, email").in("id",s);let $=[];if(m.length>0){const{data:d}=await g.from("terapeutas").select("id, nombre_completo").in("id",m);$=d||[]}const T=new Map(C?.map(d=>[d.id,d])||[]),H=new Map($.map(d=>[d.id,d]));if(y.value=n.map(d=>{const z=T.get(d.paciente_id),F=d.terapeuta_id?H.get(d.terapeuta_id):null,B=new Date(o);B.setDate(B.getDate()+2);const Z=B.toISOString().split("T")[0];return{id:d.id,fecha:d.fecha_cita,hora_inicio:d.hora_inicio,modalidad:d.modalidad,estado:d.estado,esUrgente:d.fecha_cita<Z,listaParaConfirmar:ce(d.fecha_cita,d.hora_inicio),paciente:{nombre:z?.nombre_completo||"Sin nombre",telefono:z?.telefono,email:z?.email},terapeuta:{nombre:F?.nombre_completo||"Sin terapeuta"}}}),R.value=y.value.filter(d=>d.esUrgente).length,y.value.length>0){const d=y.value[0];U.value=X(d.fecha,d.hora_inicio)}E.value=y.value.filter(d=>d.listaParaConfirmar&&d.paciente?.telefono).length}catch(o){console.error("Error al cargar citas por confirmar:",o)}finally{w.value=!1}},pe=o=>{const t=o.paciente?.telefono;if(!t){a("Sin Tel√©fono","Este paciente no tiene tel√©fono registrado","error");return}const n=t.replace(/\D/g,""),f=o.paciente.nombre.split(" ")[0],s=o.terapeuta.nombre,m=W(o.fecha),C=o.hora_inicio,$=`Hola ${f}, te escribo desde el equipo de Psic√≥loga Karem Pe√±a.
Solo quer√≠a confirmar tu sesi√≥n programada para ${m} a las ${C} con ${s}.
¬øPodr√≠as confirmarme si podr√°s asistir?`,T=encodeURIComponent($),H=`https://wa.me/${n}?text=${T}`;window.open(H,"_blank")},fe=o=>{const t=o.paciente?.telefono;if(!t){a("Sin Tel√©fono","Este paciente no tiene tel√©fono registrado","error");return}const n=t.replace(/\D/g,""),f=o.paciente.nombre.split(" ")[0],s=o.terapeuta.nombre,m=o.hora_inicio,C=`Hola ${f}, te escribo desde el equipo de Psic√≥loga Karem Pe√±a.
Solo quer√≠a recordarte que tienes tu sesi√≥n hoy a las ${m} con ${s}.
¬°Te esperamos!`,$=encodeURIComponent(C),T=`https://wa.me/${n}?text=${$}`;window.open(T,"_blank")},me=async o=>{try{const{data:t,error:n}=await g.rpc("confirmar_cita_y_descontar_bono",{p_cita_id:o.id});if(n)throw n;if(!t.success){a("‚úó Error",t.error||"Error al confirmar la cita","error");return}let f=`Cita con ${t.paciente_nombre} confirmada.`;t.bono_id&&(f+=` Sesiones restantes en bono: ${t.sesiones_restantes}`,t.bono_agotado?f+=" ‚ö†Ô∏è BONO AGOTADO":t.sesiones_restantes<=2&&(f+=" ‚ö†Ô∏è Pocas sesiones")),a("‚úì Cita Confirmada",f,"success"),await Promise.all([A(),O()])}catch(t){console.error("Error al confirmar cita:",t),a("‚úó Error","Error al confirmar la cita","error")}},xe=o=>{P.value=o,j.value={id:o.id,fecha_cita:o.fecha,hora_inicio:o.hora_inicio,hora_fin:o.hora_fin||"00:00",bono_id:o.bono_id||null,paciente_nombre:o.paciente?.nombre||"Paciente",terapeuta_nombre:o.terapeuta?.nombre||"Sin asignar",modalidad:o.modalidad,estado:o.estado},M.value="",k.value=!0},Y=()=>{k.value=!1,P.value=null,j.value=null,M.value=""},he=o=>{Y(),o?.reintegrada;const t=o?.reintegrada?"Se devolvi√≥ 1 sesi√≥n al bono del paciente":"La sesi√≥n se descont√≥ del bono seg√∫n pol√≠tica de cancelaci√≥n";a("Cita Cancelada",t,"success"),A(),O()},O=async()=>{try{const o=new Date;o.setHours(0,0,0,0);const t=o.toISOString().split("T")[0],{data:n,error:f}=await g.from("citas").select(`
        id,
        fecha_cita,
        hora_inicio,
        modalidad,
        estado,
        paciente_id,
        terapeuta_id,
        bono_id
      `).eq("estado","confirmada").gte("fecha_cita",t).order("fecha_cita",{ascending:!0}).order("hora_inicio",{ascending:!0}).limit(50);if(f)throw f;if(!n||n.length===0){D.value=[],V.value=0,L.value=0;return}const s=[...new Set(n.map(r=>r.paciente_id))],m=[...new Set(n.map(r=>r.terapeuta_id).filter(Boolean))],C=[...new Set(n.map(r=>r.bono_id).filter(Boolean))],{data:$}=await g.from("pacientes").select("id, nombre_completo, telefono").in("id",s);let T=[];if(C.length>0){const{data:r}=await g.from("bonos").select("id, sesiones_totales, sesiones_restantes, estado").in("id",C);T=r||[]}let H=[];if(m.length>0){const{data:r}=await g.from("terapeutas").select("id, nombre_completo").in("id",m);H=r||[]}const d=new Map($?.map(r=>[r.id,r])||[]),z=new Map(H.map(r=>[r.id,r])),F=new Map(T.map(r=>[r.id,r]));D.value=n.map(r=>{const ee=d.get(r.paciente_id),be=r.terapeuta_id?z.get(r.terapeuta_id):null,I=r.bono_id?F.get(r.bono_id):null;return{id:r.id,fecha:r.fecha_cita,hora_inicio:r.hora_inicio,modalidad:r.modalidad,estado:r.estado,listaParaRecordatorio:ue(r.fecha_cita,r.hora_inicio),paciente:{nombre:ee?.nombre_completo||"Sin nombre",telefono:ee?.telefono},terapeuta:{nombre:be?.nombre_completo||"Sin terapeuta"},bono:I?{id:I.id,sesiones_totales:I.sesiones_totales,sesiones_restantes:I.sesiones_restantes,estado:I.estado,tiene_bono:!0}:null}}),V.value=D.value.filter(r=>r.fecha===t).length;const B=new Date(o);B.setDate(B.getDate()+7);const Z=B.toISOString().split("T")[0];L.value=D.value.filter(r=>r.fecha<=Z).length,N.value=D.value.filter(r=>r.listaParaRecordatorio&&r.paciente?.telefono).length}catch(o){console.error("Error al cargar citas confirmadas:",o)}},ve=async o=>{let t=`¬øVolver la cita de ${o.paciente.nombre} a estado PENDIENTE?`;if(o.bono&&o.bono.tiene_bono&&(t+=`

‚úÖ Se devolver√° 1 sesi√≥n al bono`),!!confirm(t))try{const{data:n,error:f}=await g.rpc("revertir_confirmacion_y_devolver_sesion",{p_cita_id:o.id});if(f)throw f;if(!n.success){a("‚úó Error",n.error||"Error al revertir la confirmaci√≥n","error");return}a("‚Ü© Cita Revertida",`Cita de ${n.paciente_nombre} marcada como PENDIENTE`,"success"),await Promise.all([A(),O()])}catch(n){console.error("Error al revertir confirmaci√≥n:",n),a("‚úó Error","Error al revertir la confirmaci√≥n","error")}};return Ce(()=>{A(),O()}),(o,t)=>{const n=ge,f=Xe;return c(),u("div",null,[e("div",Ye,[e("div",et,[e("div",tt,[e("div",st,[e("div",ot,[v(i(J),{class:"w-7 h-7 text-purple-600"})]),t[1]||(t[1]=e("div",null,[e("h2",{class:"text-xl font-semibold text-cafe"}," Citas pendientes de confirmaci√≥n "),e("p",{class:"text-sm text-cafe/60 mt-0.5"}," Gestiona las citas que requieren confirmaci√≥n con el paciente ")],-1))]),v(n,{to:"/coordinadora/agenda",class:"text-sm text-purple-600 hover:text-purple-600/80 font-medium transition-colors flex items-center gap-1"},{default:q(()=>[...t[2]||(t[2]=[e("span",null,"Ver agenda completa",-1),e("span",null,"‚Üí",-1)])]),_:1})])]),e("div",at,[e("div",nt,[e("div",rt,[e("div",it,[e("div",lt,[v(i(J),{class:"w-6 h-6 text-purple-600"})]),e("div",dt,[e("p",ct,l(i(y).length),1),t[3]||(t[3]=e("p",{class:"text-xs text-cafe/60 font-medium"},"Pendientes",-1))])])]),e("div",ut,[e("div",pt,[e("div",ft,[v(i(Se),{class:"w-6 h-6 text-orange-600"})]),e("div",mt,[e("p",xt,l(i(R)),1),t[4]||(t[4]=e("p",{class:"text-xs text-cafe/60 font-medium"},"Urgentes",-1))])])]),e("div",ht,[e("div",vt,[e("div",bt,[v(i(re),{class:"w-6 h-6 text-verde"})]),e("div",gt,[e("p",_t,l(i(U)),1),t[5]||(t[5]=e("p",{class:"text-xs text-cafe/60 font-medium"},"Pr√≥xima cita",-1))])])]),e("div",wt,[e("div",yt,[e("div",kt,[v(i(ie),{class:"w-6 h-6 text-green-600"})]),e("div",Ct,[e("p",$t,l(i(E)),1),t[6]||(t[6]=e("p",{class:"text-xs text-cafe/60 font-medium"},"Listas para confirmar",-1))])])])]),i(w)?(c(),u("div",jt,[...t[7]||(t[7]=[e("div",{class:"inline-flex flex-col items-center gap-3"},[e("div",{class:"w-12 h-12 border-3 border-purple-600/20 border-t-purple-600 rounded-full animate-spin"}),e("p",{class:"text-cafe/60 font-medium text-sm"},"Cargando citas...")],-1)])])):i(y).length>0?(c(),u("div",Mt,[(c(!0),u(oe,null,ae(i(y),s=>(c(),u("div",{key:s.id,class:"group bg-white rounded-xl border border-gray-100 hover:shadow-md transition-all duration-200 overflow-hidden"},[e("div",Dt,[e("div",{class:h(["w-1 flex-shrink-0",{"bg-purple-600":s.esUrgente,"bg-verde":!s.esUrgente}])},null,2),e("div",St,[e("div",Pt,[e("div",Et,[e("div",{class:h(["w-12 h-12 rounded-full flex items-center justify-center text-white font-semibold shadow-sm",{"bg-purple-600":s.esUrgente,"bg-cafe/80":!s.esUrgente}])},l(S(s.paciente.nombre)),3)]),e("div",Lt,[e("div",Tt,[e("div",Bt,[e("h4",Ht,l(s.paciente.nombre),1),s.esUrgente?(c(),u("span",Rt," Urgente ")):_("",!0),s.listaParaConfirmar?(c(),u("span",Ut,[...t[8]||(t[8]=[e("span",null,"üîî",-1),e("span",null,"Lista para confirmar",-1)])])):_("",!0)]),e("p",Vt,l(s.terapeuta.nombre),1)]),e("div",null,[e("p",zt,l(W(s.fecha)),1),e("p",It,l(s.hora_inicio),1)]),e("div",null,[e("span",{class:h(["inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium",{"bg-purple-50 text-purple-700":s.modalidad==="online","bg-verde/10 text-verde":s.modalidad==="presencial"}])},[e("span",null,l(s.modalidad==="online"?"üíª":"üè•"),1),e("span",Nt,l(s.modalidad),1)],2)]),e("div",At,[e("p",{class:h(["text-sm font-semibold",{"text-purple-600":s.esUrgente,"text-cafe/70":!s.esUrgente}])},l(X(s.fecha,s.hora_inicio)),3),t[9]||(t[9]=e("p",{class:"text-xs text-cafe/50"},"restante",-1))])]),e("div",Ot,[e("div",qt,[s.paciente.telefono?(c(),u("button",{key:0,onClick:m=>pe(s),class:h(["p-2.5 rounded-lg transition-colors",s.listaParaConfirmar?"bg-green-500 text-white hover:bg-green-600 animate-pulse":"bg-green-500/10 text-green-600 hover:bg-green-500 hover:text-white"]),title:s.listaParaConfirmar?"¬°Lista para confirmar! Enviar WhatsApp":"Enviar WhatsApp"},[...t[10]||(t[10]=[e("span",{class:"text-lg"},"üí¨",-1)])],10,Wt)):_("",!0),s.listaParaConfirmar?(c(),u("span",Ft,[...t[11]||(t[11]=[e("span",{class:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"},null,-1),e("span",{class:"relative inline-flex rounded-full h-3 w-3 bg-red-500"},null,-1)])])):_("",!0)]),e("button",{onClick:m=>me(s),class:"p-2.5 bg-verde/10 text-verde hover:bg-verde hover:text-white rounded-lg transition-colors",title:"Confirmar cita"},[...t[12]||(t[12]=[e("span",{class:"text-lg"},"‚úì",-1)])],8,Zt),e("button",{onClick:m=>xe(s),class:"p-2.5 bg-red-50 text-red-600 hover:bg-red-500 hover:text-white rounded-lg transition-colors",title:"Cancelar cita"},[...t[13]||(t[13]=[e("span",{class:"text-lg"},"‚úï",-1)])],8,Gt)])])])])]))),128))])):(c(),u("div",Kt,[e("div",Jt,[e("div",Qt,[v(i(Pe),{class:"w-12 h-12 text-verde"})]),t[15]||(t[15]=e("div",{class:"space-y-1"},[e("h3",{class:"text-lg font-semibold text-cafe"}," No hay citas pendientes por confirmar "),e("p",{class:"text-sm text-cafe/60 max-w-sm"}," Todo est√° organizado, puedes revisar la agenda completa ")],-1)),v(n,{to:"/coordinadora/agenda",class:"mt-2 px-5 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-colors font-medium text-sm"},{default:q(()=>[...t[14]||(t[14]=[ne(" Ver agenda ",-1)])]),_:1})])]))])]),e("div",Xt,[e("div",Yt,[e("div",es,[e("div",ts,[e("div",ss,[v(i(le),{class:"w-7 h-7 text-verde"})]),t[16]||(t[16]=e("div",null,[e("h2",{class:"text-xl font-semibold text-cafe"}," Citas confirmadas "),e("p",{class:"text-sm text-cafe/60 mt-0.5"}," Citas ya confirmadas con los pacientes ")],-1))]),v(n,{to:"/coordinadora/agenda?estado=confirmada",class:"text-sm text-verde hover:text-verde/80 font-medium transition-colors flex items-center gap-1"},{default:q(()=>[...t[17]||(t[17]=[e("span",null,"Ver todas",-1),e("span",null,"‚Üí",-1)])]),_:1})])]),e("div",os,[e("div",as,[e("div",ns,[e("div",rs,[e("div",is,[v(i(le),{class:"w-6 h-6 text-verde"})]),e("div",ls,[e("p",ds,l(i(D).length),1),t[18]||(t[18]=e("p",{class:"text-xs text-cafe/60 font-medium"},"Confirmadas",-1))])])]),e("div",cs,[e("div",us,[e("div",ps,[v(i(re),{class:"w-6 h-6 text-blue-600"})]),e("div",fs,[e("p",ms,l(i(L)),1),t[19]||(t[19]=e("p",{class:"text-xs text-cafe/60 font-medium"},"Pr√≥ximos 7 d√≠as",-1))])])]),e("div",xs,[e("div",hs,[e("div",vs,[v(i(J),{class:"w-6 h-6 text-purple-600"})]),e("div",bs,[e("p",gs,l(i(V)),1),t[20]||(t[20]=e("p",{class:"text-xs text-cafe/60 font-medium"},"Hoy",-1))])])]),e("div",_s,[e("div",ws,[e("div",ys,[v(i(ie),{class:"w-6 h-6 text-amber-600"})]),e("div",ks,[e("p",Cs,l(i(N)),1),t[21]||(t[21]=e("p",{class:"text-xs text-cafe/60 font-medium"},"Recordatorios listos",-1))])])])]),i(D).length>0?(c(),u("div",$s,[e("div",js,[(c(!0),u(oe,null,ae(i(D),s=>(c(),u("div",{key:s.id,class:"group bg-white rounded-xl border border-gray-100 hover:shadow-md transition-all duration-200 overflow-hidden"},[e("div",Ms,[t[29]||(t[29]=e("div",{class:"w-1 bg-verde flex-shrink-0"},null,-1)),e("div",Ds,[e("div",Ss,[e("div",Ps,[e("div",Es,l(S(s.paciente.nombre)),1),t[22]||(t[22]=e("div",{class:"absolute -bottom-1 -right-1 w-5 h-5 bg-white rounded-full flex items-center justify-center shadow-sm"},[e("span",{class:"text-verde text-xs"},"‚úì")],-1))]),e("div",Ls,[e("div",Ts,[e("div",Bs,[e("h4",Hs,l(s.paciente.nombre),1),s.listaParaRecordatorio?(c(),u("span",Rs,[...t[23]||(t[23]=[e("span",null,"‚è∞",-1),e("span",null,"Enviar recordatorio",-1)])])):_("",!0)]),e("p",Us,l(s.terapeuta.nombre),1)]),e("div",null,[e("p",Vs,l(W(s.fecha)),1),e("p",zs,l(s.hora_inicio),1)]),e("div",null,[e("span",{class:h(["inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium",{"bg-purple-50 text-purple-700":s.modalidad==="online","bg-verde/10 text-verde":s.modalidad==="presencial"}])},[e("span",null,l(s.modalidad==="online"?"üíª":"üè•"),1),e("span",Is,l(s.modalidad),1)],2)]),e("div",null,[s.bono?(c(),u("div",Ns,[e("div",As,[t[24]||(t[24]=e("span",{class:"text-xs text-cafe/60"},"üé´ Bono:",-1)),e("span",{class:h(["text-xs font-semibold",{"text-red-600":s.bono.sesiones_restantes===0,"text-orange-600":s.bono.sesiones_restantes===1,"text-amber-600":s.bono.sesiones_restantes===2,"text-verde":s.bono.sesiones_restantes>2}])},l(s.bono.sesiones_restantes)+"/"+l(s.bono.sesiones_totales),3)]),e("div",Os,[e("div",qs,[e("div",{class:h(["h-full transition-all duration-300 rounded-full",{"bg-red-500":s.bono.sesiones_restantes===0,"bg-orange-500":s.bono.sesiones_restantes===1,"bg-amber-500":s.bono.sesiones_restantes===2,"bg-verde":s.bono.sesiones_restantes>2}]),style:je({width:`${s.bono.sesiones_restantes/s.bono.sesiones_totales*100}%`})},null,6)])]),s.bono.sesiones_restantes<=2?(c(),u("span",{key:0,class:h(["text-[10px] font-medium",{"text-red-600":s.bono.sesiones_restantes===0,"text-orange-600":s.bono.sesiones_restantes===1,"text-amber-600":s.bono.sesiones_restantes===2}])},l(s.bono.sesiones_restantes===0?"‚ö†Ô∏è Agotado":"‚ö†Ô∏è Renovar pronto"),3)):_("",!0)])):(c(),u("div",Ws," Sin bono "))]),t[25]||(t[25]=e("div",{class:"text-right"},[e("span",{class:"inline-flex items-center gap-1 px-2.5 py-1 bg-verde/10 text-verde rounded-full text-xs font-medium"},[e("span",null,"‚úì"),e("span",null,"Confirmada")])],-1))]),e("div",Fs,[s.paciente.telefono?(c(),u("div",Zs,[e("button",{onClick:m=>fe(s),class:h(["p-2.5 rounded-lg transition-colors",s.listaParaRecordatorio?"bg-blue-500 text-white hover:bg-blue-600 animate-pulse":"bg-blue-500/10 text-blue-600 hover:bg-blue-500 hover:text-white"]),title:s.listaParaRecordatorio?"¬°Lista para recordatorio! Enviar WhatsApp":"Enviar recordatorio por WhatsApp"},[...t[26]||(t[26]=[e("span",{class:"text-lg"},"üí¨",-1)])],10,Gs),s.listaParaRecordatorio?(c(),u("span",Ks,[...t[27]||(t[27]=[e("span",{class:"animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"},null,-1),e("span",{class:"relative inline-flex rounded-full h-3 w-3 bg-blue-500"},null,-1)])])):_("",!0)])):_("",!0),e("button",{onClick:m=>ve(s),class:"p-2.5 bg-orange-50 text-orange-600 hover:bg-orange-500 hover:text-white rounded-lg transition-colors",title:"Volver a pendiente"},[...t[28]||(t[28]=[e("span",{class:"text-lg"},"‚Ü∫",-1)])],8,Js)])])])])]))),128))])])):(c(),u("div",Qs,[e("div",Xs,[t[31]||(t[31]=$e('<div class="w-20 h-20 bg-gray-100 rounded-2xl flex items-center justify-center" data-v-10e941a7><span class="text-4xl" data-v-10e941a7>üìã</span></div><div class="space-y-1" data-v-10e941a7><h3 class="text-lg font-semibold text-cafe" data-v-10e941a7> No hay citas confirmadas </h3><p class="text-sm text-cafe/60 max-w-sm" data-v-10e941a7> Las citas confirmadas con los pacientes aparecer√°n aqu√≠ </p></div>',2)),v(n,{to:"/coordinadora/agenda",class:"mt-2 px-5 py-2 bg-verde text-white rounded-lg hover:bg-verde/90 transition-colors font-medium text-sm"},{default:q(()=>[...t[30]||(t[30]=[ne(" Ver agenda completa ",-1)])]),_:1})])]))])]),i(j)?(c(),Q(f,{key:0,cita:i(j),"is-open":i(k),onClose:Y,onCancelada:he},null,8,["cita","is-open"])):_("",!0),(c(),Q(de,{to:"body"},[i(p).visible?(c(),u("div",Ys,[e("div",{class:h(["bg-white rounded-lg shadow-2xl border-l-4 p-4 min-w-[320px] max-w-md",{"border-green-500":i(p).tipo==="success","border-red-500":i(p).tipo==="error"}])},[e("div",eo,[e("div",{class:h(["w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0",{"bg-green-100":i(p).tipo==="success","bg-red-100":i(p).tipo==="error"}])},[e("span",to,l(i(p).tipo==="success"?"‚úì":"‚úó"),1)],2),e("div",so,[e("p",{class:h(["font-bold mb-1",{"text-green-700":i(p).tipo==="success","text-red-700":i(p).tipo==="error"}])},l(i(p).titulo),3),e("p",oo,l(i(p).mensaje),1)]),e("button",{onClick:t[0]||(t[0]=s=>i(p).visible=!1),class:"text-cafe/40 hover:text-cafe/60 transition-colors"},[...t[32]||(t[32]=[e("span",{class:"text-xl"},"√ó",-1)])])])],2)])):_("",!0)]))])}}},mo=De(ao,[["__scopeId","data-v-10e941a7"]]);export{mo as default};
