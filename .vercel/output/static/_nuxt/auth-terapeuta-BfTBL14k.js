import{an as d,B as c,g as p,y as e,ao as f}from"#entry";const w=d(async(i,g)=>{let r,s;if(!i.path.startsWith("/terapeuta")||i.path==="/terapeuta/login")return;const o=c(),u=p();if(!o.value)return console.log("[Middleware] Usuario no autenticado, redirigiendo a login"),e("/terapeuta/login",{replace:!0});try{const a=o.value?.id||o.value?.sub;if(!a)return console.error("[Middleware] No se pudo obtener el ID del usuario:",o.value),e("/terapeuta/login",{replace:!0});const{data:l,error:n}=([r,s]=f(()=>u.from("profiles").select("rol, nombre").eq("id",a).single()),r=await r,s(),r);if(n)return console.error("[Middleware] Error al obtener perfil:",n),e("/terapeuta/login",{replace:!0});const t=l?.rol;if(!t||!["terapeuta","psicologa","admin","coordinadora"].includes(t))return console.log(`[Middleware] Usuario con rol '${t}' sin acceso, redirigiendo a home`),e("/",{replace:!0});console.log(`[Middleware] Acceso autorizado para: ${l?.nombre||"profesional"} (${t})`)}catch(a){return console.error("[Middleware] Error inesperado:",a),e("/terapeuta/login",{replace:!0})}});export{w as default};
