import{e as G,r as m,q as j,C as y,E as R,H as J,c as n,g as _,i as q,a,t as g,j as f,v as w,F as C,s as M,z as Y,y as x,o as l}from"#entry";import{u as K}from"./C9Vbupfc.js";import{u as Q}from"./BbZO5sJf.js";import{_ as W}from"./DlAUqK2U.js";const X={class:"bg-white dark:bg-gray-900 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden"},Z={class:"px-6 py-4 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20"},aa={key:0,class:"text-sm text-gray-600 dark:text-gray-400 mt-1"},ea={key:0,class:"p-12 flex flex-col items-center justify-center"},ra={class:"space-y-6"},oa={class:"space-y-2"},ta={class:"flex gap-2 flex-wrap"},ia=["onClick"],la={class:"text-xs text-gray-500 dark:text-gray-400 capitalize"},sa={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},na={class:"md:col-span-2"},da={class:"space-y-3"},ca={class:"grid grid-cols-4 sm:grid-cols-6 gap-2 max-h-48 overflow-y-auto p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg border border-gray-200 dark:border-gray-700"},ua=["onClick"],ga={class:"text-xs"},pa={class:"mt-2"},ba={key:0,class:"p-4 bg-yellow-50 dark:bg-yellow-900/20 border-2 border-yellow-300 dark:border-yellow-700 rounded-lg"},va={class:"grid grid-cols-3 gap-3"},ma=["onClick"],ya={class:"text-2xl mb-1"},fa={class:"text-sm font-medium text-gray-900 dark:text-white"},xa={class:"grid grid-cols-2 md:grid-cols-4 gap-3"},ha=["onClick"],ka={class:"text-xl mb-1"},_a={class:"text-xs font-medium text-gray-900 dark:text-white"},wa={class:"px-6 py-4 border-t border-gray-200 dark:border-gray-800 flex gap-3 bg-gray-50 dark:bg-gray-800"},Ca=["disabled"],Ma={key:0},Ea={key:1},Ia=G({__name:"ModalEditarCita",props:{isOpen:{type:Boolean},citaId:{}},emits:["close","actualizado"],setup(z,{emit:B}){const d=z,E=B,H=Q(),{actualizarCita:L,getCitasPorDia:T}=K(),b=m(null),I=m(!1),v=m(!1),p=m(!1),r=m({fecha_cita:"",hora_inicio:"",hora_fin:"",duracion:60,modalidad:"presencial",estado:"pendiente",observaciones:""}),U=j(()=>r.value.fecha_cita?new Date(r.value.fecha_cita+"T00:00:00").toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long",year:"numeric"}):""),P=j(()=>{const t=new Date,e=[],o=u=>u.toISOString().split("T")[0];e.push({label:"Hoy",fecha:o(t)});const i=new Date(t);i.setDate(i.getDate()+1),e.push({label:"MaÃ±ana",fecha:o(i)});const s=["Lun","Mar","MiÃ©","Jue","Vie"];let c=new Date(t),k=0;for(;k<5;){c.setDate(c.getDate()+1);const u=c.getDay();u>=1&&u<=5&&(e.push({label:`${s[u-1]} ${c.getDate()}`,fecha:o(c)}),k++)}return e}),A=["08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00","18:30","19:00","19:30","20:00","20:30","21:00","21:30","22:00"],$=async()=>{if(console.log("ðŸ” [ModalEditarCita] Cargando cita con ID:",d.citaId),!d.citaId){console.warn("âš ï¸ [ModalEditarCita] No hay citaId proporcionado");return}try{I.value=!0;const{data:t,error:e}=await H.from("citas").select(`
        *,
        paciente:pacientes!citas_paciente_id_fkey (
          id,
          nombre_completo,
          email,
          telefono
        )
      `).eq("id",d.citaId).single();if(e)throw console.error("âŒ [ModalEditarCita] Error en query:",e),e;console.log("âœ… [ModalEditarCita] Cita cargada:",t),t&&(b.value=t,r.value={fecha_cita:t.fecha_cita,hora_inicio:t.hora_inicio?.substring(0,5)||"",hora_fin:t.hora_fin?.substring(0,5)||"",duracion:t.duracion||60,modalidad:t.modalidad||"presencial",estado:t.estado||"pendiente",observaciones:t.observaciones||""},console.log("ðŸ“ [ModalEditarCita] Formulario llenado:",r.value))}catch(t){console.error("ðŸ’¥ [ModalEditarCita] Error al cargar cita:",t)}finally{I.value=!1}},V=async()=>{if(!r.value.fecha_cita||!r.value.hora_inicio||!r.value.hora_fin){p.value=!1;return}try{const e=(await T(r.value.fecha_cita)).filter(s=>s.estado!=="cancelada"&&s.id!==d.citaId),o=r.value.hora_inicio,i=r.value.hora_fin;p.value=e.some(s=>{const c=s.hora_inicio?.substring(0,5),k=s.hora_fin?.substring(0,5),u=h(o),S=h(i),F=h(c),N=h(k);return u>=F&&u<N||S>F&&S<=N||u<=F&&S>=N})}catch(t){console.error("Error al verificar conflicto:",t),p.value=!1}},h=t=>{if(!t||!t.includes(":"))return 0;const[e,o]=t.split(":").map(Number);return(e||0)*60+(o||0)};y(()=>r.value.hora_inicio,t=>{if(t&&r.value.duracion){const[e,o]=t.split(":").map(Number),i=(e||0)*60+(o||0)+r.value.duracion,s=Math.floor(i/60),c=i%60;r.value.hora_fin=`${String(s).padStart(2,"0")}:${String(c).padStart(2,"0")}`}}),y(()=>r.value.duracion,t=>{if(r.value.hora_inicio&&t){const[e,o]=r.value.hora_inicio.split(":").map(Number),i=(e||0)*60+(o||0)+t,s=Math.floor(i/60),c=i%60;r.value.hora_fin=`${String(s).padStart(2,"0")}:${String(c).padStart(2,"0")}`}}),y([()=>r.value.fecha_cita,()=>r.value.hora_inicio,()=>r.value.hora_fin],()=>{V()});const O=async()=>{if(d.citaId&&(await V(),!p.value))try{v.value=!0,(await L(d.citaId,{fecha_cita:r.value.fecha_cita,hora_inicio:r.value.hora_inicio,hora_fin:r.value.hora_fin,modalidad:r.value.modalidad,estado:r.value.estado,observaciones:r.value.observaciones})).success&&(E("actualizado"),E("close"))}catch(t){console.error("Error al actualizar cita:",t)}finally{v.value=!1}},D=()=>{E("close")};return y(()=>d.isOpen,t=>{console.log("ðŸ‘ï¸ [ModalEditarCita] Modal abierto:",t,"citaId:",d.citaId),t&&d.citaId&&$()}),y(()=>d.citaId,t=>{console.log("ðŸ”„ [ModalEditarCita] citaId cambiÃ³ a:",t),d.isOpen&&t&&$()}),(t,e)=>(l(),R(J,{to:"body"},[z.isOpen?(l(),n("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:q(D,["self"])},[a("div",X,[a("div",Z,[a("div",null,[e[5]||(e[5]=a("h2",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"âœï¸ Editar Cita",-1)),b.value?(l(),n("p",aa,g(b.value.paciente?.nombre_completo||b.value.paciente_nombre),1)):_("",!0)]),a("button",{onClick:D,class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors","aria-label":"Cerrar"},[...e[6]||(e[6]=[a("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),I.value?(l(),n("div",ea,[...e[7]||(e[7]=[a("div",{class:"w-12 h-12 border-4 border-purple-200 border-t-purple-600 rounded-full animate-spin mb-4"},null,-1),a("p",{class:"text-gray-600 dark:text-gray-400"},"Cargando...",-1)])])):b.value?(l(),n("form",{key:1,onSubmit:q(O,["prevent"]),class:"px-6 py-4 overflow-y-auto max-h-[calc(90vh-200px)]"},[a("div",ra,[a("div",null,[e[8]||(e[8]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," ðŸ“… Fecha ",-1)),a("div",oa,[f(a("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>r.value.fecha_cita=o),type:"date",required:"",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-800 dark:text-white cursor-pointer"},null,512),[[w,r.value.fecha_cita]]),a("div",ta,[(l(!0),n(C,null,M(P.value,(o,i)=>(l(),n("button",{key:i,type:"button",onClick:s=>r.value.fecha_cita=o.fecha,class:x(["text-xs px-3 py-1.5 rounded-lg border transition-all",r.value.fecha_cita===o.fecha?"bg-purple-600 text-white border-purple-600 font-semibold":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 border-gray-300 dark:border-gray-600 hover:border-purple-500 hover:bg-purple-50 dark:hover:bg-purple-900/20"])},g(o.label),11,ia))),128))]),a("p",la,g(U.value),1)])]),a("div",sa,[a("div",na,[e[10]||(e[10]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," ðŸ• Hora Inicio ",-1)),a("div",da,[a("div",ca,[(l(),n(C,null,M(A,o=>a("button",{key:o,type:"button",onClick:i=>r.value.hora_inicio=o,class:x(["px-3 py-2 text-sm font-medium rounded-lg transition-all border-2",r.value.hora_inicio===o?"bg-purple-600 text-white border-purple-600 shadow-md transform scale-105":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 border-gray-200 dark:border-gray-600 hover:border-purple-500 hover:bg-purple-50 dark:hover:bg-purple-900/20 hover:shadow"])},g(o),11,ua)),64))]),a("details",ga,[e[9]||(e[9]=a("summary",{class:"cursor-pointer text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 select-none flex items-center gap-1"},[a("span",null,"âŒ¨ï¸"),a("span",null,"Ingresar hora manualmente")],-1)),a("div",pa,[f(a("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>r.value.hora_inicio=o),type:"time",required:"",step:"1800",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-800 dark:text-white"},null,512),[[w,r.value.hora_inicio]])])])])]),a("div",null,[e[12]||(e[12]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," â±ï¸ DuraciÃ³n (min) ",-1)),f(a("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>r.value.duracion=o),class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-800 dark:text-white"},[...e[11]||(e[11]=[a("option",{value:30},"30 min",-1),a("option",{value:45},"45 min",-1),a("option",{value:60},"60 min",-1),a("option",{value:90},"90 min",-1)])],512),[[Y,r.value.duracion]])]),a("div",null,[e[13]||(e[13]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," ðŸ•‘ Hora Fin ",-1)),f(a("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>r.value.hora_fin=o),type:"time",required:"",readonly:"",step:"1800",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-800 dark:text-white"},null,512),[[w,r.value.hora_fin]])])]),p.value?(l(),n("div",ba,[...e[14]||(e[14]=[a("div",{class:"flex items-start gap-3"},[a("span",{class:"text-2xl"},"âš ï¸"),a("div",null,[a("div",{class:"font-semibold text-yellow-800 dark:text-yellow-300 mb-1"}," Conflicto de Horario "),a("div",{class:"text-sm text-yellow-700 dark:text-yellow-400"}," Ya existe otra cita en este horario. Por favor, selecciona otro horario. ")])],-1)])])):_("",!0),a("div",null,[e[15]||(e[15]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," ðŸ’» Modalidad ",-1)),a("div",va,[(l(),n(C,null,M([{valor:"presencial",icono:"ðŸ¥",nombre:"Presencial"},{valor:"online",icono:"ðŸ’»",nombre:"Online"},{valor:"telefonica",icono:"ðŸ“ž",nombre:"TelÃ©fono"}],o=>a("button",{key:o.valor,type:"button",onClick:i=>r.value.modalidad=o.valor,class:x(["p-3 border-2 rounded-lg transition-all",r.value.modalidad===o.valor?"border-purple-600 bg-purple-50 dark:bg-purple-900/20":"border-gray-300 dark:border-gray-700 hover:border-purple-400"])},[a("div",ya,g(o.icono),1),a("div",fa,g(o.nombre),1)],10,ma)),64))])]),a("div",null,[e[16]||(e[16]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," ðŸ“Š Estado ",-1)),a("div",xa,[(l(),n(C,null,M([{valor:"pendiente",icono:"â³",nombre:"Pendiente"},{valor:"confirmada",icono:"âœ…",nombre:"Confirmada"},{valor:"realizada",icono:"âœ“",nombre:"Realizada"},{valor:"cancelada",icono:"âŒ",nombre:"Cancelada"}],o=>a("button",{key:o.valor,type:"button",onClick:i=>r.value.estado=o.valor,class:x(["p-2 border-2 rounded-lg transition-all",r.value.estado===o.valor?"border-purple-600 bg-purple-50 dark:bg-purple-900/20":"border-gray-300 dark:border-gray-700 hover:border-purple-400"])},[a("div",ka,g(o.icono),1),a("div",_a,g(o.nombre),1)],10,ha)),64))])]),a("div",null,[e[17]||(e[17]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," ðŸ“ Observaciones ",-1)),f(a("textarea",{"onUpdate:modelValue":e[4]||(e[4]=o=>r.value.observaciones=o),rows:"3",placeholder:"Notas adicionales sobre la cita...",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-800 dark:text-white"},null,512),[[w,r.value.observaciones]])])])],32)):_("",!0),a("div",wa,[a("button",{onClick:D,type:"button",class:"flex-1 px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors font-medium"}," Cancelar "),a("button",{onClick:O,disabled:v.value||p.value,class:x(["flex-1 px-4 py-2 rounded-lg font-medium transition-colors",v.value||p.value?"bg-gray-400 dark:bg-gray-600 text-gray-200 cursor-not-allowed":"bg-purple-600 hover:bg-purple-700 text-white"])},[v.value?(l(),n("span",Ma,"Guardando...")):(l(),n("span",Ea,"ðŸ’¾ Guardar Cambios"))],10,Ca)])])])):_("",!0)]))}}),za=Object.assign(W(Ia,[["__scopeId","data-v-90d0f873"]]),{__name:"ModalEditarCita"});export{za as _};
