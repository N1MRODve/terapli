import{e as F,p as B,r as p,g as q,c as i,a as e,D as G,b as v,l as x,h as k,F as O,y as X,j as V,k as N,v as P,t as l,d as z,K as I,o as n}from"#entry";import{r as $}from"./PlusIcon-UqRq4KLf.js";import{r as K}from"./CheckCircleIcon-Bi0YyG7H.js";import{r as Y}from"./UsersIcon-DW5NWq0j.js";import{r as H}from"./XMarkIcon-DWNj0d99.js";const J={class:"mb-8 flex items-center justify-between"},Q={key:0,class:"flex items-center justify-center py-24"},W={key:1,class:"space-y-6"},Z={class:"flex items-start justify-between"},ee={class:"flex items-center gap-4"},te={class:"w-16 h-16 bg-gradient-to-br from-indigo-500 to-purple-500 rounded-full flex items-center justify-center text-white font-bold text-xl shadow-lg"},se={class:"text-xl font-bold text-gray-900"},oe={class:"text-gray-600"},ae={class:"flex items-center gap-2 mt-2"},re={class:"inline-flex items-center gap-1 px-2 py-1 bg-emerald-100 text-emerald-700 text-xs font-semibold rounded-full"},le={class:"grid grid-cols-4 gap-4"},ne={class:"text-center"},ie={class:"text-2xl font-bold text-gray-900"},de={class:"text-center"},ue={class:"text-2xl font-bold text-emerald-600"},ce={class:"text-center bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-3 border border-blue-200"},pe={class:"text-lg font-bold text-blue-900"},me={class:"text-center bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-3 border border-purple-200"},ge={class:"text-lg font-bold text-purple-900"},be={class:"mt-4 pt-4 border-t border-gray-200"},fe={class:"grid grid-cols-5 gap-4 text-sm"},ve={class:"ml-2 font-semibold text-indigo-600"},xe={class:"ml-2 font-semibold text-gray-900"},ye={class:"ml-2 font-semibold text-gray-900"},he={class:"ml-2 font-semibold text-indigo-600"},we={class:"ml-2 font-semibold text-gray-900"},_e={key:0,class:"text-center py-12"},Ce={class:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4"},Te={class:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-6"},ke={class:"flex items-center justify-between mb-6"},Ne={key:0,class:"p-4 bg-red-50 border border-red-200 rounded-lg"},Pe={class:"text-sm text-red-700"},je={key:1,class:"p-4 bg-emerald-50 border border-emerald-200 rounded-lg"},De={class:"text-sm text-emerald-700"},Ae={class:"flex gap-3 pt-4"},Ee=["disabled"],Me=["disabled"],Se={key:0},Ve={key:1,class:"flex items-center justify-center gap-2"},Be=F({__name:"terapeutas",setup(ze){const y=B(),j=p(!0),h=p(!1),m=p(!1),g=p(""),b=p(""),D=p([]),r=p({nombreCompleto:"",email:"",password:"",telefono:""}),w=o=>o==null||isNaN(o)?"€0,00":o.toLocaleString("es-ES",{style:"currency",currency:"EUR",minimumFractionDigits:2,maximumFractionDigits:2}),L=o=>new Date(o).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"}),A=async()=>{try{j.value=!0;const[{data:o},{data:t},{data:s},{data:C}]=await Promise.all([y.from("terapeutas").select("*"),y.from("pacientes").select("*"),y.from("citas").select("*"),y.from("bonos").select("*")]);console.log("Datos cargados:",{terapeutas:o?.length||0,pacientes:t?.length||0,citas:s?.length||0,bonos:C?.length||0,bonosPagados:C?.filter(d=>d.pagado)?.length||0}),D.value=(o||[]).map(d=>{const u=t?.filter(a=>a.terapeuta_id===d.id)||[],T=s?.filter(a=>u.some(c=>c.id===a.paciente_id))||[],E=T.filter(a=>a.estado==="realizada"),M=C?.filter(a=>a.pagado===!0&&u.some(c=>c.id===a.paciente_id))||[],f=M.reduce((a,c)=>{const S=parseFloat(c.monto_total||"0");return a+(isNaN(S)?0:S)},0),U=C?.filter(a=>a.estado==="activo"&&u.some(c=>c.id===a.paciente_id))||[];return console.log(`Terapeuta ${d.nombre_completo}:`,{pacientes:u.length,bonosPagados:M.length,revenue:f}),{id:d.id,nombre:d.nombre_completo||"Sin nombre",email:d.email||"",telefono:d.telefono||"",iniciales:(d.nombre_completo||"XX").split(" ").map(a=>a[0]).join("").toUpperCase().slice(0,2),totalPacientes:u.length,pacientesActivos:U.length,citasRealizadas:E.length,citasTotales:T.length,ocupacion:T.length>0?Math.round(E.length/T.length*100):0,revenue:f||0,revenueTerapeuta:(f||0)*.7,revenueAdmin:(f||0)*.3,cltvPromedio:u.length>0?(f||0)/u.length:0,createdAt:d.created_at}})}catch(o){console.error("Error al cargar terapeutas:",o)}finally{j.value=!1}},R=async()=>{try{m.value=!0,g.value="",b.value="",console.log("Iniciando creación de terapeuta:",r.value.email);const o=await $fetch("/api/admin/crear-terapeuta",{method:"POST",body:{nombreCompleto:r.value.nombreCompleto,email:r.value.email,password:r.value.password,telefono:r.value.telefono}});console.log("✅ Respuesta del servidor:",o),b.value="¡Terapeuta creada exitosamente! Ya puede iniciar sesión en /terapeuta/login",setTimeout(()=>{_(),A()},2e3)}catch(o){console.error("❌ Error al crear terapeuta:",o),g.value=o.data?.message||o.message||"Error al crear la terapeuta. Por favor verifica los datos."}finally{m.value=!1}},_=()=>{m.value||(h.value=!1,g.value="",b.value="",r.value={nombreCompleto:"",email:"",password:"",telefono:""})};return q(()=>{A()}),(o,t)=>(n(),i("div",null,[e("div",J,[t[7]||(t[7]=e("div",null,[e("h2",{class:"text-3xl font-bold text-gray-900 mb-2"},"Gestión de Terapeutas"),e("p",{class:"text-gray-600"},"Administrar terapeutas y crear nuevos usuarios")],-1)),e("button",{onClick:t[0]||(t[0]=s=>h.value=!0),class:"inline-flex items-center gap-2 px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-lg shadow-md transition-colors"},[v(x($),{class:"w-5 h-5"}),t[6]||(t[6]=e("span",null,"Nueva Terapeuta",-1))])]),j.value?(n(),i("div",Q,[...t[8]||(t[8]=[e("div",{class:"text-center"},[e("div",{class:"w-16 h-16 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin mx-auto mb-4"}),e("p",{class:"text-gray-600 font-medium"},"Cargando terapeutas...")],-1)])])):(n(),i("div",W,[(n(!0),i(O,null,X(D.value,s=>(n(),i("div",{key:s.id,class:"bg-white rounded-xl shadow-md border border-gray-200 p-6 hover:shadow-lg transition-shadow"},[e("div",Z,[e("div",ee,[e("div",te,l(s.iniciales),1),e("div",null,[e("h3",se,l(s.nombre),1),e("p",oe,l(s.email),1),e("div",ae,[e("span",re,[v(x(K),{class:"w-3 h-3"}),t[9]||(t[9]=z(" Activa ",-1))])])])]),e("div",le,[e("div",ne,[e("div",ie,l(s.totalPacientes),1),t[10]||(t[10]=e("div",{class:"text-sm text-gray-600"},"Pacientes",-1))]),e("div",de,[e("div",ue,l(s.citasRealizadas),1),t[11]||(t[11]=e("div",{class:"text-sm text-gray-600"},"Citas realizadas",-1))]),e("div",ce,[e("div",pe,l(w(s.revenueTerapeuta)),1),t[12]||(t[12]=e("div",{class:"text-xs text-blue-700 font-medium"},"Terapeuta (70%)",-1))]),e("div",me,[e("div",ge,l(w(s.revenueAdmin)),1),t[13]||(t[13]=e("div",{class:"text-xs text-purple-700 font-medium"},"Comisión (30%)",-1))])])]),e("div",be,[e("div",fe,[e("div",null,[t[14]||(t[14]=e("span",{class:"text-gray-600"},"Revenue total:",-1)),e("span",ve,l(w(s.revenue)),1)]),e("div",null,[t[15]||(t[15]=e("span",{class:"text-gray-600"},"Pacientes activos:",-1)),e("span",xe,l(s.pacientesActivos),1)]),e("div",null,[t[16]||(t[16]=e("span",{class:"text-gray-600"},"Ocupación:",-1)),e("span",ye,l(s.ocupacion)+"%",1)]),e("div",null,[t[17]||(t[17]=e("span",{class:"text-gray-600"},"CLTV promedio:",-1)),e("span",he,l(w(s.cltvPromedio)),1)]),e("div",null,[t[18]||(t[18]=e("span",{class:"text-gray-600"},"Miembro desde:",-1)),e("span",we,l(L(s.createdAt)),1)])])])]))),128)),D.value.length===0?(n(),i("div",_e,[e("div",Ce,[v(x(Y),{class:"w-8 h-8 text-gray-400"})]),t[20]||(t[20]=e("p",{class:"text-gray-600 mb-4"},"No hay terapeutas registradas",-1)),e("button",{onClick:t[1]||(t[1]=s=>h.value=!0),class:"inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-lg transition-colors"},[v(x($),{class:"w-5 h-5"}),t[19]||(t[19]=e("span",null,"Crear primera terapeuta",-1))])])):k("",!0)])),(n(),G(I,{to:"body"},[h.value?(n(),i("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50",onClick:V(_,["self"])},[e("div",Te,[e("div",ke,[t[21]||(t[21]=e("h3",{class:"text-2xl font-bold text-gray-900"},"Nueva Terapeuta",-1)),e("button",{onClick:_,class:"text-gray-400 hover:text-gray-600 transition-colors"},[v(x(H),{class:"w-6 h-6"})])]),e("form",{onSubmit:V(R,["prevent"]),class:"space-y-4"},[e("div",null,[t[22]||(t[22]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-2"}," Nombre completo ",-1)),N(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>r.value.nombreCompleto=s),type:"text",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Ej: María García López"},null,512),[[P,r.value.nombreCompleto]])]),e("div",null,[t[23]||(t[23]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-2"}," Email ",-1)),N(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>r.value.email=s),type:"email",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"maria@example.com"},null,512),[[P,r.value.email]])]),e("div",null,[t[24]||(t[24]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-2"}," Contraseña temporal ",-1)),N(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>r.value.password=s),type:"password",required:"",minlength:"8",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Mínimo 8 caracteres"},null,512),[[P,r.value.password]]),t[25]||(t[25]=e("p",{class:"text-xs text-gray-500 mt-1"}," La terapeuta deberá cambiar esta contraseña en su primer acceso ",-1))]),e("div",null,[t[26]||(t[26]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-2"}," Teléfono ",-1)),N(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>r.value.telefono=s),type:"tel",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"+52 123 456 7890"},null,512),[[P,r.value.telefono]])]),g.value?(n(),i("div",Ne,[e("p",Pe,l(g.value),1)])):k("",!0),b.value?(n(),i("div",je,[e("p",De,l(b.value),1)])):k("",!0),e("div",Ae,[e("button",{type:"button",onClick:_,class:"flex-1 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold rounded-lg transition-colors",disabled:m.value}," Cancelar ",8,Ee),e("button",{type:"submit",class:"flex-1 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:m.value},[m.value?(n(),i("span",Ve,[...t[27]||(t[27]=[e("div",{class:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1),z(" Creando... ",-1)])])):(n(),i("span",Se,"Crear Terapeuta"))],8,Me)])],32)])])):k("",!0)]))]))}});export{Be as default};
