import{c as s,o as a,a as e,x as T,h as E,l as o,j as ae,b as F,z as Ke,t as l,A as q,d as P,f as Se,B as Xe,r as j,I as ne,k as G,v as W,K as _e,i as He,F as K,y as J,X as ue,e as ke,p as Je,J as se,T as Ae,w as Fe,ag as _t,m as ie,M as Te,C as wt,ah as Ie,L as kt,g as $t,E as Ct}from"#entry";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as Ge}from"./TicketIcon-DRclOuRO.js";import{r as Dt}from"./PencilIcon-QJyqa3i7.js";import{r as Et}from"./TrashIcon-c8JhvyFk.js";import{r as St}from"./CalendarIcon-mZ3toP8Y.js";import{r as Ft}from"./ClockIcon-CQZt9cKZ.js";import{r as ve}from"./ExclamationTriangleIcon-BreoAuwB.js";import{r as Mt}from"./BellAlertIcon-D9Txc_Yy.js";import{_ as Pt}from"./ModalNuevaCita-Cd6_FHUU.js";import{u as Ye}from"./useBonos-yaUVQI0C.js";import{u as Ze}from"./useCitas-9Z4e1_ch.js";import{u as $e}from"./useToast-Cq0GyJHs.js";import{r as ce}from"./CheckCircleIcon-Bi0YyG7H.js";import{r as je}from"./XCircleIcon-DIGsvT-h.js";import{r as Ce}from"./XMarkIcon-DWNj0d99.js";import{r as Be,a as It,b as We}from"./EyeIcon-C_-OWEOm.js";import{r as we}from"./DocumentTextIcon-Dp_75vtG.js";import{r as At}from"./PlusIcon-UqRq4KLf.js";import{r as Tt}from"./MagnifyingGlassIcon-B5My0XuL.js";import{r as jt}from"./FunnelIcon-CO-pjLeZ.js";import{r as Bt}from"./ChevronDownIcon-BwiNUDLV.js";import{r as Qe}from"./CalendarDaysIcon-C0vq0F4x.js";import{r as Vt}from"./ClipboardDocumentListIcon-CSBwmCjC.js";import{r as zt}from"./UserGroupIcon-Byc3y-S3.js";import"./UserIcon-G1mM6o1b.js";import"./PhoneIcon-B4J2dtua.js";import"./CheckBadgeIcon-CuVUaEjS.js";function qt(I,A){return a(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75"})])}function Rt(I,A){return a(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M11.35 3.836c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m8.9-4.414c.376.023.75.05 1.124.08 1.131.094 1.976 1.057 1.976 2.192V16.5A2.25 2.25 0 0 1 18 18.75h-2.25m-7.5-10.5H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V18.75m-7.5-10.5h6.375c.621 0 1.125.504 1.125 1.125v9.375m-8.25-3 1.5 1.5 3-3.75"})])}function Ot(I,A){return a(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m.75 12 3 3m0 0 3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})])}function fe(I,A){return a(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"})])}function Nt(I,A){return a(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3.75 9.776c.112-.017.227-.026.344-.026h15.812c.117 0 .232.009.344.026m-16.5 0a2.25 2.25 0 0 0-1.883 2.542l.857 6a2.25 2.25 0 0 0 2.227 1.932H19.05a2.25 2.25 0 0 0 2.227-1.932l.857-6a2.25 2.25 0 0 0-1.883-2.542m-16.5 0V6A2.25 2.25 0 0 1 6 3.75h3.879a1.5 1.5 0 0 1 1.06.44l2.122 2.12a1.5 1.5 0 0 0 1.06.44H18A2.25 2.25 0 0 1 20.25 9v.776"})])}const Ut=["aria-label"],Lt={class:"absolute top-3 right-3 flex gap-1 opacity-0 group-hover:opacity-100 group-focus-within:opacity-100 transition-all duration-200 z-10",role:"toolbar","aria-label":"Acciones del paciente"},Ht=["aria-label"],Gt=["aria-label"],Qt=["aria-label"],Kt={class:"flex items-center gap-3 mb-4"},Xt=["aria-label"],Jt={class:"flex-1 min-w-0"},Yt={class:"flex items-center gap-2"},Zt={class:"font-medium text-base text-gray-900 truncate"},Wt={class:"space-y-2 text-sm text-gray-600"},eo={class:"flex items-center gap-2"},to={class:"flex items-center gap-2"},oo=["aria-label"],ao={key:1,class:"text-gray-400"},so={key:0,class:"flex items-center gap-2"},ro={class:"flex items-center gap-1.5 flex-wrap"},no={key:0,class:"mt-3"},lo={key:0,class:"flex items-center gap-2 px-3 py-2 bg-red-50 border border-red-100 rounded-lg text-xs"},io={key:1,class:"flex items-center gap-2 px-3 py-2 bg-amber-50 border border-amber-100 rounded-lg text-xs"},co={class:"text-amber-700 font-medium"},uo={key:2,class:"flex items-center gap-2 px-3 py-2 bg-red-50 border border-red-100 rounded-lg text-xs"},po={class:"text-red-700 font-medium"},mo={class:"mt-3 pt-3 border-t border-gray-50 flex items-center justify-between text-xs text-gray-400"},bo={key:0,class:"flex items-center gap-1"},go={__name:"PacienteCard",props:{paciente:{type:Object,required:!0}},emits:["editar","eliminar","ver-citas","gestionar-bonos","editar-cita"],setup(I){const A=I,f=T(()=>{const C=A.paciente.nombre||"Sin nombre";if(C==="Sin nombre")return"Sin nombre";const v=C.trim().split(" ");if(v.length>2){const U=v[0],O=v[1],Q=v[v.length-1].charAt(0);return`${U} ${O} ${Q}.`}return C}),B=T(()=>{const C=A.paciente.nombre||"";if(!C)return"??";const v=C.trim().split(" "),U=v[0]?.charAt(0).toUpperCase()||"?",O=v[1]?.charAt(0).toUpperCase()||"";return`${U}${O}`}),u=T(()=>{const C=["#5550F2","#C89B8A","#B7C6B0","#A8C5B5","#D4A5A5","#C4B5A0"],v=A.paciente.id.charCodeAt(0)%C.length;return C[v]}),x=T(()=>A.paciente.activo?A.paciente.en_pausa?"Pausa":"Activo":"Finalizado"),_=T(()=>A.paciente.activo?A.paciente.en_pausa?"bg-yellow-50 text-yellow-700":"bg-green-50 text-green-700":"bg-gray-100 text-gray-600"),S=T(()=>A.paciente.activo?A.paciente.en_pausa?"bg-yellow-500":"bg-green-500":"bg-gray-400"),N=T(()=>{if(!A.paciente.ultima_sesion)return"Sin registro";const C=new Date(A.paciente.ultima_sesion),U=Math.floor((new Date-C)/(1e3*60*60*24));return U===0?"Hoy":U===1?"Ayer":U<7?`Hace ${U} d√≠as`:U<30?`Hace ${Math.floor(U/7)} sem`:C.toLocaleDateString("es-ES",{day:"numeric",month:"short"})}),d=T(()=>{if(!A.paciente.proxima_sesion)return null;try{let C=A.paciente.proxima_sesion;C.includes("T")||(C+="T00:00:00");const v=new Date(C);return isNaN(v.getTime())?null:v.toLocaleDateString("es-ES",{weekday:"short",day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})}catch{return null}}),r=T(()=>A.paciente.total_sesiones||0),p=T(()=>A.paciente.evolucion_porcentaje||0),V=T(()=>{const C=p.value;return C>=70?"bg-green-500":C>=50?"bg-yellow-500":"bg-orange-500"}),H=T(()=>{if(!A.paciente.ultima_sesion)return 0;const C=new Date(A.paciente.ultima_sesion);return Math.floor((new Date-C)/(1e3*60*60*24))}),D=T(()=>!A.paciente.activo||A.paciente.en_pausa?!1:H.value>30),$=T(()=>A.paciente.bono_activo||null),y=T(()=>$.value?.tipo?{otro:"Demanda",quincenal:"Quinc.",semanal:"Semanal",mensual:"Mensual",personalizado:"Pers."}[$.value.tipo]||$.value.tipo:""),b=T(()=>$.value?.estado?{activo:"Activo",pendiente:"Pend.",vencido:"Vencido",completado:"Complet."}[$.value.estado]||$.value.estado:""),i=T(()=>$.value?.estado&&{activo:"bg-green-100 text-green-700",pendiente:"bg-yellow-100 text-yellow-700",vencido:"bg-red-100 text-red-700",completado:"bg-gray-100 text-gray-600"}[$.value.estado]||"bg-gray-100 text-gray-600"),g=T(()=>{if(!$.value?.fecha_fin)return"‚Äî";try{return new Date($.value.fecha_fin).toLocaleDateString("es-ES",{day:"numeric",month:"short"})}catch{return"‚Äî"}}),m=T(()=>{if(!$.value?.fecha_fin)return"text-gray-400";const C=new Date($.value.fecha_fin),U=Math.floor((C-new Date)/(1e3*60*60*24));return U<0?"text-red-600 font-medium":U<=7?"text-orange-600":"text-gray-500"}),h=T(()=>$.value?$.value.sesiones_totales-$.value.sesiones_restantes:0),M=T(()=>$.value?.sesiones_totales||0),R=T(()=>{if(!$.value)return"text-gray-600";const C=$.value.sesiones_restantes;return C===0?"text-red-600":C<=2?"text-orange-600":"text-gray-700"}),Z=T(()=>{if(!$.value)return"text-gray-400";const C=$.value.sesiones_restantes;return C<=1?"text-red-500":C===2?"text-amber-500":"text-purple-500"}),n=T(()=>$.value?$.value.sesiones_restantes===1:!1),t=T(()=>$.value?$.value.sesiones_restantes===2:!1),c=T(()=>n.value||t.value||D.value);return(C,v)=>(a(),s("article",{class:"bg-white rounded-xl border border-gray-100 p-5 hover:shadow-md hover:border-gray-200 transition-all duration-200 group relative cursor-pointer focus-within:ring-2 focus-within:ring-purple-600 focus-within:ring-offset-2",role:"article","aria-label":`Ficha de ${o(f)}`,tabindex:"0"},[e("div",Lt,[e("button",{onClick:v[0]||(v[0]=ae(U=>C.$emit("gestionar-bonos",I.paciente),["stop"])),class:"min-h-[36px] min-w-[36px] p-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors shadow-sm hover:shadow-md focus:ring-2 focus:ring-purple-300 focus:outline-none","aria-label":`Gestionar bonos de ${o(f)}`},[F(o(Ge),{class:"w-4 h-4","aria-hidden":"true"})],8,Ht),e("button",{onClick:v[1]||(v[1]=ae(U=>C.$emit("editar",I.paciente),["stop"])),class:"min-h-[36px] min-w-[36px] p-2 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition-colors shadow-sm hover:shadow-md focus:ring-2 focus:ring-gray-300 focus:outline-none","aria-label":`Editar informaci√≥n de ${o(f)}`},[F(o(Dt),{class:"w-4 h-4","aria-hidden":"true"})],8,Gt),e("button",{onClick:v[2]||(v[2]=ae(U=>C.$emit("eliminar",I.paciente),["stop"])),class:"min-h-[36px] min-w-[36px] p-2 bg-gray-100 text-gray-600 rounded-lg hover:bg-red-100 hover:text-red-600 transition-colors shadow-sm hover:shadow-md focus:ring-2 focus:ring-red-300 focus:outline-none","aria-label":`Eliminar a ${o(f)}`},[F(o(Et),{class:"w-4 h-4","aria-hidden":"true"})],8,Qt)]),e("div",Kt,[e("div",{class:"w-11 h-11 rounded-full flex items-center justify-center text-white font-semibold text-base flex-shrink-0",style:Ke({backgroundColor:o(u)}),"aria-label":`Avatar de ${o(f)}`},l(o(B)),13,Xt),e("div",Jt,[e("div",Yt,[e("h3",Zt,l(o(f)),1),e("span",{class:q(["inline-flex items-center gap-1 px-2 py-0.5 text-xs font-medium rounded-full flex-shrink-0",o(_)])},[e("span",{class:q(["w-1.5 h-1.5 rounded-full",o(S)])},null,2),P(" "+l(o(x)),1)],2)])])]),e("div",Wt,[e("div",eo,[F(o(St),{class:"w-4 h-4 text-gray-400 flex-shrink-0"}),e("span",{class:q({"text-gray-400":!I.paciente.ultima_sesion})},l(o(N)),3)]),e("div",to,[F(o(Ft),{class:"w-4 h-4 text-gray-400 flex-shrink-0"}),o(d)?(a(),s("button",{key:0,onClick:v[3]||(v[3]=ae(U=>C.$emit("editar-cita",I.paciente.proxima_cita_id),["stop"])),class:"text-purple-600 hover:text-purple-700 hover:underline transition-colors focus:outline-none focus:ring-1 focus:ring-purple-300 rounded px-1 -mx-1","aria-label":`Editar cita: ${o(d)}`},l(o(d)),9,oo)):(a(),s("span",ao,"Sin cita programada"))]),o($)?(a(),s("div",so,[F(o(Ge),{class:q(["w-4 h-4 flex-shrink-0",o(Z)])},null,8,["class"]),e("span",ro,[e("span",{class:q(["font-medium",o(R)])},l(o(y))+" "+l(o(h))+"/"+l(o(M)),3),v[4]||(v[4]=e("span",{class:"text-gray-400"},"¬∑",-1)),e("span",{class:q([o(m),"text-xs"])}," Vence "+l(o(g)),3),o($).estado!=="activo"?(a(),s("span",{key:0,class:q(["px-1.5 py-0.5 text-xs font-medium rounded",o(i)])},l(o(b)),3)):E("",!0)])])):E("",!0)]),o(c)?(a(),s("div",no,[o(n)?(a(),s("div",lo,[F(o(ve),{class:"w-4 h-4 text-red-500 flex-shrink-0"}),v[5]||(v[5]=e("span",{class:"text-red-700 font-medium"}," √öltima sesi√≥n del bono ",-1))])):o(t)?(a(),s("div",io,[F(o(fe),{class:"w-4 h-4 text-amber-500 flex-shrink-0"}),e("span",co," Quedan "+l(o($).sesiones_restantes)+" sesiones ",1)])):o(D)?(a(),s("div",uo,[F(o(Mt),{class:"w-4 h-4 text-red-500 flex-shrink-0"}),e("span",po,l(o(H))+" d√≠as sin sesi√≥n ",1)])):E("",!0)])):E("",!0),e("div",mo,[e("span",null,l(o(r))+" sesiones completadas",1),o(p)>0?(a(),s("span",bo,[e("span",{class:q(["w-1.5 h-1.5 rounded-full",o(V)])},null,2),P(" "+l(o(p))+"% ",1)])):E("",!0)])],8,Ut))}},fo=pe(go,[["__scopeId","data-v-049f658f"]]),vo={class:"bg-white/95 backdrop-blur-lg rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto border border-white/30"},xo={class:"space-y-4"},ho={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},yo={class:"relative"},_o={class:"space-y-4 pt-4 border-t border-neutral-200"},wo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ko={class:"relative"},$o={class:"flex gap-2 flex-wrap mt-2"},Co=["onClick"],Do={class:"space-y-4 pt-4 border-t border-[#5550F2]/30"},Eo={class:"border-t pt-6"},So={key:0,class:"bg-amber-50 border-2 border-amber-200 rounded-lg p-4 mb-3"},Fo={key:1,class:"text-sm text-cafe/70 mb-3"},Mo=["disabled"],Po={key:0,class:"border-2 border-purple-400/40 rounded-lg p-5 space-y-4 bg-gradient-to-br from-purple-50 to-purple-100/50"},Io={class:"bg-white border-2 border-purple-300 rounded-lg p-4 shadow-sm"},Ao={class:"flex items-start gap-3"},To={class:"flex-1"},jo={class:"font-semibold text-purple-900 mb-1"},Bo={class:"grid grid-cols-2 gap-3 text-sm"},Vo={class:"flex items-center gap-2"},zo={class:"text-purple-800"},qo={key:0,class:"flex items-center gap-2"},Ro={class:"text-purple-800"},Oo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},No={class:"relative"},Uo=["required"],Lo={class:"px-4 py-2 bg-purple-100 rounded-lg border border-purple-300"},Ho={class:"text-lg font-bold text-purple-700"},Go={class:"md:col-span-2"},Qo={class:"flex items-start gap-3 p-4 bg-white border-2 border-purple-200 rounded-lg cursor-pointer hover:bg-purple-50 hover:border-purple-300 transition-all"},Ko={key:0,class:"p-3 bg-white rounded-lg border border-purple-300"},Xo={class:"grid grid-cols-3 gap-2 text-xs"},Jo={class:"font-medium text-[#2D3748] ml-1"},Yo={class:"font-medium text-[#2D3748] ml-1"},Zo={class:"font-medium text-[#2D3748] ml-1"},Wo={class:"space-y-4 pt-4 border-t border-[#5550F2]/30"},ea={key:0,class:"bg-red-50 border border-red-200 rounded-lg p-4"},ta={class:"text-sm text-red-600"},oa={class:"sticky bottom-0 bg-gradient-to-r from-white/95 via-white/90 to-white/95 backdrop-blur-md pt-4 pb-2 border-t border-neutral-200 -mx-6 px-6 mt-6 shadow-sm"},aa={class:"flex justify-between items-center gap-3"},sa={class:"flex gap-3"},ra=["disabled"],na=["disabled"],la={key:0,class:"inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"},ia={key:1},da={__name:"ModalNuevoPaciente",props:{mostrar:{type:Boolean,default:!1}},emits:["cerrar","paciente-creado"],setup(I,{emit:A}){const f=I,B=A,{supabase:u,waitForUser:x,getUserId:_}=Se(),{crearBono:S}=Ye(),{crearCita:N}=Ze(),d=Xe(),r=j({nombre:"",apellido:"",email:"",telefono:"",fecha_nacimiento:"",tipo_bono:"",primera_sesion:"",activo:!0,notas_iniciales:"",crear_bono:!1,bono_monto:0,bono_renovacion_automatica:!1}),p=j(!1),V=j(""),H={otro:60,quincenal:100,semanal:160,mensual:180},D=T(()=>{const n=r.value.tipo_bono;return n&&{otro:1,quincenal:2,semanal:4,mensual:4}[n]||0}),$=T(()=>{const n=r.value.tipo_bono;return{otro:"A Demanda",quincenal:"Quincenal",semanal:"Semanal",mensual:"Mensual"}[n]||"No seleccionado"}),y=T(()=>{const n=D.value,t=r.value.bono_monto;return!n||!t||n<=0?"0.00":(t/n).toFixed(2)}),b=T(()=>{const n=r.value.tipo_bono;return n&&H[n]||0}),i=T(()=>r.value.tipo_bono==="otro"),g=T(()=>{const n=new Date,t=[],c=(Q,X)=>{const Y=Q.getFullYear(),oe=String(Q.getMonth()+1).padStart(2,"0"),te=String(Q.getDate()).padStart(2,"0");return`${Y}-${oe}-${te}T${X}`},C=new Date(n);C.setDate(C.getDate()+1),t.push({label:"üåÖ Ma√±ana 10:00",datetime:c(C,"10:00")});const v=new Date(n),U=(8-v.getDay())%7;v.setDate(v.getDate()+(U||7)),t.push({label:"üìÖ Pr√≥ximo Lun 09:00",datetime:c(v,"09:00")});const O=new Date(n);return O.setDate(O.getDate()+7),t.push({label:"üóìÔ∏è En 7 d√≠as 16:00",datetime:c(O,"16:00")}),t}),m=T(()=>{const n=r.value.nombre&&r.value.apellido&&r.value.email&&r.value.tipo_bono&&r.value.primera_sesion;return r.value.crear_bono?n&&r.value.bono_monto>0:n});ne(()=>r.value.tipo_bono,n=>{n==="otro"?(r.value.crear_bono=!1,r.value.bono_monto=0):r.value.crear_bono&&r.value.bono_monto===0&&(r.value.bono_monto=H[n]||0)}),ne(()=>r.value.crear_bono,n=>{n&&r.value.tipo_bono&&r.value.bono_monto===0&&(r.value.bono_monto=H[r.value.tipo_bono]||0)}),ne(()=>f.mostrar,n=>{n&&M()});const h=(n,t)=>{if(n.target&&n.target.showPicker)try{n.target.showPicker()}catch{console.log("showPicker no disponible")}else if(t){const c=document.getElementById(t);c&&(c.focus(),c.click())}},M=()=>{r.value={nombre:"",apellido:"",email:"",telefono:"",fecha_nacimiento:"",tipo_bono:"",primera_sesion:"",activo:!0,notas_iniciales:"",crear_bono:!1,bono_monto:0,bono_renovacion_automatica:!1},V.value=""},R=()=>{p.value||B("cerrar")},Z=async()=>{try{p.value=!0,V.value="",await x();const n=_();if(!n)throw new Error("Usuario no autenticado. Por favor, vuelve a iniciar sesi√≥n.");console.log("üÜï Creando nuevo paciente...");const t=`${r.value.nombre.trim()} ${r.value.apellido.trim()}`;console.log("üìù Llamando a crear_paciente_simple...");const{data:c,error:C}=await u.rpc("crear_paciente_simple",{p_email:r.value.email,p_nombre_completo:t,p_telefono:r.value.telefono||null,p_area_acompanamiento:null,p_tipo_bono:r.value.tipo_bono||null,p_terapeuta_id:n,p_metadata:{nombre:r.value.nombre,apellido:r.value.apellido,fecha_nacimiento:r.value.fecha_nacimiento,notas_iniciales:r.value.notas_iniciales,fecha_registro:new Date().toISOString(),primera_sesion:r.value.primera_sesion,estado_registro:"activo"}});if(C)throw console.error("‚ùå Error en RPC crear_paciente_simple:",C),new Error(`Error al crear paciente: ${C.message}`);if(!c||!c.id){const O="Error desconocido al crear paciente";throw console.error("‚ùå RPC devolvi√≥ resultado inv√°lido:",c),new Error(O)}console.log("‚úÖ Paciente creado exitosamente:",c);const v=c.id,U=null;if(r.value.crear_bono&&r.value.tipo_bono&&r.value.bono_monto)try{console.log("üí≥ Creando bono inicial ANTES de la cita...");const O=new Date().toISOString().split("T")[0];let Q=null;const X=r.value.tipo_bono;if(X==="otro"){const z=new Date;z.setMonth(z.getMonth()+1),Q=z.toISOString().split("T")[0]}else if(X==="quincenal"){const z=new Date;z.setDate(z.getDate()+15),Q=z.toISOString().split("T")[0]}else if(X==="semanal"){const z=new Date;z.setMonth(z.getMonth()+1),Q=z.toISOString().split("T")[0]}else if(X==="mensual"){const z=new Date;z.setMonth(z.getMonth()+1),Q=z.toISOString().split("T")[0]}const Y=D.value,oe={paciente_id:v,terapeuta_id:n,tipo:X,sesiones_totales:Y,sesiones_restantes:Y,fecha_inicio:O,fecha_fin:Q,estado:"pendiente",monto_total:r.value.bono_monto,precio_por_sesion:r.value.bono_monto/Y,pagado:!1,renovacion_automatica:r.value.bono_renovacion_automatica,notas:`Bono creado al registrar paciente. ${t}`,metadata:{creado_con_paciente:!0,fecha_creacion:new Date().toISOString()}};console.log("üì¶ Datos del bono a crear:",oe);const te=await S(oe);te&&console.log("‚úÖ Bono creado exitosamente:",te)}catch(O){console.error("‚ö†Ô∏è Error al crear bono:",O),V.value=`Paciente creado, pero hubo un error al crear el bono: ${O.message}`}if(r.value.primera_sesion)try{console.log("üìÖ Creando cita para primera sesi√≥n..."),console.log("üìã Datos del paciente:",{pacienteId:v,nombreCompleto:t,userId:n}),console.log("üìã Primera sesi√≥n:",r.value.primera_sesion);const[O,Q]=r.value.primera_sesion.split("T");console.log("üìã Fecha parseada:",O,"Hora parseada:",Q);const[X,Y]=Q.split(":").map(Number),oe=`${String(X+1).padStart(2,"0")}:${String(Y).padStart(2,"0")}`;console.log("üìã Hora inicio:",Q,"Hora fin:",oe);const te=await N({paciente_id:v,paciente_nombre:t,terapeuta_id:n,fecha:O,hora_inicio:Q,hora_fin:oe,modalidad:"online",estado:"pendiente",notas:`Primera sesi√≥n programada al registrar paciente: ${t}`,descontar_de_bono:!1});console.log("üìã Resultado completo de crearCita:",te),te.success?console.log("‚úÖ Cita de primera sesi√≥n creada exitosamente:",te.data):(console.error("‚ùå ERROR al crear la cita de primera sesi√≥n:",te.error),V.value=`Paciente creado, pero hubo un error al crear la cita: ${te.error}`)}catch(O){console.error("‚ùå EXCEPCI√ìN al crear cita de primera sesi√≥n:",O),V.value=`Paciente creado, pero hubo un error al crear la cita: ${O.message}`}if(r.value.notas_iniciales&&await u.from("notas_terapeuticas").insert({paciente_id:v,terapeuta_id:d.value.id,contenido:r.value.notas_iniciales,tipo:"evaluacion_inicial"}),r.value.crear_bono&&r.value.tipo_bono&&r.value.bono_monto)try{console.log("üí≥ Creando bono inicial...");const O=new Date().toISOString().split("T")[0];let Q=null;const X=r.value.tipo_bono;if(X==="otro"){const z=new Date;z.setMonth(z.getMonth()+1),Q=z.toISOString().split("T")[0]}else if(X==="quincenal"){const z=new Date;z.setDate(z.getDate()+15),Q=z.toISOString().split("T")[0]}else if(X==="semanal"){const z=new Date;z.setMonth(z.getMonth()+1),Q=z.toISOString().split("T")[0]}else if(X==="mensual"){const z=new Date;z.setMonth(z.getMonth()+1),Q=z.toISOString().split("T")[0]}const Y=D.value,oe={paciente_id:v,terapeuta_id:n,tipo:X,sesiones_totales:Y,sesiones_restantes:Y,fecha_inicio:O,fecha_fin:Q,estado:"pendiente",monto_total:r.value.bono_monto,precio_por_sesion:r.value.bono_monto/Y,pagado:!1,renovacion_automatica:r.value.bono_renovacion_automatica,notas:`Bono creado al registrar paciente. ${t}`,metadata:{creado_con_paciente:!0,fecha_creacion:new Date().toISOString()}};console.log("üì¶ Datos del bono a crear:",oe);const te=await S(oe);te&&console.log("‚úÖ Bono creado exitosamente:",te)}catch(O){console.error("‚ö†Ô∏è Error al crear bono:",O),V.value=`Paciente creado, pero hubo un error al crear el bono: ${O.message}`}B("paciente-creado",c),B("cerrar"),M()}catch(n){console.error("Error al crear paciente:",n),V.value=n.message||"Error al crear el paciente. Por favor, intenta nuevamente."}finally{p.value=!1}};return(n,t)=>I.mostrar?(a(),s("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:ae(R,["self"])},[e("div",vo,[e("div",{class:"sticky top-0 bg-gradient-to-r from-[#5550F2]/5 via-[#027368]/5 to-[#04BF9D]/5 backdrop-blur-md border-b border-neutral-200 px-6 py-4 flex justify-between items-center shadow-sm"},[t[16]||(t[16]=e("h2",{class:"text-2xl font-['Elms_Sans'] text-neutral-800 font-semibold"}," Nuevo Paciente ",-1)),e("button",{onClick:R,class:"text-neutral-600 hover:text-[#027368] transition-colors p-2 hover:bg-white/50 rounded-lg","aria-label":"Cerrar modal"},[...t[15]||(t[15]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("form",{onSubmit:ae(Z,["prevent"]),class:"px-6 py-6 space-y-6 bg-gradient-to-b from-white/50 to-transparent"},[e("div",xo,[t[24]||(t[24]=e("h3",{class:"text-lg font-['Elms_Sans'] text-neutral-800 font-semibold"}," Informaci√≥n Personal ",-1)),e("div",ho,[e("div",null,[t[17]||(t[17]=e("label",{for:"nombre",class:"block text-sm font-medium text-neutral-700 mb-1"},[P(" Nombre "),e("span",{class:"text-red-500"},"*")],-1)),G(e("input",{id:"nombre","onUpdate:modelValue":t[0]||(t[0]=c=>r.value.nombre=c),type:"text",required:"",class:"w-full px-4 py-2 border border-neutral-300 rounded-xl focus:ring-2 focus:ring-[#027368]/20 focus:border-[#027368] bg-white/90 backdrop-blur-sm transition-all shadow-sm",placeholder:"Nombre del paciente"},null,512),[[W,r.value.nombre]])]),e("div",null,[t[18]||(t[18]=e("label",{for:"apellido",class:"block text-sm font-medium text-neutral-700 mb-1"},[P(" Apellido "),e("span",{class:"text-red-500"},"*")],-1)),G(e("input",{id:"apellido","onUpdate:modelValue":t[1]||(t[1]=c=>r.value.apellido=c),type:"text",required:"",class:"w-full px-4 py-2 border border-neutral-300 rounded-xl focus:ring-2 focus:ring-[#027368]/20 focus:border-[#027368] bg-white/90 backdrop-blur-sm transition-all shadow-sm",placeholder:"Apellido(s) del paciente"},null,512),[[W,r.value.apellido]])]),e("div",null,[t[19]||(t[19]=e("label",{for:"email",class:"block text-sm font-medium text-neutral-700 mb-1"},[P(" Email "),e("span",{class:"text-red-500"},"*")],-1)),G(e("input",{id:"email","onUpdate:modelValue":t[2]||(t[2]=c=>r.value.email=c),type:"email",required:"",class:"w-full px-4 py-2 border border-neutral-300 rounded-xl focus:ring-2 focus:ring-[#027368]/20 focus:border-[#027368] bg-white/90 backdrop-blur-sm transition-all shadow-sm",placeholder:"correo@ejemplo.com"},null,512),[[W,r.value.email]])]),e("div",null,[t[20]||(t[20]=e("label",{for:"telefono",class:"block text-sm font-medium text-neutral-700 mb-1"}," Tel√©fono ",-1)),G(e("input",{id:"telefono","onUpdate:modelValue":t[3]||(t[3]=c=>r.value.telefono=c),type:"tel",class:"w-full px-4 py-2 border border-neutral-300 rounded-xl focus:ring-2 focus:ring-[#027368]/20 focus:border-[#027368] bg-white/90 backdrop-blur-sm transition-all shadow-sm",placeholder:"+52 123 456 7890"},null,512),[[W,r.value.telefono]])]),e("div",null,[t[22]||(t[22]=e("label",{for:"fecha_nacimiento",class:"block text-sm font-medium text-[#2D3748] mb-1"}," Fecha de Nacimiento ",-1)),e("div",yo,[G(e("input",{id:"fecha_nacimiento","onUpdate:modelValue":t[4]||(t[4]=c=>r.value.fecha_nacimiento=c),type:"date",class:"w-full px-4 py-2 pr-12 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white cursor-pointer",onFocus:t[5]||(t[5]=c=>h(c))},null,544),[[W,r.value.fecha_nacimiento]]),e("button",{type:"button",onClick:t[6]||(t[6]=c=>h(c,"fecha_nacimiento")),class:"absolute right-2 top-1/2 -translate-y-1/2 p-2 text-[#5550F2] hover:text-[#2D3748] transition-colors",title:"Abrir calendario"},[...t[21]||(t[21]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)])])]),t[23]||(t[23]=e("p",{class:"text-xs text-cafe/60 mt-1"}," üí° Puedes escribir la fecha o usar el calendario ",-1))])])]),e("div",_o,[t[31]||(t[31]=e("h3",{class:"text-lg font-['Elms_Sans'] text-neutral-800 font-semibold"}," Informaci√≥n Terap√©utica ",-1)),e("div",wo,[e("div",null,[t[26]||(t[26]=e("label",{for:"tipo_bono",class:"block text-sm font-medium text-[#2D3748] mb-1"},[P(" Tipo de Bono "),e("span",{class:"text-red-500"},"*")],-1)),G(e("select",{id:"tipo_bono","onUpdate:modelValue":t[7]||(t[7]=c=>r.value.tipo_bono=c),required:"",class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white"},[...t[25]||(t[25]=[He('<option value="">Selecciona tipo de bono</option><option value="otro">A Demanda (1 sesi√≥n - 60‚Ç¨ - sin compromiso)</option><option value="quincenal">Quincenal (2 sesiones/mes - 100‚Ç¨)</option><option value="semanal">Semanal (4 sesiones/mes - 160‚Ç¨)</option><option value="mensual">Mensual</option>',5)])],512),[[_e,r.value.tipo_bono]]),t[27]||(t[27]=e("p",{class:"text-xs text-cafe/60 mt-1"}," üé´ Define el tipo de bono del paciente ",-1))]),e("div",null,[t[29]||(t[29]=e("label",{for:"primera_sesion",class:"block text-sm font-medium text-[#2D3748] mb-1"},[P(" Primera Sesi√≥n "),e("span",{class:"text-red-500"},"*")],-1)),e("div",ko,[G(e("input",{id:"primera_sesion","onUpdate:modelValue":t[8]||(t[8]=c=>r.value.primera_sesion=c),type:"datetime-local",required:"",step:"1800",class:"w-full px-4 py-2 pr-12 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white cursor-pointer",onFocus:t[9]||(t[9]=c=>h(c))},null,544),[[W,r.value.primera_sesion]]),e("button",{type:"button",onClick:t[10]||(t[10]=c=>h(c,"primera_sesion")),class:"absolute right-2 top-1/2 -translate-y-1/2 p-2 text-[#5550F2] hover:text-[#2D3748] transition-colors",title:"Abrir selector de fecha y hora"},[...t[28]||(t[28]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)])])]),e("div",$o,[(a(!0),s(K,null,J(o(g),(c,C)=>(a(),s("button",{key:C,type:"button",onClick:v=>r.value.primera_sesion=c.datetime,class:q(["text-xs px-3 py-1.5 rounded-lg border transition-all",r.value.primera_sesion===c.datetime?"bg-[#5550F2] text-white border-[#5550F2] font-semibold":"bg-white text-[#2D3748] border-[#5550F2]/30 hover:border-[#5550F2] hover:bg-[#5550F2]/10"])},l(c.label),11,Co))),128))]),t[30]||(t[30]=e("p",{class:"text-xs text-cafe/60 mt-1"}," üí° Puedes escribir la fecha/hora o usar el selector ",-1))])])]),e("div",Do,[e("div",Eo,[t[33]||(t[33]=e("h3",{class:"text-lg font-serif text-[#2D3748] font-semibold mb-2"}," üí≥ Bono Inicial (Opcional) ",-1)),o(i)?(a(),s("div",So,[...t[32]||(t[32]=[e("div",{class:"flex items-start gap-3"},[e("span",{class:"text-2xl"},"‚ÑπÔ∏è"),e("div",null,[e("p",{class:"text-sm font-semibold text-amber-900 mb-1"},' Sesi√≥n "A Demanda" seleccionada '),e("p",{class:"text-sm text-amber-800"},[P(" Las sesiones a demanda son "),e("strong",null,"sin compromiso"),P(" y se pagan individualmente (60‚Ç¨ por sesi√≥n). No es necesario crear un bono prepagado. ")])])],-1)])])):(a(),s("p",Fo," Crea un bono prepagado para que el paciente empiece su tratamiento. Podr√°s confirmar el pago despu√©s. ")),e("label",{class:q(["flex items-center gap-3 p-3 rounded-lg transition-colors",o(i)?"bg-gray-100 border-2 border-gray-200 cursor-not-allowed opacity-60":"bg-purple-50 border-2 border-purple-200 cursor-pointer hover:bg-purple-100"])},[G(e("input",{"onUpdate:modelValue":t[11]||(t[11]=c=>r.value.crear_bono=c),type:"checkbox",disabled:o(i),class:"w-5 h-5 text-purple-600 border-gray-300 rounded focus:ring-purple-500 disabled:opacity-50 disabled:cursor-not-allowed"},null,8,Mo),[[ue,r.value.crear_bono]]),e("span",{class:q(["text-sm font-semibold",o(i)?"text-gray-500":"text-purple-700"])}," ‚úÖ S√≠, crear bono prepagado para este paciente ",2)],2)]),r.value.crear_bono?(a(),s("div",Po,[e("div",Io,[e("div",Ao,[t[38]||(t[38]=e("div",{class:"w-10 h-10 bg-purple-500 rounded-full flex items-center justify-center flex-shrink-0"},[e("span",{class:"text-white text-xl"},"üéüÔ∏è")],-1)),e("div",To,[e("h4",jo," Tipo de Bono: "+l(o($)||"Selecciona un tipo arriba"),1),e("div",Bo,[e("div",Vo,[t[34]||(t[34]=e("span",{class:"text-purple-600"},"üìä",-1)),e("span",zo,[e("strong",null,l(o(D)),1),P(" "+l(o(D)===1?"sesi√≥n":"sesiones"),1)])]),o(b)>0?(a(),s("div",qo,[t[36]||(t[36]=e("span",{class:"text-purple-600"},"üí∞",-1)),e("span",Ro,[t[35]||(t[35]=P(" Precio sugerido: ",-1)),e("strong",null,"‚Ç¨"+l(o(b)),1)])])):E("",!0)]),t[37]||(t[37]=e("p",{class:"text-xs text-purple-600 mt-2 bg-purple-50 p-2 rounded"},[P(" üí° "),e("strong",null,"Tip:"),P(" Los precios se calcular√°n autom√°ticamente seg√∫n el tipo de bono ")],-1))])])]),e("div",Oo,[e("div",null,[t[40]||(t[40]=e("label",{for:"bono_monto",class:"block text-sm font-medium text-[#2D3748] mb-1"},[P(" Monto Total "),e("span",{class:"text-red-500"},"*")],-1)),e("div",No,[t[39]||(t[39]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-[#2D3748]/60"},"‚Ç¨",-1)),G(e("input",{id:"bono_monto","onUpdate:modelValue":t[12]||(t[12]=c=>r.value.bono_monto=c),type:"number",min:"0",step:"0.01",required:r.value.crear_bono,placeholder:"0.00",class:"w-full pl-8 pr-4 py-2 border border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500 bg-white"},null,8,Uo),[[W,r.value.bono_monto,void 0,{number:!0}]])])]),e("div",null,[t[41]||(t[41]=e("label",{class:"block text-sm font-medium text-[#2D3748] mb-1"}," Precio por Sesi√≥n ",-1)),e("div",Lo,[e("span",Ho,"‚Ç¨"+l(o(y)),1)])]),e("div",Go,[e("label",Qo,[G(e("input",{"onUpdate:modelValue":t[13]||(t[13]=c=>r.value.bono_renovacion_automatica=c),type:"checkbox",class:"mt-1 w-5 h-5 text-purple-600 border-gray-300 rounded focus:ring-purple-500"},null,512),[[ue,r.value.bono_renovacion_automatica]]),t[42]||(t[42]=He('<div class="flex-1"><div class="flex items-center gap-2 mb-1"><span class="text-lg">üîÑ</span><span class="text-sm font-semibold text-purple-900"> Renovaci√≥n Autom√°tica </span><span class="ml-auto px-2 py-0.5 bg-purple-100 text-purple-700 text-xs font-medium rounded"> Recomendado </span></div><div class="text-xs text-[#2D3748]/70 space-y-1"><p>‚úì El bono se renovar√° autom√°ticamente cuando se agoten las sesiones o expire</p><p>‚úì Mantiene la continuidad del tratamiento sin interrupciones</p><p>‚úì Puedes desactivar la renovaci√≥n en cualquier momento</p></div></div>',1))])])]),o(D)>0&&r.value.bono_monto>0?(a(),s("div",Ko,[t[46]||(t[46]=e("div",{class:"text-xs font-medium text-purple-800 mb-2"},"üìã Resumen del Bono",-1)),e("div",Xo,[e("div",null,[t[43]||(t[43]=e("span",{class:"text-[#2D3748]/60"},"Tipo:",-1)),e("span",Jo,l(o($)),1)]),e("div",null,[t[44]||(t[44]=e("span",{class:"text-[#2D3748]/60"},"Sesiones:",-1)),e("span",Yo,l(o(D)),1)]),e("div",null,[t[45]||(t[45]=e("span",{class:"text-[#2D3748]/60"},"Total:",-1)),e("span",Zo,"‚Ç¨"+l(r.value.bono_monto),1)])])])):E("",!0)])):E("",!0)]),e("div",Wo,[t[48]||(t[48]=e("h3",{class:"text-lg font-serif text-[#2D3748] font-semibold"}," Notas Iniciales ",-1)),e("div",null,[t[47]||(t[47]=e("label",{for:"notas_iniciales",class:"block text-sm font-medium text-[#2D3748] mb-1"}," Observaciones (Opcional) ",-1)),G(e("textarea",{id:"notas_iniciales","onUpdate:modelValue":t[14]||(t[14]=c=>r.value.notas_iniciales=c),rows:"3",class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white resize-none",placeholder:"Observaciones iniciales, motivo de consulta, etc."},null,512),[[W,r.value.notas_iniciales]])])]),V.value?(a(),s("div",ea,[e("p",ta,l(V.value),1)])):E("",!0),e("div",oa,[e("div",aa,[t[49]||(t[49]=e("div",{class:"text-xs text-neutral-600"},[e("span",{class:"inline-block w-2 h-2 bg-red-500 rounded-full mr-1"}),P(" Los campos con * son obligatorios ")],-1)),e("div",sa,[e("button",{type:"button",onClick:R,disabled:p.value,class:"px-6 py-2.5 border-2 border-neutral-300 text-neutral-700 font-medium rounded-xl hover:bg-neutral-50 hover:border-[#027368] transition-all disabled:opacity-50 disabled:cursor-not-allowed"}," Cancelar ",8,ra),e("button",{type:"submit",disabled:p.value||!o(m),class:"px-8 py-2.5 bg-gradient-to-r from-[#04BF9D] to-[#027368] text-white font-semibold rounded-xl hover:from-[#027368] hover:to-[#04BF9D] transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 shadow-sm hover:shadow-md"},[p.value?(a(),s("span",la)):(a(),s("span",ia,"‚úì")),P(" "+l(p.value?"Creando paciente...":"Crear Paciente"),1)],8,na)])])])],32)])])):E("",!0)}},ca={class:"bg-[#F2F2F2] rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"},ua={class:"space-y-4"},pa={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ma={class:"space-y-4 pt-4 border-t border-[#5550F2]/30"},ba={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ga={class:"relative"},fa={class:"md:col-span-2 space-y-3"},va={class:"flex items-center gap-2 cursor-pointer"},xa={key:0,class:"bg-amber-50 border border-amber-200 rounded-lg p-4 space-y-3"},ha={class:"bg-white/80 rounded-lg p-3 border border-amber-100"},ya={class:"flex items-center justify-between mb-2"},_a={class:"w-full bg-gray-200 rounded-full h-2"},wa=["disabled"],ka={class:"space-y-4 pt-4 border-t border-[#5550F2]/30"},$a={key:0,class:"border-2 border-blue-400/40 rounded-lg p-4 space-y-4 bg-blue-50/30"},Ca={class:"flex items-center justify-between"},Da={class:"flex items-center gap-2"},Ea={class:"font-medium text-[#2D3748]"},Sa={class:"text-xs text-[#2D3748]/60"},Fa={class:"grid grid-cols-2 gap-4"},Ma={class:"px-4 py-2 bg-gray-100 border border-gray-300 rounded-lg text-[#2D3748] font-medium"},Pa=["max"],Ia={key:0,class:"text-amber-600 ml-1"},Aa={key:1,class:"bg-gray-50 border border-gray-200 rounded-lg p-4 text-center"},Ta={key:2,class:"flex items-center justify-center py-4"},ja={class:"flex items-center justify-between pt-2"},Ba={class:"flex items-center gap-2 cursor-pointer"},Va={key:3,class:"border-2 border-purple-400/40 rounded-lg p-4 space-y-4 bg-purple-50/30"},za={class:"bg-purple-100 border border-purple-300 rounded-lg p-3 flex items-start gap-2"},qa={class:"text-sm text-purple-800"},Ra={class:"font-medium"},Oa={class:"text-xs text-purple-700 mt-1"},Na={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ua={class:"relative"},La=["required"],Ha={class:"px-4 py-2 bg-purple-100 border-2 border-purple-300 rounded-lg text-purple-900 font-bold"},Ga={class:"md:col-span-2"},Qa={class:"flex items-center gap-2 cursor-pointer"},Ka={key:0,class:"bg-white border border-purple-300 rounded-lg p-4"},Xa={class:"text-sm text-cafe/80 space-y-1"},Ja={key:0,class:"text-purple-700"},Ya={key:0,class:"bg-red-50 border border-red-200 rounded-lg p-4"},Za={class:"text-sm text-red-600"},Wa={class:"flex justify-end gap-3 pt-4 border-t border-[#5550F2]/30"},es=["disabled"],ts=["disabled"],os={key:0,class:"inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"},as={__name:"ModalEditarPaciente",props:{mostrar:{type:Boolean,default:!1},paciente:{type:Object,default:null}},emits:["cerrar","paciente-actualizado"],setup(I,{emit:A}){const f=I,B=A,{supabase:u,userProfile:x}=Se(),{crearBono:_}=Ye(),{success:S,error:N}=$e(),d=j({nombre:"",apellido:"",email:"",telefono:"",fecha_nacimiento:"",tipo_bono:"",precio_sesion:null,activo:!0,en_pausa:!1,crear_bono:!1,bono_monto:null,bono_renovacion_automatica:!1,bono_sesiones_usadas:0}),r=j(null),p=j(!1),V=j(!1),H=T(()=>{if(!d.value.en_pausa)return 45;const t=(f.paciente?.metadata||{}).fecha_pausa;if(!t)return 45;const c=new Date(t),v=Math.floor((new Date().getTime()-c.getTime())/(1e3*60*60*24));return Math.max(0,45-v)}),D=async()=>{if(!f.paciente?.email){N("El paciente no tiene email registrado");return}V.value=!0;try{await new Promise(n=>setTimeout(n,1500)),S(`Recordatorio enviado a ${f.paciente.email}`)}catch(n){console.error("Error al enviar recordatorio:",n),N("No se pudo enviar el recordatorio")}finally{V.value=!1}},$=T(()=>r.value?Math.max(0,r.value.sesiones_totales-(d.value.bono_sesiones_usadas||0)):0),y=T(()=>{const n=d.value.tipo_bono;return n?{a_demanda:1,quincenal:2,semanal:4}[n]||0:"Selecciona tipo"}),b=T(()=>{const n=d.value.tipo_bono;return{a_demanda:"A Demanda",quincenal:"Quincenal",semanal:"Semanal"}[n]||""}),i=T(()=>{const n=y.value,t=d.value.bono_monto;return n==="Selecciona tipo"||!t||n<=0?"0.00":(t/n).toFixed(2)}),g=j(!1),m=j("");ne(()=>f.mostrar,n=>{n&&f.paciente&&h()});const h=async()=>{const n=f.paciente,t=n.metadata||{},C=(n.nombre_completo||n.nombre||"").split(" "),v=C[0]||t.nombre||"",U=C.slice(1).join(" ")||t.apellido||t.apellido_paterno||"";d.value={nombre:v,apellido:U,email:n.email||"",telefono:n.telefono||"",fecha_nacimiento:t.fecha_nacimiento||"",tipo_bono:n.tipo_bono||"",precio_sesion:n.precio_sesion||null,activo:n.activo??!0,en_pausa:n.en_pausa||t.en_pausa||!1,crear_bono:!1,bono_monto:null,bono_renovacion_automatica:!1,bono_sesiones_usadas:0},m.value="",await M()},M=async()=>{if(f.paciente?.id){p.value=!0,r.value=null;try{const{data:n,error:t}=await u.from("bonos").select("*").eq("paciente_id",f.paciente.id).in("estado",["activo","pendiente"]).order("created_at",{ascending:!1}).limit(1).single();n&&!t&&(r.value=n,d.value.bono_sesiones_usadas=n.sesiones_usadas||0)}catch{console.log("No se encontr√≥ bono activo para el paciente")}finally{p.value=!1}}},R=()=>{g.value||B("cerrar")},Z=async()=>{try{g.value=!0,m.value="",console.log("Actualizando paciente:",f.paciente.id);const n=`${d.value.nombre.trim()} ${d.value.apellido.trim()}`,t=f.paciente.metadata||{},c=t.en_pausa||!1;let C=t.fecha_pausa||null;d.value.en_pausa&&!c?C=new Date().toISOString():d.value.en_pausa||(C=null);const{data:v,error:U}=await u.from("pacientes").update({email:d.value.email,nombre_completo:n,telefono:d.value.telefono,tipo_bono:d.value.tipo_bono,precio_sesion:d.value.precio_sesion,activo:d.value.activo,en_pausa:d.value.en_pausa,metadata:{...t,nombre:d.value.nombre,apellido:d.value.apellido,fecha_nacimiento:d.value.fecha_nacimiento,en_pausa:d.value.en_pausa,fecha_pausa:C,fecha_actualizacion:new Date().toISOString()}}).eq("id",f.paciente.id).select().single();if(U)throw console.error("Error al actualizar paciente:",U),U;if(console.log("Paciente actualizado:",v),r.value&&d.value.bono_sesiones_usadas!==r.value.sesiones_usadas){console.log("Actualizando sesiones del bono...");const O=d.value.bono_sesiones_usadas||0,Q=r.value.sesiones_totales-O,X=Q<=0?"agotado":r.value.estado,{error:Y}=await u.from("bonos").update({sesiones_usadas:O,sesiones_restantes:Q,estado:X}).eq("id",r.value.id);if(Y)throw console.error("Error al actualizar bono:",Y),N("Error al actualizar las sesiones del bono"),new Error("Error al actualizar las sesiones del bono");console.log("Bono actualizado:",{sesiones_usadas:O,sesiones_restantes:Q}),S("Sesiones del bono actualizadas")}if(d.value.crear_bono&&d.value.tipo_bono&&d.value.bono_monto){console.log("[BONO] Iniciando creaci√≥n de bono para paciente:",f.paciente.id);const O=x.value?.id||f.paciente?.psicologa_id;if(!O)throw console.error("[BONO] ERROR: No se pudo obtener el ID del terapeuta"),new Error("No se pudo identificar al terapeuta para crear el bono");console.log("[BONO] Terapeuta ID:",O);const Q=new Date,X=new Date,Y=d.value.tipo_bono;Y==="a_demanda"?X.setMonth(X.getMonth()+1):Y==="quincenal"?X.setDate(X.getDate()+15):Y==="semanal"&&X.setMonth(X.getMonth()+1);const oe=y.value,te={paciente_id:f.paciente.id,terapeuta_id:O,tipo:Y,frecuencia:Y,sesiones_totales:oe,sesiones_restantes:oe,sesiones_usadas:0,monto_total:d.value.bono_monto,fecha_inicio:Q.toISOString().split("T")[0],fecha_fin:X.toISOString().split("T")[0],estado:"activo",pagado:!1,renovacion_automatica:d.value.bono_renovacion_automatica};console.log("[BONO] Datos del bono a crear:",te);try{const z=await _(te);console.log("[BONO] Bono creado exitosamente:",z),S("Bono creado correctamente")}catch(z){console.error("[BONO] Error al crear bono:",z),N("Error al crear el bono: "+(z.message||"Error desconocido"))}}S("Paciente actualizado correctamente"),B("paciente-actualizado",v),B("cerrar")}catch(n){console.error("Error al actualizar paciente:",n),m.value=n.message||"Error al actualizar el paciente. Por favor, intenta nuevamente."}finally{g.value=!1}};return(n,t)=>I.mostrar?(a(),s("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:ae(R,["self"])},[e("div",ca,[e("div",{class:"sticky top-0 bg-[#F2F2F2] border-b border-[#5550F2]/30 px-6 py-4 flex justify-between items-center"},[t[14]||(t[14]=e("h2",{class:"text-2xl font-serif text-[#2D3748] font-semibold"}," Editar Paciente ",-1)),e("button",{onClick:R,class:"text-[#2D3748] hover:text-[#5550F2] transition-colors","aria-label":"Cerrar modal"},[...t[13]||(t[13]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("form",{onSubmit:ae(Z,["prevent"]),class:"px-6 py-6 space-y-6"},[e("div",ua,[t[20]||(t[20]=e("h3",{class:"text-lg font-serif text-[#2D3748] font-semibold"}," Informaci√≥n Personal ",-1)),e("div",pa,[e("div",null,[t[15]||(t[15]=e("label",{for:"nombre",class:"block text-sm font-medium text-[#2D3748] mb-1"},[P(" Nombre "),e("span",{class:"text-red-500"},"*")],-1)),G(e("input",{id:"nombre","onUpdate:modelValue":t[0]||(t[0]=c=>d.value.nombre=c),type:"text",required:"",class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white",placeholder:"Nombre del paciente"},null,512),[[W,d.value.nombre]])]),e("div",null,[t[16]||(t[16]=e("label",{for:"apellido",class:"block text-sm font-medium text-[#2D3748] mb-1"},[P(" Apellido "),e("span",{class:"text-red-500"},"*")],-1)),G(e("input",{id:"apellido","onUpdate:modelValue":t[1]||(t[1]=c=>d.value.apellido=c),type:"text",required:"",class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white",placeholder:"Apellido(s) del paciente"},null,512),[[W,d.value.apellido]])]),e("div",null,[t[17]||(t[17]=e("label",{for:"email",class:"block text-sm font-medium text-[#2D3748] mb-1"},[P(" Email "),e("span",{class:"text-red-500"},"*")],-1)),G(e("input",{id:"email","onUpdate:modelValue":t[2]||(t[2]=c=>d.value.email=c),type:"email",required:"",class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white",placeholder:"correo@ejemplo.com"},null,512),[[W,d.value.email]])]),e("div",null,[t[18]||(t[18]=e("label",{for:"telefono",class:"block text-sm font-medium text-[#2D3748] mb-1"}," Tel√©fono ",-1)),G(e("input",{id:"telefono","onUpdate:modelValue":t[3]||(t[3]=c=>d.value.telefono=c),type:"tel",class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white",placeholder:"+52 123 456 7890"},null,512),[[W,d.value.telefono]])]),e("div",null,[t[19]||(t[19]=e("label",{for:"fecha_nacimiento",class:"block text-sm font-medium text-[#2D3748] mb-1"}," Fecha de Nacimiento ",-1)),G(e("input",{id:"fecha_nacimiento","onUpdate:modelValue":t[4]||(t[4]=c=>d.value.fecha_nacimiento=c),type:"date",class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white"},null,512),[[W,d.value.fecha_nacimiento]])])])]),e("div",ma,[t[36]||(t[36]=e("h3",{class:"text-lg font-serif text-[#2D3748] font-semibold"}," Informaci√≥n Terap√©utica ",-1)),e("div",ba,[e("div",null,[t[22]||(t[22]=e("label",{for:"tipo_bono",class:"block text-sm font-medium text-[#2D3748] mb-1"},[P(" Tipo de Bono "),e("span",{class:"text-red-500"},"*")],-1)),G(e("select",{id:"tipo_bono","onUpdate:modelValue":t[5]||(t[5]=c=>d.value.tipo_bono=c),required:"",class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white"},[...t[21]||(t[21]=[e("option",{value:""},"Selecciona tipo de bono",-1),e("option",{value:"a_demanda"},"A Demanda (1 sesi√≥n)",-1),e("option",{value:"quincenal"},"Quincenal (2 sesiones/mes)",-1),e("option",{value:"semanal"},"Semanal (4 sesiones/mes)",-1)])],512),[[_e,d.value.tipo_bono]])]),e("div",null,[t[24]||(t[24]=e("label",{for:"precio_sesion",class:"block text-sm font-medium text-[#2D3748] mb-1"}," Precio por Sesi√≥n (‚Ç¨) ",-1)),e("div",ga,[t[23]||(t[23]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-[#2D3748]/60"},"‚Ç¨",-1)),G(e("input",{id:"precio_sesion","onUpdate:modelValue":t[6]||(t[6]=c=>d.value.precio_sesion=c),type:"number",min:"0",step:"0.01",placeholder:"Usar precio del terapeuta",class:"w-full pl-8 pr-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white"},null,512),[[W,d.value.precio_sesion,void 0,{number:!0}]])]),t[25]||(t[25]=e("p",{class:"text-xs text-[#2D3748]/60 mt-1"}," üí° Precio personalizado para este paciente. Si est√° vac√≠o, se usa el precio seg√∫n frecuencia del terapeuta. ",-1))]),e("div",null,[t[27]||(t[27]=e("label",{for:"activo",class:"block text-sm font-medium text-[#2D3748] mb-1"}," Estado ",-1)),G(e("select",{id:"activo","onUpdate:modelValue":t[7]||(t[7]=c=>d.value.activo=c),class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white"},[...t[26]||(t[26]=[e("option",{value:!0},"Activo",-1),e("option",{value:!1},"Inactivo",-1)])],512),[[_e,d.value.activo]])]),e("div",fa,[e("label",va,[G(e("input",{"onUpdate:modelValue":t[8]||(t[8]=c=>d.value.en_pausa=c),type:"checkbox",class:"w-4 h-4 text-amber-500 border-gray-300 rounded focus:ring-amber-500"},null,512),[[ue,d.value.en_pausa]]),t[28]||(t[28]=e("span",{class:"text-sm font-medium text-[#2D3748]"}," Proceso en pausa temporal ",-1))]),d.value.en_pausa?(a(),s("div",xa,[t[34]||(t[34]=e("div",{class:"flex items-start gap-3"},[e("span",{class:"text-2xl"},"‚è∏Ô∏è"),e("div",null,[e("p",{class:"font-medium text-amber-800"},"Cuenta en pausa temporal"),e("p",{class:"text-sm text-amber-700 mt-1"},[P(" El proceso terapeutico esta pausado. El paciente mantendra su espacio reservado durante "),e("strong",null,"45 dias"),P(". ")])])],-1)),e("div",ha,[e("div",ya,[t[29]||(t[29]=e("span",{class:"text-sm font-medium text-gray-700"},"Dias restantes:",-1)),e("span",{class:q(["text-lg font-bold",H.value<=7?"text-red-600":"text-amber-600"])},l(H.value)+" dias ",3)]),e("div",_a,[e("div",{class:q(["h-2 rounded-full transition-all",H.value<=7?"bg-red-500":"bg-amber-500"]),style:Ke({width:`${Math.max(0,H.value/45*100)}%`})},null,6)])]),t[35]||(t[35]=e("div",{class:"text-xs text-amber-800 space-y-2 bg-amber-100/50 rounded p-3"},[e("p",{class:"font-medium flex items-center gap-1"},[e("span",null,"‚ö†Ô∏è"),P(" Importante: ")]),e("ul",{class:"list-disc list-inside space-y-1 text-amber-700"},[e("li",null,[P("Pasados los 45 dias, el perfil se "),e("strong",null,"desactivara automaticamente")]),e("li",null,"Se liberara su espacio en la agenda de Psicologa Karem"),e("li",null,[P("Los datos se eliminaran conforme al "),e("strong",null,"reglamento de proteccion de datos"),P(" para garantizar su privacidad")]),e("li",null,"Al reactivar, los precios de las sesiones podrian haberse modificado")])],-1)),e("button",{type:"button",onClick:D,disabled:V.value,class:"w-full py-2 px-4 bg-amber-600 text-white text-sm font-medium rounded-lg hover:bg-amber-700 disabled:opacity-50 transition-colors flex items-center justify-center gap-2"},[V.value?(a(),s(K,{key:0},[t[30]||(t[30]=e("span",{class:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"},null,-1)),t[31]||(t[31]=P(" Enviando... ",-1))],64)):(a(),s(K,{key:1},[t[32]||(t[32]=e("span",null,"üìß",-1)),t[33]||(t[33]=P(" Enviar recordatorio al paciente ",-1))],64))],8,wa)])):E("",!0)])])]),e("div",ka,[t[61]||(t[61]=e("h3",{class:"text-lg font-serif text-[#2D3748] font-semibold"}," Gesti√≥n de Bonos ",-1)),r.value?(a(),s("div",$a,[e("div",Ca,[e("div",Da,[t[38]||(t[38]=e("span",{class:"text-xl"},"üé´",-1)),e("div",null,[e("p",Ea,"Bono "+l(r.value.tipo||"Activo"),1),e("p",Sa,[t[37]||(t[37]=P(" Estado: ",-1)),e("span",{class:q([r.value.estado==="activo"?"text-green-600":"text-amber-600","font-medium capitalize"])},l(r.value.estado),3)])])]),e("span",{class:q(["px-2 py-1 text-xs font-medium rounded-full",r.value.estado==="activo"?"bg-green-100 text-green-700":"bg-amber-100 text-amber-700"])},l(r.value.sesiones_restantes)+"/"+l(r.value.sesiones_totales)+" restantes ",3)]),e("div",Fa,[e("div",null,[t[39]||(t[39]=e("label",{class:"block text-sm font-medium text-[#2D3748] mb-1"}," Sesiones Totales ",-1)),e("div",Ma,l(r.value.sesiones_totales),1)]),e("div",null,[t[40]||(t[40]=e("label",{for:"sesiones_usadas_bono",class:"block text-sm font-medium text-[#2D3748] mb-1"}," Sesiones Consumidas ",-1)),G(e("input",{id:"sesiones_usadas_bono","onUpdate:modelValue":t[9]||(t[9]=c=>d.value.bono_sesiones_usadas=c),type:"number",min:"0",max:r.value.sesiones_totales,class:"w-full px-4 py-2 border border-blue-400/50 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white"},null,8,Pa),[[W,d.value.bono_sesiones_usadas,void 0,{number:!0}]])])]),e("div",{class:q(["flex items-center gap-2 p-3 rounded-lg",$.value<=0?"bg-red-50 border border-red-200":"bg-blue-50 border border-blue-200"])},[e("span",{class:q($.value<=0?"text-red-600":"text-blue-600")},l($.value<=0?"‚ö†Ô∏è":"‚ÑπÔ∏è"),3),e("p",{class:q(["text-sm",$.value<=0?"text-red-800":"text-blue-800"])},[e("strong",null,l($.value),1),P(" de "+l(r.value.sesiones_totales)+" sesiones disponibles ",1),d.value.bono_sesiones_usadas!==r.value.sesiones_usadas?(a(),s("span",Ia," (modificado) ")):E("",!0)],2)],2),t[41]||(t[41]=e("p",{class:"text-xs text-[#2D3748]/60"}," üí° Ajusta las sesiones consumidas para sincronizar con datos de otra plataforma o corregir errores. ",-1))])):p.value?E("",!0):(a(),s("div",Aa,[...t[42]||(t[42]=[e("p",{class:"text-sm text-[#2D3748]/70"}," Este paciente no tiene un bono activo. ",-1)])])),p.value?(a(),s("div",Ta,[...t[43]||(t[43]=[e("div",{class:"w-5 h-5 border-2 border-blue-200 border-t-blue-600 rounded-full animate-spin mr-2"},null,-1),e("span",{class:"text-sm text-[#2D3748]/60"},"Cargando bono...",-1)])])):E("",!0),e("div",ja,[e("label",Ba,[G(e("input",{"onUpdate:modelValue":t[10]||(t[10]=c=>d.value.crear_bono=c),type:"checkbox",class:"w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500"},null,512),[[ue,d.value.crear_bono]]),t[44]||(t[44]=e("span",{class:"text-sm font-medium text-[#2D3748]"}," üé´ Crear nuevo bono para este paciente ",-1))])]),d.value.crear_bono?(a(),s("div",Va,[e("div",za,[t[46]||(t[46]=e("svg",{class:"w-5 h-5 text-purple-600 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})],-1)),e("div",qa,[e("p",Ra,[t[45]||(t[45]=P("El bono usar√° el tipo seleccionado arriba: ",-1)),e("strong",null,l(b.value||"Selecciona un tipo primero"),1)]),e("p",Oa," Sesiones incluidas: "+l(y.value==="Selecciona tipo"?"N/A":y.value),1)])]),e("div",Na,[e("div",null,[t[48]||(t[48]=e("label",{for:"bono_monto",class:"block text-sm font-medium text-[#2D3748] mb-1"},[P(" Monto Total "),e("span",{class:"text-red-500"},"*")],-1)),e("div",Ua,[t[47]||(t[47]=e("span",{class:"absolute left-3 top-2.5 text-[#2D3748] font-medium"},"‚Ç¨",-1)),G(e("input",{id:"bono_monto","onUpdate:modelValue":t[11]||(t[11]=c=>d.value.bono_monto=c),type:"number",min:"0",step:"0.01",required:d.value.crear_bono,class:"w-full pl-8 pr-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white",placeholder:"0.00"},null,8,La),[[W,d.value.bono_monto,void 0,{number:!0}]])])]),e("div",null,[t[49]||(t[49]=e("label",{class:"block text-sm font-medium text-[#2D3748] mb-1"}," Precio por Sesi√≥n ",-1)),e("div",Ha," ‚Ç¨"+l(i.value),1)]),e("div",Ga,[e("label",Qa,[G(e("input",{"onUpdate:modelValue":t[12]||(t[12]=c=>d.value.bono_renovacion_automatica=c),type:"checkbox",class:"w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500"},null,512),[[ue,d.value.bono_renovacion_automatica]]),t[50]||(t[50]=e("span",{class:"text-sm font-medium text-[#2D3748]"}," üîÑ Renovaci√≥n autom√°tica al vencer ",-1))]),t[51]||(t[51]=e("p",{class:"text-xs text-cafe/60 mt-1 ml-6"}," El sistema crear√° un nuevo bono id√©ntico cuando este expire ",-1))])]),y.value&&d.value.bono_monto?(a(),s("div",Ka,[t[60]||(t[60]=e("p",{class:"text-sm font-medium text-[#2D3748] mb-2"},"üìã Resumen del Bono:",-1)),e("div",Xa,[e("p",null,[t[52]||(t[52]=P("‚Ä¢ ",-1)),t[53]||(t[53]=e("strong",null,"Tipo:",-1)),P(" "+l(b.value),1)]),e("p",null,[t[54]||(t[54]=P("‚Ä¢ ",-1)),t[55]||(t[55]=e("strong",null,"Sesiones:",-1)),P(" "+l(y.value),1)]),e("p",null,[t[56]||(t[56]=P("‚Ä¢ ",-1)),t[57]||(t[57]=e("strong",null,"Total:",-1)),P(" ‚Ç¨"+l(d.value.bono_monto.toFixed(2)),1)]),e("p",null,[t[58]||(t[58]=P("‚Ä¢ ",-1)),t[59]||(t[59]=e("strong",null,"Por sesi√≥n:",-1)),P(" ‚Ç¨"+l(i.value),1)]),d.value.bono_renovacion_automatica?(a(),s("p",Ja,"‚Ä¢ ‚úÖ Con renovaci√≥n autom√°tica")):E("",!0)])])):E("",!0)])):E("",!0)]),m.value?(a(),s("div",Ya,[e("p",Za,l(m.value),1)])):E("",!0),e("div",Wa,[e("button",{type:"button",onClick:R,disabled:g.value,class:"px-6 py-2 border border-[#5550F2] text-[#2D3748] rounded-lg hover:bg-[#5550F2]/10 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"}," Cancelar ",8,es),e("button",{type:"submit",disabled:g.value,class:"px-6 py-2 bg-[#5550F2] text-white rounded-lg hover:bg-[#C69F91] transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"},[g.value?(a(),s("span",os)):E("",!0),P(" "+l(g.value?"Actualizando...":"Guardar Cambios"),1)],8,ts)])],32)])])):E("",!0)}},ss=pe(as,[["__scopeId","data-v-b27bd45f"]]),rs={class:"bg-[#F2F2F2] rounded-lg shadow-xl max-w-md w-full"},ns={class:"px-6 py-6 space-y-4"},ls={class:"text-[#2D3748]"},is={class:"font-semibold"},ds={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},cs=["disabled"],us={key:0,class:"bg-red-50 border border-red-200 rounded-lg p-3"},ps={class:"text-sm text-red-600"},ms={class:"px-6 py-4 border-t border-[#5550F2]/30 flex justify-end gap-3"},bs=["disabled"],gs=["disabled"],fs={key:0,class:"inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"},vs={__name:"ModalEliminarPaciente",props:{mostrar:{type:Boolean,default:!1},paciente:{type:Object,default:null}},emits:["cerrar","paciente-eliminado","paciente-desactivado"],setup(I,{emit:A}){const f=I,B=A,{supabase:u}=Se(),x=j(!1),_=j(""),S=T(()=>f.paciente?f.paciente.nombre_completo||f.paciente.nombre||f.paciente.email||"este paciente":""),N=()=>{x.value||(_.value="",B("cerrar"))},d=async()=>{try{x.value=!0,_.value="",console.log("Desactivando paciente:",f.paciente.id);const{error:p}=await u.from("pacientes").update({activo:!1,metadata:{...f.paciente.metadata,fecha_desactivacion:new Date().toISOString()}}).eq("id",f.paciente.id);if(p)throw p;console.log("Paciente desactivado exitosamente"),B("paciente-desactivado",f.paciente.id),B("cerrar")}catch(p){console.error("Error al desactivar paciente:",p),_.value=p.message||"Error al desactivar el paciente."}finally{x.value=!1}},r=async()=>{try{x.value=!0,_.value="",console.log("Eliminando paciente:",f.paciente.id),await u.from("metricas_bienestar").delete().eq("paciente_id",f.paciente.id),await u.from("notas_terapeuticas").delete().eq("paciente_id",f.paciente.id),await u.from("recursos_compartidos").delete().eq("paciente_id",f.paciente.id),await u.from("mensajes").delete().or(`remitente_id.eq.${f.paciente.id},destinatario_id.eq.${f.paciente.id}`),await u.from("bonos").delete().eq("paciente_id",f.paciente.id),await u.from("sesiones").delete().eq("paciente_id",f.paciente.id);const{error:p}=await u.from("pacientes").delete().eq("id",f.paciente.id);if(p)throw p;console.log("Paciente eliminado exitosamente"),B("paciente-eliminado",f.paciente.id),B("cerrar")}catch(p){console.error("Error al eliminar paciente:",p),_.value=p.message||"Error al eliminar el paciente. Por favor, intenta nuevamente."}finally{x.value=!1}};return(p,V)=>I.mostrar?(a(),s("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:ae(N,["self"])},[e("div",rs,[V[5]||(V[5]=e("div",{class:"px-6 py-4 border-b border-[#5550F2]/30"},[e("div",{class:"flex items-center gap-3"},[e("span",{class:"text-3xl"},"‚ö†Ô∏è"),e("h2",{class:"text-2xl font-serif text-[#2D3748] font-semibold"}," Eliminar Paciente ")])],-1)),e("div",ns,[e("p",ls,[V[0]||(V[0]=P(" ¬øEst√°s seguro de que deseas eliminar a ",-1)),e("strong",is,l(S.value),1),V[1]||(V[1]=P("? ",-1))]),V[4]||(V[4]=e("div",{class:"bg-red-50 border border-red-200 rounded-lg p-4 space-y-2"},[e("p",{class:"text-sm text-red-800 font-medium"}," Esta acci√≥n no se puede deshacer y eliminar√°: "),e("ul",{class:"text-sm text-red-700 space-y-1 ml-4 list-disc"},[e("li",null,"Todos los datos personales del paciente"),e("li",null,"El historial de sesiones"),e("li",null,"Las notas terap√©uticas"),e("li",null,"Las m√©tricas de bienestar"),e("li",null,"Los bonos asociados")])],-1)),e("div",ds,[V[2]||(V[2]=e("p",{class:"text-sm text-blue-800 font-medium mb-2"}," üí° Recomendaci√≥n: ",-1)),V[3]||(V[3]=e("p",{class:"text-sm text-blue-700 mb-3"},[P(" En lugar de eliminar, considera "),e("strong",null,"desactivar"),P(" al paciente. Esto preservar√° el historial para consultas futuras. ")],-1)),e("button",{type:"button",onClick:d,disabled:x.value,class:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-sm"}," Desactivar en lugar de eliminar ",8,cs)]),_.value?(a(),s("div",us,[e("p",ps,l(_.value),1)])):E("",!0)]),e("div",ms,[e("button",{type:"button",onClick:N,disabled:x.value,class:"px-6 py-2 border border-[#5550F2] text-[#2D3748] rounded-lg hover:bg-[#5550F2]/10 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"}," Cancelar ",8,bs),e("button",{type:"button",onClick:r,disabled:x.value,class:"px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"},[x.value?(a(),s("span",fs)):E("",!0),P(" "+l(x.value?"Eliminando...":"Eliminar Definitivamente"),1)],8,gs)])])])):E("",!0)}},xs=pe(vs,[["__scopeId","data-v-941153fc"]]),hs={class:"bg-white dark:bg-gray-900 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden"},ys={class:"px-6 py-4 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20"},_s={key:0,class:"text-sm text-gray-600 dark:text-gray-400 mt-1"},ws={key:0,class:"p-12 flex flex-col items-center justify-center"},ks={class:"space-y-6"},$s={class:"space-y-2"},Cs={class:"flex gap-2 flex-wrap"},Ds=["onClick"],Es={class:"text-xs text-gray-500 dark:text-gray-400 capitalize"},Ss={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Fs={class:"md:col-span-2"},Ms={class:"space-y-3"},Ps={class:"grid grid-cols-4 sm:grid-cols-6 gap-2 max-h-48 overflow-y-auto p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg border border-gray-200 dark:border-gray-700"},Is=["onClick"],As={class:"text-xs"},Ts={class:"mt-2"},js={key:0,class:"p-4 bg-yellow-50 dark:bg-yellow-900/20 border-2 border-yellow-300 dark:border-yellow-700 rounded-lg"},Bs={class:"grid grid-cols-3 gap-3"},Vs=["onClick"],zs={class:"text-2xl mb-1"},qs={class:"text-sm font-medium text-gray-900 dark:text-white"},Rs={class:"grid grid-cols-2 md:grid-cols-4 gap-3"},Os=["onClick"],Ns={class:"text-xl mb-1"},Us={class:"text-xs font-medium text-gray-900 dark:text-white"},Ls={class:"px-6 py-4 border-t border-gray-200 dark:border-gray-800 flex gap-3 bg-gray-50 dark:bg-gray-800"},Hs=["disabled"],Gs={key:0},Qs={key:1},Ks=ke({__name:"ModalEditarCita",props:{isOpen:{type:Boolean},citaId:{}},emits:["close","actualizado"],setup(I,{emit:A}){const f=I,B=A,u=Je(),{actualizarCita:x,getCitasPorDia:_}=Ze(),S=j(null),N=j(!1),d=j(!1),r=j(!1),p=j({fecha_cita:"",hora_inicio:"",hora_fin:"",duracion:60,modalidad:"presencial",estado:"pendiente",observaciones:""}),V=T(()=>p.value.fecha_cita?new Date(p.value.fecha_cita+"T00:00:00").toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long",year:"numeric"}):""),H=T(()=>{const m=new Date,h=[],M=c=>c.toISOString().split("T")[0];h.push({label:"Hoy",fecha:M(m)});const R=new Date(m);R.setDate(R.getDate()+1),h.push({label:"Ma√±ana",fecha:M(R)});const Z=["Lun","Mar","Mi√©","Jue","Vie"];let n=new Date(m),t=0;for(;t<5;){n.setDate(n.getDate()+1);const c=n.getDay();c>=1&&c<=5&&(h.push({label:`${Z[c-1]} ${n.getDate()}`,fecha:M(n)}),t++)}return h}),D=["08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00","18:30","19:00","19:30","20:00","20:30","21:00","21:30","22:00"],$=async()=>{if(console.log("üîç [ModalEditarCita] Cargando cita con ID:",f.citaId),!f.citaId){console.warn("‚ö†Ô∏è [ModalEditarCita] No hay citaId proporcionado");return}try{N.value=!0;const{data:m,error:h}=await u.from("citas").select(`
        *,
        paciente:pacientes!citas_paciente_id_fkey (
          id,
          nombre_completo,
          email,
          telefono
        )
      `).eq("id",f.citaId).single();if(h)throw console.error("‚ùå [ModalEditarCita] Error en query:",h),h;console.log("‚úÖ [ModalEditarCita] Cita cargada:",m),m&&(S.value=m,p.value={fecha_cita:m.fecha_cita,hora_inicio:m.hora_inicio?.substring(0,5)||"",hora_fin:m.hora_fin?.substring(0,5)||"",duracion:m.duracion||60,modalidad:m.modalidad||"presencial",estado:m.estado||"pendiente",observaciones:m.observaciones||""},console.log("üìù [ModalEditarCita] Formulario llenado:",p.value))}catch(m){console.error("üí• [ModalEditarCita] Error al cargar cita:",m)}finally{N.value=!1}},y=async()=>{if(!p.value.fecha_cita||!p.value.hora_inicio||!p.value.hora_fin){r.value=!1;return}try{const h=(await _(p.value.fecha_cita)).filter(Z=>Z.estado!=="cancelada"&&Z.id!==f.citaId),M=p.value.hora_inicio,R=p.value.hora_fin;r.value=h.some(Z=>{const n=Z.hora_inicio?.substring(0,5),t=Z.hora_fin?.substring(0,5),c=b(M),C=b(R),v=b(n),U=b(t);return c>=v&&c<U||C>v&&C<=U||c<=v&&C>=U})}catch(m){console.error("Error al verificar conflicto:",m),r.value=!1}},b=m=>{if(!m||!m.includes(":"))return 0;const[h,M]=m.split(":").map(Number);return(h||0)*60+(M||0)};ne(()=>p.value.hora_inicio,m=>{if(m&&p.value.duracion){const[h,M]=m.split(":").map(Number),R=(h||0)*60+(M||0)+p.value.duracion,Z=Math.floor(R/60),n=R%60;p.value.hora_fin=`${String(Z).padStart(2,"0")}:${String(n).padStart(2,"0")}`}}),ne(()=>p.value.duracion,m=>{if(p.value.hora_inicio&&m){const[h,M]=p.value.hora_inicio.split(":").map(Number),R=(h||0)*60+(M||0)+m,Z=Math.floor(R/60),n=R%60;p.value.hora_fin=`${String(Z).padStart(2,"0")}:${String(n).padStart(2,"0")}`}}),ne([()=>p.value.fecha_cita,()=>p.value.hora_inicio,()=>p.value.hora_fin],()=>{y()});const i=async()=>{if(f.citaId&&(await y(),!r.value))try{d.value=!0,(await x(f.citaId,{fecha_cita:p.value.fecha_cita,hora_inicio:p.value.hora_inicio,hora_fin:p.value.hora_fin,modalidad:p.value.modalidad,estado:p.value.estado,observaciones:p.value.observaciones})).success&&(B("actualizado"),B("close"))}catch(m){console.error("Error al actualizar cita:",m)}finally{d.value=!1}},g=()=>{B("close")};return ne(()=>f.isOpen,m=>{console.log("üëÅÔ∏è [ModalEditarCita] Modal abierto:",m,"citaId:",f.citaId),m&&f.citaId&&$()}),ne(()=>f.citaId,m=>{console.log("üîÑ [ModalEditarCita] citaId cambi√≥ a:",m),f.isOpen&&m&&$()}),(m,h)=>(a(),se(Ae,{to:"body"},[I.isOpen?(a(),s("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:ae(g,["self"])},[e("div",hs,[e("div",ys,[e("div",null,[h[5]||(h[5]=e("h2",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"‚úèÔ∏è Editar Cita",-1)),S.value?(a(),s("p",_s,l(S.value.paciente?.nombre_completo||S.value.paciente_nombre),1)):E("",!0)]),e("button",{onClick:g,class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors","aria-label":"Cerrar"},[...h[6]||(h[6]=[e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),N.value?(a(),s("div",ws,[...h[7]||(h[7]=[e("div",{class:"w-12 h-12 border-4 border-purple-200 border-t-purple-600 rounded-full animate-spin mb-4"},null,-1),e("p",{class:"text-gray-600 dark:text-gray-400"},"Cargando...",-1)])])):S.value?(a(),s("form",{key:1,onSubmit:ae(i,["prevent"]),class:"px-6 py-4 overflow-y-auto max-h-[calc(90vh-200px)]"},[e("div",ks,[e("div",null,[h[8]||(h[8]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," üìÖ Fecha ",-1)),e("div",$s,[G(e("input",{"onUpdate:modelValue":h[0]||(h[0]=M=>p.value.fecha_cita=M),type:"date",required:"",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-800 dark:text-white cursor-pointer"},null,512),[[W,p.value.fecha_cita]]),e("div",Cs,[(a(!0),s(K,null,J(H.value,(M,R)=>(a(),s("button",{key:R,type:"button",onClick:Z=>M.fecha&&(p.value.fecha_cita=M.fecha),class:q(["text-xs px-3 py-1.5 rounded-lg border transition-all",p.value.fecha_cita===M.fecha?"bg-purple-600 text-white border-purple-600 font-semibold":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 border-gray-300 dark:border-gray-600 hover:border-purple-500 hover:bg-purple-50 dark:hover:bg-purple-900/20"])},l(M.label),11,Ds))),128))]),e("p",Es,l(V.value),1)])]),e("div",Ss,[e("div",Fs,[h[10]||(h[10]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," üïê Hora Inicio ",-1)),e("div",Ms,[e("div",Ps,[(a(),s(K,null,J(D,M=>e("button",{key:M,type:"button",onClick:R=>p.value.hora_inicio=M,class:q(["px-3 py-2 text-sm font-medium rounded-lg transition-all border-2",p.value.hora_inicio===M?"bg-purple-600 text-white border-purple-600 shadow-md transform scale-105":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 border-gray-200 dark:border-gray-600 hover:border-purple-500 hover:bg-purple-50 dark:hover:bg-purple-900/20 hover:shadow"])},l(M),11,Is)),64))]),e("details",As,[h[9]||(h[9]=e("summary",{class:"cursor-pointer text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 select-none flex items-center gap-1"},[e("span",null,"‚å®Ô∏è"),e("span",null,"Ingresar hora manualmente")],-1)),e("div",Ts,[G(e("input",{"onUpdate:modelValue":h[1]||(h[1]=M=>p.value.hora_inicio=M),type:"time",required:"",step:"1800",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-800 dark:text-white"},null,512),[[W,p.value.hora_inicio]])])])])]),e("div",null,[h[12]||(h[12]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," ‚è±Ô∏è Duraci√≥n (min) ",-1)),G(e("select",{"onUpdate:modelValue":h[2]||(h[2]=M=>p.value.duracion=M),class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-800 dark:text-white"},[...h[11]||(h[11]=[e("option",{value:30},"30 min",-1),e("option",{value:45},"45 min",-1),e("option",{value:60},"60 min",-1),e("option",{value:90},"90 min",-1)])],512),[[_e,p.value.duracion]])]),e("div",null,[h[13]||(h[13]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," üïë Hora Fin ",-1)),G(e("input",{"onUpdate:modelValue":h[3]||(h[3]=M=>p.value.hora_fin=M),type:"time",required:"",readonly:"",step:"1800",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-800 dark:text-white"},null,512),[[W,p.value.hora_fin]])])]),r.value?(a(),s("div",js,[...h[14]||(h[14]=[e("div",{class:"flex items-start gap-3"},[e("span",{class:"text-2xl"},"‚ö†Ô∏è"),e("div",null,[e("div",{class:"font-semibold text-yellow-800 dark:text-yellow-300 mb-1"}," Conflicto de Horario "),e("div",{class:"text-sm text-yellow-700 dark:text-yellow-400"}," Ya existe otra cita en este horario. Por favor, selecciona otro horario. ")])],-1)])])):E("",!0),e("div",null,[h[15]||(h[15]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," üíª Modalidad ",-1)),e("div",Bs,[(a(),s(K,null,J([{valor:"presencial",icono:"üè•",nombre:"Presencial"},{valor:"online",icono:"üíª",nombre:"Online"},{valor:"telefonica",icono:"üìû",nombre:"Tel√©fono"}],M=>e("button",{key:M.valor,type:"button",onClick:R=>p.value.modalidad=M.valor,class:q(["p-3 border-2 rounded-lg transition-all",p.value.modalidad===M.valor?"border-purple-600 bg-purple-50 dark:bg-purple-900/20":"border-gray-300 dark:border-gray-700 hover:border-purple-400"])},[e("div",zs,l(M.icono),1),e("div",qs,l(M.nombre),1)],10,Vs)),64))])]),e("div",null,[h[16]||(h[16]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," üìä Estado ",-1)),e("div",Rs,[(a(),s(K,null,J([{valor:"pendiente",icono:"‚è≥",nombre:"Pendiente"},{valor:"confirmada",icono:"‚úÖ",nombre:"Confirmada"},{valor:"realizada",icono:"‚úì",nombre:"Realizada"},{valor:"cancelada",icono:"‚ùå",nombre:"Cancelada"}],M=>e("button",{key:M.valor,type:"button",onClick:R=>p.value.estado=M.valor,class:q(["p-2 border-2 rounded-lg transition-all",p.value.estado===M.valor?"border-purple-600 bg-purple-50 dark:bg-purple-900/20":"border-gray-300 dark:border-gray-700 hover:border-purple-400"])},[e("div",Ns,l(M.icono),1),e("div",Us,l(M.nombre),1)],10,Os)),64))])]),e("div",null,[h[17]||(h[17]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," üìù Observaciones ",-1)),G(e("textarea",{"onUpdate:modelValue":h[4]||(h[4]=M=>p.value.observaciones=M),rows:"3",placeholder:"Notas adicionales sobre la cita...",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-800 dark:text-white"},null,512),[[W,p.value.observaciones]])])])],32)):E("",!0),e("div",Ls,[e("button",{onClick:g,type:"button",class:"flex-1 px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors font-medium"}," Cancelar "),e("button",{onClick:i,disabled:d.value||r.value,class:q(["flex-1 px-4 py-2 rounded-lg font-medium transition-colors",d.value||r.value?"bg-gray-400 dark:bg-gray-600 text-gray-200 cursor-not-allowed":"bg-purple-600 hover:bg-purple-700 text-white"])},[d.value?(a(),s("span",Gs,"Guardando...")):(a(),s("span",Qs,"üíæ Guardar Cambios"))],10,Hs)])])])):E("",!0)]))}}),Xs=Object.assign(pe(Ks,[["__scopeId","data-v-e8361a38"]]),{__name:"ModalEditarCita"}),Js={class:"fixed bottom-4 right-4 z-50 flex flex-col gap-3 max-w-sm w-full pointer-events-none",role:"region","aria-live":"polite","aria-label":"Notificaciones"},Ys={class:"flex-shrink-0"},Zs={class:"text-sm font-medium flex-1"},Ws=["onClick","aria-label"],er={__name:"ToastContainer",setup(I){const{toasts:A,removeToast:f}=$e(),B=u=>{const x={success:"border-green-200 bg-green-50 text-green-800",error:"border-red-200 bg-red-50 text-red-800",warning:"border-amber-200 bg-amber-50 text-amber-800",info:"border-blue-200 bg-blue-50 text-blue-800"};return x[u]||x.info};return(u,x)=>(a(),s("div",Js,[F(_t,{name:"toast"},{default:Fe(()=>[(a(!0),s(K,null,J(o(A),_=>(a(),s("div",{key:_.id,class:q(["pointer-events-auto bg-white rounded-lg shadow-lg border p-4 flex items-start gap-3 transition-all duration-300",B(_.type)]),role:"alert"},[e("div",Ys,[_.type==="success"?(a(),se(o(ce),{key:0,class:"w-5 h-5","aria-hidden":"true"})):_.type==="error"?(a(),se(o(fe),{key:1,class:"w-5 h-5","aria-hidden":"true"})):_.type==="warning"?(a(),se(o(ve),{key:2,class:"w-5 h-5","aria-hidden":"true"})):(a(),se(o(je),{key:3,class:"w-5 h-5","aria-hidden":"true"}))]),e("p",Zs,l(_.message),1),e("button",{onClick:S=>o(f)(_.id),class:"min-h-[44px] min-w-[44px] p-2 -mr-2 -mt-2 hover:bg-gray-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-gray-300","aria-label":`Cerrar notificaci√≥n: ${_.message}`},[F(o(Ce),{class:"w-4 h-4","aria-hidden":"true"})],8,Ws)],2))),128))]),_:1})]))}},tr=pe(er,[["__scopeId","data-v-4b6dd325"]]),or={class:"mb-4"},ar={key:0},sr={class:"inline-block"},rr={class:"min-h-[44px] px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all font-medium shadow-sm hover:shadow-md cursor-pointer inline-flex items-center gap-2"},nr=["accept","aria-label"],lr={class:"text-xs text-gray-400 mt-4"},ir={class:"text-xs text-gray-400"},dr={key:1,class:"flex items-center justify-center gap-4"},cr={class:"text-left flex-1"},ur={class:"text-sm font-semibold text-cafe"},pr={class:"text-xs text-gray-500"},mr={key:2,class:"mt-4 p-3 bg-red-100 border border-red-300 rounded-lg"},br={class:"text-sm text-red-800 font-medium"},gr=ke({__name:"FileDropzone",props:{accept:{default:".csv,.xlsx,.xls"},maxSize:{default:10*1024*1024},supportedFormats:{default:"CSV, XLSX"},ariaLabel:{default:"Seleccionar archivo para subir"}},emits:["file-selected","file-removed","error"],setup(I,{expose:A,emit:f}){const B=I,u=f,x=j(null),_=j(!1),S=j(""),N=T(()=>!!S.value),d=T(()=>Math.round(B.maxSize/(1024*1024))),r=b=>{if(S.value="",b.size>B.maxSize)return S.value=`El archivo es demasiado grande. M√°ximo permitido: ${d.value}MB`,u("error",S.value),!1;const i=b.name.split(".").pop()?.toLowerCase(),g=B.accept.split(",").map(m=>m.trim().replace(".",""));return!i||!g.includes(i)?(S.value=`Formato de archivo no v√°lido. Solo se permiten: ${B.supportedFormats}`,u("error",S.value),!1):!0},p=b=>{const i=b.target,g=i.files?.[0];g&&r(g)&&(x.value=g,u("file-selected",g)),i.value=""},V=b=>{_.value=!0},H=b=>{_.value=!1},D=b=>{_.value=!1;const i=b.dataTransfer?.files[0];i&&r(i)&&(x.value=i,u("file-selected",i))},$=()=>{x.value=null,S.value="",u("file-removed")},y=b=>{if(b===0)return"0 Bytes";const i=1024,g=["Bytes","KB","MB","GB"],m=Math.floor(Math.log(b)/Math.log(i));return Math.round(b/Math.pow(i,m)*100)/100+" "+g[m]};return A({removeFile:$}),(b,i)=>(a(),s("div",{onDragover:ae(V,["prevent"]),onDragleave:H,onDrop:ae(D,["prevent"]),class:q(["relative border-2 border-dashed rounded-xl p-8 transition-all duration-200 text-center",[o(_)?"border-purple-600 bg-purple-50":"border-gray-300 bg-gray-50",o(N)?"border-red-400 bg-red-50":"",o(x)?"border-green-400 bg-green-50":""]])},[e("div",or,[o(x)?(a(),se(o(we),{key:1,class:"w-12 h-12 mx-auto text-green-600","aria-hidden":"true"})):(a(),se(o(Be),{key:0,class:q(["w-12 h-12 mx-auto",o(_)?"text-purple-600":"text-gray-400"]),"aria-hidden":"true"},null,8,["class"]))]),o(x)?(a(),s("div",dr,[e("div",cr,[e("p",ur,l(o(x).name),1),e("p",pr,l(y(o(x).size)),1)]),e("button",{onClick:$,class:"min-h-[44px] min-w-[44px] p-2 text-red-600 hover:bg-red-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-red-300","aria-label":"Eliminar archivo"},[F(o(Ce),{class:"w-6 h-6","aria-hidden":"true"})])])):(a(),s("div",ar,[i[1]||(i[1]=e("p",{class:"text-lg font-medium text-cafe mb-2"}," Arrastra tu archivo aqu√≠ ",-1)),i[2]||(i[2]=e("p",{class:"text-sm text-gray-500 mb-4"}," o haz clic para seleccionar ",-1)),e("label",sr,[e("span",rr,[F(o(Nt),{class:"w-5 h-5","aria-hidden":"true"}),i[0]||(i[0]=e("span",null,"Seleccionar archivo",-1))]),e("input",{type:"file",accept:I.accept,onChange:p,class:"hidden","aria-label":I.ariaLabel},null,40,nr)]),e("p",lr,l(I.supportedFormats),1),e("p",ir," Tama√±o m√°ximo: "+l(o(d))+"MB ",1)])),o(S)?(a(),s("div",mr,[e("p",br,l(o(S)),1)])):E("",!0)],34))}}),fr=Object.assign(gr,{__name:"SharedFileDropzone"}),vr={class:"space-y-6"},xr={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},hr={class:"flex gap-3"},yr={class:"overflow-x-auto border border-gray-200 rounded-lg"},_r={class:"w-full text-sm"},wr={class:"divide-y divide-gray-200"},kr={class:"px-4 py-3"},$r={class:"font-medium text-gray-900"},Cr={class:"px-4 py-3"},Dr={class:"flex flex-wrap gap-1 max-w-xs"},Er=["title"],Sr={class:"px-4 py-3"},Fr=["value","onChange"],Mr={label:"Campos obligatorios"},Pr=["value","disabled"],Ir={label:"Contacto"},Ar=["value","disabled"],Tr={label:"Tratamiento"},jr=["value","disabled"],Br={label:"Otros campos"},Vr=["value","disabled"],zr={class:"px-4 py-3 text-center"},qr={key:0,class:"inline-flex items-center gap-1 px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium"},Rr={key:1,class:"inline-flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-medium"},Or={key:2,class:"inline-flex items-center gap-1 px-2 py-1 bg-gray-100 text-gray-500 rounded-full text-xs"},Nr={key:0,class:"bg-red-50 border border-red-200 rounded-lg p-4"},Ur={class:"flex gap-3"},Lr={class:"list-disc list-inside text-red-800 space-y-1 text-sm"},Hr={key:1,class:"bg-amber-50 border border-amber-200 rounded-lg p-4"},Gr={class:"flex gap-3"},Qr={class:"list-disc list-inside text-amber-800 space-y-1 text-sm"},Kr={key:2,class:"space-y-3"},Xr={class:"font-semibold text-gray-900 flex items-center gap-2"},Jr={class:"overflow-x-auto border border-gray-200 rounded-lg"},Yr={class:"w-full text-sm"},Zr={class:"bg-purple-50"},Wr={class:"divide-y divide-gray-100"},en={class:"text-xs text-gray-500"},tn=ke({__name:"ColumnMappingTable",props:{detectedColumns:{},mappings:{},validation:{}},emits:["update:mapping"],setup(I,{emit:A}){const f=I,B=A,u=[{field:"nombre_completo",label:"Nombre Completo"},{field:"email",label:"Email"},{field:"telefono",label:"Tel√©fono"}],x=[{field:"documento_identidad",label:"Documento de Identidad"},{field:"fecha_nacimiento",label:"Fecha de Nacimiento"},{field:"direccion",label:"Direcci√≥n"},{field:"contacto_emergencia",label:"Contacto de Emergencia"}],_=[{field:"area_de_acompanamiento",label:"√Årea de Acompa√±amiento"},{field:"frecuencia",label:"Frecuencia de Sesiones"},{field:"activo",label:"Estado (Activo/Inactivo)"},{field:"derivacion",label:"Derivaci√≥n"},{field:"medicacion",label:"Medicaci√≥n"},{field:"orientacion_diagnostica",label:"Orientaci√≥n Diagn√≥stica"},{field:"inicio_tratamiento",label:"Inicio del Tratamiento"}],S=[{field:"precio_sesion",label:"Precio por Sesi√≥n"},{field:"comision",label:"Comisi√≥n"},{field:"notas",label:"Notas / Observaciones"}],N=[...u,...x,..._,...S],d=y=>f.mappings.find(i=>i.sourceColumn===y)?.targetField||"",r=(y,b)=>f.mappings.some(i=>i.targetField===y&&i.sourceColumn!==b),p=y=>u.some(b=>b.field===y),V=y=>N.find(b=>b.field===y)?.label||y,H=(y,b)=>{B("update:mapping",y,b)},D=T(()=>f.mappings.filter(y=>y.targetField).map(y=>y.targetField)),$=T(()=>{if(!f.detectedColumns.length||!D.value.length)return[];const y=Math.min(f.detectedColumns[0]?.sampleValues?.length||0,3),b=[];for(let i=0;i<y;i++){const g={};for(const m of f.mappings)if(m.targetField){const h=f.detectedColumns.find(M=>M.name===m.sourceColumn);g[m.targetField]=h?.sampleValues?.[i]||""}Object.keys(g).length>0&&b.push(g)}return b});return(y,b)=>(a(),s("div",vr,[e("div",xr,[e("div",hr,[F(o(je),{class:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),b[0]||(b[0]=e("div",null,[e("p",{class:"font-semibold text-blue-900 mb-1"}," Relaciona las columnas de tu archivo con los campos de Terapl√≠ "),e("p",{class:"text-sm text-blue-800"}," Hemos detectado autom√°ticamente algunos campos. Revisa y ajusta seg√∫n necesites. ")],-1))])]),e("div",yr,[e("table",_r,[b[4]||(b[4]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left font-semibold text-gray-700"}," Columna en tu archivo "),e("th",{class:"px-4 py-3 text-left font-semibold text-gray-700"}," Valores de ejemplo "),e("th",{class:"px-4 py-3 text-left font-semibold text-gray-700"}," Campo Terapl√≠ "),e("th",{class:"px-4 py-3 text-center font-semibold text-gray-700 w-24"}," Estado ")])],-1)),e("tbody",wr,[(a(!0),s(K,null,J(I.detectedColumns,i=>(a(),s("tr",{key:i.name,class:"hover:bg-gray-50"},[e("td",kr,[e("span",$r,l(i.name),1)]),e("td",Cr,[e("div",Dr,[(a(!0),s(K,null,J(i.sampleValues.slice(0,3),(g,m)=>(a(),s("span",{key:m,class:"inline-block px-2 py-0.5 bg-gray-100 text-gray-600 rounded text-xs truncate max-w-[120px]",title:g},l(g||"(vac√≠o)"),9,Er))),128))])]),e("td",Sr,[e("select",{value:d(i.name),onChange:g=>H(i.name,g.target.value),class:q(["w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-purple-500 focus:border-purple-500",{"border-green-400 bg-green-50":d(i.name)&&p(d(i.name)),"border-blue-300 bg-blue-50":d(i.name)&&!p(d(i.name))}])},[b[1]||(b[1]=e("option",{value:""},"-- No importar --",-1)),e("optgroup",Mr,[(a(),s(K,null,J(u,g=>e("option",{key:g.field,value:g.field,disabled:r(g.field,i.name)},l(g.label)+" "+l(r(g.field,i.name)?"(ya usado)":"*"),9,Pr)),64))]),e("optgroup",Ir,[(a(),s(K,null,J(x,g=>e("option",{key:g.field,value:g.field,disabled:r(g.field,i.name)},l(g.label)+" "+l(r(g.field,i.name)?"(ya usado)":""),9,Ar)),64))]),e("optgroup",Tr,[(a(),s(K,null,J(_,g=>e("option",{key:g.field,value:g.field,disabled:r(g.field,i.name)},l(g.label)+" "+l(r(g.field,i.name)?"(ya usado)":""),9,jr)),64))]),e("optgroup",Br,[(a(),s(K,null,J(S,g=>e("option",{key:g.field,value:g.field,disabled:r(g.field,i.name)},l(g.label)+" "+l(r(g.field,i.name)?"(ya usado)":""),9,Vr)),64))])],42,Fr)]),e("td",zr,[d(i.name)&&p(d(i.name))?(a(),s("span",qr,[F(o(ce),{class:"w-3.5 h-3.5"}),b[2]||(b[2]=P(" Obligatorio ",-1))])):d(i.name)?(a(),s("span",Rr,[F(o(ce),{class:"w-3.5 h-3.5"}),b[3]||(b[3]=P(" Opcional ",-1))])):(a(),s("span",Or," No importar "))])]))),128))])])]),I.validation?.errors?.length?(a(),s("div",Nr,[e("div",Ur,[F(o(ve),{class:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e("div",null,[b[5]||(b[5]=e("p",{class:"font-semibold text-red-900 mb-2"}," Errores que impiden la importaci√≥n: ",-1)),e("ul",Lr,[(a(!0),s(K,null,J(I.validation.errors,(i,g)=>(a(),s("li",{key:g},l(i),1))),128))])])])])):E("",!0),I.validation?.warnings?.length&&!I.validation?.errors?.length?(a(),s("div",Hr,[e("div",Gr,[F(o(fe),{class:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),e("div",null,[b[6]||(b[6]=e("p",{class:"font-semibold text-amber-900 mb-2"}," Advertencias (puedes continuar): ",-1)),e("ul",Qr,[(a(!0),s(K,null,J(I.validation.warnings,(i,g)=>(a(),s("li",{key:g},l(i),1))),128))])])])])):E("",!0),o($).length>0?(a(),s("div",Kr,[e("h4",Xr,[F(o(It),{class:"w-5 h-5 text-purple-600"}),b[7]||(b[7]=P(" Vista previa con el mapeo aplicado ",-1))]),e("div",Jr,[e("table",Yr,[e("thead",Zr,[e("tr",null,[(a(!0),s(K,null,J(o(D),i=>(a(),s("th",{key:i,class:"px-3 py-2 text-left font-medium text-purple-800 whitespace-nowrap"},l(V(i)),1))),128))])]),e("tbody",Wr,[(a(!0),s(K,null,J(o($),(i,g)=>(a(),s("tr",{key:g,class:"hover:bg-gray-50"},[(a(!0),s(K,null,J(o(D),m=>(a(),s("td",{key:m,class:"px-3 py-2 text-gray-700 whitespace-nowrap"},l(i[m]||"‚Äî"),1))),128))]))),128))])])]),e("p",en," Mostrando las primeras "+l(o($).length)+" fila"+l(o($).length!==1?"s":"")+" de tu archivo ",1)])):E("",!0)]))}}),on=Object.assign(tn,{__name:"PatientsColumnMappingTable"});function an(){const I=j(null),A=j([]),f=j(null),B=j(null),u=j(!1),x=j(!1),_=j(!1),S=j(null),N=async y=>{u.value=!0,S.value=null;try{const b=new FormData;b.append("file",y);const i=await fetch("/api/patients/import/detect-columns",{method:"POST",body:b});if(!i.ok){const m=await i.json();throw new Error(m.statusMessage||"Error al detectar columnas")}const g=await i.json();if(!g.success||!g.config)throw new Error("Respuesta inv√°lida del servidor");return I.value=g.config,A.value=g.config.mappings||[],await r(),!0}catch(b){return S.value=b.message||"Error al detectar columnas",console.error("Error en detectColumns:",b),!1}finally{u.value=!1}},d=(y,b)=>{const i=A.value.findIndex(g=>g.sourceColumn===y);i>=0?A.value[i]={sourceColumn:y,targetField:b}:A.value.push({sourceColumn:y,targetField:b}),r()},r=async()=>{if(!I.value)return S.value="No hay configuraci√≥n de importaci√≥n",!1;x.value=!0,S.value=null;try{const y=await fetch("/api/patients/import/validate-mapping",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({configId:I.value.id,mappings:A.value})});if(!y.ok){const i=await y.json();throw new Error(i.statusMessage||"Error al validar mapeo")}const b=await y.json();return f.value=b.validation,b.validation?.isValid||!1}catch(y){return S.value=y.message||"Error al validar mapeo",console.error("Error en validateMapping:",y),!1}finally{x.value=!1}},p=async(y,b)=>{if(!I.value)return S.value="No hay configuraci√≥n de importaci√≥n",!1;if(!f.value?.isValid)return S.value="El mapeo no es v√°lido",!1;_.value=!0,S.value=null;try{const i=new FormData;i.append("file",y),i.append("configId",I.value.id),i.append("action",b),i.append("mappings",JSON.stringify(A.value));const g=await fetch("/api/patients/import/execute",{method:"POST",body:i});if(!g.ok){const h=await g.json();throw new Error(h.statusMessage||"Error al importar pacientes")}const m=await g.json();return B.value=m.results,m.success}catch(i){return S.value=i.message||"Error al importar pacientes",console.error("Error en executeImport:",i),!1}finally{_.value=!1}},V=()=>{I.value=null,A.value=[],f.value=null,B.value=null,u.value=!1,x.value=!1,_.value=!1,S.value=null},H=y=>A.value.find(i=>i.sourceColumn===y)?.targetField||"",D=()=>{if(!I.value?.detectedColumns)return[];const y=Math.min(I.value.detectedColumns[0]?.sampleValues?.length||0,3),b=[];for(let i=0;i<y;i++){const g={};for(const m of A.value)if(m.targetField){const h=I.value.detectedColumns.find(M=>M.name===m.sourceColumn);g[m.targetField]=h?.sampleValues?.[i]||""}b.push(g)}return b},$=T(()=>{const y=new Set(A.value.map(g=>g.targetField).filter(g=>g!=="")),b=y.has("nombre_completo"),i=y.has("email")||y.has("telefono");return b&&i});return{config:I,mappings:A,validation:f,importResult:B,detecting:u,validating:x,importing:_,error:S,detectColumns:N,updateMapping:d,validateMapping:r,executeImport:p,reset:V,getMappedField:H,getPreviewData:D,hasRequiredFields:$}}const sn={class:"bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col"},rn={class:"px-6 py-4 border-b border-gray-200 flex items-center justify-between"},nn={class:"text-sm text-gray-500 mt-1"},ln={class:"px-6 py-3 bg-gray-50"},dn={class:"flex items-center gap-2"},cn={class:"flex justify-between mt-2 text-xs text-gray-500"},un={class:"flex-1 overflow-y-auto p-6"},pn={key:0,class:"space-y-6"},mn={class:"text-center"},bn={class:"bg-green-50 border border-green-200 rounded-lg p-4 text-sm"},gn={class:"flex gap-3"},fn={class:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-sm"},vn={class:"flex gap-3"},xn={class:"flex gap-3 justify-center pt-2"},hn=["disabled"],yn=["disabled"],_n={key:1,class:"space-y-6"},wn={class:"text-center mb-6"},kn={key:0,class:"bg-green-50 border border-green-200 rounded-lg p-4 text-sm"},$n={class:"flex gap-3"},Cn={class:"flex-1"},Dn={class:"text-green-800"},En={key:1,class:"bg-purple-50 border border-purple-200 rounded-lg p-6"},Sn={key:2,class:"bg-red-50 border border-red-200 rounded-lg p-4 text-sm"},Fn={class:"flex gap-3"},Mn={class:"text-red-800"},Pn={key:2,class:"space-y-6"},In={class:"text-center mb-6"},An={key:3,class:"space-y-6"},Tn={class:"text-center mb-6"},jn={class:"bg-gray-50 border border-gray-200 rounded-lg p-4"},Bn={class:"flex flex-wrap gap-2"},Vn={key:0,class:"bg-amber-50 border border-amber-200 rounded-lg p-4"},zn={class:"flex gap-3"},qn={class:"text-sm text-amber-800 space-y-1"},Rn={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},On={class:"flex items-start gap-3 cursor-pointer"},Nn={key:1,class:"space-y-3"},Un={class:"overflow-x-auto border border-gray-200 rounded-lg"},Ln={class:"w-full text-sm"},Hn={class:"bg-gray-50"},Gn={class:"divide-y divide-gray-100"},Qn={key:4,class:"space-y-6"},Kn={class:"text-center mb-6"},Xn={class:"text-lg font-semibold text-cafe mb-2"},Jn={class:"text-sm text-gray-600"},Yn={key:0,class:"grid grid-cols-2 md:grid-cols-4 gap-4"},Zn={class:"bg-gray-50 rounded-lg p-4 text-center"},Wn={class:"text-2xl font-bold text-cafe"},el={class:"bg-green-50 rounded-lg p-4 text-center"},tl={class:"text-2xl font-bold text-green-700"},ol={class:"bg-blue-50 rounded-lg p-4 text-center"},al={class:"text-2xl font-bold text-blue-700"},sl={class:"bg-gray-100 rounded-lg p-4 text-center"},rl={class:"text-2xl font-bold text-gray-700"},nl={key:1,class:"bg-green-50 border border-green-200 rounded-lg p-4"},ll={class:"flex gap-3"},il={key:2,class:"bg-amber-50 border border-amber-200 rounded-lg p-4"},dl={class:"flex gap-3"},cl={class:"flex-1"},ul={class:"font-semibold text-amber-900 mb-2"},pl={class:"max-h-40 overflow-y-auto space-y-2"},ml={class:"font-medium text-amber-900"},bl={class:"text-amber-700"},gl={key:0,class:"text-xs text-amber-700 italic"},fl={key:3,class:"bg-red-50 border border-red-200 rounded-lg p-4"},vl={class:"font-semibold text-red-900 mb-3 flex items-center gap-2"},xl={class:"max-h-40 overflow-y-auto space-y-2"},hl={class:"font-semibold"},yl={class:"px-6 py-4 border-t border-gray-200 flex items-center justify-between bg-gray-50"},_l=["disabled"],wl={key:1},kl={class:"flex gap-3"},$l=["disabled"],Cl=["disabled"],Dl={key:0,class:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"},El=["disabled"],Sl=["disabled"],Fl={key:0,class:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"},Ml=ke({__name:"PatientsImportModal",props:{modelValue:{type:Boolean},existingPatients:{default:()=>[]}},emits:["update:modelValue","import-complete"],setup(I,{emit:A}){const f=A,B=$e(),u=an(),x=j(1),_=j(null),S=j(!1),N=j(!0),d=j(!1),r={nombre_completo:"Nombre Completo",email:"Email",telefono:"Tel√©fono",documento_identidad:"Documento",fecha_nacimiento:"Fecha Nac.",direccion:"Direcci√≥n",contacto_emergencia:"Contacto Emergencia",area_de_acompanamiento:"√Årea",frecuencia:"Frecuencia",activo:"Estado",derivacion:"Derivaci√≥n",medicacion:"Medicaci√≥n",orientacion_diagnostica:"Diagn√≥stico",inicio_tratamiento:"Inicio Trat.",precio_sesion:"Precio",comision:"Comisi√≥n",notas:"Notas"},p=n=>n?r[n]||n:"",V=T(()=>_.value!==null||u.config.value!==null||x.value>1),H=()=>{if(u.importing.value){B.warning("No se puede cerrar mientras se est√° importando");return}V.value&&x.value<5&&!confirm(`¬øEst√°s seguro de que deseas cancelar?

Se perder√° todo el progreso de la importaci√≥n.
Tendr√°s que empezar de nuevo si cierras ahora.`)||(f("update:modelValue",!1),setTimeout(D,300))},D=()=>{x.value=1,_.value=null,S.value=!1,N.value=!0,d.value=!1,u.reset()},$=async n=>{try{S.value=!0;const t=await fetch(`/api/patients/template?format=${n}`);if(!t.ok)throw new Error("Error al descargar la plantilla");const c=await t.blob(),C=URL.createObjectURL(c),v=document.createElement("a");v.href=C,v.download=`plantilla_pacientes.${n}`,document.body.appendChild(v),v.click(),document.body.removeChild(v),URL.revokeObjectURL(C),B.success(`Plantilla ${n.toUpperCase()} descargada`)}catch(t){B.error(t.message||"Error al descargar la plantilla")}finally{S.value=!1}},y=n=>{_.value=n,u.error.value=null,B.info("Archivo seleccionado correctamente")},b=()=>{_.value=null,u.reset()},i=n=>{B.error(n)},g=(n,t)=>{u.updateMapping(n,t)},m=()=>{x.value<5&&x.value++},h=()=>{x.value>1&&x.value--},M=async()=>{if(!_.value)return;await u.detectColumns(_.value)?(B.success("Columnas detectadas correctamente"),x.value=3):B.error(u.error.value||"Error al detectar columnas")},R=async()=>{if(!_.value)return;const n=N.value?"update":"skip";if(await u.executeImport(_.value,n)){d.value=(u.importResult.value?.errors?.length||0)===0;const c=(u.importResult.value?.created||0)+(u.importResult.value?.updated||0);B.success(`${c} paciente${c!==1?"s":""} importado${c!==1?"s":""} correctamente`),x.value=5}else B.error(u.error.value||"Error al importar pacientes")},Z=()=>{f("import-complete"),H()};return(n,t)=>{const c=fr,C=on;return a(),se(Ae,{to:"body"},[F(Te,{name:"modal"},{default:Fe(()=>[I.modelValue?(a(),s("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",onClick:ae(H,["self"]),role:"dialog","aria-modal":"true","aria-labelledby":"import-modal-title"},[e("div",sn,[e("div",rn,[e("div",null,[t[3]||(t[3]=e("h2",{id:"import-modal-title",class:"text-2xl font-serif font-bold text-cafe"}," Importar Pacientes ",-1)),e("p",nn," Paso "+l(o(x))+" de 5 ",1)]),e("button",{onClick:H,class:"min-h-[44px] min-w-[44px] p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-gray-300","aria-label":"Cerrar modal"},[F(o(Ce),{class:"w-6 h-6","aria-hidden":"true"})])]),e("div",ln,[e("div",dn,[(a(),s(K,null,J(5,v=>e("div",{key:v,class:q(["flex-1 h-2 rounded-full transition-all duration-300",v<=o(x)?"bg-purple-600":"bg-gray-200"])},null,2)),64))]),e("div",cn,[e("span",{class:q({"text-purple-600 font-medium":o(x)===1})},"Info",2),e("span",{class:q({"text-purple-600 font-medium":o(x)===2})},"Subir",2),e("span",{class:q({"text-purple-600 font-medium":o(x)===3})},"Mapear",2),e("span",{class:q({"text-purple-600 font-medium":o(x)===4})},"Revisar",2),e("span",{class:q({"text-purple-600 font-medium":o(x)===5})},"Resultado",2)])]),e("div",un,[o(x)===1?(a(),s("div",pn,[e("div",mn,[F(o(Ot),{class:"w-16 h-16 mx-auto text-purple-600 mb-4","aria-hidden":"true"}),t[4]||(t[4]=e("h3",{class:"text-lg font-semibold text-cafe mb-2"}," Paso 1: Prepara tu archivo ",-1)),t[5]||(t[5]=e("p",{class:"text-sm text-gray-600 mb-2 max-w-md mx-auto"},[P(" Puedes usar "),e("strong",null,"cualquier Excel o CSV"),P(" con tus pacientes. El sistema detectar√° las columnas autom√°ticamente. ")],-1))]),e("div",bn,[e("div",gn,[F(o(ce),{class:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),t[6]||(t[6]=e("div",null,[e("p",{class:"font-semibold text-green-900 mb-2"},"¬øYa tienes un Excel con pacientes?"),e("p",{class:"text-green-800"}," ¬°Perfecto! Puedes subirlo directamente. En el siguiente paso podr√°s relacionar las columnas de tu archivo con los campos de Terapl√≠. ")],-1))])]),e("div",fn,[e("div",vn,[F(o(je),{class:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),t[7]||(t[7]=e("div",{class:"space-y-3"},[e("div",null,[e("p",{class:"font-semibold text-blue-900 mb-1"},"Formatos aceptados:"),e("p",{class:"text-blue-800"},"CSV (.csv) y Excel (.xlsx, .xls)"),e("p",{class:"text-xs text-blue-700 mt-1"},"Tama√±o m√°ximo: 10MB | M√°ximo 5,000 filas")]),e("div",null,[e("p",{class:"font-semibold text-blue-900 mb-1"},"Campos m√≠nimos necesarios:"),e("ul",{class:"list-disc list-inside text-blue-800 space-y-1"},[e("li",null,[e("strong",null,"Nombre"),P(" del paciente (obligatorio)")]),e("li",null,[e("strong",null,"Email"),P(" o "),e("strong",null,"Tel√©fono"),P(" (al menos uno)")])])]),e("div",null,[e("p",{class:"font-semibold text-blue-900 mb-1"},"Campos adicionales soportados:"),e("p",{class:"text-blue-800 text-xs"}," Documento de identidad, Direcci√≥n, Fecha de nacimiento, √Årea de tratamiento, Frecuencia, Derivaci√≥n, Medicaci√≥n, Diagn√≥stico, Notas, Precio, y m√°s... ")])],-1))])]),e("div",xn,[e("button",{onClick:t[0]||(t[0]=v=>$("csv")),disabled:o(S),class:"min-h-[44px] px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all text-sm disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"},[F(o(we),{class:"w-4 h-4","aria-hidden":"true"}),t[8]||(t[8]=e("span",null,"Descargar plantilla CSV",-1))],8,hn),e("button",{onClick:t[1]||(t[1]=v=>$("xlsx")),disabled:o(S),class:"min-h-[44px] px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all text-sm disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"},[F(o(we),{class:"w-4 h-4","aria-hidden":"true"}),t[9]||(t[9]=e("span",null,"Descargar plantilla Excel",-1))],8,yn)])])):E("",!0),o(x)===2?(a(),s("div",_n,[e("div",wn,[F(o(Be),{class:"w-16 h-16 mx-auto text-purple-600 mb-4","aria-hidden":"true"}),t[10]||(t[10]=e("h3",{class:"text-lg font-semibold text-cafe mb-2"}," Paso 2: Sube tu archivo ",-1)),t[11]||(t[11]=e("p",{class:"text-sm text-gray-600 mb-1"}," Arrastra tu archivo o haz clic para seleccionarlo ",-1)),t[12]||(t[12]=e("p",{class:"text-xs text-gray-500"}," Detectaremos las columnas autom√°ticamente ",-1))]),F(c,{onFileSelected:y,onFileRemoved:b,onError:i}),o(_)&&!o(u).detecting.value?(a(),s("div",kn,[e("div",$n,[F(o(ce),{class:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e("div",Cn,[t[13]||(t[13]=e("p",{class:"font-semibold text-green-900 mb-1"},"Archivo seleccionado correctamente",-1)),e("p",Dn,l(o(_).name),1),t[14]||(t[14]=e("p",{class:"text-xs text-green-700 mt-1"},' Haz clic en "Detectar columnas" para continuar ',-1))])])])):E("",!0),o(u).detecting.value?(a(),s("div",En,[...t[15]||(t[15]=[e("div",{class:"flex flex-col items-center justify-center gap-4"},[e("div",{class:"animate-spin w-12 h-12 border-4 border-purple-600 border-t-transparent rounded-full"}),e("div",{class:"text-center"},[e("p",{class:"text-purple-900 font-medium mb-1"},"Analizando archivo..."),e("p",{class:"text-sm text-purple-700"},"Detectando columnas y sugiriendo mapeo")])],-1)])])):E("",!0),o(u).error.value?(a(),s("div",Sn,[e("div",Fn,[F(o(ve),{class:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e("div",null,[t[16]||(t[16]=e("p",{class:"font-semibold text-red-900 mb-1"},"Error al procesar archivo",-1)),e("p",Mn,l(o(u).error.value),1)])])])):E("",!0)])):E("",!0),o(x)===3?(a(),s("div",Pn,[e("div",In,[F(o(qt),{class:"w-16 h-16 mx-auto text-purple-600 mb-4","aria-hidden":"true"}),t[17]||(t[17]=e("h3",{class:"text-lg font-semibold text-cafe mb-2"}," Paso 3: Mapea las columnas ",-1)),t[18]||(t[18]=e("p",{class:"text-sm text-gray-600"}," Relaciona las columnas de tu archivo con los campos de Terapl√≠ ",-1))]),F(C,{"detected-columns":o(u).config.value?.detectedColumns||[],mappings:o(u).mappings.value,validation:o(u).validation.value,"onUpdate:mapping":g},null,8,["detected-columns","mappings","validation"])])):E("",!0),o(x)===4?(a(),s("div",An,[e("div",Tn,[F(o(Rt),{class:"w-16 h-16 mx-auto text-purple-600 mb-4","aria-hidden":"true"}),t[19]||(t[19]=e("h3",{class:"text-lg font-semibold text-cafe mb-2"}," Paso 4: Confirma la importaci√≥n ",-1)),t[20]||(t[20]=e("p",{class:"text-sm text-gray-600"}," Revisa el resumen antes de importar ",-1))]),e("div",jn,[t[21]||(t[21]=e("h4",{class:"font-semibold text-gray-900 mb-3"},"Campos que se importar√°n:",-1)),e("div",Bn,[(a(!0),s(K,null,J(o(u).mappings.value.filter(v=>v.targetField),v=>(a(),s("span",{key:v.sourceColumn,class:"inline-flex items-center gap-1 px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm"},[F(o(ce),{class:"w-4 h-4"}),P(" "+l(p(v.targetField)),1)]))),128))])]),o(u).validation.value?.warnings?.length?(a(),s("div",Vn,[e("div",zn,[F(o(fe),{class:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e("div",null,[t[22]||(t[22]=e("p",{class:"font-semibold text-amber-900 mb-2"},"Advertencias:",-1)),e("ul",qn,[(a(!0),s(K,null,J(o(u).validation.value.warnings,(v,U)=>(a(),s("li",{key:U}," ‚Ä¢ "+l(v),1))),128))])])])])):E("",!0),e("div",Rn,[e("label",On,[G(e("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=v=>ie(N)?N.value=v:null),class:"mt-1 w-5 h-5 text-purple-600 border-gray-300 rounded focus:ring-2 focus:ring-purple-300 cursor-pointer"},null,512),[[ue,o(N)]]),t[23]||(t[23]=e("div",{class:"flex-1"},[e("p",{class:"font-semibold text-blue-900 mb-1"}," Actualizar pacientes existentes "),e("p",{class:"text-sm text-blue-800"}," Si un paciente ya existe (mismo email o tel√©fono), actualizar sus datos con la informaci√≥n del archivo. "),e("p",{class:"text-xs text-blue-700 mt-1"}," Si no marcas esta opci√≥n, los pacientes duplicados se omitir√°n. ")],-1))])]),o(u).getPreviewData().length>0?(a(),s("div",Nn,[t[24]||(t[24]=e("h4",{class:"font-semibold text-gray-900"},"Vista previa de datos:",-1)),e("div",Un,[e("table",Ln,[e("thead",Hn,[e("tr",null,[(a(!0),s(K,null,J(o(u).mappings.value.filter(v=>v.targetField),v=>(a(),s("th",{key:v.targetField,class:"px-3 py-2 text-left font-medium text-gray-700 whitespace-nowrap"},l(p(v.targetField)),1))),128))])]),e("tbody",Gn,[(a(!0),s(K,null,J(o(u).getPreviewData(),(v,U)=>(a(),s("tr",{key:U},[(a(!0),s(K,null,J(o(u).mappings.value.filter(O=>O.targetField),O=>(a(),s("td",{key:O.targetField,class:"px-3 py-2 text-gray-600 whitespace-nowrap"},l(v[O.targetField]||"‚Äî"),1))),128))]))),128))])])]),t[25]||(t[25]=e("p",{class:"text-xs text-gray-500"},"Vista previa de las primeras filas",-1))])):E("",!0)])):E("",!0),o(x)===5?(a(),s("div",Qn,[e("div",Kn,[o(d)?(a(),se(o(ce),{key:0,class:"w-16 h-16 mx-auto text-green-600 mb-4","aria-hidden":"true"})):(a(),se(o(fe),{key:1,class:"w-16 h-16 mx-auto text-amber-600 mb-4","aria-hidden":"true"})),e("h3",Xn,l(o(d)?"Importaci√≥n completada con √©xito":"Importaci√≥n completada con advertencias"),1),e("p",Jn,l(o(d)?"Los pacientes se han importado correctamente":"La importaci√≥n se complet√≥ pero algunos pacientes tienen perfil incompleto"),1)]),o(u).importResult.value?(a(),s("div",Yn,[e("div",Zn,[e("p",Wn,l(o(u).importResult.value.total),1),t[26]||(t[26]=e("p",{class:"text-xs text-gray-600"},"Total",-1))]),e("div",el,[e("p",tl,l(o(u).importResult.value.created),1),t[27]||(t[27]=e("p",{class:"text-xs text-gray-600"},"Creados",-1))]),e("div",ol,[e("p",al,l(o(u).importResult.value.updated),1),t[28]||(t[28]=e("p",{class:"text-xs text-gray-600"},"Actualizados",-1))]),e("div",sl,[e("p",rl,l(o(u).importResult.value.skipped),1),t[29]||(t[29]=e("p",{class:"text-xs text-gray-600"},"Omitidos",-1))])])):E("",!0),o(d)?(a(),s("div",nl,[e("div",ll,[F(o(ce),{class:"w-6 h-6 text-green-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),t[30]||(t[30]=e("div",{class:"flex-1"},[e("p",{class:"font-semibold text-green-900 mb-2"},"¬°Importaci√≥n exitosa!"),e("p",{class:"text-sm text-green-800"}," Los pacientes se han a√±adido a tu lista y ya puedes gestionar sus citas y tratamientos. ")],-1))])])):E("",!0),o(u).importResult.value?.incompleteProfiles?.length?(a(),s("div",il,[e("div",dl,[F(o(fe),{class:"w-6 h-6 text-amber-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e("div",cl,[e("p",ul,l(o(u).importResult.value.incompleteProfiles.length)+" paciente"+l(o(u).importResult.value.incompleteProfiles.length!==1?"s":"")+" con perfil incompleto ",1),t[31]||(t[31]=e("p",{class:"text-sm text-amber-800 mb-3"}," Los siguientes pacientes fueron importados pero les faltan datos importantes: ",-1)),e("div",pl,[(a(!0),s(K,null,J(o(u).importResult.value.incompleteProfiles.slice(0,5),v=>(a(),s("div",{key:v.rowNumber,class:"bg-white border border-amber-200 rounded p-2 text-sm"},[e("span",ml,l(v.nombre_completo),1),e("span",bl," ‚Äî Faltan: "+l(v.missingFields.join(", ")),1)]))),128)),o(u).importResult.value.incompleteProfiles.length>5?(a(),s("p",gl," ... y "+l(o(u).importResult.value.incompleteProfiles.length-5)+" m√°s ",1)):E("",!0)]),t[32]||(t[32]=e("p",{class:"text-xs text-amber-700 mt-3"}," üí° Puedes completar esta informaci√≥n editando cada paciente desde la lista. ",-1))])])])):E("",!0),o(u).importResult.value?.errors?.length?(a(),s("div",fl,[e("h4",vl,[F(o(ve),{class:"w-5 h-5","aria-hidden":"true"}),P(" Errores durante la importaci√≥n ("+l(o(u).importResult.value.errors.length)+") ",1)]),e("div",xl,[(a(!0),s(K,null,J(o(u).importResult.value.errors.slice(0,10),(v,U)=>(a(),s("div",{key:U,class:"bg-white border border-red-200 rounded p-2 text-sm text-red-800"},[e("span",hl,"Fila "+l(v.row)+":",1),P(" "+l(v.error),1)]))),128))])])):E("",!0)])):E("",!0)]),e("div",yl,[o(x)>1&&o(x)<5?(a(),s("button",{key:0,onClick:h,disabled:o(u).importing.value||o(u).detecting.value,class:"min-h-[44px] px-6 py-2.5 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-all font-medium disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-gray-300"}," Atr√°s ",8,_l)):(a(),s("div",wl)),e("div",kl,[o(x)<5?(a(),s("button",{key:0,onClick:H,disabled:o(u).importing.value,class:"min-h-[44px] px-6 py-2.5 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all font-medium disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-gray-300"}," Cancelar ",8,$l)):E("",!0),o(x)===1?(a(),s("button",{key:1,onClick:m,class:"min-h-[44px] px-6 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all font-medium shadow-sm hover:shadow-md focus:outline-none focus:ring-2 focus:ring-purple-300"}," Continuar ")):E("",!0),o(x)===2?(a(),s("button",{key:2,onClick:M,disabled:!o(_)||o(u).detecting.value,class:"min-h-[44px] px-6 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all font-medium shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-purple-300 flex items-center gap-2"},[o(u).detecting.value?(a(),s("div",Dl)):E("",!0),e("span",null,l(o(u).detecting.value?"Analizando...":"Detectar columnas"),1)],8,Cl)):E("",!0),o(x)===3?(a(),s("button",{key:3,onClick:m,disabled:!o(u).validation.value?.isValid,class:"min-h-[44px] px-6 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all font-medium shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-purple-300"}," Continuar ",8,El)):E("",!0),o(x)===4?(a(),s("button",{key:4,onClick:R,disabled:o(u).importing.value,class:"min-h-[44px] px-6 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all font-medium shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-purple-300 flex items-center gap-2"},[o(u).importing.value?(a(),s("div",Fl)):E("",!0),e("span",null,l(o(u).importing.value?"Importando...":"Importar pacientes"),1)],8,Sl)):E("",!0),o(x)===5?(a(),s("button",{key:5,onClick:Z,class:"min-h-[44px] px-6 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all font-medium shadow-sm hover:shadow-md focus:outline-none focus:ring-2 focus:ring-purple-300"}," Finalizar ")):E("",!0)])])])])):E("",!0)]),_:1})])}}}),Pl=Object.assign(pe(Ml,[["__scopeId","data-v-97261e0d"]]),{__name:"PatientsImportModal"}),Il={class:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col"},Al={class:"px-6 py-4 border-b border-gray-200 flex items-center justify-between"},Tl={class:"flex-1 overflow-y-auto p-6 space-y-6"},jl={class:"flex gap-3"},Bl={class:"space-y-2"},Vl={class:"flex-1"},zl={class:"text-xs text-gray-600"},ql={class:"flex-1"},Rl={class:"text-xs text-gray-600"},Ol={class:"flex-1"},Nl={class:"text-xs text-gray-600"},Ul={class:"grid grid-cols-2 gap-2"},Ll=["value"],Hl={class:"text-sm text-cafe"},Gl={class:"px-6 py-4 border-t border-gray-200 flex items-center justify-between bg-gray-50"},Ql=["disabled"],Kl=["disabled"],Xl={key:1},Jl={key:2},Yl=ke({__name:"PatientsExportModal",props:{modelValue:{type:Boolean},totalPatients:{},filteredCount:{},selectedCount:{default:0},hasFilters:{type:Boolean,default:!1},currentFilters:{default:()=>({})},selectedIds:{default:()=>[]}},emits:["update:modelValue"],setup(I,{emit:A}){const f=I,B=A,u=$e(),x=j("csv"),_=j("all"),S=j(["nombre_completo","email","telefono","area_de_acompanamiento","frecuencia","activo"]),N=j(!1),d=[{value:"nombre_completo",label:"Nombre Completo"},{value:"email",label:"Email"},{value:"telefono",label:"Tel√©fono"},{value:"area_de_acompanamiento",label:"√Årea"},{value:"frecuencia",label:"Frecuencia"},{value:"activo",label:"Estado"},{value:"ultima_sesion",label:"√öltima Sesi√≥n"},{value:"proxima_sesion",label:"Pr√≥xima Sesi√≥n"},{value:"total_sesiones",label:"Total Sesiones"},{value:"created_at",label:"Fecha de Registro"}],r=()=>{N.value||B("update:modelValue",!1)},p=()=>{S.value.length===d.length?S.value=[]:S.value=d.map(H=>H.value)},V=async()=>{if(S.value.length===0){u.warning("Selecciona al menos un campo para exportar");return}try{N.value=!0;const H=new URLSearchParams({format:x.value,scope:_.value,fields:S.value.join(",")});_.value==="filtered"&&f.currentFilters&&H.append("filters",JSON.stringify(f.currentFilters)),_.value==="selected"&&f.selectedIds.length>0&&H.append("selectedIds",f.selectedIds.join(","));const D=await fetch(`/api/patients/export?${H.toString()}`);if(!D.ok){const i=await D.json();throw new Error(i.statusMessage||"Error al exportar pacientes")}const $=await D.blob(),y=URL.createObjectURL($),b=document.createElement("a");b.href=y,b.download=`pacientes_${new Date().toISOString().split("T")[0]}.${x.value}`,document.body.appendChild(b),b.click(),document.body.removeChild(b),URL.revokeObjectURL(y),u.success("Pacientes exportados correctamente"),r()}catch(H){u.error(H.message||"Error al exportar pacientes")}finally{N.value=!1}};return wt(()=>{f.selectedCount>0?_.value="selected":f.hasFilters?_.value="filtered":_.value="all"}),(H,D)=>(a(),se(Ae,{to:"body"},[F(Te,{name:"modal"},{default:Fe(()=>[I.modelValue?(a(),s("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",onClick:ae(r,["self"]),role:"dialog","aria-modal":"true","aria-labelledby":"export-modal-title"},[e("div",Il,[e("div",Al,[D[6]||(D[6]=e("div",null,[e("h2",{id:"export-modal-title",class:"text-2xl font-serif font-bold text-cafe"}," Exportar Pacientes "),e("p",{class:"text-sm text-gray-500 mt-1"}," Selecciona las opciones de exportaci√≥n ")],-1)),e("button",{onClick:r,class:"min-h-[44px] min-w-[44px] p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-gray-300","aria-label":"Cerrar modal"},[F(o(Ce),{class:"w-6 h-6","aria-hidden":"true"})])]),e("div",Tl,[e("div",null,[D[9]||(D[9]=e("label",{class:"block text-sm font-semibold text-cafe mb-3"}," Formato de archivo ",-1)),e("div",jl,[e("button",{onClick:D[0]||(D[0]=$=>x.value="csv"),class:q(["min-h-[44px] flex-1 px-4 py-3 rounded-lg border-2 transition-all font-medium flex items-center justify-center gap-2",o(x)==="csv"?"border-purple-600 bg-purple-50 text-purple-600":"border-gray-200 bg-white text-gray-600 hover:border-gray-300"])},[F(o(we),{class:"w-5 h-5","aria-hidden":"true"}),D[7]||(D[7]=e("span",null,"CSV",-1))],2),e("button",{onClick:D[1]||(D[1]=$=>x.value="xlsx"),class:q(["min-h-[44px] flex-1 px-4 py-3 rounded-lg border-2 transition-all font-medium flex items-center justify-center gap-2",o(x)==="xlsx"?"border-purple-600 bg-purple-50 text-purple-600":"border-gray-200 bg-white text-gray-600 hover:border-gray-300"])},[F(o(we),{class:"w-5 h-5","aria-hidden":"true"}),D[8]||(D[8]=e("span",null,"XLSX",-1))],2)])]),e("div",null,[D[13]||(D[13]=e("label",{class:"block text-sm font-semibold text-cafe mb-3"}," ¬øQu√© pacientes exportar? ",-1)),e("div",Bl,[e("label",{class:q(["flex items-center gap-3 p-3 border-2 rounded-lg cursor-pointer transition-all",o(_)==="all"?"border-purple-600 bg-purple-50":"border-gray-200 bg-white hover:border-gray-300"])},[G(e("input",{type:"radio","onUpdate:modelValue":D[2]||(D[2]=$=>ie(_)?_.value=$:null),value:"all",class:"w-4 h-4 text-purple-600 border-gray-300 focus:ring-2 focus:ring-purple-300"},null,512),[[Ie,o(_)]]),e("div",Vl,[D[10]||(D[10]=e("p",{class:"font-medium text-cafe"},"Todos los pacientes",-1)),e("p",zl,"Exportar todos los pacientes ("+l(I.totalPatients)+")",1)])],2),I.hasFilters?(a(),s("label",{key:0,class:q(["flex items-center gap-3 p-3 border-2 rounded-lg cursor-pointer transition-all",o(_)==="filtered"?"border-purple-600 bg-purple-50":"border-gray-200 bg-white hover:border-gray-300"])},[G(e("input",{type:"radio","onUpdate:modelValue":D[3]||(D[3]=$=>ie(_)?_.value=$:null),value:"filtered",class:"w-4 h-4 text-purple-600 border-gray-300 focus:ring-2 focus:ring-purple-300"},null,512),[[Ie,o(_)]]),e("div",ql,[D[11]||(D[11]=e("p",{class:"font-medium text-cafe"},"Pacientes filtrados",-1)),e("p",Rl,"Exportar solo los pacientes que cumplen los filtros actuales ("+l(I.filteredCount)+")",1)])],2)):E("",!0),I.selectedCount>0?(a(),s("label",{key:1,class:q(["flex items-center gap-3 p-3 border-2 rounded-lg cursor-pointer transition-all",o(_)==="selected"?"border-purple-600 bg-purple-50":"border-gray-200 bg-white hover:border-gray-300"])},[G(e("input",{type:"radio","onUpdate:modelValue":D[4]||(D[4]=$=>ie(_)?_.value=$:null),value:"selected",class:"w-4 h-4 text-purple-600 border-gray-300 focus:ring-2 focus:ring-purple-300"},null,512),[[Ie,o(_)]]),e("div",Ol,[D[12]||(D[12]=e("p",{class:"font-medium text-cafe"},"Pacientes seleccionados",-1)),e("p",Nl,"Exportar solo los pacientes seleccionados ("+l(I.selectedCount)+")",1)])],2)):E("",!0)])]),e("div",null,[D[14]||(D[14]=e("label",{class:"block text-sm font-semibold text-cafe mb-3"}," Campos a exportar ",-1)),e("div",Ul,[(a(),s(K,null,J(d,$=>e("label",{key:$.value,class:"flex items-center gap-2 p-2 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors"},[G(e("input",{type:"checkbox","onUpdate:modelValue":D[5]||(D[5]=y=>ie(S)?S.value=y:null),value:$.value,class:"w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-2 focus:ring-purple-300"},null,8,Ll),[[ue,o(S)]]),e("span",Hl,l($.label),1)])),64))]),e("button",{onClick:p,class:"mt-2 text-xs text-purple-600 hover:text-purple-700 font-medium"},l(o(S).length===d.length?"Deseleccionar todos":"Seleccionar todos"),1)])]),e("div",Gl,[e("button",{onClick:r,disabled:o(N),class:"min-h-[44px] px-6 py-2.5 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all font-medium disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-gray-300"}," Cancelar ",8,Ql),e("button",{onClick:V,disabled:o(N)||o(S).length===0,class:"min-h-[44px] px-6 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all font-medium shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-purple-300 flex items-center gap-2"},[o(N)?E("",!0):(a(),se(o(We),{key:0,class:"w-5 h-5","aria-hidden":"true"})),o(N)?(a(),s("span",Xl,"Exportando...")):(a(),s("span",Jl,"Exportar"))],8,Kl)])])])):E("",!0)]),_:1})]))}}),Zl=Object.assign(pe(Yl,[["__scopeId","data-v-797ad56f"]]),{__name:"PatientsExportModal"}),Wl={class:"mb-6"},ei={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-5"},ti={class:"text-2xl font-semibold text-gray-900"},oi={class:"text-gray-400 font-normal"},ai={class:"flex items-center gap-2"},si={class:"space-y-4"},ri={class:"relative"},ni={class:"flex items-center justify-between border-b border-gray-100"},li={class:"flex gap-1 -mb-px",role:"tablist"},ii=["onClick","aria-selected"],di={key:0,class:"absolute bottom-0 left-0 right-0 h-0.5 bg-purple-600 rounded-full"},ci={key:0,class:"w-5 h-5 flex items-center justify-center text-xs font-semibold bg-purple-600 text-white rounded-full"},ui={key:0,class:"bg-gray-50 rounded-lg p-4"},pi={class:"flex flex-wrap items-center gap-3"},mi=["value"],bi={key:0,class:"flex flex-col items-center justify-center py-20",role:"status"},gi={key:1,class:"flex flex-col items-center justify-center py-20 text-center"},fi={class:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4"},vi={class:"text-lg font-medium text-gray-900 mb-1"},xi={class:"text-sm text-gray-500 mb-4 max-w-sm"},hi={key:2,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-4",role:"list"},yi=["onClick","onKeydown"],_i=["onClick","aria-label"],wi={key:3,class:"mt-6 pt-4 border-t border-gray-100 flex items-center justify-between text-sm text-gray-500"},Yi={__name:"pacientes",setup(I){const A=kt(),f=Je(),{getUserId:B,waitForUser:u}=Se();Xe();const x=$e(),_=j(!1),S=j(!1),N=j(!1),d=j(!1),r=j(!1),p=j(!1),V=j(!1),H=j(null),D=j(null),$=j(null),y=j([]),b=j(!0),i=j(""),g=j(""),m=j("todos"),h=j(""),M=j(!1),R=j({sinProximaCita:!1,sinSesionRegistrada:!1,requiereAtencion:!1});let Z=null;const n=w=>{clearTimeout(Z),Z=setTimeout(()=>{i.value=w.target.value},300)},t=[{valor:"todos",label:"Todos"},{valor:"activo",label:"Activos"},{valor:"pausa",label:"En pausa"},{valor:"finalizado",label:"Finalizados"}],c=T(()=>({activos:y.value.filter(w=>w.activo&&!w.en_pausa).length,enPausa:y.value.filter(w=>w.activo&&w.en_pausa).length,finalizados:y.value.filter(w=>!w.activo).length})),C=T(()=>t.map(w=>{let k=0;return w.valor==="todos"?k=y.value.length:w.valor==="activo"?k=c.value.activos:w.valor==="pausa"?k=c.value.enPausa:w.valor==="finalizado"&&(k=c.value.finalizados),{...w,count:k}})),v=T(()=>C.value.find(k=>k.valor===m.value)?.count||0),U=T(()=>{const w=new Set(y.value.map(k=>k.area_de_acompanamiento).filter(Boolean));return Array.from(w).sort()}),O=T(()=>h.value!==""||R.value.sinProximaCita||R.value.sinSesionRegistrada||R.value.requiereAtencion),Q=T(()=>{let w=0;return h.value&&w++,R.value.sinProximaCita&&w++,R.value.sinSesionRegistrada&&w++,R.value.requiereAtencion&&w++,w}),X=T(()=>O.value||i.value||m.value!=="todos"),Y=w=>{R.value[w]=!R.value[w]},oe=()=>{h.value="",R.value={sinProximaCita:!1,sinSesionRegistrada:!1,requiereAtencion:!1}},te=()=>{oe(),m.value="todos",i.value="",g.value=""},z=async()=>{b.value=!0;try{const w=B();if(!w){b.value=!1;return}const{data:k,error:de}=await f.from("pacientes").select(`
        id,
        created_at,
        activo,
        email,
        nombre_completo,
        telefono,
        area_de_acompanamiento,
        frecuencia,
        metadata
      `).eq("terapeuta_id",w).order("created_at",{ascending:!1});if(de)throw de;const xe=await Promise.all(k.map(async ee=>{const{data:he}=await f.from("citas").select("fecha_cita").eq("paciente_id",ee.id).eq("estado","realizada").order("fecha_cita",{ascending:!1}).limit(1).maybeSingle(),{data:be}=await f.from("citas").select("id, fecha_cita, hora_inicio").eq("paciente_id",ee.id).in("estado",["pendiente","confirmada"]).gte("fecha_cita",new Date().toISOString().split("T")[0]).order("fecha_cita",{ascending:!0}).order("hora_inicio",{ascending:!0}).limit(1).maybeSingle(),{count:Me}=await f.from("citas").select("*",{count:"exact",head:!0}).eq("paciente_id",ee.id).eq("estado","realizada");let re=null;try{const{data:ge}=await f.from("bonos").select("id, tipo, estado, sesiones_totales, sesiones_restantes, fecha_fin, created_at").eq("paciente_id",ee.id).in("estado",["activo","pendiente"]).order("created_at",{ascending:!1}).limit(1).maybeSingle();re=ge}catch(ge){console.warn("[Bonos] Error:",ge)}let Ee=0,ye=0;re&&(ye=re.sesiones_totales,Ee=ye-re.sesiones_restantes);const L=new Date;L.setDate(L.getDate()-7);const{data:le}=await f.from("metricas_bienestar").select("estado_animo, nivel_energia, nivel_estres").eq("paciente_id",ee.id).gte("fecha",L.toISOString());let Oe=3,Ne=!1,Ue=50;if(le&&le.length>0){const ge=le.reduce((Pe,yt)=>Pe+yt.estado_animo,0)/le.length;Oe=ge,Ue=Math.round(ge/10*100);const Le=le.slice(-3);Le.length>=3&&(Ne=Le.every(Pe=>Pe.estado_animo<=4))}const ht=ee.nombre_completo||ee.metadata?.nombre_completo||ee.email;return{id:ee.id,nombre:ht,email:ee.email,telefono:ee.telefono,activo:ee.activo,en_pausa:ee.metadata?.en_pausa||!1,area_de_acompanamiento:ee.area_de_acompanamiento,frecuencia:ee.frecuencia,ultima_sesion:he?.fecha_cita||null,proxima_sesion:be?`${be.fecha_cita}T${be.hora_inicio}`:null,proxima_cita_id:be?.id||null,total_sesiones:Me||0,estado_emocional_promedio:Oe,evolucion_porcentaje:Ue,requiere_atencion:Ne,created_at:ee.created_at,bono_activo:re?{tipo:re.tipo,estado:re.estado,fecha_fin:re.fecha_fin,sesiones_completadas:Ee,sesiones_totales:ye,sesiones_restantes:re.sesiones_restantes}:null}}));y.value=xe}catch(w){console.error("Error al cargar pacientes:",w),x.error("Error al cargar los pacientes")}finally{b.value=!1}},me=T(()=>{let w=y.value;if(i.value){const k=i.value.toLowerCase();w=w.filter(de=>{const xe=(de.nombre||"").toLowerCase(),ee=(de.email||"").toLowerCase(),he=(de.telefono||"").toLowerCase();return xe.includes(k)||ee.includes(k)||he.includes(k)})}return m.value!=="todos"&&(w=w.filter(k=>m.value==="activo"?k.activo&&!k.en_pausa:m.value==="pausa"?k.activo&&k.en_pausa:m.value==="finalizado"?!k.activo:!0)),h.value&&(w=w.filter(k=>k.area_de_acompanamiento===h.value)),R.value.sinProximaCita&&(w=w.filter(k=>!k.proxima_sesion)),R.value.sinSesionRegistrada&&(w=w.filter(k=>!k.ultima_sesion)),R.value.requiereAtencion&&(w=w.filter(k=>k.requiere_atencion)),w}),De=T(()=>y.value.length),Ve=w=>{A.push(`/terapeuta/pacientes/${w}`)},ze=()=>{_.value=!0},et=()=>{_.value=!1},tt=w=>{D.value=w,S.value=!0},ot=()=>{S.value=!1,D.value=null},at=w=>{D.value=w,N.value=!0},st=()=>{N.value=!1,D.value=null},rt=async()=>{await z(),x.success("Paciente creado")},nt=async()=>{await z(),x.success("Paciente actualizado")},lt=async w=>{y.value=y.value.filter(k=>k.id!==w),x.success("Paciente eliminado")},it=async()=>{await z(),x.success("Paciente desactivado")},dt=w=>{$.value=w,d.value=!0},qe=()=>{d.value=!1,$.value=null},ct=async()=>{await z(),qe(),x.success("Cita asignada")},ut=w=>{A.push(`/agenda?paciente=${w.id}`)},pt=w=>{A.push(`/terapeuta/pacientes/${w.id}/bonos`)},mt=()=>{p.value=!0},bt=()=>{V.value=!0},gt=async()=>{await z(),x.success("Importaci√≥n completada")},ft=T(()=>{const w={};return m.value!=="todos"&&(w.estado=m.value),h.value&&(w.area=h.value),w}),vt=w=>{H.value=w,r.value=!0},Re=()=>{r.value=!1,H.value=null},xt=async()=>{await z(),Re(),x.success("Cita actualizada")};return $t(async()=>{try{await u(),B()?await z():b.value=!1}catch(w){console.error("Error en onMounted:",w),b.value=!1}}),ne(()=>B(),w=>{w&&y.value.length===0&&z()}),(w,k)=>{const de=fo,xe=Pt,ee=da,he=ss,be=xs,Me=Xs,re=tr,Ee=Pl,ye=Zl;return a(),s("div",null,[e("header",Wl,[e("div",ei,[e("div",null,[e("h1",ti,[k[9]||(k[9]=P(" Pacientes ",-1)),e("span",oi,"("+l(o(v))+")",1)])]),e("div",ai,[e("button",{onClick:mt,class:"min-h-[40px] px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors flex items-center gap-1.5 text-sm font-medium","aria-label":"Importar pacientes"},[F(o(Be),{class:"w-4 h-4","aria-hidden":"true"}),k[10]||(k[10]=e("span",{class:"hidden sm:inline"},"Importar",-1))]),e("button",{onClick:bt,class:"min-h-[40px] px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors flex items-center gap-1.5 text-sm font-medium","aria-label":"Exportar pacientes"},[F(o(We),{class:"w-4 h-4","aria-hidden":"true"}),k[11]||(k[11]=e("span",{class:"hidden sm:inline"},"Exportar",-1))]),e("button",{onClick:ze,class:"min-h-[40px] px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center gap-2 text-sm font-medium shadow-sm","aria-label":"A√±adir nuevo paciente"},[F(o(At),{class:"w-4 h-4","aria-hidden":"true"}),k[12]||(k[12]=e("span",null,"Nuevo",-1))])])]),e("div",si,[e("div",ri,[G(e("input",{"onUpdate:modelValue":k[0]||(k[0]=L=>ie(g)?g.value=L:null),onInput:n,type:"text",placeholder:"Buscar por nombre, email o tel√©fono...",class:"w-full h-11 px-4 pl-10 bg-white border border-gray-200 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition-all text-sm placeholder-gray-400","aria-label":"Buscar pacientes"},null,544),[[W,o(g)]]),F(o(Tt),{class:"w-4 h-4 absolute left-3.5 top-1/2 -translate-y-1/2 text-gray-400","aria-hidden":"true"}),o(i)?(a(),s("button",{key:0,onClick:k[1]||(k[1]=L=>{i.value="",g.value=""}),class:"absolute right-3 top-1/2 -translate-y-1/2 p-1 text-gray-400 hover:text-gray-600 rounded","aria-label":"Limpiar b√∫squeda"},[F(o(Ce),{class:"w-4 h-4"})])):E("",!0)]),e("div",ni,[e("nav",li,[(a(!0),s(K,null,J(o(C),L=>(a(),s("button",{key:L.valor,onClick:le=>m.value=L.valor,class:q(["px-4 py-2.5 text-sm font-medium transition-colors relative",o(m)===L.valor?"text-purple-600":"text-gray-500 hover:text-gray-700"]),"aria-selected":o(m)===L.valor,role:"tab"},[e("span",null,l(L.label),1),e("span",{class:q(["ml-1.5 text-xs",o(m)===L.valor?"text-purple-500":"text-gray-400"])},l(L.count),3),o(m)===L.valor?(a(),s("span",di)):E("",!0)],10,ii))),128))]),e("button",{onClick:k[2]||(k[2]=L=>M.value=!o(M)),class:q(["flex items-center gap-1.5 px-3 py-2 text-sm font-medium rounded-lg transition-colors",o(O)?"text-purple-600 bg-purple-50":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"])},[F(o(jt),{class:"w-4 h-4"}),k[13]||(k[13]=e("span",{class:"hidden sm:inline"},"Filtros",-1)),o(Q)>0?(a(),s("span",ci,l(o(Q)),1)):E("",!0),F(o(Bt),{class:q(["w-4 h-4 transition-transform",{"rotate-180":o(M)}])},null,8,["class"])],2)]),F(Te,{"enter-active-class":"transition-all duration-200 ease-out","enter-from-class":"opacity-0 -translate-y-2","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition-all duration-150 ease-in","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 -translate-y-2"},{default:Fe(()=>[o(M)?(a(),s("div",ui,[e("div",pi,[G(e("select",{"onUpdate:modelValue":k[3]||(k[3]=L=>ie(h)?h.value=L:null),class:"h-9 px-3 bg-white border border-gray-200 rounded-lg text-sm text-gray-700 focus:border-purple-500 focus:ring-1 focus:ring-purple-500/20","aria-label":"Filtrar por √°rea"},[k[14]||(k[14]=e("option",{value:""},"Todas las √°reas",-1)),(a(!0),s(K,null,J(o(U),L=>(a(),s("option",{key:L,value:L},l(L),9,mi))),128))],512),[[_e,o(h)]]),e("button",{onClick:k[4]||(k[4]=L=>Y("sinProximaCita")),class:q(["h-9 px-3 rounded-lg text-sm font-medium transition-all flex items-center gap-1.5",o(R).sinProximaCita?"bg-orange-100 text-orange-700 border border-orange-200":"bg-white text-gray-600 border border-gray-200 hover:border-gray-300"])},[F(o(Qe),{class:"w-4 h-4"}),k[15]||(k[15]=P(" Sin pr√≥xima cita ",-1))],2),e("button",{onClick:k[5]||(k[5]=L=>Y("sinSesionRegistrada")),class:q(["h-9 px-3 rounded-lg text-sm font-medium transition-all flex items-center gap-1.5",o(R).sinSesionRegistrada?"bg-amber-100 text-amber-700 border border-amber-200":"bg-white text-gray-600 border border-gray-200 hover:border-gray-300"])},[F(o(Vt),{class:"w-4 h-4"}),k[16]||(k[16]=P(" Sin sesi√≥n ",-1))],2),e("button",{onClick:k[6]||(k[6]=L=>Y("requiereAtencion")),class:q(["h-9 px-3 rounded-lg text-sm font-medium transition-all flex items-center gap-1.5",o(R).requiereAtencion?"bg-red-100 text-red-700 border border-red-200":"bg-white text-gray-600 border border-gray-200 hover:border-gray-300"])},[F(o(ve),{class:"w-4 h-4"}),k[17]||(k[17]=P(" Requiere atenci√≥n ",-1))],2),o(O)?(a(),s("button",{key:0,onClick:oe,class:"h-9 px-3 text-sm text-gray-500 hover:text-gray-700 transition-colors"}," Limpiar ")):E("",!0)])])):E("",!0)]),_:1})])]),e("section",null,[o(b)?(a(),s("div",bi,[...k[18]||(k[18]=[e("div",{class:"w-8 h-8 border-2 border-purple-600 border-t-transparent rounded-full animate-spin mb-4"},null,-1),e("p",{class:"text-sm text-gray-500"},"Cargando pacientes...",-1)])])):o(me).length===0?(a(),s("div",gi,[e("div",fi,[F(o(zt),{class:"w-8 h-8 text-gray-400"})]),e("h3",vi,l(o(X)?"Sin resultados":"Sin pacientes"),1),e("p",xi,l(o(X)?"Prueba ajustando los filtros de b√∫squeda":"Comienza a√±adiendo tu primer paciente"),1),o(X)?(a(),s("button",{key:1,onClick:te,class:"px-4 py-2 text-gray-600 text-sm font-medium hover:text-gray-900 transition-colors"}," Limpiar filtros ")):(a(),s("button",{key:0,onClick:ze,class:"px-4 py-2 bg-purple-600 text-white text-sm font-medium rounded-lg hover:bg-purple-700 transition-colors"}," A√±adir paciente "))])):(a(),s("div",hi,[(a(!0),s(K,null,J(o(me),L=>(a(),s("div",{key:L.id,class:"relative group",onClick:le=>Ve(L.id),onKeydown:Ct(le=>Ve(L.id),["enter"]),role:"listitem"},[F(de,{paciente:L,onEditar:tt,onEliminar:at,onVerCitas:ut,onGestionarBonos:pt,onEditarCita:vt},null,8,["paciente"]),L.activo&&!L.en_pausa?(a(),s("button",{key:0,onClick:ae(le=>dt(L),["stop"]),class:"absolute bottom-4 right-4 h-9 px-3 bg-purple-600 text-white text-sm font-medium rounded-lg shadow-md hover:bg-purple-700 transition-all flex items-center gap-1.5 opacity-0 group-hover:opacity-100 pointer-events-none group-hover:pointer-events-auto z-10","aria-label":`Asignar cita a ${L.nombre}`},[F(o(Qe),{class:"w-4 h-4"}),k[19]||(k[19]=e("span",{class:"hidden sm:inline"},"Cita",-1))],8,_i)):E("",!0)],40,yi))),128))])),o(me).length>0?(a(),s("footer",wi,[e("span",null,l(o(me).length===o(De)?`${o(De)} pacientes`:`${o(me).length} de ${o(De)} pacientes`),1)])):E("",!0)]),F(xe,{mostrar:o(d),"paciente-preseleccionado":o($),onCerrar:qe,onCitaCreada:ct},null,8,["mostrar","paciente-preseleccionado"]),F(ee,{mostrar:o(_),onCerrar:et,onPacienteCreado:rt},null,8,["mostrar"]),F(he,{mostrar:o(S),paciente:o(D),onCerrar:ot,onPacienteActualizado:nt},null,8,["mostrar","paciente"]),F(be,{mostrar:o(N),paciente:o(D),onCerrar:st,onPacienteEliminado:lt,onPacienteDesactivado:it},null,8,["mostrar","paciente"]),F(Me,{isOpen:o(r),citaId:o(H),onClose:Re,onActualizado:xt},null,8,["isOpen","citaId"]),F(re),F(Ee,{modelValue:o(p),"onUpdate:modelValue":k[7]||(k[7]=L=>ie(p)?p.value=L:null),"existing-patients":o(y),onImportComplete:gt},null,8,["modelValue","existing-patients"]),F(ye,{modelValue:o(V),"onUpdate:modelValue":k[8]||(k[8]=L=>ie(V)?V.value=L:null),"total-patients":o(De),"filtered-count":o(me).length,"has-filters":o(O)||o(m)!=="todos"||o(i)!=="","current-filters":o(ft)},null,8,["modelValue","total-patients","filtered-count","has-filters","current-filters"])])}}};export{Yi as default};
