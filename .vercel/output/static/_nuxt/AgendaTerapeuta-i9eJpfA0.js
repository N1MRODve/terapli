import{c as n,o as s,a as e,p as ut,L as Tt,r as _,x as I,M as Ft,E as vt,e as be,N as ot,O as He,t as c,l as j,h as $,F as K,y as J,A,d as ie,b as Y,C as ye,j as Z,G as rt,k as De,v as Oe,z as st,D as ze,g as Lt,K as nt,B as lt}from"#entry";import{_ as we}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as It,_ as Rt}from"./ModalNuevaCitaEnhanced-ClfMSGs5.js";import{M as Ht}from"./ModalDetallesCita-CZ6Vzvt2.js";import{a as le}from"./usePacientes-C3tEKyu9.js";import{r as it}from"./CheckCircleIcon-BzuOBYCH.js";import{r as Nt,a as Ot}from"./FunnelIcon-BLGTimpY.js";import{r as Vt}from"./ClipboardDocumentListIcon-CSBwmCjC.js";import{r as Pt}from"./PlusIcon-UqRq4KLf.js";import{r as qt}from"./MagnifyingGlassIcon-B5My0XuL.js";import{r as dt}from"./XMarkIcon-DWNj0d99.js";import{r as Ut}from"./UserIcon-G1mM6o1b.js";function ct(l,y){return s(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15"})])}const hn={pendiente:{border:"border-amber-200 dark:border-amber-800",bg:"bg-white dark:bg-zinc-800",badge:"bg-amber-400 dark:bg-amber-500",dot:"bg-amber-400 dark:bg-amber-500",hover:"hover:bg-amber-50 dark:hover:bg-amber-950/20"},confirmada:{border:"border-emerald-200 dark:border-emerald-800",bg:"bg-white dark:bg-zinc-800",badge:"bg-emerald-400 dark:bg-emerald-500",dot:"bg-emerald-400 dark:bg-emerald-500",hover:"hover:bg-emerald-50 dark:hover:bg-emerald-950/20"},cancelada:{border:"border-rose-200 dark:border-rose-800",bg:"bg-white dark:bg-zinc-800",badge:"bg-rose-400 dark:bg-rose-500",dot:"bg-rose-400 dark:bg-rose-500",hover:"hover:bg-rose-50 dark:hover:bg-rose-950/20"},realizada:{border:"border-blue-200 dark:border-blue-800",bg:"bg-white dark:bg-zinc-800",badge:"bg-blue-400 dark:bg-blue-500",dot:"bg-blue-400 dark:bg-blue-500",hover:"hover:bg-blue-50 dark:hover:bg-blue-950/20"}},Kt=l=>new Date(l+"T00:00:00").toLocaleDateString("es-ES",{day:"2-digit",month:"long",year:"numeric"}),Ne=l=>new Date(l+"T00:00:00").toLocaleDateString("es-ES",{month:"long",year:"numeric"}),xn=l=>new Date(l+"T00:00:00").toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"short"}),Yt=l=>{const y=new Date(l+"T00:00:00"),u=new Date(y.getFullYear(),0,1),b=y.getTime()-u.getTime(),h=1e3*60*60*24;return Math.ceil((b/h+u.getDay()+1)/7)},Wt=(l,y)=>{const u=typeof y=="string"?y:y.toISOString().split("T")[0];switch(l){case"dia":return Kt(u);case"5dias":return`${Ne(u)} ‚Äî 5 d√≠as`;case"semana":return`${Ne(u)} ‚Äî Semana ${Yt(u)}`;case"mes":return Ne(u);default:return""}},yn=(l="08:00",y="20:00",u=30)=>{const b=[],[h,S]=l.split(":").map(Number),[w,D]=y.split(":").map(Number);let z=h,C=S;for(;z<w||z===w&&C<D;)b.push(`${String(z).padStart(2,"0")}:${String(C).padStart(2,"0")}`),C+=u,C>=60&&(z++,C-=60);return b},wn=(l,y)=>{const u=new Date(l+"T00:00:00");return u.setDate(u.getDate()+y),u.toISOString().split("T")[0]},_n=l=>{const y=new Date(l+"T00:00:00"),u=y.getDay(),b=u===0?-6:1-u;return y.setDate(y.getDate()+b),y.toISOString().split("T")[0]};function Gt(){const l=ut(),y=Tt(),u=_([]),b=_(!1),h=_(null),S=_(null),w=_({});_(new Map);const D=I(()=>{const i=new Date().toISOString().split("T")[0];return u.value.filter(r=>r.fecha_cita===i)}),z=I(()=>u.value.filter(i=>i.estado==="pendiente"||i.estado==="confirmada")),C=I(()=>u.value.filter(i=>i.estado==="completada"||i.estado==="realizada")),H=I(()=>u.value.filter(i=>i.bono&&i.bono.sesiones_restantes<=2&&i.bono.sesiones_restantes>0&&(i.estado==="pendiente"||i.estado==="confirmada"))),g=async i=>{try{if(b.value=!0,h.value=null,!y.value?.id)throw new Error("Usuario no autenticado");let r=l.from("citas").select(`
          id,
          fecha_cita,
          hora_inicio,
          hora_fin,
          estado,
          modalidad,
          observaciones,
          paciente_id,
          terapeuta_id,
          bono_id,
          sesion_descontada,
          consumo_registrado,
          paciente:pacientes (
            id,
            nombre_completo,
            telefono,
            email
          ),
          bono:bonos (
            id,
            sesiones_restantes,
            sesiones_totales,
            estado
          )
        `).eq("terapeuta_id",y.value.id);i?.fechaInicio&&(r=r.gte("fecha_cita",i.fechaInicio)),i?.fechaFin&&(r=r.lte("fecha_cita",i.fechaFin)),i?.incluirCompletadas||(r=r.in("estado",["pendiente","confirmada"])),r=r.order("fecha_cita",{ascending:!0}).order("hora_inicio",{ascending:!0});const{data:f,error:m}=await r;if(m)throw m;return u.value=f||[],console.log(`‚úÖ [Agenda] Cargadas ${u.value.length} citas`),u.value}catch(r){throw console.error("‚ùå [Agenda] Error al cargar citas:",r),h.value=r.message||"Error al cargar citas",r}finally{b.value=!1}},k=async i=>{try{console.log(`üîÑ [Agenda] Completando cita: ${i}`);const{data:r,error:f}=await l.rpc("completar_cita",{p_cita_id:i});if(f)throw console.error("‚ùå [Agenda] Error en RPC:",f),f;const m=r;if(m.success){console.log("‚úÖ [Agenda] Cita completada exitosamente");const E=u.value.findIndex(B=>B.id===i);if(E!==-1){const B=u.value[E];B&&(B.estado="completada",B.sesion_descontada=!0,B.consumo_registrado=!0,B.bono&&m.sesiones_despues!==void 0&&(B.bono.sesiones_restantes=m.sesiones_despues,m.bono_completado&&(B.bono.estado="completado")))}return m.alerta?fe(m):q("success",m.message),await g(),m}else return m.warning?(console.warn("‚ö†Ô∏è [Agenda] Advertencia:",m.message),q("warning",m.message)):(console.error("‚ùå [Agenda] Error:",m.message),q("error",m.message||"No se pudo completar la cita")),m}catch(r){console.error("‚ùå [Agenda] Error al completar cita:",r);const f=r.message||"Error desconocido al completar cita";return q("error",f),{success:!1,message:f,error:r.code||"unknown_error"}}},N=async i=>{try{const{data:r,error:f}=await l.rpc("obtener_historial_bono",{p_bono_id:i});if(f)throw f;return console.log(`‚úÖ [Agenda] Historial de bono obtenido: ${r?.length||0} movimientos`),r||[]}catch(r){throw console.error("‚ùå [Agenda] Error al obtener historial:",r),r}},P=async i=>{try{const{data:r,error:f}=await l.rpc("verificar_bono_citas",{p_bono_id:i});if(f)throw f;return console.log("‚úÖ [Agenda] Verificaci√≥n de bono:",r),r?.alerta&&console.warn("‚ö†Ô∏è [Agenda] Alerta en bono:",r.mensaje_alerta),r}catch(r){throw console.error("‚ùå [Agenda] Error al verificar bono:",r),r}},M=_([]),v=async()=>{try{console.log("üîç [Agenda] Detectando inconsistencias...");const{data:i,error:r}=await l.from("citas").select(`
          id,
          fecha_cita,
          hora_inicio,
          hora_fin,
          estado,
          modalidad,
          observaciones,
          paciente_id,
          terapeuta_id,
          bono_id,
          sesion_descontada,
          consumo_registrado,
          paciente:pacientes (
            id,
            nombre_completo,
            telefono,
            email
          ),
          bono:bonos (
            id,
            sesiones_restantes,
            sesiones_totales,
            estado
          )
        `).in("estado",["completada","realizada"]).not("bono_id","is",null).or("sesion_descontada.eq.false,consumo_registrado.eq.false").eq("terapeuta_id",y.value?.id||"");if(r)throw r;return M.value=i||[],M.value.length>0?console.warn(`‚ö†Ô∏è [Agenda] ${M.value.length} cita(s) con inconsistencias detectadas`):console.log("‚úÖ [Agenda] No se detectaron inconsistencias"),M.value}catch(i){return console.error("‚ùå [Agenda] Error al detectar inconsistencias:",i),M.value=[],[]}},p=async i=>{try{console.log(`üîÑ [Agenda] Re-sincronizando bono para cita: ${i}`);const{data:r,error:f}=await l.rpc("actualizar_bono_por_cita",{p_cita_id:i});if(f)throw f;const m=r;return m.success?(console.log("‚úÖ [Agenda] Bono re-sincronizado exitosamente"),m.warning==="ya_descontada"?q("info","Esta sesi√≥n ya estaba descontada"):(q("success","Bono re-sincronizado correctamente"),m.alerta&&m.mensaje_alerta&&setTimeout(()=>{q("warning",m.mensaje_alerta)},500)),await Promise.all([g(),v()]),m):(console.warn("‚ö†Ô∏è [Agenda] No se pudo re-sincronizar:",m.message),q("warning",m.message||"No se pudo re-sincronizar"),m)}catch(r){throw console.error("‚ùå [Agenda] Error al re-sincronizar bono:",r),q("error","Error al re-sincronizar el bono"),r}},F=async()=>{if(M.value.length===0){q("info","No hay citas pendientes de sincronizaci√≥n");return}try{console.log(`üîÑ [Agenda] Re-sincronizando ${M.value.length} citas...`);let i=0,r=0,f=0;for(const B of M.value)try{const T=await p(B.id);T.success?T.warning==="ya_descontada"?f++:i++:r++,await new Promise(R=>setTimeout(R,300))}catch{r++}const m=[];i>0&&m.push(`${i} sincronizada(s)`),f>0&&m.push(`${f} ya estaba(n) descontada(s)`),r>0&&m.push(`${r} fallida(s)`);const E=`‚úÖ Re-sincronizaci√≥n completa: ${m.join(", ")}`;q(r===0?"success":"warning",E),console.log("‚úÖ [Agenda] Re-sincronizaci√≥n masiva completada:",{exitosos:i,yaDescontados:f,fallidos:r})}catch(i){console.error("‚ùå [Agenda] Error en re-sincronizaci√≥n masiva:",i),q("error","Error al re-sincronizar todas las citas")}},W=()=>{if(!y.value?.id){console.warn("‚ö†Ô∏è [Agenda] No se puede suscribir sin usuario autenticado");return}S.value&&l.removeChannel(S.value),console.log("üì° [Agenda] Iniciando suscripci√≥n Realtime..."),S.value=l.channel(`citas_terapeuta_${y.value.id}`).on("postgres_changes",{event:"*",schema:"public",table:"citas",filter:`terapeuta_id=eq.${y.value.id}`},async i=>{console.log("üì° [Realtime] Cambio detectado en citas:",i.eventType),await g(),i.eventType==="INSERT"?q("info","Nueva cita agregada a tu agenda"):i.eventType==="UPDATE"?q("info","Una cita ha sido actualizada"):i.eventType==="DELETE"&&q("warning","Una cita ha sido eliminada")}).subscribe(i=>{i==="SUBSCRIBED"?console.log("‚úÖ [Realtime] Suscripci√≥n activa"):i==="CHANNEL_ERROR"?console.error("‚ùå [Realtime] Error en suscripci√≥n"):i==="TIMED_OUT"&&console.warn("‚ö†Ô∏è [Realtime] Tiempo de espera agotado")})},pe=()=>{S.value&&(console.log("üì° [Realtime] Cerrando suscripci√≥n..."),l.removeChannel(S.value),S.value=null)},q=(i,r)=>{typeof window<"u"&&window.$toast?window.$toast[i](r):console.log(`${{success:"‚úÖ",error:"‚ùå",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è"}[i]} [Agenda] ${r}`)},fe=i=>{if(!i.alerta||!i.mensaje_alerta)return;const r=i.tipo_alerta==="bono_agotado"?"success":(i.tipo_alerta==="ultima_sesion","warning");q(r,i.mensaje_alerta)};Ft(()=>{y.value?.id&&(g(),W())}),vt(()=>{pe()});const te=I(()=>{let i=u.value;if(w.value.paciente&&(i=i.filter(r=>r.paciente?.nombre_completo.toLowerCase().includes(w.value.paciente.toLowerCase()))),w.value.busqueda){const r=w.value.busqueda.toLowerCase();i=i.filter(f=>f.paciente?.nombre_completo.toLowerCase().includes(r)||f.observaciones?.toLowerCase().includes(r)||f.fecha_cita.includes(r))}return w.value.estado&&w.value.estado.length>0&&(i=i.filter(r=>w.value.estado.includes(r.estado))),w.value.area_terapeutica&&(i=i.filter(r=>r.area_terapeutica===w.value.area_terapeutica)),w.value.tipo_sesion&&w.value.tipo_sesion.length>0&&(i=i.filter(r=>r.tipo_sesion&&w.value.tipo_sesion.includes(r.tipo_sesion))),w.value.fecha_desde&&(i=i.filter(r=>r.fecha_cita>=w.value.fecha_desde)),w.value.fecha_hasta&&(i=i.filter(r=>r.fecha_cita<=w.value.fecha_hasta)),i}),_e=i=>{w.value={...i}},he=()=>{w.value={}},Ae=async(i,r,f,m)=>{try{b.value=!0;const{data:E,error:B}=await l.from("citas").update({fecha_cita:r,hora_inicio:f,hora_fin:m||f,updated_at:new Date().toISOString()}).eq("id",i).select().single();if(B)throw B;const T=u.value.findIndex(R=>R.id===i);return T!==-1&&E&&(u.value[T]={...u.value[T],...E}),{success:!0,cita:E}}catch(E){return console.error("Error al reprogramar cita:",E),{success:!1,error:E.message}}finally{b.value=!1}},de=async(i,r,f)=>{try{const{data:m,error:E}=await l.from("citas").update({notas_rapidas:r,enlace_videollamada:f,updated_at:new Date().toISOString()}).eq("id",i).select().single();if(E)throw E;const B=u.value.findIndex(T=>T.id===i);return B!==-1&&m&&(u.value[B]={...u.value[B],...m}),{success:!0}}catch(m){return console.error("Error al actualizar notas:",m),{success:!1,error:m.message}}},X=async i=>{try{const r=i||y.value?.id;if(!r)throw new Error("ID de terapeuta requerido");const{data:f,error:m}=await l.from("terapeutas").select("disponibilidad").eq("id",r).single();if(m)throw m;return f?.disponibilidad||[]}catch(r){return console.error("Error al obtener disponibilidad:",r),[]}},Ee=(i,r)=>{const f=new Date(i+"T00:00:00").getDay(),m=u.value.filter(T=>T.fecha_cita===i),E=r.filter(T=>T.dia_semana===f&&T.disponible);if(E.length===0)return[];const B=[];return E.forEach(T=>{const R=T.hora_inicio,ue=T.hora_fin;m.some(ee=>ee.hora_inicio>=R&&ee.hora_inicio<ue||ee.hora_fin>R&&ee.hora_fin<=ue||ee.hora_inicio<=R&&ee.hora_fin>=ue)||B.push({hora_inicio:R,hora_fin:ue})}),B},Se=async i=>{try{const r=u.value.find(T=>T.id===i);if(!r||!r.paciente)return{success:!1,error:"Cita no encontrada"};const f=new Date(r.fecha_cita+"T"+r.hora_inicio),m=new Date;return new Date(f.getTime()-1440*60*1e3)>m&&!r.recordatorio_24h_enviado&&(await l.from("notificaciones").insert({usuario_id:r.paciente_id,tipo:"cita",titulo:"üìÖ Recordatorio: Cita ma√±ana",mensaje:`Tu cita est√° programada para ma√±ana ${r.fecha_cita} a las ${r.hora_inicio}`,metadata:{cita_id:i,tipo_recordatorio:"24h",fecha_cita:r.fecha_cita,hora:r.hora_inicio}}),await l.from("citas").update({recordatorio_24h_enviado:!0}).eq("id",i)),new Date(f.getTime()-14400*1e3)>m&&!r.recordatorio_4h_enviado&&(await l.from("notificaciones").insert({usuario_id:r.paciente_id,tipo:"cita",titulo:"‚è∞ Recordatorio: Cita en 4 horas",mensaje:`Tu cita est√° programada para hoy ${r.fecha_cita} a las ${r.hora_inicio}`,metadata:{cita_id:i,tipo_recordatorio:"4h",fecha_cita:r.fecha_cita,hora:r.hora_inicio,enlace_videollamada:r.enlace_videollamada}}),await l.from("citas").update({recordatorio_4h_enviado:!0}).eq("id",i)),{success:!0}}catch(r){return console.error("Error al programar recordatorios:",r),{success:!1,error:r.message}}},ke=(i,r)=>{const f=u.value.filter(m=>{const E=m.fecha_cita===i,B=r?m.terapeuta_id===r:!0,T=["pendiente","confirmada"].includes(m.estado);return E&&B&&T});return{total:f.length,confirmadas:f.filter(m=>m.estado==="confirmada").length,pendientes:f.filter(m=>m.estado==="pendiente").length}};return{citas:u,loading:b,error:h,filtros:w,citasDelDia:D,citasPendientes:z,citasCompletadas:C,citasConBonoProximoAgotar:H,citasFiltradas:te,getCitasDelTerapeuta:g,completarCita:k,obtenerHistorialBono:N,verificarBonoCitas:P,citasPendientesSync:M,detectarInconsistencias:v,resincronizarBono:p,resincronizarTodos:F,aplicarFiltros:_e,limpiarFiltros:he,reprogramarCita:Ae,actualizarNotasRapidas:de,obtenerDisponibilidad:X,calcularHuecosLibres:Ee,programarRecordatorios:Se,calcularCargaDiaria:ke,obtenerResumenSemanal:i=>{const r=new Date(i+"T00:00:00"),f=[];for(let m=0;m<7;m++){const E=new Date(r);E.setDate(r.getDate()+m);const B=E.toISOString().split("T")[0]||"";if(!B)continue;const T=ke(B);f.push({fecha:B,dia:E.toLocaleDateString("es-ES",{weekday:"short"}),citas:T.total,confirmadas:T.confirmadas,pendientes:T.pendientes})}return f},obtenerResumenMensual:(i,r)=>{const f=new Date(i,r+1,0),m=new Map;for(let E=1;E<=f.getDate();E++){const T=new Date(i,r,E).toISOString().split("T")[0]||"";if(!T)continue;const R=ke(T);m.set(T,{dia:E,citas:R.total,confirmadas:R.confirmadas,pendientes:R.pendientes})}return m},suscribirCitasRealtime:W,desuscribirCitasRealtime:pe}}const Zt={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 px-4 py-3 bg-white dark:bg-gray-900 border-b border-cafe/10 dark:border-gray-800"},Jt={class:"flex items-center gap-3"},Qt={class:"text-lg sm:text-xl font-['Elms_Sans'] font-bold text-neutral-800 dark:text-gray-100 capitalize"},Xt={class:"flex items-center gap-3"},ea={class:"flex items-center bg-gray-100 dark:bg-gray-800 rounded-lg p-1"},ta=["onClick","title"],aa=["title"],oa={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ra={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},sa={key:0,class:"hidden lg:flex items-center gap-2"},na={class:"px-3 py-1.5 bg-purple-50 dark:bg-purple-900/30 border border-purple-200 dark:border-purple-700 rounded-lg"},la={class:"text-sm font-semibold text-purple-700 dark:text-purple-400"},ia=be({__name:"AgendaHeader",props:ot({rolActivo:{default:"terapeuta"},mostrarRol:{type:Boolean,default:!1}},{vista:{default:"semana"},vistaModifiers:{},fechaActual:{default:()=>new Date},fechaActualModifiers:{},darkMode:{type:Boolean,default:!1},darkModeModifiers:{}}),emits:ot(["nueva-cita"],["update:vista","update:fechaActual","update:darkMode"]),setup(l,{emit:y}){const u=He(l,"vista"),b=He(l,"fechaActual"),h=He(l,"darkMode"),S=y,w=[{value:"dia",label:"D√≠a",shortcut:"1"},{value:"5dias",label:"5 D√≠as",shortcut:"4"},{value:"semana",label:"Semana",shortcut:"2"},{value:"mes",label:"Mes",shortcut:"3"}],D=I(()=>Wt(u.value,b.value)),z=()=>{b.value=new Date},C=()=>{const g=new Date(b.value);switch(u.value){case"dia":g.setDate(g.getDate()-1);break;case"5dias":g.setDate(g.getDate()-5);break;case"semana":g.setDate(g.getDate()-7);break;case"mes":g.setMonth(g.getMonth()-1);break}b.value=g},H=()=>{const g=new Date(b.value);switch(u.value){case"dia":g.setDate(g.getDate()+1);break;case"5dias":g.setDate(g.getDate()+5);break;case"semana":g.setDate(g.getDate()+7);break;case"mes":g.setMonth(g.getMonth()+1);break}b.value=g};return(g,k)=>(s(),n("div",Zt,[e("div",Jt,[e("div",{class:"flex items-center gap-1"},[e("button",{onClick:C,class:"p-2 rounded-lg hover:bg-purple-50 dark:hover:bg-gray-800 text-cafe/70 dark:text-gray-400 hover:text-purple-600 dark:hover:text-purple-400 transition-colors",title:"Anterior"},[...k[2]||(k[2]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),e("button",{onClick:z,class:"px-3 py-1.5 text-sm font-medium rounded-lg border border-purple-200 dark:border-purple-700 text-purple-600 dark:text-purple-400 hover:bg-purple-50 dark:hover:bg-purple-900/30 transition-colors"}," Hoy "),e("button",{onClick:H,class:"p-2 rounded-lg hover:bg-purple-50 dark:hover:bg-gray-800 text-cafe/70 dark:text-gray-400 hover:text-purple-600 dark:hover:text-purple-400 transition-colors",title:"Siguiente"},[...k[3]||(k[3]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])])]),e("h1",Qt,c(j(D)),1)]),e("div",Xt,[e("div",ea,[(s(),n(K,null,J(w,N=>e("button",{key:N.value,onClick:P=>u.value=N.value,class:A(["px-3 py-1.5 text-sm font-medium rounded-md transition-all",u.value===N.value?"bg-white dark:bg-gray-700 text-purple-600 dark:text-purple-400 shadow-sm":"text-cafe/70 dark:text-gray-400 hover:text-cafe dark:hover:text-gray-200"]),title:`Vista ${N.label} (${N.shortcut})`},c(N.label),11,ta)),64))]),e("button",{onClick:k[0]||(k[0]=N=>h.value=!h.value),class:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-cafe/70 dark:text-gray-400 transition-colors",title:h.value?"Modo claro":"Modo oscuro"},[h.value?(s(),n("svg",ra,[...k[5]||(k[5]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"},null,-1)])])):(s(),n("svg",oa,[...k[4]||(k[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"},null,-1)])]))],8,aa),e("button",{onClick:k[1]||(k[1]=N=>S("nueva-cita")),class:"flex items-center gap-2 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white text-sm font-medium rounded-lg shadow-sm hover:shadow transition-all"},[...k[6]||(k[6]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("span",{class:"hidden sm:inline"},"Nueva Cita",-1)])]),l.mostrarRol?(s(),n("div",sa,[e("div",na,[e("span",la,c(l.rolActivo==="coordinadora"?"Coordinadora":"Terapeuta"),1)])])):$("",!0)])]))}}),da=Object.assign(ia,{__name:"AgendaHeader"});function ca(l,y){return s(),n("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M19.916 4.626a.75.75 0 0 1 .208 1.04l-9 13.5a.75.75 0 0 1-1.154.114l-6-6a.75.75 0 0 1 1.06-1.06l5.353 5.353 8.493-12.74a.75.75 0 0 1 1.04-.207Z","clip-rule":"evenodd"})])}const ua={class:"flex items-start justify-between gap-4"},va={class:"flex-1 min-w-0"},ma={class:"flex items-center gap-3 mb-2 flex-wrap"},ga={class:"flex items-center gap-2"},ba={class:"truncate"},pa={key:0,class:"text-gray-400"},fa={key:1,class:"capitalize truncate"},ha={key:0,class:"flex items-center gap-2"},xa={class:"truncate"},ya={class:"flex items-center justify-between gap-2"},wa={class:"flex-1 min-w-0"},_a={class:"text-xs font-medium text-gray-700 mb-1"},ka={class:"flex items-center gap-2 flex-wrap"},Ca={class:"text-xs text-gray-500 capitalize"},$a={key:1,class:"mt-3 p-3 bg-gray-50 border border-gray-200 rounded-lg"},Da={key:2,class:"mt-3 p-2 bg-gray-50 rounded text-xs text-gray-700"},Aa={class:"flex flex-col gap-2"},Sa=be({__name:"TarjetaCita",props:{cita:{},compact:{type:Boolean}},emits:["completar","verHistorial"],setup(l,{emit:y}){const u=l,b=y,h=z=>z.substring(0,5),S=I(()=>{const z=u.cita.estado;return{pendiente:"bg-yellow-100 text-yellow-800 border-yellow-300",confirmada:"bg-blue-100 text-blue-800 border-blue-300",completada:"bg-green-100 text-green-800 border-green-300",realizada:"bg-green-100 text-green-800 border-green-300",cancelada:"bg-red-100 text-red-800 border-red-300"}[z]||"bg-gray-100 text-gray-800 border-gray-300"}),w=I(()=>{if(!u.cita.bono)return null;const z=u.cita.bono.sesiones_restantes,C=u.cita.bono.estado;return C==="completado"||z===0?{color:"text-red-600",icono:"üö´",alerta:!0,mensajeAlerta:"Bono agotado",clase:"bg-red-50 border-red-200"}:z===1?{color:"text-orange-600",icono:"‚ö†Ô∏è",alerta:!0,mensajeAlerta:"√öltima sesi√≥n del bono",clase:"bg-orange-50 border-orange-200"}:z<=2?{color:"text-yellow-600",icono:"‚ö†Ô∏è",alerta:!0,mensajeAlerta:"Pocas sesiones restantes",clase:"bg-yellow-50 border-yellow-200"}:C==="activo"?{color:"text-green-600",icono:"‚úì",alerta:!1,mensajeAlerta:null,clase:"bg-green-50 border-green-200"}:{color:"text-gray-600",icono:"‚ÑπÔ∏è",alerta:!1,mensajeAlerta:null,clase:"bg-gray-50 border-gray-200"}}),D=I(()=>u.cita.estado==="pendiente"||u.cita.estado==="confirmada");return(z,C)=>(s(),n("div",{class:A(["border rounded-xl shadow-sm hover:shadow-md transition-all duration-200 bg-white overflow-hidden",l.compact?"p-3":"p-5"])},[e("div",ua,[e("div",va,[e("div",ma,[e("h3",{class:A([l.compact?"text-base":"text-lg","font-semibold text-gray-900 truncate"])},c(l.cita.paciente?.nombre_completo||"Paciente"),3),e("span",{class:A(["px-3 py-1 text-xs font-medium rounded-full border",j(S)])},c(l.cita.estado.toUpperCase()),3)]),e("div",{class:A(["space-y-1",l.compact?"text-xs":"text-sm","text-gray-600"])},[e("div",ga,[C[2]||(C[2]=e("svg",{class:"h-4 w-4 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",ba,c(h(l.cita.hora_inicio))+" - "+c(h(l.cita.hora_fin)),1),l.cita.modalidad?(s(),n("span",pa,"‚Ä¢")):$("",!0),l.cita.modalidad?(s(),n("span",fa,c(l.cita.modalidad),1)):$("",!0)]),l.cita.paciente?.telefono&&!l.compact?(s(),n("div",ha,[C[3]||(C[3]=e("svg",{class:"h-4 w-4 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})],-1)),e("span",xa,c(l.cita.paciente.telefono),1)])):$("",!0)],2),l.cita.bono?(s(),n("div",{key:0,class:A(["mt-3 p-3 rounded-lg border",j(w)?.clase||"bg-gray-50 border-gray-200"])},[e("div",ya,[e("div",wa,[e("p",_a,c(j(w)?.icono)+" Bono de Sesiones ",1),e("div",ka,[e("p",{class:A(["text-sm font-semibold",j(w)?.color||"text-gray-900"])},c(l.cita.bono.sesiones_restantes)+" / "+c(l.cita.bono.sesiones_totales)+" sesiones ",3),e("span",Ca," ("+c(l.cita.bono.estado)+") ",1)]),j(w)?.alerta?(s(),n("p",{key:0,class:A(["mt-2 text-xs font-medium",j(w).color])},c(j(w).mensajeAlerta),3)):$("",!0)]),l.compact?$("",!0):(s(),n("button",{key:0,onClick:C[0]||(C[0]=H=>b("verHistorial",l.cita.bono.id)),class:"text-xs text-blue-600 hover:text-blue-800 font-medium whitespace-nowrap px-2 py-1 hover:bg-blue-50 rounded transition-colors",type:"button"}," üìä Historial "))])],2)):(s(),n("div",$a,[...C[4]||(C[4]=[e("p",{class:"text-xs text-gray-500 italic flex items-center gap-2"},[e("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),ie(" Sin bono activo - Consulta individual ")],-1)])])),l.cita.observaciones&&!l.compact?(s(),n("div",Da,[C[5]||(C[5]=e("p",{class:"font-medium text-gray-500 mb-1"},"Observaciones:",-1)),ie(" "+c(l.cita.observaciones),1)])):$("",!0)]),e("div",Aa,[j(D)?(s(),n("button",{key:0,onClick:C[1]||(C[1]=H=>b("completar",l.cita.id)),class:A(["px-4 py-2 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 transition-colors",l.compact?"text-xs":"text-sm"]),type:"button"}," ‚úÖ Completar ",2)):l.cita.estado==="completada"||l.cita.estado==="realizada"?(s(),n("span",{key:1,class:A(["px-4 py-2 bg-green-100 text-green-800 font-medium rounded-lg text-center",l.compact?"text-xs":"text-sm"])}," ‚úì Completada ",2)):$("",!0)])])],2))}}),Ma=Object.assign(we(Sa,[["__scopeId","data-v-3085384e"]]),{__name:"TarjetaCita"}),za={class:"space-y-3"},Ea={class:"flex items-center justify-between"},ja={class:"flex items-center gap-3"},Ba={key:0,class:"px-3 py-1 bg-gradient-to-r from-teal-500 to-teal-600 text-white text-xs font-bold rounded-full shadow-sm"},Ta={key:1,class:"px-3 py-1 bg-gray-100 text-gray-700 text-xs font-semibold rounded-full"},Fa={key:2,class:"px-3 py-1 bg-orange-100 text-orange-700 text-xs font-bold rounded-full animate-pulse"},La={class:"flex items-center gap-2"},Ia={class:"flex flex-wrap gap-3"},Ra=["onClick","aria-pressed","onKeydown"],Ha={class:"text-lg leading-none"},Na={class:"font-bold"},Oa={key:0,class:"mt-4 text-center py-8 px-4 bg-orange-50 rounded-xl border-2 border-orange-200"},Va={key:1,class:"mt-4 text-center py-8 px-4 bg-gray-50 rounded-xl border-2 border-gray-200"},Pa=be({__name:"AgendaStatusFilters",props:{citas:{},estadosActivos:{default:()=>["pendiente","confirmada","realizada","cancelada"]}},emits:["filtrar","update:estadosActivos"],setup(l,{emit:y}){const u=l,b=y,h=_(new Set(u.estadosActivos)),S=[{key:"pendiente",label:"Pendientes",emoji:"‚è≥",bgInactive:"bg-white hover:bg-yellow-50",textInactive:"text-yellow-700",borderInactive:"border-yellow-300",bgActive:"bg-yellow-500",textActive:"text-white",borderActive:"border-yellow-600",ringColor:"ring-yellow-500"},{key:"confirmada",label:"Confirmadas",emoji:"‚úì",bgInactive:"bg-white hover:bg-emerald-50",textInactive:"text-emerald-700",borderInactive:"border-emerald-300",bgActive:"bg-emerald-500",textActive:"text-white",borderActive:"border-emerald-600",ringColor:"ring-emerald-500"},{key:"realizada",label:"Realizadas",emoji:"‚úî",bgInactive:"bg-white hover:bg-blue-50",textInactive:"text-blue-700",borderInactive:"border-blue-300",bgActive:"bg-blue-500",textActive:"text-white",borderActive:"border-blue-600",ringColor:"ring-blue-500"},{key:"cancelada",label:"Canceladas",emoji:"‚úï",bgInactive:"bg-white hover:bg-red-50",textInactive:"text-red-700",borderInactive:"border-red-300",bgActive:"bg-red-500",textActive:"text-white",borderActive:"border-red-600",ringColor:"ring-red-500"}],w=v=>u.citas.filter(p=>p.estado===v).length,D=I(()=>u.citas.length),z=I(()=>h.value.size===0?u.citas.length:u.citas.filter(v=>h.value.has(v.estado)).length),C=I(()=>h.value.size<S.length&&h.value.size>0),H=I(()=>h.value.size===S.length),g=v=>{h.value.has(v)?h.value.delete(v):h.value.add(v);const p=Array.from(h.value);b("update:estadosActivos",p),b("filtrar",p)},k=()=>{S.forEach(p=>h.value.add(p.key));const v=Array.from(h.value);b("update:estadosActivos",v),b("filtrar",v)},N=()=>{h.value.clear(),b("update:estadosActivos",[]),b("filtrar",[])},P=v=>h.value.has(v),M=v=>["relative flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-semibold border-2 transition-all duration-200 cursor-pointer select-none","hover:shadow-md hover:-translate-y-0.5 active:translate-y-0","focus:outline-none focus:ring-2 focus:ring-offset-2",P(v.key)?[v.bgActive,v.textActive,v.borderActive,"shadow-sm"]:[v.bgInactive,v.textInactive,v.borderInactive],v.ringColor];return(v,p)=>(s(),n("div",za,[e("div",Ea,[e("div",ja,[p[0]||(p[0]=e("h3",{class:"text-sm font-bold text-gray-800 uppercase tracking-wide"},"Filtrar por Estado",-1)),C.value?(s(),n("div",Ba,c(z.value)+" de "+c(D.value)+" citas ",1)):H.value?(s(),n("div",Ta,c(D.value)+" citas totales ",1)):(s(),n("div",Fa," Sin filtros - 0 citas visibles "))]),e("div",La,[H.value?$("",!0):(s(),n("button",{key:0,onClick:k,class:"text-xs font-medium text-teal-600 hover:text-teal-700 hover:underline transition-colors flex items-center gap-1"},[Y(j(it),{class:"w-4 h-4"}),p[1]||(p[1]=ie(" Seleccionar todos ",-1))])),C.value||!H.value?(s(),n("button",{key:1,onClick:N,class:"text-xs font-medium text-gray-500 hover:text-gray-700 hover:underline transition-colors flex items-center gap-1"},[...p[2]||(p[2]=[e("svg",{class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),ie(" Limpiar filtros ",-1)])])):$("",!0)])]),e("div",Ia,[(s(),n(K,null,J(S,F=>e("div",{key:F.key,onClick:W=>g(F.key),class:A(M(F)),role:"button","aria-pressed":P(F.key),tabindex:"0",onKeydown:[ye(W=>g(F.key),["enter"]),ye(Z(W=>g(F.key),["prevent"]),["space"])]},[P(F.key)?(s(),n("div",{key:0,class:A(["absolute -top-2 -right-2 w-6 h-6 bg-white rounded-full flex items-center justify-center shadow-lg border-2",F.borderActive])},[Y(j(it),{class:A(["w-5 h-5",F.textInactive])},null,8,["class"])],2)):$("",!0),e("span",Ha,c(F.emoji),1),e("span",Na,c(F.label),1),e("span",{class:A(["ml-1 px-2 py-0.5 rounded-full text-xs font-bold",P(F.key)?"bg-white/30":"bg-gray-100"])},c(w(F.key)),3)],42,Ra)),64))]),h.value.size===0?(s(),n("div",Oa,[p[3]||(p[3]=e("div",{class:"text-4xl mb-2"},"üîç",-1)),p[4]||(p[4]=e("p",{class:"text-sm font-semibold text-orange-800 mb-1"}," No hay filtros activos ",-1)),p[5]||(p[5]=e("p",{class:"text-xs text-orange-600 mb-3"}," Selecciona al menos un estado para ver las citas ",-1)),e("button",{onClick:k,class:"px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white text-sm font-semibold rounded-lg transition-colors shadow-sm"}," Mostrar todas las citas ")])):z.value===0&&h.value.size>0?(s(),n("div",Va,[p[6]||(p[6]=e("div",{class:"text-4xl mb-2"},"üì≠",-1)),p[7]||(p[7]=e("p",{class:"text-sm font-semibold text-gray-700 mb-1"}," No hay citas con los estados seleccionados ",-1)),p[8]||(p[8]=e("p",{class:"text-xs text-gray-500 mb-3"}," Prueba seleccionando otros estados o todos ",-1)),e("button",{onClick:k,class:"text-sm font-medium text-teal-600 hover:text-teal-700 hover:underline"}," Ver todas las citas ")])):$("",!0)]))}}),qa=Object.assign(we(Pa,[["__scopeId","data-v-8acd89bc"]]),{__name:"AgendaStatusFilters"}),Ua={class:"flex items-center justify-between gap-4 flex-wrap"},Ka={class:"flex items-center gap-3"},Ya={class:"text-sm"},Wa={class:"font-medium text-neutral-800"},Ga={class:"flex items-center gap-1 border border-neutral-200 rounded-lg p-1 bg-white"},Za=["aria-label"],Ja=["aria-label"],Qa={class:"flex items-center gap-3"},Xa={class:"flex bg-neutral-100 rounded-lg p-1",role:"tablist"},eo=["aria-selected"],to=["aria-selected"],ao=["aria-selected"],oo=["disabled"],ro={key:0,class:"text-sm font-medium text-neutral-700"},so={key:1,class:"text-sm font-medium text-neutral-500"},no={key:0,class:"mt-2 text-right"},lo={class:"text-xs text-neutral-400"},io=be({__name:"AgendaViewControls",props:{vista:{},fechaActual:{},loading:{type:Boolean,default:!1},lastUpdateTime:{default:null}},emits:["cambiar-vista","navegar-fecha","ir-hoy","actualizar"],setup(l,{emit:y}){const u=l,b=y,h=I(()=>u.fechaActual.toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long",year:"numeric"})),S=I(()=>h.value.charAt(0).toUpperCase()+h.value.slice(1));return(w,D)=>(s(),n(K,null,[e("div",Ua,[e("div",Ka,[e("div",Ya,[e("span",Wa,c(S.value),1)]),e("div",Ga,[e("button",{onClick:D[0]||(D[0]=z=>b("navegar-fecha",-1)),class:"p-1.5 rounded hover:bg-neutral-100 text-neutral-600 hover:text-neutral-800 transition-colors","aria-label":l.vista==="dia"?"D√≠a anterior":"Semana anterior",title:"Anterior"},[...D[7]||(D[7]=[e("svg",{class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])],8,Za),e("button",{onClick:D[1]||(D[1]=z=>b("ir-hoy")),class:"px-3 py-1.5 text-xs font-semibold text-teal-700 hover:bg-teal-50 rounded transition-colors"}," Hoy "),e("button",{onClick:D[2]||(D[2]=z=>b("navegar-fecha",1)),class:"p-1.5 rounded hover:bg-neutral-100 text-neutral-600 hover:text-neutral-800 transition-colors","aria-label":l.vista==="dia"?"D√≠a siguiente":"Semana siguiente",title:"Siguiente"},[...D[8]||(D[8]=[e("svg",{class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])],8,Ja)])]),e("div",Qa,[e("div",Xa,[e("button",{onClick:D[3]||(D[3]=z=>b("cambiar-vista","dia")),role:"tab","aria-selected":l.vista==="dia",class:A(["px-3 py-1.5 rounded-md text-sm font-medium transition-all",l.vista==="dia"?"bg-white text-neutral-800 shadow-sm":"text-neutral-600 hover:text-neutral-800"])}," D√≠a ",10,eo),e("button",{onClick:D[4]||(D[4]=z=>b("cambiar-vista","calendario")),role:"tab","aria-selected":l.vista==="calendario",class:A(["px-3 py-1.5 rounded-md text-sm font-medium transition-all",l.vista==="calendario"?"bg-white text-neutral-800 shadow-sm":"text-neutral-600 hover:text-neutral-800"])}," Semana ",10,to),e("button",{onClick:D[5]||(D[5]=z=>b("cambiar-vista","lista")),role:"tab","aria-selected":l.vista==="lista",class:A(["px-3 py-1.5 rounded-md text-sm font-medium transition-all",l.vista==="lista"?"bg-white text-neutral-800 shadow-sm":"text-neutral-600 hover:text-neutral-800"])}," Lista ",10,ao)]),e("button",{onClick:D[6]||(D[6]=z=>b("actualizar")),disabled:l.loading,class:"flex items-center gap-2 px-3 py-2 bg-white border border-neutral-200 rounded-lg hover:bg-neutral-50 transition-colors shadow-sm disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Actualizar agenda"},[(s(),n("svg",{class:A(["w-4 h-4 text-teal-600",l.loading?"animate-spin":""]),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[...D[9]||(D[9]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])],2)),l.loading?(s(),n("span",so,"Actualizando...")):(s(),n("span",ro,"Actualizar"))],8,oo)])]),l.lastUpdateTime&&!l.loading?(s(),n("div",no,[e("span",lo,c(l.lastUpdateTime),1)])):$("",!0)],64))}}),co=Object.assign(we(io,[["__scopeId","data-v-c3b9a6c3"]]),{__name:"AgendaViewControls"}),uo={class:"agenda-unified-header"},vo={class:"header-left"},mo={class:"header-title"},go={class:"nav-controls","aria-label":"Navegaci√≥n temporal"},bo=["aria-label","title"],po=["aria-label","title"],fo={class:"header-center"},ho={class:"view-selector",role:"tablist"},xo=["onClick","aria-selected"],yo={class:"header-right"},wo=["disabled"],_o=be({__name:"AgendaUnifiedHeader",props:{vista:{},fechaActual:{},loading:{type:Boolean,default:!1},modoCoordinadora:{type:Boolean,default:!1}},emits:["cambiar-vista","navegar-fecha","ir-hoy","actualizar","nueva-cita","nueva-tarea"],setup(l,{emit:y}){const u=l,b=y,h=I(()=>{const H=new Date(u.fechaActual),g=new Date(H.getFullYear(),0,1),k=Math.floor((H.getTime()-g.getTime())/(1440*60*1e3));return Math.ceil((k+g.getDay()+1)/7)}),S=I(()=>{const H=new Date(u.fechaActual),g=H.getDay(),k=g===0?-6:1-g,N=new Date(H);N.setDate(H.getDate()+k);const P=new Date(N);P.setDate(N.getDate()+6);const M=F=>F.getDate(),v=F=>F.toLocaleDateString("es-ES",{month:"short"}),p=F=>F.getFullYear();return N.getMonth()===P.getMonth()?`${M(N)}‚Äì${M(P)} ${v(P)} ${p(P)}`:`${M(N)} ${v(N)} ‚Äì ${M(P)} ${v(P)} ${p(P)}`}),w=I(()=>u.fechaActual.toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long",year:"numeric"})),D=I(()=>{if(u.vista==="dia"){const H=w.value;return H.charAt(0).toUpperCase()+H.slice(1)}return`Semana ${h.value} ¬∑ ${S.value}`}),z=[{value:"dia",label:"D√≠a"},{value:"calendario",label:"Semana"},{value:"lista",label:"Lista"}],C=I(()=>u.vista==="dia"?{anterior:"D√≠a anterior",siguiente:"D√≠a siguiente"}:{anterior:"Semana anterior",siguiente:"Semana siguiente"});return(H,g)=>(s(),n("header",uo,[e("div",vo,[e("h1",mo,c(D.value),1),e("nav",go,[e("button",{onClick:g[0]||(g[0]=k=>b("navegar-fecha",-1)),class:"nav-btn","aria-label":C.value.anterior,title:C.value.anterior},[...g[6]||(g[6]=[e("svg",{class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])],8,bo),e("button",{onClick:g[1]||(g[1]=k=>b("ir-hoy")),class:"nav-today"}," Hoy "),e("button",{onClick:g[2]||(g[2]=k=>b("navegar-fecha",1)),class:"nav-btn","aria-label":C.value.siguiente,title:C.value.siguiente},[...g[7]||(g[7]=[e("svg",{class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])],8,po)])]),e("div",fo,[e("div",ho,[(s(),n(K,null,J(z,k=>e("button",{key:k.value,onClick:N=>b("cambiar-vista",k.value),role:"tab","aria-selected":l.vista===k.value,class:A(["view-btn",{active:l.vista===k.value}])},c(k.label),11,xo)),64))])]),e("div",yo,[e("button",{onClick:g[3]||(g[3]=k=>b("actualizar")),disabled:l.loading,class:"action-btn action-btn-secondary","aria-label":"Actualizar agenda",title:"Actualizar"},[Y(j(Nt),{class:A(["w-4 h-4",l.loading?"animate-spin":""])},null,8,["class"])],8,wo),l.modoCoordinadora?(s(),n("button",{key:0,onClick:g[4]||(g[4]=k=>b("nueva-tarea")),class:"action-btn action-btn-secondary","aria-label":"Crear nueva tarea"},[Y(j(Vt),{class:"w-4 h-4"}),g[8]||(g[8]=e("span",{class:"hidden sm:inline"},"Nueva tarea",-1))])):$("",!0),e("button",{onClick:g[5]||(g[5]=k=>b("nueva-cita")),class:"action-btn action-btn-primary","aria-label":"Crear nueva cita"},[Y(j(Pt),{class:"w-4 h-4"}),g[9]||(g[9]=e("span",null,"Nueva cita",-1))])])]))}}),ko=Object.assign(we(_o,[["__scopeId","data-v-e95c8bd7"]]),{__name:"AgendaUnifiedHeader"}),Co={class:"filter-bar"},$o={class:"filter-row-main"},Do={class:"search-container"},Ao={key:0,class:"terapeuta-selector"},So=["value"],Mo=["value"],zo={class:"filter-row-states"},Eo={class:"states-label"},jo={class:"states-chips"},Bo=["onClick","aria-pressed"],To={class:"chip-label"},Fo={class:"chip-count"},Lo={class:"results-count"},Io={key:0,class:"results-filtered"},Ro={key:1,class:"results-total"},Ho={key:0,class:"search-indicator"},No={class:"search-indicator-text"},Oo=be({__name:"AgendaFilterBar",props:{citas:{},modoCoordinadora:{type:Boolean,default:!1},terapeutas:{default:()=>[]},terapeutaSeleccionado:{default:null},estadosActivos:{default:()=>["pendiente","confirmada","realizada","cancelada"]},busqueda:{default:""}},emits:["update:busqueda","update:terapeutaSeleccionado","update:estadosActivos","filtrar-estados"],setup(l,{emit:y}){const u=l,b=y,h=_(u.busqueda),S=_(new Set(u.estadosActivos));rt(()=>u.busqueda,M=>{h.value=M}),rt(()=>u.estadosActivos,M=>{S.value=new Set(M)});const w=[{key:"pendiente",label:"Pendientes",color:"#F59E0B",bgLight:"rgba(245, 158, 11, 0.1)"},{key:"confirmada",label:"Confirmadas",color:"#10B981",bgLight:"rgba(16, 185, 129, 0.1)"},{key:"realizada",label:"Realizadas",color:"#6366F1",bgLight:"rgba(99, 102, 241, 0.1)"},{key:"cancelada",label:"Canceladas",color:"#EF4444",bgLight:"rgba(239, 68, 68, 0.1)"}],D=M=>u.citas.filter(v=>v.estado===M).length,z=I(()=>S.value.size===0?0:u.citas.filter(M=>S.value.has(M.estado)).length),C=M=>S.value.has(M),H=I(()=>S.value.size===w.length),g=()=>{b("update:busqueda",h.value)},k=()=>{h.value="",b("update:busqueda","")},N=M=>{S.value.has(M)?S.value.delete(M):S.value.add(M);const v=Array.from(S.value);b("update:estadosActivos",v),b("filtrar-estados",v)},P=()=>{w.forEach(v=>S.value.add(v.key));const M=Array.from(S.value);b("update:estadosActivos",M),b("filtrar-estados",M)};return(M,v)=>(s(),n("div",Co,[e("div",$o,[e("div",Do,[Y(j(qt),{class:"search-icon"}),De(e("input",{"onUpdate:modelValue":v[0]||(v[0]=p=>h.value=p),onInput:g,type:"search",placeholder:"Buscar por paciente, terapeuta o nota...",class:"search-input","aria-label":"Buscar en la agenda"},null,544),[[Oe,h.value]]),h.value?(s(),n("button",{key:0,onClick:k,class:"search-clear","aria-label":"Limpiar b√∫squeda"},[Y(j(dt),{class:"w-4 h-4"})])):$("",!0)]),l.modoCoordinadora&&l.terapeutas.length>0?(s(),n("div",Ao,[Y(j(Ut),{class:"w-4 h-4 text-gray-400"}),e("select",{value:l.terapeutaSeleccionado,onChange:v[1]||(v[1]=p=>b("update:terapeutaSeleccionado",p.target.value||null)),class:"terapeuta-select","aria-label":"Filtrar por terapeuta"},[v[2]||(v[2]=e("option",{value:""},"Todos los terapeutas",-1)),(s(!0),n(K,null,J(l.terapeutas,p=>(s(),n("option",{key:p.id,value:p.id},c(p.nombre),9,Mo))),128))],40,So)])):$("",!0)]),e("div",zo,[e("div",Eo,[Y(j(Ot),{class:"w-3.5 h-3.5"}),v[3]||(v[3]=e("span",null,"Estado",-1))]),e("div",jo,[(s(),n(K,null,J(w,p=>e("button",{key:p.key,onClick:F=>N(p.key),class:A(["state-chip",{active:C(p.key)}]),style:st({"--chip-color":p.color,"--chip-bg":p.bgLight}),"aria-pressed":C(p.key)},[e("span",{class:"chip-dot",style:st({backgroundColor:p.color})},null,4),e("span",To,c(p.label),1),e("span",Fo,c(D(p.key)),1),C(p.key)?(s(),ze(j(ca),{key:0,class:"chip-check"})):$("",!0)],14,Bo)),64))]),e("div",Lo,[H.value?(s(),n("span",Ro,c(l.citas.length)+" citas ",1)):(s(),n("span",Io,c(z.value)+" de "+c(l.citas.length),1)),H.value?$("",!0):(s(),n("button",{key:2,onClick:P,class:"show-all-btn"}," Ver todas "))])]),h.value?(s(),n("div",Ho,[e("span",No,[v[4]||(v[4]=ie(" Buscando: ",-1)),e("strong",null,'"'+c(h.value)+'"',1)]),e("button",{onClick:k,class:"search-indicator-clear"},[Y(j(dt),{class:"w-3.5 h-3.5"}),v[5]||(v[5]=ie(" Limpiar ",-1))])])):$("",!0)]))}}),Vo=Object.assign(we(Oo,[["__scopeId","data-v-06d28784"]]),{__name:"AgendaFilterBar"}),Po={class:"bg-white/90 backdrop-blur-sm rounded-2xl shadow-sm border border-white/30 p-4"},qo={class:"bg-white/90 backdrop-blur-sm rounded-2xl shadow-sm border border-white/30 p-4"},Uo={class:"bg-white/90 backdrop-blur-sm rounded-2xl shadow-sm border border-white/30 p-4 space-y-4"},Ko={class:"flex-1 relative"},Yo={key:0,class:"flex items-center gap-2 text-sm"},Wo={class:"text-neutral-500"},Go={class:"px-2 py-0.5 bg-teal-50 text-teal-700 rounded-md font-medium"},Zo={key:2,class:"bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200 rounded-2xl p-4 mb-4 shadow-sm"},Jo={class:"flex items-center gap-3"},Qo={class:"flex-1"},Xo={class:"text-sm font-medium text-amber-900"},er={key:3,class:"bg-white/90 backdrop-blur-sm rounded-2xl shadow-sm border border-white/30 overflow-hidden flex flex-col",style:{height:"calc(100vh - 200px)"}},tr={class:"sticky top-0 z-10 bg-gradient-to-r from-white/95 via-white/90 to-white/95 backdrop-blur-md border-b border-neutral-200 shadow-sm p-4"},ar={class:"flex items-center justify-between"},or={class:"font-['Elms_Sans'] font-semibold text-lg text-neutral-800"},rr={class:"text-sm text-neutral-600 mt-1"},sr={class:"flex-1 overflow-y-auto"},nr={key:0,class:"flex items-center justify-center py-16"},lr={class:"text-center"},ir={class:"text-neutral-600 text-sm"},dr={key:1,class:"divide-y divide-neutral-100"},cr=["data-hora"],ur={class:"w-20 p-3 text-sm font-medium text-neutral-600 border-r border-neutral-200 bg-neutral-50/50 flex-shrink-0"},vr=["onClick"],mr=["onClick"],gr=["onDragstart","aria-label","title","onClick","onKeydown"],br={class:"absolute top-2 right-2 flex items-center gap-1 opacity-0 group-hover:opacity-100 group-focus-within:opacity-100 transition-all z-10"},pr=["onClick","disabled","title","aria-label"],fr={key:0,class:"w-3.5 h-3.5 animate-spin",fill:"none",viewBox:"0 0 24 24"},hr={key:1,class:"w-3.5 h-3.5",fill:"currentColor",viewBox:"0 0 20 20"},xr=["onClick","disabled","aria-label"],yr=["onClick","disabled","title","aria-label"],wr={key:0,class:"w-3.5 h-3.5 animate-spin",fill:"none",viewBox:"0 0 24 24"},_r={key:1,class:"w-3.5 h-3.5",fill:"currentColor",viewBox:"0 0 20 20"},kr={class:"flex items-start justify-between gap-3"},Cr={class:"opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0"},$r={class:"flex-1 min-w-0"},Dr={class:"font-medium text-sm text-neutral-800 truncate"},Ar={class:"flex items-center flex-wrap gap-2 mt-1"},Sr={class:"text-xs text-neutral-600 font-medium"},Mr={class:"inline-flex items-center gap-1 text-xs px-2 py-0.5 rounded-lg bg-white/60 text-neutral-700"},zr={key:0,title:"Online"},Er={key:1,title:"Presencial"},jr={key:0,class:"text-xs text-neutral-500 mt-1 flex items-center gap-1"},Br={class:"flex items-center gap-2 flex-shrink-0"},Tr={key:4,class:"bg-white/90 backdrop-blur-sm rounded-2xl shadow-sm border border-white/30 overflow-hidden flex flex-col",style:{height:"calc(100vh - 200px)"}},Fr={class:"min-w-[800px] overflow-x-auto flex-1 flex flex-col"},Lr={class:"sticky top-0 z-10 bg-white border-b border-gray-200 shadow-sm"},Ir={class:"grid grid-cols-8"},Rr={class:"flex items-center justify-center gap-1"},Hr={class:"text-xs font-medium text-gray-600 uppercase"},Nr={class:"text-xs text-gray-500"},Or={class:"flex-1 overflow-y-auto"},Vr={class:"divide-y divide-gray-100"},Pr=["data-hora"],qr={class:"p-3 text-sm font-medium text-gray-600 border-r border-gray-100 bg-gray-50 sticky left-0"},Ur=["onDragover","onDrop","onMousedown","onMouseenter","onClick"],Kr={key:0,class:"absolute inset-0 flex items-center justify-center opacity-0 group-hover/cell:opacity-100 transition-all duration-200 pointer-events-none"},Yr=["title"],Wr=["onDragstart","aria-label","title","onClick","onKeydown"],Gr={class:"absolute top-0.5 right-0.5 flex items-center gap-0.5 opacity-0 group-hover:opacity-100 group-focus-within:opacity-100 transition-all z-10"},Zr=["onClick","disabled","title","aria-label"],Jr={key:0,class:"w-2.5 h-2.5 animate-spin",fill:"none",viewBox:"0 0 24 24"},Qr={key:1,class:"w-2.5 h-2.5",fill:"currentColor",viewBox:"0 0 20 20"},Xr=["onClick","disabled","aria-label"],es=["onClick","disabled","title","aria-label"],ts={key:0,class:"w-2.5 h-2.5 animate-spin",fill:"none",viewBox:"0 0 24 24"},as={key:1,class:"w-2.5 h-2.5",fill:"currentColor",viewBox:"0 0 20 20"},os={class:"w-5 h-5 flex items-center justify-center"},rs={class:"pr-8"},ss={class:"font-semibold truncate text-sm text-gray-800"},ns={class:"text-xs text-gray-500 mt-0.5 font-medium"},ls={class:"flex items-center gap-1.5 mt-1.5 flex-wrap"},is={class:"inline-flex items-center gap-0.5 text-xs px-1.5 py-0.5 rounded bg-white/70 text-gray-600"},ds={key:0,title:"Online"},cs={key:1,title:"Presencial"},us={key:2,title:"Telef√≥nica"},vs={class:"hidden sm:inline"},ms=["title"],gs={key:0,class:"text-[10px] text-gray-400 mt-1 truncate"},bs={key:5},ps={class:"flex flex-wrap gap-2 mb-6"},fs=["onClick"],hs={key:0,class:"bg-red-50 border-l-4 border-red-400 p-4 mb-6"},xs={class:"text-red-700"},ys={key:1,class:"text-center py-12"},ws={key:2,class:"text-center py-12 bg-gray-50 rounded-lg"},_s={class:"mt-1 text-sm text-gray-500"},ks={key:3,class:"space-y-4"},Cs={class:"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-hidden"},$s={class:"px-6 py-4 overflow-y-auto max-h-[calc(90vh-140px)]"},Ds={key:0,class:"text-center py-8"},As={key:1},Ss={key:0,class:"mb-6 p-4 bg-blue-50 rounded-lg"},Ms={class:"grid grid-cols-3 gap-4 text-center"},zs={class:"text-2xl font-bold text-blue-600"},Es={class:"text-2xl font-bold text-green-600"},js={key:0,class:"mt-3 p-2 bg-yellow-100 border border-yellow-300 rounded text-sm text-yellow-800"},Bs={key:0,class:"text-center py-8 text-gray-500"},Ts={key:1,class:"space-y-3"},Fs={class:"flex items-start justify-between"},Ls={class:"flex-1"},Is={class:"flex items-center gap-2 mb-1"},Rs={class:"text-xs text-gray-500"},Hs={class:"text-sm text-gray-700"},Ns={class:"text-right ml-4"},Os={class:"text-sm font-semibold text-gray-900"},Vs={class:"bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden"},Ps={class:"px-6 py-4 border-b border-gray-100 bg-gradient-to-r from-blue-50 to-indigo-50"},qs={class:"flex items-center justify-between"},Us={class:"text-sm text-gray-500 mt-0.5"},Ks={class:"p-6 space-y-5"},Ys={class:"bg-gray-50 rounded-xl p-4"},Ws={class:"flex items-center gap-3"},Gs={class:"font-medium text-gray-900"},Zs={class:"text-sm text-gray-500"},Js=["min"],Qs={class:"grid grid-cols-2 gap-4"},Xs=["value"],en=["value"],tn={class:"px-6 py-4 border-t border-gray-100 bg-gray-50 flex items-center justify-end gap-3"},an=["disabled"],on={key:0,class:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24"},rn=be({__name:"AgendaTerapeuta",props:{modoCoordinadora:{type:Boolean,default:!1},mostrarFiltroTerapeuta:{type:Boolean,default:!1}},setup(l){const y=l,{citas:u,loading:b,error:h,citasConBonoProximoAgotar:S,lastUpdateTime:w,moveAppointment:D,changeAppointmentStatus:z,loadTerapeutaAppointments:C,loadAllAppointments:H,refreshAppointments:g}=It(),{completarCita:k,obtenerHistorialBono:N,verificarBonoCitas:P}=Gt(),M=ut(),v={success:o=>{console.info("[SUCCESS]",o)},error:o=>{console.error("[ERROR]",o),alert(o)},info:o=>{console.info("[INFO]",o)}},p=_("hoy"),F=_("calendario"),W=_(new Date),pe=_(!1),q=_(null),fe=_([]),te=_(null),_e=_(!1),he=_(null),Ae=_([]),de=_(["pendiente","confirmada","realizada","cancelada"]),X=_(""),Ee=I(()=>!y.modoCoordinadora||!he.value?u.value:u.value.filter(o=>o.terapeuta?.id===he.value)),Se=I(()=>de.value.length===0?[]:Ee.value.filter(o=>de.value.includes(o.estado))),ke=I(()=>{if(!X.value.trim())return Se.value;const o=X.value.toLowerCase().trim();return Se.value.filter(t=>{const x=(t.paciente_nombre||t.paciente?.nombre_completo||"").toLowerCase(),V=(t.terapeuta_nombre||t.terapeuta?.nombre_completo||"").toLowerCase(),U=(t.observaciones||"").toLowerCase(),d=(t.modalidad||"").toLowerCase();return x.includes(o)||V.includes(o)||U.includes(o)||d.includes(o)})}),re=I(()=>ke.value),ce=_(null),i=_(null),r=_(!1),f=_(null),m=_(null),E=_(null),B=_(!1),T=_(null),R=_(null),ue=_(null),je=_(null),ee=_(!1),se=_(null),ae=["11:00","12:00","13:00","17:00","18:00","19:00","20:00","21:00","22:00"],Ve=I(()=>{const o=new Date(W.value),t=o.getDay(),x=t===0?-6:1-t;o.setDate(o.getDate()+x);const V=[];for(let U=0;U<7;U++){const d=new Date(o);d.setDate(o.getDate()+U),V.push({fecha:d.toISOString().split("T")[0],nombreDia:d.toLocaleDateString("es-ES",{weekday:"short"}),numeroDia:d.getDate(),mes:d.toLocaleDateString("es-ES",{month:"short"})})}return V}),Be=I(()=>{const o=re.value,t=new Date().toISOString().split("T")[0];switch(p.value){case"hoy":return o.filter(x=>x.fecha_cita===t);case"pendientes":return o.filter(x=>x.estado==="pendiente");case"completadas":return o.filter(x=>x.estado==="completada"||x.estado==="realizada");default:return o}}),G=o=>o.substring(0,5),mt=o=>new Date(o+"T00:00:00").toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long",year:"numeric"}),Pe=o=>o.toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long",year:"numeric"}),qe=o=>({pendiente:"bg-amber-100 text-amber-700 border border-amber-200",confirmada:"bg-green-100 text-green-700 border border-green-200",completada:"bg-blue-100 text-blue-700 border border-blue-200",realizada:"bg-blue-100 text-blue-700 border border-blue-200",cancelada:"bg-red-100 text-red-700 border border-red-200"})[o]||"bg-gray-100 text-gray-700 border border-gray-200",Te=o=>{const t=new Date().toISOString().split("T")[0];return o===t},Ue=o=>{const t=new Date(W.value);F.value==="dia"?t.setDate(t.getDate()+o):t.setDate(t.getDate()+o*7),W.value=t},Ke=()=>{W.value=new Date},Ce=o=>{const t=W.value.toISOString().split("T")[0];return re.value.filter(x=>x.fecha_cita===t&&x.hora_inicio?.startsWith(o))},Ye=o=>({pendiente:"bg-yellow-100 border-l-4 border-yellow-500",confirmada:"bg-green-100 border-l-4 border-green-500",completada:"bg-blue-100 border-l-4 border-blue-500",realizada:"bg-blue-100 border-l-4 border-blue-500",cancelada:"bg-red-100 border-l-4 border-red-500"})[o]||"bg-gray-100 border-l-4 border-gray-500",We=o=>({pendiente:"Pendiente",confirmada:"Confirmada",completada:"Completada",realizada:"Realizada",cancelada:"Cancelada"})[o]||o,gt=o=>o===0?"text-red-600 font-bold":o===1?"text-orange-600 font-semibold":o<=2?"text-yellow-600 font-medium":"text-green-600",$e=(o,t)=>re.value.filter(x=>x.fecha_cita===o&&x.hora_inicio?.startsWith(t)),Fe=o=>{le.clickCreate(o.date,o.horaInicio),f.value=o.date,m.value=o.horaInicio,r.value=!0,v.info(`Click en ${o.date} a las ${o.horaInicio}`)},bt=async()=>{r.value=!1,f.value=null,m.value=null,await g(),v.success("Cita creada exitosamente")},pt=()=>{r.value=!1,f.value=null,m.value=null,E.value=null,se.value=null},xe=o=>{T.value=o,B.value=!0},ft=()=>{B.value=!1,setTimeout(()=>{T.value=null},300)},Ge=async()=>{await g(),v.success("Cita actualizada correctamente")},Ze=async o=>{if(!R.value){R.value=o;try{const t=await z(o,"confirmada");t.success?v.success("‚úì Cita confirmada"):v.error(t.error||"Error al confirmar la cita")}catch(t){console.error("Error al confirmar cita:",t),v.error("Error al confirmar la cita")}finally{R.value=null}}},oe=_(null),ve=_(null),Me=_(!1),Q=_(null),me=_(""),ne=_(""),ge=_(""),ht=I(()=>{if(!ne.value)return ae;const o=ae.indexOf(ne.value);return o===-1?ae:[...ae.slice(o+1),"23:00"]}),Je=async o=>{if(!(oe.value||!confirm("¬øEst√°s seguro de que deseas cancelar esta cita?"))){oe.value=o;try{const x=await z(o,"cancelada");x.success?v.success("‚úì Cita cancelada"):v.error(x.error||"Error al cancelar la cita")}catch(x){console.error("Error al cancelar cita:",x),v.error("Error al cancelar la cita")}finally{oe.value=null}}},Qe=o=>{const t=u.value.find(x=>x.id===o);if(!t){v.error("Cita no encontrada");return}Q.value=t,me.value=t.fecha_cita,ne.value=G(t.hora_inicio),ge.value=G(t.hora_fin),Me.value=!0},xt=async(o,t,x)=>{if(Q.value){ve.value=Q.value.id;try{const V=await D(Q.value.id,o,t,x);V.success?(v.success("‚úì Cita reprogramada"),Me.value=!1,Q.value=null):v.error(V.error||"Error al reprogramar la cita")}catch(V){console.error("Error al reprogramar cita:",V),v.error("Error al reprogramar la cita")}finally{ve.value=null}}},Le=()=>{Me.value=!1,Q.value=null,me.value="",ne.value="",ge.value=""},yt=async()=>{if(Q.value){if(!me.value||!ne.value||!ge.value){v.error("Por favor completa todos los campos");return}await xt(me.value,ne.value,ge.value)}},wt=(o,t,x)=>{ce.value||$e(o,t).length>0||(x.preventDefault(),ee.value=!0,se.value={fechaInicio:o,horaInicio:t,fechaFin:o,horaFin:t},le.debug("range_select","Iniciando selecci√≥n de rango",{fecha:o,hora:t}))},_t=(o,t)=>{!ee.value||!se.value||(se.value.fechaFin=o,se.value.horaFin=t)},Xe=o=>{if(!ee.value||!se.value)return;o.preventDefault(),ee.value=!1;const{fechaInicio:t,horaInicio:x,fechaFin:V,horaFin:U}=se.value,d=kt(U,60);le.debug("range_select","Rango seleccionado",{fechaInicio:t,horaInicio:x,fechaFin:V,horaFin:d}),f.value=t,m.value=x,E.value=d,r.value=!0,v.info(`Rango seleccionado: ${x} - ${d}`),setTimeout(()=>{se.value=null},100)},kt=(o,t)=>{const[x,V]=o.split(":").map(Number),U=x*60+V+t,d=Math.floor(U/60),L=U%60;return`${String(d).padStart(2,"0")}:${String(L).padStart(2,"0")}`},Ct=(o,t)=>{if(!se.value)return!1;const{fechaInicio:x,horaInicio:V,fechaFin:U,horaFin:d}=se.value;if(o===x&&o===U){const L=ae.indexOf(t),a=ae.indexOf(V),O=ae.indexOf(d);if(L===-1||a===-1||O===-1)return!1;const jt=Math.min(a,O),Bt=Math.max(a,O);return L>=jt&&L<=Bt}return!1},et=(o,t)=>{ce.value=t,o.dataTransfer&&(o.dataTransfer.effectAllowed="move",o.dataTransfer.setData("text/html",o.target.innerHTML)),o.target.style.opacity="0.5"},tt=o=>{o.target.style.opacity="1",ce.value=null,i.value=null},$t=(o,t,x)=>{o.preventDefault(),o.dataTransfer&&(o.dataTransfer.dropEffect="move"),i.value={fecha:t,hora:x}},Dt=o=>{i.value=null},At=(o,t)=>i.value?.fecha===o&&i.value?.hora===t,St=async(o,t,x)=>{if(o.preventDefault(),!ce.value){le.warn("drag_end","No hay cita arrastrada",{fecha:t,hora:x});return}const V=ce.value,U=V.id,d=t,L=x;ue.value="moving",je.value=U,le.dragStart(U,{date:V.fecha_cita,time:V.hora_inicio});try{const a=await D(U,d,L);a.success?(v.success("Cita movida exitosamente"),le.dragEnd(U,{date:d,time:L},!0)):(v.error(a.error||"No se pudo mover la cita"),le.dragEnd(U,{date:d,time:L},!1))}catch(a){console.error("[DROP] Error inesperado:",a),v.error("Error inesperado al mover la cita"),le.apiError("onDrop",a)}finally{ce.value=null,i.value=null,ue.value=null,je.value=null}},Mt=async o=>{if(confirm("¬øEst√°s seguro de marcar esta cita como completada?"))try{(await k(o)).success&&console.log("Cita completada")}catch(t){console.error("Error al completar cita:",t)}},zt=async o=>{try{_e.value=!0,q.value=o,pe.value=!0;const[t,x]=await Promise.all([N(o),P(o)]);fe.value=t,te.value=x}catch(t){console.error("Error al cargar historial:",t)}finally{_e.value=!1}},Ie=()=>{pe.value=!1,q.value=null,fe.value=[],te.value=null},at=async()=>{try{await g(),v.success("Agenda actualizada")}catch(o){console.error("Error al recargar citas:",o),v.error("Error al actualizar la agenda")}},Et=async()=>{if(y.modoCoordinadora)try{const{data:o,error:t}=await M.from("terapeutas").select("id, nombre_completo").eq("activo",!0).order("nombre_completo",{ascending:!0});if(t){console.error("Error al cargar terapeutas:",t);return}Ae.value=(o||[]).map(x=>({id:x.id,nombre:x.nombre_completo}))}catch(o){console.error("Error al cargar terapeutas:",o)}},Re=o=>{de.value=o,le.debug("filter_change","Filtros de estado actualizados",{estados:o})};return Lt(async()=>{y.modoCoordinadora?(await H(),await Et()):await C(),document.addEventListener("mouseup",Xe)}),vt(()=>{document.removeEventListener("mouseup",Xe)}),(o,t)=>{const x=Ma,V=Rt,U=Ht;return s(),n("div",{class:A(["agenda-layout",{"modo-coordinadora":l.modoCoordinadora}])},[l.modoCoordinadora?(s(),n(K,{key:0},[Y(ko,{vista:F.value,"fecha-actual":W.value,loading:j(b),"modo-coordinadora":!0,onCambiarVista:t[0]||(t[0]=d=>F.value=d),onNavegarFecha:Ue,onIrHoy:Ke,onActualizar:at,onNuevaCita:t[1]||(t[1]=d=>r.value=!0),onNuevaTarea:()=>{}},null,8,["vista","fecha-actual","loading"]),Y(Vo,{citas:j(u),"modo-coordinadora":!0,terapeutas:Ae.value,"terapeuta-seleccionado":he.value,"estados-activos":de.value,busqueda:X.value,"onUpdate:busqueda":t[2]||(t[2]=d=>X.value=d),"onUpdate:terapeutaSeleccionado":t[3]||(t[3]=d=>he.value=d),"onUpdate:estadosActivos":Re,onFiltrarEstados:Re},null,8,["citas","terapeutas","terapeuta-seleccionado","estados-activos","busqueda"])],64)):(s(),n(K,{key:1},[e("div",Po,[Y(da,{titulo:"Mi Agenda",subtitulo:"Tus citas programadas","rol-activo":"terapeuta","mostrar-rol":!1})]),e("div",qo,[Y(co,{vista:F.value,"fecha-actual":W.value,loading:j(b),"last-update-time":j(w),onCambiarVista:t[4]||(t[4]=d=>F.value=d),onNavegarFecha:Ue,onIrHoy:Ke,onActualizar:at},null,8,["vista","fecha-actual","loading","last-update-time"])]),e("div",Uo,[e("div",Ko,[t[14]||(t[14]=e("label",{for:"buscar-citas",class:"sr-only"},"Buscar paciente o cita",-1)),t[15]||(t[15]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("svg",{class:"h-4 w-4 text-neutral-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1)),De(e("input",{id:"buscar-citas","onUpdate:modelValue":t[5]||(t[5]=d=>X.value=d),type:"search",placeholder:"Buscar por paciente o nota...",class:"block w-full pl-10 pr-4 py-2.5 bg-white border border-neutral-200 rounded-xl text-sm text-neutral-800 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-teal-500/30 focus:border-teal-500 transition-all","aria-label":"Buscar paciente o cita"},null,512),[[Oe,X.value]]),X.value?(s(),n("button",{key:0,onClick:t[6]||(t[6]=d=>X.value=""),class:"absolute inset-y-0 right-0 pr-3 flex items-center text-neutral-400 hover:text-neutral-600","aria-label":"Limpiar b√∫squeda"},[...t[13]||(t[13]=[e("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])):$("",!0)]),X.value?(s(),n("div",Yo,[e("span",Wo,c(re.value.length)+" resultado"+c(re.value.length!==1?"s":"")+" para ",1),e("span",Go,' "'+c(X.value)+'" ',1)])):$("",!0),Y(qa,{citas:j(u),"estados-activos":de.value,onFiltrar:Re},null,8,["citas","estados-activos"])])],64)),j(S).length>0?(s(),n("div",Zo,[e("div",Jo,[t[17]||(t[17]=e("div",{class:"w-10 h-10 rounded-xl bg-gradient-to-br from-[#F2B33D] to-[#F2B33D]/70 flex items-center justify-center flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-white",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})])],-1)),e("div",Qo,[e("p",Xo," Atenci√≥n: "+c(j(S).length)+" paciente(s) con pocas sesiones restantes ",1),t[16]||(t[16]=e("p",{class:"text-xs text-amber-700 mt-1"}," Considera informar a estos pacientes para renovar sus bonos ",-1))])])])):$("",!0),F.value==="dia"?(s(),n("div",er,[e("div",tr,[e("div",ar,[e("div",null,[e("h3",or,c(Pe(W.value)),1),e("p",rr,c(Ce?Object.values(ae).reduce((d,L)=>d+Ce(L).length,0):0)+" citas programadas ",1)])])]),e("div",sr,[Be.value.length===0?(s(),n("div",nr,[e("div",lr,[t[18]||(t[18]=e("div",{class:"w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-br from-[#027368]/10 to-[#04BF9D]/10 flex items-center justify-center"},[e("svg",{class:"w-8 h-8 text-[#027368]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1)),t[19]||(t[19]=e("h3",{class:"font-['Elms_Sans'] font-medium text-neutral-800 mb-2"},"No hay citas programadas",-1)),e("p",ir,c(Pe(W.value))+" est√° libre",1)])])):(s(),n("div",dr,[(s(),n(K,null,J(ae,(d,L)=>e("div",{key:d,"data-hora":d,class:"flex hover:bg-neutral-50/50 transition-colors"},[e("div",ur,c(d),1),e("div",{class:"flex-1 p-3 cursor-pointer hover:bg-[#027368]/5 transition-colors relative group/cell",onClick:a=>Ce(d).length===0?Fe({date:W.value.toISOString().split("T")[0],horaInicio:d}):null},[Ce(d).length===0?(s(),n("button",{key:0,class:"absolute right-3 top-1/2 -translate-y-1/2 w-7 h-7 rounded-full bg-[#027368] text-white flex items-center justify-center opacity-0 group-hover/cell:opacity-100 transition-all hover:bg-[#025a52] hover:scale-110 shadow-sm",onClick:Z(a=>Fe({date:W.value.toISOString().split("T")[0],horaInicio:d}),["stop"]),title:"Crear nueva cita","aria-label":"Crear nueva cita a las {{ hora }}"},[...t[20]||(t[20]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])],8,mr)):$("",!0),(s(!0),n(K,null,J(Ce(d),a=>(s(),n("div",{key:a.id,draggable:"true",onDragstart:O=>et(O,a),onDragend:t[7]||(t[7]=O=>tt(O)),class:A(["mb-2 p-3 rounded-xl transition-all hover:shadow-md hover:ring-2 hover:ring-[#027368]/30 group relative backdrop-blur-sm",[Ye(a.estado),R.value===a.id?"opacity-60 pointer-events-none":"cursor-pointer"]]),role:"button",tabindex:"0","aria-label":`Cita ${a.estado} de ${a.paciente_nombre||"paciente"}, ${G(a.hora_inicio)} a ${G(a.hora_fin)}, ${a.modalidad}${a.estado==="pendiente"?". Pulsa para ver detalles o confirmar.":". Pulsa para ver detalles."}`,title:`${a.paciente_nombre||"Sin paciente"} - ${G(a.hora_inicio)} a ${G(a.hora_fin)}. Click para ver detalles.`,onClick:Z(O=>xe(a.id),["stop"]),onKeydown:[ye(Z(O=>xe(a.id),["stop"]),["enter"]),ye(Z(O=>xe(a.id),["prevent","stop"]),["space"])]},[e("div",br,[a.estado==="pendiente"?(s(),n("button",{key:0,onClick:Z(O=>Ze(a.id),["stop"]),class:A(["w-6 h-6 rounded-full bg-emerald-500 text-white flex items-center justify-center hover:bg-emerald-600 hover:scale-110 shadow-sm transition-all",{"animate-pulse":R.value===a.id}]),disabled:R.value===a.id,title:R.value===a.id?"Confirmando...":"Confirmar cita","aria-label":`Confirmar cita de ${a.paciente_nombre||"paciente"}`,type:"button"},[R.value===a.id?(s(),n("svg",fr,[...t[21]||(t[21]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"},null,-1)])])):(s(),n("svg",hr,[...t[22]||(t[22]=[e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)])]))],10,pr)):$("",!0),a.estado!=="cancelada"?(s(),n("button",{key:1,onClick:Z(O=>Qe(a.id),["stop"]),class:"w-6 h-6 rounded-full bg-blue-500 text-white flex items-center justify-center hover:bg-blue-600 hover:scale-110 shadow-sm transition-all",disabled:ve.value===a.id,title:"Reprogramar cita","aria-label":`Reprogramar cita de ${a.paciente_nombre||"paciente"}`,type:"button"},[...t[23]||(t[23]=[e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)])],8,xr)):$("",!0),a.estado!=="cancelada"&&a.estado!=="completada"&&a.estado!=="realizada"?(s(),n("button",{key:2,onClick:Z(O=>Je(a.id),["stop"]),class:A(["w-6 h-6 rounded-full bg-red-500 text-white flex items-center justify-center hover:bg-red-600 hover:scale-110 shadow-sm transition-all",{"animate-pulse":oe.value===a.id}]),disabled:oe.value===a.id,title:oe.value===a.id?"Cancelando...":"Cancelar cita","aria-label":`Cancelar cita de ${a.paciente_nombre||"paciente"}`,type:"button"},[oe.value===a.id?(s(),n("svg",wr,[...t[24]||(t[24]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"},null,-1)])])):(s(),n("svg",_r,[...t[25]||(t[25]=[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"},null,-1)])]))],10,yr)):$("",!0)]),e("div",kr,[e("div",Cr,[Y(j(ct),{class:"w-4 h-4 text-neutral-500"})]),e("div",$r,[e("p",Dr,c(a.paciente_nombre||a.paciente?.nombre_completo||"Sin paciente"),1),e("div",Ar,[e("span",Sr,c(G(a.hora_inicio))+" - "+c(G(a.hora_fin)),1),e("span",Mr,[a.modalidad==="online"?(s(),n("span",zr,"üíª")):(s(),n("span",Er,"üè•")),ie(" "+c(a.modalidad==="online"?"Online":"Presencial"),1)]),a.bono_sesiones_restantes!==void 0&&a.bono_sesiones_restantes!==null?(s(),n("span",{key:0,class:A(["text-xs px-2 py-0.5 rounded-lg font-medium",{"bg-red-100 text-red-700":a.bono_sesiones_restantes===0,"bg-orange-100 text-orange-700":a.bono_sesiones_restantes===1,"bg-yellow-100 text-yellow-700":a.bono_sesiones_restantes===2,"bg-green-100 text-green-700":a.bono_sesiones_restantes>2}])},c(a.bono_sesiones_restantes)+"/"+c(a.bono_sesiones_totales||"?")+" sesiones ",3)):$("",!0)]),l.modoCoordinadora&&(a.terapeuta_nombre||a.terapeuta?.nombre_completo)?(s(),n("p",jr,[t[26]||(t[26]=e("span",null,"üë§",-1)),ie(" "+c(a.terapeuta_nombre||a.terapeuta?.nombre_completo),1)])):$("",!0)]),e("div",Br,[e("span",{class:A(["text-xs px-2 py-1 rounded-lg font-medium whitespace-nowrap",qe(a.estado)])},c(We(a.estado)),3)])])],42,gr))),128))],8,vr)],8,cr)),64))]))])])):F.value==="calendario"?(s(),n("div",Tr,[e("div",Fr,[e("div",Lr,[e("div",Ir,[t[27]||(t[27]=e("div",{class:"p-2 border-r border-gray-200 bg-gray-50"},null,-1)),(s(!0),n(K,null,J(Ve.value,d=>(s(),n("div",{key:d.fecha,class:A(["p-2 text-center border-r border-gray-200 last:border-r-0",Te(d.fecha)?"bg-blue-50":"bg-white"])},[e("div",Rr,[e("span",Hr,c(d.nombreDia),1),e("span",{class:A(["text-lg font-bold text-gray-900",Te(d.fecha)?"text-blue-600":""])},c(d.numeroDia),3)]),e("div",Nr,c(d.mes),1)],2))),128))])]),e("div",Or,[e("div",Vr,[(s(),n(K,null,J(ae,d=>e("div",{key:d,"data-hora":d,class:"grid grid-cols-8"},[e("div",qr,c(d),1),(s(!0),n(K,null,J(Ve.value,L=>(s(),n("div",{key:`${L.fecha}-${d}`,class:A(["p-2 border-r border-gray-100 last:border-r-0 hover:bg-blue-50/30 transition-colors min-h-[70px] cursor-pointer relative group/cell",[Te(L.fecha)?"bg-blue-50/20":"",At(L.fecha,d)?"bg-blue-100 ring-2 ring-blue-500 ring-inset":"",Ct(L.fecha,d)?"bg-[#027368]/20 ring-2 ring-[#027368] ring-inset":""]]),onDragover:a=>$t(a,L.fecha,d),onDragleave:t[9]||(t[9]=a=>Dt()),onDrop:a=>St(a,L.fecha,d),onMousedown:a=>$e(L.fecha,d).length===0?wt(L.fecha,d,a):null,onMouseenter:a=>_t(L.fecha,d),onClick:a=>$e(L.fecha,d).length===0&&!ee.value?Fe({date:L.fecha,horaInicio:d}):null},[$e(L.fecha,d).length===0?(s(),n("div",Kr,[e("div",{class:"w-6 h-6 rounded-full bg-teal-500/90 text-white flex items-center justify-center shadow-md transform scale-90 group-hover/cell:scale-100 transition-transform",title:`Crear cita el ${L.nombreDia} ${L.numeroDia} a las ${d}`},[...t[28]||(t[28]=[e("svg",{class:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2.5"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1)])],8,Yr)])):$("",!0),(s(!0),n(K,null,J($e(L.fecha,d),a=>(s(),n("div",{key:a.id,draggable:"true",onDragstart:O=>et(O,a),onDragend:t[8]||(t[8]=O=>tt(O)),class:A(["text-xs p-2 rounded-lg mb-1.5 hover:shadow-lg hover:ring-2 hover:ring-teal-400 transition-all group relative border-l-3",[Ye(a.estado),R.value===a.id?"opacity-60 pointer-events-none":"cursor-pointer"]]),role:"button",tabindex:"0","aria-label":`Cita ${a.estado} de ${a.paciente_nombre||"paciente"}, ${G(a.hora_inicio)} a ${G(a.hora_fin)}, ${a.modalidad}${a.estado==="pendiente"?". Pulsa para ver detalles o confirmar.":". Pulsa para ver detalles."}`,title:`${a.paciente_nombre||"Sin paciente"} - ${G(a.hora_inicio)} a ${G(a.hora_fin)}. Click para ver detalles.`,onClick:Z(O=>xe(a.id),["stop"]),onKeydown:[ye(Z(O=>xe(a.id),["stop"]),["enter"]),ye(Z(O=>xe(a.id),["prevent","stop"]),["space"])]},[e("div",Gr,[a.estado==="pendiente"?(s(),n("button",{key:0,onClick:Z(O=>Ze(a.id),["stop"]),class:A(["w-5 h-5 rounded-full bg-emerald-500 text-white flex items-center justify-center hover:bg-emerald-600 hover:scale-110 shadow-sm transition-all",{"animate-pulse":R.value===a.id}]),disabled:R.value===a.id,title:R.value===a.id?"Confirmando...":"Confirmar cita","aria-label":`Confirmar cita de ${a.paciente_nombre||"paciente"}`,type:"button"},[R.value===a.id?(s(),n("svg",Jr,[...t[29]||(t[29]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"},null,-1)])])):(s(),n("svg",Qr,[...t[30]||(t[30]=[e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)])]))],10,Zr)):$("",!0),a.estado!=="cancelada"?(s(),n("button",{key:1,onClick:Z(O=>Qe(a.id),["stop"]),class:"w-5 h-5 rounded-full bg-blue-500 text-white flex items-center justify-center hover:bg-blue-600 hover:scale-110 shadow-sm transition-all",disabled:ve.value===a.id,title:"Reprogramar cita","aria-label":`Reprogramar cita de ${a.paciente_nombre||"paciente"}`,type:"button"},[...t[31]||(t[31]=[e("svg",{class:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)])],8,Xr)):$("",!0),a.estado!=="cancelada"&&a.estado!=="completada"&&a.estado!=="realizada"?(s(),n("button",{key:2,onClick:Z(O=>Je(a.id),["stop"]),class:A(["w-5 h-5 rounded-full bg-red-500 text-white flex items-center justify-center hover:bg-red-600 hover:scale-110 shadow-sm transition-all",{"animate-pulse":oe.value===a.id}]),disabled:oe.value===a.id,title:oe.value===a.id?"Cancelando...":"Cancelar cita","aria-label":`Cancelar cita de ${a.paciente_nombre||"paciente"}`,type:"button"},[oe.value===a.id?(s(),n("svg",ts,[...t[32]||(t[32]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"},null,-1)])])):(s(),n("svg",as,[...t[33]||(t[33]=[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"},null,-1)])]))],10,es)):$("",!0),e("div",os,[Y(j(ct),{class:"w-3 h-3 text-gray-500"})])]),e("div",rs,[e("p",ss,c(a.paciente_nombre||a.paciente?.nombre_completo||"Sin paciente"),1),e("p",ns,c(G(a.hora_inicio))+" ‚Äì "+c(G(a.hora_fin)),1),e("div",ls,[e("span",is,[a.modalidad==="online"?(s(),n("span",ds,"üíª")):a.modalidad==="presencial"?(s(),n("span",cs,"üè•")):(s(),n("span",us,"üìû")),e("span",vs,c(a.modalidad),1)]),e("span",{class:A(["text-[10px] px-1.5 py-0.5 rounded-full font-semibold",qe(a.estado)])},c(We(a.estado)),3),a.bono_id?(s(),n("span",{key:0,class:"text-[10px] px-1.5 py-0.5 rounded bg-emerald-100 text-emerald-700 font-medium",title:`Bono: ${a.bono_sesiones_restantes||0}/${a.bono_sesiones_totales||0} sesiones`}," üé´ "+c(a.bono_sesiones_restantes||0),9,ms)):$("",!0)]),l.modoCoordinadora&&(a.terapeuta_nombre||a.terapeuta?.nombre_completo)?(s(),n("p",gs," üë§ "+c(a.terapeuta_nombre||a.terapeuta?.nombre_completo),1)):$("",!0)])],42,Wr))),128))],42,Ur))),128))],8,Pr)),64))])])])])):(s(),n("div",bs,[e("div",ps,[(s(!0),n(K,null,J([{key:"hoy",label:"Hoy",count:re.value.filter(d=>d.fecha_cita===new Date().toISOString().split("T")[0]).length},{key:"pendientes",label:"Pendientes",count:re.value.filter(d=>d.estado==="pendiente").length},{key:"completadas",label:"Completadas",count:re.value.filter(d=>d.estado==="completada"||d.estado==="realizada").length},{key:"todas",label:"Todas",count:re.value.length}],d=>(s(),n("button",{key:d.key,onClick:L=>p.value=d.key,class:A(["px-4 py-2 rounded-lg font-medium transition-colors",p.value===d.key?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50 border border-gray-300"])},c(d.label)+" ("+c(d.count)+") ",11,fs))),128))]),j(h)?(s(),n("div",hs,[e("p",xs,c(j(h)),1)])):$("",!0),j(b)&&j(u).length===0?(s(),n("div",ys,[...t[34]||(t[34]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"},null,-1),e("p",{class:"text-gray-600"},"Cargando citas...",-1)])])):Be.value.length===0?(s(),n("div",ws,[t[35]||(t[35]=e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),t[36]||(t[36]=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay citas",-1)),e("p",_s,c(p.value==="hoy"?"No tienes citas programadas para hoy.":"No hay citas en esta categor√≠a."),1)])):(s(),n("div",ks,[(s(!0),n(K,null,J(Be.value,d=>(s(),ze(x,{key:d.id,cita:d,onCompletar:Mt,onVerHistorial:zt},null,8,["cita"]))),128))]))])),(s(),ze(nt,{to:"body"},[pe.value?(s(),n("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:Z(Ie,["self"])},[e("div",Cs,[e("div",{class:"px-6 py-4 border-b border-gray-200 flex items-center justify-between"},[t[38]||(t[38]=e("h2",{class:"text-xl font-bold text-gray-900"},"Historial del Bono",-1)),e("button",{onClick:Ie,class:"text-gray-400 hover:text-gray-600 transition-colors"},[...t[37]||(t[37]=[e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",$s,[_e.value?(s(),n("div",Ds,[...t[39]||(t[39]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"},null,-1)])])):(s(),n("div",As,[te.value?(s(),n("div",Ss,[t[43]||(t[43]=e("h3",{class:"font-semibold text-gray-900 mb-3"},"Resumen",-1)),e("div",Ms,[e("div",null,[e("p",zs,c(te.value.bono.sesiones_totales),1),t[40]||(t[40]=e("p",{class:"text-xs text-gray-600"},"Sesiones Totales",-1))]),e("div",null,[e("p",Es,c(te.value.bono.sesiones_usadas),1),t[41]||(t[41]=e("p",{class:"text-xs text-gray-600"},"Sesiones Usadas",-1))]),e("div",null,[e("p",{class:A(["text-2xl font-bold",gt(te.value.bono.sesiones_restantes)])},c(te.value.bono.sesiones_restantes),3),t[42]||(t[42]=e("p",{class:"text-xs text-gray-600"},"Sesiones Restantes",-1))])]),te.value.alerta?(s(),n("div",js,c(te.value.mensaje_alerta),1)):$("",!0)])):$("",!0),e("div",null,[t[44]||(t[44]=e("h3",{class:"font-semibold text-gray-900 mb-3"},"Movimientos",-1)),fe.value.length===0?(s(),n("div",Bs," No hay movimientos registrados ")):(s(),n("div",Ts,[(s(!0),n(K,null,J(fe.value,d=>(s(),n("div",{key:d.id,class:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors"},[e("div",Fs,[e("div",Ls,[e("div",Is,[e("span",{class:A(["px-2 py-1 text-xs font-medium rounded",d.tipo_movimiento==="descuento"?"bg-red-100 text-red-700":d.tipo_movimiento==="reembolso"?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"])},c(d.tipo_movimiento),3),e("span",Rs,c(new Date(d.fecha).toLocaleString("es-ES")),1)]),e("p",Hs,c(d.motivo),1)]),e("div",Ns,[e("p",Os,c(d.sesiones_antes)+" ‚Üí "+c(d.sesiones_despues),1),e("p",{class:A(["text-xs font-medium",d.sesiones_modificadas>0?"text-red-600":"text-green-600"])},c(d.sesiones_modificadas>0?"-":"+")+c(Math.abs(d.sesiones_modificadas)),3)])])]))),128))]))])]))]),e("div",{class:"px-6 py-4 border-t border-gray-200 flex justify-end"},[e("button",{onClick:Ie,class:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors"}," Cerrar ")])])])):$("",!0)])),Y(V,{"is-open":r.value,"fecha-inicial":f.value||void 0,"hora-inicial":m.value||void 0,"hora-final":E.value||void 0,onCreated:bt,onClose:pt},null,8,["is-open","fecha-inicial","hora-inicial","hora-final"]),Y(U,{"cita-id":T.value,onClose:ft,onCitaActualizada:Ge,onActualizado:Ge},null,8,["cita-id"]),(s(),ze(nt,{to:"body"},[Me.value&&Q.value?(s(),n("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:Z(Le,["self"])},[e("div",Vs,[e("div",Ps,[e("div",qs,[e("div",null,[t[45]||(t[45]=e("h2",{class:"text-lg font-semibold text-gray-900"},"Reprogramar Cita",-1)),e("p",Us,c(Q.value.paciente_nombre||Q.value.paciente?.nombre_completo||"Paciente"),1)]),e("button",{onClick:Le,class:"w-8 h-8 rounded-full bg-white/80 flex items-center justify-center text-gray-400 hover:text-gray-600 hover:bg-white transition-all"},[...t[46]||(t[46]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),e("div",Ks,[e("div",Ys,[t[48]||(t[48]=e("p",{class:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-2"},"Cita actual",-1)),e("div",Ws,[t[47]||(t[47]=e("div",{class:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1)),e("div",null,[e("p",Gs,c(mt(Q.value.fecha_cita)),1),e("p",Zs,c(G(Q.value.hora_inicio))+" - "+c(G(Q.value.hora_fin)),1)])])]),e("div",null,[t[49]||(t[49]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Nueva fecha",-1)),De(e("input",{type:"date","onUpdate:modelValue":t[10]||(t[10]=d=>me.value=d),min:new Date().toISOString().split("T")[0],class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 transition-all"},null,8,Js),[[Oe,me.value]])]),e("div",Qs,[e("div",null,[t[50]||(t[50]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Hora inicio",-1)),De(e("select",{"onUpdate:modelValue":t[11]||(t[11]=d=>ne.value=d),class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 transition-all"},[(s(),n(K,null,J(ae,d=>e("option",{key:d,value:d},c(d),9,Xs)),64))],512),[[lt,ne.value]])]),e("div",null,[t[51]||(t[51]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Hora fin",-1)),De(e("select",{"onUpdate:modelValue":t[12]||(t[12]=d=>ge.value=d),class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 transition-all"},[(s(!0),n(K,null,J(ht.value,d=>(s(),n("option",{key:d,value:d},c(d),9,en))),128))],512),[[lt,ge.value]])])])]),e("div",tn,[e("button",{onClick:Le,class:"px-5 py-2.5 text-gray-700 font-medium rounded-xl hover:bg-gray-100 transition-colors"}," Cancelar "),e("button",{onClick:yt,disabled:!me.value||!ne.value||!ge.value||ve.value,class:"px-5 py-2.5 bg-blue-600 text-white font-medium rounded-xl hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2"},[ve.value?(s(),n("svg",on,[...t[52]||(t[52]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"},null,-1)])])):$("",!0),ie(" "+c(ve.value?"Reprogramando...":"Confirmar"),1)],8,an)])])])):$("",!0)]))],2)}}}),kn=Object.assign(we(rn,[["__scopeId","data-v-8cde2423"]]),{__name:"AgendaTerapeuta"});export{da as A,hn as C,kn as _,wn as a,Ma as b,xn as f,yn as g,_n as i,ca as r,Gt as u};
