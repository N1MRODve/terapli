import{an as g,q as f,ao as l,y as n}from"#entry";const T=g(async(i,R)=>{let e,o;const{user:h,getUserRole:E,loadUserProfile:d,userProfile:p}=f();if(!h.value){console.warn("[ROLE-REDIRECT] [auth-role] No hay usuario autenticado, omitiendo verificación de rol");return}console.log("[ROLE-REDIRECT] [auth-role] Verificando acceso a:",i.path,"desde:",R.path),[e,o]=l(()=>d()),await e,o();let c=0;for(;!p.value&&c<3;)console.log(`[ROLE-REDIRECT] [auth-role] Reintento ${c+1} de carga de perfil...`),[e,o]=l(()=>new Promise(a=>setTimeout(a,200))),await e,o(),[e,o]=l(()=>d()),await e,o(),c++;const r=([e,o]=l(()=>E()),e=await e,o(),e);if(!r)return console.error("[ROLE-REDIRECT] [auth-role] No se pudo determinar el rol del usuario después de reintentos"),n("/acceso-denegado",{replace:!0});console.log("[ROLE-REDIRECT] [auth-role] Usuario con rol:",r,"accediendo a:",i.path);const u={psicologa:"/terapeuta",terapeuta:"/terapeuta",coordinadora:"/coordinadora",admin:"/admin",paciente:"/paciente"},t=u[r];if(!t)return console.error(`[ROLE-REDIRECT] [auth-role] Rol desconocido: ${r}`),n("/acceso-denegado",{replace:!0});const s=i.path;if(s.startsWith(t)){console.log(`[ROLE-REDIRECT] [auth-role] Acceso permitido a ${s} para rol '${r}'`);return}if(["/login","/contacto","/legal","/","/acceso-denegado"].some(a=>s===a||s.startsWith(a)))return;if(Object.values(u).filter(a=>a!==t).some(a=>s.startsWith(a)))return console.warn(`[ROLE-REDIRECT] [auth-role] ACCESO BLOQUEADO: Usuario con rol '${r}' intentó acceder a ${s}`),console.log(`[ROLE-REDIRECT] [auth-role] Redirigiendo a ${t}/dashboard`),n(`${t}/dashboard`,{replace:!0});if(s==="/dashboard")return console.log(`[ROLE-REDIRECT] [auth-role] Redirigiendo desde /dashboard genérico a ${t}/dashboard para rol '${r}'`),n(`${t}/dashboard`,{replace:!0})});export{T as default};
