import{p as ne,B as ie,f as ue,r as m,x as S,I as N,J as X,o as d,b as j,w as q,c as p,h as k,j as T,a as e,t as f,k as $,v as V,F as z,y as P,Y as ce,M as I,T as H,K,d as de,g as pe,l as h,i as me,m as G}from"#entry";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Q=()=>{const y=ne(),_=ie(),{getUserId:x}=ue();return{getPacientes:async()=>{if(!_.value)return console.error("User not logged in"),[];try{const{data:i,error:a}=await y.from("pacientes").select("id, nombre_completo, email, activo, area_de_acompanamiento, metadata").eq("activo",!0).order("nombre_completo",{ascending:!0});return a?(console.error("Error fetching pacientes:",a),[]):(i||[]).map(u=>({id:u.id,nombre:u.nombre_completo||"Sin nombre",email:u.email,activo:u.activo,en_pausa:u.metadata?.en_pausa||!1,area_de_acompanamiento:u.area_de_acompanamiento}))}catch(i){return console.error("Error en getPacientes:",i),[]}},getRecursosRepositorio:async()=>{if(!_.value)return console.error("User not logged in"),[];try{const{data:i,error:a}=await y.from("recursos_repositorio").select("*").eq("activo",!0).order("created_at",{ascending:!1});return a?(console.error("Error fetching recursos repositorio:",a),[]):i}catch(i){return console.error("Error en getRecursosRepositorio:",i),[]}},compartirRecurso:async(i,a,u)=>{if(!_.value)return{success:!1,error:"User not logged in"};try{const c=x();if(!c)return{success:!1,error:"Usuario no autenticado"};const C=a.map(l=>({recurso_id:i,paciente_id:l,terapeuta_id:c,nota_personal:u||null,compartido_at:new Date().toISOString()})),{data:r,error:t}=await y.from("recursos_compartidos").insert(C).select();return t?t.code==="23505"?{success:!1,error:"Uno o m√°s pacientes ya tienen este recurso compartido"}:(console.error("Error compartiendo recurso:",t),{success:!1,error:t.message}):{success:!0,data:r}}catch(c){return console.error("Error en compartirRecurso:",c),{success:!1,error:c.message}}},getRecursosCompartidosPaciente:async i=>{if(!_.value)return console.error("User not logged in"),[];try{const{data:a,error:u}=await y.from("recursos_compartidos").select(`
          *,
          recurso:recursos_repositorio(*)
        `).eq("paciente_id",i).eq("archivado",!1).order("compartido_at",{ascending:!1});return u?(console.error("Error fetching recursos compartidos:",u),[]):a}catch(a){return console.error("Error en getRecursosCompartidosPaciente:",a),[]}},getEstadisticasRecursos:async()=>{if(!_.value)return console.error("User not logged in"),null;try{const{data:i,error:a}=await y.from("recursos_compartidos").select("visto, compartido_at").eq("terapeuta_id",_.value.id).eq("archivado",!1);if(a)return console.error("Error fetching estad√≠sticas:",a),null;const u=i.length,c=i.filter(r=>r.visto).length,C=u-c;return{total:u,vistos:c,pendientes:C,porcentajeVisto:u>0?Math.round(c/u*100):0}}catch(i){return console.error("Error en getEstadisticasRecursos:",i),null}},descompartirRecurso:async i=>{if(!_.value)return{success:!1,error:"User not logged in"};try{const{error:a}=await y.from("recursos_compartidos").update({archivado:!0}).eq("id",i).eq("terapeuta_id",_.value.id);return a?(console.error("Error descompartiendo recurso:",a),{success:!1,error:a.message}):{success:!0}}catch(a){return console.error("Error en descompartirRecurso:",a),{success:!1,error:a.message}}},crearRecurso:async i=>{const a=x();if(!a)return{success:!1,error:"User not logged in"};try{const{data:u,error:c}=await y.from("recursos_repositorio").insert({...i,created_by:a,created_at:new Date().toISOString()}).select().single();return c?(console.error("Error creando recurso:",c),{success:!1,error:c.message}):{success:!0,data:u}}catch(u){return console.error("Error en crearRecurso:",u),{success:!1,error:u.message}}},actualizarRecurso:async(i,a)=>{if(!_.value)return{success:!1,error:"User not logged in"};try{const{data:u,error:c}=await y.from("recursos_repositorio").update({...a,updated_at:new Date().toISOString()}).eq("id",i).select().single();return c?(console.error("Error actualizando recurso:",c),{success:!1,error:c.message}):{success:!0,data:u}}catch(u){return console.error("Error en actualizarRecurso:",u),{success:!1,error:u.message}}},eliminarRecurso:async i=>{if(!_.value)return{success:!1,error:"User not logged in"};try{const{error:a}=await y.from("recursos_repositorio").update({activo:!1}).eq("id",i).eq("created_by",_.value.id);return a?(console.error("Error eliminando recurso:",a),{success:!1,error:a.message}):{success:!0}}catch(a){return console.error("Error en eliminarRecurso:",a),{success:!1,error:a.message}}}}},ve={class:"bg-[#F2F2F2] rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden"},fe={class:"bg-gradient-to-r from-[#5550F2] to-[#E2E8F0] px-6 py-5"},xe={class:"flex items-center justify-between"},ge={class:"text-sm text-white/90 mt-1"},be={class:"p-6 overflow-y-auto max-h-[calc(90vh-200px)]"},he={class:"space-y-5"},we={class:"relative"},ye={key:0,class:"text-center py-8"},_e={key:1,class:"text-center py-8"},Ee={key:2,class:"bg-white border border-[#E2E8F0]/50 rounded-xl max-h-60 overflow-y-auto"},De=["value"],ke={class:"flex-1"},Fe={class:"font-medium text-[#2D3748]"},Ce={key:0,class:"text-sm text-[#2D3748]/60"},Re={key:3,class:"text-sm text-[#2D3748]/70 mt-2"},$e={key:0,class:"bg-red-50 border border-red-200 rounded-xl p-4"},Ae={class:"flex items-start gap-3"},Ve={class:"text-sm text-red-800"},Le={key:1,class:"bg-[#5550F2]/10 border border-[#5550F2]/30 rounded-xl p-4"},je={class:"bg-white border-t border-[#E2E8F0]/30 px-6 py-4 flex items-center justify-between"},Me={class:"flex items-center gap-3"},Ue=["disabled"],Se=["disabled"],qe={__name:"ModalCompartirRecurso",props:{modelValue:{type:Boolean,required:!0},recurso:{type:Object,default:null}},emits:["update:modelValue","compartido"],setup(y,{emit:_}){const x=y,R=_,{getPacientes:F,compartirRecurso:D}=Q(),s=m([]),g=m(""),v=m([]),E=m(""),A=m(!1),w=m(!1),i=m(""),a=S(()=>{if(!g.value)return s.value;const r=g.value.toLowerCase();return s.value.filter(t=>(t.nombre||"").toLowerCase().includes(r)||(t.email||"").toLowerCase().includes(r)||(t.area_de_acompanamiento||"").toLowerCase().includes(r))});N(()=>x.modelValue,async r=>{r?await u():C()});const u=async()=>{A.value=!0,i.value="";try{const r=await F();s.value=r||[]}catch(r){console.error("Error al cargar pacientes:",r),i.value="Error al cargar la lista de pacientes"}finally{A.value=!1}},c=async()=>{if(!(v.value.length===0||!x.recurso)){w.value=!0,i.value="";try{const r=await D(x.recurso.id,v.value,E.value||void 0);if(!r.success)throw new Error(r.error||"Error al compartir el recurso");R("compartido",{recursoId:x.recurso.id,pacientes:v.value,cantidad:v.value.length}),R("update:modelValue",!1)}catch(r){console.error("Error al compartir recurso:",r),i.value=r.message||"Error al compartir el recurso. Intenta de nuevo."}finally{w.value=!1}}},C=()=>{v.value=[],E.value="",g.value="",i.value=""};return(r,t)=>(d(),X(H,{to:"body"},[j(I,{name:"modal"},{default:q(()=>[y.modelValue?(d(),p("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/40 backdrop-blur-sm",onClick:t[5]||(t[5]=T(l=>r.$emit("update:modelValue",!1),["self"]))},[e("div",ve,[e("div",fe,[e("div",xe,[e("div",null,[t[6]||(t[6]=e("h2",{class:"text-2xl font-serif text-white"},"Compartir Recurso",-1)),e("p",ge,f(y.recurso?.titulo),1)]),e("button",{onClick:t[0]||(t[0]=l=>r.$emit("update:modelValue",!1)),class:"text-white hover:bg-white/20 rounded-lg p-2 transition"},[...t[7]||(t[7]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),e("div",be,[e("div",he,[e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm font-sans font-semibold text-[#2D3748] mb-2"}," Buscar paciente ",-1)),e("div",we,[$(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>g.value=l),type:"text",placeholder:"Buscar por nombre...",class:"w-full px-4 py-3 pl-10 bg-white border border-[#E2E8F0]/50 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#5550F2] text-[#2D3748]"},null,512),[[V,g.value]]),t[8]||(t[8]=e("svg",{class:"w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-[#2D3748]/40",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))])]),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-sans font-semibold text-[#2D3748] mb-2"}," Seleccionar pacientes * ",-1)),A.value?(d(),p("div",ye,[...t[10]||(t[10]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#5550F2] mx-auto"},null,-1),e("p",{class:"text-sm text-[#2D3748]/60 mt-2"},"Cargando pacientes...",-1)])])):a.value.length===0?(d(),p("div",_e,[...t[11]||(t[11]=[e("p",{class:"text-sm text-[#2D3748]/60"},"No se encontraron pacientes",-1)])])):(d(),p("div",Ee,[(d(!0),p(z,null,P(a.value,l=>(d(),p("label",{key:l.id,class:"flex items-center gap-3 p-4 hover:bg-[#F2F2F2] cursor-pointer border-b border-[#E2E8F0]/30 last:border-0 transition"},[$(e("input",{type:"checkbox",value:l.id,"onUpdate:modelValue":t[2]||(t[2]=L=>v.value=L),class:"w-5 h-5 text-[#5550F2] rounded focus:ring-2 focus:ring-[#5550F2]"},null,8,De),[[ce,v.value]]),e("div",ke,[e("p",Fe,f(l.nombre),1),l.email?(d(),p("p",Ce,f(l.email),1)):k("",!0)])]))),128))])),v.value.length>0?(d(),p("p",Re,f(v.value.length)+" paciente(s) seleccionado(s) ",1)):k("",!0)]),e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-sans font-semibold text-[#2D3748] mb-2"}," Mensaje opcional ",-1)),$(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=l=>E.value=l),rows:"3",placeholder:"A√±ade un mensaje personalizado para el paciente...",class:"w-full px-4 py-3 bg-white border border-[#E2E8F0]/50 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#5550F2] text-[#2D3748] resize-none"},null,512),[[V,E.value]]),t[14]||(t[14]=e("p",{class:"text-xs text-[#2D3748]/60 mt-1"}," Este mensaje se incluir√° en la notificaci√≥n que recibir√° el paciente ",-1))]),i.value?(d(),p("div",$e,[e("div",Ae,[t[15]||(t[15]=e("svg",{class:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1)),e("p",Ve,f(i.value),1)])])):k("",!0),w.value?(d(),p("div",Le,[...t[16]||(t[16]=[e("div",{class:"flex items-center gap-3"},[e("div",{class:"animate-spin rounded-full h-5 w-5 border-b-2 border-[#5550F2]"}),e("span",{class:"text-sm text-[#2D3748]"},"Compartiendo recurso...")],-1)])])):k("",!0)])]),e("div",je,[t[17]||(t[17]=e("p",{class:"text-sm text-[#2D3748]/70"}," Los pacientes recibir√°n una notificaci√≥n autom√°tica ",-1)),e("div",Me,[e("button",{type:"button",onClick:t[4]||(t[4]=l=>r.$emit("update:modelValue",!1)),disabled:w.value,class:"px-6 py-2.5 text-[#2D3748] font-sans rounded-xl hover:bg-[#F2F2F2] transition disabled:opacity-50"}," Cancelar ",8,Ue),e("button",{onClick:c,disabled:w.value||v.value.length===0,class:"px-6 py-2.5 bg-[#5550F2] text-white font-sans font-semibold rounded-xl hover:bg-[#5550F2]/90 transition disabled:opacity-50 disabled:cursor-not-allowed"},f(w.value?"Compartiendo...":"Enviar Recurso"),9,Se)])])])])):k("",!0)]),_:1})]))}},Te=O(qe,[["__scopeId","data-v-c902ca26"]]),ze={class:"bg-[#F2F2F2] rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden"},Pe={class:"bg-gradient-to-r from-[#5550F2] to-[#E2E8F0] px-6 py-5"},Ie={class:"flex items-center justify-between"},Be={class:"text-2xl font-serif text-white"},Ge={class:"text-sm text-white/90 mt-1"},Ne={class:"space-y-5"},Oe={class:"grid grid-cols-2 gap-4"},Qe={class:"flex gap-2"},We={class:"flex flex-wrap gap-2 flex-1"},Ye=["onClick"],Je={key:0,class:"flex flex-wrap gap-2 mt-2"},Ke=["onClick"],Xe={key:0,class:"bg-red-50 border border-red-200 rounded-xl p-4"},He={class:"flex items-start gap-3"},Ze={class:"text-sm text-red-800"},et={class:"bg-white border-t border-[#E2E8F0]/30 px-6 py-4 flex items-center justify-end gap-3"},tt=["disabled"],ot=["disabled"],st={key:0,class:"inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"},rt={__name:"ModalRecurso",props:{modelValue:{type:Boolean,required:!0},recurso:{type:Object,default:null}},emits:["update:modelValue","guardado"],setup(y,{emit:_}){const x=y,R=_,{crearRecurso:F,actualizarRecurso:D}=Q(),s=m({titulo:"",descripcion:"",tipo:"",categoria:"",url:"",icono:"üìÑ",tags:[]}),g=m(""),v=m(!1),E=m(""),A=["üìã","üéµ","üé•","üßò","üìñ","üìÑ","üåü","üí°","üéØ","‚ú®"],w=S(()=>!!x.recurso),i=S(()=>s.value.titulo.trim()!==""&&s.value.descripcion.trim()!==""&&s.value.tipo!==""&&s.value.url.trim()!=="");N(g,r=>{if(r.includes(",")){const t=r.split(",").map(l=>l.trim()).filter(l=>l!==""&&!s.value.tags.includes(l));s.value.tags.push(...t),g.value=""}}),N(()=>x.modelValue,r=>{r&&(x.recurso?s.value={titulo:x.recurso.titulo||"",descripcion:x.recurso.descripcion||"",tipo:x.recurso.tipo||"",categoria:x.recurso.categoria||"",url:x.recurso.url||"",icono:x.recurso.icono||"üìÑ",tags:x.recurso.tags?[...x.recurso.tags]:[]}:C())});const a=r=>{s.value.tags.splice(r,1)},u=async()=>{if(i.value){v.value=!0,E.value="";try{if(w.value){const r=await D(x.recurso.id,{titulo:s.value.titulo,descripcion:s.value.descripcion,tipo:s.value.tipo,categoria:s.value.categoria||null,url:s.value.url,icono:s.value.icono,tags:s.value.tags.length>0?s.value.tags:null});if(!r.success)throw new Error(r.error||"Error al actualizar el recurso");R("guardado",r.data),R("update:modelValue",!1)}else{const r=await F({titulo:s.value.titulo,descripcion:s.value.descripcion,tipo:s.value.tipo,categoria:s.value.categoria||null,url:s.value.url,icono:s.value.icono,tags:s.value.tags.length>0?s.value.tags:null});if(!r.success)throw new Error(r.error||"Error al crear el recurso");R("guardado",r.data),R("update:modelValue",!1)}}catch(r){console.error("Error al guardar recurso:",r),E.value=r.message||"Error al guardar el recurso. Intenta de nuevo."}finally{v.value=!1}}},c=()=>{v.value||R("update:modelValue",!1)},C=()=>{s.value={titulo:"",descripcion:"",tipo:"",categoria:"",url:"",icono:"üìÑ",tags:[]},g.value="",E.value=""};return(r,t)=>(d(),X(H,{to:"body"},[j(I,{name:"modal"},{default:q(()=>[y.modelValue?(d(),p("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/40 backdrop-blur-sm",onClick:T(c,["self"])},[e("div",ze,[e("div",Pe,[e("div",Ie,[e("div",null,[e("h2",Be,f(w.value?"‚úèÔ∏è Editar Recurso":"‚ûï Nuevo Recurso"),1),e("p",Ge,f(w.value?"Modifica la informaci√≥n del recurso":"A√±ade un nuevo recurso al repositorio"),1)]),e("button",{onClick:c,class:"text-white hover:bg-white/20 rounded-lg p-2 transition"},[...t[7]||(t[7]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),e("form",{onSubmit:T(u,["prevent"]),class:"p-6 overflow-y-auto max-h-[calc(90vh-200px)]"},[e("div",Ne,[e("div",null,[t[8]||(t[8]=e("label",{class:"block text-sm font-sans font-semibold text-[#2D3748] mb-2"}," T√≠tulo del recurso * ",-1)),$(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>s.value.titulo=l),type:"text",required:"",placeholder:"Ej: Gu√≠a de respiraci√≥n consciente",class:"w-full px-4 py-3 bg-white border border-[#E2E8F0]/50 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#5550F2] text-[#2D3748]"},null,512),[[V,s.value.titulo]])]),e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm font-sans font-semibold text-[#2D3748] mb-2"}," Descripci√≥n * ",-1)),$(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=l=>s.value.descripcion=l),rows:"3",required:"",placeholder:"Describe brevemente el contenido del recurso...",class:"w-full px-4 py-3 bg-white border border-[#E2E8F0]/50 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#5550F2] text-[#2D3748] resize-none"},null,512),[[V,s.value.descripcion]])]),e("div",Oe,[e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-sans font-semibold text-[#2D3748] mb-2"}," Tipo * ",-1)),$(e("select",{"onUpdate:modelValue":t[2]||(t[2]=l=>s.value.tipo=l),required:"",class:"w-full px-4 py-3 bg-white border border-[#E2E8F0]/50 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#5550F2] text-[#2D3748]"},[...t[10]||(t[10]=[e("option",{value:""},"Seleccionar...",-1),e("option",{value:"Gu√≠a"},"üìã Gu√≠a",-1),e("option",{value:"Audio"},"üéµ Audio",-1),e("option",{value:"Video"},"üé• Video",-1),e("option",{value:"Ejercicio"},"üßò Ejercicio",-1),e("option",{value:"Lectura"},"üìñ Lectura",-1),e("option",{value:"PDF"},"üìÑ PDF",-1)])],512),[[K,s.value.tipo]])]),e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-sans font-semibold text-[#2D3748] mb-2"}," Categor√≠a ",-1)),$(e("select",{"onUpdate:modelValue":t[3]||(t[3]=l=>s.value.categoria=l),class:"w-full px-4 py-3 bg-white border border-[#E2E8F0]/50 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#5550F2] text-[#2D3748]"},[...t[12]||(t[12]=[e("option",{value:""},"Sin categor√≠a",-1),e("option",{value:"Ansiedad"},"Ansiedad",-1),e("option",{value:"Mindfulness"},"Mindfulness",-1),e("option",{value:"Relajaci√≥n"},"Relajaci√≥n",-1),e("option",{value:"Autoestima"},"Autoestima",-1),e("option",{value:"TCC"},"TCC",-1),e("option",{value:"Estr√©s"},"Estr√©s",-1),e("option",{value:"Depresi√≥n"},"Depresi√≥n",-1),e("option",{value:"Relaciones"},"Relaciones",-1),e("option",{value:"Otro"},"Otro",-1)])],512),[[K,s.value.categoria]])])]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-sans font-semibold text-[#2D3748] mb-2"}," URL del recurso * ",-1)),$(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>s.value.url=l),type:"url",required:"",placeholder:"https://...",class:"w-full px-4 py-3 bg-white border border-[#E2E8F0]/50 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#5550F2] text-[#2D3748]"},null,512),[[V,s.value.url]]),t[15]||(t[15]=e("p",{class:"text-xs text-[#2D3748]/60 mt-1"}," Enlace directo al recurso (YouTube, PDF, art√≠culo web, etc.) ",-1))]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-sans font-semibold text-[#2D3748] mb-2"}," Icono (emoji) ",-1)),e("div",Qe,[$(e("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>s.value.icono=l),type:"text",maxlength:"2",placeholder:"üìö",class:"w-20 px-4 py-3 bg-white border border-[#E2E8F0]/50 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#5550F2] text-center text-2xl"},null,512),[[V,s.value.icono]]),e("div",We,[(d(),p(z,null,P(A,l=>e("button",{key:l,type:"button",onClick:L=>s.value.icono=l,class:"px-3 py-2 text-2xl hover:bg-[#E2E8F0]/30 rounded-lg transition"},f(l),9,Ye)),64))])])]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-sans font-semibold text-[#2D3748] mb-2"}," Etiquetas ",-1)),$(e("input",{"onUpdate:modelValue":t[6]||(t[6]=l=>g.value=l),type:"text",placeholder:"respiraci√≥n, mindfulness, ansiedad (separadas por comas)",class:"w-full px-4 py-3 bg-white border border-[#E2E8F0]/50 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#5550F2] text-[#2D3748]"},null,512),[[V,g.value]]),t[18]||(t[18]=e("p",{class:"text-xs text-[#2D3748]/60 mt-1"}," Separa las etiquetas con comas ",-1)),s.value.tags.length>0?(d(),p("div",Je,[(d(!0),p(z,null,P(s.value.tags,(l,L)=>(d(),p("span",{key:L,class:"px-3 py-1 bg-[#5550F2]/20 text-[#2D3748] rounded-full text-sm flex items-center gap-2"},[de(" #"+f(l)+" ",1),e("button",{type:"button",onClick:M=>a(L),class:"text-[#2D3748]/50 hover:text-[#2D3748]"}," √ó ",8,Ke)]))),128))])):k("",!0)]),E.value?(d(),p("div",Xe,[e("div",He,[t[19]||(t[19]=e("svg",{class:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1)),e("p",Ze,f(E.value),1)])])):k("",!0)])],32),e("div",et,[e("button",{type:"button",onClick:c,disabled:v.value,class:"px-6 py-2.5 text-[#2D3748] font-sans rounded-xl hover:bg-[#F2F2F2] transition disabled:opacity-50"}," Cancelar ",8,tt),e("button",{onClick:u,disabled:v.value||!i.value,class:"px-6 py-2.5 bg-[#5550F2] text-white font-sans font-semibold rounded-xl hover:bg-[#5550F2]/90 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"},[v.value?(d(),p("span",st)):k("",!0),e("span",null,f(v.value?"Guardando...":w.value?"Guardar Cambios":"Crear Recurso"),1)],8,ot)])])])):k("",!0)]),_:1})]))}},at=O(rt,[["__scopeId","data-v-e31be23c"]]),lt={class:"min-h-screen bg-[#F9F7F3] py-8"},nt={class:"container mx-auto px-4 max-w-7xl"},it={key:0,class:"mb-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-xl"},ut={key:1,class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"},ct={class:"bg-white rounded-xl p-4 border border-[#EAD5D3]/30"},dt={class:"flex items-center gap-3"},pt={class:"text-2xl font-['Lora'] font-bold text-[#5D4A44]"},mt={class:"bg-white rounded-xl p-4 border border-[#EAD5D3]/30"},vt={class:"flex items-center gap-3"},ft={class:"text-2xl font-['Lora'] font-bold text-[#5D4A44]"},xt={class:"bg-white rounded-xl p-4 border border-[#EAD5D3]/30"},gt={class:"flex items-center gap-3"},bt={class:"text-2xl font-['Lora'] font-bold text-[#5D4A44]"},ht={class:"bg-white rounded-xl p-6 mb-6 border border-[#EAD5D3]/30"},wt={key:2,class:"text-center py-12"},yt={key:3,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},_t={class:"flex justify-between mb-3"},Et={class:"text-2xl"},Dt={class:"text-xs px-3 py-1 rounded-full bg-[#EAD5D3]/50"},kt={class:"font-['Lora'] text-lg text-[#5D4A44] mb-2"},Ft={class:"text-sm text-[#5D4A44]/70 mb-4 line-clamp-2"},Ct={key:0,class:"mb-4"},Rt={class:"text-xs px-2 py-1 bg-[#D8AFA0]/20 text-[#5D4A44] rounded"},$t={class:"flex flex-col gap-2"},At={class:"flex gap-2"},Vt=["href"],Lt=["onClick"],jt={class:"flex gap-2"},Mt=["onClick"],Ut=["onClick"],St={key:4,class:"text-center py-12"},qt={class:"text-xl font-['Lora'] font-semibold text-[#5D4A44] mb-2"},Tt={class:"text-[#5D4A44]/60"},zt={key:0,class:"fixed bottom-6 right-6 bg-green-500 text-white px-6 py-4 rounded-xl shadow-lg flex items-center gap-3 z-50"},Pt={class:"font-semibold"},It={class:"text-sm opacity-90"},Bt={class:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-6"},Gt={class:"flex gap-3"},Nt={__name:"recursos",setup(y){const{getRecursosRepositorio:_,getEstadisticasRecursos:x,eliminarRecurso:R}=Q(),F=m(""),D=m([]),s=m(!0),g=m(null),v=m(!1),E=m(!1),A=m(null),w=m(!1),i=m(null),a=m(!1),u=m(null),c=m(!1),C=m(""),r=m(""),t=S(()=>{if(!F.value)return D.value;const n=F.value.toLowerCase();return D.value.filter(o=>o.titulo?.toLowerCase().includes(n)||o.descripcion?.toLowerCase().includes(n)||o.categoria?.toLowerCase().includes(n)||o.tipo?.toLowerCase().includes(n))}),l=[{id:"demo-1",titulo:"Gu√≠a de Respiraci√≥n Consciente",descripcion:"Ejercicios de respiraci√≥n para manejo de ansiedad y momentos de estr√©s",tipo:"Gu√≠a",icono:"üìã",url:"https://www.youtube.com/watch?v=YRPh_GaiL8s",categoria:"Ansiedad",tags:["respiraci√≥n","ansiedad","mindfulness"]},{id:"demo-2",titulo:"Meditaci√≥n Guiada 10min",descripcion:"Audio de meditaci√≥n para principiantes y pr√°ctica diaria",tipo:"Audio",icono:"üéµ",url:"https://www.youtube.com/watch?v=O-6f5wQXSu8",categoria:"Mindfulness",tags:["meditaci√≥n","mindfulness","relajaci√≥n"]},{id:"demo-3",titulo:"Relajaci√≥n Muscular Progresiva",descripcion:"Video tutorial de t√©cnicas de relajaci√≥n paso a paso",tipo:"Video",icono:"üé•",url:"https://www.youtube.com/watch?v=ihO02wUzgkc",categoria:"Relajaci√≥n",tags:["relajaci√≥n","t√©cnicas","estr√©s"]},{id:"demo-4",titulo:"Diario de Gratitud",descripcion:"Plantilla y gu√≠a para llevar un diario de gratitud efectivo",tipo:"Ejercicio",icono:"üßò",url:"https://positivepsychology.com/gratitude-journal/",categoria:"Autoestima",tags:["gratitud","autoestima","bienestar"]},{id:"demo-5",titulo:"Mindfulness y Autocuidado",descripcion:"Art√≠culo completo sobre mindfulness en la vida diaria",tipo:"Lectura",icono:"üìñ",url:"https://www.mindful.org/meditation/mindfulness-getting-started/",categoria:"Mindfulness",tags:["mindfulness","autocuidado","vida diaria"]},{id:"demo-6",titulo:"Registro de Pensamientos TCC",descripcion:"Formato para registro de pensamientos autom√°ticos seg√∫n TCC",tipo:"PDF",icono:"üìÑ",url:"https://beckinstitute.org/cognitive-model/",categoria:"TCC",tags:["tcc","pensamientos","terapia cognitiva"]}],L=async()=>{s.value=!0;try{const n=await _();n&&n.length>0?(D.value=n,v.value=!1):(console.log("üìö Usando recursos de demostraci√≥n"),D.value=l,v.value=!0)}catch(n){console.error("Error cargando recursos, usando demo:",n),D.value=l,v.value=!0}finally{s.value=!1}},M=async()=>{try{const n=await x();n?g.value=n:g.value={total:2,vistos:1,pendientes:1,porcentajeVisto:50}}catch(n){console.error("Error cargando estad√≠sticas:",n),g.value={total:0,vistos:0,pendientes:0,porcentajeVisto:0}}},Z=n=>{A.value=n,E.value=!0},ee=()=>{i.value=null,w.value=!0},te=n=>{if(n.id?.startsWith("demo")){Y("Recursos de demostraci√≥n","Los recursos demo no se pueden editar. Crea uno nuevo o ejecuta la migraci√≥n SQL.");return}i.value=n,w.value=!0},oe=n=>{if(n.id?.startsWith("demo")){Y("Recursos de demostraci√≥n","Los recursos demo no se pueden eliminar.");return}u.value=n,a.value=!0},se=async()=>{if(u.value)try{const n=await R(u.value.id);n.success?(D.value=D.value.filter(o=>o.id!==u.value.id),U("¬°Recurso eliminado!","El recurso ha sido eliminado del repositorio"),M()):W("Error",n.error||"No se pudo eliminar el recurso")}catch(n){console.error("Error eliminando recurso:",n),W("Error","Ocurri√≥ un error al eliminar el recurso")}finally{a.value=!1,u.value=null}},re=n=>{U("¬°Recurso compartido!",`Compartido con ${n.cantidad} paciente${n.cantidad>1?"s":""}`),M()},ae=n=>{if(i.value){const o=D.value.findIndex(B=>B.id===n.id);o!==-1&&(D.value[o]=n),U("¬°Recurso actualizado!","Los cambios se han guardado correctamente")}else D.value.unshift(n),U("¬°Recurso creado!","El nuevo recurso est√° listo para compartir");M()},U=(n,o)=>{C.value=n,r.value=o,c.value=!0,setTimeout(()=>{c.value=!1},3e3)},W=(n,o)=>{C.value=n,r.value=o,c.value=!0,setTimeout(()=>{c.value=!1},3e3)},Y=(n,o)=>{C.value=n,r.value=o,c.value=!0,setTimeout(()=>{c.value=!1},3e3)};return pe(()=>{L(),M()}),(n,o)=>{const B=Te,le=at;return d(),p("div",lt,[e("div",nt,[h(v)?(d(),p("div",it,[...o[5]||(o[5]=[me('<div class="flex items-start gap-3" data-v-ce5bceaf><span class="text-3xl" data-v-ce5bceaf>üé≠</span><div class="flex-1" data-v-ce5bceaf><h3 class="font-[&#39;Lora&#39;] text-lg font-semibold text-blue-900 mb-1" data-v-ce5bceaf> Modo Demostraci√≥n - Recursos Precargados </h3><p class="text-sm text-blue-700 leading-relaxed" data-v-ce5bceaf> Est√°s viendo <strong data-v-ce5bceaf>6 recursos de ejemplo</strong> listos para compartir con tus pacientes. Para usar el repositorio real, ejecuta la migraci√≥n SQL en Supabase: <code class="px-2 py-0.5 bg-blue-100 rounded" data-v-ce5bceaf>supabase/migrations/20251019_recursos_compartidos.sql</code></p></div></div>',1)])])):k("",!0),e("div",{class:"mb-8 flex items-start justify-between"},[o[7]||(o[7]=e("div",null,[e("h1",{class:"text-4xl font-['Lora'] text-[#5D4A44] mb-2"},"üìö Recursos Terap√©uticos"),e("p",{class:"text-[#5D4A44]/70"},"Biblioteca de materiales para compartir con tus pacientes")],-1)),e("button",{onClick:ee,class:"px-6 py-3 bg-[#D8AFA0] text-white rounded-xl hover:bg-[#D8AFA0]/90 transition-colors flex items-center gap-2 whitespace-nowrap"},[...o[6]||(o[6]=[e("span",{class:"text-xl"},"‚ûï",-1),e("span",{class:"font-['Lato'] font-semibold"},"Nuevo Recurso",-1)])])]),h(g)?(d(),p("div",ut,[e("div",ct,[e("div",dt,[o[9]||(o[9]=e("span",{class:"text-3xl"},"üì§",-1)),e("div",null,[e("p",pt,f(h(g).total),1),o[8]||(o[8]=e("p",{class:"text-sm text-[#5D4A44]/70"},"Recursos compartidos",-1))])])]),e("div",mt,[e("div",vt,[o[11]||(o[11]=e("span",{class:"text-3xl"},"üëÅÔ∏è",-1)),e("div",null,[e("p",ft,f(h(g).vistos),1),o[10]||(o[10]=e("p",{class:"text-sm text-[#5D4A44]/70"},"Vistos por pacientes",-1))])])]),e("div",xt,[e("div",gt,[o[13]||(o[13]=e("span",{class:"text-3xl"},"‚è≥",-1)),e("div",null,[e("p",bt,f(h(g).pendientes),1),o[12]||(o[12]=e("p",{class:"text-sm text-[#5D4A44]/70"},"Pendientes de ver",-1))])])])])):k("",!0),e("div",ht,[$(e("input",{"onUpdate:modelValue":o[0]||(o[0]=b=>G(F)?F.value=b:null),type:"text",placeholder:"Buscar recursos por t√≠tulo, descripci√≥n o categor√≠a...",class:"w-full px-4 py-3 bg-[#F9F7F3] border border-[#EAD5D3]/50 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#D8AFA0]"},null,512),[[V,h(F)]])]),h(s)?(d(),p("div",wt,[...o[14]||(o[14]=[e("div",{class:"animate-spin w-12 h-12 border-4 border-[#D8AFA0] border-t-transparent rounded-full mx-auto mb-4"},null,-1),e("p",{class:"text-[#5D4A44]/60"},"Cargando recursos...",-1)])])):h(t).length>0?(d(),p("div",yt,[(d(!0),p(z,null,P(h(t),b=>(d(),p("div",{key:b.id,class:"bg-white rounded-xl shadow-sm border border-[#EAD5D3]/30 p-6 hover:shadow-md transition-shadow"},[e("div",_t,[e("span",Et,f(b.icono),1),e("span",Dt,f(b.tipo),1)]),e("h3",kt,f(b.titulo),1),e("p",Ft,f(b.descripcion),1),b.categoria?(d(),p("div",Ct,[e("span",Rt,f(b.categoria),1)])):k("",!0),e("div",$t,[e("div",At,[e("a",{href:b.url,target:"_blank",class:"flex-1 text-center px-3 py-2 text-sm bg-[#F9F7F3] text-[#5D4A44] rounded-lg hover:bg-[#EAD5D3]/30 transition-colors"}," üëÅÔ∏è Ver ",8,Vt),e("button",{onClick:J=>Z(b),class:"flex-1 px-3 py-2 text-sm bg-[#D8AFA0] text-white rounded-lg hover:bg-[#D8AFA0]/90 transition-colors"}," üì§ Compartir ",8,Lt)]),e("div",jt,[e("button",{onClick:J=>te(b),class:"flex-1 px-3 py-2 text-sm bg-white border border-[#EAD5D3] text-[#5D4A44] rounded-lg hover:bg-[#F9F7F3] transition-colors"}," ‚úèÔ∏è Editar ",8,Mt),b.id?.startsWith("demo")?k("",!0):(d(),p("button",{key:0,onClick:J=>oe(b),class:"flex-1 px-3 py-2 text-sm bg-white border border-red-200 text-red-600 rounded-lg hover:bg-red-50 transition-colors"}," üóëÔ∏è Eliminar ",8,Ut))])])]))),128))])):(d(),p("div",St,[o[15]||(o[15]=e("span",{class:"text-6xl block mb-4 opacity-40"},"üìö",-1)),e("h3",qt,f(h(F)?"No se encontraron recursos":"No hay recursos disponibles"),1),e("p",Tt,f(h(F)?"Intenta con otros t√©rminos de b√∫squeda":"Los recursos se cargar√°n autom√°ticamente"),1)]))]),j(B,{modelValue:h(E),"onUpdate:modelValue":o[1]||(o[1]=b=>G(E)?E.value=b:null),recurso:h(A),onCompartido:re},null,8,["modelValue","recurso"]),j(le,{modelValue:h(w),"onUpdate:modelValue":o[2]||(o[2]=b=>G(w)?w.value=b:null),recurso:h(i),onGuardado:ae},null,8,["modelValue","recurso"]),j(I,{name:"slide-up"},{default:q(()=>[h(c)?(d(),p("div",zt,[o[16]||(o[16]=e("span",{class:"text-2xl"},"‚úÖ",-1)),e("div",null,[e("p",Pt,f(h(C)),1),e("p",It,f(h(r)),1)])])):k("",!0)]),_:1}),j(I,{name:"modal"},{default:q(()=>[h(a)?(d(),p("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/40 backdrop-blur-sm",onClick:o[4]||(o[4]=T(b=>a.value=!1,["self"]))},[e("div",Bt,[o[17]||(o[17]=e("div",{class:"text-center mb-6"},[e("span",{class:"text-6xl block mb-4"},"‚ö†Ô∏è"),e("h3",{class:"text-xl font-['Lora'] font-semibold text-[#5D4A44] mb-2"}," ¬øEliminar recurso? "),e("p",{class:"text-sm text-[#5D4A44]/70"}," Esta acci√≥n no se puede deshacer. El recurso se ocultar√° del repositorio. ")],-1)),e("div",Gt,[e("button",{onClick:o[3]||(o[3]=b=>a.value=!1),class:"flex-1 px-4 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-colors font-['Lato'] font-medium"}," Cancelar "),e("button",{onClick:se,class:"flex-1 px-4 py-3 bg-red-500 text-white rounded-xl hover:bg-red-600 transition-colors font-['Lato'] font-semibold"}," Eliminar ")])])])):k("",!0)]),_:1})])}}},Wt=O(Nt,[["__scopeId","data-v-ce5bceaf"]]);export{Wt as default};
