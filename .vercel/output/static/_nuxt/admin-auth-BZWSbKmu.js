import{ak as d,p as c,al as s,q as o}from"#entry";const h=d(async(u,p)=>{let e,a;const i=c();try{const{data:{user:t}}=([e,a]=s(()=>i.auth.getUser()),e=await e,a(),e);if(!t)return console.warn("[admin-auth] Usuario no autenticado, redirigiendo a login"),o("/login");const{data:r,error:n}=([e,a]=s(()=>i.from("profiles").select("rol").eq("id",t.id).single()),e=await e,a(),e);if(n)return console.error("[admin-auth] Error al obtener perfil:",n),o("/login");if(!r)return console.error("[admin-auth] No se encontr√≥ perfil para el usuario"),o("/login");if(!["admin","coordinadora"].includes(r.rol)){console.warn(`[admin-auth] Acceso denegado. Rol del usuario: ${r.rol}`);const l={psicologa:"/terapeuta/dashboard",terapeuta:"/terapeuta/dashboard",paciente:"/paciente/dashboard"}[r.rol]||"/login";return o(l)}console.log(`[admin-auth] Acceso permitido para usuario con rol: ${r.rol}`)}catch(t){return console.error("[admin-auth] Error en middleware:",t),o("/login")}});export{h as default};
