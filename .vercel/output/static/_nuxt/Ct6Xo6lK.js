import{u as E}from"./BbZO5sJf.js";import{c as m,o as x,a as t,e as $,r as _,q as L,f as V,F as R,b as r,k as d,t as e,g as F,s as U,x as I,y as X}from"#entry";import{r as q}from"./Dge-tWFD.js";import{r as G}from"./G1mM6o1b.js";import{r as Q}from"./C0vq0F4x.js";import{r as v}from"./mZ3toP8Y.js";import{r as H}from"./Byc3y-S3.js";import{r as J}from"./DRclOuRO.js";function K(T,g){return x(),m("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 6 9 12.75l4.286-4.286a11.948 11.948 0 0 1 4.306 6.43l.776 2.898m0 0 3.182-5.511m-3.182 5.51-5.511-3.181"})])}const W={key:0,class:"flex items-center justify-center py-24"},Y={class:"mb-8"},Z={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"},tt={class:"bg-white rounded-xl p-6 shadow-md border border-gray-200"},st={class:"flex items-center justify-between mb-4"},et={class:"w-12 h-12 bg-emerald-100 rounded-lg flex items-center justify-center"},ot={class:"text-3xl font-bold text-gray-900"},at={class:"bg-white rounded-xl p-6 shadow-md border border-gray-200"},it={class:"flex items-center justify-between mb-4"},nt={class:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center"},lt={class:"text-3xl font-bold text-gray-900"},rt={class:"bg-white rounded-xl p-6 shadow-md border border-gray-200"},dt={class:"flex items-center justify-between mb-4"},ct={class:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center"},mt={class:"text-3xl font-bold text-gray-900"},xt={class:"bg-white rounded-xl p-6 shadow-md border border-gray-200"},gt={class:"flex items-center justify-between mb-4"},pt={class:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center"},ut={class:"text-3xl font-bold text-gray-900"},bt={class:"bg-white rounded-xl p-6 shadow-md border border-gray-200"},ft={class:"flex items-center justify-between mb-4"},yt={class:"w-12 h-12 bg-teal-100 rounded-lg flex items-center justify-center"},ht={class:"text-3xl font-bold text-gray-900"},_t={class:"bg-white rounded-xl p-6 shadow-md border border-gray-200"},vt={class:"flex items-center justify-between mb-4"},wt={class:"w-12 h-12 bg-amber-100 rounded-lg flex items-center justify-center"},Pt={class:"text-3xl font-bold text-gray-900"},Ct={class:"mb-8"},jt={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},Rt={class:"bg-white rounded-xl p-6 shadow-md border border-gray-200"},Tt={class:"flex items-center gap-4 mb-4"},kt={class:"w-12 h-12 bg-indigo-100 rounded-lg flex items-center justify-center"},zt={class:"text-2xl font-bold text-gray-900"},At={class:"space-y-2 text-sm"},Nt={class:"flex justify-between"},St={class:"font-semibold text-gray-900"},Bt={class:"flex justify-between"},Ot={class:"font-semibold text-gray-900"},Dt={class:"bg-white rounded-xl p-6 shadow-md border border-gray-200"},Mt={class:"flex items-center gap-4 mb-4"},Et={class:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center"},$t={class:"text-2xl font-bold text-gray-900"},Lt={class:"space-y-2 text-sm"},Vt={class:"flex justify-between"},Ft={class:"font-semibold text-emerald-600"},Ut={class:"flex justify-between"},It={class:"font-semibold text-gray-600"},Xt={class:"bg-white rounded-xl p-6 shadow-md border border-gray-200"},qt={class:"flex items-center gap-4 mb-4"},Gt={class:"w-12 h-12 bg-emerald-100 rounded-lg flex items-center justify-center"},Qt={class:"text-2xl font-bold text-gray-900"},Ht={class:"space-y-2 text-sm"},Jt={class:"flex justify-between"},Kt={class:"font-semibold text-emerald-600"},Wt={class:"flex justify-between"},Yt={class:"font-semibold text-red-600"},Zt={class:"mb-8"},ts={class:"bg-white rounded-xl shadow-md border border-gray-200 overflow-hidden"},ss={class:"overflow-x-auto"},es={class:"min-w-full divide-y divide-gray-200"},os={class:"bg-white divide-y divide-gray-200"},as={class:"px-6 py-4 whitespace-nowrap"},is={class:"flex items-center"},ns={class:"w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-500 rounded-full flex items-center justify-center text-white font-bold text-sm"},ls={class:"ml-4"},rs={class:"text-sm font-semibold text-gray-900"},ds={class:"text-sm text-gray-500"},cs={class:"px-6 py-4 whitespace-nowrap"},ms={class:"text-sm font-semibold text-gray-900"},xs={class:"text-xs text-gray-500"},gs={class:"px-6 py-4 whitespace-nowrap"},ps={class:"text-sm font-semibold text-gray-900"},us={class:"text-xs text-gray-500"},bs={class:"px-6 py-4 whitespace-nowrap"},fs={class:"flex items-center gap-2"},ys={class:"text-sm font-semibold text-gray-900"},hs={class:"w-20 bg-gray-200 rounded-full h-2"},_s={class:"px-6 py-4 whitespace-nowrap"},vs={class:"text-sm font-semibold text-emerald-600"},ws={class:"px-6 py-4 whitespace-nowrap"},Ps={class:"text-sm font-semibold text-indigo-600"},Cs={key:0},js={class:"text-center text-sm text-gray-500"},Ds=$({__name:"index",setup(T){const g=E(),f=_(!0),i=_({ingresoTotal:0,cltvPromedio:0,tasaOcupacionReal:0,tasaOcupacionProyectada:0,ocupacionProximaSemana:0,churnRate:0,totalPacientes:0,pacientesConBono:0,pacientesNuevos:0,totalBonos:0,bonosActivos:0,bonosAgotados:0,totalCitas:0,citasRealizadas:0,citasCanceladas:0}),u=_([]),k=L(()=>new Date().toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})),b=o=>o==null||isNaN(o)?"‚Ç¨0,00":o.toLocaleString("es-ES",{style:"currency",currency:"EUR",minimumFractionDigits:2,maximumFractionDigits:2}),z=async()=>{try{f.value=!0,console.log("üîÑ Cargando m√©tricas del dashboard...");const{data:o,error:s}=await g.rpc("fn_admin_metricas_generales");if(s)throw console.error("Error al cargar m√©tricas:",s),s;console.log("üìä M√©tricas desde SQL:",o),i.value={ingresoTotal:o.ingresoTotal||0,cltvPromedio:o.cltvPromedio||0,tasaOcupacionReal:o.tasaOcupacionReal||0,tasaOcupacionProyectada:o.tasaOcupacionProyectada||0,ocupacionProximaSemana:o.ocupacionProximaSemana||0,churnRate:o.churnRate||0,totalPacientes:o.totalPacientes||0,pacientesConBono:o.pacientesConBono||0,pacientesNuevos:o.pacientesNuevos||0,totalBonos:o.totalBonos||0,bonosActivos:o.bonosActivos||0,bonosAgotados:o.bonosAgotados||0,totalCitas:o.totalCitas||0,citasRealizadas:o.citasRealizadas||0,citasCanceladas:o.citasCanceladas||0},console.log("‚úÖ M√©tricas cargadas:",i.value);const[{data:n},{data:A},{data:N},{data:w}]=await Promise.all([g.from("terapeutas").select("*"),g.from("pacientes").select("*"),g.from("citas").select("*"),g.from("bonos").select("*")]),S=w?.filter(c=>c.pagado===!0)||[],y=new Date;y.setDate(y.getDate()-30);const P=270;u.value=(n||[]).map(c=>{const p=A?.filter(a=>a.terapeuta_id===c.id)||[],h=N?.filter(a=>p.some(l=>l.id===a.paciente_id))||[],B=h.filter(a=>a.estado==="realizada"||a.estado==="confirmada"),O=h.filter(a=>new Date(a.fecha_cita)>=y&&(a.estado==="realizada"||a.estado==="confirmada")).length,C=S.filter(a=>p.some(l=>l.id===a.paciente_id)).reduce((a,l)=>{const j=parseFloat(l.monto_total||"0");return a+(isNaN(j)?0:j)},0),D=p.filter(a=>w?.some(l=>l.paciente_id===a.id&&l.estado==="activo")).length,M=P>0?Math.round(O/P*100):0;return{id:c.id,nombre:c.nombre_completo||"Sin nombre",email:c.email||"",iniciales:(c.nombre_completo||"XX").split(" ").map(a=>a[0]).join("").toUpperCase().slice(0,2),totalPacientes:p.length,pacientesActivos:D,citasRealizadas:B.length,citasTotales:h.length,ocupacion:M,revenue:C,cltvPromedio:p.length>0?C/p.length:0}}),console.log("üë• Terapeutas cargadas:",u.value)}catch(o){console.error("‚ùå Error al cargar m√©tricas:",o)}finally{f.value=!1}};return V(()=>{z()}),(o,s)=>(x(),m("div",null,[s[27]||(s[27]=t("div",{class:"mb-8"},[t("h2",{class:"text-3xl font-bold text-gray-900 mb-2"},"M√©tricas del Negocio"),t("p",{class:"text-gray-600"},"Vista general del rendimiento y estado del sistema")],-1)),f.value?(x(),m("div",W,[...s[0]||(s[0]=[t("div",{class:"text-center"},[t("div",{class:"w-16 h-16 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin mx-auto mb-4"}),t("p",{class:"text-gray-600 font-medium"},"Cargando m√©tricas...")],-1)])])):(x(),m(R,{key:1},[t("section",Y,[s[13]||(s[13]=t("h3",{class:"text-xl font-bold text-gray-900 mb-4"},"Indicadores Clave",-1)),t("div",Z,[t("div",tt,[t("div",st,[t("div",et,[r(d(q),{class:"w-7 h-7 text-emerald-600"})])]),s[1]||(s[1]=t("h4",{class:"text-sm font-semibold text-gray-600 mb-1"},"Ingresos Totales",-1)),t("p",ot,e(b(i.value.ingresoTotal)),1),s[2]||(s[2]=t("p",{class:"text-xs text-gray-500 mt-2"},"Confirmados",-1))]),t("div",at,[t("div",it,[t("div",nt,[r(d(G),{class:"w-7 h-7 text-blue-600"})])]),s[3]||(s[3]=t("h4",{class:"text-sm font-semibold text-gray-600 mb-1"},"CLTV Promedio",-1)),t("p",lt,e(b(i.value.cltvPromedio)),1),s[4]||(s[4]=t("p",{class:"text-xs text-gray-500 mt-2"},"Por paciente",-1))]),t("div",rt,[t("div",dt,[t("div",ct,[r(d(Q),{class:"w-7 h-7 text-purple-600"})])]),s[5]||(s[5]=t("h4",{class:"text-sm font-semibold text-gray-600 mb-1"},"Ocupaci√≥n Real",-1)),t("p",mt,e(i.value.tasaOcupacionReal)+"%",1),s[6]||(s[6]=t("p",{class:"text-xs text-gray-500 mt-2"},"Confirmadas + Realizadas",-1))]),t("div",xt,[t("div",gt,[t("div",pt,[r(d(v),{class:"w-7 h-7 text-blue-600"})])]),s[7]||(s[7]=t("h4",{class:"text-sm font-semibold text-gray-600 mb-1"},"Ocupaci√≥n Proyectada",-1)),t("p",ut,e(i.value.tasaOcupacionProyectada)+"%",1),s[8]||(s[8]=t("p",{class:"text-xs text-gray-500 mt-2"},"√öltimos 30 d√≠as",-1))]),t("div",bt,[t("div",ft,[t("div",yt,[r(d(v),{class:"w-7 h-7 text-teal-600"})])]),s[9]||(s[9]=t("h4",{class:"text-sm font-semibold text-gray-600 mb-1"},"Previsi√≥n Pr√≥xima Semana",-1)),t("p",ht,e(i.value.ocupacionProximaSemana)+"%",1),s[10]||(s[10]=t("p",{class:"text-xs text-gray-500 mt-2"},"Citas programadas",-1))]),t("div",_t,[t("div",vt,[t("div",wt,[r(d(K),{class:"w-7 h-7 text-amber-600"})])]),s[11]||(s[11]=t("h4",{class:"text-sm font-semibold text-gray-600 mb-1"},"Tasa de Abandono",-1)),t("p",Pt,e(i.value.churnRate)+"%",1),s[12]||(s[12]=t("p",{class:"text-xs text-gray-500 mt-2"},"√öltimos 3 meses",-1))])])]),t("section",Ct,[s[23]||(s[23]=t("h3",{class:"text-xl font-bold text-gray-900 mb-4"},"Resumen General",-1)),t("div",jt,[t("div",Rt,[t("div",Tt,[t("div",kt,[r(d(H),{class:"w-7 h-7 text-indigo-600"})]),t("div",null,[s[14]||(s[14]=t("h4",{class:"text-sm font-semibold text-gray-600"},"Pacientes",-1)),t("p",zt,e(i.value.totalPacientes),1)])]),t("div",At,[t("div",Nt,[s[15]||(s[15]=t("span",{class:"text-gray-600"},"Activos con bono:",-1)),t("span",St,e(i.value.pacientesConBono),1)]),t("div",Bt,[s[16]||(s[16]=t("span",{class:"text-gray-600"},"Nuevos (mes):",-1)),t("span",Ot,e(i.value.pacientesNuevos),1)])])]),t("div",Dt,[t("div",Mt,[t("div",Et,[r(d(J),{class:"w-7 h-7 text-purple-600"})]),t("div",null,[s[17]||(s[17]=t("h4",{class:"text-sm font-semibold text-gray-600"},"Bonos",-1)),t("p",$t,e(i.value.totalBonos),1)])]),t("div",Lt,[t("div",Vt,[s[18]||(s[18]=t("span",{class:"text-gray-600"},"Activos:",-1)),t("span",Ft,e(i.value.bonosActivos),1)]),t("div",Ut,[s[19]||(s[19]=t("span",{class:"text-gray-600"},"Agotados:",-1)),t("span",It,e(i.value.bonosAgotados),1)])])]),t("div",Xt,[t("div",qt,[t("div",Gt,[r(d(v),{class:"w-7 h-7 text-emerald-600"})]),t("div",null,[s[20]||(s[20]=t("h4",{class:"text-sm font-semibold text-gray-600"},"Citas",-1)),t("p",Qt,e(i.value.totalCitas),1)])]),t("div",Ht,[t("div",Jt,[s[21]||(s[21]=t("span",{class:"text-gray-600"},"Realizadas:",-1)),t("span",Kt,e(i.value.citasRealizadas),1)]),t("div",Wt,[s[22]||(s[22]=t("span",{class:"text-gray-600"},"Canceladas:",-1)),t("span",Yt,e(i.value.citasCanceladas),1)])])])])]),t("section",Zt,[s[26]||(s[26]=t("h3",{class:"text-xl font-bold text-gray-900 mb-4"},"Rendimiento por Terapeuta",-1)),t("div",ts,[t("div",ss,[t("table",es,[s[25]||(s[25]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider"}," Terapeuta "),t("th",{class:"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider"}," Pacientes "),t("th",{class:"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider"}," Citas Realizadas "),t("th",{class:"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider"}," Ocupaci√≥n "),t("th",{class:"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider"}," Revenue "),t("th",{class:"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider"}," CLTV Promedio ")])],-1)),t("tbody",os,[(x(!0),m(R,null,U(u.value,n=>(x(),m("tr",{key:n.id,class:"hover:bg-gray-50 transition-colors"},[t("td",as,[t("div",is,[t("div",ns,e(n.iniciales),1),t("div",ls,[t("div",rs,e(n.nombre),1),t("div",ds,e(n.email),1)])])]),t("td",cs,[t("div",ms,e(n.totalPacientes),1),t("div",xs,e(n.pacientesActivos)+" activos",1)]),t("td",gs,[t("div",ps,e(n.citasRealizadas),1),t("div",us,e(n.citasTotales)+" totales",1)]),t("td",bs,[t("div",fs,[t("div",ys,e(n.ocupacion)+"%",1),t("div",hs,[t("div",{class:X(["h-2 rounded-full transition-all",n.ocupacion>=80?"bg-emerald-500":n.ocupacion>=50?"bg-amber-500":"bg-red-500"]),style:I({width:`${n.ocupacion}%`})},null,6)])])]),t("td",_s,[t("div",vs,e(b(n.revenue)),1)]),t("td",ws,[t("div",Ps,e(b(n.cltvPromedio)),1)])]))),128)),u.value.length===0?(x(),m("tr",Cs,[...s[24]||(s[24]=[t("td",{colspan:"6",class:"px-6 py-12 text-center text-gray-500"}," No hay terapeutas registradas ",-1)])])):F("",!0)])])])])]),t("div",js," √öltima actualizaci√≥n: "+e(k.value),1)],64))]))}});export{Ds as default};
