import{e as j,p as I,B as q,f as H,r as i,x as _,g as Y,c as d,b as c,J as G,w as J,h,l as n,a as t,j as K,T as O,_ as Q,P as W,o as l,k as w,m as y,K as X,v as D,F as Z,y as ee,t as a,A as te}from"#entry";const oe={class:"mb-10 flex items-center justify-between"},se={class:"bg-white/90 backdrop-blur-md rounded-2xl shadow-lg border border-white/50 p-8 mb-8 relative overflow-hidden"},re={class:"relative grid grid-cols-1 md:grid-cols-4 gap-6"},ae={class:"bg-white rounded-xl shadow-md border border-[#E8DFD8] overflow-hidden"},ne={class:"overflow-x-auto"},le={class:"w-full"},ie={class:"divide-y divide-[#E8DFD8]"},de={class:"px-6 py-4 whitespace-nowrap text-sm text-[#5D4A44]"},ce={class:"px-6 py-4 whitespace-nowrap"},ue={class:"flex items-center space-x-3"},pe={class:"w-8 h-8 rounded-full bg-gradient-to-br from-[#D8AFA0] to-[#C49484] flex items-center justify-center flex-shrink-0"},me={class:"text-white text-xs font-semibold"},xe={class:"text-sm font-medium text-[#5D4A44]"},fe={class:"px-6 py-4 whitespace-nowrap text-sm text-[#8B7470]"},be={class:"px-6 py-4 whitespace-nowrap text-sm font-semibold text-[#5D4A44]"},ge={class:"px-6 py-4 whitespace-nowrap"},ve={class:"px-6 py-4 whitespace-nowrap text-sm text-[#8B7470]"},he={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2"},we=["onClick"],ye=["onClick"],_e=["onClick"],De={key:0,class:"text-center py-12"},Fe={class:"mt-6 grid grid-cols-1 md:grid-cols-3 gap-6"},ke={class:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-6 border border-blue-200"},Ae={class:"text-3xl font-bold font-lora text-blue-900"},Ce={class:"bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-6 border border-green-200"},Ee={class:"text-3xl font-bold font-lora text-green-900"},Se={class:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-6 border border-purple-200"},Be={class:"text-3xl font-bold font-lora text-purple-900"},Pe=j({__name:"pagos",setup(Le){const F=I(),S=q(),{getUserId:B}=H(),u=i([]),p=i(""),m=i(""),x=i(""),f=i(""),v=i(!1),k=i(!0),A=_(()=>{let o=[...u.value];if(p.value&&(o=o.filter(e=>e.estado===p.value)),m.value){const e=m.value.toLowerCase();o=o.filter(r=>r.paciente_nombre.toLowerCase().includes(e))}return x.value&&(o=o.filter(e=>new Date(e.created_at)>=new Date(x.value))),f.value&&(o=o.filter(e=>new Date(e.created_at)<=new Date(f.value))),o}),L=_(()=>{const o=new Date().toDateString();return u.value.filter(e=>new Date(e.created_at).toDateString()===o&&e.estado==="confirmado_admin").reduce((e,r)=>e+parseFloat(r.monto),0)}),M=_(()=>{const o=new Date,e=o.getMonth(),r=o.getFullYear();return u.value.filter(g=>{const s=new Date(g.created_at);return s.getMonth()===e&&s.getFullYear()===r}).reduce((g,s)=>g+parseFloat(s.monto),0)}),P=o=>new Date(o).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"}),N=o=>o.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2),b=o=>o.toLocaleString("es-ES",{style:"currency",currency:"EUR",minimumFractionDigits:2,maximumFractionDigits:2}),T=o=>({pendiente:"bg-yellow-100 text-yellow-700",confirmado_paciente:"bg-blue-100 text-blue-700",confirmado_admin:"bg-green-100 text-green-700",rechazado:"bg-red-100 text-red-700"})[o]||"bg-gray-100 text-gray-700",V=o=>({pendiente:"Pendiente",confirmado_paciente:"Confirmado",confirmado_admin:"Verificado",rechazado:"Rechazado"})[o]||o,$=o=>u.value.filter(e=>e.estado===o).reduce((e,r)=>e+parseFloat(r.monto),0),U=async o=>{try{const e=B();if(!e){alert("âŒ No estÃ¡s autenticado");return}const{error:r}=await F.from("pagos").update({estado:"confirmado_paciente",confirmado_por:e,updated_at:new Date().toISOString()}).eq("id",o.id);if(r)throw r;alert("âœ… Pago confirmado exitosamente"),C()}catch(e){console.error("Error:",e),alert("âŒ Error al confirmar pago")}},z=async o=>{alert("Esta funcionalidad requiere configurar notificaciones a administraciÃ³n")},R=o=>{alert(`Detalles del pago:

Paciente: ${o.paciente_nombre}
Monto: ${b(parseFloat(o.monto))}
Estado: ${o.estado}

(Modal de detalles en desarrollo)`)},C=async()=>{if(S.value){k.value=!0;try{const{data:o,error:e}=await F.from("pagos").select(`
        *,
        paciente:paciente_id(nombre),
        terapeuta:terapeuta_id(nombre)
      `).order("created_at",{ascending:!1});if(e)throw e;o&&(u.value=o.map(r=>({...r,paciente_nombre:r.paciente?.nombre||"Sin paciente",terapeuta_nombre:r.terapeuta?.nombre||"Sin terapeuta"})))}catch(o){console.error("Error al cargar pagos:",o)}finally{k.value=!1}}};return Y(()=>{C()}),(o,e)=>{const r=W("Icon"),g=Q;return l(),d("div",null,[c(g,{name:"coordinacion"},{default:J(()=>[t("div",oe,[e[9]||(e[9]=t("div",null,[t("div",{class:"flex items-center gap-4 mb-3"},[t("div",{class:"w-14 h-14 rounded-2xl bg-gradient-to-br from-[#5550F2] to-[#027368] shadow-lg flex items-center justify-center"},[t("span",{class:"text-2xl"},"ðŸ’°")]),t("h1",{class:"text-4xl font-['Elms_Sans'] font-bold bg-gradient-to-r from-[#5550F2] to-[#027368] bg-clip-text text-transparent"}," GestiÃ³n de Pagos ")]),t("p",{class:"font-['Lato'] text-gray-600 ml-18"}," Registro y confirmaciÃ³n de pagos de sesiones con TeraplÃ­ ")],-1)),t("button",{onClick:e[0]||(e[0]=s=>v.value=!0),class:"group px-8 py-4 bg-gradient-to-r from-[#04BF9D] to-[#027368] text-white rounded-2xl hover:shadow-xl transition-all duration-300 flex items-center space-x-3 hover:scale-105 backdrop-blur-sm border border-white/20"},[c(r,{name:"heroicons:plus",class:"w-6 h-6 group-hover:scale-110 transition-transform duration-300"}),e[8]||(e[8]=t("span",{class:"font-['Lato'] font-semibold"},"Registrar pago",-1))])]),t("div",se,[e[15]||(e[15]=t("div",{class:"absolute inset-0 bg-gradient-to-br from-[#5550F2]/5 via-transparent to-[#04BF9D]/5"},null,-1)),t("div",re,[t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-['Lato'] font-semibold text-gray-700 mb-3"},"Estado",-1)),w(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>y(p)?p.value=s:null),class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#5550F2]/20 focus:border-[#5550F2] bg-white/80 backdrop-blur-sm transition-all duration-300 font-['Lato'] hover:bg-white shadow-sm hover:shadow-md"},[...e[10]||(e[10]=[t("option",{value:""},"Todos",-1),t("option",{value:"pendiente"},"Pendiente",-1),t("option",{value:"confirmado_paciente"},"Confirmado por paciente",-1),t("option",{value:"confirmado_admin"},"Confirmado",-1),t("option",{value:"rechazado"},"Rechazado",-1)])],512),[[X,n(p)]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-['Lato'] font-semibold text-gray-700 mb-3"},"BÃºsqueda",-1)),w(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>y(m)?m.value=s:null),type:"text",placeholder:"Nombre del paciente...",class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#5550F2]/20 focus:border-[#5550F2] bg-white/80 backdrop-blur-sm transition-all duration-300 font-['Lato'] hover:bg-white shadow-sm hover:shadow-md placeholder:text-gray-400"},null,512),[[D,n(m)]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-[#5D4A44] mb-2"},"Fecha desde",-1)),w(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>y(x)?x.value=s:null),type:"date",class:"w-full px-4 py-2 border border-[#E8DFD8] rounded-lg focus:ring-2 focus:ring-[#D8AFA0] focus:border-transparent"},null,512),[[D,n(x)]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-[#5D4A44] mb-2"},"Fecha hasta",-1)),w(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>y(f)?f.value=s:null),type:"date",class:"w-full px-4 py-2 border border-[#E8DFD8] rounded-lg focus:ring-2 focus:ring-[#D8AFA0] focus:border-transparent"},null,512),[[D,n(f)]])])])]),t("div",ae,[t("div",ne,[t("table",le,[e[16]||(e[16]=t("thead",{class:"bg-[#F9F7F3] border-b border-[#E8DFD8]"},[t("tr",null,[t("th",{class:"px-6 py-4 text-left text-xs font-medium text-[#5D4A44] uppercase tracking-wider"}," Fecha "),t("th",{class:"px-6 py-4 text-left text-xs font-medium text-[#5D4A44] uppercase tracking-wider"}," Paciente "),t("th",{class:"px-6 py-4 text-left text-xs font-medium text-[#5D4A44] uppercase tracking-wider"}," Terapeuta "),t("th",{class:"px-6 py-4 text-left text-xs font-medium text-[#5D4A44] uppercase tracking-wider"}," Monto "),t("th",{class:"px-6 py-4 text-left text-xs font-medium text-[#5D4A44] uppercase tracking-wider"}," Estado "),t("th",{class:"px-6 py-4 text-left text-xs font-medium text-[#5D4A44] uppercase tracking-wider"}," MÃ©todo "),t("th",{class:"px-6 py-4 text-right text-xs font-medium text-[#5D4A44] uppercase tracking-wider"}," Acciones ")])],-1)),t("tbody",ie,[(l(!0),d(Z,null,ee(n(A),s=>(l(),d("tr",{key:s.id,class:"hover:bg-[#F9F7F3] transition-colors"},[t("td",de,a(P(s.created_at)),1),t("td",ce,[t("div",ue,[t("div",pe,[t("span",me,a(N(s.paciente_nombre)),1)]),t("div",null,[t("p",xe,a(s.paciente_nombre),1)])])]),t("td",fe,a(s.terapeuta_nombre),1),t("td",be,a(b(parseFloat(s.monto))),1),t("td",ge,[t("span",{class:te(["px-3 py-1 rounded-full text-xs font-medium",T(s.estado)])},a(V(s.estado)),3)]),t("td",ve,a(s.metodo_pago||"No especificado"),1),t("td",he,[s.estado==="pendiente"?(l(),d("button",{key:0,onClick:E=>U(s),class:"px-3 py-1 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 transition-colors",title:"Confirmar pago de paciente"},[c(r,{name:"heroicons:check-circle",class:"w-4 h-4 inline"})],8,we)):h("",!0),s.estado==="confirmado_paciente"?(l(),d("button",{key:1,onClick:E=>z(s),class:"px-3 py-1 bg-green-50 text-green-600 rounded-lg hover:bg-green-100 transition-colors",title:"Enviar a administraciÃ³n"},[c(r,{name:"heroicons:arrow-right-circle",class:"w-4 h-4 inline"})],8,ye)):h("",!0),t("button",{onClick:E=>R(s),class:"px-3 py-1 bg-[#F9F7F3] text-[#5D4A44] rounded-lg hover:bg-[#E8DFD8] transition-colors",title:"Ver detalles"},[c(r,{name:"heroicons:eye",class:"w-4 h-4 inline"})],8,_e)])]))),128))])])]),n(A).length===0?(l(),d("div",De,[c(r,{name:"heroicons:credit-card",class:"w-16 h-16 text-[#D8AFA0] mx-auto mb-4 opacity-30"}),e[17]||(e[17]=t("p",{class:"text-[#8B7470] mb-4"},"No se encontraron pagos",-1))])):h("",!0)]),t("div",Fe,[t("div",ke,[e[18]||(e[18]=t("p",{class:"text-sm text-blue-700 mb-1"},"Total pendiente",-1)),t("p",Ae,a(b($("pendiente"))),1)]),t("div",Ce,[e[19]||(e[19]=t("p",{class:"text-sm text-green-700 mb-1"},"Confirmados hoy",-1)),t("p",Ee,a(b(n(L))),1)]),t("div",Se,[e[20]||(e[20]=t("p",{class:"text-sm text-purple-700 mb-1"},"Total del mes",-1)),t("p",Be,a(b(n(M))),1)])])]),_:1}),(l(),G(O,{to:"body"},[n(v)?(l(),d("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:e[7]||(e[7]=s=>v.value=!1)},[t("div",{class:"bg-white rounded-xl max-w-md w-full p-6",onClick:e[6]||(e[6]=K(()=>{},["stop"]))},[e[21]||(e[21]=t("h3",{class:"text-xl font-lora font-semibold text-[#5D4A44] mb-4"}," Registrar nuevo pago ",-1)),e[22]||(e[22]=t("p",{class:"text-sm text-[#8B7470]"},"Funcionalidad en desarrollo...",-1)),t("button",{onClick:e[5]||(e[5]=s=>v.value=!1),class:"mt-4 w-full px-4 py-2 bg-[#D8AFA0] text-white rounded-lg hover:bg-[#C49484] transition-colors"}," Cerrar ")])])):h("",!0)]))])}}});export{Pe as default};
