import{e as B,r,f as T,c as a,a as o,k as l,g as p,h as k,F as I,s as N,i as A,j as z,v as R,A as V,l as H,D as _,o as n,y,t as g}from"#entry";import{u as K}from"./DnfzQJpG.js";import{u as U}from"./BbZO5sJf.js";import{_ as P}from"./DlAUqK2U.js";const q={class:"flex flex-col h-[calc(100vh-8rem)] max-w-4xl mx-auto px-4 py-8"},G={key:0,class:"flex-1 flex flex-col items-center justify-center"},J={key:1,class:"flex-1 flex flex-col bg-white rounded-xl shadow-sm border border-[#EAD5D3]/30 overflow-hidden"},O={key:0,class:"flex flex-col items-center justify-center h-full text-center py-12"},Q={key:0,class:"text-xs font-['Lato'] font-medium mb-1 opacity-70"},W={class:"text-sm font-['Lato'] whitespace-pre-wrap break-words"},X={key:0},Y={key:0,class:"w-4 h-4 inline",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Z={key:1,class:"w-4 h-4 inline",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},$={key:1,class:"flex justify-start"},ee={class:"flex-shrink-0 border-t border-[#EAD5D3]/30 p-4 bg-[#F9F7F3]/30"},te=["onKeydown"],oe=["disabled"],se={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ae={key:1,class:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"},ne=B({__name:"mensajes",setup(re){const{getMensajes:j,enviarMensaje:M,marcarComoLeido:F}=K(),h=r(!0),c=r([]),i=r(""),f=r(!1),x=r(!1),v=r(null),d=r(null),b=r(""),L=async()=>{h.value=!0;try{{const t=U(),{data:{user:u}}=await t.auth.getUser();u&&(b.value=u.id)}const s=await j();c.value=s||[];const e=c.value.filter(t=>!t.leido&&t.autor_id!==b.value).map(t=>t.id);e.length>0&&await F(e),_(()=>D())}catch(s){console.error("Error al cargar mensajes:",s)}finally{h.value=!1}},w=async()=>{if(!i.value.trim()||f.value)return;const s=i.value.trim();i.value="",f.value=!0,d.value&&(d.value.style.height="auto");try{const t=await M(s,"coord-uuid-1234");c.value.push(t),_(()=>D()),setTimeout(()=>{x.value=!0,setTimeout(()=>{x.value=!1},2e3)},1e3)}catch(e){console.error("Error al enviar mensaje:",e),alert("No se pudo enviar el mensaje. Intenta nuevamente.")}finally{f.value=!1}},m=s=>s.autor_id===b.value,C=s=>{if(!s)return"";const e=new Date(s),t=new Date,u=new Date(t);return u.setDate(u.getDate()-1),e.toDateString()===t.toDateString()?e.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}):e.toDateString()===u.toDateString()?"Ayer "+e.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}):e.toLocaleDateString("es-ES",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})},D=(s=!0)=>{v.value&&v.value.scrollTo({top:v.value.scrollHeight,behavior:s?"smooth":"auto"})},S=()=>{d.value&&(d.value.style.height="auto",d.value.style.height=d.value.scrollHeight+"px")},E=()=>{};return T(()=>{L()}),(s,e)=>(n(),a("div",q,[e[7]||(e[7]=o("header",{class:"mb-6 flex-shrink-0"},[o("h1",{class:"text-2xl sm:text-3xl font-['Lora'] font-medium text-[#5D4A44]"}," Mensajes "),o("p",{class:"text-sm text-[#5D4A44] opacity-70 font-['Lato'] mt-1"}," Conversación con tu coordinadora ")],-1)),l(h)?(n(),a("div",G,[...e[1]||(e[1]=[o("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#D8AFA0]"},null,-1),o("p",{class:"mt-4 text-[#5D4A44] opacity-70 font-['Lato']"},"Cargando mensajes...",-1)])])):(n(),a("div",J,[o("div",{ref_key:"mensajesContainer",ref:v,class:"flex-1 overflow-y-auto p-6 space-y-4",onScroll:E},[l(c).length===0?(n(),a("div",O,[...e[2]||(e[2]=[k('<div class="w-20 h-20 rounded-full bg-[#EAD5D3]/30 flex items-center justify-center mb-4" data-v-4f363c8b><svg class="w-10 h-10 text-[#D8AFA0]" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-4f363c8b><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" data-v-4f363c8b></path></svg></div><h3 class="text-xl font-[&#39;Lora&#39;] font-medium text-[#5D4A44] mb-2" data-v-4f363c8b>No hay mensajes</h3><p class="text-sm text-[#5D4A44] opacity-70 font-[&#39;Lato&#39;] max-w-md" data-v-4f363c8b> Inicia la conversación enviando un mensaje a tu coordinadora. </p>',3)])])):p("",!0),(n(!0),a(I,null,N(l(c),t=>(n(),a("div",{key:t.id,class:y(["flex",m(t)?"justify-end":"justify-start"])},[o("div",{class:y(["max-w-[70%] rounded-2xl px-4 py-3 shadow-sm",m(t)?"bg-[#D8AFA0] text-white rounded-br-sm":"bg-[#F9F7F3] text-[#5D4A44] rounded-bl-sm"])},[m(t)?p("",!0):(n(),a("p",Q,g(t.autor?.nombre_completo||"Coordinadora"),1)),o("p",W,g(t.contenido),1),o("div",{class:y(["flex items-center gap-1 mt-1 text-xs","font-['Lato']",m(t)?"text-white/70":"text-[#5D4A44]/50"])},[o("span",null,g(C(t.created_at)),1),m(t)?(n(),a("span",X,[t.leido?(n(),a("svg",Y,[...e[3]||(e[3]=[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1),o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 13l4 4L23 7"},null,-1)])])):(n(),a("svg",Z,[...e[4]||(e[4]=[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])]))])):p("",!0)],2)],2)],2))),128)),l(x)?(n(),a("div",$,[...e[5]||(e[5]=[k('<div class="bg-[#F9F7F3] rounded-2xl rounded-bl-sm px-4 py-3 shadow-sm" data-v-4f363c8b><div class="flex gap-1" data-v-4f363c8b><span class="w-2 h-2 bg-[#D8AFA0] rounded-full animate-bounce" style="animation-delay:0ms;" data-v-4f363c8b></span><span class="w-2 h-2 bg-[#D8AFA0] rounded-full animate-bounce" style="animation-delay:150ms;" data-v-4f363c8b></span><span class="w-2 h-2 bg-[#D8AFA0] rounded-full animate-bounce" style="animation-delay:300ms;" data-v-4f363c8b></span></div></div>',1)])])):p("",!0)],544),o("div",ee,[o("form",{onSubmit:A(w,["prevent"]),class:"flex gap-2"},[z(o("textarea",{"onUpdate:modelValue":e[0]||(e[0]=t=>H(i)?i.value=t:null),placeholder:"Escribe tu mensaje...",rows:"1",class:"flex-1 px-4 py-3 border border-[#EAD5D3] rounded-xl focus:outline-none focus:ring-2 focus:ring-[#D8AFA0] focus:border-transparent resize-none font-['Lato'] text-[#5D4A44] placeholder:text-[#5D4A44]/40 bg-white",onKeydown:V(A(w,["exact","prevent"]),["enter"]),onInput:S,ref_key:"textareaRef",ref:d},null,40,te),[[R,l(i)]]),o("button",{type:"submit",disabled:!l(i).trim()||l(f),class:"flex-shrink-0 w-12 h-12 bg-[#D8AFA0] hover:bg-[#C89B8A] disabled:bg-[#EAD5D3] disabled:cursor-not-allowed text-white rounded-xl transition-colors flex items-center justify-center"},[l(f)?(n(),a("div",ae)):(n(),a("svg",se,[...e[6]||(e[6]=[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"},null,-1)])]))],8,oe)],32)])]))]))}}),ce=P(ne,[["__scopeId","data-v-4f363c8b"]]);export{ce as default};
