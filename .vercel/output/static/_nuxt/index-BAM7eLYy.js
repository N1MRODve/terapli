import{_ as Ce}from"./PaymentMethodSelector-DGmnaSg8.js";import{p as ve,f as oe,r as b,x as T,e as ne,I as Q,c as d,o as c,a as e,b as L,A as X,k as q,ah as ie,M as ge,w as me,h as F,d as O,v as Y,t as g,l as D,g as be,J as ue,T as De,F as W,y as ee,X as Ae,j as ce,K as de}from"#entry";import{u as ye}from"./usePacientes-CwDVOsC8.js";import{u as Se}from"./useToast-Cq0GyJHs.js";import{r as pe}from"./XMarkIcon-DWNj0d99.js";import{r as Ve}from"./UserIcon-G1mM6o1b.js";import{r as Ne}from"./TicketIcon-DRclOuRO.js";import{r as Me}from"./CurrencyEuroIcon-ctfYYmfn.js";import{r as fe}from"./DocumentTextIcon-Dp_75vtG.js";import{_ as Re}from"./_plugin-vue_export-helper-DlAUqK2U.js";function le(){const $=ve(),{userProfile:E}=oe(),f=b([]),C=b(null),v=b(!1),x=b(null);function N(t,r,u="exento"){let y=0,h=0,w=0,m=0;r==="empresa"?(y=21,h=M(t*.21),w=15,m=M(t*.15)):u==="general"&&(y=21,h=M(t*.21));const a=M(t+h-m);return{baseImponible:M(t),porcentajeIVA:y,importeIVA:h,porcentajeIRPF:w,importeIRPF:m,total:a}}function M(t){return Math.round(t*100)/100}function z(t){if(!t)return!1;const r=t.toUpperCase().replace(/[^A-Z0-9]/g,"");if(r.length!==9)return!1;if(/^[0-9]{8}[A-Z]$/.test(r)){const w="TRWAGMYFPDXBNJZSQVHLCKE",m=parseInt(r.substring(0,8)),a=w[m%23];return r[8]===a}if(/^[XYZ][0-9]{7}[A-Z]$/.test(r)){let w=r.substring(1,8);r[0]==="X"?w="0"+w:r[0]==="Y"?w="1"+w:r[0]==="Z"&&(w="2"+w);const m="TRWAGMYFPDXBNJZSQVHLCKE",a=parseInt(w),Z=m[a%23];return r[8]===Z}return!!/^[ABCDEFGHJKLMNPQRSUVW][0-9]{7}[A-J0-9]$/.test(r)}function j(t){return t?t.toUpperCase().replace(/[^A-Z0-9]/g,""):""}async function S(){const t=E.value?.terapeuta_id||E.value?.id;if(!t)return"exento";try{const{data:r,error:u}=await $.from("terapeutas").select("datos_fiscales").eq("id",t).single();return u||!r?"exento":r.datos_fiscales?.regimen_iva||"exento"}catch{return"exento"}}async function G(t){const r=E.value?.terapeuta_id||E.value?.id;if(!r)return{success:!1,error:"No se encontró el terapeuta"};v.value=!0,x.value=null;try{if(t.tipoCliente==="empresa"&&t.receptorNif&&!z(t.receptorNif))return{success:!1,error:"El NIF/CIF no es válido"};const u=await S(),{data:y,error:h}=await $.rpc("fn_crear_factura",{p_terapeuta_id:r,p_paciente_id:t.pacienteId||null,p_tipo_cliente:t.tipoCliente,p_receptor_nombre:t.receptorNombre,p_receptor_nif:t.receptorNif?j(t.receptorNif):null,p_receptor_direccion:t.receptorDireccion||null,p_concepto:t.concepto,p_base_imponible:t.baseImponible,p_aplicar_iva:t.tipoCliente==="empresa"||u==="general",p_aplicar_irpf:t.tipoCliente==="empresa",p_lineas_detalle:t.lineasDetalle||[],p_bono_id:t.bonoId||null,p_pago_id:t.pagoId||null});if(h)throw new Error(h.message);const{data:w,error:m}=await $.from("facturas").select("*").eq("id",y).single();if(m)throw new Error(m.message);return{success:!0,data:w}}catch(u){return x.value=u.message,console.error("[useFacturas] Error creando factura:",u),{success:!1,error:u.message}}finally{v.value=!1}}async function J(t={}){const r=E.value?.terapeuta_id||E.value?.id;if(!r)return{success:!1,error:"No se encontró el terapeuta"};v.value=!0,x.value=null;try{let u=$.from("facturas").select(`
          *,
          paciente:pacientes(id, nombre_completo, email)
        `).eq("terapeuta_id",r).order("fecha_emision",{ascending:!1});t.fechaDesde&&(u=u.gte("fecha_emision",t.fechaDesde)),t.fechaHasta&&(u=u.lte("fecha_emision",t.fechaHasta)),t.pacienteId&&(u=u.eq("paciente_id",t.pacienteId)),t.estado&&(u=u.eq("estado",t.estado)),t.busqueda&&(u=u.or(`numero_factura.ilike.%${t.busqueda}%,receptor_nombre.ilike.%${t.busqueda}%,concepto.ilike.%${t.busqueda}%`));const{data:y,error:h}=await u;if(h)throw new Error(h.message);return f.value=y||[],{success:!0,data:f.value,total:f.value.length}}catch(u){return x.value=u.message,console.error("[useFacturas] Error obteniendo facturas:",u),{success:!1,error:u.message}}finally{v.value=!1}}async function V(t){v.value=!0,x.value=null;try{const{data:r,error:u}=await $.from("facturas").select(`
          *,
          paciente:pacientes(id, nombre_completo, email, telefono)
        `).eq("id",t).single();if(u)throw new Error(u.message);return C.value=r,{success:!0,data:C.value}}catch(r){return x.value=r.message,console.error("[useFacturas] Error obteniendo factura:",r),{success:!1,error:r.message}}finally{v.value=!1}}async function B(t,r){if(!r||r.trim().length<3)return{success:!1,error:"Debe indicar un motivo de anulación"};v.value=!0,x.value=null;try{const{data:u,error:y}=await $.rpc("fn_anular_factura",{p_factura_id:t,p_motivo:r.trim()});if(y)throw new Error(y.message);if(!u)return{success:!1,error:"No se pudo anular la factura. Puede que ya esté anulada."};const h=f.value.findIndex(w=>w.id===t);return h!==-1&&(f.value[h].estado="anulada",f.value[h].motivo_anulacion=r),{success:!0}}catch(u){return x.value=u.message,console.error("[useFacturas] Error anulando factura:",u),{success:!1,error:u.message}}finally{v.value=!1}}async function l(){const t=E.value?.terapeuta_id||E.value?.id;if(!t)return null;try{const{data:r,error:u}=await $.from("terapeutas").select("numeracion_facturas").eq("id",t).single();if(u||!r)return null;const y=r.numeracion_facturas;if(!y)return null;const h=new Date().getFullYear(),m=(h>y.anio_actual?1:y.ultimo_numero+1).toString().padStart(4,"0");return`${y.prefijo}-${h}-${m}`}catch{return null}}async function k(){const t=E.value?.terapeuta_id||E.value?.id;if(!t)return null;try{const{data:r,error:u}=await $.from("terapeutas").select("datos_fiscales").eq("id",t).single();return u||!r?null:r.datos_fiscales}catch{return null}}async function I(t){const r=E.value?.terapeuta_id||E.value?.id;if(!r)return{success:!1,error:"No se encontró el terapeuta"};if(t.nif&&!z(t.nif))return{success:!1,error:"El NIF no es válido"};v.value=!0;try{const{error:u}=await $.from("terapeutas").update({datos_fiscales:{...t,nif:t.nif?j(t.nif):""},updated_at:new Date().toISOString()}).eq("id",r);if(u)throw new Error(u.message);return{success:!0}}catch(u){return console.error("[useFacturas] Error guardando datos fiscales:",u),{success:!1,error:u.message}}finally{v.value=!1}}function A(t){return new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR"}).format(t)}function R(t){return new Date(t).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"})}function U(t){return{borrador:"bg-gray-100 text-gray-700",emitida:"bg-green-100 text-green-700",anulada:"bg-red-100 text-red-700"}[t]||"bg-gray-100 text-gray-600"}function H(t){return{borrador:"Borrador",emitida:"Emitida",anulada:"Anulada"}[t]||t}const s=T(()=>f.value.filter(t=>t.estado==="emitida").reduce((t,r)=>t+r.total,0)),n=T(()=>f.value.filter(t=>t.estado==="emitida")),o=T(()=>f.value.filter(t=>t.estado==="anulada"));return{facturas:f,facturaActual:C,loading:v,error:x,totalFacturado:s,facturasEmitidas:n,facturasAnuladas:o,calcularImpuestos:N,redondear:M,validarNIF:z,formatearNIF:j,crearFactura:G,getFacturas:J,getFactura:V,anularFactura:B,getProximoNumero:l,getDatosFiscales:k,guardarDatosFiscales:I,obtenerRegimenIVA:S,formatearImporte:A,formatearFecha:R,getEstadoColor:U,getEstadoTexto:H}}const je={class:"space-y-5"},Be={class:"grid grid-cols-2 gap-3"},Ue={key:0,class:"space-y-4 overflow-hidden"},qe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},He={key:0,class:"mt-1 text-xs text-red-600"},Te={class:"bg-gray-50 rounded-lg p-4 border border-gray-200"},ze={class:"space-y-2 text-sm"},Le={class:"flex justify-between"},Oe={class:"font-medium text-gray-900"},Ze={class:"flex justify-between"},Ge={class:"text-gray-600"},Je={key:0,class:"flex justify-between"},Xe={class:"text-gray-600"},Ye={class:"font-medium text-red-600"},Ke={class:"flex justify-between text-base"},Qe={class:"font-bold text-purple-600"},We={class:"mt-3 text-xs text-gray-500 flex items-center gap-1"},et=ne({__name:"FacturaForm",props:{baseImponible:{},regimenIVA:{default:"exento"},initialTipoCliente:{default:"particular"},initialDatosEmpresa:{default:()=>({nombre:"",nif:"",direccion:""})}},emits:["update"],setup($,{emit:E}){const f=$,C=E,v=b(f.initialTipoCliente),x=b({nombre:f.initialDatosEmpresa.nombre,nif:f.initialDatosEmpresa.nif,direccion:f.initialDatosEmpresa.direccion}),N=b(null),{calcularImpuestos:M,validarNIF:z,formatearImporte:j}=le(),S=T(()=>M(f.baseImponible,v.value,f.regimenIVA));function G(){v.value==="empresa"&&x.value.nif?z(x.value.nif)?N.value=null:N.value="NIF/CIF no válido":N.value=null}function J(){C("update",{tipoCliente:v.value,datosEmpresa:v.value==="empresa"?x.value:null,calculo:S.value})}Q([v,x,()=>f.baseImponible],()=>{J()},{deep:!0,immediate:!0});const V=T(()=>v.value==="empresa"?"IVA 21% + Retención IRPF 15%":f.regimenIVA==="exento"?"Exento de IVA (Art. 20.1.3º LIVA - Servicios sanitarios)":"IVA 21%");return(B,l)=>(c(),d("div",je,[e("div",null,[l[7]||(l[7]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Tipo de cliente ",-1)),e("div",Be,[e("label",{class:X(["flex items-center gap-3 p-4 border rounded-lg cursor-pointer transition-all",v.value==="particular"?"border-purple-500 bg-purple-50":"border-gray-200 hover:border-gray-300"])},[q(e("input",{type:"radio","onUpdate:modelValue":l[0]||(l[0]=k=>v.value=k),value:"particular",class:"w-4 h-4 text-purple-600 focus:ring-purple-500"},null,512),[[ie,v.value]]),l[5]||(l[5]=e("div",null,[e("span",{class:"text-sm font-medium text-gray-900"},"Particular"),e("p",{class:"text-xs text-gray-500"},"Persona física")],-1))],2),e("label",{class:X(["flex items-center gap-3 p-4 border rounded-lg cursor-pointer transition-all",v.value==="empresa"?"border-purple-500 bg-purple-50":"border-gray-200 hover:border-gray-300"])},[q(e("input",{type:"radio","onUpdate:modelValue":l[1]||(l[1]=k=>v.value=k),value:"empresa",class:"w-4 h-4 text-purple-600 focus:ring-purple-500"},null,512),[[ie,v.value]]),l[6]||(l[6]=e("div",null,[e("span",{class:"text-sm font-medium text-gray-900"},"Empresa"),e("p",{class:"text-xs text-gray-500"},"Persona jurídica")],-1))],2)])]),L(ge,{"enter-active-class":"transition-all duration-200","enter-from-class":"opacity-0 max-h-0","enter-to-class":"opacity-100 max-h-96","leave-active-class":"transition-all duration-150","leave-from-class":"opacity-100 max-h-96","leave-to-class":"opacity-0 max-h-0"},{default:me(()=>[v.value==="empresa"?(c(),d("div",Ue,[e("div",qe,[e("div",null,[l[8]||(l[8]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[O(" Razón social "),e("span",{class:"text-red-500"},"*")],-1)),q(e("input",{"onUpdate:modelValue":l[2]||(l[2]=k=>x.value.nombre=k),type:"text",placeholder:"Nombre de la empresa",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",required:""},null,512),[[Y,x.value.nombre]])]),e("div",null,[l[9]||(l[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[O(" CIF "),e("span",{class:"text-red-500"},"*")],-1)),q(e("input",{"onUpdate:modelValue":l[3]||(l[3]=k=>x.value.nif=k),type:"text",placeholder:"B12345678",class:X(["w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 uppercase",N.value?"border-red-300 bg-red-50":"border-gray-300"]),onBlur:G,required:""},null,34),[[Y,x.value.nif]]),N.value?(c(),d("p",He,g(N.value),1)):F("",!0)])]),e("div",null,[l[10]||(l[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[O(" Dirección fiscal "),e("span",{class:"text-red-500"},"*")],-1)),q(e("input",{"onUpdate:modelValue":l[4]||(l[4]=k=>x.value.direccion=k),type:"text",placeholder:"Calle, número, CP, Ciudad",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",required:""},null,512),[[Y,x.value.direccion]])])])):F("",!0)]),_:1}),e("div",Te,[l[15]||(l[15]=e("h4",{class:"text-sm font-medium text-gray-700 mb-3"},"Desglose de factura",-1)),e("div",ze,[e("div",Le,[l[11]||(l[11]=e("span",{class:"text-gray-600"},"Base imponible:",-1)),e("span",Oe,g(D(j)(S.value.baseImponible)),1)]),e("div",Ze,[e("span",Ge," IVA ("+g(S.value.porcentajeIVA)+"%): ",1),e("span",{class:X(["font-medium",S.value.importeIVA>0?"text-gray-900":"text-gray-400"])},g(S.value.importeIVA>0?"+":"")+g(D(j)(S.value.importeIVA)),3)]),v.value==="empresa"?(c(),d("div",Je,[e("span",Xe," Retención IRPF ("+g(S.value.porcentajeIRPF)+"%): ",1),e("span",Ye," -"+g(D(j)(S.value.importeIRPF)),1)])):F("",!0),l[13]||(l[13]=e("div",{class:"border-t border-gray-300 my-2"},null,-1)),e("div",Ke,[l[12]||(l[12]=e("span",{class:"font-semibold text-gray-900"},"TOTAL:",-1)),e("span",Qe,g(D(j)(S.value.total)),1)])]),e("p",We,[l[14]||(l[14]=e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),O(" "+g(V.value),1)])])]))}}),tt=Object.assign(et,{__name:"FacturaForm"});function _e(){const $=ve(),{userProfile:E}=oe(),f=b([]),C=b(!1),v=b(null);async function x(s){const n=E.value?.terapeuta_id||E.value?.id;if(!n)return{success:!1,error:"No se encontró el terapeuta"};if(!s.pacienteId)return{success:!1,error:"Debe seleccionar un paciente"};if(!s.monto||s.monto<=0)return{success:!1,error:"El monto debe ser mayor a 0"};C.value=!0,v.value=null;try{const{data:o,error:t}=await $.from("pagos_registros").insert({terapeuta_id:n,paciente_id:s.pacienteId,fecha_pago:s.fechaPago||new Date().toISOString().split("T")[0],monto:s.monto,metodo_pago:s.metodoPago,concepto:s.concepto||null,bono_id:s.bonoId||null,factura_id:s.facturaId||null,cita_id:s.citaId||null}).select(`
          *,
          paciente:pacientes(id, nombre_completo, email)
        `).single();if(t)throw new Error(t.message);return s.bonoId&&await N(s.bonoId,s.metodoPago),f.value.unshift(o),{success:!0,data:o}}catch(o){return v.value=o.message,console.error("[usePagosRegistros] Error creando pago:",o),{success:!1,error:o.message}}finally{C.value=!1}}async function N(s,n){try{await $.from("bonos").update({estado_pago:"pagado",metodo_pago:n,fecha_pago:new Date().toISOString(),pagado:!0,updated_at:new Date().toISOString()}).eq("id",s)}catch(o){console.error("[usePagosRegistros] Error actualizando bono:",o)}}async function M(s={}){const n=E.value?.terapeuta_id||E.value?.id;if(!n)return{success:!1,error:"No se encontró el terapeuta"};C.value=!0,v.value=null;try{let o=$.from("pagos_registros").select(`
          *,
          paciente:pacientes(id, nombre_completo, email),
          bono:bonos(id, tipo, sesiones_totales, monto_total),
          factura:facturas(id, numero_factura)
        `).eq("terapeuta_id",n).order("fecha_pago",{ascending:!1}).order("created_at",{ascending:!1});s.fechaDesde&&(o=o.gte("fecha_pago",s.fechaDesde)),s.fechaHasta&&(o=o.lte("fecha_pago",s.fechaHasta)),s.pacienteId&&(o=o.eq("paciente_id",s.pacienteId)),s.metodoPago&&(o=o.eq("metodo_pago",s.metodoPago)),s.conFactura!==void 0&&(s.conFactura?o=o.not("factura_id","is",null):o=o.is("factura_id",null)),s.busqueda&&(o=o.or(`concepto.ilike.%${s.busqueda}%`));const{data:t,error:r}=await o;if(r)throw new Error(r.message);return f.value=t||[],{success:!0,data:f.value,total:f.value.length}}catch(o){return v.value=o.message,console.error("[usePagosRegistros] Error obteniendo pagos:",o),{success:!1,error:o.message}}finally{C.value=!1}}async function z(s){C.value=!0,v.value=null;try{const{data:n,error:o}=await $.from("pagos_registros").select(`
          *,
          paciente:pacientes(id, nombre_completo, email, telefono),
          bono:bonos(id, tipo, sesiones_totales, sesiones_restantes, monto_total, estado),
          factura:facturas(id, numero_factura, total, estado)
        `).eq("id",s).single();if(o)throw new Error(o.message);return{success:!0,data:n}}catch(n){return v.value=n.message,console.error("[usePagosRegistros] Error obteniendo pago:",n),{success:!1,error:n.message}}finally{C.value=!1}}async function j(s,n){C.value=!0,v.value=null;try{const o={updated_at:new Date().toISOString()};n.fechaPago&&(o.fecha_pago=n.fechaPago),n.monto&&(o.monto=n.monto),n.metodoPago&&(o.metodo_pago=n.metodoPago),n.concepto!==void 0&&(o.concepto=n.concepto),n.facturaId!==void 0&&(o.factura_id=n.facturaId);const{data:t,error:r}=await $.from("pagos_registros").update(o).eq("id",s).select(`
          *,
          paciente:pacientes(id, nombre_completo, email)
        `).single();if(r)throw new Error(r.message);const u=f.value.findIndex(y=>y.id===s);return u!==-1&&(f.value[u]=t),{success:!0,data:t}}catch(o){return v.value=o.message,console.error("[usePagosRegistros] Error actualizando pago:",o),{success:!1,error:o.message}}finally{C.value=!1}}async function S(s){C.value=!0,v.value=null;try{const{error:n}=await $.from("pagos_registros").delete().eq("id",s);if(n)throw new Error(n.message);return f.value=f.value.filter(o=>o.id!==s),{success:!0}}catch(n){return v.value=n.message,console.error("[usePagosRegistros] Error eliminando pago:",n),{success:!1,error:n.message}}finally{C.value=!1}}async function G(s,n){return j(s,{facturaId:n})}async function J(s){try{const{data:n,error:o}=await $.from("bonos").select("id, tipo, monto_total, sesiones_totales, sesiones_restantes, fecha_inicio, fecha_fin, estado").eq("paciente_id",s).in("estado_pago",["pendiente",null]).in("estado",["activo","pendiente"]).order("created_at",{ascending:!1});return o?(console.error("[usePagosRegistros] Error obteniendo bonos:",o),[]):n||[]}catch(n){return console.error("[usePagosRegistros] Error obteniendo bonos:",n),[]}}function V(s){const n=s||f.value,o={efectivo:{total:0,cantidad:0},transferencia:{total:0,cantidad:0},bizum:{total:0,cantidad:0},tarjeta:{total:0,cantidad:0},stripe:{total:0,cantidad:0}};return n.forEach(t=>{t.metodo_pago&&o[t.metodo_pago]&&(o[t.metodo_pago].total+=t.monto,o[t.metodo_pago].cantidad+=1)}),{total:n.reduce((t,r)=>t+r.monto,0),cantidad:n.length,porMetodo:o}}async function B(s,n){const o=new Date(s,n-1,1).toISOString().split("T")[0],t=new Date(s,n,0).toISOString().split("T")[0];return M({fechaDesde:o,fechaHasta:t})}function l(s){return{efectivo:"Efectivo",transferencia:"Transferencia",bizum:"Bizum",tarjeta:"Tarjeta",stripe:"Stripe"}[s]||s}function k(s){return new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR"}).format(s)}function I(s){return new Date(s).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"})}const A=T(()=>f.value.reduce((s,n)=>s+n.monto,0)),R=T(()=>V()),U=T(()=>f.value.filter(s=>s.factura_id)),H=T(()=>f.value.filter(s=>!s.factura_id));return{pagos:f,loading:C,error:v,totalPagos:A,resumenActual:R,pagosConFactura:U,pagosSinFactura:H,crearPago:x,getPagos:M,getPago:z,actualizarPago:j,eliminarPago:S,vincularConFactura:G,getBonosPendientesPago:J,calcularResumen:V,getPagosMes:B,formatearMetodoPago:l,formatearImporte:k,formatearFecha:I}}const at={class:"px-5 py-4 bg-gray-50 border-b border-gray-200 flex items-center justify-between"},ot={class:"text-lg font-semibold text-gray-900"},st={class:"text-sm text-gray-500"},rt={class:"flex-1 overflow-y-auto p-5"},nt={key:0,class:"space-y-5"},lt={class:"block text-sm font-medium text-gray-700 mb-2"},it={class:"relative"},ut={key:1,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-48 overflow-y-auto"},ct={key:0,class:"p-3 text-center text-gray-500 text-sm"},dt={key:1,class:"p-3 text-center text-gray-500 text-sm"},pt=["onClick"],ft={class:"w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center text-purple-600 text-sm font-medium"},vt={class:"text-sm font-medium text-gray-900"},gt={class:"text-xs text-gray-500"},mt={key:0},bt={class:"block text-sm font-medium text-gray-700 mb-2"},yt={class:"grid gap-2"},_t=["onClick"],xt={class:"flex items-center justify-between"},ht={class:"font-medium text-gray-900"},wt={class:"text-purple-600 font-semibold"},kt={class:"text-xs text-gray-500 mt-1"},Pt={class:"grid grid-cols-2 gap-4"},It={class:"block text-sm font-medium text-gray-700 mb-2"},$t={class:"relative"},Et={key:1,class:"space-y-5"},Ft={class:"flex items-center justify-between p-4 bg-gray-50 rounded-lg cursor-pointer"},Ct={class:"flex items-center gap-3"},Dt={key:0,class:"text-sm text-gray-600 bg-purple-50 p-3 rounded-lg"},At={class:"text-purple-700"},St={key:2,class:"text-center py-8 text-gray-500"},Vt={key:2,class:"space-y-4"},Nt={class:"text-center pb-4 border-b border-gray-100"},Mt={class:"text-3xl font-bold text-gray-900"},Rt={class:"text-gray-600 mt-1"},jt={class:"bg-gray-50 rounded-lg p-4 space-y-3 text-sm"},Bt={class:"flex justify-between"},Ut={class:"font-medium"},qt={class:"flex justify-between"},Ht={class:"font-medium capitalize"},Tt={key:0,class:"flex justify-between"},zt={class:"font-medium truncate ml-4"},Lt={key:1,class:"flex justify-between"},Ot={class:"flex justify-between pt-2 border-t border-gray-200"},Zt={key:2,class:"pt-2 border-t border-gray-200"},Gt={class:"flex justify-between text-gray-600"},Jt={class:"font-bold text-purple-600"},Xt={class:"px-5 py-4 bg-gray-50 border-t border-gray-200 flex gap-3"},Yt=["disabled"],Kt=["disabled"],Qt=["disabled"],Wt={key:0,class:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24"},ea=ne({__name:"PagoUnificadoModal",props:{visible:{type:Boolean},pacienteIdPreseleccionado:{default:void 0},bonoIdPreseleccionado:{default:void 0},montoInicial:{default:void 0}},emits:["close","saved"],setup($,{emit:E}){const f=$,C=E,{searchPacientes:v,pacientes:x,loading:N}=ye(),{crearPago:M,getBonosPendientesPago:z}=_e(),{crearFactura:j,obtenerRegimenIVA:S,getProximoNumero:G}=le(),{success:J,error:V}=Se(),{waitForUser:B}=oe(),l=b("datos"),k=b(!1),I=b(!1),A=b(f.pacienteIdPreseleccionado||null),R=b(""),U=b(""),H=b(!1),s=b(new Date().toISOString().split("T")[0]),n=b(f.montoInicial||0),o=b(null),t=b(""),r=b(f.bonoIdPreseleccionado||null),u=b([]),y=b(!1),h=b("particular"),w=b({nombre:"",nif:"",direccion:""}),m=b(null),a=b("exento"),Z=b(null);be(async()=>{await B(),I.value=!0,a.value=await S(),Z.value=await G(),f.pacienteIdPreseleccionado&&await p(f.pacienteIdPreseleccionado)}),Q(U,async _=>{I.value||(await B(),I.value=!0),_.length>=2?(v(_),H.value=!0):_.length===0&&!A.value&&(v(""),H.value=!0)});async function p(_){if(u.value=await z(_),f.bonoIdPreseleccionado){const i=u.value.find(K=>K.id===f.bonoIdPreseleccionado);i&&(r.value=i.id,n.value=i.monto_total,t.value=`Pago de bono ${i.tipo} (${i.sesiones_totales} sesiones)`)}}function se(_){A.value=_.id,R.value=_.nombre_completo,U.value=_.nombre_completo,H.value=!1,p(_.id)}function xe(){A.value=null,R.value="",U.value="",u.value=[],r.value=null}function he(_){r.value===_.id?r.value=null:(r.value=_.id,n.value=_.monto_total,t.value=`Pago de bono ${_.tipo} (${_.sesiones_totales} sesiones)`)}function we(_){h.value=_.tipoCliente,w.value=_.datosEmpresa||{nombre:"",nif:"",direccion:""},m.value=_.calculo}const ke=T(()=>l.value==="datos"?A.value&&n.value>0&&o.value:l.value==="factura"&&y.value&&h.value==="empresa"?w.value.nombre&&w.value.nif&&w.value.direccion:!0);function Pe(){l.value==="datos"?l.value="factura":l.value==="factura"&&(l.value="confirmacion")}function Ie(){l.value==="confirmacion"?l.value="factura":l.value==="factura"&&(l.value="datos")}async function $e(){if(!(!A.value||!o.value)){k.value=!0;try{const _=await M({pacienteId:A.value,fechaPago:s.value,monto:n.value,metodoPago:o.value,concepto:t.value||void 0,bonoId:r.value||void 0});if(!_.success)throw new Error(_.error||"Error al crear el pago");let i;if(y.value&&_.data){const K=await j({pacienteId:A.value,tipoCliente:h.value,receptorNombre:h.value==="empresa"?w.value.nombre:R.value,receptorNif:h.value==="empresa"?w.value.nif:void 0,receptorDireccion:h.value==="empresa"?w.value.direccion:void 0,concepto:t.value||"Sesión de psicoterapia",baseImponible:n.value,bonoId:r.value||void 0,pagoId:_.data.id});K.success&&K.data&&(i=K.data.id)}J(y.value?"Pago y factura registrados":"Pago registrado"),C("saved",{pagoId:_.data.id,facturaId:i}),te()}catch(_){console.error("[PagoUnificadoModal] Error:",_),V(_.message||"Error al guardar el pago")}finally{k.value=!1}}}function te(){l.value="datos",A.value=null,R.value="",U.value="",u.value=[],r.value=null,n.value=0,o.value=null,t.value="",y.value=!1,C("close")}function re(_){return new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR"}).format(_)}return(_,i)=>{const K=Ce,Ee=tt;return c(),ue(De,{to:"body"},[L(ge,{"enter-active-class":"transition-opacity duration-200","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity duration-150","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:me(()=>[$.visible?(c(),d("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",onClick:ce(te,["self"])},[e("div",{class:"w-full max-w-lg bg-white rounded-2xl shadow-xl overflow-hidden flex flex-col max-h-[90vh]",onClick:i[7]||(i[7]=ce(()=>{},["stop"]))},[e("div",at,[e("div",null,[e("h2",ot,g(l.value==="datos"?"Nuevo Pago":l.value==="factura"?"Facturación":"Confirmar"),1),e("p",st," Paso "+g(l.value==="datos"?"1":l.value==="factura"?"2":"3")+" de 3 ",1)]),e("button",{onClick:te,class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"},[L(D(pe),{class:"w-5 h-5"})])]),e("div",rt,[l.value==="datos"?(c(),d("div",nt,[e("div",null,[e("label",lt,[L(D(Ve),{class:"w-4 h-4 inline mr-1"}),i[8]||(i[8]=O(" Paciente ",-1)),i[9]||(i[9]=e("span",{class:"text-red-500"},"*",-1))]),e("div",it,[q(e("input",{"onUpdate:modelValue":i[0]||(i[0]=P=>U.value=P),type:"text",placeholder:"Buscar paciente...",class:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",onFocus:i[1]||(i[1]=P=>H.value=!0)},null,544),[[Y,U.value]]),A.value?(c(),d("button",{key:0,onClick:xe,class:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600"},[L(D(pe),{class:"w-4 h-4"})])):F("",!0),H.value&&!A.value?(c(),d("div",ut,[D(N)?(c(),d("div",ct," Buscando... ")):D(x).length===0?(c(),d("div",dt," No se encontraron pacientes ")):F("",!0),(c(!0),d(W,null,ee(D(x),P=>(c(),d("button",{key:P.id,class:"w-full px-4 py-2 text-left hover:bg-gray-50 flex items-center gap-3",onClick:Fe=>se(P)},[e("div",ft,g(P.nombre_completo.charAt(0)),1),e("div",null,[e("p",vt,g(P.nombre_completo),1),e("p",gt,g(P.email),1)])],8,pt))),128))])):F("",!0)])]),u.value.length>0?(c(),d("div",mt,[e("label",bt,[L(D(Ne),{class:"w-4 h-4 inline mr-1"}),i[10]||(i[10]=O(" Bonos pendientes de pago ",-1))]),e("div",yt,[(c(!0),d(W,null,ee(u.value,P=>(c(),d("button",{key:P.id,class:X(["w-full p-3 border rounded-lg text-left transition-all",r.value===P.id?"border-purple-500 bg-purple-50":"border-gray-200 hover:border-gray-300"]),onClick:Fe=>he(P)},[e("div",xt,[e("span",ht,g(P.tipo),1),e("span",wt,g(re(P.monto_total)),1)]),e("p",kt,g(P.sesiones_totales)+" sesiones ",1)],10,_t))),128))])])):F("",!0),e("div",Pt,[e("div",null,[i[11]||(i[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Fecha ",-1)),q(e("input",{"onUpdate:modelValue":i[2]||(i[2]=P=>s.value=P),type:"date",class:"w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"},null,512),[[Y,s.value]])]),e("div",null,[e("label",It,[L(D(Me),{class:"w-4 h-4 inline mr-1"}),i[12]||(i[12]=O(" Monto ",-1)),i[13]||(i[13]=e("span",{class:"text-red-500"},"*",-1))]),e("div",$t,[q(e("input",{"onUpdate:modelValue":i[3]||(i[3]=P=>n.value=P),type:"number",step:"0.01",min:"0",placeholder:"0.00",class:"w-full px-3 py-2.5 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"},null,512),[[Y,n.value,void 0,{number:!0}]]),i[14]||(i[14]=e("span",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"},"EUR",-1))])])]),e("div",null,[i[15]||(i[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[O(" Método de pago "),e("span",{class:"text-red-500"},"*")],-1)),L(K,{"selected-method":o.value,size:"sm",onSelect:i[4]||(i[4]=P=>o.value=P)},null,8,["selected-method"])]),e("div",null,[i[16]||(i[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Concepto ",-1)),q(e("textarea",{"onUpdate:modelValue":i[5]||(i[5]=P=>t.value=P),rows:"2",placeholder:"Describe el pago (opcional)...",class:"w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 resize-none"},null,512),[[Y,t.value]])])])):l.value==="factura"?(c(),d("div",Et,[e("label",Ft,[e("div",Ct,[L(D(fe),{class:"w-5 h-5 text-gray-500"}),i[17]||(i[17]=e("div",null,[e("span",{class:"font-medium text-gray-900"},"Generar factura"),e("p",{class:"text-xs text-gray-500"},"Se creará una factura asociada a este pago")],-1))]),q(e("input",{type:"checkbox","onUpdate:modelValue":i[6]||(i[6]=P=>y.value=P),class:"w-5 h-5 text-purple-600 rounded focus:ring-purple-500"},null,512),[[Ae,y.value]])]),y.value&&Z.value?(c(),d("div",Dt,[i[18]||(i[18]=O(" Próxima factura: ",-1)),e("strong",At,g(Z.value),1)])):F("",!0),y.value?(c(),ue(Ee,{key:1,"base-imponible":n.value,"regimen-i-v-a":a.value,onUpdate:we},null,8,["base-imponible","regimen-i-v-a"])):F("",!0),y.value?F("",!0):(c(),d("div",St,[L(D(fe),{class:"w-12 h-12 mx-auto mb-3 text-gray-300"}),i[19]||(i[19]=e("p",null,"No se generará factura para este pago",-1)),i[20]||(i[20]=e("p",{class:"text-sm"},"Puedes generar una factura más tarde desde el historial",-1))]))])):l.value==="confirmacion"?(c(),d("div",Vt,[e("div",Nt,[e("p",Mt,g(re(n.value)),1),e("p",Rt,g(R.value),1)]),e("div",jt,[e("div",Bt,[i[21]||(i[21]=e("span",{class:"text-gray-600"},"Fecha:",-1)),e("span",Ut,g(new Date(s.value).toLocaleDateString("es-ES")),1)]),e("div",qt,[i[22]||(i[22]=e("span",{class:"text-gray-600"},"Método:",-1)),e("span",Ht,g(o.value),1)]),t.value?(c(),d("div",Tt,[i[23]||(i[23]=e("span",{class:"text-gray-600"},"Concepto:",-1)),e("span",zt,g(t.value),1)])):F("",!0),r.value?(c(),d("div",Lt,[...i[24]||(i[24]=[e("span",{class:"text-gray-600"},"Bono:",-1),e("span",{class:"text-purple-600 font-medium"},"Asociado",-1)])])):F("",!0),e("div",Ot,[i[25]||(i[25]=e("span",{class:"text-gray-600"},"Factura:",-1)),e("span",{class:X(["font-medium",y.value?"text-green-600":"text-gray-400"])},g(y.value?"Sí":"No"),3)]),y.value&&m.value?(c(),d("div",Zt,[e("div",Gt,[i[26]||(i[26]=e("span",null,"Total factura:",-1)),e("span",Jt,g(re(m.value.total)),1)])])):F("",!0)])])):F("",!0)]),e("div",Xt,[l.value!=="datos"?(c(),d("button",{key:0,onClick:Ie,class:"px-4 py-2.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",disabled:k.value}," Anterior ",8,Yt)):F("",!0),l.value==="datos"?(c(),d("button",{key:1,onClick:te,class:"px-4 py-2.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"}," Cancelar ")):F("",!0),l.value!=="confirmacion"?(c(),d("button",{key:2,onClick:Pe,disabled:!ke.value,class:"flex-1 px-4 py-2.5 text-sm font-medium text-white bg-purple-600 rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"}," Siguiente ",8,Kt)):(c(),d("button",{key:3,onClick:$e,disabled:k.value,class:"flex-1 px-4 py-2.5 text-sm font-medium text-white bg-green-600 rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 flex items-center justify-center gap-2"},[k.value?(c(),d("svg",Wt,[...i[27]||(i[27]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"},null,-1)])])):F("",!0),O(" "+g(k.value?"Guardando...":"Confirmar pago"),1)],8,Qt))])])])):F("",!0)]),_:1})])}}}),ta=Object.assign(ea,{__name:"PaymentPagoUnificadoModal"}),aa={class:"pagos-page"},oa={class:"page-header"},sa={class:"header-content"},ra={class:"tabs"},na={class:"filtros"},la={class:"filtro-grupo"},ia={class:"filtro-grupo"},ua={class:"filtro-grupo"},ca=["value"],da={key:0,class:"filtro-grupo"},pa={key:0,class:"loading-state"},fa={key:1,class:"table-container"},va={key:0,class:"data-table"},ga={class:"fecha"},ma={class:"concepto"},ba={class:"metodo-badge"},ya={class:"text-right monto"},_a={key:0,class:"bono-badge"},xa={key:1,class:"text-muted"},ha={key:1,class:"empty-state"},wa={key:2,class:"paginacion"},ka=["disabled"],Pa={class:"pag-info"},Ia=["disabled"],$a={key:2,class:"table-container"},Ea={key:0,class:"data-table"},Fa={class:"numero-factura"},Ca={class:"fecha"},Da={class:"cliente-info"},Aa={class:"cliente-nombre"},Sa={key:0,class:"cliente-nif"},Va={class:"concepto"},Na={class:"text-right"},Ma={class:"text-right monto"},Ra={class:"acciones"},ja=["onClick"],Ba=["onClick"],Ua={key:1,class:"empty-state"},qa={key:2,class:"paginacion"},Ha=["disabled"],Ta={class:"pag-info"},za=["disabled"],ae=20,La=ne({__name:"index",setup($){const{getPagos:E,loading:f,formatearMetodoPago:C}=_e(),{getFacturas:v,loading:x,formatearImporte:N,formatearFecha:M,getEstadoColor:z,anularFactura:j}=le(),{pacientes:S,loadAllPacientes:G}=ye(),{waitForUser:J}=oe(),V=b("pagos"),B=b([]),l=b([]),k=b(!1),I=b({fechaDesde:"",fechaHasta:"",pacienteId:"",estado:""}),A=b(1),R=b(1),U=b(0),H=b(0);T(()=>Math.ceil(U.value/ae)),T(()=>Math.ceil(H.value/ae));const s=T(()=>f.value||x.value);async function n(){const m=await E({fechaDesde:I.value.fechaDesde||void 0,fechaHasta:I.value.fechaHasta||void 0,pacienteId:I.value.pacienteId||void 0});m.success&&m.data?(B.value=m.data,U.value=m.total||m.data.length):(B.value=[],U.value=0)}async function o(){const m=await v({fechaDesde:I.value.fechaDesde||void 0,fechaHasta:I.value.fechaHasta||void 0,pacienteId:I.value.pacienteId||void 0,estado:I.value.estado||void 0});m.success&&m.data?(l.value=m.data,H.value=m.total||m.data.length):(l.value=[],H.value=0)}function t(){A.value=1,R.value=1,V.value==="pagos"?n():o()}function r(){I.value={fechaDesde:"",fechaHasta:"",pacienteId:"",estado:""},t()}async function u(m){if(!confirm(`¿Estás seguro de anular la factura ${m.numero_factura}?`))return;const a=prompt("Motivo de anulación:");if(!a)return;await j(m.id,a)&&o()}function y(m){alert(`Generando PDF para factura ${m.numero_factura}...`)}function h(m){if(!m)return"Sin paciente";const a=S.value.find(Z=>Z.id===m);return a?a.nombre:"Paciente no encontrado"}function w(){k.value=!1,n(),o()}return Q(V,m=>{m==="pagos"?n():o()}),Q(A,n),Q(R,o),be(async()=>{await J(),await G(),n()}),(m,a)=>{const Z=ta;return c(),d("div",aa,[e("header",oa,[e("div",sa,[a[14]||(a[14]=e("h1",null,"Pagos y Facturación",-1)),e("button",{class:"btn-primary",onClick:a[0]||(a[0]=p=>k.value=!0)},[...a[13]||(a[13]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4.5v15m7.5-7.5h-15"})],-1),O(" Nuevo Pago ",-1)])])])]),e("div",ra,[e("button",{class:X(["tab",{active:V.value==="pagos"}]),onClick:a[1]||(a[1]=p=>V.value="pagos")}," Registros de Pago ",2),e("button",{class:X(["tab",{active:V.value==="facturas"}]),onClick:a[2]||(a[2]=p=>V.value="facturas")}," Facturas ",2)]),e("div",na,[e("div",la,[a[15]||(a[15]=e("label",null,"Desde",-1)),q(e("input",{type:"date","onUpdate:modelValue":a[3]||(a[3]=p=>I.value.fechaDesde=p),class:"input-date"},null,512),[[Y,I.value.fechaDesde]])]),e("div",ia,[a[16]||(a[16]=e("label",null,"Hasta",-1)),q(e("input",{type:"date","onUpdate:modelValue":a[4]||(a[4]=p=>I.value.fechaHasta=p),class:"input-date"},null,512),[[Y,I.value.fechaHasta]])]),e("div",ua,[a[18]||(a[18]=e("label",null,"Paciente",-1)),q(e("select",{"onUpdate:modelValue":a[5]||(a[5]=p=>I.value.pacienteId=p),class:"input-select"},[a[17]||(a[17]=e("option",{value:""},"Todos",-1)),(c(!0),d(W,null,ee(D(S),p=>(c(),d("option",{key:p.id,value:p.id},g(p.nombre),9,ca))),128))],512),[[de,I.value.pacienteId]])]),V.value==="facturas"?(c(),d("div",da,[a[20]||(a[20]=e("label",null,"Estado",-1)),q(e("select",{"onUpdate:modelValue":a[6]||(a[6]=p=>I.value.estado=p),class:"input-select"},[...a[19]||(a[19]=[e("option",{value:""},"Todos",-1),e("option",{value:"emitida"},"Emitida",-1),e("option",{value:"borrador"},"Borrador",-1),e("option",{value:"anulada"},"Anulada",-1)])],512),[[de,I.value.estado]])])):F("",!0),e("div",{class:"filtro-acciones"},[e("button",{class:"btn-secondary",onClick:t},"Filtrar"),e("button",{class:"btn-text",onClick:r},"Limpiar")])]),s.value?(c(),d("div",pa,[...a[21]||(a[21]=[e("div",{class:"spinner"},null,-1),e("p",null,"Cargando...",-1)])])):V.value==="pagos"?(c(),d("div",fa,[B.value.length>0?(c(),d("table",va,[a[22]||(a[22]=e("thead",null,[e("tr",null,[e("th",null,"Fecha"),e("th",null,"Paciente"),e("th",null,"Concepto"),e("th",null,"Método"),e("th",{class:"text-right"},"Monto"),e("th",null,"Bono")])],-1)),e("tbody",null,[(c(!0),d(W,null,ee(B.value,p=>(c(),d("tr",{key:p.id},[e("td",ga,g(D(M)(p.fecha_pago)),1),e("td",null,g(h(p.paciente_id)),1),e("td",ma,g(p.concepto||"-"),1),e("td",null,[e("span",ba,g(D(C)(p.metodo_pago)),1)]),e("td",ya,g(D(N)(p.monto)),1),e("td",null,[p.bono_id?(c(),d("span",_a,"Bono")):(c(),d("span",xa,"-"))])]))),128))])])):(c(),d("div",ha,[a[23]||(a[23]=e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"empty-icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 00-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 01-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 003 15h-.75M15 10.5a3 3 0 11-6 0 3 3 0 016 0zm3 0h.008v.008H18V10.5zm-12 0h.008v.008H6V10.5z"})],-1)),a[24]||(a[24]=e("p",null,"No hay pagos registrados",-1)),e("button",{class:"btn-primary",onClick:a[7]||(a[7]=p=>k.value=!0)},"Registrar primer pago")])),B.value.length>0?(c(),d("div",wa,[e("button",{disabled:A.value===1,onClick:a[8]||(a[8]=p=>A.value--),class:"btn-pag"}," Anterior ",8,ka),e("span",Pa,"Página "+g(A.value),1),e("button",{disabled:B.value.length<ae,onClick:a[9]||(a[9]=p=>A.value++),class:"btn-pag"}," Siguiente ",8,Ia)])):F("",!0)])):(c(),d("div",$a,[l.value.length>0?(c(),d("table",Ea,[a[27]||(a[27]=e("thead",null,[e("tr",null,[e("th",null,"Nº Factura"),e("th",null,"Fecha"),e("th",null,"Cliente"),e("th",null,"Concepto"),e("th",{class:"text-right"},"Base"),e("th",{class:"text-right"},"Total"),e("th",null,"Estado"),e("th",null,"Acciones")])],-1)),e("tbody",null,[(c(!0),d(W,null,ee(l.value,p=>(c(),d("tr",{key:p.id},[e("td",Fa,g(p.numero_factura),1),e("td",Ca,g(D(M)(p.fecha_emision)),1),e("td",null,[e("div",Da,[e("span",Aa,g(p.receptor_nombre),1),p.receptor_nif?(c(),d("span",Sa,g(p.receptor_nif),1)):F("",!0)])]),e("td",Va,g(p.concepto),1),e("td",Na,g(D(N)(p.base_imponible)),1),e("td",Ma,g(D(N)(p.total)),1),e("td",null,[e("span",{class:X(["estado-badge",D(z)(p.estado)])},g(p.estado),3)]),e("td",Ra,[e("button",{class:"btn-icon",title:"Descargar PDF",onClick:se=>y(p)},[...a[25]||(a[25]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"})],-1)])],8,ja),p.estado==="emitida"?(c(),d("button",{key:0,class:"btn-icon btn-danger",title:"Anular factura",onClick:se=>u(p)},[...a[26]||(a[26]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Ba)):F("",!0)])]))),128))])])):(c(),d("div",Ua,[...a[28]||(a[28]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"empty-icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})],-1),e("p",null,"No hay facturas emitidas",-1),e("p",{class:"text-muted"},"Las facturas se generan al registrar pagos",-1)])])),l.value.length>0?(c(),d("div",qa,[e("button",{disabled:R.value===1,onClick:a[10]||(a[10]=p=>R.value--),class:"btn-pag"}," Anterior ",8,Ha),e("span",Ta,"Página "+g(R.value),1),e("button",{disabled:l.value.length<ae,onClick:a[11]||(a[11]=p=>R.value++),class:"btn-pag"}," Siguiente ",8,za)])):F("",!0)])),L(Z,{visible:k.value,onClose:a[12]||(a[12]=p=>k.value=!1),onSaved:w},null,8,["visible"])])}}}),to=Re(La,[["__scopeId","data-v-b94e214f"]]);export{to as default};
