import{c as l,o as r,a as e,p as he,f as Xe,r as _,x as m,e as se,A as M,l as n,h as y,t as f,d as T,F as _e,g as we,D as Ye,J as F,T as ke,j as W,b as P,L as ea,I as G,w as H,M as Z,ae as oe,z as aa,k as N,v as K,K as me}from"#entry";import{_ as ta}from"./PaymentMethodSelector-DGmnaSg8.js";import{u as Ce}from"./useToast-Cq0GyJHs.js";import{r as ge}from"./XMarkIcon-DWNj0d99.js";import{r as J}from"./CheckCircleIcon-Bi0YyG7H.js";import{r as oa}from"./PencilIcon-QJyqa3i7.js";import{r as sa}from"./PhoneIcon-B4J2dtua.js";import{r as ra}from"./CalendarDaysIcon-C0vq0F4x.js";import{r as pe}from"./ClockIcon-CQZt9cKZ.js";import{r as na}from"./TicketIcon-DRclOuRO.js";import{r as ve}from"./ChevronDownIcon-BwiNUDLV.js";import{r as be}from"./ExclamationTriangleIcon-BreoAuwB.js";import{r as ye}from"./PlusIcon-UqRq4KLf.js";import{_ as ia}from"./_plugin-vue_export-helper-DlAUqK2U.js";function la(b,B){return r(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"})])}function xe(b,B){return r(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m4.5 15.75 7.5-7.5 7.5 7.5"})])}function da(b,B){return r(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z"})])}function ca(b,B){return r(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m15.75 10.5 4.72-4.72a.75.75 0 0 1 1.28.53v11.38a.75.75 0 0 1-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25h-9A2.25 2.25 0 0 0 2.25 7.5v9a2.25 2.25 0 0 0 2.25 2.25Z"})])}function re(){const b=he(),{userProfile:B}=Xe(),i=_([]),p=_(!1),k=_(null),V=m(()=>{const u=new Date().toISOString().split("T")[0],d=i.value.filter(s=>s.estado_pago==="pagado"),o=i.value.filter(s=>s.estado_pago==="pendiente"||!s.estado_pago),c={efectivo:{total:0,cantidad:0},transferencia:{total:0,cantidad:0},bizum:{total:0,cantidad:0},tarjeta:{total:0,cantidad:0},stripe:{total:0,cantidad:0}};return d.forEach(s=>{s.metodo_pago&&c[s.metodo_pago]&&(c[s.metodo_pago].total+=s.precio_sesion||0,c[s.metodo_pago].cantidad+=1)}),{fecha:u,total:d.reduce((s,v)=>s+(v.precio_sesion||0),0),cantidadPagos:d.length,porMetodo:c,pagos:d,pendientes:o}});async function w(u){const d=B.value?.terapeuta_id||B.value?.id;if(!d)return console.warn("[usePayments] No hay terapeuta_id disponible"),[];const o=u||new Date().toISOString().split("T")[0];p.value=!0,k.value=null;try{const{data:c,error:s}=await b.from("citas").select(`
          id,
          fecha_cita,
          hora_inicio,
          hora_fin,
          precio_sesion,
          estado_pago,
          metodo_pago,
          fecha_pago,
          bono_id,
          estado,
          paciente:pacientes(id, nombre_completo)
        `).eq("terapeuta_id",d).eq("fecha_cita",o).in("estado",["confirmada","realizada"]).order("hora_inicio",{ascending:!0});if(s)throw new Error(s.message);const v=(c||[]).map(C=>({id:C.id,paciente_id:C.paciente?.id||"",paciente_nombre:C.paciente?.nombre_completo||"Sin nombre",fecha_cita:C.fecha_cita,hora_inicio:C.hora_inicio,hora_fin:C.hora_fin,precio_sesion:C.precio_sesion,estado_pago:C.estado_pago,metodo_pago:C.metodo_pago,fecha_pago:C.fecha_pago,bono_id:C.bono_id,estado:C.estado}));return i.value=v,v}catch(c){return k.value=c.message,console.error("[usePayments] Error obteniendo pagos:",c),[]}finally{p.value=!1}}async function I(u,d,o,c){p.value=!0,k.value=null;try{const{data:s,error:v}=await b.rpc("fn_registrar_pago_sesion",{p_cita_id:u,p_metodo_pago:d,p_monto:o||null,p_notas:c||null});if(!v)return await $(),{success:!0,data:s};console.warn("[usePayments] RPC fallÃ³, usando fallback:",v.message);const C={estado_pago:"pagado",metodo_pago:d,fecha_pago:new Date().toISOString(),updated_at:new Date().toISOString()};o!==void 0&&(C.precio_sesion=o),c&&(C.notas_pago=c);const{error:U}=await b.from("citas").update(C).eq("id",u);if(U)throw new Error(U.message);return await $(),{success:!0}}catch(s){return k.value=s.message,console.error("[usePayments] Error registrando pago:",s),{success:!1,error:s.message}}finally{p.value=!1}}async function D(u,d){p.value=!0,k.value=null;try{const{error:o}=await b.from("citas").update({metodo_pago:d,updated_at:new Date().toISOString()}).eq("id",u);if(o)throw new Error(o.message);return await $(),{success:!0}}catch(o){return k.value=o.message,console.error("[usePayments] Error actualizando mÃ©todo:",o),{success:!1,error:o.message}}finally{p.value=!1}}async function E(u){p.value=!0,k.value=null;try{const{error:d}=await b.from("citas").update({estado_pago:"pendiente",metodo_pago:null,fecha_pago:null,notas_pago:null,updated_at:new Date().toISOString()}).eq("id",u);if(d)throw new Error(d.message);return await $(),{success:!0}}catch(d){return k.value=d.message,console.error("[usePayments] Error deshaciendo pago:",d),{success:!1,error:d.message}}finally{p.value=!1}}function z(u){const d={efectivo:{total:0,cantidad:0},transferencia:{total:0,cantidad:0},bizum:{total:0,cantidad:0},tarjeta:{total:0,cantidad:0},stripe:{total:0,cantidad:0}},o=u.filter(c=>c.estado_pago==="pagado");return o.forEach(c=>{c.metodo_pago&&d[c.metodo_pago]&&(d[c.metodo_pago].total+=c.precio_sesion||0,d[c.metodo_pago].cantidad+=1)}),{total:o.reduce((c,s)=>c+(s.precio_sesion||0),0),porMetodo:d}}async function $(){await w()}function j(u){return u?{efectivo:"ðŸ’µ Efectivo",transferencia:"ðŸ¦ Transferencia",bizum:"ðŸ“± Bizum",tarjeta:"ðŸ’³ Tarjeta",stripe:"âš¡ Stripe"}[u]:"No especificado"}function q(u){if(!u)return"";const d=new Date(u),o=new Date,c=new Date(o);c.setDate(c.getDate()-1);const s=d.toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit"}),v=d.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"});return d.toDateString()===o.toDateString()?`Hoy a las ${v}`:d.toDateString()===c.toDateString()?`Ayer a las ${v}`:`${s} a las ${v}`}return{pagosDia:i,loading:p,error:k,resumenDia:V,getPaymentsOfDay:w,createPayment:I,updatePaymentMethod:D,undoPayment:E,refreshPaymentsForToday:$,getPaymentSummary:z,formatPaymentMethod:j,formatPaymentDate:q}}const ua={class:"flex items-start justify-between gap-3"},fa={class:"flex items-center gap-2"},ma={key:0,class:"text-xs text-gray-500 mt-0.5"},ga={key:0},pa={key:1,class:"ml-1"},va={key:1,class:"text-xs text-blue-600 mt-0.5"},ba={key:0,class:"text-right"},ya={key:2,class:"text-xs text-blue-600 italic"},xa=se({__name:"PaymentStatusBadge",props:{estadoPago:{},metodoPago:{default:null},fechaPago:{default:null},cantidad:{default:null},showActions:{type:Boolean,default:!0},compact:{type:Boolean,default:!1}},emits:["registrar","cambiar","deshacer"],setup(b,{emit:B}){const i=b,p=B,{formatPaymentMethod:k,formatPaymentDate:V}=re(),w=m(()=>{switch(i.estadoPago){case"pagado":return{label:"Pagado",icon:"âœ“",bgColor:"bg-green-50",textColor:"text-green-700",borderColor:"border-green-200",iconBg:"bg-green-500"};case"bonificado":return{label:"Bonificado",icon:"ðŸŽ",bgColor:"bg-blue-50",textColor:"text-blue-700",borderColor:"border-blue-200",iconBg:"bg-blue-500"};case"cancelado":return{label:"Cancelado",icon:"âœ•",bgColor:"bg-gray-50",textColor:"text-gray-500",borderColor:"border-gray-200",iconBg:"bg-gray-400"};default:return{label:"Pendiente",icon:"â³",bgColor:"bg-amber-50",textColor:"text-amber-700",borderColor:"border-amber-200",iconBg:"bg-amber-500"}}}),I=m(()=>i.estadoPago==="pagado"),D=m(()=>!i.estadoPago||i.estadoPago==="pendiente"),E=m(()=>i.estadoPago==="bonificado"),z=m(()=>i.metodoPago?k(i.metodoPago):null),$=m(()=>i.fechaPago?V(i.fechaPago):null),j=m(()=>i.cantidad===null||i.cantidad===void 0?null:`${i.cantidad.toFixed(2)}â‚¬`);return(q,u)=>(r(),l("div",{class:M(["rounded-lg border transition-colors",n(w).bgColor,n(w).borderColor,b.compact?"p-2":"p-3"])},[e("div",ua,[e("div",fa,[e("span",{class:M(["flex items-center justify-center rounded-full text-white",n(w).iconBg,b.compact?"w-5 h-5 text-xs":"w-6 h-6 text-sm"]),"aria-hidden":"true"},f(n(w).icon),3),e("div",null,[e("span",{class:M(["font-medium",n(w).textColor,b.compact?"text-sm":"text-base"])},f(n(w).label),3),n(I)&&!b.compact?(r(),l("p",ma,[n(z)?(r(),l("span",ga,f(n(z)),1)):y("",!0),n($)?(r(),l("span",pa,"Â· "+f(n($)),1)):y("",!0)])):y("",!0),n(E)&&!b.compact?(r(),l("p",va," SesiÃ³n cubierta por bono ")):y("",!0)])]),n(j)&&!b.compact?(r(),l("div",ba,[e("span",{class:M(["font-semibold",n(w).textColor])},f(n(j)),3)])):y("",!0)]),b.showActions&&!b.compact?(r(),l("div",{key:0,class:M(["mt-3 pt-3 border-t flex flex-wrap gap-2",n(w).borderColor])},[n(D)?(r(),l("button",{key:0,type:"button",class:"flex-1 inline-flex items-center justify-center gap-1.5 px-3 py-2 text-sm font-medium text-white bg-teal-600 rounded-lg hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transition-colors",onClick:u[0]||(u[0]=d=>p("registrar"))},[...u[3]||(u[3]=[e("span",{"aria-hidden":"true"},"ðŸ’³",-1),T(" Registrar pago ",-1)])])):y("",!0),n(I)?(r(),l(_e,{key:1},[e("button",{type:"button",class:"inline-flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transition-colors",onClick:u[1]||(u[1]=d=>p("cambiar"))},[...u[4]||(u[4]=[e("span",{"aria-hidden":"true"},"ðŸ”„",-1),T(" Cambiar mÃ©todo ",-1)])]),e("button",{type:"button",class:"inline-flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium text-red-600 bg-white border border-red-200 rounded-lg hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors",onClick:u[2]||(u[2]=d=>p("deshacer"))},[...u[5]||(u[5]=[e("span",{"aria-hidden":"true"},"â†©ï¸",-1),T(" Deshacer ",-1)])])],64)):y("",!0),n(E)?(r(),l("p",ya," Esta sesiÃ³n estÃ¡ vinculada a un bono activo ")):y("",!0)],2)):y("",!0)],2))}}),ha=Object.assign(xa,{__name:"PaymentStatusBadge"}),_a={class:"px-5 py-4 bg-gray-50 border-b border-gray-200"},wa={id:"payment-modal-title",class:"text-lg font-semibold text-gray-900"},ka={class:"p-5 space-y-5"},Ca={class:"text-center pb-4 border-b border-gray-100"},Sa={class:"text-3xl font-bold text-gray-900"},Pa={class:"mt-1 text-base text-gray-700"},$a={class:"text-sm text-gray-500"},Ea={key:0,class:"ml-1"},Da={class:"px-5 py-4 bg-gray-50 border-t border-gray-200 flex gap-3"},Ia=["disabled"],Ma=["disabled"],za={key:0,class:"inline-flex items-center gap-2"},Ba={key:1},ja=se({__name:"PaymentQuickModal",props:{citaId:{},pacienteNombre:{},cantidad:{},tipoTransaccion:{default:"sesion_unica"},bonoInfo:{default:null},horaInicio:{default:""},metodoPagoActual:{default:null},modoEdicion:{type:Boolean,default:!1}},emits:["confirm","cancel"],setup(b,{emit:B}){const i=b,p=B,{createPayment:k,updatePaymentMethod:V}=re(),{success:w,error:I}=Ce(),D=_(i.metodoPagoActual),E=_(!1),z=m(()=>i.bonoInfo?`SesiÃ³n ${i.bonoInfo.numeroSesion||i.bonoInfo.sesionesTotales-i.bonoInfo.sesionesRestantes+1}/${i.bonoInfo.sesionesTotales} "${i.bonoInfo.nombre}"`:"SesiÃ³n individual"),$=m(()=>i.modoEdicion?"Cambiar mÃ©todo de pago":"Registrar pago"),j=m(()=>`${i.cantidad.toFixed(2)}â‚¬`);function q(s){D.value=s}async function u(){if(!D.value){I("Selecciona un mÃ©todo de pago");return}E.value=!0;try{let s;i.modoEdicion?s=await V(i.citaId,D.value):s=await k(i.citaId,D.value,i.cantidad),s.success?(w(i.modoEdicion?"MÃ©todo actualizado":"Pago registrado"),p("confirm",D.value)):I(s.error||"Error al procesar el pago")}catch(s){console.error("[PaymentQuickModal] Error:",s),I("Error inesperado")}finally{E.value=!1}}function d(){p("cancel")}function o(s){s.target===s.currentTarget&&d()}function c(s){s.key==="Escape"&&d()}return we(()=>{document.addEventListener("keydown",c)}),Ye(()=>{document.removeEventListener("keydown",c)}),(s,v)=>{const C=ta;return r(),F(ke,{to:"body"},[e("div",{class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",role:"dialog","aria-modal":"true","aria-labelledby":"payment-modal-title",onClick:o},[e("div",{class:"w-full max-w-md bg-white rounded-2xl shadow-xl overflow-hidden",onClick:v[0]||(v[0]=W(()=>{},["stop"]))},[e("div",_a,[e("h2",wa,f(n($)),1)]),e("div",ka,[e("div",Ca,[e("p",Sa,f(n(j)),1),e("p",Pa,f(b.pacienteNombre),1),e("p",$a,[T(f(n(z))+" ",1),b.horaInicio?(r(),l("span",Ea,"Â· "+f(b.horaInicio),1)):y("",!0)])]),e("div",null,[v[1]||(v[1]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," MÃ©todo de pago ",-1)),P(C,{"selected-method":n(D),disabled:n(E),size:"md",onSelect:q},null,8,["selected-method","disabled"])])]),e("div",Da,[e("button",{type:"button",class:"flex-1 px-4 py-2.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors",disabled:n(E),onClick:d}," Cancelar ",8,Ia),e("button",{type:"button",class:"flex-1 px-4 py-2.5 text-sm font-medium text-white bg-teal-600 rounded-lg hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:!n(D)||n(E),onClick:u},[n(E)?(r(),l("span",za,[...v[2]||(v[2]=[e("svg",{class:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})],-1),T(" Procesando... ",-1)])])):(r(),l("span",Ba,f(b.modoEdicion?"Actualizar":"Confirmar pago"),1))],8,Ma)])])])])}}}),Ta=Object.assign(ja,{__name:"PaymentQuickModal"}),Va={class:"px-5 py-4 border-b border-gray-100 flex items-center justify-between bg-white"},qa={class:"flex items-center gap-3"},Aa={class:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-sm font-semibold text-gray-600"},Oa={id:"modal-title",class:"text-base font-semibold text-gray-900"},Fa={key:0,class:"flex-1 flex items-center justify-center p-12"},Ra={key:1,class:"flex-1 overflow-y-auto"},Na={class:"px-5 py-3 border-b border-gray-100 flex items-center gap-2 flex-wrap"},La=["disabled"],Ua={class:"px-5 py-4 border-b border-gray-100"},Qa={class:"flex items-center justify-between text-sm"},Ga={class:"flex items-center gap-4"},Ha={class:"flex items-center gap-1.5 text-gray-600"},Za={class:"flex items-center gap-1.5 text-gray-600"},Ka={class:"flex items-center gap-1.5 text-gray-600"},Ja={class:"text-gray-500"},Wa={class:"mx-5 my-4"},Xa={key:0,class:"mt-2 text-xs text-amber-600 text-center"},Ya={key:1,class:"mt-3 p-3 bg-red-50 border border-red-200 rounded-lg"},et={class:"flex gap-2"},at=["disabled"],tt=["disabled"],ot={class:"mx-5 mb-3"},st={class:"flex items-center gap-2"},rt={class:"flex items-center gap-2"},nt={key:0,class:"text-xs text-gray-500"},it={key:0,class:"mt-2 overflow-hidden"},lt={key:0,class:"p-4 bg-white border border-gray-100 rounded-lg space-y-3"},dt={class:"flex items-center justify-between"},ct={class:"text-sm font-medium text-gray-900"},ut={key:0,class:"ml-2 text-xs text-green-600 font-medium"},ft={key:1,class:"ml-2 text-xs text-amber-600 font-medium"},mt={class:"flex items-center justify-between text-xs text-gray-500 mb-1"},gt={class:"font-medium"},pt={class:"h-2 bg-gray-200 rounded-full overflow-hidden"},vt={key:0,class:"flex items-center gap-2 p-2 bg-amber-50 border border-amber-100 rounded-lg"},bt={key:1,class:"flex items-center gap-2 p-2 bg-red-50 border border-red-100 rounded-lg"},yt={class:"flex items-center gap-2 pt-2 border-t border-gray-100"},xt=["disabled"],ht=["disabled"],_t={key:1,class:"p-4 bg-gray-50 border border-gray-100 rounded-lg text-center"},wt={key:1,class:"mx-5 mb-4"},kt={key:0,class:"mt-2 px-4 py-3 bg-gray-50 rounded-lg overflow-hidden"},Ct={class:"text-sm text-gray-700 whitespace-pre-wrap"},St={class:"px-5 py-3 border-t border-gray-100 flex items-center justify-between text-xs text-gray-400"},Pt={key:2,class:"px-5 pb-4"},$t=["disabled"],Et={key:0,class:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24"},Dt={class:"grid grid-cols-2 gap-3"},It={class:"grid grid-cols-2 gap-3"},Mt={class:"flex gap-3 pt-2"},zt=["disabled"],Bt={key:2,class:"flex-1 flex items-center justify-center p-12 text-center"},jt={class:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3"},Tt={class:"text-gray-400 text-sm mt-1"},Vt=se({__name:"ModalDetallesCita",props:{citaId:{}},emits:["close","cita-actualizada","cita-eliminada","actualizado","eliminado"],setup(b,{emit:B}){const i=b,p=B,k=_(!1),V=_(!1),w=_(!1),I=_(!1),D=_(!0),E=_(!1),z=_(!1),$=_(!1),j=_(!1),q=_(!1),u=_(!1),d=_(!1),o=_(null),c=_(null),s=_(null),v=_(null),C=ea(),{undoPayment:U}=re(),{success:L,error:R}=Ce(),x=_({fecha_cita:"",hora_inicio:"",hora_fin:"",modalidad:"",observaciones:"",estado:""}),O=he();we(()=>{const a=localStorage.getItem("modal-seccion-observaciones");E.value=a==="true"}),G(D,a=>{localStorage.setItem("modal-seccion-bono",String(a))}),G(E,a=>{localStorage.setItem("modal-seccion-observaciones",String(a))});const ne=async()=>{if(i.citaId)try{$.value=!0;const{data:a,error:t}=await O.from("citas").select(`
        *,
        paciente:pacientes(
          id,
          nombre_completo,
          email,
          telefono,
          frecuencia
        )
      `).eq("id",i.citaId).single();if(t)throw t;if(o.value=a,c.value=a.paciente,a.bono_id){const{data:h,error:A}=await O.from("bonos").select("*").eq("id",a.bono_id).single();if(!A){s.value=h;const{data:S}=await O.from("citas").select("id, fecha_cita, hora_inicio").eq("bono_id",a.bono_id).eq("sesion_descontada",!0).order("fecha_cita",{ascending:!0}).order("hora_inicio",{ascending:!0});if(S){const Q=S.findIndex(We=>We.id===i.citaId);Q!==-1&&(s.value.numero_sesion=Q+1)}}}else s.value=null;if(!a.bono_id&&a.paciente?.id){const{data:h}=await O.from("bonos").select("*").eq("paciente_id",a.paciente.id).in("estado",["activo","pendiente"]).gt("sesiones_restantes",0).order("created_at",{ascending:!1}).limit(1).maybeSingle();v.value=h}else v.value=null;x.value={fecha_cita:a.fecha_cita,hora_inicio:a.hora_inicio?.substring(0,5)||"",hora_fin:a.hora_fin?.substring(0,5)||"",modalidad:a.modalidad,observaciones:a.observaciones||"",estado:a.estado},w.value=!1,I.value=!1}catch(a){console.error("Error al cargar cita:",a)}finally{$.value=!1}};G(()=>i.citaId,a=>{a?ne():(o.value=null,c.value=null,s.value=null,v.value=null)},{immediate:!0});const Se=m(()=>{if(!o.value?.fecha_cita)return"";const a=new Date(o.value.fecha_cita+"T00:00:00"),t=new Date,h=new Date(t);return h.setDate(h.getDate()+1),a.toDateString()===t.toDateString()?"Hoy":a.toDateString()===h.toDateString()?"MaÃ±ana":a.toLocaleDateString("es-ES",{weekday:"short",day:"numeric",month:"short"})}),Pe=m(()=>{if(!o.value)return"";const a=o.value.hora_inicio?.substring(0,5)||"",t=o.value.hora_fin?.substring(0,5)||"";return`${a} - ${t}`}),$e=m(()=>{if(!o.value?.hora_inicio||!o.value?.hora_fin)return 60;const[a,t]=o.value.hora_inicio.split(":").map(Number),[h,A]=o.value.hora_fin.split(":").map(Number);return h*60+A-(a*60+t)}),Ee=m(()=>({presencial:"Presencial",virtual:"Online",telefonica:"TelefÃ³nica"})[o.value?.modalidad]||o.value?.modalidad||"-"),X=m(()=>o.value?.estado||"pendiente"),De=m(()=>({pendiente:"bg-amber-100 text-amber-700",confirmada:"bg-emerald-100 text-emerald-700",realizada:"bg-blue-100 text-blue-700",cancelada:"bg-gray-100 text-gray-500"})[X.value]||"bg-gray-100 text-gray-600"),Ie=m(()=>({pendiente:"Pendiente",confirmada:"Confirmada",realizada:"Realizada",cancelada:"Cancelada"})[X.value]||X.value),Y=m(()=>o.value?.estado_pago||"pendiente"),ie=m(()=>o.value?.estado==="pendiente"),le=m(()=>{if(!o.value)return!1;const a=o.value.estado,t=o.value.estado_pago;return(a==="confirmada"||a==="realizada")&&(t==="pendiente"||!t)}),de=m(()=>{if(!o.value)return!1;const a=o.value.estado;return a==="confirmada"||a==="pendiente"}),Me=m(()=>!s.value||o.value?.sesion_descontada||s.value.sesiones_restantes<=0?!1:o.value?.estado==="realizada"||o.value?.estado==="confirmada"),ze=m(()=>s.value||!v.value?!1:v.value.sesiones_restantes>0),g=m(()=>s.value||v.value),ee=m(()=>g.value?g.value.sesiones_totales-g.value.sesiones_restantes:0),Be=m(()=>g.value?ee.value/g.value.sesiones_totales*100:0),ce=m(()=>g.value?.fecha_fin?new Date(g.value.fecha_fin).toLocaleDateString("es-ES",{day:"numeric",month:"short"}):null),je=m(()=>{if(!g.value?.fecha_fin)return!1;const a=new Date(g.value.fecha_fin),t=new Date,h=Math.floor((a.getTime()-t.getTime())/(1e3*60*60*24));return h<=7&&h>=0}),ae=m(()=>g.value?.fecha_fin?new Date(g.value.fecha_fin)<new Date:!1),Te=m(()=>g.value?.tipo?{semanal:"Semanal",quincenal:"Quincenal",mensual:"Mensual",otro:"Personalizado"}[g.value.tipo]||g.value.tipo:"Bono"),ue=m(()=>g.value&&g.value.monto_total&&g.value.sesiones_totales?g.value.monto_total/g.value.sesiones_totales:g.value?.metadata?.precio_por_sesion?g.value.metadata.precio_por_sesion:o.value?.precio_sesion||50),Ve=m(()=>{if(!c.value?.nombre_completo)return"?";const a=c.value.nombre_completo.split(" ");return a.length>=2?(a[0][0]+a[1][0]).toUpperCase():a[0].substring(0,2).toUpperCase()}),qe=m(()=>s.value?{id:s.value.id,nombre:s.value.tipo||"Bono",sesionesRestantes:s.value.sesiones_restantes,sesionesTotales:s.value.sesiones_totales,numeroSesion:s.value.numero_sesion}:null),te=()=>{z.value=!1,w.value=!1,I.value=!1,j.value=!1,p("close")},Ae=()=>{c.value?.telefono&&window.open(`tel:${c.value.telefono}`,"_self")},Oe=()=>{z.value=!0},Fe=async()=>{if(!(!i.citaId||k.value||!ie.value)){k.value=!0;try{const{error:a}=await O.from("citas").update({estado:"confirmada",updated_at:new Date().toISOString()}).eq("id",i.citaId);if(a)throw a;o.value&&(o.value.estado="confirmada"),p("cita-actualizada"),p("actualizado")}catch(a){console.error("Error al confirmar cita:",a),R(`Error al confirmar: ${a.message}`)}finally{k.value=!1}}},Re=async()=>{if(!(!i.citaId||V.value||!de.value)){V.value=!0;try{const a={estado:"realizada",updated_at:new Date().toISOString()};(!o.value?.estado_pago||o.value.estado_pago==="pendiente")&&(a.estado_pago="pendiente");const{error:t}=await O.from("citas").update(a).eq("id",i.citaId);if(t)throw t;o.value&&(o.value.estado="realizada",a.estado_pago&&(o.value.estado_pago=a.estado_pago)),L("SesiÃ³n marcada como realizada"),p("cita-actualizada"),p("actualizado")}catch(a){console.error("Error al marcar como realizada:",a),R(`Error: ${a.message}`)}finally{V.value=!1}}},Ne=async()=>{if(!(!i.citaId||!s.value||u.value)){u.value=!0;try{const{error:a}=await O.from("citas").update({sesion_descontada:!0,descontar_de_bono:!0,updated_at:new Date().toISOString()}).eq("id",i.citaId);if(a)throw a;const t=s.value.sesiones_restantes-1,h=t<=0?"agotado":s.value.estado,{error:A}=await O.from("bonos").update({sesiones_restantes:t,estado:h,updated_at:new Date().toISOString()}).eq("id",s.value.id);if(A)throw A;o.value.sesion_descontada=!0,s.value.sesiones_restantes=t,s.value.estado=h,L("SesiÃ³n consumida del bono"),p("cita-actualizada"),p("actualizado")}catch(a){console.error("Error al consumir sesiÃ³n:",a),R(`Error: ${a.message}`)}finally{u.value=!1}}},Le=async()=>{if(!(!i.citaId||!v.value||d.value)){d.value=!0;try{const{error:a}=await O.from("citas").update({bono_id:v.value.id,descontar_de_bono:!0,updated_at:new Date().toISOString()}).eq("id",i.citaId);if(a)throw a;o.value.bono_id=v.value.id,s.value=v.value,v.value=null,L("Bono asignado a la cita"),p("cita-actualizada"),p("actualizado")}catch(a){console.error("Error al asignar bono:",a),R(`Error: ${a.message}`)}finally{d.value=!1}}},fe=()=>{c.value?.id&&(te(),C.push(`/terapeuta/pacientes/${c.value.id}/bonos`))},Ue=()=>{I.value=!1,w.value=!0},Qe=()=>{I.value=!0,w.value=!0},Ge=a=>{o.value&&(o.value.estado_pago="pagado",o.value.metodo_pago=a,o.value.fecha_pago=new Date().toISOString()),w.value=!1,I.value=!1,p("cita-actualizada"),p("actualizado")},He=()=>{w.value=!1,I.value=!1},Ze=async()=>{if(!(!i.citaId||q.value)){q.value=!0;try{const a=await U(i.citaId);a.success?(o.value&&(o.value.estado_pago="pendiente",o.value.metodo_pago=null,o.value.fecha_pago=null),L("Pago deshecho"),j.value=!1,p("cita-actualizada"),p("actualizado")):R(a.error||"Error al deshacer pago")}catch(a){console.error("Error al deshacer pago:",a),R("Error inesperado")}finally{q.value=!1}}},Ke=()=>{z.value=!1,o.value&&(x.value={fecha_cita:o.value.fecha_cita,hora_inicio:o.value.hora_inicio?.substring(0,5)||"",hora_fin:o.value.hora_fin?.substring(0,5)||"",modalidad:o.value.modalidad,observaciones:o.value.observaciones||"",estado:o.value.estado})},Je=async()=>{if(i.citaId)try{$.value=!0;const a=parseInt(x.value.hora_inicio.split(":")[0])*60+parseInt(x.value.hora_inicio.split(":")[1]);if(parseInt(x.value.hora_fin.split(":")[0])*60+parseInt(x.value.hora_fin.split(":")[1])<=a){R("La hora de fin debe ser posterior a la hora de inicio"),$.value=!1;return}const{error:h}=await O.from("citas").update({fecha_cita:x.value.fecha_cita,hora_inicio:x.value.hora_inicio+":00",hora_fin:x.value.hora_fin+":00",modalidad:x.value.modalidad,observaciones:x.value.observaciones,estado:x.value.estado,updated_at:new Date().toISOString()}).eq("id",i.citaId);if(h)throw h;z.value=!1,await ne(),L("Cambios guardados"),p("cita-actualizada"),p("actualizado")}catch(a){console.error("Error al actualizar cita:",a),R(`Error al actualizar: ${a.message}`)}finally{$.value=!1}};return G(()=>x.value.hora_inicio,a=>{if(z.value&&a){const[t,h]=a.split(":").map(Number),A=t*60+h+60,S=Math.floor(A/60),Q=A%60;x.value.hora_fin=`${String(S).padStart(2,"0")}:${String(Q).padStart(2,"0")}`}}),(a,t)=>{const h=ha,A=Ta;return r(),F(ke,{to:"body"},[P(Z,{"enter-active-class":"transition-opacity duration-200","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity duration-150","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:H(()=>[b.citaId?(r(),l("div",{key:0,class:"fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4",onClick:W(te,["self"]),role:"dialog","aria-modal":"true","aria-labelledby":"modal-title"},[P(Z,{"enter-active-class":"transition-all duration-200","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition-all duration-150","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:H(()=>[e("div",{class:"bg-white rounded-xl shadow-xl w-full max-w-[600px] max-h-[90vh] overflow-hidden flex flex-col",onClick:t[10]||(t[10]=W(()=>{},["stop"]))},[e("div",Va,[e("div",qa,[e("div",Aa,f(Ve.value),1),e("div",null,[e("h2",Oa," SesiÃ³n - "+f(c.value?.nombre_completo||"Cargando..."),1),e("span",{class:M(["text-xs font-medium px-2 py-0.5 rounded-full",De.value])},f(Ie.value),3)])]),e("button",{onClick:te,class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Cerrar modal"},[P(n(ge),{class:"w-5 h-5"})])]),$.value?(r(),l("div",Fa,[...t[11]||(t[11]=[e("div",{class:"w-8 h-8 border-2 border-gray-200 border-t-gray-600 rounded-full animate-spin"},null,-1)])])):o.value?(r(),l("div",Ra,[z.value?(r(),l("form",{key:1,onSubmit:W(Je,["prevent"]),class:"p-5 space-y-4"},[e("div",null,[t[24]||(t[24]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha",-1)),N(e("input",{"onUpdate:modelValue":t[4]||(t[4]=S=>x.value.fecha_cita=S),type:"date",required:"",class:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-gray-400"},null,512),[[K,x.value.fecha_cita]])]),e("div",Dt,[e("div",null,[t[25]||(t[25]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Inicio",-1)),N(e("input",{"onUpdate:modelValue":t[5]||(t[5]=S=>x.value.hora_inicio=S),type:"time",required:"",class:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-gray-400"},null,512),[[K,x.value.hora_inicio]])]),e("div",null,[t[26]||(t[26]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fin",-1)),N(e("input",{"onUpdate:modelValue":t[6]||(t[6]=S=>x.value.hora_fin=S),type:"time",required:"",class:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-gray-400"},null,512),[[K,x.value.hora_fin]])])]),e("div",It,[e("div",null,[t[28]||(t[28]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Modalidad",-1)),N(e("select",{"onUpdate:modelValue":t[7]||(t[7]=S=>x.value.modalidad=S),required:"",class:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-gray-400"},[...t[27]||(t[27]=[e("option",{value:"presencial"},"Presencial",-1),e("option",{value:"virtual"},"Virtual",-1),e("option",{value:"telefonica"},"TelefÃ³nica",-1)])],512),[[me,x.value.modalidad]])]),e("div",null,[t[30]||(t[30]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Estado",-1)),N(e("select",{"onUpdate:modelValue":t[8]||(t[8]=S=>x.value.estado=S),required:"",class:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-gray-400"},[...t[29]||(t[29]=[e("option",{value:"pendiente"},"Pendiente",-1),e("option",{value:"confirmada"},"Confirmada",-1),e("option",{value:"realizada"},"Realizada",-1),e("option",{value:"cancelada"},"Cancelada",-1)])],512),[[me,x.value.estado]])])]),e("div",null,[t[31]||(t[31]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Observaciones",-1)),N(e("textarea",{"onUpdate:modelValue":t[9]||(t[9]=S=>x.value.observaciones=S),rows:"3",class:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-gray-400 resize-none",placeholder:"Notas adicionales..."},null,512),[[K,x.value.observaciones]])]),e("div",Mt,[e("button",{type:"button",onClick:Ke,class:"flex-1 py-2.5 bg-gray-100 text-gray-700 font-medium rounded-lg hover:bg-gray-200 transition-colors"}," Cancelar "),e("button",{type:"submit",disabled:$.value,class:"flex-1 py-2.5 bg-gray-900 text-white font-medium rounded-lg hover:bg-gray-800 transition-colors disabled:opacity-50"},f($.value?"Guardando...":"Guardar"),9,zt)])],32)):(r(),l(_e,{key:0},[e("div",Na,[de.value?(r(),l("button",{key:0,onClick:Re,disabled:V.value,class:"flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium text-blue-700 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors disabled:opacity-50"},[P(n(J),{class:"w-4 h-4"}),T(" "+f(V.value?"Marcando...":"Marcar realizada"),1)],8,La)):y("",!0),e("button",{onClick:Oe,class:"flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors"},[P(n(oa),{class:"w-4 h-4"}),t[12]||(t[12]=T(" Editar ",-1))]),c.value?.telefono?(r(),l("button",{key:1,onClick:Ae,class:"flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors"},[P(n(sa),{class:"w-4 h-4"}),t[13]||(t[13]=T(" Llamar ",-1))])):y("",!0)]),e("div",Ua,[e("div",Qa,[e("div",Ga,[e("div",Ha,[P(n(ra),{class:"w-4 h-4 text-gray-400"}),e("span",null,f(Se.value),1)]),e("div",Za,[P(n(pe),{class:"w-4 h-4 text-gray-400"}),e("span",null,f(Pe.value),1)]),e("div",Ka,[(r(),F(oe(o.value.modalidad==="virtual"?n(ca):n(da)),{class:"w-4 h-4 text-gray-400"})),e("span",null,f(Ee.value),1)])]),e("span",Ja,f($e.value)+" min",1)])]),e("div",Wa,[P(h,{"estado-pago":Y.value,"metodo-pago":o.value.metodo_pago,"fecha-pago":o.value.fecha_pago,cantidad:ue.value,"show-actions":le.value||Y.value==="pagado",onRegistrar:Ue,onCambiar:Qe,onDeshacer:t[0]||(t[0]=S=>j.value=!0)},null,8,["estado-pago","metodo-pago","fecha-pago","cantidad","show-actions"]),Y.value==="pendiente"&&!le.value&&o.value.estado==="pendiente"?(r(),l("p",Xa," Confirma la cita primero para poder registrar el pago ")):y("",!0),j.value?(r(),l("div",Ya,[t[14]||(t[14]=e("p",{class:"text-sm text-red-800 mb-3"}," Â¿EstÃ¡s seguro de deshacer este pago? ",-1)),e("div",et,[e("button",{type:"button",class:"flex-1 px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50",disabled:q.value,onClick:t[1]||(t[1]=S=>j.value=!1)}," Cancelar ",8,at),e("button",{type:"button",class:"flex-1 px-3 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 disabled:opacity-50",disabled:q.value,onClick:Ze},f(q.value?"Deshaciendo...":"SÃ­, deshacer"),9,tt)])])):y("",!0)]),w.value?(r(),F(A,{key:0,"cita-id":o.value.id,"paciente-nombre":c.value?.nombre_completo||"Paciente",cantidad:ue.value,"tipo-transaccion":s.value?"sesion_bono":"sesion_unica","bono-info":qe.value,"hora-inicio":o.value.hora_inicio?.substring(0,5),"metodo-pago-actual":o.value.metodo_pago,"modo-edicion":I.value,onConfirm:Ge,onCancel:He},null,8,["cita-id","paciente-nombre","cantidad","tipo-transaccion","bono-info","hora-inicio","metodo-pago-actual","modo-edicion"])):y("",!0),e("div",ot,[e("button",{onClick:t[2]||(t[2]=S=>D.value=!D.value),class:M(["w-full flex items-center justify-between px-4 py-3 rounded-lg transition-colors",g.value?"bg-purple-50 hover:bg-purple-100":"bg-gray-50 hover:bg-gray-100"])},[e("div",st,[P(n(na),{class:M(["w-4 h-4",g.value?"text-purple-500":"text-gray-400"])},null,8,["class"]),e("span",{class:M(["text-sm font-medium",g.value?"text-purple-700":"text-gray-700"])},f(g.value?"Bono del paciente":"Sin bono asignado"),3),g.value?(r(),l("span",{key:0,class:M(["text-xs px-1.5 py-0.5 rounded",s.value?"bg-purple-100 text-purple-600":"bg-gray-100 text-gray-500"])},f(s.value?"Asignado":"Disponible"),3)):y("",!0)]),e("div",rt,[g.value?(r(),l("span",nt,f(ee.value)+"/"+f(g.value.sesiones_totales),1)):y("",!0),(r(),F(oe(D.value?n(xe):n(ve)),{class:"w-4 h-4 text-gray-400"}))])],2),P(Z,{"enter-active-class":"transition-all duration-200","enter-from-class":"opacity-0 max-h-0","enter-to-class":"opacity-100 max-h-96","leave-active-class":"transition-all duration-150","leave-from-class":"opacity-100 max-h-96","leave-to-class":"opacity-0 max-h-0"},{default:H(()=>[D.value?(r(),l("div",it,[g.value?(r(),l("div",lt,[e("div",dt,[e("div",null,[e("span",ct,f(Te.value),1),g.value.pagado?(r(),l("span",ut,"Pagado")):(r(),l("span",ft,"Pago pendiente"))]),ce.value?(r(),l("div",{key:0,class:M(["text-xs",ae.value?"text-red-600":je.value?"text-amber-600":"text-gray-500"])},f(ae.value?"Vencido":`Vence ${ce.value}`),3)):y("",!0)]),e("div",null,[e("div",mt,[t[15]||(t[15]=e("span",null,"Sesiones usadas",-1)),e("span",gt,f(ee.value)+" de "+f(g.value.sesiones_totales),1)]),e("div",pt,[e("div",{class:M(["h-full transition-all duration-300 rounded-full",g.value.sesiones_restantes<=1?"bg-amber-500":"bg-purple-500"]),style:aa({width:`${Be.value}%`})},null,6)])]),g.value.sesiones_restantes===1?(r(),l("div",vt,[P(n(be),{class:"w-4 h-4 text-amber-500 flex-shrink-0"}),t[16]||(t[16]=e("span",{class:"text-xs text-amber-700"},"Ãšltima sesiÃ³n disponible",-1))])):y("",!0),ae.value?(r(),l("div",bt,[P(n(be),{class:"w-4 h-4 text-red-500 flex-shrink-0"}),t[17]||(t[17]=e("span",{class:"text-xs text-red-700"},"Este bono ha vencido",-1))])):y("",!0),s.value?(r(),l("div",{key:2,class:M(["flex items-center gap-2 p-2 rounded-lg",o.value.sesion_descontada?"bg-green-50":"bg-gray-50"])},[o.value.sesion_descontada?(r(),F(n(J),{key:0,class:"w-4 h-4 text-green-500"})):(r(),F(n(pe),{key:1,class:"w-4 h-4 text-gray-400"})),e("span",{class:M(["text-xs",o.value.sesion_descontada?"text-green-700":"text-gray-600"])},f(o.value.sesion_descontada?"SesiÃ³n consumida de este bono":"SesiÃ³n pendiente de consumir"),3)],2)):y("",!0),e("div",yt,[ze.value?(r(),l("button",{key:0,onClick:Le,disabled:d.value,class:"flex-1 flex items-center justify-center gap-1.5 px-3 py-2 text-sm font-medium text-purple-700 bg-purple-50 hover:bg-purple-100 rounded-lg transition-colors disabled:opacity-50"},[P(n(ye),{class:"w-4 h-4"}),T(" "+f(d.value?"Asignando...":"Asignar a esta cita"),1)],8,xt)):y("",!0),Me.value?(r(),l("button",{key:1,onClick:Ne,disabled:u.value,class:"flex-1 flex items-center justify-center gap-1.5 px-3 py-2 text-sm font-medium text-white bg-purple-600 hover:bg-purple-700 rounded-lg transition-colors disabled:opacity-50"},[P(n(J),{class:"w-4 h-4"}),T(" "+f(u.value?"Consumiendo...":"Consumir sesiÃ³n"),1)],8,ht)):y("",!0),e("button",{onClick:fe,class:"flex items-center gap-1.5 px-3 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors"},[P(n(la),{class:"w-4 h-4"}),t[18]||(t[18]=e("span",{class:"hidden sm:inline"},"Ver detalles",-1))])])])):(r(),l("div",_t,[t[20]||(t[20]=e("p",{class:"text-sm text-gray-500 mb-3"},"Este paciente no tiene bono activo",-1)),e("button",{onClick:fe,class:"inline-flex items-center gap-1.5 px-3 py-2 text-sm font-medium text-purple-600 hover:text-purple-700 hover:bg-purple-50 rounded-lg transition-colors"},[P(n(ye),{class:"w-4 h-4"}),t[19]||(t[19]=T(" Crear bono ",-1))])]))])):y("",!0)]),_:1})]),o.value.observaciones?(r(),l("div",wt,[e("button",{onClick:t[3]||(t[3]=S=>E.value=!E.value),class:"w-full flex items-center justify-between px-4 py-3 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors"},[t[21]||(t[21]=e("span",{class:"text-sm font-medium text-gray-700"},"Observaciones",-1)),(r(),F(oe(E.value?n(xe):n(ve)),{class:"w-4 h-4 text-gray-400"}))]),P(Z,{"enter-active-class":"transition-all duration-200","enter-from-class":"opacity-0 max-h-0","enter-to-class":"opacity-100 max-h-60","leave-active-class":"transition-all duration-150","leave-from-class":"opacity-100 max-h-60","leave-to-class":"opacity-0 max-h-0"},{default:H(()=>[E.value?(r(),l("div",kt,[e("p",Ct,f(o.value.observaciones),1)])):y("",!0)]),_:1})])):y("",!0),e("div",St,[e("span",null,"ID: "+f(o.value.id.substring(0,8))+"...",1),t[22]||(t[22]=e("div",{class:"flex items-center gap-3"},[e("button",{class:"hover:text-gray-600 transition-colors"},"Ver historial"),e("span",null,"|"),e("button",{class:"hover:text-red-500 transition-colors"},"Cancelar cita")],-1))]),ie.value?(r(),l("div",Pt,[e("button",{onClick:Fe,disabled:k.value,class:"w-full py-3 bg-emerald-600 hover:bg-emerald-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 flex items-center justify-center gap-2"},[k.value?(r(),l("svg",Et,[...t[23]||(t[23]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"},null,-1)])])):(r(),F(n(J),{key:1,class:"w-5 h-5"})),T(" "+f(k.value?"Confirmando...":"Confirmar cita"),1)],8,$t)])):y("",!0)],64))])):(r(),l("div",Bt,[e("div",null,[e("div",jt,[P(n(ge),{class:"w-6 h-6 text-gray-400"})]),t[32]||(t[32]=e("p",{class:"text-gray-600 font-medium"},"No se encontraron datos",-1)),e("p",Tt,"ID: "+f(b.citaId?.substring(0,8))+"...",1)])]))])]),_:1})])):y("",!0)]),_:1})])}}}),Wt=Object.assign(ia(Vt,[["__scopeId","data-v-77666de4"]]),{__name:"ModalDetallesCita"});export{Wt as M,re as u};
