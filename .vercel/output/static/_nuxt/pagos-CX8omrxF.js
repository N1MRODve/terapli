import{_ as ie}from"./nuxt-link-BZMythwH.js";import{c,o as d,a as e,e as Y,r as k,G as re,b as u,l as s,k as X,h as N,v as te,m as K,A as I,t as i,x as S,d as T,F as R,y as Z,w as le,j as de,B as ve,p as he,g as be,D as ae,K as $e}from"#entry";import{r as G}from"./MagnifyingGlassIcon-B5My0XuL.js";import{r as z}from"./XMarkIcon-DWNj0d99.js";import{r as ye}from"./ClipboardDocumentListIcon-CSBwmCjC.js";import{r as we}from"./PlusIcon-UqRq4KLf.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as Ce}from"./ClockIcon-CQZt9cKZ.js";import{r as ce}from"./CurrencyEuroIcon-ctfYYmfn.js";import{r as W}from"./ExclamationTriangleIcon-BreoAuwB.js";import{r as se}from"./CheckCircleIcon-BzuOBYCH.js";import{r as ke}from"./CheckCircleIcon-Bi0YyG7H.js";import{r as ee}from"./ChartBarIcon-Cii-u9ml.js";import{r as ne}from"./CalendarIcon-mZ3toP8Y.js";import{r as Pe}from"./CheckBadgeIcon-CuVUaEjS.js";import{r as Ne}from"./ChevronRightIcon-Ck2OajRo.js";function Be(x,C){return d(),c("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{d:"M12 7.5a2.25 2.25 0 1 0 0 4.5 2.25 2.25 0 0 0 0-4.5Z"}),e("path",{"fill-rule":"evenodd",d:"M1.5 4.875C1.5 3.839 2.34 3 3.375 3h17.25c1.035 0 1.875.84 1.875 1.875v9.75c0 1.036-.84 1.875-1.875 1.875H3.375A1.875 1.875 0 0 1 1.5 14.625v-9.75ZM8.25 9.75a3.75 3.75 0 1 1 7.5 0 3.75 3.75 0 0 1-7.5 0ZM18.75 9a.75.75 0 0 0-.75.75v.008c0 .414.336.75.75.75h.008a.75.75 0 0 0 .75-.75V9.75a.75.75 0 0 0-.75-.75h-.008ZM4.5 9.75A.75.75 0 0 1 5.25 9h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75H5.25a.75.75 0 0 1-.75-.75V9.75Z","clip-rule":"evenodd"}),e("path",{d:"M2.25 18a.75.75 0 0 0 0 1.5c5.4 0 10.63.722 15.6 2.075 1.19.324 2.4-.558 2.4-1.82V18.75a.75.75 0 0 0-.75-.75H2.25Z"})])}const xe={class:"pagos-header"},Me={class:"header-left"},Ee={class:"header-icon"},Se={class:"header-center"},qe={class:"search-container"},De={class:"header-right"},Le={class:"header-stats"},Fe={class:"stat-value"},Ie={class:"stat-item confirmed"},Te={class:"stat-value"},Ue=Y({__name:"PagosHeader",props:{busqueda:{default:""},totalPendientes:{default:0},totalConfirmados:{default:0}},emits:["update:busqueda","registrar-pago","nueva-tarea"],setup(x,{emit:C}){const $=x,M=C,r=k($.busqueda);re(()=>$.busqueda,w=>{r.value=w});const f=()=>{M("update:busqueda",r.value)},y=()=>{r.value="",M("update:busqueda","")};return(w,_)=>(d(),c("header",xe,[e("div",Me,[e("div",Ee,[u(s(Be),{class:"w-6 h-6 text-white"})]),_[3]||(_[3]=e("div",{class:"header-text"},[e("h1",{class:"header-title"},"Pagos y Bonos"),e("p",{class:"header-subtitle"},"Gestión de cobros y seguimiento financiero")],-1))]),e("div",Se,[e("div",qe,[u(s(G),{class:"search-icon"}),X(e("input",{"onUpdate:modelValue":_[0]||(_[0]=D=>K(r)?r.value=D:null),onInput:f,type:"search",placeholder:"Buscar por paciente, bono o referencia...",class:"search-input","aria-label":"Buscar en pagos"},null,544),[[te,s(r)]]),s(r)?(d(),c("button",{key:0,onClick:y,class:"search-clear","aria-label":"Limpiar búsqueda"},[u(s(z),{class:"w-4 h-4"})])):N("",!0)])]),e("div",De,[e("div",Le,[e("div",{class:I(["stat-item",{"has-pending":x.totalPendientes>0}])},[e("span",Fe,i(x.totalPendientes),1),_[4]||(_[4]=e("span",{class:"stat-label"},"Pendientes",-1))],2),_[6]||(_[6]=e("div",{class:"stat-divider"},null,-1)),e("div",Ie,[e("span",Te,i(x.totalConfirmados),1),_[5]||(_[5]=e("span",{class:"stat-label"},"Confirmados",-1))])]),e("button",{onClick:_[1]||(_[1]=D=>M("nueva-tarea")),class:"action-btn action-btn-secondary","aria-label":"Crear nueva tarea"},[u(s(ye),{class:"w-4 h-4"}),_[7]||(_[7]=e("span",{class:"hidden sm:inline"},"Nueva tarea",-1))]),e("button",{onClick:_[2]||(_[2]=D=>M("registrar-pago")),class:"action-btn action-btn-primary","aria-label":"Registrar nuevo pago"},[u(s(we),{class:"w-4 h-4"}),_[8]||(_[8]=e("span",null,"Registrar pago",-1))])])]))}}),Ve=Object.assign(J(Ue,[["__scopeId","data-v-a8583995"]]),{__name:"PagosHeader"}),Ae={class:"pendientes-module"},He={class:"module-header"},je={class:"header-info"},Oe={class:"header-icon"},Re={class:"counter-value"},Ze={class:"metrics-grid"},Ge={class:"metric-card metric-monto"},ze={class:"metric-icon"},Xe={class:"metric-content"},Ke={class:"metric-value"},Ye={key:0,class:"metric-detail"},Je={class:"metric-icon"},Qe={class:"metric-content"},We={class:"metric-value"},es={class:"metric-card metric-confirmados"},ss={class:"metric-icon"},ts={class:"metric-content"},os={class:"metric-value"},as={key:0,class:"metric-detail"},ns={key:1,class:"metric-detail"},is={class:"filter-bar"},rs={class:"search-container"},ls={class:"urgency-filters"},ds={key:0,class:"chip-count"},cs={class:"bonos-list"},us={key:0,class:"loading-container"},ms=["onClick"],ps={class:"bono-avatar"},_s={class:"avatar-initials"},gs={class:"bono-content"},fs={class:"bono-main"},vs={class:"paciente-nombre"},hs={class:"bono-tipo"},bs={class:"bono-info-grid"},$s={class:"info-item"},ys={class:"info-value"},ws={class:"info-item"},Cs={class:"info-item"},ks={class:"sesiones-display"},Ps={class:"sesiones-total"},Ns={class:"info-item info-monto"},Bs={class:"monto-value"},xs={class:"bono-action"},Ms=["onClick","disabled"],Es={key:2,class:"empty-state empty-search"},Ss={class:"empty-icon"},qs={key:3,class:"empty-state empty-success"},Ds={class:"empty-icon success"},Ls=Y({__name:"PagosPendientesModule",props:{bonos:{},cargando:{type:Boolean,default:!1},procesandoConfirmacion:{type:Boolean,default:!1}},emits:["confirmar-pago","ver-detalle"],setup(x,{emit:C}){const $=x,M=C,r=k(""),f=k("todos"),y=S(()=>{let p=[...$.bonos];if(r.value.trim()){const t=r.value.toLowerCase().trim();p=p.filter(o=>{const a=(o.paciente_nombre||"").toLowerCase(),U=(o.terapeuta_nombre||"").toLowerCase(),O=(o.tipo_bono||"").toLowerCase();return a.includes(t)||U.includes(t)||O.includes(t)})}return f.value==="urgentes"?p=p.filter(t=>t.sesiones_restantes<=1):f.value==="normales"&&(p=p.filter(t=>t.sesiones_restantes>1)),p}),w=S(()=>$.bonos.length),_=S(()=>$.bonos.reduce((p,t)=>p+(Number(t.monto_total)||0),0)),D=S(()=>y.value.reduce((p,t)=>p+(Number(t.monto_total)||0),0)),q=S(()=>$.bonos.filter(p=>p.sesiones_restantes<=1).length),L=p=>new Intl.NumberFormat("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2}).format(p||0),F=p=>{if(!p)return"?";const t=p.split(" ");return t.length>=2?`${t[0][0]}${t[1][0]}`.toUpperCase():p.substring(0,2).toUpperCase()},b=()=>{r.value=""},H=p=>p===0?"urgencia-critica":p===1?"urgencia-alta":p===2?"urgencia-media":"urgencia-normal",j=p=>{switch(p){case"activo":return"badge-activo";case"pendiente":return"badge-pendiente";case"agotado":return"badge-agotado";default:return"badge-default"}};return(p,t)=>{const o=ie;return d(),c("section",Ae,[e("header",He,[e("div",je,[e("div",Oe,[u(s(Ce),{class:"w-6 h-6 text-white"})]),t[5]||(t[5]=e("div",{class:"header-text"},[e("h2",{class:"header-title"},"Bonos Pendientes de Confirmar"),e("p",{class:"header-subtitle"},"Pagos reportados por terapeutas que requieren confirmación")],-1))]),e("div",{class:I(["header-counter",{"has-pending":s(w)>0}])},[e("span",Re,i(s(w)),1),t[6]||(t[6]=e("span",{class:"counter-label"},"Pendientes",-1))],2)]),e("div",Ze,[e("div",Ge,[e("div",ze,[u(s(ce),{class:"w-6 h-6"})]),e("div",Xe,[t[7]||(t[7]=e("span",{class:"metric-label"},"Total por Confirmar",-1)),e("span",Ke,i(L(s(r)?s(D):s(_)))+"€",1),s(r)?(d(),c("span",Ye,"de "+i(L(s(_)))+"€",1)):N("",!0)])]),e("div",{class:I(["metric-card metric-urgentes",{"has-urgent":s(q)>0}])},[e("div",Je,[u(s(W),{class:"w-6 h-6"})]),e("div",Qe,[t[8]||(t[8]=e("span",{class:"metric-label"},"Requieren Atención",-1)),e("span",We,i(s(q)),1),t[9]||(t[9]=e("span",{class:"metric-detail"},"Pocas sesiones restantes",-1))])],2),e("div",es,[e("div",ss,[u(s(se),{class:"w-6 h-6"})]),e("div",ts,[t[10]||(t[10]=e("span",{class:"metric-label"},"Resultados",-1)),e("span",os,i(s(y).length),1),s(r)||s(f)!=="todos"?(d(),c("span",as," de "+i(s(w))+" totales ",1)):(d(),c("span",ns,"Bonos pendientes"))])])]),e("div",is,[e("div",rs,[u(s(G),{class:"search-icon"}),X(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>K(r)?r.value=a:null),type:"search",placeholder:"Buscar paciente, terapeuta o tipo de bono...",class:"search-input","aria-label":"Buscar en bonos pendientes"},null,512),[[te,s(r)]]),s(r)?(d(),c("button",{key:0,onClick:b,class:"search-clear","aria-label":"Limpiar búsqueda"},[u(s(z),{class:"w-4 h-4"})])):N("",!0)]),e("div",ls,[e("button",{onClick:t[1]||(t[1]=a=>f.value="todos"),class:I(["filter-chip",{active:s(f)==="todos"}])}," Todos ",2),e("button",{onClick:t[2]||(t[2]=a=>f.value="urgentes"),class:I(["filter-chip filter-urgente",{active:s(f)==="urgentes"}])},[u(s(W),{class:"w-3.5 h-3.5"}),t[11]||(t[11]=T(" Urgentes ",-1)),s(q)>0?(d(),c("span",ds,i(s(q)),1)):N("",!0)],2),e("button",{onClick:t[3]||(t[3]=a=>f.value="normales"),class:I(["filter-chip",{active:s(f)==="normales"}])}," Normales ",2)])]),e("div",cs,[x.cargando?(d(),c("div",us,[(d(),c(R,null,Z(3,a=>e("div",{key:a,class:"loading-skeleton"})),64))])):s(y).length>0?(d(!0),c(R,{key:1},Z(s(y),a=>(d(),c("div",{key:a.id,class:I(["bono-card",H(a.sesiones_restantes)]),onClick:U=>M("ver-detalle",a)},[t[20]||(t[20]=e("div",{class:"urgencia-indicator"},null,-1)),e("div",ps,[e("span",_s,i(F(a.paciente_nombre)),1),a.sesiones_restantes<=1?(d(),c("div",{key:0,class:I(["urgencia-badge",{critico:a.sesiones_restantes===0}])}," ! ",2)):N("",!0)]),e("div",gs,[e("div",fs,[e("h4",vs,i(a.paciente_nombre),1),e("div",hs,[t[12]||(t[12]=e("span",{class:"tipo-dot"},null,-1)),T(" "+i(a.tipo_bono||"Bono Estándar"),1)])]),e("div",bs,[e("div",$s,[t[13]||(t[13]=e("span",{class:"info-label"},"Terapeuta",-1)),e("span",ys,i(a.terapeuta_nombre||"No asignado"),1)]),e("div",ws,[t[15]||(t[15]=e("span",{class:"info-label"},"Estado",-1)),e("span",{class:I(["estado-badge",j(a.estado)])},[t[14]||(t[14]=e("span",{class:"estado-dot"},null,-1)),T(" "+i(a.estado),1)],2)]),e("div",Cs,[t[16]||(t[16]=e("span",{class:"info-label"},"Sesiones",-1)),e("div",ks,[e("span",{class:I(["sesiones-value",H(a.sesiones_restantes)])},i(a.sesiones_restantes),3),e("span",Ps,"/ "+i(a.sesiones_totales),1)]),a.sesiones_restantes<=1?(d(),c("div",{key:0,class:I(["sesiones-warning",H(a.sesiones_restantes)])},[u(s(W),{class:"w-3 h-3"}),T(" "+i(a.sesiones_restantes===0?"¡AGOTADO!":"¡ÚLTIMA!"),1)],2)):N("",!0)]),e("div",Ns,[t[17]||(t[17]=e("span",{class:"info-label"},"Monto",-1)),e("span",Bs,i(L(a.monto_total))+"€",1),t[18]||(t[18]=e("span",{class:"monto-estado"},"Por confirmar",-1))])])]),e("div",xs,[e("button",{onClick:de(U=>M("confirmar-pago",a),["stop"]),disabled:x.procesandoConfirmacion,class:"btn-confirmar","aria-label":"Confirmar pago"},[u(s(ke),{class:"w-5 h-5"}),t[19]||(t[19]=e("span",null,"Confirmar",-1))],8,Ms)])],10,ms))),128)):s(r)||s(f)!=="todos"?(d(),c("div",Es,[e("div",Ss,[u(s(G),{class:"w-12 h-12"})]),t[22]||(t[22]=e("h3",{class:"empty-title"},"No se encontraron resultados",-1)),t[23]||(t[23]=e("p",{class:"empty-description"}," No hay bonos pendientes que coincidan con tu búsqueda ",-1)),e("button",{onClick:t[4]||(t[4]=a=>{r.value="",f.value="todos"}),class:"btn-limpiar"},[u(s(z),{class:"w-4 h-4"}),t[21]||(t[21]=T(" Limpiar filtros ",-1))])])):(d(),c("div",qs,[e("div",Ds,[u(s(se),{class:"w-12 h-12"})]),t[25]||(t[25]=e("h3",{class:"empty-title"},"¡Todo al día!",-1)),t[26]||(t[26]=e("p",{class:"empty-description"}," No hay bonos pendientes de confirmar pago ",-1)),u(o,{to:"/coordinadora/pacientes",class:"btn-navegar"},{default:le(()=>[...t[24]||(t[24]=[T(" Gestionar Pacientes ",-1),e("svg",{class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])]),_:1})]))])])}}}),Fs=Object.assign(J(Ls,[["__scopeId","data-v-d50e1cf4"]]),{__name:"PagosPendientesModule"}),Is={class:"historial-module"},Ts={class:"module-header"},Us={class:"header-info"},Vs={class:"header-icon"},As={class:"mes-selector"},Hs=["value"],js={class:"metrics-grid"},Os={class:"metric-card metric-confirmados"},Rs={class:"metric-icon"},Zs={class:"metric-content"},Gs={class:"metric-value"},zs={key:0,class:"metric-detail"},Xs={class:"metric-card metric-total"},Ks={class:"metric-icon"},Ys={class:"metric-content"},Js={class:"metric-value"},Qs={key:0,class:"metric-detail"},Ws={class:"metric-card metric-promedio"},et={class:"metric-icon"},st={class:"metric-content"},tt={class:"metric-value"},ot={key:0,class:"metric-detail"},at={class:"search-bar"},nt={class:"search-container"},it={key:0,class:"search-actions"},rt={class:"search-count"},lt={class:"bonos-list"},dt={key:0,class:"loading-container"},ct=["onClick"],ut={class:"bono-avatar"},mt={class:"avatar-initials"},pt={class:"bono-content"},_t={class:"bono-main"},gt={class:"paciente-nombre"},ft={class:"bono-tipo"},vt={class:"bono-info-grid"},ht={class:"info-item"},bt={class:"info-value"},$t={class:"info-item"},yt={class:"info-value"},wt={class:"info-item"},Ct={class:"sesiones-display"},kt={class:"sesiones-value"},Pt={class:"sesiones-total"},Nt={class:"info-item info-monto"},Bt={class:"monto-value"},xt={class:"estado-confirmado"},Mt={class:"bono-arrow"},Et={key:2,class:"empty-state empty-search"},St={class:"empty-icon"},qt={class:"empty-description"},Dt={key:3,class:"empty-state empty-no-data"},Lt={class:"empty-icon"},Ft={class:"empty-description"},It=Y({__name:"PagosHistorialModule",props:{bonos:{},cargando:{type:Boolean,default:!1},mesesDisponibles:{default:()=>[]},mesSeleccionado:{default:""}},emits:["ver-detalle","cambiar-mes"],setup(x,{emit:C}){const $=x,M=C,r=k(""),f=k($.mesSeleccionado);re(()=>$.mesSeleccionado,t=>{f.value=t});const y=S(()=>{if(!r.value.trim())return $.bonos;const t=r.value.toLowerCase().trim();return $.bonos.filter(o=>{const a=(o.paciente_nombre||"").toLowerCase(),U=(o.terapeuta_nombre||"").toLowerCase(),O=(o.tipo_bono||"").toLowerCase();return a.includes(t)||U.includes(t)||O.includes(t)})}),w=S(()=>$.bonos.length),_=S(()=>$.bonos.reduce((t,o)=>t+(Number(o.monto_total)||0),0)),D=S(()=>y.value.reduce((t,o)=>t+(Number(o.monto_total)||0),0)),q=S(()=>$.bonos.length===0?0:_.value/$.bonos.length),L=S(()=>y.value.length===0?0:D.value/y.value.length),F=t=>new Intl.NumberFormat("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t||0),b=t=>t?new Date(t).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"}):"No especificada",H=t=>{if(!t)return"?";const o=t.split(" ");return o.length>=2?`${o[0][0]}${o[1][0]}`.toUpperCase():t.substring(0,2).toUpperCase()},j=()=>{r.value=""},p=()=>{M("cambiar-mes",f.value)};return(t,o)=>(d(),c("section",Is,[e("header",Ts,[e("div",Us,[e("div",Vs,[u(s(ee),{class:"w-6 h-6 text-white"})]),o[3]||(o[3]=e("div",{class:"header-text"},[e("h2",{class:"header-title"},"Historial de Pagos Confirmados"),e("p",{class:"header-subtitle"},"Bonos ya registrados y confirmados por coordinación")],-1))]),e("div",As,[u(s(ne),{class:"selector-icon"}),X(e("select",{"onUpdate:modelValue":o[0]||(o[0]=a=>K(f)?f.value=a:null),onChange:p,class:"mes-select","aria-label":"Filtrar por mes"},[o[4]||(o[4]=e("option",{value:""},"Todos los meses",-1)),(d(!0),c(R,null,Z(x.mesesDisponibles,a=>(d(),c("option",{key:a.valor,value:a.valor},i(a.nombre),9,Hs))),128))],544),[[ve,s(f)]])])]),e("div",js,[e("div",Os,[e("div",Rs,[u(s(Pe),{class:"w-6 h-6"})]),e("div",Zs,[o[5]||(o[5]=e("span",{class:"metric-label"},"Bonos Confirmados",-1)),e("span",Gs,i(s(y).length),1),s(r)?(d(),c("span",zs,"de "+i(s(w))+" total",1)):N("",!0)])]),e("div",Xs,[e("div",Ks,[u(s(ce),{class:"w-6 h-6"})]),e("div",Ys,[o[6]||(o[6]=e("span",{class:"metric-label"},"Total Confirmado",-1)),e("span",Js,i(F(s(r)?s(D):s(_)))+"€",1),s(r)?(d(),c("span",Qs,"de "+i(F(s(_)))+"€",1)):N("",!0)])]),e("div",Ws,[e("div",et,[u(s(ee),{class:"w-6 h-6"})]),e("div",st,[o[7]||(o[7]=e("span",{class:"metric-label"},"Promedio por Bono",-1)),e("span",tt,i(F(s(r)?s(L):s(q)))+"€",1),s(r)?(d(),c("span",ot,"de "+i(F(s(q)))+"€",1)):N("",!0)])])]),e("div",at,[e("div",nt,[u(s(G),{class:"search-icon"}),X(e("input",{"onUpdate:modelValue":o[1]||(o[1]=a=>K(r)?r.value=a:null),type:"search",placeholder:"Buscar paciente, terapeuta o tipo de bono...",class:"search-input","aria-label":"Buscar en historial"},null,512),[[te,s(r)]]),s(r)?(d(),c("div",it,[e("span",rt,i(s(y).length)+" resultado"+i(s(y).length!==1?"s":""),1),e("button",{onClick:j,class:"search-clear","aria-label":"Limpiar búsqueda"},[u(s(z),{class:"w-4 h-4"})])])):N("",!0)])]),e("div",lt,[x.cargando?(d(),c("div",dt,[(d(),c(R,null,Z(4,a=>e("div",{key:a,class:"loading-skeleton"})),64))])):s(y).length>0?(d(!0),c(R,{key:1},Z(s(y),a=>(d(),c("div",{key:a.id,class:"bono-card",onClick:U=>M("ver-detalle",a)},[o[15]||(o[15]=e("div",{class:"confirmado-indicator"},null,-1)),e("div",ut,[e("span",mt,i(H(a.paciente_nombre)),1),o[8]||(o[8]=e("div",{class:"confirmado-badge"},[e("svg",{class:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"3"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 13l4 4L19 7"})])],-1))]),e("div",pt,[e("div",_t,[e("h4",gt,i(a.paciente_nombre),1),e("div",ft,[o[9]||(o[9]=e("span",{class:"tipo-dot"},null,-1)),T(" "+i(a.tipo_bono||"Bono Estándar"),1)])]),e("div",vt,[e("div",ht,[o[10]||(o[10]=e("span",{class:"info-label"},"Terapeuta",-1)),e("span",bt,i(a.terapeuta_nombre||"No asignado"),1)]),e("div",$t,[o[11]||(o[11]=e("span",{class:"info-label"},"Fecha Pago",-1)),e("span",yt,i(b(a.fecha_pago)),1)]),e("div",wt,[o[12]||(o[12]=e("span",{class:"info-label"},"Sesiones",-1)),e("div",Ct,[e("span",kt,i(a.sesiones_restantes),1),e("span",Pt,"/ "+i(a.sesiones_totales),1)])]),e("div",Nt,[o[14]||(o[14]=e("span",{class:"info-label"},"Monto",-1)),e("span",Bt,i(F(a.monto_total))+"€",1),e("span",xt,[u(s(se),{class:"w-3 h-3"}),o[13]||(o[13]=T(" Confirmado ",-1))])])])]),e("div",Mt,[u(s(Ne),{class:"w-5 h-5"})])],8,ct))),128)):s(r)?(d(),c("div",Et,[e("div",St,[u(s(G),{class:"w-12 h-12"})]),o[17]||(o[17]=e("h3",{class:"empty-title"},"No se encontraron resultados",-1)),e("p",qt,' No hay pagos confirmados que coincidan con "'+i(s(r))+'" ',1),e("button",{onClick:j,class:"btn-limpiar"},[u(s(z),{class:"w-4 h-4"}),o[16]||(o[16]=T(" Limpiar búsqueda ",-1))])])):(d(),c("div",Dt,[e("div",Lt,[u(s(ee),{class:"w-12 h-12"})]),o[19]||(o[19]=e("h3",{class:"empty-title"},"Sin historial de pagos",-1)),e("p",Ft,i(s(f)?"No hay pagos confirmados en este período":"Aún no se han confirmado pagos"),1),s(f)?(d(),c("button",{key:0,onClick:o[2]||(o[2]=a=>{f.value="",p()}),class:"btn-limpiar"},[u(s(ne),{class:"w-4 h-4"}),o[18]||(o[18]=T(" Ver todos los meses ",-1))])):N("",!0)]))])]))}}),Tt=Object.assign(J(It,[["__scopeId","data-v-9a840a78"]]),{__name:"PagosHistorialModule"}),Ut={class:"pagos-page"},Vt={class:"pagos-content"},At={class:"modal-container"},Ht={class:"modal-header"},jt={class:"modal-avatar"},Ot={class:"modal-title-group"},Rt={class:"modal-title"},Zt={class:"modal-subtitle"},Gt={class:"modal-body"},zt={class:"detail-grid"},Xt={class:"detail-item"},Kt={class:"detail-value"},Yt={class:"detail-item"},Jt={class:"detail-value"},Qt={class:"detail-item"},Wt={class:"detail-value monto"},eo={key:0,class:"detail-item"},so={class:"detail-value"},to={key:1,class:"detail-item"},oo={class:"detail-value capitalize"},ao={key:2,class:"detail-item"},no={class:"detail-value capitalize"},io={class:"modal-footer"},ro=Y({__name:"pagos",setup(x){const C=he(),$=k(""),M=k(!0),r=k([]),f=k(!1),y=k(!0),w=k([]),_=k(0),D=k(0),q=k(""),L=k([]),F=k(!1),b=k(null),H=S(()=>r.value.length),j=S(()=>w.value.length),p=l=>{if(!l)return"?";const n=l.split(" ");return n.length>=2?`${n[0][0]}${n[1][0]}`.toUpperCase():l.substring(0,2).toUpperCase()},t=l=>new Intl.NumberFormat("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2}).format(l||0),o=l=>l?new Date(l).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"}):"No especificada",a=async()=>{console.log("[Pagos] Cargando bonos pendientes...");try{if(M.value=!0,!C){console.error("[Pagos] Cliente Supabase no disponible"),V("Error: Cliente de base de datos no disponible","error");return}const{data:l,error:n}=await C.from("bonos").select("*").eq("estado_pago","pendiente").in("estado",["activo","pendiente"]).order("created_at",{ascending:!1});if(n){console.error("[Pagos] Error al cargar bonos pendientes:",n),V(`Error al cargar bonos pendientes: ${n.message}`,"error");return}if(!l||l.length===0){console.log("[Pagos] No hay bonos pendientes"),r.value=[];return}const m=[...new Set(l.map(v=>v.paciente_id).filter(Boolean))];let B=new Map,E=new Map;if(m.length>0){const{data:v}=await C.from("pacientes").select("id, nombre_completo, email, terapeuta_id").in("id",m);if(v){v.forEach(h=>B.set(h.id,h));const g=[...new Set(v.map(h=>h.terapeuta_id).filter(Boolean))];if(g.length>0){const{data:h}=await C.from("terapeutas").select("id, nombre_completo").in("id",g);h&&h.forEach(P=>E.set(P.id,P))}}}r.value=l.map(v=>{const g=v.paciente_id?B.get(v.paciente_id):null,h=g?.terapeuta_id?E.get(g.terapeuta_id):null;return{id:v.id,paciente_id:v.paciente_id,paciente_nombre:g?.nombre_completo||"Sin nombre",paciente_email:g?.email||null,terapeuta_nombre:h?.nombre_completo||null,sesiones_totales:Number(v.sesiones_totales)||0,sesiones_restantes:Number(v.sesiones_restantes)||0,monto_total:Number(v.monto_total)||0,tipo_bono:v.tipo_bono||"Bono Estándar",estado:v.estado||"pendiente",created_at:v.created_at}}),console.log(`[Pagos] ${r.value.length} bonos pendientes cargados`)}catch(l){console.error("[Pagos] Error general:",l),V(`Error al cargar bonos: ${l.message}`,"error"),r.value=[]}finally{M.value=!1}},U=async()=>{console.log("[Pagos] Cargando bonos confirmados...");try{if(y.value=!0,!C){console.error("[Pagos] Cliente Supabase no disponible");return}let l=C.from("bonos").select("*").eq("estado_pago","pagado").order("fecha_pago",{ascending:!1});if(q.value){const[g,h]=q.value.split("-"),P=parseInt(g),A=parseInt(h);if(!isNaN(P)&&!isNaN(A)&&A>=1&&A<=12){const ge=new Date(P,A-1,1),fe=new Date(P,A,0,23,59,59);l=l.gte("fecha_pago",ge.toISOString()).lte("fecha_pago",fe.toISOString())}}const{data:n,error:m}=await l;if(m){console.error("[Pagos] Error al cargar bonos confirmados:",m),V(`Error al cargar historial: ${m.message}`,"error");return}if(!n||n.length===0){console.log("[Pagos] No hay bonos confirmados"),w.value=[],_.value=0,D.value=0;return}const B=[...new Set(n.map(g=>g.paciente_id).filter(Boolean))];let E=new Map,v=new Map;if(B.length>0){const{data:g}=await C.from("pacientes").select("id, nombre_completo, email, terapeuta_id").in("id",B);if(g){g.forEach(P=>E.set(P.id,P));const h=[...new Set(g.map(P=>P.terapeuta_id).filter(Boolean))];if(h.length>0){const{data:P}=await C.from("terapeutas").select("id, nombre_completo").in("id",h);P&&P.forEach(A=>v.set(A.id,A))}}}w.value=n.map(g=>{const h=g.paciente_id?E.get(g.paciente_id):null,P=h?.terapeuta_id?v.get(h.terapeuta_id):null;return{id:g.id,paciente_id:g.paciente_id,paciente_nombre:h?.nombre_completo||"Sin nombre",paciente_email:h?.email||null,terapeuta_nombre:P?.nombre_completo||null,sesiones_totales:Number(g.sesiones_totales)||0,sesiones_restantes:Number(g.sesiones_restantes)||0,monto_total:Number(g.monto_total)||0,tipo_bono:g.tipo_bono||"Bono Estándar",fecha_pago:g.fecha_pago,metodo_pago:g.metodo_pago||"No especificado"}}),_.value=w.value.reduce((g,h)=>g+h.monto_total,0),D.value=w.value.length>0?_.value/w.value.length:0,console.log(`[Pagos] ${w.value.length} bonos confirmados cargados`)}catch(l){console.error("[Pagos] Error general:",l),V(`Error al cargar historial: ${l.message}`,"error"),w.value=[]}finally{y.value=!1}},O=async()=>{console.log("[Pagos] Cargando meses disponibles...");try{if(!C)return;const{data:l,error:n}=await C.from("bonos").select("fecha_pago").eq("estado_pago","pagado").not("fecha_pago","is",null).order("fecha_pago",{ascending:!1});if(n||!l||l.length===0){L.value=[];return}const m=new Set;l.forEach(B=>{if(B.fecha_pago){const E=new Date(B.fecha_pago);if(!isNaN(E.getTime())){const v=`${E.getFullYear()}-${String(E.getMonth()+1).padStart(2,"0")}`;m.add(v)}}}),L.value=Array.from(m).sort().reverse().map(B=>{const[E,v]=B.split("-"),h=new Date(parseInt(E),parseInt(v)-1).toLocaleDateString("es-ES",{month:"long",year:"numeric"});return{valor:B,nombre:h.charAt(0).toUpperCase()+h.slice(1)}}),console.log(`[Pagos] ${L.value.length} meses disponibles`)}catch(l){console.error("[Pagos] Error al cargar meses:",l),L.value=[]}},ue=async l=>{if(!l||!l.id){V("Datos del bono inválidos","error");return}console.log("[Pagos] Confirmando pago para bono:",l.id);try{f.value=!0;const n=await $fetch("/api/pagos/confirmar",{method:"POST",body:{bonoId:l.id,metodoPago:"coordinacion"}});if(!n||!n.success)throw new Error("Respuesta inválida del servidor");console.log("[Pagos] Pago confirmado exitosamente"),await Promise.all([a(),U()]),V("Pago confirmado exitosamente","success")}catch(n){console.error("[Pagos] Error al confirmar pago:",n);let m="Error al confirmar pago";n.status===401?m="No tienes permisos para confirmar pagos":n.status===403?m="Acceso denegado":n.status===404?m="El bono no existe o ya fue confirmado":n.status===409?m="El bono ya fue confirmado":n.message&&(m=n.message),V(m,"error")}finally{f.value=!1}},oe=l=>{b.value=l,F.value=!0},Q=()=>{F.value=!1,b.value=null},me=l=>{q.value=l,U()},pe=()=>{console.log("[Pagos] Registrar pago")},_e=()=>{console.log("[Pagos] Nueva tarea")},V=(l,n="info")=>{try{const m=document.createElement("div"),B={success:"bg-emerald-600 text-white border-emerald-500",error:"bg-red-500 text-white border-red-400",warning:"bg-amber-500 text-white border-amber-400",info:"bg-neutral-800 text-white border-neutral-600"},E={success:"✓",error:"✕",warning:"⚠",info:"ℹ"};m.className=`fixed top-4 right-4 z-[100] px-5 py-3 rounded-lg shadow-xl flex items-center gap-3 transform translate-x-full transition-transform duration-300 border ${B[n]} max-w-sm`,m.innerHTML=`
      <span class="text-lg flex-shrink-0">${E[n]}</span>
      <span class="font-medium text-sm">${l}</span>
    `,document.body.appendChild(m),requestAnimationFrame(()=>{m.style.transform="translateX(0)"}),setTimeout(()=>{m.style.transform="translateX(100%)",setTimeout(()=>{m.parentNode&&document.body.removeChild(m)},300)},n==="error"?5e3:n==="warning"?4e3:3e3),m.addEventListener("click",()=>{m.style.transform="translateX(100%)",setTimeout(()=>{m.parentNode&&document.body.removeChild(m)},300)}),m.style.cursor="pointer"}catch(m){console.error("[Pagos] Error al mostrar toast:",m)}};return be(()=>{O(),U(),a()}),(l,n)=>{const m=ie;return d(),c("div",Ut,[u(Ve,{busqueda:s($),"total-pendientes":s(H),"total-confirmados":s(j),"onUpdate:busqueda":n[0]||(n[0]=B=>$.value=B),onRegistrarPago:pe,onNuevaTarea:_e},null,8,["busqueda","total-pendientes","total-confirmados"]),e("div",Vt,[u(Fs,{bonos:s(r),cargando:s(M),"procesando-confirmacion":s(f),onConfirmarPago:ue,onVerDetalle:oe},null,8,["bonos","cargando","procesando-confirmacion"]),u(Tt,{bonos:s(w),cargando:s(y),"meses-disponibles":s(L),"mes-seleccionado":s(q),onVerDetalle:oe,onCambiarMes:me},null,8,["bonos","cargando","meses-disponibles","mes-seleccionado"])]),(d(),ae($e,{to:"body"},[s(F)&&s(b)?(d(),c("div",{key:0,class:"modal-overlay",onClick:de(Q,["self"])},[e("div",At,[e("div",Ht,[e("div",jt,[e("span",null,i(p(s(b).paciente_nombre)),1)]),e("div",Ot,[e("h3",Rt,i(s(b).paciente_nombre),1),e("p",Zt,i(s(b).tipo_bono||"Bono Estándar"),1)]),e("button",{onClick:Q,class:"modal-close"},[...n[1]||(n[1]=[e("svg",{class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Gt,[e("div",zt,[e("div",Xt,[n[2]||(n[2]=e("span",{class:"detail-label"},"Terapeuta",-1)),e("span",Kt,i(s(b).terapeuta_nombre||"No asignado"),1)]),e("div",Yt,[n[3]||(n[3]=e("span",{class:"detail-label"},"Sesiones",-1)),e("span",Jt,i(s(b).sesiones_restantes)+" / "+i(s(b).sesiones_totales),1)]),e("div",Qt,[n[4]||(n[4]=e("span",{class:"detail-label"},"Monto Total",-1)),e("span",Wt,i(t(s(b).monto_total))+"€",1)]),s(b).fecha_pago?(d(),c("div",eo,[n[5]||(n[5]=e("span",{class:"detail-label"},"Fecha de Pago",-1)),e("span",so,i(o(s(b).fecha_pago)),1)])):N("",!0),s(b).metodo_pago?(d(),c("div",to,[n[6]||(n[6]=e("span",{class:"detail-label"},"Método de Pago",-1)),e("span",oo,i(s(b).metodo_pago),1)])):N("",!0),s(b).estado?(d(),c("div",ao,[n[7]||(n[7]=e("span",{class:"detail-label"},"Estado",-1)),e("span",no,i(s(b).estado),1)])):N("",!0)])]),e("div",io,[e("button",{onClick:Q,class:"btn-secondary"}," Cerrar "),s(b).paciente_id?(d(),ae(m,{key:0,to:`/coordinadora/pacientes/${s(b).paciente_id}`,class:"btn-primary"},{default:le(()=>[...n[8]||(n[8]=[T(" Ver Paciente ",-1),e("svg",{class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])]),_:1},8,["to"])):N("",!0)])])])):N("",!0)]))])}}}),Po=J(ro,[["__scopeId","data-v-688b729c"]]);export{Po as default};
