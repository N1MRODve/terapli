import{e as Q,r as S,x as D,c as n,a,b as H,h as k,k as X,v as ne,A as B,t as g,T as pe,w as ge,o as s,B as le,F as L,y as q,z as V,C as ie,j as Y,d as R,D as ae,l as ee,g as ue,E as ve,G as U,i as me,H as re,I as fe,J as be,K as ye}from"#entry";import{u as he}from"./useCitas-9Z4e1_ch.js";import{r as ke,C as de,g as xe,f as Ce,a as ce,i as we,A as $e,_ as De}from"./AgendaTerapeuta-i9eJpfA0.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as Se}from"./interval-BzLCLO6P.js";import{_ as _e}from"./ModalNuevaCita-BCs1rH3G.js";import{M as Ae}from"./ModalDetallesCita-CZ6Vzvt2.js";import"./ModalNuevaCitaEnhanced-ClfMSGs5.js";import"./usePacientes-C3tEKyu9.js";import"./CheckCircleIcon-BzuOBYCH.js";import"./FunnelIcon-BLGTimpY.js";import"./ClipboardDocumentListIcon-CSBwmCjC.js";import"./PlusIcon-UqRq4KLf.js";import"./MagnifyingGlassIcon-B5My0XuL.js";import"./XMarkIcon-DWNj0d99.js";import"./UserIcon-G1mM6o1b.js";import"./CheckCircleIcon-Bi0YyG7H.js";import"./CalendarIcon-mZ3toP8Y.js";import"./TicketIcon-DRclOuRO.js";import"./PhoneIcon-Bz5mGjHP.js";import"./ExclamationTriangleIcon-BreoAuwB.js";import"./UserGroupIcon-Byc3y-S3.js";import"./ClockIcon-CQZt9cKZ.js";import"./XCircleIcon-BaRJRhc1.js";import"./CheckBadgeIcon-CuVUaEjS.js";import"./ExclamationCircleIcon-Dyh9f5zH.js";const Ie={class:"bg-white/60 dark:bg-gray-950/60 backdrop-blur-sm border-b border-cafe/5 dark:border-gray-800 shadow-sm"},Te={class:"px-4 py-2 sm:px-6 lg:px-6 space-y-2"},Fe={class:"flex items-center gap-3"},Me={class:"flex-1 relative"},Ee={key:0,class:"px-1.5 py-0.5 bg-purple-600 text-white text-xs rounded-full"},Oe={key:0,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 pt-2"},Pe=["value"],ze=["value"],Le={class:"flex gap-2"},Ne=Q({__name:"AgendaFilters",props:{filtros:{},terapeutas:{},pacientes:{}},emits:["update:filtros","update:busqueda"],setup(c,{emit:F}){const l=c,M=F,x=S(""),O=S(!1),E=[{value:"online",label:"Online",emoji:"üíª"},{value:"presencial",label:"Presencial",emoji:"üè¢"}],C=D({get:()=>l.filtros.pacienteId||"",set:d=>A("pacienteId",d||void 0)}),b=D({get:()=>l.filtros.modalidad||"",set:d=>A("modalidad",d||void 0)}),T=D({get:()=>l.filtros.fechaDesde||"",set:d=>A("fechaDesde",d||void 0)}),m=D({get:()=>l.filtros.fechaHasta||"",set:d=>A("fechaHasta",d||void 0)}),w=D(()=>{let d=0;return C.value&&d++,b.value&&d++,(T.value||m.value)&&d++,d}),A=(d,p)=>{M("update:filtros",{...l.filtros,[d]:p})},_=()=>{x.value="",M("update:busqueda",""),M("update:filtros",{})},y=()=>{M("update:busqueda",x.value)};return(d,p)=>(s(),n("div",Ie,[a("div",Te,[a("div",Fe,[a("div",Me,[X(a("input",{"onUpdate:modelValue":p[0]||(p[0]=$=>x.value=$),onInput:y,type:"text",placeholder:"Buscar por paciente, terapeuta, notas...",class:"w-full px-3 py-1.5 pl-9 text-sm border border-cafe/20 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-300 focus:border-purple-600 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-all"},null,544),[[ne,x.value]]),p[6]||(p[6]=a("svg",{class:"absolute left-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-cafe/50 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))]),a("button",{onClick:p[1]||(p[1]=$=>O.value=!O.value),class:B(["flex items-center gap-1.5 px-3 py-1.5 text-sm border border-cafe/20 dark:border-gray-700 rounded-lg hover:bg-purple-600/10 dark:hover:bg-gray-800 hover:border-purple-600 transition-all duration-200",{"bg-purple-600/10 border-purple-600 text-purple-600":w.value>0}])},[p[7]||(p[7]=a("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})],-1)),p[8]||(p[8]=a("span",null,"Filtros",-1)),w.value>0?(s(),n("span",Ee,g(w.value),1)):k("",!0)],2),w.value>0||x.value?(s(),n("button",{key:0,onClick:_,class:"px-3 py-1.5 text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-950/30 rounded-lg transition-all duration-200"}," Limpiar ")):k("",!0)]),H(pe,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"opacity-0 -translate-y-2","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition duration-150 ease-in","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 -translate-y-2"},{default:ge(()=>[O.value?(s(),n("div",Oe,[a("div",null,[p[10]||(p[10]=a("label",{class:"block text-xs font-medium text-cafe/70 dark:text-gray-300 mb-1"}," Paciente ",-1)),X(a("select",{"onUpdate:modelValue":p[2]||(p[2]=$=>C.value=$),class:"w-full px-3 py-1.5 text-sm border border-cafe/20 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-300 focus:border-purple-600 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100"},[p[9]||(p[9]=a("option",{value:""},"Todos los pacientes",-1)),(s(!0),n(L,null,q(c.pacientes,$=>(s(),n("option",{key:$.id,value:$.id},g($.nombre),9,Pe))),128))],512),[[le,C.value]])]),a("div",null,[p[12]||(p[12]=a("label",{class:"block text-xs font-medium text-cafe/70 dark:text-gray-300 mb-1"}," Modalidad ",-1)),X(a("select",{"onUpdate:modelValue":p[3]||(p[3]=$=>b.value=$),class:"w-full px-3 py-1.5 text-sm border border-cafe/20 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-300 focus:border-purple-600 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100"},[p[11]||(p[11]=a("option",{value:""},"Todas las modalidades",-1)),(s(),n(L,null,q(E,$=>a("option",{key:$.value,value:$.value},g($.emoji)+" "+g($.label),9,ze)),64))],512),[[le,b.value]])]),a("div",null,[p[13]||(p[13]=a("label",{class:"block text-xs font-medium text-cafe/70 dark:text-gray-300 mb-1"}," Rango de fechas ",-1)),a("div",Le,[X(a("input",{"onUpdate:modelValue":p[4]||(p[4]=$=>T.value=$),type:"date",class:"flex-1 px-3 py-1.5 text-sm border border-cafe/20 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-300 focus:border-purple-600 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100"},null,512),[[ne,T.value]]),X(a("input",{"onUpdate:modelValue":p[5]||(p[5]=$=>m.value=$),type:"date",class:"flex-1 px-3 py-1.5 text-sm border border-cafe/20 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-300 focus:border-purple-600 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100"},null,512),[[ne,m.value]])])])])):k("",!0)]),_:1})])]))}}),qe=Object.assign(W(Ne,[["__scopeId","data-v-b7fec026"]]),{__name:"AgendaFilters"}),Be={class:"filter-container"},Ve={class:"filter-header"},He={key:0,class:"filter-count"},Re={class:"filter-pills"},je=["onClick"],Ue={class:"pill-label"},Ye={class:"pill-count"},Je={key:0,class:"filter-empty"},Ge=Q({__name:"AgendaLeyendaFiltrable",props:{citas:{},filtrosActivos:{default:()=>[]}},emits:["update:filtros","filtrar"],setup(c,{emit:F}){const l=c,M=F,x=S(new Set(l.filtrosActivos)),O=[{key:"pendiente",label:"Pendientes",color:"#F59E0B",bgColor:"rgba(245, 158, 11, 0.08)",bgColorActive:"rgba(245, 158, 11, 0.15)",borderColorActive:"#F59E0B"},{key:"confirmada",label:"Confirmadas",color:"#10B981",bgColor:"rgba(16, 185, 129, 0.08)",bgColorActive:"rgba(16, 185, 129, 0.15)",borderColorActive:"#10B981"},{key:"realizada",label:"Realizadas",color:"#6366F1",bgColor:"rgba(99, 102, 241, 0.08)",bgColorActive:"rgba(99, 102, 241, 0.15)",borderColorActive:"#6366F1"},{key:"cancelada",label:"Canceladas",color:"#EF4444",bgColor:"rgba(239, 68, 68, 0.08)",bgColorActive:"rgba(239, 68, 68, 0.15)",borderColorActive:"#EF4444"}],E=_=>l.citas.filter(y=>y.estado===_).length,C=D(()=>l.citas.length),b=D(()=>x.value.size===0?l.citas.length:l.citas.filter(_=>x.value.has(_.estado)).length),T=_=>{x.value.has(_)?x.value.delete(_):x.value.add(_);const y=Array.from(x.value);M("update:filtros",y),M("filtrar",y)},m=()=>{x.value.clear(),M("update:filtros",[]),M("filtrar",[])},w=_=>x.value.has(_),A=D(()=>x.value.size>0);return(_,y)=>(s(),n("div",Be,[a("div",Ve,[y[0]||(y[0]=a("span",{class:"filter-label"},"Estado",-1)),A.value?(s(),n("div",He,g(b.value)+"/"+g(C.value),1)):k("",!0),A.value?(s(),n("button",{key:1,onClick:m,class:"filter-clear"}," Limpiar ")):k("",!0)]),a("div",Re,[(s(),n(L,null,q(O,d=>a("button",{key:d.key,onClick:p=>T(d.key),class:B(["filter-pill",{active:w(d.key)}]),style:V({"--pill-color":d.color,"--pill-bg":w(d.key)?d.bgColorActive:d.bgColor,"--pill-border":w(d.key)?d.borderColorActive:"transparent"})},[a("span",{class:"pill-dot",style:V({backgroundColor:d.color})},null,4),a("span",Ue,g(d.label),1),a("span",Ye,g(E(d.key)),1)],14,je)),64))]),A.value&&b.value===0?(s(),n("div",Je,[y[1]||(y[1]=a("p",null,"No hay citas con los estados seleccionados",-1)),a("button",{onClick:m},"Ver todas")])):k("",!0)]))}}),Ke=Object.assign(W(Ge,[["__scopeId","data-v-5c8bd0ad"]]),{__name:"AgendaLeyendaFiltrable"}),Xe=["data-estado","data-compact","draggable","aria-label","title","onKeydown"],Qe={class:"hora"},We={class:"nombre"},Ze={key:0,class:"info-adicional"},ea={key:0,class:"modalidad"},aa={key:0},ta={key:1},oa={key:1,class:"area"},sa=["data-color"],na={key:3,class:"indicadores"},la={key:0,title:"Tiene notas"},ia=["title"],ra=["disabled","aria-label","title"],da={key:0,class:"w-3.5 h-3.5 animate-spin",fill:"none",viewBox:"0 0 24 24"},ca=Q({__name:"AgendaEventCard",props:{event:{},compact:{type:Boolean},draggable:{type:Boolean},confirmando:{type:Boolean}},emits:["open","menu","confirmar"],setup(c,{emit:F}){const l=c,M=F;D(()=>de[l.event.estado]||de.cancelada);const x=D(()=>`${l.event.horaInicio} ‚Äì ${l.event.horaFin}`),O=D(()=>l.event.horaInicio),E=D(()=>l.event.pacienteNombre||"Paciente sin nombre");D(()=>({pendiente:"üü°",confirmada:"üü¢",cancelada:"üî¥",completada:"‚ö™",realizada:"üîµ"})[l.event.estado]||"‚ö™");const C=D(()=>l.event.bono&&l.event.bono.sesionesRestantes!==void 0),b=D(()=>{if(!l.event.bono)return"green";const y=l.event.bono.sesionesRestantes||0;return y===0?"red":y===1?"orange":y<=2?"yellow":"green"}),T=D(()=>{const y=l.event.estado==="pendiente"?"pendiente":l.event.estado==="confirmada"?"confirmada":l.event.estado==="realizada"?"realizada":"cancelada",d=l.event.modalidad==="online"?"online":"presencial",p=l.event.terapeuta?.nombre?`, con ${l.event.terapeuta.nombre}`:"";return`Cita ${y} de ${E.value}, ${x.value}, ${d}${p}. Pulsa para ver detalles${l.event.estado==="pendiente"?" o confirmar":""}.`}),m=D(()=>l.event.estado==="pendiente"),w=()=>{M("open",l.event.id)},A=y=>{y.stopPropagation(),M("menu",l.event.id,y)},_=y=>{y.stopPropagation(),m.value&&!l.confirmando&&M("confirmar",l.event.id)};return(y,d)=>(s(),n("div",{class:B(["agenda-event group",{confirmando:c.confirmando}]),"data-estado":c.event.estado,"data-compact":c.compact,draggable:c.draggable,role:"button",tabindex:"0","aria-label":T.value,title:`${E.value} - ${x.value}. Click para ver detalles.`,onClick:w,onKeydown:[ie(w,["enter"]),ie(Y(w,["prevent"]),["space"])]},[a("div",{class:B(["flex flex-col justify-center",c.compact?"gap-0.5":"gap-1"])},[a("span",Qe,g(c.compact?O.value:x.value),1),a("span",We,[d[0]||(d[0]=a("span",{class:"estado-dot"},null,-1)),R(" "+g(E.value),1)]),c.compact?k("",!0):(s(),n("div",Ze,[c.event.modalidad?(s(),n("span",ea,[c.event.modalidad==="online"?(s(),n("span",aa,"üíª")):(s(),n("span",ta,"üè•")),R(" "+g(c.event.modalidad==="online"?"Online":"Presencial"),1)])):k("",!0),c.event.areaTerapeutica?(s(),n("span",oa,g(c.event.areaTerapeutica),1)):k("",!0),C.value?(s(),n("span",{key:2,class:"bono-info","data-color":b.value},g(c.event.bono.sesionesRestantes)+"/"+g(c.event.bono.sesionesTotales)+" sesiones ",9,sa)):k("",!0),c.event.notas||c.event.terapeuta?(s(),n("div",na,[c.event.notas?(s(),n("span",la,"üìù")):k("",!0),c.event.terapeuta?(s(),n("span",{key:1,title:`Terapeuta: ${c.event.terapeuta.nombre}`},"üë§",8,ia)):k("",!0)])):k("",!0)]))],2),!c.compact&&m.value?(s(),n("button",{key:0,onClick:_,class:B(["confirm-btn",{confirming:c.confirmando}]),disabled:c.confirmando,"aria-label":`Confirmar cita de ${E.value}`,title:c.confirmando?"Confirmando...":"Confirmar cita r√°pidamente",type:"button"},[c.confirmando?(s(),n("svg",da,[...d[1]||(d[1]=[a("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),a("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(s(),ae(ee(ke),{key:1,class:"w-3.5 h-3.5"}))],10,ra)):k("",!0),c.compact?k("",!0):(s(),n("button",{key:1,onClick:Y(A,["stop"]),class:"menu-btn","aria-label":"Abrir men√∫ de acciones",type:"button"},[...d[2]||(d[2]=[a("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[a("path",{d:"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"})],-1)])]))],42,Xe))}}),ua=Object.assign(W(ca,[["__scopeId","data-v-6a204a48"]]),{__name:"AgendaEventCard"}),va={class:"flex-1 flex flex-col overflow-hidden bg-[#FFF9F6] dark:bg-gray-900"},pa={key:0,class:"flex items-center justify-center h-full"},ga={key:1,class:"agenda-controls"},ma={key:2,class:"agenda-container"},fa={class:"texto-tiempo"},ba=["onClick"],ya={class:"hora-dia"},ha={class:"eventos-container"},ka=["data-estado","onClick"],xa={class:"hora"},Ca={class:"nombre"},wa={class:"tooltip"},$a={class:"font-semibold"},Da={key:0},Sa={key:1,class:"text-[10px] opacity-80"},_a={key:0,class:"add-slot-indicator"},Aa={key:3,class:"agenda-container"},Ia={class:"text-xs font-medium text-cafe/70"},Ta={class:"text-sm font-bold text-cafe"},Fa={class:"texto-tiempo"},Ma={class:"agenda-hours"},Ea=["onClick"],Oa=["data-estado","onClick"],Pa={class:"hora"},za={class:"nombre"},La={class:"tooltip"},Na={class:"font-semibold"},qa={key:0},Ba={key:1,class:"text-[10px] opacity-80"},Va={key:4,class:"agenda-mes-container"},Ha={class:"agenda-mes-grid"},Ra=["data-fecha","onClick"],ja={class:"agenda-dia-header"},Ua={class:"dia-numero"},Ya={class:"flex items-center gap-1"},Ja=["title"],Ga={key:1,class:"dia-hoy-badge"},Ka={class:"agenda-dia-eventos"},Xa=["onClick","title"],Qa=Q({__name:"AgendaGrid",props:{eventos:{},vista:{},fechaActual:{},cargando:{type:Boolean},draggable:{type:Boolean}},emits:["evento-click","evento-menu","slot-click","evento-drop"],setup(c,{emit:F}){const l=c,M=F;S(null);const x=S(null),O=S("0px"),E=S(!1),C=S(new Set);let b=null;const T=xe("08:00","22:30",30);D(()=>"h-8");const m=D(()=>{const r=l.fechaActual.toISOString().split("T")[0];if(l.vista==="dia")return[r];if(l.vista==="5dias")return Array.from({length:5},(i,t)=>ce(r,t));if(l.vista==="semana"){const i=we(r);return Array.from({length:7},(t,f)=>ce(i,f))}else{const i=new Date(l.fechaActual.getFullYear(),l.fechaActual.getMonth(),1),t=new Date(l.fechaActual.getFullYear(),l.fechaActual.getMonth()+1,0);let f=i.getDay();f=f===0?6:f-1;let v=t.getDay();v=v===0?6:v-1;const h=[];for(let I=f-1;I>=0;I--){const N=new Date(i);N.setDate(N.getDate()-(I+1)),h.push(N.toISOString().split("T")[0])}for(let I=new Date(i);I<=t;I.setDate(I.getDate()+1))h.push(I.toISOString().split("T")[0]);const z=6-v;for(let I=1;I<=z;I++){const N=new Date(t);N.setDate(N.getDate()+I),h.push(N.toISOString().split("T")[0])}return h}}),w=D(()=>{const r=new Map;return l.eventos.forEach(i=>{const t=i.fecha;r.has(t)||r.set(t,[]),r.get(t).push(i)}),r.forEach((i,t)=>{i.sort((f,v)=>f.horaInicio.localeCompare(v.horaInicio))}),r}),A=(r,i)=>{M("slot-click",{date:r,horaInicio:i})},_=(r,i)=>(w.value.get(r)||[]).filter(f=>f.horaInicio===i),y=r=>{const i=new Date().toISOString().split("T")[0];return r===i},d=r=>{const i=new Date(r+"T00:00:00");return i.getMonth()===l.fechaActual.getMonth()&&i.getFullYear()===l.fechaActual.getFullYear()},p=(r,i)=>{try{const t=new Date(`1970-01-01T${r}:00`),v=(new Date(`1970-01-01T${i}:00`).getTime()-t.getTime())/6e4,I=2.25/30;return`${v*I}rem`}catch{return"2.5rem"}},$=(r,i)=>{try{const t=new Date(`1970-01-01T${r}:00`),f=new Date(`1970-01-01T${i}:00`),v=(t.getTime()-f.getTime())/6e4;if(v<=0)return"0";const z=2.25/30;return`${v*z}rem`}catch{return"0"}},j=async()=>{if(await re(),!x.value||l.cargando)return;const r=new Date,i=`${String(r.getHours()).padStart(2,"0")}:${String(Math.floor(r.getMinutes()/30)*30).padStart(2,"0")}`,t=T.findIndex(f=>f>=i);if(t!==-1){const v=Math.max(0,(t-2)*40);x.value.scrollTop=v}},J=async()=>{if(await re(),l.vista!=="mes")return;const r=new Date().toISOString().split("T")[0],i=document.querySelector(".agenda-mes-grid"),t=document.querySelector(`[data-fecha="${r}"]`);t&&i&&t.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})},G=()=>{const r=new Date,i=8,t=22.5,f=r.getHours()+r.getMinutes()/60;if(f>=i&&f<=t){E.value=!0;const v=(r.getHours()-i)*60+r.getMinutes(),z=40/30,I=v*z;O.value=`${Math.round(I)}px`}else E.value=!1;te()},te=()=>{const r=new Date,i=new Set;l.eventos.forEach(t=>{try{const f=t.fecha,[v,h]=t.horaInicio.split(":").map(Number),[z,I]=t.horaFin.split(":").map(Number),N=new Date(f+"T"+t.horaInicio+":00"),oe=new Date(f+"T"+t.horaFin+":00");r>=N&&r<=oe&&i.add(t.id)}catch{}}),C.value=i},Z=r=>C.value.has(r);return ue(()=>{l.vista==="mes"?J():j(),G(),b=Se(G,6e4)}),ve(()=>{b&&(clearInterval(b),b=null)}),U([()=>l.vista,()=>l.cargando],()=>{l.cargando||setTimeout(()=>{l.vista==="mes"?J():j()},100)}),(r,i)=>(s(),n("div",va,[c.cargando?(s(),n("div",pa,[...i[0]||(i[0]=[a("div",{class:"text-center space-y-3"},[a("div",{class:"w-12 h-12 border-4 border-purple-600/20 border-t-purple-600 rounded-full animate-spin mx-auto"}),a("p",{class:"text-cafe/60 dark:text-gray-400"},"Cargando agenda...")],-1)])])):k("",!0),c.cargando?k("",!0):(s(),n("div",ga,[...i[1]||(i[1]=[me('<div class="leyenda-estados" data-v-cf723e89><div class="estado" data-v-cf723e89><span class="dot" data-color="pendiente" data-v-cf723e89></span><span data-v-cf723e89>Pendiente</span></div><div class="estado" data-v-cf723e89><span class="dot" data-color="confirmada" data-v-cf723e89></span><span data-v-cf723e89>Confirmada</span></div><div class="estado" data-v-cf723e89><span class="dot" data-color="realizada" data-v-cf723e89></span><span data-v-cf723e89>Realizada</span></div><div class="estado" data-v-cf723e89><span class="dot" data-color="cancelada" data-v-cf723e89></span><span data-v-cf723e89>Cancelada</span></div></div>',1)])])),!c.cargando&&c.vista==="dia"?(s(),n("div",ma,[a("div",{ref_key:"gridContainer",ref:x,class:"agenda-grid-dia"},[E.value?(s(),n("div",{key:0,class:"linea-tiempo-actual",style:V({top:O.value})},[i[2]||(i[2]=a("div",{class:"circulo-tiempo"},null,-1)),a("div",fa,g(new Date().toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})),1)],4)):k("",!0),(s(!0),n(L,null,q(ee(T),(t,f)=>(s(),n("div",{key:t,class:B(["agenda-cell-dia group",f%2===0?"bg-white":"bg-[#FFFAF7]"]),style:{minHeight:"2.5rem"},onClick:v=>A(m.value[0],t)},[a("div",ya,g(t),1),a("div",ha,[(s(!0),n(L,null,q(_(m.value[0],t),(v,h)=>(s(),n("div",{key:`${v.id}-${h}`,class:B(["agenda-event-dia",{"cita-activa":Z(v.id)}]),"data-estado":v.estado,style:V({"--event-height":p(v.horaInicio,v.horaFin)}),onClick:Y(z=>r.$emit("evento-click",v.id),["stop"])},[a("span",xa,g(v.horaInicio)+" - "+g(v.horaFin),1),a("span",Ca,g(v.pacienteNombre),1),a("div",wa,[a("div",$a,g(v.pacienteNombre),1),a("div",null,g(v.horaInicio)+" - "+g(v.horaFin),1),v.modalidad?(s(),n("div",Da,g(v.modalidad==="online"?"üíª Online":"üè• Presencial"),1)):k("",!0),v.areaTerapeutica?(s(),n("div",Sa,g(v.areaTerapeutica),1)):k("",!0)])],14,ka))),128)),_(m.value[0],t).length===0?(s(),n("div",_a,[...i[3]||(i[3]=[a("span",{class:"add-icon"},"+",-1),a("span",{class:"add-text"},"Nueva cita",-1)])])):k("",!0)])],10,ba))),128))],512)])):k("",!0),!c.cargando&&(c.vista==="semana"||c.vista==="5dias")?(s(),n("div",Aa,[a("div",{class:"agenda-days",style:V({gridTemplateColumns:`3rem repeat(${m.value.length}, 1fr)`})},[i[4]||(i[4]=a("div",null,null,-1)),(s(!0),n(L,null,q(m.value,t=>(s(),n("div",{key:t,class:B(["py-2 px-1",y(t)?"bg-purple-600/5 border-b-2 border-purple-600":""])},[a("div",Ia,g(ee(Ce)(t).split(",")[0]),1),a("div",Ta,g(new Date(t+"T00:00:00").getDate()),1)],2))),128))],4),a("div",{ref_key:"gridContainer",ref:x,class:"agenda-grid",style:V({gridTemplateColumns:`3rem repeat(${m.value.length}, 1fr)`})},[E.value?(s(),n("div",{key:0,class:"linea-tiempo-actual",style:V({top:O.value,left:"0",right:"0",gridColumn:"1 / -1"})},[i[5]||(i[5]=a("div",{class:"circulo-tiempo"},null,-1)),a("div",Fa,g(new Date().toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})),1)],4)):k("",!0),(s(!0),n(L,null,q(ee(T),(t,f)=>(s(),n(L,{key:t},[a("div",Ma,g(t),1),(s(!0),n(L,null,q(m.value,v=>(s(),n("div",{key:`${v}-${t}`,class:B(["agenda-cell",f%2===0?"bg-white":"bg-[#FFFAF7]"]),onClick:h=>A(v,t)},[(s(!0),n(L,null,q(_(v,t),h=>(s(),n("div",{key:h.id,class:B(["agenda-event",{"cita-activa":Z(h.id)}]),"data-estado":h.estado,style:V({"--event-height":p(h.horaInicio,h.horaFin),top:$(h.horaInicio,t)}),onClick:Y(z=>r.$emit("evento-click",h.id),["stop"])},[a("span",Pa,g(h.horaInicio)+" - "+g(h.horaFin),1),a("span",za,g(h.pacienteNombre),1),a("div",La,[a("div",Na,g(h.pacienteNombre),1),a("div",null,g(h.horaInicio)+" - "+g(h.horaFin),1),h.modalidad?(s(),n("div",qa,g(h.modalidad==="online"?"üíª Online":"üè• Presencial"),1)):k("",!0),h.areaTerapeutica?(s(),n("div",Ba,g(h.areaTerapeutica),1)):k("",!0)])],14,Oa))),128))],10,Ea))),128))],64))),128))],4)])):k("",!0),!c.cargando&&c.vista==="mes"?(s(),n("div",Va,[a("div",Ha,[(s(),n(L,null,q(["Lun","Mar","Mi√©","Jue","Vie","S√°b","Dom"],t=>a("div",{key:t,class:"agenda-mes-header"},g(t),1)),64)),(s(!0),n(L,null,q(m.value,t=>(s(),n("div",{key:t,"data-fecha":t,class:B(["agenda-dia-mes",[y(t)?"dia-hoy":"",d(t)?"":"dia-otro-mes"]]),onClick:f=>A(t,"09:00")},[a("div",ja,[a("span",Ua,g(new Date(t+"T00:00:00").getDate()),1),a("div",Ya,[(w.value.get(t)||[]).length>0?(s(),n("span",{key:0,class:"contador-citas",title:`${(w.value.get(t)||[]).length} cita${(w.value.get(t)||[]).length>1?"s":""}`},g((w.value.get(t)||[]).length),9,Ja)):k("",!0),y(t)?(s(),n("span",Ga,"Hoy")):k("",!0)])]),a("div",Ka,[(s(!0),n(L,null,q((w.value.get(t)||[]).slice(0,2),f=>(s(),ae(ua,{key:f.id,event:f,compact:!0,onOpen:v=>r.$emit("evento-click",f.id)},null,8,["event","onOpen"]))),128)),(w.value.get(t)||[]).length>2?(s(),n("button",{key:0,class:"mas-eventos",onClick:Y(f=>A(t,"09:00"),["stop"]),title:`Ver todas las ${(w.value.get(t)||[]).length} citas de este d√≠a`}," +"+g((w.value.get(t)||[]).length-2)+" m√°s ",9,Xa)):k("",!0)]),i[6]||(i[6]=a("span",{class:"add-indicator"},"+",-1))],10,Ra))),128))])])):k("",!0)]))}}),Wa=Object.assign(W(Qa,[["__scopeId","data-v-cf723e89"]]),{__name:"AgendaGrid"}),Za={class:"filter-section"},et=Q({__name:"index",props:{legacyFallback:{type:Boolean}},setup(c){const F=fe(),l=be(),{getCitasRango:M}=he(),x=S([]),O=S(!1),E=S(null),C=S("semana"),b=S(new Date),T=S(!1),m=S({}),w=S(""),A=S(!1),_=S(!1),y=S(null),d=S(null),p=S(!1),$=S({x:0,y:0}),j=S(null),J=D(()=>x.value?.length?x.value.map(e=>({id:e.cita_id||e.id,pacienteNombre:e.paciente_nombre||"Sin paciente",pacienteId:e.paciente_id,estado:e.estado,fecha:e.fecha_cita,horaInicio:e.hora_inicio?.substring(0,5)||e.hora_inicio,horaFin:e.hora_fin?.substring(0,5)||e.hora_fin,modalidad:e.modalidad,bono:e.bono_id?{id:e.bono_id,sesionesRestantes:e.bono_sesiones_restantes,sesionesTotales:e.bono_sesiones_totales}:null,terapeuta:e.terapeuta_id?{id:e.terapeuta_id,nombre:e.terapeuta_nombre}:void 0,notas:e.observaciones||void 0,areaTerapeutica:e.paciente_area||void 0,tipoSesion:e.tipo_sesion||void 0})):[]),G=D(()=>{let e=J.value;if(w.value.trim()){const o=w.value.toLowerCase();e=e.filter(u=>u.pacienteNombre.toLowerCase().includes(o)||u.terapeuta?.nombre.toLowerCase().includes(o)||u.notas?.toLowerCase().includes(o))}return m.value.estados?.length&&(e=e.filter(o=>m.value.estados.includes(o.estado))),m.value.terapeutaId&&(e=e.filter(o=>o.terapeuta?.id===m.value.terapeutaId)),m.value.pacienteId&&(e=e.filter(o=>o.pacienteId===m.value.pacienteId)),m.value.modalidad&&(e=e.filter(o=>o.modalidad===m.value.modalidad)),m.value.fechaDesde&&(e=e.filter(o=>o.fecha>=m.value.fechaDesde)),m.value.fechaHasta&&(e=e.filter(o=>o.fecha<=m.value.fechaHasta)),e}),te=D(()=>[]),Z=D(()=>{const e=new Map;return x.value?.forEach(o=>{o.paciente_id&&e.set(o.paciente_id,{id:o.paciente_id,nombre:o.paciente_nombre||"Sin nombre"})}),Array.from(e.values())}),r=async()=>{try{O.value=!0,E.value=null;const e=new Date;let o,u;if(C.value==="dia")o=u=b.value.toISOString().split("T")[0];else if(C.value==="5dias"){o=b.value.toISOString().split("T")[0];const P=new Date(b.value);P.setDate(P.getDate()+4),u=P.toISOString().split("T")[0]}else if(C.value==="semana"){const P=new Date(b.value);P.setDate(P.getDate()-P.getDay()),o=P.toISOString().split("T")[0];const K=new Date(P);K.setDate(K.getDate()+6),u=K.toISOString().split("T")[0]}else{const P=new Date(b.value.getFullYear(),b.value.getMonth(),1),K=new Date(b.value.getFullYear(),b.value.getMonth()+1,0);o=P.toISOString().split("T")[0],u=K.toISOString().split("T")[0]}const se=await M(o,u);x.value=se.filter(P=>P.estado!=="cancelada"&&P.estado!=="borrador"&&P.estado!==null)}catch(e){console.error("‚ùå Error al cargar citas:",e),E.value=e.message}finally{O.value=!1}};ue(async()=>{await r();{const e=localStorage.getItem("agenda:vista");e&&(C.value=e);const o=localStorage.getItem("agenda:darkMode");o&&(T.value=o==="true");const u=localStorage.getItem("agenda:filtros");if(u)try{m.value=JSON.parse(u)}catch(se){console.error("Error parsing saved filters",se)}T.value&&document.documentElement.classList.add("dark"),window.addEventListener("citas:actualizadas",i),console.log("‚úÖ [Agenda] Listener de eventos globales registrado")}F.query.vista&&(C.value=F.query.vista),F.query.fecha&&(b.value=new Date(F.query.fecha)),F.query.paciente&&(m.value={...m.value,pacienteId:F.query.paciente},console.log("‚úÖ [Agenda] Filtro de paciente aplicado:",F.query.paciente))}),ve(()=>{window.removeEventListener("citas:actualizadas",i),console.log("üßπ [Agenda] Listener de eventos globales removido")});function i(e){const o=e;console.log("üì° [Agenda] Evento recibido:",o.detail),r(),o.detail?.paciente_nombre&&console.log(`‚úÖ Cita actualizada: ${o.detail.paciente_nombre}`)}U(C,e=>{localStorage.setItem("agenda:vista",e),l.push({query:{...F.query,vista:e}}),r()}),U(b,()=>{r()}),U(b,e=>{{const o=e.toISOString().split("T")[0];l.push({query:{...F.query,fecha:o}})}}),U(T,e=>{localStorage.setItem("agenda:darkMode",String(e)),e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}),U(m,e=>{localStorage.setItem("agenda:filtros",JSON.stringify(e))},{deep:!0});const t=()=>{d.value=null,A.value=!0},f=e=>{if(G.value.some(u=>u.fecha===e.date&&u.horaInicio===e.horaInicio)){{const u=document.createElement("div");u.className="fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-[9999] animate-slide-in",u.innerHTML=`
        <div class="flex items-center gap-3">
          <span class="text-2xl">‚ö†Ô∏è</span>
          <div>
            <div class="font-semibold">Horario ocupado</div>
            <div class="text-sm opacity-90">Ya existe una cita en este horario</div>
          </div>
        </div>
      `,document.body.appendChild(u),setTimeout(()=>{u.classList.add("animate-fade-out"),setTimeout(()=>u.remove(),300)},3e3)}return}d.value=e,A.value=!0},v=e=>{y.value=e,_.value=!0},h=(e,o)=>{j.value=e,$.value={x:o.clientX,y:o.clientY},p.value=!0},z=()=>{p.value=!1,j.value=null},I=async(e,o)=>{try{console.log("Reprogramar cita:",e,o),await r()}catch(u){console.error("Error al reprogramar cita:",u),alert("No se pudo reprogramar la cita. Intenta nuevamente.")}};document.addEventListener("click",()=>{p.value&&z()});const N=()=>{const e=new Date(b.value);switch(C.value){case"dia":e.setDate(e.getDate()-1);break;case"5dias":e.setDate(e.getDate()-5);break;case"semana":e.setDate(e.getDate()-7);break;case"mes":e.setMonth(e.getMonth()-1);break}b.value=e},oe=()=>{const e=new Date(b.value);switch(C.value){case"dia":e.setDate(e.getDate()+1);break;case"5dias":e.setDate(e.getDate()+5);break;case"semana":e.setDate(e.getDate()+7);break;case"mes":e.setMonth(e.getMonth()+1);break}b.value=e};return document.addEventListener("keydown",e=>{if(!(e.target.tagName==="INPUT"||e.target.tagName==="TEXTAREA"))switch(e.key){case"ArrowLeft":case"j":N();break;case"ArrowRight":case"k":oe();break;case"t":b.value=new Date;break;case"1":C.value="dia";break;case"2":C.value="semana";break;case"3":C.value="mes";break;case"4":C.value="5dias";break;case"n":t();break;case"f":e.preventDefault(),document.querySelector('input[type="text"]')?.focus();break}}),(e,o)=>(s(),n("div",null,[c.legacyFallback?(s(),ae(De,{key:0})):(s(),n("div",{key:1,class:B(["agenda-main-container",{dark:T.value}])},[H($e,{vista:C.value,"onUpdate:vista":o[0]||(o[0]=u=>C.value=u),fechaActual:b.value,"onUpdate:fechaActual":o[1]||(o[1]=u=>b.value=u),darkMode:T.value,"onUpdate:darkMode":o[2]||(o[2]=u=>T.value=u),onNuevaCita:t},null,8,["vista","fechaActual","darkMode"]),H(qe,{filtros:m.value,"onUpdate:filtros":o[3]||(o[3]=u=>m.value=u),"onUpdate:busqueda":o[4]||(o[4]=u=>w.value=u),terapeutas:te.value,pacientes:Z.value},null,8,["filtros","terapeutas","pacientes"]),a("div",Za,[H(Ke,{citas:J.value,"filtros-activos":m.value.estados||[],onFiltrar:o[5]||(o[5]=u=>{m.value.estados=u.length>0?u:void 0})},null,8,["citas","filtros-activos"])]),H(Wa,{eventos:G.value,vista:C.value,fechaActual:b.value,cargando:O.value,draggable:!0,onEventoClick:v,onEventoMenu:h,onSlotClick:f,onEventoDrop:I},null,8,["eventos","vista","fechaActual","cargando"]),H(_e,{modelValue:A.value,"onUpdate:modelValue":o[6]||(o[6]=u=>A.value=u),"fecha-preseleccionada":d.value?.date,"hora-preseleccionada":d.value?.horaInicio,onCitaCreada:r,onCerrar:o[7]||(o[7]=u=>{A.value=!1,d.value=null})},null,8,["modelValue","fecha-preseleccionada","hora-preseleccionada"]),H(Ae,{isOpen:_.value,citaId:y.value,onClose:o[8]||(o[8]=u=>{_.value=!1,y.value=null}),onActualizado:r,onEliminado:r},null,8,["isOpen","citaId"]),(s(),ae(ye,{to:"body"},[p.value?(s(),n("div",{key:0,style:V({top:`${$.value.y}px`,left:`${$.value.x}px`}),class:"fixed z-50 bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-700 rounded-lg shadow-lg py-1 min-w-[180px]",onClick:o[12]||(o[12]=Y(()=>{},["stop"]))},[a("button",{onClick:o[9]||(o[9]=u=>{v(j.value),z()}),class:"w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-800 transition"}," Ver detalles "),a("button",{onClick:o[10]||(o[10]=u=>z()),class:"w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-800 transition"}," Reprogramar "),a("button",{onClick:o[11]||(o[11]=u=>z()),class:"w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-800 transition text-red-600"}," Cancelar cita ")],4)):k("",!0)])),o[13]||(o[13]=a("div",{class:"fixed bottom-4 right-4 bg-gray-900/90 dark:bg-gray-100/90 text-white dark:text-gray-900 px-3 py-2 rounded-lg text-xs opacity-0 hover:opacity-100 transition-opacity"},[a("kbd",null,"‚Üê/‚Üí"),R(" navegar ¬∑ "),a("kbd",null,"t"),R(" hoy ¬∑ "),a("kbd",null,"1/2/3/4"),R(" vistas ¬∑ "),a("kbd",null,"n"),R(" nueva ¬∑ "),a("kbd",null,"f"),R(" buscar ")],-1))],2))]))}}),_t=W(et,[["__scopeId","data-v-20bc017e"]]);export{_t as default};
