import{e as T,q as A,z as v,r as k,I as B,c as b,j as x,a as e,t as l,k as s,l as M,m as i,d as r,K as S,v as p,h as O,Y as P,n as _,af as C,o as g}from"#entry";import{u as R}from"./useBonos-BSiCGD07.js";const H={class:"bg-white/95 backdrop-blur-md rounded-3xl shadow-2xl border border-white/50 max-w-3xl w-full max-h-[90vh] overflow-hidden relative"},Y={class:"relative max-h-[90vh] overflow-y-auto"},G={class:"sticky top-0 bg-white/90 backdrop-blur-md border-b border-gray-200/50 px-8 py-6 flex justify-between items-center z-10"},Q={class:"flex items-center gap-4"},K={class:"text-3xl font-['Elms_Sans'] font-bold bg-gradient-to-r from-[#5550F2] to-[#027368] bg-clip-text text-transparent"},L={class:"text-sm font-sans text-gray-600 mt-1"},J={class:"grid grid-cols-2 gap-6"},W={class:"grid grid-cols-2 gap-4"},X=["max"],Z={key:0,class:"flex items-center gap-2 p-3 bg-blue-50 border border-blue-200 rounded-lg"},$={class:"text-sm text-blue-800"},ee={class:"relative"},oe={class:"grid grid-cols-2 gap-4"},te=["min"],se={class:"flex items-start gap-3 p-4 bg-purple-50 border border-purple-200 rounded-lg"},ne={class:"grid grid-cols-2 gap-3"},ae={key:1,class:"p-4 bg-gradient-to-r from-[#5550F2]/10 to-[#ECC8BA]/10 rounded-lg border border-[#5550F2]/30"},le={class:"grid grid-cols-2 gap-3 text-sm"},ie={class:"font-medium text-[#2D3748] ml-1 capitalize"},re={class:"font-medium text-[#2D3748] ml-1 capitalize"},de={class:"font-medium text-[#2D3748] ml-1"},ue={class:"font-medium text-[#2D3748] ml-1"},me={class:"font-medium text-[#2D3748] ml-1"},ce={key:2,class:"p-4 bg-red-50 border border-red-200 rounded-lg"},pe={class:"text-sm text-red-700 flex items-center gap-2"},ve={class:"flex gap-3 pt-4 border-t border-[#5550F2]/30"},fe=["disabled"],be=["disabled"],xe=T({__name:"ModalNuevoBono",props:{mostrar:{type:Boolean},pacienteId:{},pacienteNombre:{},psicologaId:{},bonoExistente:{}},emits:["close","created","updated"],setup(w,{emit:V}){const d=w,f=V,{crearBono:E,actualizarBono:I}=R(),{userProfile:U}=A(),u=v(()=>!!d.bonoExistente),t=k({tipo:"mensual",frecuencia:"semanal",sesiones_totales:4,sesiones_usadas:0,monto:0,fecha_inicio:new Date().toISOString().split("T")[0],fecha_fin:"",estado:"pendiente",renovacion_automatica:!1,notas:""});B(()=>d.bonoExistente,a=>{a&&(t.value={tipo:a.tipo||"mensual",frecuencia:a.frecuencia||"semanal",sesiones_totales:a.sesiones_totales||4,sesiones_usadas:a.sesiones_usadas||0,monto:a.monto_total||0,fecha_inicio:a.fecha_inicio||new Date().toISOString().split("T")[0],fecha_fin:a.fecha_fin||"",estado:a.estado||"pendiente",renovacion_automatica:a.renovacion_automatica||!1,notas:a.notas||""})},{immediate:!0});const m=k(!1),c=k(""),z=v(()=>t.value.tipo&&t.value.sesiones_totales&&t.value.monto),N=v(()=>!t.value.sesiones_totales||!t.value.monto?"0.00":(t.value.monto/t.value.sesiones_totales).toFixed(2)),F=v(()=>Math.max(0,t.value.sesiones_totales-(t.value.sesiones_usadas||0))),h=v(()=>!!(t.value.tipo&&t.value.frecuencia&&t.value.sesiones_totales>0&&t.value.monto>0&&t.value.estado)),y=()=>{m.value||(c.value="",f("close"))},j=async()=>{if(!h.value){c.value="Por favor completa todos los campos requeridos";return}try{m.value=!0,c.value="";const a=t.value.sesiones_usadas||0,o=t.value.sesiones_totales-a,n={tipo:t.value.tipo,frecuencia:t.value.frecuencia,sesiones_totales:t.value.sesiones_totales,sesiones_usadas:a,sesiones_restantes:o,fecha_inicio:t.value.fecha_inicio||null,fecha_fin:t.value.fecha_fin||null,estado:o<=0?"agotado":t.value.estado,monto_total:t.value.monto,pagado:t.value.estado==="activo",renovacion_automatica:t.value.renovacion_automatica,notas:t.value.notas||null};if(u.value&&d.bonoExistente?.id){const D=await I(d.bonoExistente.id,n);f("updated",D)}else{const D={...n,paciente_id:d.pacienteId,terapeuta_id:d.psicologaId||U.value?.id},q=await E(D);f("created",q)}f("close"),u.value||(t.value={tipo:"mensual",frecuencia:"semanal",sesiones_totales:4,sesiones_usadas:0,monto:0,fecha_inicio:new Date().toISOString().split("T")[0],fecha_fin:"",estado:"pendiente",renovacion_automatica:!1,notas:""})}catch(a){console.error("[ModalNuevoBono] Error al crear bono:",a),c.value=a.message||"Error al crear el bono. Int√©ntalo de nuevo."}finally{m.value=!1}};return B(()=>t.value.tipo,a=>{if(t.value.fecha_inicio&&a){const o=new Date(t.value.fecha_inicio);let n=new Date(o);switch(a){case"quincenal":n.setDate(n.getDate()+15);break;case"mensual":n.setMonth(n.getMonth()+1);break;case"semestral":n.setMonth(n.getMonth()+6);break}t.value.fecha_fin=n?.toISOString().split("T")[0]||""}}),(a,o)=>w.mostrar?(g(),b("div",{key:0,class:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:M(y,["self"])},[e("div",H,[o[40]||(o[40]=e("div",{class:"absolute inset-0 bg-gradient-to-br from-[#5550F2]/5 via-transparent to-[#04BF9D]/5 pointer-events-none"},null,-1)),o[41]||(o[41]=e("div",{class:"absolute -top-20 -right-20 w-40 h-40 bg-gradient-to-br from-[#F2B33D]/20 to-[#5550F2]/20 rounded-full blur-2xl"},null,-1)),e("div",Y,[e("div",G,[e("div",Q,[o[11]||(o[11]=e("div",{class:"w-14 h-14 rounded-2xl bg-gradient-to-br from-[#5550F2] to-[#027368] shadow-lg flex items-center justify-center"},[e("svg",{class:"w-7 h-7 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"})])],-1)),e("div",null,[e("h2",K,l(s(u)?"Editar Bono":"Nuevo Bono"),1),e("p",L,l(s(u)?"Modifica los datos del bono de":"Crea un nuevo bono para")+" "+l(w.pacienteNombre),1)])]),e("button",{onClick:y,class:"p-3 text-gray-500 hover:text-[#5550F2] hover:bg-gradient-to-br from-[#5550F2]/10 to-[#027368]/10 rounded-2xl transition-all duration-300 backdrop-blur-sm border border-white/50 hover:shadow-lg","aria-label":"Cerrar modal"},[...o[12]||(o[12]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("form",{onSubmit:M(j,["prevent"]),class:"px-8 py-8 space-y-8"},[e("div",J,[e("div",null,[o[14]||(o[14]=e("label",{class:"block text-sm font-sans font-semibold text-gray-700 mb-3"},[r(" Tipo de Bono "),e("span",{class:"text-[#F2B33D]"},"*")],-1)),i(e("select",{"onUpdate:modelValue":o[0]||(o[0]=n=>s(t).tipo=n),required:"",class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#5550F2]/20 focus:border-[#5550F2] bg-white/80 backdrop-blur-sm transition-all duration-300 font-sans hover:bg-white shadow-sm hover:shadow-md"},[...o[13]||(o[13]=[e("option",{value:""},"Seleccionar tipo",-1),e("option",{value:"quincenal"},"Quincenal",-1),e("option",{value:"mensual"},"Mensual",-1),e("option",{value:"semestral"},"Semestral",-1)])],512),[[S,s(t).tipo]])]),e("div",null,[o[16]||(o[16]=e("label",{class:"block text-sm font-medium text-[#2D3748] mb-2"},[r(" Frecuencia Sugerida "),e("span",{class:"text-red-500"},"*")],-1)),i(e("select",{"onUpdate:modelValue":o[1]||(o[1]=n=>s(t).frecuencia=n),required:"",class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#5550F2] bg-white"},[...o[15]||(o[15]=[e("option",{value:""},"Seleccionar frecuencia",-1),e("option",{value:"semanal"},"Semanal",-1),e("option",{value:"quincenal"},"Quincenal",-1),e("option",{value:"mensual"},"Mensual",-1)])],512),[[S,s(t).frecuencia]])])]),e("div",W,[e("div",null,[o[17]||(o[17]=e("label",{class:"block text-sm font-medium text-[#2D3748] mb-2"},[r(" Sesiones Totales "),e("span",{class:"text-red-500"},"*")],-1)),i(e("input",{"onUpdate:modelValue":o[2]||(o[2]=n=>s(t).sesiones_totales=n),type:"number",min:"1",max:"100",required:"",placeholder:"Ej: 4, 8, 12...",class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#5550F2]"},null,512),[[p,s(t).sesiones_totales,void 0,{number:!0}]]),o[18]||(o[18]=e("p",{class:"text-xs text-[#2D3748]/60 mt-1"}," Sesiones incluidas en el bono ",-1))]),e("div",null,[o[19]||(o[19]=e("label",{class:"block text-sm font-medium text-[#2D3748] mb-2"}," Sesiones Ya Usadas ",-1)),i(e("input",{"onUpdate:modelValue":o[3]||(o[3]=n=>s(t).sesiones_usadas=n),type:"number",min:"0",max:s(t).sesiones_totales-1,placeholder:"0",class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#5550F2]"},null,8,X),[[p,s(t).sesiones_usadas,void 0,{number:!0}]]),o[20]||(o[20]=e("p",{class:"text-xs text-[#2D3748]/60 mt-1"}," Para migraci√≥n desde otra plataforma ",-1))])]),s(t).sesiones_usadas>0?(g(),b("div",Z,[o[21]||(o[21]=e("span",{class:"text-blue-600"},"‚ÑπÔ∏è",-1)),e("p",$,[e("strong",null,l(s(F)),1),r(" de "+l(s(t).sesiones_totales)+" sesiones disponibles ("+l(s(t).sesiones_usadas)+" ya consumidas) ",1)])])):x("",!0),e("div",null,[o[23]||(o[23]=e("label",{class:"block text-sm font-medium text-[#2D3748] mb-2"},[r(" Monto Total "),e("span",{class:"text-red-500"},"*")],-1)),e("div",ee,[o[22]||(o[22]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-[#2D3748]/60"},"‚Ç¨",-1)),i(e("input",{"onUpdate:modelValue":o[4]||(o[4]=n=>s(t).monto=n),type:"number",min:"0",step:"0.01",required:"",placeholder:"0.00",class:"w-full pl-8 pr-4 py-2 border border-[#5550F2]/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#5550F2]"},null,512),[[p,s(t).monto,void 0,{number:!0}]])]),o[24]||(o[24]=e("p",{class:"text-xs text-[#2D3748]/60 mt-1"}," Precio total del bono (todas las sesiones) ",-1))]),e("div",oe,[e("div",null,[o[25]||(o[25]=e("label",{class:"block text-sm font-medium text-[#2D3748] mb-2"}," Fecha de Inicio ",-1)),i(e("input",{"onUpdate:modelValue":o[5]||(o[5]=n=>s(t).fecha_inicio=n),type:"date",class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#5550F2]"},null,512),[[p,s(t).fecha_inicio]])]),e("div",null,[o[26]||(o[26]=e("label",{class:"block text-sm font-medium text-[#2D3748] mb-2"}," Fecha de Vencimiento ",-1)),i(e("input",{"onUpdate:modelValue":o[6]||(o[6]=n=>s(t).fecha_fin=n),type:"date",min:s(t).fecha_inicio,class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#5550F2]"},null,8,te),[[p,s(t).fecha_fin]])])]),e("div",se,[i(e("input",{"onUpdate:modelValue":o[7]||(o[7]=n=>s(t).renovacion_automatica=n),type:"checkbox",id:"renovacion-auto",class:"mt-1 w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500"},null,512),[[P,s(t).renovacion_automatica]]),o[27]||(o[27]=O('<label for="renovacion-auto" class="flex-1 cursor-pointer"><div class="text-sm font-medium text-purple-900 flex items-center gap-1.5"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> Renovaci√≥n Autom√°tica </div><div class="text-xs text-purple-700 mt-1"> El bono se renovar√° autom√°ticamente cuando se complete o venza </div></label>',1))]),e("div",null,[o[30]||(o[30]=e("label",{class:"block text-sm font-medium text-[#2D3748] mb-2"}," Estado Inicial ",-1)),e("div",ne,[e("label",{class:_(["flex items-center gap-2 p-3 border-2 rounded-lg cursor-pointer transition-all",s(t).estado==="pendiente"?"border-yellow-400 bg-yellow-50":"border-gray-300 hover:border-yellow-300"])},[i(e("input",{"onUpdate:modelValue":o[8]||(o[8]=n=>s(t).estado=n),type:"radio",value:"pendiente",class:"w-4 h-4 text-yellow-600"},null,512),[[C,s(t).estado]]),o[28]||(o[28]=e("div",null,[e("div",{class:"text-sm font-medium text-[#2D3748]"},"‚è≥ Pendiente"),e("div",{class:"text-xs text-[#2D3748]/60"},"Requiere pago")],-1))],2),e("label",{class:_(["flex items-center gap-2 p-3 border-2 rounded-lg cursor-pointer transition-all",s(t).estado==="activo"?"border-green-400 bg-green-50":"border-gray-300 hover:border-green-300"])},[i(e("input",{"onUpdate:modelValue":o[9]||(o[9]=n=>s(t).estado=n),type:"radio",value:"activo",class:"w-4 h-4 text-green-600"},null,512),[[C,s(t).estado]]),o[29]||(o[29]=e("div",null,[e("div",{class:"text-sm font-medium text-[#2D3748]"},"‚úÖ Activo"),e("div",{class:"text-xs text-[#2D3748]/60"},"Ya pagado")],-1))],2)])]),e("div",null,[o[31]||(o[31]=e("label",{class:"block text-sm font-medium text-[#2D3748] mb-2"}," Notas (Opcional) ",-1)),i(e("textarea",{"onUpdate:modelValue":o[10]||(o[10]=n=>s(t).notas=n),rows:"3",placeholder:"Informaci√≥n adicional sobre el bono...",class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#5550F2] resize-none"},null,512),[[p,s(t).notas]])]),s(z)?(g(),b("div",ae,[o[38]||(o[38]=e("div",{class:"font-medium text-[#2D3748] mb-3 flex items-center gap-2"},[e("span",null,"üìã"),r(" Resumen del Bono ")],-1)),e("div",le,[e("div",null,[o[32]||(o[32]=e("span",{class:"text-[#2D3748]/60"},"Tipo:",-1)),e("span",ie,l(s(t).tipo||"-"),1)]),e("div",null,[o[33]||(o[33]=e("span",{class:"text-[#2D3748]/60"},"Frecuencia:",-1)),e("span",re,l(s(t).frecuencia||"-"),1)]),e("div",null,[o[34]||(o[34]=e("span",{class:"text-[#2D3748]/60"},"Sesiones:",-1)),e("span",de,l(s(F))+"/"+l(s(t).sesiones_totales||0),1)]),e("div",null,[o[35]||(o[35]=e("span",{class:"text-[#2D3748]/60"},"Monto:",-1)),e("span",ue,"‚Ç¨"+l(s(t).monto||0),1)]),e("div",null,[o[36]||(o[36]=e("span",{class:"text-[#2D3748]/60"},"Precio/sesi√≥n:",-1)),e("span",me,"‚Ç¨"+l(s(N)),1)]),e("div",null,[o[37]||(o[37]=e("span",{class:"text-[#2D3748]/60"},"Estado:",-1)),e("span",{class:_(["font-medium capitalize ml-1",s(t).estado==="activo"?"text-green-600":"text-yellow-600"])},l(s(t).estado||"-"),3)])])])):x("",!0),s(c)?(g(),b("div",ce,[e("p",pe,[o[39]||(o[39]=e("span",null,"‚ùå",-1)),r(" "+l(s(c)),1)])])):x("",!0),e("div",ve,[e("button",{type:"button",onClick:y,class:"flex-1 px-6 py-3 bg-white border border-[#5550F2]/30 text-[#2D3748] rounded-lg hover:bg-[#5550F2]/10 transition-colors font-medium",disabled:s(m)}," Cancelar ",8,fe),e("button",{type:"submit",class:"flex-1 px-6 py-3 bg-[#5550F2] text-white rounded-lg hover:bg-[#C89B8A] transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",disabled:s(m)||!s(h)},l(s(m)?s(u)?"Guardando...":"Creando...":s(u)?"Guardar Cambios":"Crear Bono"),9,be)])],32)])])])):x("",!0)}}),ye=Object.assign(xe,{__name:"ModalNuevoBono"});export{ye as _};
