import{c as n,o as s,a as e,x as A,h as P,l as t,j as ae,z as Ae,t as u,A as G,b as M,f as Ee,L as Ge,r as V,G as ne,k as H,d as B,v as oe,B as pe,i as De,F as J,y as K,Y as me,e as _e,p as Qe,D as re,K as Ve,w as Be,ag as xt,m as de,T as Je,M as ht,ah as Ie,J as yt,g as _t,C as wt}from"#entry";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as He}from"./CalendarIcon-mZ3toP8Y.js";import{r as kt}from"./ClockIcon-CQZt9cKZ.js";import{r as ie}from"./CheckCircleIcon-Bi0YyG7H.js";import{r as $t}from"./TicketIcon-DRclOuRO.js";import{r as Ct}from"./CurrencyDollarIcon-Dge-tWFD.js";import{r as Dt}from"./ChartBarIcon-Cii-u9ml.js";import{r as xe}from"./ExclamationTriangleIcon-BreoAuwB.js";import{r as be}from"./ExclamationCircleIcon-Dyh9f5zH.js";import{r as Et}from"./BellAlertIcon-D9Txc_Yy.js";import{_ as St}from"./ModalNuevaCita-BCs1rH3G.js";import{u as Ke}from"./useBonos-hPQtqGw0.js";import{u as Xe}from"./useCitas-9Z4e1_ch.js";import{r as qe}from"./PhoneIcon-Bz5mGjHP.js";import{r as Se}from"./XMarkIcon-DWNj0d99.js";import{r as je,a as Ye}from"./ArrowUpTrayIcon-B3QIYE34.js";import{r as ye}from"./XCircleIcon-BaRJRhc1.js";import{r as Ft}from"./EyeIcon-BKE9UY2T.js";import{r as Mt}from"./MagnifyingGlassIcon-B5My0XuL.js";import{r as Te}from"./CalendarDaysIcon-C0vq0F4x.js";import{r as Pt}from"./ClipboardDocumentListIcon-CSBwmCjC.js";import{r as At}from"./UserGroupIcon-Byc3y-S3.js";import"./UserIcon-G1mM6o1b.js";import"./CheckBadgeIcon-CuVUaEjS.js";function It(S,D){return s(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75"})])}function Tt(S,D){return s(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M11.35 3.836c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m8.9-4.414c.376.023.75.05 1.124.08 1.131.094 1.976 1.057 1.976 2.192V16.5A2.25 2.25 0 0 1 18 18.75h-2.25m-7.5-10.5H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V18.75m-7.5-10.5h6.375c.621 0 1.125.504 1.125 1.125v9.375m-8.25-3 1.5 1.5 3-3.75"})])}function Vt(S,D){return s(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m.75 12 3 3m0 0 3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})])}function Bt(S,D){return s(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3.75 9.776c.112-.017.227-.026.344-.026h15.812c.117 0 .232.009.344.026m-16.5 0a2.25 2.25 0 0 0-1.883 2.542l.857 6a2.25 2.25 0 0 0 2.227 1.932H19.05a2.25 2.25 0 0 0 2.227-1.932l.857-6a2.25 2.25 0 0 0-1.883-2.542m-16.5 0V6A2.25 2.25 0 0 1 6 3.75h3.879a1.5 1.5 0 0 1 1.06.44l2.122 2.12a1.5 1.5 0 0 0 1.06.44H18A2.25 2.25 0 0 1 20.25 9v.776"})])}const qt=["aria-label"],jt={class:"absolute top-4 right-4 flex gap-1.5 opacity-0 group-hover:opacity-100 group-focus-within:opacity-100 transition-all duration-200 z-10",role:"toolbar","aria-label":"Acciones del paciente"},zt=["aria-label"],Rt=["aria-label"],Ut=["aria-label"],Ot={class:"flex items-start justify-between mb-5"},Nt={class:"flex items-center gap-3 flex-1"},Lt=["aria-label"],Ht={class:"flex-1 min-w-0"},Gt={class:"font-serif text-lg font-semibold text-cafe group-hover:text-purple-600 transition-colors leading-tight truncate"},Qt={class:"flex items-center gap-2 mt-1.5 flex-wrap"},Jt=["title","aria-label"],Kt={class:"text-xs text-gray-500 font-medium"},Xt=["aria-label"],Yt={key:0,class:"mb-4 flex items-center gap-2"},Zt={class:"text-sm text-gray-700 font-medium"},Wt={class:"space-y-3 mb-5"},eo={class:"flex items-center gap-2 text-sm text-gray-600"},to={class:"font-medium"},oo={class:"flex items-center gap-2 text-sm text-gray-600 flex-wrap"},ao=["aria-label"],so={key:1,class:"text-gray-400 font-medium"},ro=["aria-label"],no={class:"flex items-center gap-2 text-sm text-gray-600"},lo={key:1,class:"mb-5 p-4 bg-gradient-to-br from-purple-600/8 to-rosa/12 rounded-xl border border-purple-600/15"},io={class:"space-y-3"},co={class:"flex items-center justify-between"},uo={class:"flex items-center gap-2"},po={class:"grid grid-cols-1 gap-2"},mo={class:"flex items-center gap-2 text-sm"},bo={class:"flex items-center gap-2 text-sm"},go={class:"pt-1"},fo={class:"flex items-center justify-between text-xs text-gray-500 mb-2"},vo={class:"font-semibold text-gray-700"},xo={class:"w-full bg-gray-200 rounded-full h-2 overflow-hidden"},ho={class:"pt-5 border-t border-gray-100"},yo={class:"flex items-center justify-between text-xs text-gray-500 mb-2"},_o={class:"font-semibold text-gray-700"},wo={class:"w-full bg-gray-200 rounded-full h-2"},ko={class:"mt-5 space-y-2"},$o={key:0,class:"flex items-start gap-3 p-3 bg-red-50 border border-red-200 rounded-lg animate-pulse-subtle"},Co={class:"flex-1"},Do={class:"text-xs text-red-700"},Eo={key:1,class:"flex items-start gap-3 p-3 bg-amber-50 border border-amber-200 rounded-lg"},So={class:"flex-1"},Fo={class:"text-xs text-amber-700"},Mo={key:2,class:"flex items-start gap-3 p-3 bg-red-50 border border-red-200 rounded-lg animate-pulse-subtle"},Po={class:"flex-1"},Ao={class:"text-xs text-red-700"},Io={key:3,class:"flex items-start gap-3 p-3 bg-orange-50 border border-orange-200 rounded-lg"},To={__name:"PacienteCard",props:{paciente:{type:Object,required:!0}},emits:["editar","eliminar","ver-citas","gestionar-bonos","editar-cita"],setup(S){const D=S,x=A(()=>{const _=D.paciente.nombre||"Sin nombre";if(_==="Sin nombre")return"Sin nombre";const w=_.trim().split(" ");if(w.length>2){const N=w[0],ee=w[1],L=w[w.length-1].charAt(0);return`${N} ${ee} ${L}.`}return _}),T=A(()=>{const _=D.paciente.nombre||"";if(!_)return"??";const w=_.trim().split(" "),N=w[0]?.charAt(0).toUpperCase()||"?",ee=w[1]?.charAt(0).toUpperCase()||"";return`${N}${ee}`}),p=A(()=>{const _=["#5550F2","#C89B8A","#B7C6B0","#A8C5B5","#D4A5A5","#C4B5A0"],w=D.paciente.id.charCodeAt(0)%_.length;return _[w]}),g=A(()=>{const _=D.paciente.estado_emocional_promedio||3;return _>=4?"ÔøΩ":_>=3?"üòê":"ÔøΩ"}),r=A(()=>{const _=D.paciente.estado_emocional_promedio||3;return _>=4?"Estado positivo":_>=3?"Estado neutro":"Requiere atenci√≥n"}),y=A(()=>D.paciente.activo?D.paciente.en_pausa?"En pausa":"Activo":"Finalizado"),z=A(()=>D.paciente.activo?D.paciente.en_pausa?"bg-yellow-100 text-yellow-700":"bg-green-100 text-green-700":"bg-gray-100 text-gray-600"),q=A(()=>D.paciente.activo?D.paciente.en_pausa?"bg-yellow-500":"bg-green-500":"bg-gray-500"),l=A(()=>D.paciente.area_de_acompanamiento||null),m=A(()=>{if(!D.paciente.ultima_sesion)return"Sin registro";const _=new Date(D.paciente.ultima_sesion),N=Math.floor((new Date-_)/(1e3*60*60*24));return N===0?"Hoy":N===1?"Ayer":N<7?`Hace ${N} d√≠as`:N<30?`Hace ${Math.floor(N/7)} semanas`:_.toLocaleDateString("es-ES",{day:"numeric",month:"short"})}),j=A(()=>{if(!D.paciente.proxima_sesion)return null;try{let _=D.paciente.proxima_sesion;_.includes("T")||(_+="T00:00:00");const w=new Date(_);return isNaN(w.getTime())?(console.warn("Fecha inv√°lida en pr√≥xima sesi√≥n:",D.paciente.proxima_sesion),null):w.toLocaleDateString("es-ES",{weekday:"short",day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})}catch(_){return console.error("Error al formatear pr√≥xima sesi√≥n:",_,D.paciente.proxima_sesion),null}}),O=A(()=>D.paciente.total_sesiones||0),F=A(()=>D.paciente.evolucion_porcentaje||50),C=A(()=>{const _=F.value;return _>=70?"bg-green-500":_>=50?"bg-yellow-500":"bg-orange-500"}),a=A(()=>{if(!D.paciente.ultima_sesion)return 0;const _=new Date(D.paciente.ultima_sesion);return Math.floor((new Date-_)/(1e3*60*60*24))}),i=A(()=>!D.paciente.activo||D.paciente.en_pausa?!1:a.value>30),c=A(()=>D.paciente.requiere_atencion||!1),d=A(()=>D.paciente.bono_activo||null),f=A(()=>d.value?.tipo?{otro:"A demanda",quincenal:"Quincenal",semanal:"Semanal",mensual:"Mensual",personalizado:"Personalizado"}[d.value.tipo]||d.value.tipo:"Sin tipo"),b=A(()=>d.value?.tipo&&{otro:"bg-blue-100 text-blue-700",quincenal:"bg-purple-100 text-purple-700",semanal:"bg-indigo-100 text-indigo-700",mensual:"bg-teal-100 text-teal-700",personalizado:"bg-pink-100 text-pink-700"}[d.value.tipo]||"bg-gray-100 text-gray-600"),E=A(()=>d.value?.estado?{activo:"Activo",pendiente:"Pendiente",vencido:"Vencido",completado:"Completado"}[d.value.estado]||d.value.estado:"Sin estado"),U=A(()=>d.value?.estado&&{activo:"bg-green-100 text-green-700",pendiente:"bg-yellow-100 text-yellow-700",vencido:"bg-red-100 text-red-700",completado:"bg-gray-100 text-gray-600"}[d.value.estado]||"bg-gray-100 text-gray-600"),Z=A(()=>{if(!d.value?.fecha_fin)return"Sin fecha";try{return new Date(d.value.fecha_fin).toLocaleDateString("es-ES",{day:"numeric",month:"short",year:"numeric"})}catch{return"Fecha inv√°lida"}});A(()=>{if(!d.value?.fecha_fin)return"text-cafe/60";const _=new Date(d.value.fecha_fin),N=Math.floor((_-new Date)/(1e3*60*60*24));return N<0?"text-red-600 font-semibold":N<=7?"text-orange-600 font-semibold":N<=14?"text-amber-600":"text-cafe/80"});const $=A(()=>d.value?d.value.sesiones_totales-d.value.sesiones_restantes:0),o=A(()=>d.value?.sesiones_totales||0),k=A(()=>{if(!d.value)return"text-purple-600";const _=d.value.sesiones_restantes;return _===0?"text-red-600 font-bold":_===1?"text-red-600 font-semibold":_===2?"text-orange-600 font-semibold":"text-purple-600 font-semibold"}),Y=A(()=>{if(!d.value)return 0;const _=d.value.sesiones_totales,w=d.value.sesiones_restantes;if(_===0)return 0;const N=_-w;return Math.round(N/_*100)}),I=A(()=>Y.value.toString()),W=A(()=>{if(!d.value)return"bg-gray-400";const _=d.value.estado;return{activo:"bg-green-500",pendiente:"bg-yellow-500",vencido:"bg-red-500",completado:"bg-gray-400"}[_]||"bg-gray-400"}),Q=A(()=>d.value?d.value.sesiones_restantes===1:!1),X=A(()=>d.value?d.value.sesiones_restantes===2:!1);return(_,w)=>(s(),n("article",{class:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-lg hover:border-gray-200 transition-all duration-300 group relative cursor-pointer focus-within:ring-2 focus-within:ring-purple-600 focus-within:ring-offset-2",role:"article","aria-label":`Ficha de ${t(x)}`,tabindex:"0"},[e("div",jt,[e("button",{onClick:w[0]||(w[0]=ae(N=>_.$emit("gestionar-bonos",S.paciente),["stop"])),class:"min-h-[44px] min-w-[44px] p-2.5 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors shadow-md hover:shadow-lg focus:ring-2 focus:ring-purple-300 focus:outline-none","aria-label":`Gestionar bonos de ${t(x)}`},[...w[5]||(w[5]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"})],-1)])],8,zt),e("button",{onClick:w[1]||(w[1]=ae(N=>_.$emit("editar",S.paciente),["stop"])),class:"min-h-[44px] min-w-[44px] p-2.5 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors shadow-md hover:shadow-lg focus:ring-2 focus:ring-blue-300 focus:outline-none","aria-label":`Editar informaci√≥n de ${t(x)}`},[...w[6]||(w[6]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,Rt),e("button",{onClick:w[2]||(w[2]=ae(N=>_.$emit("eliminar",S.paciente),["stop"])),class:"min-h-[44px] min-w-[44px] p-2.5 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors shadow-md hover:shadow-lg focus:ring-2 focus:ring-red-300 focus:outline-none","aria-label":`Eliminar a ${t(x)}`},[...w[7]||(w[7]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Ut)]),e("div",Ot,[e("div",Nt,[e("div",{class:"w-14 h-14 rounded-full flex items-center justify-center text-white font-bold text-xl flex-shrink-0 shadow-md",style:Ae({backgroundColor:t(p)}),"aria-label":`Avatar de ${t(x)}`},u(t(T)),13,Lt),e("div",Ht,[e("h3",Gt,u(t(x)),1),e("div",Qt,[e("span",{class:"text-xl leading-none",title:t(r),"aria-label":`Estado emocional: ${t(r)}`},u(t(g)),9,Jt),e("span",Kt,u(t(r)),1)])])]),e("span",{class:G(["px-3 py-1.5 text-xs font-semibold rounded-full whitespace-nowrap flex items-center gap-1.5 flex-shrink-0",t(z)]),"aria-label":`Estado del v√≠nculo: ${t(y)}`},[e("span",{class:G(["w-1.5 h-1.5 rounded-full",t(q)])},null,2),e("span",null,u(t(y)),1)],10,Xt)]),t(l)?(s(),n("div",Yt,[w[8]||(w[8]=e("span",{class:"text-xs text-gray-400 uppercase tracking-wide"},"√Årea:",-1)),e("span",Zt,u(t(l)),1)])):P("",!0),e("div",Wt,[e("div",eo,[M(t(He),{class:"w-4 h-4 text-purple-600 flex-shrink-0"}),w[9]||(w[9]=e("span",null,"√öltima sesi√≥n: ",-1)),e("span",to,u(t(m)),1)]),e("div",oo,[M(t(kt),{class:"w-4 h-4 text-purple-600 flex-shrink-0","aria-hidden":"true"}),w[10]||(w[10]=e("span",null,"Pr√≥xima: ",-1)),t(j)?(s(),n("button",{key:0,onClick:w[3]||(w[3]=ae(N=>_.$emit("editar-cita",S.paciente.proxima_cita_id),["stop"])),class:"min-h-[44px] px-2 -mx-2 text-purple-600 hover:text-cafe font-medium hover:underline transition-colors flex-shrink-0 focus:outline-none focus:ring-2 focus:ring-purple-300 rounded","aria-label":`Editar cita programada para ${t(j)}`},u(t(j)),9,ao)):(s(),n("span",so,"No programada")),e("button",{onClick:w[4]||(w[4]=ae(N=>_.$emit("ver-citas",S.paciente),["stop"])),class:"min-h-[44px] px-2 ml-auto text-xs text-purple-600 hover:text-cafe hover:underline transition-colors flex-shrink-0 focus:outline-none focus:ring-2 focus:ring-purple-300 rounded","aria-label":`Ver todas las citas de ${t(x)}`}," Ver citas ‚Üí ",8,ro)]),e("div",no,[M(t(ie),{class:"w-4 h-4 text-purple-600 flex-shrink-0"}),e("span",null,u(t(O))+" sesiones completadas",1)])]),t(d)?(s(),n("div",lo,[e("div",io,[e("div",co,[e("div",uo,[M(t($t),{class:"w-4 h-4 text-purple-600 flex-shrink-0"}),w[11]||(w[11]=e("span",{class:"text-sm font-medium text-gray-700"},"Bono:",-1)),e("span",{class:G(["px-2.5 py-1 rounded-lg text-xs font-semibold",t(b)])},u(t(f)),3)]),e("span",{class:G(["px-2.5 py-1 rounded-full text-xs font-semibold flex items-center gap-1.5",t(U)])},[M(t(Ct),{class:"w-3 h-3"}),e("span",null,u(t(E)),1)],2)]),e("div",po,[e("div",mo,[M(t(He),{class:"w-4 h-4 text-purple-600 flex-shrink-0"}),w[12]||(w[12]=e("span",{class:"text-gray-600"},"Vigencia:",-1)),e("span",{class:G([_.fechaFinClases,"font-medium"])},u(t(Z)),3)]),e("div",bo,[M(t(Dt),{class:"w-4 h-4 text-purple-600 flex-shrink-0"}),w[13]||(w[13]=e("span",{class:"text-gray-600"},"Sesiones:",-1)),e("span",{class:G([t(k),"font-semibold"])},u(t($))+"/"+u(t(o)),3)])]),e("div",go,[e("div",fo,[w[14]||(w[14]=e("span",null,"Progreso del bono",-1)),e("span",vo,u(t(I))+"%",1)]),e("div",xo,[e("div",{class:G(["h-2 rounded-full transition-all duration-500",t(W)]),style:Ae({width:`${t(Y)}%`})},null,6)])])])])):P("",!0),e("div",ho,[e("div",yo,[w[15]||(w[15]=e("span",null,"Evoluci√≥n general",-1)),e("span",_o,u(t(F))+"%",1)]),e("div",wo,[e("div",{class:G(["h-2 rounded-full transition-all duration-500",t(C)]),style:Ae({width:`${t(F)}%`})},null,6)])]),e("div",ko,[t(Q)?(s(),n("div",$o,[M(t(xe),{class:"w-4 h-4 text-red-600 flex-shrink-0 mt-0.5"}),e("div",Co,[w[16]||(w[16]=e("p",{class:"text-xs font-semibold text-red-800 mb-1"}," Bono casi agotado ",-1)),e("p",Do," Solo queda "+u(t(d).sesiones_restantes)+" sesi√≥n. Informar para renovaci√≥n. ",1)])])):t(X)?(s(),n("div",Eo,[M(t(be),{class:"w-4 h-4 text-amber-600 flex-shrink-0 mt-0.5"}),e("div",So,[w[17]||(w[17]=e("p",{class:"text-xs font-semibold text-amber-800 mb-1"}," Bono pr√≥ximo a agotar ",-1)),e("p",Fo," Quedan "+u(t(d).sesiones_restantes)+" sesiones. Considerar renovaci√≥n. ",1)])])):P("",!0),t(i)?(s(),n("div",Mo,[M(t(Et),{class:"w-4 h-4 text-red-600 flex-shrink-0 mt-0.5"}),e("div",Po,[w[18]||(w[18]=e("p",{class:"text-xs font-semibold text-red-800 mb-1"}," Riesgo de abandono ",-1)),e("p",Ao,u(t(a))+" d√≠as sin sesi√≥n. Considera contactar pronto. ",1)])])):P("",!0),t(c)?(s(),n("div",Io,[M(t(be),{class:"w-4 h-4 text-orange-500 flex-shrink-0 mt-0.5"}),w[19]||(w[19]=e("div",{class:"flex-1"},[e("p",{class:"text-xs font-semibold text-orange-800"}," Requiere seguimiento especial por estado emocional ")],-1))])):P("",!0)])],8,qt))}},Vo=ce(To,[["__scopeId","data-v-d022a747"]]),Bo={class:"bg-white/95 backdrop-blur-lg rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto border border-white/30"},qo={class:"space-y-4"},jo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},zo={class:"relative"},Ro={class:"space-y-4 pt-4 border-t border-neutral-200"},Uo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Oo={class:"md:col-span-2"},No={class:"relative"},Lo={class:"flex gap-2 flex-wrap mt-2"},Ho=["onClick"],Go={class:"space-y-4 pt-4 border-t border-[#5550F2]/30"},Qo={class:"border-t pt-6"},Jo={key:0,class:"bg-amber-50 border-2 border-amber-200 rounded-lg p-4 mb-3"},Ko={key:1,class:"text-sm text-cafe/70 mb-3"},Xo=["disabled"],Yo={key:0,class:"border-2 border-purple-400/40 rounded-lg p-5 space-y-4 bg-gradient-to-br from-purple-50 to-purple-100/50"},Zo={class:"bg-white border-2 border-purple-300 rounded-lg p-4 shadow-sm"},Wo={class:"flex items-start gap-3"},ea={class:"flex-1"},ta={class:"font-semibold text-purple-900 mb-1"},oa={class:"grid grid-cols-2 gap-3 text-sm"},aa={class:"flex items-center gap-2"},sa={class:"text-purple-800"},ra={key:0,class:"flex items-center gap-2"},na={class:"text-purple-800"},la={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ia={class:"relative"},da=["required"],ca={class:"px-4 py-2 bg-purple-100 rounded-lg border border-purple-300"},ua={class:"text-lg font-bold text-purple-700"},pa={class:"md:col-span-2"},ma={class:"flex items-start gap-3 p-4 bg-white border-2 border-purple-200 rounded-lg cursor-pointer hover:bg-purple-50 hover:border-purple-300 transition-all"},ba={key:0,class:"p-3 bg-white rounded-lg border border-purple-300"},ga={class:"grid grid-cols-3 gap-2 text-xs"},fa={class:"font-medium text-[#2D3748] ml-1"},va={class:"font-medium text-[#2D3748] ml-1"},xa={class:"font-medium text-[#2D3748] ml-1"},ha={class:"space-y-4 pt-4 border-t border-[#5550F2]/30"},ya={key:0,class:"bg-red-50 border border-red-200 rounded-lg p-4"},_a={class:"text-sm text-red-600"},wa={class:"sticky bottom-0 bg-gradient-to-r from-white/95 via-white/90 to-white/95 backdrop-blur-md pt-4 pb-2 border-t border-neutral-200 -mx-6 px-6 mt-6 shadow-sm"},ka={class:"flex justify-between items-center gap-3"},$a={class:"flex gap-3"},Ca=["disabled"],Da=["disabled"],Ea={key:0,class:"inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"},Sa={key:1},Fa={__name:"ModalNuevoPaciente",props:{mostrar:{type:Boolean,default:!1}},emits:["cerrar","paciente-creado"],setup(S,{emit:D}){const x=S,T=D,{supabase:p,waitForUser:g,getUserId:r}=Ee(),{crearBono:y}=Ke(),{crearCita:z}=Xe(),q=Ge(),l=V({nombre:"",apellido:"",email:"",telefono:"",fecha_nacimiento:"",area_acompanamiento:"",tipo_bono:"",primera_sesion:"",activo:!0,notas_iniciales:"",crear_bono:!1,bono_monto:0,bono_renovacion_automatica:!1}),m=V(!1),j=V(""),O={otro:60,quincenal:100,semanal:160,mensual:180},F=A(()=>{const $=l.value.tipo_bono;return $&&{otro:1,quincenal:2,semanal:4,mensual:4}[$]||0}),C=A(()=>{const $=l.value.tipo_bono;return{otro:"A Demanda",quincenal:"Quincenal",semanal:"Semanal",mensual:"Mensual"}[$]||"No seleccionado"}),a=A(()=>{const $=F.value,o=l.value.bono_monto;return!$||!o||$<=0?"0.00":(o/$).toFixed(2)}),i=A(()=>{const $=l.value.tipo_bono;return $&&O[$]||0}),c=A(()=>l.value.tipo_bono==="otro"),d=A(()=>{const $=new Date,o=[],k=(X,_)=>{const w=X.getFullYear(),N=String(X.getMonth()+1).padStart(2,"0"),ee=String(X.getDate()).padStart(2,"0");return`${w}-${N}-${ee}T${_}`},Y=new Date($);Y.setDate(Y.getDate()+1),o.push({label:"üåÖ Ma√±ana 10:00",datetime:k(Y,"10:00")});const I=new Date($),W=(8-I.getDay())%7;I.setDate(I.getDate()+(W||7)),o.push({label:"üìÖ Pr√≥ximo Lun 09:00",datetime:k(I,"09:00")});const Q=new Date($);return Q.setDate(Q.getDate()+7),o.push({label:"üóìÔ∏è En 7 d√≠as 16:00",datetime:k(Q,"16:00")}),o}),f=A(()=>{const $=l.value.nombre&&l.value.apellido&&l.value.email&&l.value.area_acompanamiento&&l.value.tipo_bono&&l.value.primera_sesion;return l.value.crear_bono?$&&l.value.bono_monto>0:$});ne(()=>l.value.tipo_bono,$=>{$==="otro"?(l.value.crear_bono=!1,l.value.bono_monto=0):l.value.crear_bono&&l.value.bono_monto===0&&(l.value.bono_monto=O[$]||0)}),ne(()=>l.value.crear_bono,$=>{$&&l.value.tipo_bono&&l.value.bono_monto===0&&(l.value.bono_monto=O[l.value.tipo_bono]||0)}),ne(()=>x.mostrar,$=>{$&&E()});const b=($,o)=>{if($.target&&$.target.showPicker)try{$.target.showPicker()}catch{console.log("showPicker no disponible")}else if(o){const k=document.getElementById(o);k&&(k.focus(),k.click())}},E=()=>{l.value={nombre:"",apellido:"",email:"",telefono:"",fecha_nacimiento:"",area_acompanamiento:"",tipo_bono:"",primera_sesion:"",activo:!0,notas_iniciales:"",crear_bono:!1,bono_monto:0,bono_renovacion_automatica:!1},j.value=""},U=()=>{m.value||T("cerrar")},Z=async()=>{try{m.value=!0,j.value="",await g();const $=r();if(!$)throw new Error("Usuario no autenticado. Por favor, vuelve a iniciar sesi√≥n.");console.log("üÜï Creando nuevo paciente...");const o=`${l.value.nombre.trim()} ${l.value.apellido.trim()}`;console.log("üìù Llamando a crear_paciente_simple...");const{data:k,error:Y}=await p.rpc("crear_paciente_simple",{p_email:l.value.email,p_nombre_completo:o,p_telefono:l.value.telefono||null,p_area_acompanamiento:l.value.area_acompanamiento||null,p_tipo_bono:l.value.tipo_bono||null,p_terapeuta_id:$,p_metadata:{nombre:l.value.nombre,apellido:l.value.apellido,fecha_nacimiento:l.value.fecha_nacimiento,notas_iniciales:l.value.notas_iniciales,fecha_registro:new Date().toISOString(),primera_sesion:l.value.primera_sesion,estado_registro:"activo"}});if(Y)throw console.error("‚ùå Error en RPC crear_paciente_simple:",Y),new Error(`Error al crear paciente: ${Y.message}`);if(!k||!k.id){const Q="Error desconocido al crear paciente";throw console.error("‚ùå RPC devolvi√≥ resultado inv√°lido:",k),new Error(Q)}console.log("‚úÖ Paciente creado exitosamente:",k);const I=k.id,W=null;if(l.value.crear_bono&&l.value.tipo_bono&&l.value.bono_monto)try{console.log("üí≥ Creando bono inicial ANTES de la cita...");const Q=new Date().toISOString().split("T")[0];let X=null;const _=l.value.tipo_bono;if(_==="otro"){const L=new Date;L.setMonth(L.getMonth()+1),X=L.toISOString().split("T")[0]}else if(_==="quincenal"){const L=new Date;L.setDate(L.getDate()+15),X=L.toISOString().split("T")[0]}else if(_==="semanal"){const L=new Date;L.setMonth(L.getMonth()+1),X=L.toISOString().split("T")[0]}else if(_==="mensual"){const L=new Date;L.setMonth(L.getMonth()+1),X=L.toISOString().split("T")[0]}const w=F.value,N={paciente_id:I,terapeuta_id:$,tipo:_,sesiones_totales:w,sesiones_restantes:w,fecha_inicio:Q,fecha_fin:X,estado:"pendiente",monto_total:l.value.bono_monto,precio_por_sesion:l.value.bono_monto/w,pagado:!1,renovacion_automatica:l.value.bono_renovacion_automatica,notas:`Bono creado al registrar paciente. ${o}`,metadata:{creado_con_paciente:!0,fecha_creacion:new Date().toISOString()}};console.log("üì¶ Datos del bono a crear:",N);const ee=await y(N);ee&&console.log("‚úÖ Bono creado exitosamente:",ee)}catch(Q){console.error("‚ö†Ô∏è Error al crear bono:",Q),j.value=`Paciente creado, pero hubo un error al crear el bono: ${Q.message}`}if(l.value.primera_sesion)try{console.log("üìÖ Creando cita para primera sesi√≥n..."),console.log("üìã Datos del paciente:",{pacienteId:I,nombreCompleto:o,userId:$}),console.log("üìã Primera sesi√≥n:",l.value.primera_sesion);const[Q,X]=l.value.primera_sesion.split("T");console.log("üìã Fecha parseada:",Q,"Hora parseada:",X);const[_,w]=X.split(":").map(Number),N=`${String(_+1).padStart(2,"0")}:${String(w).padStart(2,"0")}`;console.log("üìã Hora inicio:",X,"Hora fin:",N);const ee=await z({paciente_id:I,paciente_nombre:o,terapeuta_id:$,fecha:Q,hora_inicio:X,hora_fin:N,modalidad:"online",estado:"pendiente",notas:`Primera sesi√≥n programada al registrar paciente: ${o}`,descontar_de_bono:!1});console.log("üìã Resultado completo de crearCita:",ee),ee.success?console.log("‚úÖ Cita de primera sesi√≥n creada exitosamente:",ee.data):(console.error("‚ùå ERROR al crear la cita de primera sesi√≥n:",ee.error),j.value=`Paciente creado, pero hubo un error al crear la cita: ${ee.error}`)}catch(Q){console.error("‚ùå EXCEPCI√ìN al crear cita de primera sesi√≥n:",Q),j.value=`Paciente creado, pero hubo un error al crear la cita: ${Q.message}`}if(l.value.notas_iniciales&&await p.from("notas_terapeuticas").insert({paciente_id:I,terapeuta_id:q.value.id,contenido:l.value.notas_iniciales,tipo:"evaluacion_inicial"}),l.value.crear_bono&&l.value.tipo_bono&&l.value.bono_monto)try{console.log("üí≥ Creando bono inicial...");const Q=new Date().toISOString().split("T")[0];let X=null;const _=l.value.tipo_bono;if(_==="otro"){const L=new Date;L.setMonth(L.getMonth()+1),X=L.toISOString().split("T")[0]}else if(_==="quincenal"){const L=new Date;L.setDate(L.getDate()+15),X=L.toISOString().split("T")[0]}else if(_==="semanal"){const L=new Date;L.setMonth(L.getMonth()+1),X=L.toISOString().split("T")[0]}else if(_==="mensual"){const L=new Date;L.setMonth(L.getMonth()+1),X=L.toISOString().split("T")[0]}const w=F.value,N={paciente_id:I,terapeuta_id:$,tipo:_,sesiones_totales:w,sesiones_restantes:w,fecha_inicio:Q,fecha_fin:X,estado:"pendiente",monto_total:l.value.bono_monto,precio_por_sesion:l.value.bono_monto/w,pagado:!1,renovacion_automatica:l.value.bono_renovacion_automatica,notas:`Bono creado al registrar paciente. ${o}`,metadata:{creado_con_paciente:!0,fecha_creacion:new Date().toISOString()}};console.log("üì¶ Datos del bono a crear:",N);const ee=await y(N);ee&&console.log("‚úÖ Bono creado exitosamente:",ee)}catch(Q){console.error("‚ö†Ô∏è Error al crear bono:",Q),j.value=`Paciente creado, pero hubo un error al crear el bono: ${Q.message}`}T("paciente-creado",k),T("cerrar"),E()}catch($){console.error("Error al crear paciente:",$),j.value=$.message||"Error al crear el paciente. Por favor, intenta nuevamente."}finally{m.value=!1}};return($,o)=>S.mostrar?(s(),n("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:ae(U,["self"])},[e("div",Bo,[e("div",{class:"sticky top-0 bg-gradient-to-r from-[#5550F2]/5 via-[#027368]/5 to-[#04BF9D]/5 backdrop-blur-md border-b border-neutral-200 px-6 py-4 flex justify-between items-center shadow-sm"},[o[17]||(o[17]=e("h2",{class:"text-2xl font-['Elms_Sans'] text-neutral-800 font-semibold"}," Nuevo Paciente ",-1)),e("button",{onClick:U,class:"text-neutral-600 hover:text-[#027368] transition-colors p-2 hover:bg-white/50 rounded-lg","aria-label":"Cerrar modal"},[...o[16]||(o[16]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("form",{onSubmit:ae(Z,["prevent"]),class:"px-6 py-6 space-y-6 bg-gradient-to-b from-white/50 to-transparent"},[e("div",qo,[o[25]||(o[25]=e("h3",{class:"text-lg font-['Elms_Sans'] text-neutral-800 font-semibold"}," Informaci√≥n Personal ",-1)),e("div",jo,[e("div",null,[o[18]||(o[18]=e("label",{for:"nombre",class:"block text-sm font-medium text-neutral-700 mb-1"},[B(" Nombre "),e("span",{class:"text-red-500"},"*")],-1)),H(e("input",{id:"nombre","onUpdate:modelValue":o[0]||(o[0]=k=>l.value.nombre=k),type:"text",required:"",class:"w-full px-4 py-2 border border-neutral-300 rounded-xl focus:ring-2 focus:ring-[#027368]/20 focus:border-[#027368] bg-white/90 backdrop-blur-sm transition-all shadow-sm",placeholder:"Nombre del paciente"},null,512),[[oe,l.value.nombre]])]),e("div",null,[o[19]||(o[19]=e("label",{for:"apellido",class:"block text-sm font-medium text-neutral-700 mb-1"},[B(" Apellido "),e("span",{class:"text-red-500"},"*")],-1)),H(e("input",{id:"apellido","onUpdate:modelValue":o[1]||(o[1]=k=>l.value.apellido=k),type:"text",required:"",class:"w-full px-4 py-2 border border-neutral-300 rounded-xl focus:ring-2 focus:ring-[#027368]/20 focus:border-[#027368] bg-white/90 backdrop-blur-sm transition-all shadow-sm",placeholder:"Apellido(s) del paciente"},null,512),[[oe,l.value.apellido]])]),e("div",null,[o[20]||(o[20]=e("label",{for:"email",class:"block text-sm font-medium text-neutral-700 mb-1"},[B(" Email "),e("span",{class:"text-red-500"},"*")],-1)),H(e("input",{id:"email","onUpdate:modelValue":o[2]||(o[2]=k=>l.value.email=k),type:"email",required:"",class:"w-full px-4 py-2 border border-neutral-300 rounded-xl focus:ring-2 focus:ring-[#027368]/20 focus:border-[#027368] bg-white/90 backdrop-blur-sm transition-all shadow-sm",placeholder:"correo@ejemplo.com"},null,512),[[oe,l.value.email]])]),e("div",null,[o[21]||(o[21]=e("label",{for:"telefono",class:"block text-sm font-medium text-neutral-700 mb-1"}," Tel√©fono ",-1)),H(e("input",{id:"telefono","onUpdate:modelValue":o[3]||(o[3]=k=>l.value.telefono=k),type:"tel",class:"w-full px-4 py-2 border border-neutral-300 rounded-xl focus:ring-2 focus:ring-[#027368]/20 focus:border-[#027368] bg-white/90 backdrop-blur-sm transition-all shadow-sm",placeholder:"+52 123 456 7890"},null,512),[[oe,l.value.telefono]])]),e("div",null,[o[23]||(o[23]=e("label",{for:"fecha_nacimiento",class:"block text-sm font-medium text-[#2D3748] mb-1"}," Fecha de Nacimiento ",-1)),e("div",zo,[H(e("input",{id:"fecha_nacimiento","onUpdate:modelValue":o[4]||(o[4]=k=>l.value.fecha_nacimiento=k),type:"date",class:"w-full px-4 py-2 pr-12 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white cursor-pointer",onFocus:o[5]||(o[5]=k=>b(k))},null,544),[[oe,l.value.fecha_nacimiento]]),e("button",{type:"button",onClick:o[6]||(o[6]=k=>b(k,"fecha_nacimiento")),class:"absolute right-2 top-1/2 -translate-y-1/2 p-2 text-[#5550F2] hover:text-[#2D3748] transition-colors",title:"Abrir calendario"},[...o[22]||(o[22]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)])])]),o[24]||(o[24]=e("p",{class:"text-xs text-cafe/60 mt-1"}," üí° Puedes escribir la fecha o usar el calendario ",-1))])])]),e("div",Ro,[o[34]||(o[34]=e("h3",{class:"text-lg font-['Elms_Sans'] text-neutral-800 font-semibold"}," Informaci√≥n Terap√©utica ",-1)),e("div",Uo,[e("div",Oo,[o[27]||(o[27]=e("label",{for:"area_acompanamiento",class:"block text-sm font-medium text-[#2D3748] mb-1"},[B(" √Årea de Acompa√±amiento "),e("span",{class:"text-red-500"},"*")],-1)),H(e("select",{id:"area_acompanamiento","onUpdate:modelValue":o[7]||(o[7]=k=>l.value.area_acompanamiento=k),required:"",class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white"},[...o[26]||(o[26]=[De('<option value="">Selecciona un √°rea</option><option value="Ansiedad">Ansiedad</option><option value="Depresi√≥n">Depresi√≥n</option><option value="Autoestima">Autoestima</option><option value="Relaciones">Relaciones</option><option value="Duelo">Duelo</option><option value="Estr√©s Laboral">Estr√©s Laboral</option><option value="Crecimiento Personal">Crecimiento Personal</option><option value="Otro">Otro</option>',9)])],512),[[pe,l.value.area_acompanamiento]])]),e("div",null,[o[29]||(o[29]=e("label",{for:"tipo_bono",class:"block text-sm font-medium text-[#2D3748] mb-1"},[B(" Tipo de Bono "),e("span",{class:"text-red-500"},"*")],-1)),H(e("select",{id:"tipo_bono","onUpdate:modelValue":o[8]||(o[8]=k=>l.value.tipo_bono=k),required:"",class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white"},[...o[28]||(o[28]=[De('<option value="">Selecciona tipo de bono</option><option value="otro">A Demanda (1 sesi√≥n - 60‚Ç¨ - sin compromiso)</option><option value="quincenal">Quincenal (2 sesiones/mes - 100‚Ç¨)</option><option value="semanal">Semanal (4 sesiones/mes - 160‚Ç¨)</option><option value="mensual">Mensual</option>',5)])],512),[[pe,l.value.tipo_bono]]),o[30]||(o[30]=e("p",{class:"text-xs text-cafe/60 mt-1"}," üé´ Define el tipo de bono del paciente ",-1))]),e("div",null,[o[32]||(o[32]=e("label",{for:"primera_sesion",class:"block text-sm font-medium text-[#2D3748] mb-1"},[B(" Primera Sesi√≥n "),e("span",{class:"text-red-500"},"*")],-1)),e("div",No,[H(e("input",{id:"primera_sesion","onUpdate:modelValue":o[9]||(o[9]=k=>l.value.primera_sesion=k),type:"datetime-local",required:"",step:"1800",class:"w-full px-4 py-2 pr-12 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white cursor-pointer",onFocus:o[10]||(o[10]=k=>b(k))},null,544),[[oe,l.value.primera_sesion]]),e("button",{type:"button",onClick:o[11]||(o[11]=k=>b(k,"primera_sesion")),class:"absolute right-2 top-1/2 -translate-y-1/2 p-2 text-[#5550F2] hover:text-[#2D3748] transition-colors",title:"Abrir selector de fecha y hora"},[...o[31]||(o[31]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)])])]),e("div",Lo,[(s(!0),n(J,null,K(t(d),(k,Y)=>(s(),n("button",{key:Y,type:"button",onClick:I=>l.value.primera_sesion=k.datetime,class:G(["text-xs px-3 py-1.5 rounded-lg border transition-all",l.value.primera_sesion===k.datetime?"bg-[#5550F2] text-white border-[#5550F2] font-semibold":"bg-white text-[#2D3748] border-[#5550F2]/30 hover:border-[#5550F2] hover:bg-[#5550F2]/10"])},u(k.label),11,Ho))),128))]),o[33]||(o[33]=e("p",{class:"text-xs text-cafe/60 mt-1"}," üí° Puedes escribir la fecha/hora o usar el selector ",-1))])])]),e("div",Go,[e("div",Qo,[o[36]||(o[36]=e("h3",{class:"text-lg font-serif text-[#2D3748] font-semibold mb-2"}," üí≥ Bono Inicial (Opcional) ",-1)),t(c)?(s(),n("div",Jo,[...o[35]||(o[35]=[e("div",{class:"flex items-start gap-3"},[e("span",{class:"text-2xl"},"‚ÑπÔ∏è"),e("div",null,[e("p",{class:"text-sm font-semibold text-amber-900 mb-1"},' Sesi√≥n "A Demanda" seleccionada '),e("p",{class:"text-sm text-amber-800"},[B(" Las sesiones a demanda son "),e("strong",null,"sin compromiso"),B(" y se pagan individualmente (60‚Ç¨ por sesi√≥n). No es necesario crear un bono prepagado. ")])])],-1)])])):(s(),n("p",Ko," Crea un bono prepagado para que el paciente empiece su tratamiento. Podr√°s confirmar el pago despu√©s. ")),e("label",{class:G(["flex items-center gap-3 p-3 rounded-lg transition-colors",t(c)?"bg-gray-100 border-2 border-gray-200 cursor-not-allowed opacity-60":"bg-purple-50 border-2 border-purple-200 cursor-pointer hover:bg-purple-100"])},[H(e("input",{"onUpdate:modelValue":o[12]||(o[12]=k=>l.value.crear_bono=k),type:"checkbox",disabled:t(c),class:"w-5 h-5 text-purple-600 border-gray-300 rounded focus:ring-purple-500 disabled:opacity-50 disabled:cursor-not-allowed"},null,8,Xo),[[me,l.value.crear_bono]]),e("span",{class:G(["text-sm font-semibold",t(c)?"text-gray-500":"text-purple-700"])}," ‚úÖ S√≠, crear bono prepagado para este paciente ",2)],2)]),l.value.crear_bono?(s(),n("div",Yo,[e("div",Zo,[e("div",Wo,[o[41]||(o[41]=e("div",{class:"w-10 h-10 bg-purple-500 rounded-full flex items-center justify-center flex-shrink-0"},[e("span",{class:"text-white text-xl"},"üéüÔ∏è")],-1)),e("div",ea,[e("h4",ta," Tipo de Bono: "+u(t(C)||"Selecciona un tipo arriba"),1),e("div",oa,[e("div",aa,[o[37]||(o[37]=e("span",{class:"text-purple-600"},"üìä",-1)),e("span",sa,[e("strong",null,u(t(F)),1),B(" "+u(t(F)===1?"sesi√≥n":"sesiones"),1)])]),t(i)>0?(s(),n("div",ra,[o[39]||(o[39]=e("span",{class:"text-purple-600"},"üí∞",-1)),e("span",na,[o[38]||(o[38]=B(" Precio sugerido: ",-1)),e("strong",null,"‚Ç¨"+u(t(i)),1)])])):P("",!0)]),o[40]||(o[40]=e("p",{class:"text-xs text-purple-600 mt-2 bg-purple-50 p-2 rounded"},[B(" üí° "),e("strong",null,"Tip:"),B(" Los precios se calcular√°n autom√°ticamente seg√∫n el tipo de bono ")],-1))])])]),e("div",la,[e("div",null,[o[43]||(o[43]=e("label",{for:"bono_monto",class:"block text-sm font-medium text-[#2D3748] mb-1"},[B(" Monto Total "),e("span",{class:"text-red-500"},"*")],-1)),e("div",ia,[o[42]||(o[42]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-[#2D3748]/60"},"‚Ç¨",-1)),H(e("input",{id:"bono_monto","onUpdate:modelValue":o[13]||(o[13]=k=>l.value.bono_monto=k),type:"number",min:"0",step:"0.01",required:l.value.crear_bono,placeholder:"0.00",class:"w-full pl-8 pr-4 py-2 border border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500 bg-white"},null,8,da),[[oe,l.value.bono_monto,void 0,{number:!0}]])])]),e("div",null,[o[44]||(o[44]=e("label",{class:"block text-sm font-medium text-[#2D3748] mb-1"}," Precio por Sesi√≥n ",-1)),e("div",ca,[e("span",ua,"‚Ç¨"+u(t(a)),1)])]),e("div",pa,[e("label",ma,[H(e("input",{"onUpdate:modelValue":o[14]||(o[14]=k=>l.value.bono_renovacion_automatica=k),type:"checkbox",class:"mt-1 w-5 h-5 text-purple-600 border-gray-300 rounded focus:ring-purple-500"},null,512),[[me,l.value.bono_renovacion_automatica]]),o[45]||(o[45]=De('<div class="flex-1"><div class="flex items-center gap-2 mb-1"><span class="text-lg">üîÑ</span><span class="text-sm font-semibold text-purple-900"> Renovaci√≥n Autom√°tica </span><span class="ml-auto px-2 py-0.5 bg-purple-100 text-purple-700 text-xs font-medium rounded"> Recomendado </span></div><div class="text-xs text-[#2D3748]/70 space-y-1"><p>‚úì El bono se renovar√° autom√°ticamente cuando se agoten las sesiones o expire</p><p>‚úì Mantiene la continuidad del tratamiento sin interrupciones</p><p>‚úì Puedes desactivar la renovaci√≥n en cualquier momento</p></div></div>',1))])])]),t(F)>0&&l.value.bono_monto>0?(s(),n("div",ba,[o[49]||(o[49]=e("div",{class:"text-xs font-medium text-purple-800 mb-2"},"üìã Resumen del Bono",-1)),e("div",ga,[e("div",null,[o[46]||(o[46]=e("span",{class:"text-[#2D3748]/60"},"Tipo:",-1)),e("span",fa,u(t(C)),1)]),e("div",null,[o[47]||(o[47]=e("span",{class:"text-[#2D3748]/60"},"Sesiones:",-1)),e("span",va,u(t(F)),1)]),e("div",null,[o[48]||(o[48]=e("span",{class:"text-[#2D3748]/60"},"Total:",-1)),e("span",xa,"‚Ç¨"+u(l.value.bono_monto),1)])])])):P("",!0)])):P("",!0)]),e("div",ha,[o[51]||(o[51]=e("h3",{class:"text-lg font-serif text-[#2D3748] font-semibold"}," Notas Iniciales ",-1)),e("div",null,[o[50]||(o[50]=e("label",{for:"notas_iniciales",class:"block text-sm font-medium text-[#2D3748] mb-1"}," Observaciones (Opcional) ",-1)),H(e("textarea",{id:"notas_iniciales","onUpdate:modelValue":o[15]||(o[15]=k=>l.value.notas_iniciales=k),rows:"3",class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white resize-none",placeholder:"Observaciones iniciales, motivo de consulta, etc."},null,512),[[oe,l.value.notas_iniciales]])])]),j.value?(s(),n("div",ya,[e("p",_a,u(j.value),1)])):P("",!0),e("div",wa,[e("div",ka,[o[52]||(o[52]=e("div",{class:"text-xs text-neutral-600"},[e("span",{class:"inline-block w-2 h-2 bg-red-500 rounded-full mr-1"}),B(" Los campos con * son obligatorios ")],-1)),e("div",$a,[e("button",{type:"button",onClick:U,disabled:m.value,class:"px-6 py-2.5 border-2 border-neutral-300 text-neutral-700 font-medium rounded-xl hover:bg-neutral-50 hover:border-[#027368] transition-all disabled:opacity-50 disabled:cursor-not-allowed"}," Cancelar ",8,Ca),e("button",{type:"submit",disabled:m.value||!t(f),class:"px-8 py-2.5 bg-gradient-to-r from-[#04BF9D] to-[#027368] text-white font-semibold rounded-xl hover:from-[#027368] hover:to-[#04BF9D] transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 shadow-sm hover:shadow-md"},[m.value?(s(),n("span",Ea)):(s(),n("span",Sa,"‚úì")),B(" "+u(m.value?"Creando paciente...":"Crear Paciente"),1)],8,Da)])])])],32)])])):P("",!0)}},Ma={class:"bg-[#F2F2F2] rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"},Pa={class:"space-y-4"},Aa={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ia={class:"space-y-4 pt-4 border-t border-[#5550F2]/30"},Ta={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Va={class:"md:col-span-2"},Ba={class:"md:col-span-2"},qa={class:"flex items-center gap-2 cursor-pointer"},ja={class:"space-y-4 pt-4 border-t border-[#5550F2]/30"},za={class:"flex items-center justify-between"},Ra={class:"flex items-center gap-2 cursor-pointer"},Ua={key:0,class:"border-2 border-purple-400/40 rounded-lg p-4 space-y-4 bg-purple-50/30"},Oa={class:"bg-purple-100 border border-purple-300 rounded-lg p-3 flex items-start gap-2"},Na={class:"text-sm text-purple-800"},La={class:"font-medium"},Ha={class:"text-xs text-purple-700 mt-1"},Ga={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Qa={class:"relative"},Ja=["required"],Ka={class:"px-4 py-2 bg-purple-100 border-2 border-purple-300 rounded-lg text-purple-900 font-bold"},Xa={class:"md:col-span-2"},Ya={class:"flex items-center gap-2 cursor-pointer"},Za={key:0,class:"bg-white border border-purple-300 rounded-lg p-4"},Wa={class:"text-sm text-cafe/80 space-y-1"},es={key:0,class:"text-purple-700"},ts={key:0,class:"bg-red-50 border border-red-200 rounded-lg p-4"},os={class:"text-sm text-red-600"},as={class:"flex justify-end gap-3 pt-4 border-t border-[#5550F2]/30"},ss=["disabled"],rs=["disabled"],ns={key:0,class:"inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"},ls={__name:"ModalEditarPaciente",props:{mostrar:{type:Boolean,default:!1},paciente:{type:Object,default:null}},emits:["cerrar","paciente-actualizado"],setup(S,{emit:D}){const x=S,T=D,{supabase:p}=Ee(),{crearBono:g}=Ke(),r=V({nombre:"",apellido:"",email:"",telefono:"",fecha_nacimiento:"",area_acompanamiento:"",tipo_bono:"",activo:!0,en_pausa:!1,crear_bono:!1,bono_monto:null,bono_renovacion_automatica:!1}),y=A(()=>{const C=r.value.tipo_bono;return C?{a_demanda:1,quincenal:2,semanal:4}[C]||0:"Selecciona tipo"}),z=A(()=>{const C=r.value.tipo_bono;return{a_demanda:"A Demanda",quincenal:"Quincenal",semanal:"Semanal"}[C]||""}),q=A(()=>{const C=y.value,a=r.value.bono_monto;return C==="Selecciona tipo"||!a||C<=0?"0.00":(a/C).toFixed(2)}),l=V(!1),m=V("");ne(()=>x.mostrar,C=>{C&&x.paciente&&j()});const j=()=>{const C=x.paciente,a=C.metadata||{},c=(C.nombre_completo||C.nombre||"").split(" "),d=c[0]||a.nombre||"",f=c.slice(1).join(" ")||a.apellido||a.apellido_paterno||"";r.value={nombre:d,apellido:f,email:C.email||"",telefono:C.telefono||"",fecha_nacimiento:a.fecha_nacimiento||"",area_acompanamiento:C.area_de_acompanamiento||C.area_acompanamiento||"",tipo_bono:C.tipo_bono||"",activo:C.activo??!0,en_pausa:C.en_pausa||a.en_pausa||!1,crear_bono:!1,bono_monto:null,bono_renovacion_automatica:!1},m.value=""},O=()=>{l.value||T("cerrar")},F=async()=>{try{l.value=!0,m.value="",console.log("Actualizando paciente:",x.paciente.id);const C=`${r.value.nombre.trim()} ${r.value.apellido.trim()}`,a=x.paciente.metadata||{},{data:i,error:c}=await p.from("pacientes").update({email:r.value.email,nombre_completo:C,telefono:r.value.telefono,area_de_acompanamiento:r.value.area_acompanamiento,tipo_bono:r.value.tipo_bono,activo:r.value.activo,metadata:{...a,nombre:r.value.nombre,apellido:r.value.apellido,fecha_nacimiento:r.value.fecha_nacimiento,en_pausa:r.value.en_pausa,fecha_actualizacion:new Date().toISOString()}}).eq("id",x.paciente.id).select().single();if(c)throw console.error("Error al actualizar paciente:",c),c;if(console.log("Paciente actualizado:",i),r.value.crear_bono&&r.value.tipo_bono&&r.value.bono_monto){console.log("Creando bono para el paciente...");const d=new Date,f=new Date,b=r.value.tipo_bono;b==="a_demanda"?f.setMonth(f.getMonth()+1):b==="quincenal"?f.setDate(f.getDate()+15):b==="semanal"&&f.setMonth(f.getMonth()+1);const E=y.value;await g({paciente_id:x.paciente.id,tipo:b,sesiones_totales:E,sesiones_disponibles:E,monto_total:r.value.bono_monto,fecha_inicio:d.toISOString().split("T")[0],fecha_fin:f.toISOString().split("T")[0],estado:"pendiente",renovacion_automatica:r.value.bono_renovacion_automatica}),console.log("Bono creado exitosamente")}T("paciente-actualizado",i),T("cerrar")}catch(C){console.error("Error al actualizar paciente:",C),m.value=C.message||"Error al actualizar el paciente. Por favor, intenta nuevamente."}finally{l.value=!1}};return(C,a)=>S.mostrar?(s(),n("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:ae(O,["self"])},[e("div",Ma,[e("div",{class:"sticky top-0 bg-[#F2F2F2] border-b border-[#5550F2]/30 px-6 py-4 flex justify-between items-center"},[a[13]||(a[13]=e("h2",{class:"text-2xl font-serif text-[#2D3748] font-semibold"}," Editar Paciente ",-1)),e("button",{onClick:O,class:"text-[#2D3748] hover:text-[#5550F2] transition-colors","aria-label":"Cerrar modal"},[...a[12]||(a[12]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("form",{onSubmit:ae(F,["prevent"]),class:"px-6 py-6 space-y-6"},[e("div",Pa,[a[19]||(a[19]=e("h3",{class:"text-lg font-serif text-[#2D3748] font-semibold"}," Informaci√≥n Personal ",-1)),e("div",Aa,[e("div",null,[a[14]||(a[14]=e("label",{for:"nombre",class:"block text-sm font-medium text-[#2D3748] mb-1"},[B(" Nombre "),e("span",{class:"text-red-500"},"*")],-1)),H(e("input",{id:"nombre","onUpdate:modelValue":a[0]||(a[0]=i=>r.value.nombre=i),type:"text",required:"",class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white",placeholder:"Nombre del paciente"},null,512),[[oe,r.value.nombre]])]),e("div",null,[a[15]||(a[15]=e("label",{for:"apellido",class:"block text-sm font-medium text-[#2D3748] mb-1"},[B(" Apellido "),e("span",{class:"text-red-500"},"*")],-1)),H(e("input",{id:"apellido","onUpdate:modelValue":a[1]||(a[1]=i=>r.value.apellido=i),type:"text",required:"",class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white",placeholder:"Apellido(s) del paciente"},null,512),[[oe,r.value.apellido]])]),e("div",null,[a[16]||(a[16]=e("label",{for:"email",class:"block text-sm font-medium text-[#2D3748] mb-1"},[B(" Email "),e("span",{class:"text-red-500"},"*")],-1)),H(e("input",{id:"email","onUpdate:modelValue":a[2]||(a[2]=i=>r.value.email=i),type:"email",required:"",class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white",placeholder:"correo@ejemplo.com"},null,512),[[oe,r.value.email]])]),e("div",null,[a[17]||(a[17]=e("label",{for:"telefono",class:"block text-sm font-medium text-[#2D3748] mb-1"}," Tel√©fono ",-1)),H(e("input",{id:"telefono","onUpdate:modelValue":a[3]||(a[3]=i=>r.value.telefono=i),type:"tel",class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white",placeholder:"+52 123 456 7890"},null,512),[[oe,r.value.telefono]])]),e("div",null,[a[18]||(a[18]=e("label",{for:"fecha_nacimiento",class:"block text-sm font-medium text-[#2D3748] mb-1"}," Fecha de Nacimiento ",-1)),H(e("input",{id:"fecha_nacimiento","onUpdate:modelValue":a[4]||(a[4]=i=>r.value.fecha_nacimiento=i),type:"date",class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white"},null,512),[[oe,r.value.fecha_nacimiento]])])])]),e("div",Ia,[a[28]||(a[28]=e("h3",{class:"text-lg font-serif text-[#2D3748] font-semibold"}," Informaci√≥n Terap√©utica ",-1)),e("div",Ta,[e("div",Va,[a[21]||(a[21]=e("label",{for:"area_acompanamiento",class:"block text-sm font-medium text-[#2D3748] mb-1"},[B(" √Årea de Acompa√±amiento "),e("span",{class:"text-red-500"},"*")],-1)),H(e("select",{id:"area_acompanamiento","onUpdate:modelValue":a[5]||(a[5]=i=>r.value.area_acompanamiento=i),required:"",class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white"},[...a[20]||(a[20]=[De('<option value="" data-v-2464ce35>Selecciona un √°rea</option><option value="Ansiedad" data-v-2464ce35>Ansiedad</option><option value="Depresi√≥n" data-v-2464ce35>Depresi√≥n</option><option value="Autoestima" data-v-2464ce35>Autoestima</option><option value="Relaciones" data-v-2464ce35>Relaciones</option><option value="Duelo" data-v-2464ce35>Duelo</option><option value="Estr√©s Laboral" data-v-2464ce35>Estr√©s Laboral</option><option value="Crecimiento Personal" data-v-2464ce35>Crecimiento Personal</option><option value="Otro" data-v-2464ce35>Otro</option>',9)])],512),[[pe,r.value.area_acompanamiento]])]),e("div",null,[a[23]||(a[23]=e("label",{for:"tipo_bono",class:"block text-sm font-medium text-[#2D3748] mb-1"},[B(" Tipo de Bono "),e("span",{class:"text-red-500"},"*")],-1)),H(e("select",{id:"tipo_bono","onUpdate:modelValue":a[6]||(a[6]=i=>r.value.tipo_bono=i),required:"",class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white"},[...a[22]||(a[22]=[e("option",{value:""},"Selecciona tipo de bono",-1),e("option",{value:"a_demanda"},"A Demanda (1 sesi√≥n)",-1),e("option",{value:"quincenal"},"Quincenal (2 sesiones/mes)",-1),e("option",{value:"semanal"},"Semanal (4 sesiones/mes)",-1)])],512),[[pe,r.value.tipo_bono]])]),e("div",null,[a[25]||(a[25]=e("label",{for:"activo",class:"block text-sm font-medium text-[#2D3748] mb-1"}," Estado ",-1)),H(e("select",{id:"activo","onUpdate:modelValue":a[7]||(a[7]=i=>r.value.activo=i),class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white"},[...a[24]||(a[24]=[e("option",{value:!0},"Activo",-1),e("option",{value:!1},"Inactivo",-1)])],512),[[pe,r.value.activo]])]),e("div",Ba,[e("label",qa,[H(e("input",{"onUpdate:modelValue":a[8]||(a[8]=i=>r.value.en_pausa=i),type:"checkbox",class:"w-4 h-4 text-[#5550F2] border-gray-300 rounded focus:ring-[#5550F2]"},null,512),[[me,r.value.en_pausa]]),a[26]||(a[26]=e("span",{class:"text-sm font-medium text-[#2D3748]"}," Proceso en pausa temporal ",-1))]),a[27]||(a[27]=e("p",{class:"text-xs text-cafe/60 mt-1 ml-6"}," ‚è∏Ô∏è Marca esta opci√≥n si el seguimiento est√° pausado temporalmente ",-1))])])]),e("div",ja,[e("div",za,[a[30]||(a[30]=e("h3",{class:"text-lg font-serif text-[#2D3748] font-semibold"}," Gesti√≥n de Bonos ",-1)),e("label",Ra,[H(e("input",{"onUpdate:modelValue":a[9]||(a[9]=i=>r.value.crear_bono=i),type:"checkbox",class:"w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500"},null,512),[[me,r.value.crear_bono]]),a[29]||(a[29]=e("span",{class:"text-sm font-medium text-[#2D3748]"}," üé´ Crear nuevo bono para este paciente ",-1))])]),r.value.crear_bono?(s(),n("div",Ua,[e("div",Oa,[a[32]||(a[32]=e("svg",{class:"w-5 h-5 text-purple-600 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})],-1)),e("div",Na,[e("p",La,[a[31]||(a[31]=B("El bono usar√° el tipo seleccionado arriba: ",-1)),e("strong",null,u(z.value||"Selecciona un tipo primero"),1)]),e("p",Ha," Sesiones incluidas: "+u(y.value==="Selecciona tipo"?"N/A":y.value),1)])]),e("div",Ga,[e("div",null,[a[34]||(a[34]=e("label",{for:"bono_monto",class:"block text-sm font-medium text-[#2D3748] mb-1"},[B(" Monto Total "),e("span",{class:"text-red-500"},"*")],-1)),e("div",Qa,[a[33]||(a[33]=e("span",{class:"absolute left-3 top-2.5 text-[#2D3748] font-medium"},"‚Ç¨",-1)),H(e("input",{id:"bono_monto","onUpdate:modelValue":a[10]||(a[10]=i=>r.value.bono_monto=i),type:"number",min:"0",step:"0.01",required:r.value.crear_bono,class:"w-full pl-8 pr-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white",placeholder:"0.00"},null,8,Ja),[[oe,r.value.bono_monto,void 0,{number:!0}]])])]),e("div",null,[a[35]||(a[35]=e("label",{class:"block text-sm font-medium text-[#2D3748] mb-1"}," Precio por Sesi√≥n ",-1)),e("div",Ka," ‚Ç¨"+u(q.value),1)]),e("div",Xa,[e("label",Ya,[H(e("input",{"onUpdate:modelValue":a[11]||(a[11]=i=>r.value.bono_renovacion_automatica=i),type:"checkbox",class:"w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500"},null,512),[[me,r.value.bono_renovacion_automatica]]),a[36]||(a[36]=e("span",{class:"text-sm font-medium text-[#2D3748]"}," üîÑ Renovaci√≥n autom√°tica al vencer ",-1))]),a[37]||(a[37]=e("p",{class:"text-xs text-cafe/60 mt-1 ml-6"}," El sistema crear√° un nuevo bono id√©ntico cuando este expire ",-1))])]),y.value&&r.value.bono_monto?(s(),n("div",Za,[a[46]||(a[46]=e("p",{class:"text-sm font-medium text-[#2D3748] mb-2"},"üìã Resumen del Bono:",-1)),e("div",Wa,[e("p",null,[a[38]||(a[38]=B("‚Ä¢ ",-1)),a[39]||(a[39]=e("strong",null,"Tipo:",-1)),B(" "+u(z.value),1)]),e("p",null,[a[40]||(a[40]=B("‚Ä¢ ",-1)),a[41]||(a[41]=e("strong",null,"Sesiones:",-1)),B(" "+u(y.value),1)]),e("p",null,[a[42]||(a[42]=B("‚Ä¢ ",-1)),a[43]||(a[43]=e("strong",null,"Total:",-1)),B(" ‚Ç¨"+u(r.value.bono_monto.toFixed(2)),1)]),e("p",null,[a[44]||(a[44]=B("‚Ä¢ ",-1)),a[45]||(a[45]=e("strong",null,"Por sesi√≥n:",-1)),B(" ‚Ç¨"+u(q.value),1)]),r.value.bono_renovacion_automatica?(s(),n("p",es,"‚Ä¢ ‚úÖ Con renovaci√≥n autom√°tica")):P("",!0)])])):P("",!0)])):P("",!0)]),m.value?(s(),n("div",ts,[e("p",os,u(m.value),1)])):P("",!0),e("div",as,[e("button",{type:"button",onClick:O,disabled:l.value,class:"px-6 py-2 border border-[#5550F2] text-[#2D3748] rounded-lg hover:bg-[#5550F2]/10 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"}," Cancelar ",8,ss),e("button",{type:"submit",disabled:l.value,class:"px-6 py-2 bg-[#5550F2] text-white rounded-lg hover:bg-[#C69F91] transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"},[l.value?(s(),n("span",ns)):P("",!0),B(" "+u(l.value?"Actualizando...":"Guardar Cambios"),1)],8,rs)])],32)])])):P("",!0)}},is=ce(ls,[["__scopeId","data-v-2464ce35"]]),ds={class:"bg-[#F2F2F2] rounded-lg shadow-xl max-w-md w-full"},cs={class:"px-6 py-6 space-y-4"},us={class:"text-[#2D3748]"},ps={class:"font-semibold"},ms={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},bs=["disabled"],gs={key:0,class:"bg-red-50 border border-red-200 rounded-lg p-3"},fs={class:"text-sm text-red-600"},vs={class:"px-6 py-4 border-t border-[#5550F2]/30 flex justify-end gap-3"},xs=["disabled"],hs=["disabled"],ys={key:0,class:"inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"},_s={__name:"ModalEliminarPaciente",props:{mostrar:{type:Boolean,default:!1},paciente:{type:Object,default:null}},emits:["cerrar","paciente-eliminado","paciente-desactivado"],setup(S,{emit:D}){const x=S,T=D,{supabase:p}=Ee(),g=V(!1),r=V(""),y=A(()=>x.paciente?x.paciente.nombre_completo||x.paciente.nombre||x.paciente.email||"este paciente":""),z=()=>{g.value||(r.value="",T("cerrar"))},q=async()=>{try{g.value=!0,r.value="",console.log("Desactivando paciente:",x.paciente.id);const{error:m}=await p.from("pacientes").update({activo:!1,metadata:{...x.paciente.metadata,fecha_desactivacion:new Date().toISOString()}}).eq("id",x.paciente.id);if(m)throw m;console.log("Paciente desactivado exitosamente"),T("paciente-desactivado",x.paciente.id),T("cerrar")}catch(m){console.error("Error al desactivar paciente:",m),r.value=m.message||"Error al desactivar el paciente."}finally{g.value=!1}},l=async()=>{try{g.value=!0,r.value="",console.log("Eliminando paciente:",x.paciente.id),await p.from("metricas_bienestar").delete().eq("paciente_id",x.paciente.id),await p.from("notas_terapeuticas").delete().eq("paciente_id",x.paciente.id),await p.from("recursos_compartidos").delete().eq("paciente_id",x.paciente.id),await p.from("mensajes").delete().or(`remitente_id.eq.${x.paciente.id},destinatario_id.eq.${x.paciente.id}`),await p.from("bonos").delete().eq("paciente_id",x.paciente.id),await p.from("sesiones").delete().eq("paciente_id",x.paciente.id);const{error:m}=await p.from("pacientes").delete().eq("id",x.paciente.id);if(m)throw m;console.log("Paciente eliminado exitosamente"),T("paciente-eliminado",x.paciente.id),T("cerrar")}catch(m){console.error("Error al eliminar paciente:",m),r.value=m.message||"Error al eliminar el paciente. Por favor, intenta nuevamente."}finally{g.value=!1}};return(m,j)=>S.mostrar?(s(),n("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:ae(z,["self"])},[e("div",ds,[j[5]||(j[5]=e("div",{class:"px-6 py-4 border-b border-[#5550F2]/30"},[e("div",{class:"flex items-center gap-3"},[e("span",{class:"text-3xl"},"‚ö†Ô∏è"),e("h2",{class:"text-2xl font-serif text-[#2D3748] font-semibold"}," Eliminar Paciente ")])],-1)),e("div",cs,[e("p",us,[j[0]||(j[0]=B(" ¬øEst√°s seguro de que deseas eliminar a ",-1)),e("strong",ps,u(y.value),1),j[1]||(j[1]=B("? ",-1))]),j[4]||(j[4]=e("div",{class:"bg-red-50 border border-red-200 rounded-lg p-4 space-y-2"},[e("p",{class:"text-sm text-red-800 font-medium"}," Esta acci√≥n no se puede deshacer y eliminar√°: "),e("ul",{class:"text-sm text-red-700 space-y-1 ml-4 list-disc"},[e("li",null,"Todos los datos personales del paciente"),e("li",null,"El historial de sesiones"),e("li",null,"Las notas terap√©uticas"),e("li",null,"Las m√©tricas de bienestar"),e("li",null,"Los bonos asociados")])],-1)),e("div",ms,[j[2]||(j[2]=e("p",{class:"text-sm text-blue-800 font-medium mb-2"}," üí° Recomendaci√≥n: ",-1)),j[3]||(j[3]=e("p",{class:"text-sm text-blue-700 mb-3"},[B(" En lugar de eliminar, considera "),e("strong",null,"desactivar"),B(" al paciente. Esto preservar√° el historial para consultas futuras. ")],-1)),e("button",{type:"button",onClick:q,disabled:g.value,class:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-sm"}," Desactivar en lugar de eliminar ",8,bs)]),r.value?(s(),n("div",gs,[e("p",fs,u(r.value),1)])):P("",!0)]),e("div",vs,[e("button",{type:"button",onClick:z,disabled:g.value,class:"px-6 py-2 border border-[#5550F2] text-[#2D3748] rounded-lg hover:bg-[#5550F2]/10 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"}," Cancelar ",8,xs),e("button",{type:"button",onClick:l,disabled:g.value,class:"px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"},[g.value?(s(),n("span",ys)):P("",!0),B(" "+u(g.value?"Eliminando...":"Eliminar Definitivamente"),1)],8,hs)])])])):P("",!0)}},ws=ce(_s,[["__scopeId","data-v-941153fc"]]),ks={class:"bg-white dark:bg-gray-900 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden"},$s={class:"px-6 py-4 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20"},Cs={key:0,class:"text-sm text-gray-600 dark:text-gray-400 mt-1"},Ds={key:0,class:"p-12 flex flex-col items-center justify-center"},Es={class:"space-y-6"},Ss={class:"space-y-2"},Fs={class:"flex gap-2 flex-wrap"},Ms=["onClick"],Ps={class:"text-xs text-gray-500 dark:text-gray-400 capitalize"},As={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Is={class:"md:col-span-2"},Ts={class:"space-y-3"},Vs={class:"grid grid-cols-4 sm:grid-cols-6 gap-2 max-h-48 overflow-y-auto p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg border border-gray-200 dark:border-gray-700"},Bs=["onClick"],qs={class:"text-xs"},js={class:"mt-2"},zs={key:0,class:"p-4 bg-yellow-50 dark:bg-yellow-900/20 border-2 border-yellow-300 dark:border-yellow-700 rounded-lg"},Rs={class:"grid grid-cols-3 gap-3"},Us=["onClick"],Os={class:"text-2xl mb-1"},Ns={class:"text-sm font-medium text-gray-900 dark:text-white"},Ls={class:"grid grid-cols-2 md:grid-cols-4 gap-3"},Hs=["onClick"],Gs={class:"text-xl mb-1"},Qs={class:"text-xs font-medium text-gray-900 dark:text-white"},Js={class:"px-6 py-4 border-t border-gray-200 dark:border-gray-800 flex gap-3 bg-gray-50 dark:bg-gray-800"},Ks=["disabled"],Xs={key:0},Ys={key:1},Zs=_e({__name:"ModalEditarCita",props:{isOpen:{type:Boolean},citaId:{}},emits:["close","actualizado"],setup(S,{emit:D}){const x=S,T=D,p=Qe(),{actualizarCita:g,getCitasPorDia:r}=Xe(),y=V(null),z=V(!1),q=V(!1),l=V(!1),m=V({fecha_cita:"",hora_inicio:"",hora_fin:"",duracion:60,modalidad:"presencial",estado:"pendiente",observaciones:""}),j=A(()=>m.value.fecha_cita?new Date(m.value.fecha_cita+"T00:00:00").toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long",year:"numeric"}):""),O=A(()=>{const f=new Date,b=[],E=k=>k.toISOString().split("T")[0];b.push({label:"Hoy",fecha:E(f)});const U=new Date(f);U.setDate(U.getDate()+1),b.push({label:"Ma√±ana",fecha:E(U)});const Z=["Lun","Mar","Mi√©","Jue","Vie"];let $=new Date(f),o=0;for(;o<5;){$.setDate($.getDate()+1);const k=$.getDay();k>=1&&k<=5&&(b.push({label:`${Z[k-1]} ${$.getDate()}`,fecha:E($)}),o++)}return b}),F=["08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00","18:30","19:00","19:30","20:00","20:30","21:00","21:30","22:00"],C=async()=>{if(console.log("üîç [ModalEditarCita] Cargando cita con ID:",x.citaId),!x.citaId){console.warn("‚ö†Ô∏è [ModalEditarCita] No hay citaId proporcionado");return}try{z.value=!0;const{data:f,error:b}=await p.from("citas").select(`
        *,
        paciente:pacientes!citas_paciente_id_fkey (
          id,
          nombre_completo,
          email,
          telefono
        )
      `).eq("id",x.citaId).single();if(b)throw console.error("‚ùå [ModalEditarCita] Error en query:",b),b;console.log("‚úÖ [ModalEditarCita] Cita cargada:",f),f&&(y.value=f,m.value={fecha_cita:f.fecha_cita,hora_inicio:f.hora_inicio?.substring(0,5)||"",hora_fin:f.hora_fin?.substring(0,5)||"",duracion:f.duracion||60,modalidad:f.modalidad||"presencial",estado:f.estado||"pendiente",observaciones:f.observaciones||""},console.log("üìù [ModalEditarCita] Formulario llenado:",m.value))}catch(f){console.error("üí• [ModalEditarCita] Error al cargar cita:",f)}finally{z.value=!1}},a=async()=>{if(!m.value.fecha_cita||!m.value.hora_inicio||!m.value.hora_fin){l.value=!1;return}try{const b=(await r(m.value.fecha_cita)).filter(Z=>Z.estado!=="cancelada"&&Z.id!==x.citaId),E=m.value.hora_inicio,U=m.value.hora_fin;l.value=b.some(Z=>{const $=Z.hora_inicio?.substring(0,5),o=Z.hora_fin?.substring(0,5),k=i(E),Y=i(U),I=i($),W=i(o);return k>=I&&k<W||Y>I&&Y<=W||k<=I&&Y>=W})}catch(f){console.error("Error al verificar conflicto:",f),l.value=!1}},i=f=>{if(!f||!f.includes(":"))return 0;const[b,E]=f.split(":").map(Number);return(b||0)*60+(E||0)};ne(()=>m.value.hora_inicio,f=>{if(f&&m.value.duracion){const[b,E]=f.split(":").map(Number),U=(b||0)*60+(E||0)+m.value.duracion,Z=Math.floor(U/60),$=U%60;m.value.hora_fin=`${String(Z).padStart(2,"0")}:${String($).padStart(2,"0")}`}}),ne(()=>m.value.duracion,f=>{if(m.value.hora_inicio&&f){const[b,E]=m.value.hora_inicio.split(":").map(Number),U=(b||0)*60+(E||0)+f,Z=Math.floor(U/60),$=U%60;m.value.hora_fin=`${String(Z).padStart(2,"0")}:${String($).padStart(2,"0")}`}}),ne([()=>m.value.fecha_cita,()=>m.value.hora_inicio,()=>m.value.hora_fin],()=>{a()});const c=async()=>{if(x.citaId&&(await a(),!l.value))try{q.value=!0,(await g(x.citaId,{fecha_cita:m.value.fecha_cita,hora_inicio:m.value.hora_inicio,hora_fin:m.value.hora_fin,modalidad:m.value.modalidad,estado:m.value.estado,observaciones:m.value.observaciones})).success&&(T("actualizado"),T("close"))}catch(f){console.error("Error al actualizar cita:",f)}finally{q.value=!1}},d=()=>{T("close")};return ne(()=>x.isOpen,f=>{console.log("üëÅÔ∏è [ModalEditarCita] Modal abierto:",f,"citaId:",x.citaId),f&&x.citaId&&C()}),ne(()=>x.citaId,f=>{console.log("üîÑ [ModalEditarCita] citaId cambi√≥ a:",f),x.isOpen&&f&&C()}),(f,b)=>(s(),re(Ve,{to:"body"},[S.isOpen?(s(),n("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:ae(d,["self"])},[e("div",ks,[e("div",$s,[e("div",null,[b[5]||(b[5]=e("h2",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"‚úèÔ∏è Editar Cita",-1)),y.value?(s(),n("p",Cs,u(y.value.paciente?.nombre_completo||y.value.paciente_nombre),1)):P("",!0)]),e("button",{onClick:d,class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors","aria-label":"Cerrar"},[...b[6]||(b[6]=[e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),z.value?(s(),n("div",Ds,[...b[7]||(b[7]=[e("div",{class:"w-12 h-12 border-4 border-purple-200 border-t-purple-600 rounded-full animate-spin mb-4"},null,-1),e("p",{class:"text-gray-600 dark:text-gray-400"},"Cargando...",-1)])])):y.value?(s(),n("form",{key:1,onSubmit:ae(c,["prevent"]),class:"px-6 py-4 overflow-y-auto max-h-[calc(90vh-200px)]"},[e("div",Es,[e("div",null,[b[8]||(b[8]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," üìÖ Fecha ",-1)),e("div",Ss,[H(e("input",{"onUpdate:modelValue":b[0]||(b[0]=E=>m.value.fecha_cita=E),type:"date",required:"",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-800 dark:text-white cursor-pointer"},null,512),[[oe,m.value.fecha_cita]]),e("div",Fs,[(s(!0),n(J,null,K(O.value,(E,U)=>(s(),n("button",{key:U,type:"button",onClick:Z=>E.fecha&&(m.value.fecha_cita=E.fecha),class:G(["text-xs px-3 py-1.5 rounded-lg border transition-all",m.value.fecha_cita===E.fecha?"bg-purple-600 text-white border-purple-600 font-semibold":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 border-gray-300 dark:border-gray-600 hover:border-purple-500 hover:bg-purple-50 dark:hover:bg-purple-900/20"])},u(E.label),11,Ms))),128))]),e("p",Ps,u(j.value),1)])]),e("div",As,[e("div",Is,[b[10]||(b[10]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," üïê Hora Inicio ",-1)),e("div",Ts,[e("div",Vs,[(s(),n(J,null,K(F,E=>e("button",{key:E,type:"button",onClick:U=>m.value.hora_inicio=E,class:G(["px-3 py-2 text-sm font-medium rounded-lg transition-all border-2",m.value.hora_inicio===E?"bg-purple-600 text-white border-purple-600 shadow-md transform scale-105":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 border-gray-200 dark:border-gray-600 hover:border-purple-500 hover:bg-purple-50 dark:hover:bg-purple-900/20 hover:shadow"])},u(E),11,Bs)),64))]),e("details",qs,[b[9]||(b[9]=e("summary",{class:"cursor-pointer text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 select-none flex items-center gap-1"},[e("span",null,"‚å®Ô∏è"),e("span",null,"Ingresar hora manualmente")],-1)),e("div",js,[H(e("input",{"onUpdate:modelValue":b[1]||(b[1]=E=>m.value.hora_inicio=E),type:"time",required:"",step:"1800",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-800 dark:text-white"},null,512),[[oe,m.value.hora_inicio]])])])])]),e("div",null,[b[12]||(b[12]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," ‚è±Ô∏è Duraci√≥n (min) ",-1)),H(e("select",{"onUpdate:modelValue":b[2]||(b[2]=E=>m.value.duracion=E),class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-800 dark:text-white"},[...b[11]||(b[11]=[e("option",{value:30},"30 min",-1),e("option",{value:45},"45 min",-1),e("option",{value:60},"60 min",-1),e("option",{value:90},"90 min",-1)])],512),[[pe,m.value.duracion]])]),e("div",null,[b[13]||(b[13]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," üïë Hora Fin ",-1)),H(e("input",{"onUpdate:modelValue":b[3]||(b[3]=E=>m.value.hora_fin=E),type:"time",required:"",readonly:"",step:"1800",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-800 dark:text-white"},null,512),[[oe,m.value.hora_fin]])])]),l.value?(s(),n("div",zs,[...b[14]||(b[14]=[e("div",{class:"flex items-start gap-3"},[e("span",{class:"text-2xl"},"‚ö†Ô∏è"),e("div",null,[e("div",{class:"font-semibold text-yellow-800 dark:text-yellow-300 mb-1"}," Conflicto de Horario "),e("div",{class:"text-sm text-yellow-700 dark:text-yellow-400"}," Ya existe otra cita en este horario. Por favor, selecciona otro horario. ")])],-1)])])):P("",!0),e("div",null,[b[15]||(b[15]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," üíª Modalidad ",-1)),e("div",Rs,[(s(),n(J,null,K([{valor:"presencial",icono:"üè•",nombre:"Presencial"},{valor:"online",icono:"üíª",nombre:"Online"},{valor:"telefonica",icono:"üìû",nombre:"Tel√©fono"}],E=>e("button",{key:E.valor,type:"button",onClick:U=>m.value.modalidad=E.valor,class:G(["p-3 border-2 rounded-lg transition-all",m.value.modalidad===E.valor?"border-purple-600 bg-purple-50 dark:bg-purple-900/20":"border-gray-300 dark:border-gray-700 hover:border-purple-400"])},[e("div",Os,u(E.icono),1),e("div",Ns,u(E.nombre),1)],10,Us)),64))])]),e("div",null,[b[16]||(b[16]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," üìä Estado ",-1)),e("div",Ls,[(s(),n(J,null,K([{valor:"pendiente",icono:"‚è≥",nombre:"Pendiente"},{valor:"confirmada",icono:"‚úÖ",nombre:"Confirmada"},{valor:"realizada",icono:"‚úì",nombre:"Realizada"},{valor:"cancelada",icono:"‚ùå",nombre:"Cancelada"}],E=>e("button",{key:E.valor,type:"button",onClick:U=>m.value.estado=E.valor,class:G(["p-2 border-2 rounded-lg transition-all",m.value.estado===E.valor?"border-purple-600 bg-purple-50 dark:bg-purple-900/20":"border-gray-300 dark:border-gray-700 hover:border-purple-400"])},[e("div",Gs,u(E.icono),1),e("div",Qs,u(E.nombre),1)],10,Hs)),64))])]),e("div",null,[b[17]||(b[17]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," üìù Observaciones ",-1)),H(e("textarea",{"onUpdate:modelValue":b[4]||(b[4]=E=>m.value.observaciones=E),rows:"3",placeholder:"Notas adicionales sobre la cita...",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-800 dark:text-white"},null,512),[[oe,m.value.observaciones]])])])],32)):P("",!0),e("div",Js,[e("button",{onClick:d,type:"button",class:"flex-1 px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors font-medium"}," Cancelar "),e("button",{onClick:c,disabled:q.value||l.value,class:G(["flex-1 px-4 py-2 rounded-lg font-medium transition-colors",q.value||l.value?"bg-gray-400 dark:bg-gray-600 text-gray-200 cursor-not-allowed":"bg-purple-600 hover:bg-purple-700 text-white"])},[q.value?(s(),n("span",Xs,"Guardando...")):(s(),n("span",Ys,"üíæ Guardar Cambios"))],10,Ks)])])])):P("",!0)]))}}),Ws=Object.assign(ce(Zs,[["__scopeId","data-v-e8361a38"]]),{__name:"ModalEditarCita"}),Ce=V([]);let er=0;const Fe=()=>{const S=(r,y,z=5e3)=>{const q=++er,l={id:q,type:r,message:y,duration:z};return Ce.value.push(l),z>0&&setTimeout(()=>{D(q)},z),q},D=r=>{const y=Ce.value.findIndex(z=>z.id===r);y>-1&&Ce.value.splice(y,1)};return{toasts:Ce,addToast:S,removeToast:D,success:(r,y)=>S("success",r,y),error:(r,y)=>S("error",r,y),warning:(r,y)=>S("warning",r,y),info:(r,y)=>S("info",r,y)}},tr={class:"fixed bottom-4 right-4 z-50 flex flex-col gap-3 max-w-sm w-full pointer-events-none",role:"region","aria-live":"polite","aria-label":"Notificaciones"},or={class:"flex-shrink-0"},ar={class:"text-sm font-medium flex-1"},sr=["onClick","aria-label"],rr={__name:"ToastContainer",setup(S){const{toasts:D,removeToast:x}=Fe(),T=p=>{const g={success:"border-green-200 bg-green-50 text-green-800",error:"border-red-200 bg-red-50 text-red-800",warning:"border-amber-200 bg-amber-50 text-amber-800",info:"border-blue-200 bg-blue-50 text-blue-800"};return g[p]||g.info};return(p,g)=>(s(),n("div",tr,[M(xt,{name:"toast"},{default:Be(()=>[(s(!0),n(J,null,K(t(D),r=>(s(),n("div",{key:r.id,class:G(["pointer-events-auto bg-white rounded-lg shadow-lg border p-4 flex items-start gap-3 transition-all duration-300",T(r.type)]),role:"alert"},[e("div",or,[r.type==="success"?(s(),re(t(ie),{key:0,class:"w-5 h-5","aria-hidden":"true"})):r.type==="error"?(s(),re(t(be),{key:1,class:"w-5 h-5","aria-hidden":"true"})):r.type==="warning"?(s(),re(t(xe),{key:2,class:"w-5 h-5","aria-hidden":"true"})):(s(),re(t(qe),{key:3,class:"w-5 h-5","aria-hidden":"true"}))]),e("p",ar,u(r.message),1),e("button",{onClick:y=>t(x)(r.id),class:"min-h-[44px] min-w-[44px] p-2 -mr-2 -mt-2 hover:bg-gray-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-gray-300","aria-label":`Cerrar notificaci√≥n: ${r.message}`},[M(t(Se),{class:"w-4 h-4","aria-hidden":"true"})],8,sr)],2))),128))]),_:1})]))}},nr=ce(rr,[["__scopeId","data-v-4b6dd325"]]),lr={class:"mb-4"},ir={key:0},dr={class:"inline-block"},cr={class:"min-h-[44px] px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all font-medium shadow-sm hover:shadow-md cursor-pointer inline-flex items-center gap-2"},ur=["accept","aria-label"],pr={class:"text-xs text-gray-400 mt-4"},mr={class:"text-xs text-gray-400"},br={key:1,class:"flex items-center justify-center gap-4"},gr={class:"text-left flex-1"},fr={class:"text-sm font-semibold text-cafe"},vr={class:"text-xs text-gray-500"},xr={key:2,class:"mt-4 p-3 bg-red-100 border border-red-300 rounded-lg"},hr={class:"text-sm text-red-800 font-medium"},yr=_e({__name:"FileDropzone",props:{accept:{default:".csv,.xlsx,.xls"},maxSize:{default:10*1024*1024},supportedFormats:{default:"CSV, XLSX"},ariaLabel:{default:"Seleccionar archivo para subir"}},emits:["file-selected","file-removed","error"],setup(S,{expose:D,emit:x}){const T=S,p=x,g=V(null),r=V(!1),y=V(""),z=A(()=>!!y.value),q=A(()=>Math.round(T.maxSize/(1024*1024))),l=i=>{if(y.value="",i.size>T.maxSize)return y.value=`El archivo es demasiado grande. M√°ximo permitido: ${q.value}MB`,p("error",y.value),!1;const c=i.name.split(".").pop()?.toLowerCase(),d=T.accept.split(",").map(f=>f.trim().replace(".",""));return!c||!d.includes(c)?(y.value=`Formato de archivo no v√°lido. Solo se permiten: ${T.supportedFormats}`,p("error",y.value),!1):!0},m=i=>{const c=i.target,d=c.files?.[0];d&&l(d)&&(g.value=d,p("file-selected",d)),c.value=""},j=i=>{r.value=!0},O=i=>{r.value=!1},F=i=>{r.value=!1;const c=i.dataTransfer?.files[0];c&&l(c)&&(g.value=c,p("file-selected",c))},C=()=>{g.value=null,y.value="",p("file-removed")},a=i=>{if(i===0)return"0 Bytes";const c=1024,d=["Bytes","KB","MB","GB"],f=Math.floor(Math.log(i)/Math.log(c));return Math.round(i/Math.pow(c,f)*100)/100+" "+d[f]};return D({removeFile:C}),(i,c)=>(s(),n("div",{onDragover:ae(j,["prevent"]),onDragleave:O,onDrop:ae(F,["prevent"]),class:G(["relative border-2 border-dashed rounded-xl p-8 transition-all duration-200 text-center",[t(r)?"border-purple-600 bg-purple-50":"border-gray-300 bg-gray-50",t(z)?"border-red-400 bg-red-50":"",t(g)?"border-green-400 bg-green-50":""]])},[e("div",lr,[t(g)?(s(),re(t(ye),{key:1,class:"w-12 h-12 mx-auto text-green-600","aria-hidden":"true"})):(s(),re(t(je),{key:0,class:G(["w-12 h-12 mx-auto",t(r)?"text-purple-600":"text-gray-400"]),"aria-hidden":"true"},null,8,["class"]))]),t(g)?(s(),n("div",br,[e("div",gr,[e("p",fr,u(t(g).name),1),e("p",vr,u(a(t(g).size)),1)]),e("button",{onClick:C,class:"min-h-[44px] min-w-[44px] p-2 text-red-600 hover:bg-red-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-red-300","aria-label":"Eliminar archivo"},[M(t(Se),{class:"w-6 h-6","aria-hidden":"true"})])])):(s(),n("div",ir,[c[1]||(c[1]=e("p",{class:"text-lg font-medium text-cafe mb-2"}," Arrastra tu archivo aqu√≠ ",-1)),c[2]||(c[2]=e("p",{class:"text-sm text-gray-500 mb-4"}," o haz clic para seleccionar ",-1)),e("label",dr,[e("span",cr,[M(t(Bt),{class:"w-5 h-5","aria-hidden":"true"}),c[0]||(c[0]=e("span",null,"Seleccionar archivo",-1))]),e("input",{type:"file",accept:S.accept,onChange:m,class:"hidden","aria-label":S.ariaLabel},null,40,ur)]),e("p",pr,u(S.supportedFormats),1),e("p",mr," Tama√±o m√°ximo: "+u(t(q))+"MB ",1)])),t(y)?(s(),n("div",xr,[e("p",hr,u(t(y)),1)])):P("",!0)],34))}}),_r=Object.assign(yr,{__name:"SharedFileDropzone"}),wr={class:"space-y-6"},kr={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},$r={class:"flex gap-3"},Cr={class:"overflow-x-auto border border-gray-200 rounded-lg"},Dr={class:"w-full text-sm"},Er={class:"divide-y divide-gray-200"},Sr={class:"px-4 py-3"},Fr={class:"font-medium text-gray-900"},Mr={class:"px-4 py-3"},Pr={class:"flex flex-wrap gap-1 max-w-xs"},Ar=["title"],Ir={class:"px-4 py-3"},Tr=["value","onChange"],Vr={label:"Campos obligatorios"},Br=["value","disabled"],qr={label:"Contacto"},jr=["value","disabled"],zr={label:"Tratamiento"},Rr=["value","disabled"],Ur={label:"Otros campos"},Or=["value","disabled"],Nr={class:"px-4 py-3 text-center"},Lr={key:0,class:"inline-flex items-center gap-1 px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium"},Hr={key:1,class:"inline-flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-medium"},Gr={key:2,class:"inline-flex items-center gap-1 px-2 py-1 bg-gray-100 text-gray-500 rounded-full text-xs"},Qr={key:0,class:"bg-red-50 border border-red-200 rounded-lg p-4"},Jr={class:"flex gap-3"},Kr={class:"list-disc list-inside text-red-800 space-y-1 text-sm"},Xr={key:1,class:"bg-amber-50 border border-amber-200 rounded-lg p-4"},Yr={class:"flex gap-3"},Zr={class:"list-disc list-inside text-amber-800 space-y-1 text-sm"},Wr={key:2,class:"space-y-3"},en={class:"font-semibold text-gray-900 flex items-center gap-2"},tn={class:"overflow-x-auto border border-gray-200 rounded-lg"},on={class:"w-full text-sm"},an={class:"bg-purple-50"},sn={class:"divide-y divide-gray-100"},rn={class:"text-xs text-gray-500"},nn=_e({__name:"ColumnMappingTable",props:{detectedColumns:{},mappings:{},validation:{}},emits:["update:mapping"],setup(S,{emit:D}){const x=S,T=D,p=[{field:"nombre_completo",label:"Nombre Completo"},{field:"email",label:"Email"},{field:"telefono",label:"Tel√©fono"}],g=[{field:"documento_identidad",label:"Documento de Identidad"},{field:"fecha_nacimiento",label:"Fecha de Nacimiento"},{field:"direccion",label:"Direcci√≥n"},{field:"contacto_emergencia",label:"Contacto de Emergencia"}],r=[{field:"area_de_acompanamiento",label:"√Årea de Acompa√±amiento"},{field:"frecuencia",label:"Frecuencia de Sesiones"},{field:"activo",label:"Estado (Activo/Inactivo)"},{field:"derivacion",label:"Derivaci√≥n"},{field:"medicacion",label:"Medicaci√≥n"},{field:"orientacion_diagnostica",label:"Orientaci√≥n Diagn√≥stica"},{field:"inicio_tratamiento",label:"Inicio del Tratamiento"}],y=[{field:"precio_sesion",label:"Precio por Sesi√≥n"},{field:"comision",label:"Comisi√≥n"},{field:"notas",label:"Notas / Observaciones"}],z=[...p,...g,...r,...y],q=a=>x.mappings.find(c=>c.sourceColumn===a)?.targetField||"",l=(a,i)=>x.mappings.some(c=>c.targetField===a&&c.sourceColumn!==i),m=a=>p.some(i=>i.field===a),j=a=>z.find(i=>i.field===a)?.label||a,O=(a,i)=>{T("update:mapping",a,i)},F=A(()=>x.mappings.filter(a=>a.targetField).map(a=>a.targetField)),C=A(()=>{if(!x.detectedColumns.length||!F.value.length)return[];const a=Math.min(x.detectedColumns[0]?.sampleValues?.length||0,3),i=[];for(let c=0;c<a;c++){const d={};for(const f of x.mappings)if(f.targetField){const b=x.detectedColumns.find(E=>E.name===f.sourceColumn);d[f.targetField]=b?.sampleValues?.[c]||""}Object.keys(d).length>0&&i.push(d)}return i});return(a,i)=>(s(),n("div",wr,[e("div",kr,[e("div",$r,[M(t(qe),{class:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),i[0]||(i[0]=e("div",null,[e("p",{class:"font-semibold text-blue-900 mb-1"}," Relaciona las columnas de tu archivo con los campos de Terapl√≠ "),e("p",{class:"text-sm text-blue-800"}," Hemos detectado autom√°ticamente algunos campos. Revisa y ajusta seg√∫n necesites. ")],-1))])]),e("div",Cr,[e("table",Dr,[i[4]||(i[4]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left font-semibold text-gray-700"}," Columna en tu archivo "),e("th",{class:"px-4 py-3 text-left font-semibold text-gray-700"}," Valores de ejemplo "),e("th",{class:"px-4 py-3 text-left font-semibold text-gray-700"}," Campo Terapl√≠ "),e("th",{class:"px-4 py-3 text-center font-semibold text-gray-700 w-24"}," Estado ")])],-1)),e("tbody",Er,[(s(!0),n(J,null,K(S.detectedColumns,c=>(s(),n("tr",{key:c.name,class:"hover:bg-gray-50"},[e("td",Sr,[e("span",Fr,u(c.name),1)]),e("td",Mr,[e("div",Pr,[(s(!0),n(J,null,K(c.sampleValues.slice(0,3),(d,f)=>(s(),n("span",{key:f,class:"inline-block px-2 py-0.5 bg-gray-100 text-gray-600 rounded text-xs truncate max-w-[120px]",title:d},u(d||"(vac√≠o)"),9,Ar))),128))])]),e("td",Ir,[e("select",{value:q(c.name),onChange:d=>O(c.name,d.target.value),class:G(["w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-purple-500 focus:border-purple-500",{"border-green-400 bg-green-50":q(c.name)&&m(q(c.name)),"border-blue-300 bg-blue-50":q(c.name)&&!m(q(c.name))}])},[i[1]||(i[1]=e("option",{value:""},"-- No importar --",-1)),e("optgroup",Vr,[(s(),n(J,null,K(p,d=>e("option",{key:d.field,value:d.field,disabled:l(d.field,c.name)},u(d.label)+" "+u(l(d.field,c.name)?"(ya usado)":"*"),9,Br)),64))]),e("optgroup",qr,[(s(),n(J,null,K(g,d=>e("option",{key:d.field,value:d.field,disabled:l(d.field,c.name)},u(d.label)+" "+u(l(d.field,c.name)?"(ya usado)":""),9,jr)),64))]),e("optgroup",zr,[(s(),n(J,null,K(r,d=>e("option",{key:d.field,value:d.field,disabled:l(d.field,c.name)},u(d.label)+" "+u(l(d.field,c.name)?"(ya usado)":""),9,Rr)),64))]),e("optgroup",Ur,[(s(),n(J,null,K(y,d=>e("option",{key:d.field,value:d.field,disabled:l(d.field,c.name)},u(d.label)+" "+u(l(d.field,c.name)?"(ya usado)":""),9,Or)),64))])],42,Tr)]),e("td",Nr,[q(c.name)&&m(q(c.name))?(s(),n("span",Lr,[M(t(ie),{class:"w-3.5 h-3.5"}),i[2]||(i[2]=B(" Obligatorio ",-1))])):q(c.name)?(s(),n("span",Hr,[M(t(ie),{class:"w-3.5 h-3.5"}),i[3]||(i[3]=B(" Opcional ",-1))])):(s(),n("span",Gr," No importar "))])]))),128))])])]),S.validation?.errors?.length?(s(),n("div",Qr,[e("div",Jr,[M(t(xe),{class:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e("div",null,[i[5]||(i[5]=e("p",{class:"font-semibold text-red-900 mb-2"}," Errores que impiden la importaci√≥n: ",-1)),e("ul",Kr,[(s(!0),n(J,null,K(S.validation.errors,(c,d)=>(s(),n("li",{key:d},u(c),1))),128))])])])])):P("",!0),S.validation?.warnings?.length&&!S.validation?.errors?.length?(s(),n("div",Xr,[e("div",Yr,[M(t(be),{class:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),e("div",null,[i[6]||(i[6]=e("p",{class:"font-semibold text-amber-900 mb-2"}," Advertencias (puedes continuar): ",-1)),e("ul",Zr,[(s(!0),n(J,null,K(S.validation.warnings,(c,d)=>(s(),n("li",{key:d},u(c),1))),128))])])])])):P("",!0),t(C).length>0?(s(),n("div",Wr,[e("h4",en,[M(t(Ft),{class:"w-5 h-5 text-purple-600"}),i[7]||(i[7]=B(" Vista previa con el mapeo aplicado ",-1))]),e("div",tn,[e("table",on,[e("thead",an,[e("tr",null,[(s(!0),n(J,null,K(t(F),c=>(s(),n("th",{key:c,class:"px-3 py-2 text-left font-medium text-purple-800 whitespace-nowrap"},u(j(c)),1))),128))])]),e("tbody",sn,[(s(!0),n(J,null,K(t(C),(c,d)=>(s(),n("tr",{key:d,class:"hover:bg-gray-50"},[(s(!0),n(J,null,K(t(F),f=>(s(),n("td",{key:f,class:"px-3 py-2 text-gray-700 whitespace-nowrap"},u(c[f]||"‚Äî"),1))),128))]))),128))])])]),e("p",rn," Mostrando las primeras "+u(t(C).length)+" fila"+u(t(C).length!==1?"s":"")+" de tu archivo ",1)])):P("",!0)]))}}),ln=Object.assign(nn,{__name:"PatientsColumnMappingTable"});function dn(){const S=V(null),D=V([]),x=V(null),T=V(null),p=V(!1),g=V(!1),r=V(!1),y=V(null),z=async a=>{p.value=!0,y.value=null;try{const i=new FormData;i.append("file",a);const c=await fetch("/api/patients/import/detect-columns",{method:"POST",body:i});if(!c.ok){const f=await c.json();throw new Error(f.statusMessage||"Error al detectar columnas")}const d=await c.json();if(!d.success||!d.config)throw new Error("Respuesta inv√°lida del servidor");return S.value=d.config,D.value=d.config.mappings||[],await l(),!0}catch(i){return y.value=i.message||"Error al detectar columnas",console.error("Error en detectColumns:",i),!1}finally{p.value=!1}},q=(a,i)=>{const c=D.value.findIndex(d=>d.sourceColumn===a);c>=0?D.value[c]={sourceColumn:a,targetField:i}:D.value.push({sourceColumn:a,targetField:i}),l()},l=async()=>{if(!S.value)return y.value="No hay configuraci√≥n de importaci√≥n",!1;g.value=!0,y.value=null;try{const a=await fetch("/api/patients/import/validate-mapping",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({configId:S.value.id,mappings:D.value})});if(!a.ok){const c=await a.json();throw new Error(c.statusMessage||"Error al validar mapeo")}const i=await a.json();return x.value=i.validation,i.validation?.isValid||!1}catch(a){return y.value=a.message||"Error al validar mapeo",console.error("Error en validateMapping:",a),!1}finally{g.value=!1}},m=async(a,i)=>{if(!S.value)return y.value="No hay configuraci√≥n de importaci√≥n",!1;if(!x.value?.isValid)return y.value="El mapeo no es v√°lido",!1;r.value=!0,y.value=null;try{const c=new FormData;c.append("file",a),c.append("configId",S.value.id),c.append("action",i),c.append("mappings",JSON.stringify(D.value));const d=await fetch("/api/patients/import/execute",{method:"POST",body:c});if(!d.ok){const b=await d.json();throw new Error(b.statusMessage||"Error al importar pacientes")}const f=await d.json();return T.value=f.results,f.success}catch(c){return y.value=c.message||"Error al importar pacientes",console.error("Error en executeImport:",c),!1}finally{r.value=!1}},j=()=>{S.value=null,D.value=[],x.value=null,T.value=null,p.value=!1,g.value=!1,r.value=!1,y.value=null},O=a=>D.value.find(c=>c.sourceColumn===a)?.targetField||"",F=()=>{if(!S.value?.detectedColumns)return[];const a=Math.min(S.value.detectedColumns[0]?.sampleValues?.length||0,3),i=[];for(let c=0;c<a;c++){const d={};for(const f of D.value)if(f.targetField){const b=S.value.detectedColumns.find(E=>E.name===f.sourceColumn);d[f.targetField]=b?.sampleValues?.[c]||""}i.push(d)}return i},C=A(()=>{const a=new Set(D.value.map(d=>d.targetField).filter(d=>d!=="")),i=a.has("nombre_completo"),c=a.has("email")||a.has("telefono");return i&&c});return{config:S,mappings:D,validation:x,importResult:T,detecting:p,validating:g,importing:r,error:y,detectColumns:z,updateMapping:q,validateMapping:l,executeImport:m,reset:j,getMappedField:O,getPreviewData:F,hasRequiredFields:C}}const cn={class:"bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col"},un={class:"px-6 py-4 border-b border-gray-200 flex items-center justify-between"},pn={class:"text-sm text-gray-500 mt-1"},mn={class:"px-6 py-3 bg-gray-50"},bn={class:"flex items-center gap-2"},gn={class:"flex justify-between mt-2 text-xs text-gray-500"},fn={class:"flex-1 overflow-y-auto p-6"},vn={key:0,class:"space-y-6"},xn={class:"text-center"},hn={class:"bg-green-50 border border-green-200 rounded-lg p-4 text-sm"},yn={class:"flex gap-3"},_n={class:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-sm"},wn={class:"flex gap-3"},kn={class:"flex gap-3 justify-center pt-2"},$n=["disabled"],Cn=["disabled"],Dn={key:1,class:"space-y-6"},En={class:"text-center mb-6"},Sn={key:0,class:"bg-green-50 border border-green-200 rounded-lg p-4 text-sm"},Fn={class:"flex gap-3"},Mn={class:"flex-1"},Pn={class:"text-green-800"},An={key:1,class:"bg-purple-50 border border-purple-200 rounded-lg p-6"},In={key:2,class:"bg-red-50 border border-red-200 rounded-lg p-4 text-sm"},Tn={class:"flex gap-3"},Vn={class:"text-red-800"},Bn={key:2,class:"space-y-6"},qn={class:"text-center mb-6"},jn={key:3,class:"space-y-6"},zn={class:"text-center mb-6"},Rn={class:"bg-gray-50 border border-gray-200 rounded-lg p-4"},Un={class:"flex flex-wrap gap-2"},On={key:0,class:"bg-amber-50 border border-amber-200 rounded-lg p-4"},Nn={class:"flex gap-3"},Ln={class:"text-sm text-amber-800 space-y-1"},Hn={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},Gn={class:"flex items-start gap-3 cursor-pointer"},Qn={key:1,class:"space-y-3"},Jn={class:"overflow-x-auto border border-gray-200 rounded-lg"},Kn={class:"w-full text-sm"},Xn={class:"bg-gray-50"},Yn={class:"divide-y divide-gray-100"},Zn={key:4,class:"space-y-6"},Wn={class:"text-center mb-6"},el={class:"text-lg font-semibold text-cafe mb-2"},tl={class:"text-sm text-gray-600"},ol={key:0,class:"grid grid-cols-2 md:grid-cols-4 gap-4"},al={class:"bg-gray-50 rounded-lg p-4 text-center"},sl={class:"text-2xl font-bold text-cafe"},rl={class:"bg-green-50 rounded-lg p-4 text-center"},nl={class:"text-2xl font-bold text-green-700"},ll={class:"bg-blue-50 rounded-lg p-4 text-center"},il={class:"text-2xl font-bold text-blue-700"},dl={class:"bg-gray-100 rounded-lg p-4 text-center"},cl={class:"text-2xl font-bold text-gray-700"},ul={key:1,class:"bg-green-50 border border-green-200 rounded-lg p-4"},pl={class:"flex gap-3"},ml={key:2,class:"bg-amber-50 border border-amber-200 rounded-lg p-4"},bl={class:"flex gap-3"},gl={class:"flex-1"},fl={class:"font-semibold text-amber-900 mb-2"},vl={class:"max-h-40 overflow-y-auto space-y-2"},xl={class:"font-medium text-amber-900"},hl={class:"text-amber-700"},yl={key:0,class:"text-xs text-amber-700 italic"},_l={key:3,class:"bg-red-50 border border-red-200 rounded-lg p-4"},wl={class:"font-semibold text-red-900 mb-3 flex items-center gap-2"},kl={class:"max-h-40 overflow-y-auto space-y-2"},$l={class:"font-semibold"},Cl={class:"px-6 py-4 border-t border-gray-200 flex items-center justify-between bg-gray-50"},Dl=["disabled"],El={key:1},Sl={class:"flex gap-3"},Fl=["disabled"],Ml=["disabled"],Pl={key:0,class:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"},Al=["disabled"],Il=["disabled"],Tl={key:0,class:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"},Vl=_e({__name:"PatientsImportModal",props:{modelValue:{type:Boolean},existingPatients:{default:()=>[]}},emits:["update:modelValue","import-complete"],setup(S,{emit:D}){const x=D,T=Fe(),p=dn(),g=V(1),r=V(null),y=V(!1),z=V(!0),q=V(!1),l={nombre_completo:"Nombre Completo",email:"Email",telefono:"Tel√©fono",documento_identidad:"Documento",fecha_nacimiento:"Fecha Nac.",direccion:"Direcci√≥n",contacto_emergencia:"Contacto Emergencia",area_de_acompanamiento:"√Årea",frecuencia:"Frecuencia",activo:"Estado",derivacion:"Derivaci√≥n",medicacion:"Medicaci√≥n",orientacion_diagnostica:"Diagn√≥stico",inicio_tratamiento:"Inicio Trat.",precio_sesion:"Precio",comision:"Comisi√≥n",notas:"Notas"},m=$=>$?l[$]||$:"",j=A(()=>r.value!==null||p.config.value!==null||g.value>1),O=()=>{if(p.importing.value){T.warning("No se puede cerrar mientras se est√° importando");return}j.value&&g.value<5&&!confirm(`¬øEst√°s seguro de que deseas cancelar?

Se perder√° todo el progreso de la importaci√≥n.
Tendr√°s que empezar de nuevo si cierras ahora.`)||(x("update:modelValue",!1),setTimeout(F,300))},F=()=>{g.value=1,r.value=null,y.value=!1,z.value=!0,q.value=!1,p.reset()},C=async $=>{try{y.value=!0;const o=await fetch(`/api/patients/template?format=${$}`);if(!o.ok)throw new Error("Error al descargar la plantilla");const k=await o.blob(),Y=URL.createObjectURL(k),I=document.createElement("a");I.href=Y,I.download=`plantilla_pacientes.${$}`,document.body.appendChild(I),I.click(),document.body.removeChild(I),URL.revokeObjectURL(Y),T.success(`Plantilla ${$.toUpperCase()} descargada`)}catch(o){T.error(o.message||"Error al descargar la plantilla")}finally{y.value=!1}},a=$=>{r.value=$,p.error.value=null,T.info("Archivo seleccionado correctamente")},i=()=>{r.value=null,p.reset()},c=$=>{T.error($)},d=($,o)=>{p.updateMapping($,o)},f=()=>{g.value<5&&g.value++},b=()=>{g.value>1&&g.value--},E=async()=>{if(!r.value)return;await p.detectColumns(r.value)?(T.success("Columnas detectadas correctamente"),g.value=3):T.error(p.error.value||"Error al detectar columnas")},U=async()=>{if(!r.value)return;const $=z.value?"update":"skip";if(await p.executeImport(r.value,$)){q.value=(p.importResult.value?.errors?.length||0)===0;const k=(p.importResult.value?.created||0)+(p.importResult.value?.updated||0);T.success(`${k} paciente${k!==1?"s":""} importado${k!==1?"s":""} correctamente`),g.value=5}else T.error(p.error.value||"Error al importar pacientes")},Z=()=>{x("import-complete"),O()};return($,o)=>{const k=_r,Y=ln;return s(),re(Ve,{to:"body"},[M(Je,{name:"modal"},{default:Be(()=>[S.modelValue?(s(),n("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",onClick:ae(O,["self"]),role:"dialog","aria-modal":"true","aria-labelledby":"import-modal-title"},[e("div",cn,[e("div",un,[e("div",null,[o[3]||(o[3]=e("h2",{id:"import-modal-title",class:"text-2xl font-serif font-bold text-cafe"}," Importar Pacientes ",-1)),e("p",pn," Paso "+u(t(g))+" de 5 ",1)]),e("button",{onClick:O,class:"min-h-[44px] min-w-[44px] p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-gray-300","aria-label":"Cerrar modal"},[M(t(Se),{class:"w-6 h-6","aria-hidden":"true"})])]),e("div",mn,[e("div",bn,[(s(),n(J,null,K(5,I=>e("div",{key:I,class:G(["flex-1 h-2 rounded-full transition-all duration-300",I<=t(g)?"bg-purple-600":"bg-gray-200"])},null,2)),64))]),e("div",gn,[e("span",{class:G({"text-purple-600 font-medium":t(g)===1})},"Info",2),e("span",{class:G({"text-purple-600 font-medium":t(g)===2})},"Subir",2),e("span",{class:G({"text-purple-600 font-medium":t(g)===3})},"Mapear",2),e("span",{class:G({"text-purple-600 font-medium":t(g)===4})},"Revisar",2),e("span",{class:G({"text-purple-600 font-medium":t(g)===5})},"Resultado",2)])]),e("div",fn,[t(g)===1?(s(),n("div",vn,[e("div",xn,[M(t(Vt),{class:"w-16 h-16 mx-auto text-purple-600 mb-4","aria-hidden":"true"}),o[4]||(o[4]=e("h3",{class:"text-lg font-semibold text-cafe mb-2"}," Paso 1: Prepara tu archivo ",-1)),o[5]||(o[5]=e("p",{class:"text-sm text-gray-600 mb-2 max-w-md mx-auto"},[B(" Puedes usar "),e("strong",null,"cualquier Excel o CSV"),B(" con tus pacientes. El sistema detectar√° las columnas autom√°ticamente. ")],-1))]),e("div",hn,[e("div",yn,[M(t(ie),{class:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),o[6]||(o[6]=e("div",null,[e("p",{class:"font-semibold text-green-900 mb-2"},"¬øYa tienes un Excel con pacientes?"),e("p",{class:"text-green-800"}," ¬°Perfecto! Puedes subirlo directamente. En el siguiente paso podr√°s relacionar las columnas de tu archivo con los campos de Terapl√≠. ")],-1))])]),e("div",_n,[e("div",wn,[M(t(qe),{class:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),o[7]||(o[7]=e("div",{class:"space-y-3"},[e("div",null,[e("p",{class:"font-semibold text-blue-900 mb-1"},"Formatos aceptados:"),e("p",{class:"text-blue-800"},"CSV (.csv) y Excel (.xlsx, .xls)"),e("p",{class:"text-xs text-blue-700 mt-1"},"Tama√±o m√°ximo: 10MB | M√°ximo 5,000 filas")]),e("div",null,[e("p",{class:"font-semibold text-blue-900 mb-1"},"Campos m√≠nimos necesarios:"),e("ul",{class:"list-disc list-inside text-blue-800 space-y-1"},[e("li",null,[e("strong",null,"Nombre"),B(" del paciente (obligatorio)")]),e("li",null,[e("strong",null,"Email"),B(" o "),e("strong",null,"Tel√©fono"),B(" (al menos uno)")])])]),e("div",null,[e("p",{class:"font-semibold text-blue-900 mb-1"},"Campos adicionales soportados:"),e("p",{class:"text-blue-800 text-xs"}," Documento de identidad, Direcci√≥n, Fecha de nacimiento, √Årea de tratamiento, Frecuencia, Derivaci√≥n, Medicaci√≥n, Diagn√≥stico, Notas, Precio, y m√°s... ")])],-1))])]),e("div",kn,[e("button",{onClick:o[0]||(o[0]=I=>C("csv")),disabled:t(y),class:"min-h-[44px] px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all text-sm disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"},[M(t(ye),{class:"w-4 h-4","aria-hidden":"true"}),o[8]||(o[8]=e("span",null,"Descargar plantilla CSV",-1))],8,$n),e("button",{onClick:o[1]||(o[1]=I=>C("xlsx")),disabled:t(y),class:"min-h-[44px] px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all text-sm disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"},[M(t(ye),{class:"w-4 h-4","aria-hidden":"true"}),o[9]||(o[9]=e("span",null,"Descargar plantilla Excel",-1))],8,Cn)])])):P("",!0),t(g)===2?(s(),n("div",Dn,[e("div",En,[M(t(je),{class:"w-16 h-16 mx-auto text-purple-600 mb-4","aria-hidden":"true"}),o[10]||(o[10]=e("h3",{class:"text-lg font-semibold text-cafe mb-2"}," Paso 2: Sube tu archivo ",-1)),o[11]||(o[11]=e("p",{class:"text-sm text-gray-600 mb-1"}," Arrastra tu archivo o haz clic para seleccionarlo ",-1)),o[12]||(o[12]=e("p",{class:"text-xs text-gray-500"}," Detectaremos las columnas autom√°ticamente ",-1))]),M(k,{onFileSelected:a,onFileRemoved:i,onError:c}),t(r)&&!t(p).detecting.value?(s(),n("div",Sn,[e("div",Fn,[M(t(ie),{class:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e("div",Mn,[o[13]||(o[13]=e("p",{class:"font-semibold text-green-900 mb-1"},"Archivo seleccionado correctamente",-1)),e("p",Pn,u(t(r).name),1),o[14]||(o[14]=e("p",{class:"text-xs text-green-700 mt-1"},' Haz clic en "Detectar columnas" para continuar ',-1))])])])):P("",!0),t(p).detecting.value?(s(),n("div",An,[...o[15]||(o[15]=[e("div",{class:"flex flex-col items-center justify-center gap-4"},[e("div",{class:"animate-spin w-12 h-12 border-4 border-purple-600 border-t-transparent rounded-full"}),e("div",{class:"text-center"},[e("p",{class:"text-purple-900 font-medium mb-1"},"Analizando archivo..."),e("p",{class:"text-sm text-purple-700"},"Detectando columnas y sugiriendo mapeo")])],-1)])])):P("",!0),t(p).error.value?(s(),n("div",In,[e("div",Tn,[M(t(xe),{class:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e("div",null,[o[16]||(o[16]=e("p",{class:"font-semibold text-red-900 mb-1"},"Error al procesar archivo",-1)),e("p",Vn,u(t(p).error.value),1)])])])):P("",!0)])):P("",!0),t(g)===3?(s(),n("div",Bn,[e("div",qn,[M(t(It),{class:"w-16 h-16 mx-auto text-purple-600 mb-4","aria-hidden":"true"}),o[17]||(o[17]=e("h3",{class:"text-lg font-semibold text-cafe mb-2"}," Paso 3: Mapea las columnas ",-1)),o[18]||(o[18]=e("p",{class:"text-sm text-gray-600"}," Relaciona las columnas de tu archivo con los campos de Terapl√≠ ",-1))]),M(Y,{"detected-columns":t(p).config.value?.detectedColumns||[],mappings:t(p).mappings.value,validation:t(p).validation.value,"onUpdate:mapping":d},null,8,["detected-columns","mappings","validation"])])):P("",!0),t(g)===4?(s(),n("div",jn,[e("div",zn,[M(t(Tt),{class:"w-16 h-16 mx-auto text-purple-600 mb-4","aria-hidden":"true"}),o[19]||(o[19]=e("h3",{class:"text-lg font-semibold text-cafe mb-2"}," Paso 4: Confirma la importaci√≥n ",-1)),o[20]||(o[20]=e("p",{class:"text-sm text-gray-600"}," Revisa el resumen antes de importar ",-1))]),e("div",Rn,[o[21]||(o[21]=e("h4",{class:"font-semibold text-gray-900 mb-3"},"Campos que se importar√°n:",-1)),e("div",Un,[(s(!0),n(J,null,K(t(p).mappings.value.filter(I=>I.targetField),I=>(s(),n("span",{key:I.sourceColumn,class:"inline-flex items-center gap-1 px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm"},[M(t(ie),{class:"w-4 h-4"}),B(" "+u(m(I.targetField)),1)]))),128))])]),t(p).validation.value?.warnings?.length?(s(),n("div",On,[e("div",Nn,[M(t(be),{class:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e("div",null,[o[22]||(o[22]=e("p",{class:"font-semibold text-amber-900 mb-2"},"Advertencias:",-1)),e("ul",Ln,[(s(!0),n(J,null,K(t(p).validation.value.warnings,(I,W)=>(s(),n("li",{key:W}," ‚Ä¢ "+u(I),1))),128))])])])])):P("",!0),e("div",Hn,[e("label",Gn,[H(e("input",{type:"checkbox","onUpdate:modelValue":o[2]||(o[2]=I=>de(z)?z.value=I:null),class:"mt-1 w-5 h-5 text-purple-600 border-gray-300 rounded focus:ring-2 focus:ring-purple-300 cursor-pointer"},null,512),[[me,t(z)]]),o[23]||(o[23]=e("div",{class:"flex-1"},[e("p",{class:"font-semibold text-blue-900 mb-1"}," Actualizar pacientes existentes "),e("p",{class:"text-sm text-blue-800"}," Si un paciente ya existe (mismo email o tel√©fono), actualizar sus datos con la informaci√≥n del archivo. "),e("p",{class:"text-xs text-blue-700 mt-1"}," Si no marcas esta opci√≥n, los pacientes duplicados se omitir√°n. ")],-1))])]),t(p).getPreviewData().length>0?(s(),n("div",Qn,[o[24]||(o[24]=e("h4",{class:"font-semibold text-gray-900"},"Vista previa de datos:",-1)),e("div",Jn,[e("table",Kn,[e("thead",Xn,[e("tr",null,[(s(!0),n(J,null,K(t(p).mappings.value.filter(I=>I.targetField),I=>(s(),n("th",{key:I.targetField,class:"px-3 py-2 text-left font-medium text-gray-700 whitespace-nowrap"},u(m(I.targetField)),1))),128))])]),e("tbody",Yn,[(s(!0),n(J,null,K(t(p).getPreviewData(),(I,W)=>(s(),n("tr",{key:W},[(s(!0),n(J,null,K(t(p).mappings.value.filter(Q=>Q.targetField),Q=>(s(),n("td",{key:Q.targetField,class:"px-3 py-2 text-gray-600 whitespace-nowrap"},u(I[Q.targetField]||"‚Äî"),1))),128))]))),128))])])]),o[25]||(o[25]=e("p",{class:"text-xs text-gray-500"},"Vista previa de las primeras filas",-1))])):P("",!0)])):P("",!0),t(g)===5?(s(),n("div",Zn,[e("div",Wn,[t(q)?(s(),re(t(ie),{key:0,class:"w-16 h-16 mx-auto text-green-600 mb-4","aria-hidden":"true"})):(s(),re(t(be),{key:1,class:"w-16 h-16 mx-auto text-amber-600 mb-4","aria-hidden":"true"})),e("h3",el,u(t(q)?"Importaci√≥n completada con √©xito":"Importaci√≥n completada con advertencias"),1),e("p",tl,u(t(q)?"Los pacientes se han importado correctamente":"La importaci√≥n se complet√≥ pero algunos pacientes tienen perfil incompleto"),1)]),t(p).importResult.value?(s(),n("div",ol,[e("div",al,[e("p",sl,u(t(p).importResult.value.total),1),o[26]||(o[26]=e("p",{class:"text-xs text-gray-600"},"Total",-1))]),e("div",rl,[e("p",nl,u(t(p).importResult.value.created),1),o[27]||(o[27]=e("p",{class:"text-xs text-gray-600"},"Creados",-1))]),e("div",ll,[e("p",il,u(t(p).importResult.value.updated),1),o[28]||(o[28]=e("p",{class:"text-xs text-gray-600"},"Actualizados",-1))]),e("div",dl,[e("p",cl,u(t(p).importResult.value.skipped),1),o[29]||(o[29]=e("p",{class:"text-xs text-gray-600"},"Omitidos",-1))])])):P("",!0),t(q)?(s(),n("div",ul,[e("div",pl,[M(t(ie),{class:"w-6 h-6 text-green-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),o[30]||(o[30]=e("div",{class:"flex-1"},[e("p",{class:"font-semibold text-green-900 mb-2"},"¬°Importaci√≥n exitosa!"),e("p",{class:"text-sm text-green-800"}," Los pacientes se han a√±adido a tu lista y ya puedes gestionar sus citas y tratamientos. ")],-1))])])):P("",!0),t(p).importResult.value?.incompleteProfiles?.length?(s(),n("div",ml,[e("div",bl,[M(t(be),{class:"w-6 h-6 text-amber-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e("div",gl,[e("p",fl,u(t(p).importResult.value.incompleteProfiles.length)+" paciente"+u(t(p).importResult.value.incompleteProfiles.length!==1?"s":"")+" con perfil incompleto ",1),o[31]||(o[31]=e("p",{class:"text-sm text-amber-800 mb-3"}," Los siguientes pacientes fueron importados pero les faltan datos importantes: ",-1)),e("div",vl,[(s(!0),n(J,null,K(t(p).importResult.value.incompleteProfiles.slice(0,5),I=>(s(),n("div",{key:I.rowNumber,class:"bg-white border border-amber-200 rounded p-2 text-sm"},[e("span",xl,u(I.nombre_completo),1),e("span",hl," ‚Äî Faltan: "+u(I.missingFields.join(", ")),1)]))),128)),t(p).importResult.value.incompleteProfiles.length>5?(s(),n("p",yl," ... y "+u(t(p).importResult.value.incompleteProfiles.length-5)+" m√°s ",1)):P("",!0)]),o[32]||(o[32]=e("p",{class:"text-xs text-amber-700 mt-3"}," üí° Puedes completar esta informaci√≥n editando cada paciente desde la lista. ",-1))])])])):P("",!0),t(p).importResult.value?.errors?.length?(s(),n("div",_l,[e("h4",wl,[M(t(xe),{class:"w-5 h-5","aria-hidden":"true"}),B(" Errores durante la importaci√≥n ("+u(t(p).importResult.value.errors.length)+") ",1)]),e("div",kl,[(s(!0),n(J,null,K(t(p).importResult.value.errors.slice(0,10),(I,W)=>(s(),n("div",{key:W,class:"bg-white border border-red-200 rounded p-2 text-sm text-red-800"},[e("span",$l,"Fila "+u(I.row)+":",1),B(" "+u(I.error),1)]))),128))])])):P("",!0)])):P("",!0)]),e("div",Cl,[t(g)>1&&t(g)<5?(s(),n("button",{key:0,onClick:b,disabled:t(p).importing.value||t(p).detecting.value,class:"min-h-[44px] px-6 py-2.5 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-all font-medium disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-gray-300"}," Atr√°s ",8,Dl)):(s(),n("div",El)),e("div",Sl,[t(g)<5?(s(),n("button",{key:0,onClick:O,disabled:t(p).importing.value,class:"min-h-[44px] px-6 py-2.5 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all font-medium disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-gray-300"}," Cancelar ",8,Fl)):P("",!0),t(g)===1?(s(),n("button",{key:1,onClick:f,class:"min-h-[44px] px-6 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all font-medium shadow-sm hover:shadow-md focus:outline-none focus:ring-2 focus:ring-purple-300"}," Continuar ")):P("",!0),t(g)===2?(s(),n("button",{key:2,onClick:E,disabled:!t(r)||t(p).detecting.value,class:"min-h-[44px] px-6 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all font-medium shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-purple-300 flex items-center gap-2"},[t(p).detecting.value?(s(),n("div",Pl)):P("",!0),e("span",null,u(t(p).detecting.value?"Analizando...":"Detectar columnas"),1)],8,Ml)):P("",!0),t(g)===3?(s(),n("button",{key:3,onClick:f,disabled:!t(p).validation.value?.isValid,class:"min-h-[44px] px-6 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all font-medium shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-purple-300"}," Continuar ",8,Al)):P("",!0),t(g)===4?(s(),n("button",{key:4,onClick:U,disabled:t(p).importing.value,class:"min-h-[44px] px-6 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all font-medium shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-purple-300 flex items-center gap-2"},[t(p).importing.value?(s(),n("div",Tl)):P("",!0),e("span",null,u(t(p).importing.value?"Importando...":"Importar pacientes"),1)],8,Il)):P("",!0),t(g)===5?(s(),n("button",{key:5,onClick:Z,class:"min-h-[44px] px-6 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all font-medium shadow-sm hover:shadow-md focus:outline-none focus:ring-2 focus:ring-purple-300"}," Finalizar ")):P("",!0)])])])])):P("",!0)]),_:1})])}}}),Bl=Object.assign(ce(Vl,[["__scopeId","data-v-97261e0d"]]),{__name:"PatientsImportModal"}),ql={class:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col"},jl={class:"px-6 py-4 border-b border-gray-200 flex items-center justify-between"},zl={class:"flex-1 overflow-y-auto p-6 space-y-6"},Rl={class:"flex gap-3"},Ul={class:"space-y-2"},Ol={class:"flex-1"},Nl={class:"text-xs text-gray-600"},Ll={class:"flex-1"},Hl={class:"text-xs text-gray-600"},Gl={class:"flex-1"},Ql={class:"text-xs text-gray-600"},Jl={class:"grid grid-cols-2 gap-2"},Kl=["value"],Xl={class:"text-sm text-cafe"},Yl={class:"px-6 py-4 border-t border-gray-200 flex items-center justify-between bg-gray-50"},Zl=["disabled"],Wl=["disabled"],ei={key:1},ti={key:2},oi=_e({__name:"PatientsExportModal",props:{modelValue:{type:Boolean},totalPatients:{},filteredCount:{},selectedCount:{default:0},hasFilters:{type:Boolean,default:!1},currentFilters:{default:()=>({})},selectedIds:{default:()=>[]}},emits:["update:modelValue"],setup(S,{emit:D}){const x=S,T=D,p=Fe(),g=V("csv"),r=V("all"),y=V(["nombre_completo","email","telefono","area_de_acompanamiento","frecuencia","activo"]),z=V(!1),q=[{value:"nombre_completo",label:"Nombre Completo"},{value:"email",label:"Email"},{value:"telefono",label:"Tel√©fono"},{value:"area_de_acompanamiento",label:"√Årea"},{value:"frecuencia",label:"Frecuencia"},{value:"activo",label:"Estado"},{value:"ultima_sesion",label:"√öltima Sesi√≥n"},{value:"proxima_sesion",label:"Pr√≥xima Sesi√≥n"},{value:"total_sesiones",label:"Total Sesiones"},{value:"created_at",label:"Fecha de Registro"}],l=()=>{z.value||T("update:modelValue",!1)},m=()=>{y.value.length===q.length?y.value=[]:y.value=q.map(O=>O.value)},j=async()=>{if(y.value.length===0){p.warning("Selecciona al menos un campo para exportar");return}try{z.value=!0;const O=new URLSearchParams({format:g.value,scope:r.value,fields:y.value.join(",")});r.value==="filtered"&&x.currentFilters&&O.append("filters",JSON.stringify(x.currentFilters)),r.value==="selected"&&x.selectedIds.length>0&&O.append("selectedIds",x.selectedIds.join(","));const F=await fetch(`/api/patients/export?${O.toString()}`);if(!F.ok){const c=await F.json();throw new Error(c.statusMessage||"Error al exportar pacientes")}const C=await F.blob(),a=URL.createObjectURL(C),i=document.createElement("a");i.href=a,i.download=`pacientes_${new Date().toISOString().split("T")[0]}.${g.value}`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(a),p.success("Pacientes exportados correctamente"),l()}catch(O){p.error(O.message||"Error al exportar pacientes")}finally{z.value=!1}};return ht(()=>{x.selectedCount>0?r.value="selected":x.hasFilters?r.value="filtered":r.value="all"}),(O,F)=>(s(),re(Ve,{to:"body"},[M(Je,{name:"modal"},{default:Be(()=>[S.modelValue?(s(),n("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",onClick:ae(l,["self"]),role:"dialog","aria-modal":"true","aria-labelledby":"export-modal-title"},[e("div",ql,[e("div",jl,[F[6]||(F[6]=e("div",null,[e("h2",{id:"export-modal-title",class:"text-2xl font-serif font-bold text-cafe"}," Exportar Pacientes "),e("p",{class:"text-sm text-gray-500 mt-1"}," Selecciona las opciones de exportaci√≥n ")],-1)),e("button",{onClick:l,class:"min-h-[44px] min-w-[44px] p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-gray-300","aria-label":"Cerrar modal"},[M(t(Se),{class:"w-6 h-6","aria-hidden":"true"})])]),e("div",zl,[e("div",null,[F[9]||(F[9]=e("label",{class:"block text-sm font-semibold text-cafe mb-3"}," Formato de archivo ",-1)),e("div",Rl,[e("button",{onClick:F[0]||(F[0]=C=>g.value="csv"),class:G(["min-h-[44px] flex-1 px-4 py-3 rounded-lg border-2 transition-all font-medium flex items-center justify-center gap-2",t(g)==="csv"?"border-purple-600 bg-purple-50 text-purple-600":"border-gray-200 bg-white text-gray-600 hover:border-gray-300"])},[M(t(ye),{class:"w-5 h-5","aria-hidden":"true"}),F[7]||(F[7]=e("span",null,"CSV",-1))],2),e("button",{onClick:F[1]||(F[1]=C=>g.value="xlsx"),class:G(["min-h-[44px] flex-1 px-4 py-3 rounded-lg border-2 transition-all font-medium flex items-center justify-center gap-2",t(g)==="xlsx"?"border-purple-600 bg-purple-50 text-purple-600":"border-gray-200 bg-white text-gray-600 hover:border-gray-300"])},[M(t(ye),{class:"w-5 h-5","aria-hidden":"true"}),F[8]||(F[8]=e("span",null,"XLSX",-1))],2)])]),e("div",null,[F[13]||(F[13]=e("label",{class:"block text-sm font-semibold text-cafe mb-3"}," ¬øQu√© pacientes exportar? ",-1)),e("div",Ul,[e("label",{class:G(["flex items-center gap-3 p-3 border-2 rounded-lg cursor-pointer transition-all",t(r)==="all"?"border-purple-600 bg-purple-50":"border-gray-200 bg-white hover:border-gray-300"])},[H(e("input",{type:"radio","onUpdate:modelValue":F[2]||(F[2]=C=>de(r)?r.value=C:null),value:"all",class:"w-4 h-4 text-purple-600 border-gray-300 focus:ring-2 focus:ring-purple-300"},null,512),[[Ie,t(r)]]),e("div",Ol,[F[10]||(F[10]=e("p",{class:"font-medium text-cafe"},"Todos los pacientes",-1)),e("p",Nl,"Exportar todos los pacientes ("+u(S.totalPatients)+")",1)])],2),S.hasFilters?(s(),n("label",{key:0,class:G(["flex items-center gap-3 p-3 border-2 rounded-lg cursor-pointer transition-all",t(r)==="filtered"?"border-purple-600 bg-purple-50":"border-gray-200 bg-white hover:border-gray-300"])},[H(e("input",{type:"radio","onUpdate:modelValue":F[3]||(F[3]=C=>de(r)?r.value=C:null),value:"filtered",class:"w-4 h-4 text-purple-600 border-gray-300 focus:ring-2 focus:ring-purple-300"},null,512),[[Ie,t(r)]]),e("div",Ll,[F[11]||(F[11]=e("p",{class:"font-medium text-cafe"},"Pacientes filtrados",-1)),e("p",Hl,"Exportar solo los pacientes que cumplen los filtros actuales ("+u(S.filteredCount)+")",1)])],2)):P("",!0),S.selectedCount>0?(s(),n("label",{key:1,class:G(["flex items-center gap-3 p-3 border-2 rounded-lg cursor-pointer transition-all",t(r)==="selected"?"border-purple-600 bg-purple-50":"border-gray-200 bg-white hover:border-gray-300"])},[H(e("input",{type:"radio","onUpdate:modelValue":F[4]||(F[4]=C=>de(r)?r.value=C:null),value:"selected",class:"w-4 h-4 text-purple-600 border-gray-300 focus:ring-2 focus:ring-purple-300"},null,512),[[Ie,t(r)]]),e("div",Gl,[F[12]||(F[12]=e("p",{class:"font-medium text-cafe"},"Pacientes seleccionados",-1)),e("p",Ql,"Exportar solo los pacientes seleccionados ("+u(S.selectedCount)+")",1)])],2)):P("",!0)])]),e("div",null,[F[14]||(F[14]=e("label",{class:"block text-sm font-semibold text-cafe mb-3"}," Campos a exportar ",-1)),e("div",Jl,[(s(),n(J,null,K(q,C=>e("label",{key:C.value,class:"flex items-center gap-2 p-2 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors"},[H(e("input",{type:"checkbox","onUpdate:modelValue":F[5]||(F[5]=a=>de(y)?y.value=a:null),value:C.value,class:"w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-2 focus:ring-purple-300"},null,8,Kl),[[me,t(y)]]),e("span",Xl,u(C.label),1)])),64))]),e("button",{onClick:m,class:"mt-2 text-xs text-purple-600 hover:text-purple-700 font-medium"},u(t(y).length===q.length?"Deseleccionar todos":"Seleccionar todos"),1)])]),e("div",Yl,[e("button",{onClick:l,disabled:t(z),class:"min-h-[44px] px-6 py-2.5 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all font-medium disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-gray-300"}," Cancelar ",8,Zl),e("button",{onClick:j,disabled:t(z)||t(y).length===0,class:"min-h-[44px] px-6 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all font-medium shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-purple-300 flex items-center gap-2"},[t(z)?P("",!0):(s(),re(t(Ye),{key:0,class:"w-5 h-5","aria-hidden":"true"})),t(z)?(s(),n("span",ei,"Exportando...")):(s(),n("span",ti,"Exportar"))],8,Wl)])])])):P("",!0)]),_:1})]))}}),ai=Object.assign(ce(oi,[["__scopeId","data-v-797ad56f"]]),{__name:"PatientsExportModal"}),si={class:"mb-6"},ri={class:"flex flex-col sm:flex-row sm:items-end sm:justify-between gap-3 mb-6"},ni={class:"flex flex-wrap items-center gap-2 text-sm text-cafe/60"},li={class:"text-cafe font-semibold"},ii={class:"text-cafe font-semibold"},di={class:"text-cafe font-semibold"},ci={class:"flex flex-wrap gap-2"},ui={class:"bg-white rounded-xl shadow-sm border border-gray-100 p-5"},pi={class:"mb-4"},mi={class:"relative"},bi={class:"flex flex-col gap-3"},gi={class:"flex flex-wrap gap-2"},fi=["onClick","aria-pressed","aria-label"],vi={class:"mt-4 pt-4 border-t border-gray-100"},xi={class:"flex flex-wrap gap-2"},hi=["value"],yi=["aria-pressed"],_i=["aria-pressed"],wi=["aria-pressed"],ki={key:0,class:"flex flex-col items-center justify-center py-16",role:"status","aria-live":"polite"},$i={key:1,class:"bg-white rounded-xl shadow-sm border border-gray-100 p-8 text-center",role:"status","aria-live":"polite"},Ci={class:"text-xl font-serif font-semibold text-cafe mb-3"},Di={class:"text-gray-500 mb-6 max-w-md mx-auto"},Ei={key:2,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",role:"list","aria-label":"Lista de pacientes"},Si=["onClick","onKeydown"],Fi=["onClick","aria-label"],Mi=["onClick","aria-label"],Pi={key:3,class:"mt-8 pt-6 border-t border-gray-100 flex items-center justify-between flex-wrap gap-4",role:"contentinfo"},Ai={class:"text-sm text-gray-500","aria-live":"polite"},Ii={key:0,class:"flex gap-2"},Ti={__name:"pacientes",setup(S){const D=yt(),x=Qe(),{getUserId:T,waitForUser:p}=Ee(),g=Ge(),r=Fe();console.log("[Pacientes] Estado inicial del usuario:",{existe:!!g.value,id:T(),email:g.value?.email}),ne(g,(h,v)=>{console.log("[Pacientes] Usuario cambi√≥:",{antes:v?.email||"null",ahora:h?.email||"null",id:T()})});const y=V(!1),z=V(!1),q=V(!1),l=V(!1),m=V(!1),j=V(!1),O=V(!1),F=V(null),C=V(null),a=V(null),i=V([]),c=V(!0),d=V(""),f=V(""),b=V("todos"),E=V(""),U=V({sinProximaCita:!1,sinSesionRegistrada:!1,requiereAtencion:!1});let Z=null;const $=h=>{clearTimeout(Z),Z=setTimeout(()=>{d.value=h.target.value},300)},o=[{valor:"todos",label:"Todos"},{valor:"activo",label:"Activos"},{valor:"pausa",label:"En pausa"},{valor:"finalizado",label:"Finalizados"}],k=A(()=>({activos:i.value.filter(h=>h.activo&&!h.en_pausa).length,enPausa:i.value.filter(h=>h.activo&&h.en_pausa).length,finalizados:i.value.filter(h=>!h.activo).length})),Y=A(()=>o.map(h=>{let v=0;return h.valor==="todos"?v=i.value.length:h.valor==="activo"?v=k.value.activos:h.valor==="pausa"?v=k.value.enPausa:h.valor==="finalizado"&&(v=k.value.finalizados),{...h,count:v}})),I=A(()=>{const h=new Set(i.value.map(v=>v.area_de_acompanamiento).filter(Boolean));return Array.from(h).sort()}),W=A(()=>E.value!==""||U.value.sinProximaCita||U.value.sinSesionRegistrada||U.value.requiereAtencion),Q=h=>{U.value[h]=!U.value[h]},X=()=>{E.value="",U.value={sinProximaCita:!1,sinSesionRegistrada:!1,requiereAtencion:!1},b.value="todos",d.value="",f.value=""},_=async()=>{c.value=!0;try{const h=T();if(console.log("[Pacientes] Iniciando carga de pacientes..."),console.log("[Pacientes] Usuario actual:",{existe:!!g.value,id:h,email:g.value?.email}),!h){console.error("[Pacientes] Usuario no autenticado"),c.value=!1;return}console.log("‚úÖ [Pacientes] Usuario verificado, consultando database...");const{data:v,error:ue}=await x.from("pacientes").select(`
        id,
        created_at,
        activo,
        email,
        nombre_completo,
        telefono,
        area_de_acompanamiento,
        frecuencia,
        metadata
      `).eq("terapeuta_id",h).order("created_at",{ascending:!1});if(ue)throw ue;const we=await Promise.all(v.map(async te=>{const{data:Me}=await x.from("citas").select("fecha_cita").eq("paciente_id",te.id).eq("estado","realizada").order("fecha_cita",{ascending:!1}).limit(1).maybeSingle(),{data:ge}=await x.from("citas").select("id, fecha_cita, hora_inicio").eq("paciente_id",te.id).in("estado",["pendiente","confirmada"]).gte("fecha_cita",new Date().toISOString().split("T")[0]).order("fecha_cita",{ascending:!0}).order("hora_inicio",{ascending:!0}).limit(1).maybeSingle(),{count:Pe}=await x.from("citas").select("*",{count:"exact",head:!0}).eq("paciente_id",te.id).eq("estado","realizada");let se=null;try{const{data:fe}=await x.from("bonos").select("id, tipo, estado, sesiones_totales, sesiones_restantes, fecha_fin, created_at").eq("paciente_id",te.id).order("created_at",{ascending:!1});console.log(`[Bonos] Paciente ${te.nombre_completo}:`,fe);const{data:$e,error:ve}=await x.from("bonos").select("id, tipo, estado, sesiones_totales, sesiones_restantes, fecha_fin, created_at").eq("paciente_id",te.id).in("estado",["activo","pendiente"]).order("created_at",{ascending:!1}).limit(1).maybeSingle();ve?console.warn("[Bonos] Error en consulta:",ve.message):(se=$e,console.log("‚úÖ [Bonos] Bono activo encontrado:",se))}catch(fe){console.warn("[Bonos] Error inesperado:",fe)}let ke=0,he=0;se&&(he=se.sesiones_totales,ke=he-se.sesiones_restantes);const R=new Date;R.setDate(R.getDate()-7);const{data:le}=await x.from("metricas_bienestar").select("estado_animo, nivel_energia, nivel_estres").eq("paciente_id",te.id).gte("fecha",R.toISOString());let Oe=3,Ne=!1,Le=50;if(le&&le.length>0){const fe=le.reduce((ve,vt)=>ve+vt.estado_animo,0)/le.length;Oe=fe,Le=Math.round(fe/10*100);const $e=le.slice(-3);$e.length>=3&&(Ne=$e.every(ve=>ve.estado_animo<=4))}const ft=te.nombre_completo||te.metadata?.nombre_completo||te.email;return{id:te.id,nombre:ft,apellidos:"",email:te.email,telefono:te.telefono,activo:te.activo,en_pausa:te.metadata?.en_pausa||!1,area_de_acompanamiento:te.area_de_acompanamiento,frecuencia:te.frecuencia,ultima_sesion:Me?.fecha_cita||null,proxima_sesion:ge?`${ge.fecha_cita}T${ge.hora_inicio}`:null,proxima_cita_id:ge?.id||null,total_sesiones:Pe||0,estado_emocional_promedio:Oe,evolucion_porcentaje:Le,requiere_atencion:Ne,created_at:te.created_at,bono_activo:se?{tipo:se.tipo,estado:se.estado,fecha_fin:se.fecha_fin,sesiones_completadas:ke,sesiones_totales:he,sesiones_restantes:se.sesiones_restantes}:null}}));i.value=we}catch(h){console.error("Error al cargar pacientes:",h),r.error("Error al cargar los pacientes. Por favor, recarga la p√°gina.")}finally{c.value=!1}},w=A(()=>{let h=i.value;if(d.value){const v=d.value.toLowerCase();h=h.filter(ue=>(ue.nombre||"").toLowerCase().includes(v)||(ue.email||"").toLowerCase().includes(v))}return b.value!=="todos"&&(h=h.filter(v=>b.value==="activo"?v.activo&&!v.en_pausa:b.value==="pausa"?v.activo&&v.en_pausa:b.value==="finalizado"?!v.activo:!0)),E.value&&(h=h.filter(v=>v.area_de_acompanamiento===E.value)),U.value.sinProximaCita&&(h=h.filter(v=>!v.proxima_sesion)),U.value.sinSesionRegistrada&&(h=h.filter(v=>!v.ultima_sesion)),U.value.requiereAtencion&&(h=h.filter(v=>v.requiere_atencion)),h}),N=A(()=>i.value.length),ee=h=>{D.push(`/terapeuta/pacientes/${h}`)},L=()=>{y.value=!0},Ze=()=>{y.value=!1},We=h=>{console.log("Abriendo modal de edici√≥n para:",h),C.value=h,z.value=!0},et=()=>{z.value=!1,C.value=null},tt=h=>{console.log("Abriendo modal de eliminaci√≥n para:",h),C.value=h,q.value=!0},ot=()=>{q.value=!1,C.value=null},at=async h=>{console.log("Nuevo paciente creado:",h),await _(),r.success("Paciente creado exitosamente")},st=async h=>{console.log("Paciente actualizado:",h),await _(),r.success("Informaci√≥n del paciente actualizada correctamente")},rt=async h=>{console.log("Paciente eliminado:",h),i.value=i.value.filter(v=>v.id!==h),r.success("Paciente eliminado exitosamente")},nt=async h=>{console.log("Paciente desactivado:",h),await _(),r.success("Paciente desactivado correctamente")},ze=h=>{console.log("Abriendo modal de asignaci√≥n de cita para:",h),a.value=h,l.value=!0},Re=()=>{l.value=!1,a.value=null},lt=async h=>{console.log("Nueva cita creada:",h),await _(),Re(),r.success("Cita asignada exitosamente")},it=h=>{D.push(`/agenda?paciente=${h.id}`)},dt=h=>{D.push(`/terapeuta/pacientes/${h.id}/bonos`)},ct=()=>{j.value=!0},ut=()=>{O.value=!0},pt=async()=>{await _(),r.success("Importaci√≥n completada. Lista de pacientes actualizada.")},mt=A(()=>{const h={};return b.value!=="todos"&&(h.estado=b.value),E.value&&(h.area=E.value),h}),bt=h=>{console.log("Abriendo modal de edici√≥n de cita:",h),F.value=h,m.value=!0},Ue=()=>{m.value=!1,F.value=null},gt=async()=>{console.log("Cita actualizada, recargando pacientes..."),await _(),Ue(),r.success("Cita actualizada correctamente")};return _t(async()=>{console.log("[Pacientes] Componente montado");try{console.log("[Pacientes] Esperando a que el usuario est√© disponible..."),await p();const h=T();console.log("[Pacientes] Usuario despu√©s de waitForUser:",{existe:!!g.value,id:h,email:g.value?.email}),h?(console.log("‚úÖ [Pacientes] Usuario disponible, cargando pacientes..."),await _()):(console.error("‚ùå [Pacientes] No se pudo obtener el usuario autenticado"),c.value=!1)}catch(h){console.error("‚ùå [Pacientes] Error en onMounted:",h),c.value=!1}}),ne(()=>T(),(h,v)=>{console.log("[Pacientes] ID de usuario cambi√≥:",{antes:v,ahora:h}),h&&i.value.length===0&&(console.log("[Pacientes] Recargando pacientes por cambio de usuario..."),_())}),(h,v)=>{const ue=Vo,we=St,te=Fa,Me=is,ge=ws,Pe=Ws,se=nr,ke=Bl,he=ai;return s(),n("div",null,[e("header",si,[e("div",ri,[e("div",null,[v[12]||(v[12]=e("h1",{class:"text-3xl font-serif font-bold text-cafe mb-1"}," Pacientes ",-1)),e("div",ni,[e("span",null,[v[7]||(v[7]=B("Activos: ",-1)),e("strong",li,u(t(k).activos),1)]),v[10]||(v[10]=e("span",{class:"text-gray-300"},"¬∑",-1)),e("span",null,[v[8]||(v[8]=B("En pausa: ",-1)),e("strong",ii,u(t(k).enPausa),1)]),v[11]||(v[11]=e("span",{class:"text-gray-300"},"¬∑",-1)),e("span",null,[v[9]||(v[9]=B("Finalizados: ",-1)),e("strong",di,u(t(k).finalizados),1)])])]),e("div",ci,[e("button",{onClick:ct,class:"min-h-[44px] px-4 py-2.5 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all flex items-center gap-2 whitespace-nowrap font-medium focus:outline-none focus:ring-2 focus:ring-gray-300","aria-label":"Importar pacientes"},[M(t(je),{class:"w-5 h-5","aria-hidden":"true"}),v[13]||(v[13]=e("span",null,"Importar",-1))]),e("button",{onClick:ut,class:"min-h-[44px] px-4 py-2.5 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all flex items-center gap-2 whitespace-nowrap font-medium focus:outline-none focus:ring-2 focus:ring-gray-300","aria-label":"Exportar pacientes"},[M(t(Ye),{class:"w-5 h-5","aria-hidden":"true"}),v[14]||(v[14]=e("span",null,"Exportar",-1))]),e("button",{onClick:L,class:"min-h-[44px] px-6 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all flex items-center gap-2 whitespace-nowrap font-medium shadow-sm hover:shadow-md focus:outline-none focus:ring-2 focus:ring-purple-300","aria-label":"A√±adir nuevo paciente"},[...v[15]||(v[15]=[e("span",{class:"text-lg leading-none"},"+",-1),e("span",null,"Nuevo Paciente",-1)])])])]),e("div",ui,[e("div",pi,[e("div",mi,[H(e("input",{"onUpdate:modelValue":v[0]||(v[0]=R=>de(f)?f.value=R:null),onInput:$,type:"text",placeholder:"Buscar paciente por nombre o email...",class:"min-h-[44px] w-full px-4 py-3 pl-11 bg-gray-50 border border-gray-200 rounded-lg focus:border-purple-600 focus:ring-2 focus:ring-purple-300/20 focus:bg-white transition-all text-cafe placeholder-gray-400","aria-label":"Buscar pacientes"},null,544),[[oe,t(f)]]),M(t(Mt),{class:"w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400","aria-hidden":"true"})])]),e("div",bi,[v[16]||(v[16]=e("div",{class:"flex items-center gap-2 text-xs text-gray-500 font-medium uppercase tracking-wide"},[e("span",null,"Estado")],-1)),e("div",gi,[(s(!0),n(J,null,K(t(Y),R=>(s(),n("button",{key:R.valor,onClick:le=>b.value=R.valor,class:G(["min-h-[44px] px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2",t(b)===R.valor?"bg-purple-600 text-white shadow-sm":"bg-gray-50 text-gray-600 hover:bg-gray-100 border border-gray-200"]),"aria-pressed":t(b)===R.valor,"aria-label":`Filtrar por ${R.label.toLowerCase()}: ${R.count} pacientes`},[e("span",null,u(R.label),1),e("span",{class:G(["px-2 py-0.5 rounded-full text-xs font-semibold",t(b)===R.valor?"bg-white/20 text-white":"bg-gray-200 text-gray-600"])},u(R.count),3)],10,fi))),128))])]),e("div",vi,[v[21]||(v[21]=e("div",{class:"flex items-center gap-2 text-xs text-gray-500 font-medium uppercase tracking-wide mb-3"},[e("span",null,"Filtros Avanzados")],-1)),e("div",xi,[H(e("select",{"onUpdate:modelValue":v[1]||(v[1]=R=>de(E)?E.value=R:null),class:"min-h-[44px] px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm text-cafe focus:border-purple-600 focus:ring-2 focus:ring-purple-300/20 transition-all","aria-label":"Filtrar por √°rea de acompa√±amiento"},[v[17]||(v[17]=e("option",{value:""},"Todas las √°reas",-1)),(s(!0),n(J,null,K(t(I),R=>(s(),n("option",{key:R,value:R},u(R),9,hi))),128))],512),[[pe,t(E)]]),e("button",{onClick:v[2]||(v[2]=R=>Q("sinProximaCita")),class:G(["min-h-[44px] px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2",t(U).sinProximaCita?"bg-orange-100 text-orange-700 border border-orange-300":"bg-gray-50 text-gray-600 hover:bg-gray-100 border border-gray-200"]),"aria-pressed":t(U).sinProximaCita,"aria-label":"Filtrar pacientes sin pr√≥xima cita programada"},[M(t(Te),{class:"w-4 h-4","aria-hidden":"true"}),v[18]||(v[18]=e("span",null,"Sin pr√≥xima cita",-1))],10,yi),e("button",{onClick:v[3]||(v[3]=R=>Q("sinSesionRegistrada")),class:G(["min-h-[44px] px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2",t(U).sinSesionRegistrada?"bg-amber-100 text-amber-700 border border-amber-300":"bg-gray-50 text-gray-600 hover:bg-gray-100 border border-gray-200"]),"aria-pressed":t(U).sinSesionRegistrada,"aria-label":"Filtrar pacientes sin sesi√≥n registrada"},[M(t(Pt),{class:"w-4 h-4","aria-hidden":"true"}),v[19]||(v[19]=e("span",null,"Sin sesi√≥n registrada",-1))],10,_i),e("button",{onClick:v[4]||(v[4]=R=>Q("requiereAtencion")),class:G(["min-h-[44px] px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2",t(U).requiereAtencion?"bg-red-100 text-red-700 border border-red-300":"bg-gray-50 text-gray-600 hover:bg-gray-100 border border-gray-200"]),"aria-pressed":t(U).requiereAtencion,"aria-label":"Filtrar pacientes que requieren atenci√≥n"},[M(t(xe),{class:"w-4 h-4","aria-hidden":"true"}),v[20]||(v[20]=e("span",null,"Requiere atenci√≥n",-1))],10,wi),t(W)?(s(),n("button",{key:0,onClick:X,class:"min-h-[44px] px-4 py-2 rounded-lg text-sm font-medium transition-all text-gray-500 hover:text-gray-700 hover:bg-gray-100","aria-label":"Limpiar todos los filtros"}," Limpiar filtros ")):P("",!0)])])])]),e("section",null,[t(c)?(s(),n("div",ki,[...v[22]||(v[22]=[e("div",{class:"animate-spin w-12 h-12 border-4 border-purple-600 border-t-transparent rounded-full mb-6","aria-hidden":"true"},null,-1),e("p",{class:"text-gray-500 font-medium"},"Cargando pacientes...",-1)])])):t(w).length===0?(s(),n("div",$i,[M(t(At),{class:"w-20 h-20 mx-auto mb-6 text-gray-300","aria-hidden":"true"}),e("h3",Ci,u(t(W)||t(d)||t(b)!=="todos"?"No se encontraron pacientes":"A√∫n no tienes pacientes registrados"),1),e("p",Di,u(t(W)||t(d)||t(b)!=="todos"?"Intenta ajustar los filtros de b√∫squeda para encontrar lo que buscas":"Comienza a√±adiendo tu primer paciente para gestionar su proceso terap√©utico"),1),!t(W)&&!t(d)&&t(b)==="todos"?(s(),n("button",{key:0,onClick:L,class:"min-h-[44px] px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all font-medium shadow-sm hover:shadow-md focus:outline-none focus:ring-2 focus:ring-purple-300","aria-label":"A√±adir tu primer paciente"}," + A√±adir Primer Paciente ")):(s(),n("button",{key:1,onClick:X,class:"min-h-[44px] px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-all font-medium focus:outline-none focus:ring-2 focus:ring-gray-300","aria-label":"Limpiar todos los filtros de b√∫squeda"}," Limpiar filtros "))])):(s(),n("div",Ei,[(s(!0),n(J,null,K(t(w),R=>(s(),n("div",{key:R.id,class:"relative group cursor-pointer",onClick:le=>ee(R.id),onKeydown:wt(le=>ee(R.id),["enter"]),role:"listitem"},[M(ue,{paciente:R,onEditar:We,onEliminar:tt,onVerCitas:it,onGestionarBonos:dt,onEditarCita:bt},null,8,["paciente"]),R.activo&&!R.en_pausa?(s(),n("button",{key:0,onClick:ae(le=>ze(R),["stop"]),class:"hidden md:flex absolute bottom-4 right-4 min-h-[44px] px-4 py-2.5 bg-gradient-to-r from-purple-600 to-rosa text-white text-sm font-medium rounded-lg shadow-lg hover:shadow-xl hover:scale-105 transition-all duration-200 items-center gap-2 z-10 opacity-0 group-hover:opacity-100 group-focus-within:opacity-100 pointer-events-none group-hover:pointer-events-auto group-focus-within:pointer-events-auto focus:outline-none focus:ring-2 focus:ring-purple-300","aria-label":`Asignar nueva cita a ${R.nombre}`},[M(t(Te),{class:"w-4 h-4","aria-hidden":"true"}),v[23]||(v[23]=e("span",null,"Asignar Cita",-1))],8,Fi)):P("",!0),R.activo&&!R.en_pausa?(s(),n("button",{key:1,onClick:ae(le=>ze(R),["stop"]),class:"md:hidden absolute bottom-4 right-4 min-h-[44px] px-4 py-2.5 bg-gradient-to-r from-purple-600 to-rosa text-white text-sm font-medium rounded-lg shadow-lg hover:shadow-xl hover:scale-105 transition-all duration-200 flex items-center gap-2 z-10 focus:outline-none focus:ring-2 focus:ring-purple-300","aria-label":`Asignar nueva cita a ${R.nombre}`},[M(t(Te),{class:"w-4 h-4","aria-hidden":"true"}),v[24]||(v[24]=e("span",null,"Asignar Cita",-1))],8,Mi)):P("",!0)],40,Si))),128))])),t(w).length>0?(s(),n("footer",Pi,[e("p",Ai," Mostrando "+u(t(w).length)+" de "+u(t(N))+" pacientes ",1),t(N)>t(w).length?(s(),n("div",Ii,[...v[25]||(v[25]=[e("button",{class:"min-h-[44px] px-4 py-2 bg-white border border-gray-200 text-gray-600 rounded-lg hover:bg-gray-50 transition-colors text-sm font-medium focus:outline-none focus:ring-2 focus:ring-gray-300","aria-label":"Ver m√°s pacientes"}," Ver m√°s ",-1)])])):P("",!0)])):P("",!0)]),M(we,{mostrar:t(l),"paciente-preseleccionado":t(a),onCerrar:Re,onCitaCreada:lt},null,8,["mostrar","paciente-preseleccionado"]),M(te,{mostrar:t(y),onCerrar:Ze,onPacienteCreado:at},null,8,["mostrar"]),M(Me,{mostrar:t(z),paciente:t(C),onCerrar:et,onPacienteActualizado:st},null,8,["mostrar","paciente"]),M(ge,{mostrar:t(q),paciente:t(C),onCerrar:ot,onPacienteEliminado:rt,onPacienteDesactivado:nt},null,8,["mostrar","paciente"]),M(Pe,{isOpen:t(m),citaId:t(F),onClose:Ue,onActualizado:gt},null,8,["isOpen","citaId"]),M(se),M(ke,{modelValue:t(j),"onUpdate:modelValue":v[5]||(v[5]=R=>de(j)?j.value=R:null),"existing-patients":t(i),onImportComplete:pt},null,8,["modelValue","existing-patients"]),M(he,{modelValue:t(O),"onUpdate:modelValue":v[6]||(v[6]=R=>de(O)?O.value=R:null),"total-patients":t(N),"filtered-count":t(w).length,"has-filters":t(W)||t(b)!=="todos"||t(d)!=="","current-filters":t(mt)},null,8,["modelValue","total-patients","filtered-count","has-filters","current-filters"])])}}},nd=ce(Ti,[["__scopeId","data-v-c9c8455f"]]);export{nd as default};
