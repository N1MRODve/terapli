import{u as uo,_ as mo}from"./ModalNuevaCitaEnhanced-BP__1SyS.js";import{M as po}from"./ModalDetallesCita-CxtIMQaR.js";import{e as vo,g as go,r as p,s as ot,I as at,z as b,O as rt,D as fo,c as l,o as s,a as e,b as we,J as oe,j as v,d as w,t as i,A as ke,m as Ce,v as st,F as B,i as V,n as g,w as Ae,M as Ee,l as M,k as Le,E as G,T as ie,K as Mt}from"#entry";import{s as bo}from"./interval-BzLCLO6P.js";import{_ as ho}from"./_plugin-vue_export-helper-DlAUqK2U.js";const xo={class:"agenda-calendario min-h-screen bg-gray-50/50"},yo={class:"bg-white border-b border-gray-100 px-4 py-2"},wo={class:"flex items-center justify-between gap-3"},ko={class:"flex items-center gap-2"},Co={class:"flex items-center gap-3 ml-2"},_o={class:"text-base font-semibold text-gray-800"},Mo={key:0,class:"flex items-center gap-2 px-2.5 py-1 bg-violet-50 border border-violet-200 rounded-full"},So={class:"text-xs font-medium text-violet-700"},Do={key:1,class:"flex items-center gap-1.5 ml-2"},jo={class:"w-20 h-1 bg-gray-200 rounded-full overflow-hidden"},zo={class:"text-xs text-gray-400"},$o={class:"flex-1 max-w-md mx-4"},Bo={class:"relative"},Vo={class:"flex items-center gap-2"},Ho={class:"flex items-center bg-gray-100 rounded-lg p-0.5"},Ao=["onClick","title"],Eo=["title"],Lo={class:"hidden sm:inline"},Io={class:"bg-gradient-to-r from-gray-50 to-white border-b border-gray-100 px-4 py-2.5"},Fo={class:"flex items-center justify-between"},Po={class:"flex items-center gap-3"},No={class:"text-left"},To={class:"text-base font-bold text-amber-700 leading-none"},Oo={class:"text-left"},Ro={class:"text-base font-bold text-emerald-700 leading-none"},qo={class:"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-violet-50 border border-violet-200"},Uo={class:"w-8 h-8 rounded-full bg-violet-100 flex items-center justify-center"},Ko={class:"text-xs font-bold text-violet-700"},Yo={class:"text-left"},Jo={class:"text-[10px] text-violet-500"},Go={key:0,class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Xo={key:1,class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Qo={class:"text-left"},Wo={key:0,class:"text-[10px] text-amber-600"},Zo={class:"hidden lg:flex items-center gap-2 px-3 py-1.5 rounded-lg bg-gray-50 border border-gray-200"},ea={class:"text-left"},ta={class:"text-base font-bold text-gray-700 leading-none"},oa={key:0,class:"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-gradient-to-r from-amber-500 to-orange-500 text-white shadow-sm"},aa={class:"text-left"},ra={class:"text-base font-bold leading-none"},sa={class:"flex items-center gap-2"},na={class:"relative group/bloques"},la={class:"hidden sm:inline"},ia={key:0,class:"flex items-center gap-3 mt-2.5 pt-2.5 border-t border-gray-100 overflow-hidden"},da={key:0,class:"flex items-center gap-1.5 px-2.5 py-1 rounded-md bg-red-50 border border-red-100 text-xs text-red-600"},ca={key:0,class:"mx-4 mb-3 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-100 rounded-xl px-4 py-3"},ua={class:"flex items-center justify-between mb-2"},ma={class:"flex flex-wrap gap-2"},pa=["onClick"],va={key:0,class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ga={key:1,class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},fa={key:2,class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ba={class:"font-medium"},ha=["onClick"],xa={key:0,class:"flex items-center justify-center h-full"},ya={key:1,class:"p-4"},wa={class:"grid grid-cols-7 gap-1 mb-2"},ka={class:"grid grid-cols-7 gap-1"},Ca=["onClick"],_a={class:"flex items-center justify-between mb-1"},Ma={class:"space-y-0.5 overflow-hidden"},Sa=["title"],Da={key:0,class:"text-[9px] text-gray-400 text-center"},ja={key:2,class:"min-w-max"},za={class:"text-xs font-medium text-gray-400 uppercase tracking-wider"},$a={key:0,class:"w-6 h-0.5 bg-violet-500 mx-auto mt-1 rounded-full"},Ba={class:"absolute -left-16 -top-2.5 flex items-center"},Va={class:"px-2 py-1 bg-red-500 text-white text-xs font-bold rounded-md shadow-sm whitespace-nowrap"},Ha=["onClick"],Aa=["onClick"],Ea={key:1,class:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"},La=["onClick","onKeydown","aria-label"],Ia=["onClick","disabled","title"],Fa={key:0,class:"w-2.5 h-2.5 animate-spin",fill:"none",viewBox:"0 0 24 24"},Pa={class:"hidden sm:inline"},Na={key:2,class:"hidden sm:group-hover/badge:inline group-hover/badge:text-emerald-600"},Ta={key:0,class:"w-2.5 h-2.5",fill:"currentColor",viewBox:"0 0 20 20"},Oa={key:1,class:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ra={key:2,class:"w-2.5 h-2.5",fill:"currentColor",viewBox:"0 0 20 20"},qa={key:3,class:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ua={key:4,class:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ka={key:5,class:"w-2.5 h-2.5",fill:"currentColor",viewBox:"0 0 20 20"},Ya={class:"hidden sm:inline"},Ja={class:"absolute -bottom-1 right-0 flex items-center gap-1 opacity-0 group-hover/card:opacity-100 focus-within:opacity-100 transition-opacity z-40"},Ga={class:"flex items-center gap-0.5 bg-white/95 backdrop-blur-sm rounded-full px-1 py-0.5 shadow-lg border border-gray-200"},Xa=["onClick","onKeydown","aria-label"],Qa=["onClick","aria-label"],Wa={key:0,class:"flex items-center gap-0.5 bg-red-50/95 backdrop-blur-sm rounded-full px-1 py-0.5 shadow-lg border border-red-200"},Za=["onClick","onKeydown","aria-label"],er=["onClick","onKeydown","aria-label"],tr={class:"flex flex-col h-full min-h-[34px] pr-14"},or={class:"flex items-start gap-1"},ar=["title"],rr={key:0,class:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},sr={key:1,class:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},nr=["title"],lr={class:"text-[10px] text-gray-500 font-medium mt-auto flex items-center gap-1"},ir={key:0,class:"text-orange-500",title:"Bono pendiente de pago"},dr={class:"absolute left-full ml-2 top-0 hidden group-hover/card:block z-50 pointer-events-none"},cr={class:"bg-gray-900 text-white text-xs rounded-lg py-3 px-4 shadow-xl max-w-sm min-w-[220px]"},ur={class:"flex items-start justify-between gap-2 mb-2"},mr={class:"font-bold text-sm leading-tight"},pr={class:"flex items-center gap-2 text-gray-300 mb-2"},vr={key:0,class:"flex items-center gap-2 text-gray-300 mb-2"},gr={class:"font-mono"},fr={key:1,class:"mb-2"},br={class:"flex items-center gap-2"},hr={class:"text-violet-300 font-medium"},xr={class:"ml-5 mt-1 flex items-center gap-3"},yr={class:"text-gray-400"},wr={class:"text-white font-medium"},kr={key:0,class:"text-orange-400 text-[10px] font-medium px-1.5 py-0.5 bg-orange-900/50 rounded"},Cr={key:1,class:"text-emerald-400 text-[10px] font-medium"},_r={key:2,class:"text-gray-500 text-[11px] mb-2"},Mr={key:3,class:"flex items-center gap-2 text-gray-300 mb-2"},Sr={key:4,class:"mt-2 pt-2 border-t border-gray-700"},Dr={class:"text-gray-200 text-[11px] leading-relaxed line-clamp-3"},jr=["onClick"],zr={class:"bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden animate-modal-enter"},$r={class:"p-6 space-y-5"},Br={class:"bg-gray-50 rounded-xl p-4"},Vr={class:"space-y-3"},Hr={class:"flex items-center gap-3"},Ar={class:"font-medium text-gray-900"},Er={class:"flex items-center gap-3"},Lr={class:"font-medium text-gray-900"},Ir={class:"text-sm text-gray-500"},Fr={class:"px-6 py-4 border-t border-gray-100 bg-gray-50 flex items-center justify-end gap-3"},Pr=["disabled"],Nr={key:0,class:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24"},Tr={class:"bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden animate-modal-enter"},Or={class:"px-6 py-4 border-b border-gray-100 bg-gradient-to-r from-blue-50 to-indigo-50"},Rr={class:"flex items-center justify-between"},qr={class:"text-sm text-gray-500 mt-0.5"},Ur={class:"p-6 space-y-5"},Kr={class:"bg-gray-50 rounded-xl p-4"},Yr={class:"flex items-center gap-3"},Jr={class:"font-medium text-gray-900"},Gr={class:"text-sm text-gray-500"},Xr=["min"],Qr={class:"grid grid-cols-2 gap-4"},Wr=["value"],Zr=["value"],es={class:"px-6 py-4 border-t border-gray-100 bg-gray-50 flex items-center justify-end gap-3"},ts=["disabled"],os={key:0,class:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24"},as={class:"bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden animate-modal-enter"},rs={class:"p-6 space-y-5"},ss={class:"bg-gray-50 rounded-xl p-4"},ns={class:"space-y-3"},ls={class:"flex items-center gap-3"},is={class:"font-medium text-gray-900"},ds={class:"flex items-center gap-3"},cs={class:"font-medium text-gray-900"},us={class:"text-sm text-gray-500"},ms={class:"flex items-center gap-3"},ps={class:"font-medium text-gray-900 capitalize"},vs={class:"px-6 py-4 border-t border-gray-100 bg-gray-50 flex items-center justify-end gap-3"},gs=["disabled"],fs={key:0,class:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24"},bs={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},hs={class:"relative bg-white rounded-2xl shadow-2xl max-w-lg w-full max-h-[80vh] overflow-hidden"},xs={class:"px-6 py-4 border-b border-gray-100 flex items-center justify-between bg-gradient-to-r from-violet-50 to-white"},ys={class:"flex items-center gap-3"},ws={key:0,class:"text-sm text-gray-500"},ks={class:"p-6 overflow-y-auto max-h-[60vh]"},Cs={key:0,class:"flex items-center justify-center py-8"},_s={key:1,class:"text-center py-8"},Ms={key:2,class:"space-y-4"},Ss={class:"flex items-center gap-3 p-3 bg-gray-50 rounded-xl"},Ds={class:"text-sm font-medium text-gray-900"},js={class:"text-xs text-gray-500"},zs={key:0,class:"space-y-2"},$s={class:"bg-violet-50 border border-violet-100 rounded-xl p-4"},Bs={class:"text-sm text-gray-700 whitespace-pre-wrap leading-relaxed"},Vs={key:1,class:"space-y-2"},Hs={class:"bg-gray-50 border border-gray-100 rounded-xl p-4"},As={class:"text-sm text-gray-700 whitespace-pre-wrap leading-relaxed"},Es={key:2,class:"text-center py-4"},Ls={key:0,class:"fixed bottom-6 right-6 z-[100] max-w-sm",role:"alert","aria-live":"polite"},Is={key:0,class:"w-5 h-5 text-emerald-600",fill:"currentColor",viewBox:"0 0 20 20"},Fs={key:1,class:"w-5 h-5 text-red-600",fill:"currentColor",viewBox:"0 0 20 20"},Ps={key:2,class:"w-5 h-5 text-blue-600",fill:"currentColor",viewBox:"0 0 20 20"},Ns={class:"text-sm font-medium flex-1"},Ie=88,nt=9,lt=21,Fe=60,it=70,Ts=vo({__name:"AgendaCalendario",props:{modoCoordinadora:{type:Boolean,default:!1}},emits:["nueva-cita","ver-cita"],setup(St,{emit:Os}){const Pe=St,{citas:E,loading:Dt,loadAllAppointments:jt,loadTerapeutaAppointments:zt,changeAppointmentStatus:dt,moveAppointment:$t,deleteAppointment:Bt,refreshAppointments:Ne}=uo(),ct=go(),h=p("semana"),H=p(new Date),_e=p(""),q=p(!1),L=p(["pendiente","confirmada","realizada","cancelada"]),Vt=p([]),ut=p(null),de=p(!1),Te=p(null),Oe=p(null),Re=p(!1),Me=p(null),N=p(null),ae=p(null),re=p(null),qe=p(!1),I=p(null),Se=p(""),Ue=p(!1),F=p(null),U=p(""),P=p(""),X=p(""),Ke=p(!1),A=p(null),se=p(null),Ye=p(!1),C=p(null),Je=p(!1),mt=p(""),T=p("info"),De=p(!1),x=(o,t="info")=>{mt.value=o,T.value=t,De.value=!0,setTimeout(()=>{De.value=!1},4e3)},S=p("auto");ot(()=>{const o=localStorage.getItem("agenda-modo-horario");o&&["auto","activo","completo"].includes(o)&&(S.value=o)}),at(S,o=>{localStorage.setItem("agenda-modo-horario",o)});const je=b(()=>{const o=k.value.map(a=>a.fecha),t=E.value.filter(a=>o.includes(a.fecha_cita));if(t.length===0)return{inicio:10,fin:20};let n=23,c=0;return t.forEach(a=>{if(a.hora_inicio){const d=parseInt(a.hora_inicio.substring(0,2));n=Math.min(n,d),c=Math.max(c,d)}if(a.hora_fin){const d=parseInt(a.hora_fin.substring(0,2));c=Math.max(c,d)}}),{inicio:Math.max(nt,n-1),fin:Math.min(lt,c+1)}}),Q=b(()=>{if(S.value==="completo")return nt;if(S.value==="activo")return je.value.inicio;const o=je.value;return o.fin-o.inicio<=8?o.inicio:nt}),ce=b(()=>{if(S.value==="completo")return lt;if(S.value==="activo")return je.value.fin;const o=je.value;return o.fin-o.inicio<=8?o.fin:lt}),Ht=b(()=>{const o=[];for(let t=Q.value;t<=ce.value;t++)o.push(`${String(t).padStart(2,"0")}:00`);return o}),At=b(()=>{switch(S.value){case"activo":return`${Q.value}:00 - ${ce.value}:00`;case"completo":return"9:00 - 21:00";default:return"Auto"}}),Et=()=>{const o=["auto","activo","completo"],t=o.indexOf(S.value);S.value=o[(t+1)%o.length]},k=b(()=>{const o=new Date(H.value),t=[],n=new Date,c=`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}`;if(h.value==="dia"){const a=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")}`;t.push({fecha:a,diaSemana:o.toLocaleDateString("es-ES",{weekday:"long"}).toUpperCase(),numeroDia:o.getDate(),mes:o.toLocaleDateString("es-ES",{month:"short"}),esHoy:a===c})}else if(h.value==="5dias")for(let a=0;a<5;a++){const d=new Date(o);d.setDate(o.getDate()+a);const u=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;t.push({fecha:u,diaSemana:d.toLocaleDateString("es-ES",{weekday:"long"}).toUpperCase(),numeroDia:d.getDate(),mes:d.toLocaleDateString("es-ES",{month:"short"}),esHoy:u===c})}else if(h.value==="semana"){const a=o.getDay(),d=new Date(o);d.setDate(o.getDate()-(a===6?0:a+1));for(let u=0;u<7;u++){const r=new Date(d);r.setDate(d.getDate()+u);const m=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")}`;t.push({fecha:m,diaSemana:r.toLocaleDateString("es-ES",{weekday:"long"}).toUpperCase(),numeroDia:r.getDate(),mes:r.toLocaleDateString("es-ES",{month:"short"}),esHoy:m===c})}}else if(h.value==="mes"){new Date(o.getFullYear(),o.getMonth(),1);const d=new Date(o.getFullYear(),o.getMonth()+1,0).getDate();for(let u=1;u<=d;u++){const r=new Date(o.getFullYear(),o.getMonth(),u),m=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")}`;t.push({fecha:m,diaSemana:r.toLocaleDateString("es-ES",{weekday:"long"}).toUpperCase(),numeroDia:r.getDate(),mes:r.toLocaleDateString("es-ES",{month:"short"}),esHoy:m===c})}}return t}),ne=b(()=>k.value.some(o=>o.esHoy));b(()=>k.value.findIndex(o=>o.esHoy));const Lt=b(()=>{if(h.value==="dia")return H.value.toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long",year:"numeric"}).replace(/^\w/,m=>m.toUpperCase());if(h.value==="mes")return H.value.toLocaleDateString("es-ES",{month:"long",year:"numeric"}).replace(/^\w/,_=>_.toUpperCase());const o=k.value;if(o.length===0)return"";const t=o[0],n=o[o.length-1],c=new Date(t.fecha),a=new Date(n.fecha),d=c.toLocaleDateString("es-ES",{day:"numeric",month:"short"}),u=a.toLocaleDateString("es-ES",{day:"numeric",month:"short"});return h.value==="5dias"?`${d} — ${u}`:`Semana del ${d} — ${u}`}),It=b(()=>new Date().toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long"}).replace(/^\w/,t=>t.toUpperCase()));b(()=>{switch(h.value){case"dia":return"hoy";case"5dias":return"estos 5 días";case"mes":return"este mes";case"semana":default:return"esta semana"}});const pt=b(()=>{let o=E.value;if(Pe.modoCoordinadora&&ut.value&&(o=o.filter(t=>t.terapeuta_id===ut.value)),L.value.length>0&&L.value.length<4&&(o=o.filter(t=>L.value.includes(t.estado))),_e.value.trim()){const t=_e.value.toLowerCase();o=o.filter(n=>{const c=(n.paciente?.nombre_completo||"").toLowerCase(),a=(n.observaciones||"").toLowerCase();return c.includes(t)||a.includes(t)})}return o}),le=b(()=>{const o=k.value.map(n=>n.fecha),t=E.value.filter(n=>o.includes(n.fecha_cita));return{pendiente:t.filter(n=>n.estado==="pendiente").length,confirmada:t.filter(n=>n.estado==="confirmada").length,realizada:t.filter(n=>n.estado==="realizada"||n.estado==="completada").length,cancelada:t.filter(n=>n.estado==="cancelada").length}}),ue=b(()=>{const o=k.value.map(f=>f.fecha),t=E.value.filter(f=>o.includes(f.fecha_cita)),n=t.filter(f=>f.estado==="realizada"||f.estado==="completada"),a=n.filter(f=>f.estado_pago!=="pagado").reduce((f,z)=>{const K=z.precio_sesion||z.precio||it;return f+K},0),d=t.filter(f=>f.estado==="pendiente"||f.estado==="confirmada"),u=d.reduce((f,z)=>{const K=z.precio_sesion||z.precio||it;return f+K},0),r=t.filter(f=>f.estado==="cancelada"),m=r.reduce((f,z)=>{const K=z.precio_sesion||z.precio||it;return f+K},0),_=a+u+m,O=t.length,R=O>0?Math.round(r.length/O*100):0;return{porCobrar:a,previstos:u,perdido:m,totalPotencial:_,tasaCancelacion:R,sesionesRealizadas:n.length,sesionesProgramadas:d.length,sesionesCanceladas:r.length}}),ze=o=>o.toLocaleString("es-ES",{minimumFractionDigits:0,maximumFractionDigits:0})+"€",j=b(()=>{const o=k.value.map($=>$.fecha),t=E.value.filter($=>o.includes($.fecha_cita)),c=k.value.filter($=>{const J=new Date($.fecha+"T00:00:00").getDay();return J!==0&&J!==6}).length*8,d=t.filter($=>$.estado!=="cancelada").reduce(($,Y)=>{if(Y.hora_inicio&&Y.hora_fin){const[J,xe]=Y.hora_inicio.split(":").map(Number),[_t,tt]=Y.hora_fin.split(":").map(Number);return $+(_t*60+tt-(J*60+xe))}return $+60},0)/60,u=c>0?Math.round(d/c*100):0,r=Math.max(0,c-d),m=Math.floor(r),_=le.value.pendiente,O=le.value.confirmada,R=_+O,f=R>0?Math.round(O/R*100):100;let z=0,K="neutral";if(h.value==="semana"){const $=k.value[0]?.fecha;if($){const Y=new Date($+"T00:00:00"),J=new Date(Y);J.setDate(J.getDate()-7);const xe=new Date(Y);xe.setDate(xe.getDate()-1);const tt=E.value.filter(ye=>{const te=new Date(ye.fecha_cita+"T00:00:00");return te>=J&&te<=xe&&ye.estado!=="cancelada"}).reduce((ye,te)=>{if(te.hora_inicio&&te.hora_fin){const[no,lo]=te.hora_inicio.split(":").map(Number),[io,co]=te.hora_fin.split(":").map(Number);return ye+(io*60+co-(no*60+lo))}return ye+60},0),so=c>0?Math.round(tt/60/c*100):0;z=u-so,K=z>0?"up":z<0?"down":"neutral"}}return{ocupacion:u,horasLibres:Math.round(r*10)/10,citasAdicionales:m,tasaConfirmacion:f,pendientesRequierenSeguimiento:_,diferenciaSemanaAnterior:z,tendencia:K}}),Ft=async o=>{if(o){Je.value=!0,Ye.value=!0,C.value=null;try{const{data:t,error:n}=await ct.from("citas").select(`
        id,
        fecha_cita,
        hora_inicio,
        hora_fin,
        notas_terapeuta,
        observaciones,
        estado,
        paciente:pacientes(id, nombre_completo)
      `).eq("paciente_id",o).in("estado",["realizada","completada"]).order("fecha_cita",{ascending:!1}).order("hora_inicio",{ascending:!1}).limit(1).maybeSingle();if(n)throw n;C.value=t}catch(t){console.error("Error cargando notas última sesión:",t),x("Error al cargar las notas","error")}finally{Je.value=!1}}},Ge=()=>{Ye.value=!1,C.value=null},vt=b(()=>{const o=[],t=k.value.map(d=>d.fecha),n=new Date;n.setHours(0,0,0,0);const c=n.toISOString().split("T")[0];t.forEach(d=>{if(d<c)return;const u=new Date(d+"T00:00:00"),r=u.getDay();if(r===0||r===6)return;const m=E.value.filter(R=>R.fecha_cita===d&&R.estado!=="cancelada").sort((R,f)=>(R.hora_inicio||"").localeCompare(f.hora_inicio||"")),_=u.toLocaleDateString("es-ES",{weekday:"long"}),O=u.toLocaleDateString("es-ES",{day:"numeric",month:"short"});m.length<3&&m.length>0&&o.push({id:`hueco-${d}`,tipo:"hueco_disponible",mensaje:`${_.charAt(0).toUpperCase()+_.slice(1)} ${O}: ${8-m.length}h disponibles`,accion:"Agendar cita",prioridad:"media",fecha:d}),m.length===0&&o.push({id:`libre-${d}`,tipo:"dia_libre",mensaje:`${_.charAt(0).toUpperCase()+_.slice(1)} ${O}: día sin citas`,accion:"Agendar cita",prioridad:"baja",fecha:d}),m.length>=7&&o.push({id:`ocupado-${d}`,tipo:"alta_ocupacion",mensaje:`${_.charAt(0).toUpperCase()+_.slice(1)} ${O}: ${m.length} citas programadas`,prioridad:"alta",fecha:d})});const a={alta:0,media:1,baja:2};return o.sort((d,u)=>a[d.prioridad]-a[u.prioridad]).slice(0,3)}),gt=p(!0),ft=o=>{if(o.fecha){const[t,n,c]=o.fecha.split("-").map(Number);H.value=new Date(t,n-1,c),o.accion==="Agendar cita"&&(h.value="dia")}},W=p([]);ot(()=>{const o=localStorage.getItem("agenda-bloques-no-disponible");if(o)try{W.value=JSON.parse(o)}catch(t){console.error("Error parsing bloques:",t)}}),at(W,o=>{localStorage.setItem("agenda-bloques-no-disponible",JSON.stringify(o))},{deep:!0});const me=(o,t)=>{const n=parseInt(t.substring(0,2));return W.value.find(c=>{if(c.fecha!==o)return!1;const a=parseInt(c.hora_inicio.substring(0,2)),d=parseInt(c.hora_fin.substring(0,2));return n>=a&&n<d})},bt=(o,t,n)=>{if(n&&!n.ctrlKey&&!n.metaKey)return;const c=t.length===4?`0${t}`:t,d=`${(parseInt(c.substring(0,2))+1).toString().padStart(2,"0")}:00`;W.value.find(r=>r.fecha===o&&r.hora_inicio===c)?(W.value=W.value.filter(r=>!(r.fecha===o&&r.hora_inicio===c)),x("Bloque eliminado","info")):(W.value.push({fecha:o,hora_inicio:c,hora_fin:d}),x("Hora marcada como no disponible","info"))},pe=p(!1),Pt=b(()=>{const o=H.value,n=new Date(o.getFullYear(),o.getMonth(),1).getDay();return n===0?6:n-1}),ve=o=>pt.value.filter(t=>t.fecha_cita===o),Nt=o=>{switch(o){case"pendiente":return"bg-amber-100 text-amber-700";case"confirmada":return"bg-emerald-100 text-emerald-700";case"realizada":case"completada":return"bg-blue-100 text-blue-700";case"cancelada":return"bg-red-100 text-red-700";default:return"bg-gray-100 text-gray-600"}},Tt=o=>{const[t,n,c]=o.split("-").map(Number);H.value=new Date(t,n-1,c),h.value="dia"},Xe=(o,t)=>{const n=parseInt(t.substring(0,2));return pt.value.filter(c=>{if(c.fecha_cita!==o)return!1;const a=c.hora_inicio?.substring(0,5);return a?parseInt(a.substring(0,2))===n:!1})},Ot=o=>{const t=o.hora_inicio?.substring(0,5);return t?parseInt(t.substring(3,5))/60*Ie:0},Rt=o=>{const n=(o.duracion_minutos||60)/Fe*Ie;return Math.max(n-4,40)},Z=p(new Date),qt=p(null),Qe=p(null),Ut=p(null),ee=b(()=>{const o=Z.value,t=o.getHours(),n=o.getMinutes();return t<Q.value||t>=ce.value?null:((t-Q.value)*60+n)/Fe*Ie}),Kt=b(()=>Z.value.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit",hour12:!1})),$e=(o,t)=>{const n=new Date,c=`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}`;if(t!==c)return!1;const[a,d]=o.split(":").map(Number),u=Z.value,r=u.getHours()*60+u.getMinutes();return a*60+d+Fe<=r},Be=(o,t)=>{const n=new Date,c=`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}`;if(t!==c)return!1;const[a,d]=o.split(":").map(Number),u=Z.value,r=u.getHours()*60+u.getMinutes(),m=a*60+d,_=m+Fe;return r>=m&&r<_},ht=b(()=>{const o=Z.value,t=o.getHours(),n=o.getMinutes();if(t<Q.value)return 0;if(t>=ce.value)return 100;const c=(t-Q.value)*60+n,a=(ce.value-Q.value)*60;return Math.round(c/a*100)}),Yt=async()=>{H.value=new Date,await rt(),We()},We=()=>{if(!Qe.value||ee.value===null)return;const o=Qe.value,t=o.clientHeight,n=ee.value-t/2+Ie;o.scrollTo({top:Math.max(0,n),behavior:"smooth"})},xt=o=>{const t=new Date(H.value);h.value==="dia"?t.setDate(t.getDate()+o):h.value==="5dias"?t.setDate(t.getDate()+o*5):t.setDate(t.getDate()+o*7),H.value=t},Jt=()=>{H.value=new Date},Ve=o=>{const t=L.value.indexOf(o);t>-1?L.value.splice(t,1):L.value.push(o)},Gt=o=>{const t=new Date,c=(new Date(`${o.fecha_cita}T${o.hora_inicio||"00:00"}`).getTime()-t.getTime())/(1e3*60*60);let a=o.estado||"pendiente",d=!1,u=!1;return a==="pendiente"&&c>0&&c<=48&&(a="requiere_confirmacion",d=!0),a==="confirmada"&&c>0&&c<=24&&(a="proxima",u=!0),a==="confirmada"&&c>0&&c<=2&&(a="inminente",u=!0),{estado:a,esUrgente:d,esInminente:u}},Xt=o=>{const t={pendiente:{bg:"bg-amber-50",border:"border-l-amber-400",text:"text-amber-700",dot:"bg-amber-400",icon:"clock",label:"Pendiente",badge:"bg-amber-100 text-amber-700 border-amber-200"},requiere_confirmacion:{bg:"bg-orange-50",border:"border-l-orange-500",text:"text-orange-700",dot:"bg-orange-500",icon:"exclamation",label:"Confirmar",badge:"bg-orange-100 text-orange-700 border-orange-300 animate-pulse"},confirmada:{bg:"bg-emerald-50",border:"border-l-emerald-400",text:"text-emerald-700",dot:"bg-emerald-400",icon:"check",label:"Confirmada",badge:"bg-emerald-100 text-emerald-700 border-emerald-200"},proxima:{bg:"bg-green-50",border:"border-l-green-500",text:"text-green-700",dot:"bg-green-500",icon:"arrow-right",label:"Próxima",badge:"bg-green-100 text-green-700 border-green-300"},inminente:{bg:"bg-teal-50",border:"border-l-teal-500",text:"text-teal-700",dot:"bg-teal-500",icon:"bolt",label:"Ahora",badge:"bg-teal-100 text-teal-700 border-teal-300 ring-2 ring-teal-300 ring-opacity-50"},realizada:{bg:"bg-blue-50",border:"border-l-blue-400",text:"text-blue-700",dot:"bg-blue-400",icon:"check-circle",label:"Realizada",badge:"bg-blue-100 text-blue-700 border-blue-200"},completada:{bg:"bg-blue-50",border:"border-l-blue-400",text:"text-blue-700",dot:"bg-blue-400",icon:"check-circle",label:"Completada",badge:"bg-blue-100 text-blue-700 border-blue-200"},cancelada:{bg:"bg-gray-50",border:"border-l-gray-400",text:"text-gray-500",dot:"bg-gray-400",icon:"x-circle",label:"Cancelada",badge:"bg-gray-100 text-gray-500 border-gray-200"}};return t[o]||t.pendiente},y=o=>{const{estado:t,esUrgente:n,esInminente:c}=Gt(o);return{...Xt(t),estadoReal:t,esUrgente:n,esInminente:c}},Qt=(o,t)=>{Te.value=o,Oe.value=t,de.value=!0},Wt=(o,t,n)=>{if(n.ctrlKey||n.metaKey){bt(o,t);return}me(o,t)||Xe(o,t).length===0&&Qt(o,t)},He=o=>{Me.value=o,Re.value=!0},Zt=async()=>{if(!Pe.modoCoordinadora)return;const{data:o}=await ct.from("terapeutas").select("id, nombre_completo").eq("activo",!0).order("nombre_completo");Vt.value=(o||[]).map(t=>({id:t.id,nombre:t.nombre_completo}))},D=o=>o?.substring(0,5)||"",Ze=o=>o?new Date(o+"T00:00:00").toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long",year:"numeric"}):"",ge=b(()=>{const o=[];for(let t=9;t<=21;t++)o.push(`${String(t).padStart(2,"0")}:00`),t<21&&o.push(`${String(t).padStart(2,"0")}:30`);return o}),eo=b(()=>{if(!P.value)return ge.value;const o=ge.value.indexOf(P.value);return o===-1?ge.value:[...ge.value.slice(o+1),"22:00"]}),to=async(o,t)=>{if(t.stopPropagation(),!N.value){N.value=o;try{const n=await dt(o,"confirmada");n.success?x("Cita confirmada correctamente","success"):x(n.error||"Error al confirmar la cita","error")}catch(n){x(n.message||"Error al confirmar la cita","error")}finally{N.value=null}}},yt=(o,t)=>{t.stopPropagation();const n=E.value.find(c=>c.id===o);if(!n){x("Cita no encontrada","error");return}I.value=n,Se.value="",qe.value=!0},oo=async()=>{if(!(!I.value||ae.value)){ae.value=I.value.id;try{const o=await dt(I.value.id,"cancelada");o.success?(x("Cita cancelada correctamente","success"),fe()):x(o.error||"Error al cancelar la cita","error")}catch(o){x(o.message||"Error al cancelar la cita","error")}finally{ae.value=null}}},fe=()=>{qe.value=!1,I.value=null,Se.value=""},wt=(o,t)=>{t.stopPropagation();const n=E.value.find(c=>c.id===o);if(!n){x("Cita no encontrada","error");return}F.value=n,U.value=n.fecha_cita,P.value=D(n.hora_inicio),X.value=D(n.hora_fin),Ue.value=!0},ao=async()=>{if(!(!F.value||re.value)){if(!U.value||!P.value||!X.value){x("Por favor completa todos los campos","error");return}re.value=F.value.id;try{const o=await $t(F.value.id,U.value,P.value,X.value);if(o.success){const t=new Date(U.value+"T00:00:00").toLocaleDateString("es-ES",{day:"numeric",month:"short"});x(`Cita reprogramada a ${t} ${P.value}`,"success"),be()}else x(o.error||"Error al reprogramar la cita","error")}catch(o){x(o.message||"Error al reprogramar la cita","error")}finally{re.value=null}}},be=()=>{Ue.value=!1,F.value=null,U.value="",P.value="",X.value=""},kt=(o,t)=>{t.stopPropagation();const n=E.value.find(c=>c.id===o);if(!n){x("Cita no encontrada","error");return}A.value=n,Ke.value=!0},ro=async()=>{if(!(!A.value||se.value)){se.value=A.value.id;try{const o=await Bt(A.value.id);o.success?(x("Cita eliminada correctamente","success"),he()):x(o.error||"Error al eliminar la cita","error")}catch(o){x(o.message||"Error al eliminar la cita","error")}finally{se.value=null}}},he=()=>{Ke.value=!1,A.value=null};let et=null;const Ct=()=>{document.hidden||(Z.value=new Date)};return ot(async()=>{Pe.modoCoordinadora?(await jt(),await Zt()):await zt(),et=bo(()=>{Z.value=new Date},6e4),document.addEventListener("visibilitychange",Ct),await rt(),ne.value&&ee.value!==null&&setTimeout(()=>{We()},300)}),fo(()=>{et&&clearInterval(et),document.removeEventListener("visibilitychange",Ct)}),at([h,H],async()=>{await rt(),ne.value&&ee.value!==null&&setTimeout(()=>{We()},100)}),(o,t)=>{const n=mo,c=po;return s(),l("div",xo,[e("div",yo,[e("div",wo,[e("div",ko,[e("button",{onClick:t[0]||(t[0]=a=>xt(-1)),class:"w-8 h-8 rounded-full border border-gray-200 flex items-center justify-center text-gray-500 hover:bg-gray-50 hover:border-gray-300 transition-all","aria-label":"Semana anterior"},[...t[22]||(t[22]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),e("button",{onClick:Jt,class:"px-3 py-1 rounded-full border border-violet-500 text-violet-600 font-medium text-sm hover:bg-violet-50 transition-all"}," Hoy "),ne.value&&ee.value!==null?(s(),l("button",{key:0,onClick:Yt,class:"px-2 py-1 rounded-full bg-red-500 text-white font-medium text-xs hover:bg-red-600 transition-all flex items-center gap-1",title:"Ir a la hora actual"},[...t[23]||(t[23]=[e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),w(" Ahora ",-1)])])):v("",!0),e("button",{onClick:t[1]||(t[1]=a=>xt(1)),class:"w-8 h-8 rounded-full border border-gray-200 flex items-center justify-center text-gray-500 hover:bg-gray-50 hover:border-gray-300 transition-all","aria-label":"Semana siguiente"},[...t[24]||(t[24]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])]),e("div",Co,[e("h1",_o,i(Lt.value),1),ne.value?(s(),l("div",Mo,[t[25]||(t[25]=e("div",{class:"w-2 h-2 bg-violet-500 rounded-full animate-pulse"},null,-1)),e("span",So,"Hoy, "+i(It.value),1)])):v("",!0)]),ne.value?(s(),l("div",Do,[e("div",jo,[e("div",{class:"h-full bg-gradient-to-r from-violet-500 to-violet-400 rounded-full transition-all duration-1000",style:ke({width:`${ht.value}%`})},null,4)]),e("span",zo,i(ht.value)+"%",1)])):v("",!0)]),e("div",$o,[e("div",Bo,[t[26]||(t[26]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("svg",{class:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1)),Ce(e("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>_e.value=a),type:"text",placeholder:"Buscar paciente...",class:"w-full pl-9 pr-3 py-1.5 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-700 placeholder-gray-400 focus:outline-none focus:ring-1 focus:ring-violet-500/30 focus:border-violet-400 transition-all"},null,512),[[st,_e.value]])])]),e("div",Vo,[e("div",Ho,[(s(),l(B,null,V([{key:"dia",label:"D"},{key:"5dias",label:"5D"},{key:"semana",label:"S"},{key:"mes",label:"M"}],a=>e("button",{key:a.key,onClick:d=>h.value=a.key,class:g(["px-2.5 py-1 rounded-md text-xs font-medium transition-all",h.value===a.key?"bg-violet-500 text-white shadow-sm":"text-gray-600 hover:text-gray-900"]),title:a.key==="dia"?"Día":a.key==="5dias"?"5 Días":a.key==="semana"?"Semana":"Mes"},i(a.label),11,Ao)),64))]),h.value!=="mes"?(s(),l("button",{key:0,onClick:Et,class:g(["flex items-center gap-1.5 px-2 py-1.5 rounded-lg border text-xs font-medium transition-all",{"bg-violet-50 border-violet-300 text-violet-700":S.value==="activo","bg-amber-50 border-amber-300 text-amber-700":S.value==="auto","bg-gray-100 border-gray-200 text-gray-600":S.value==="completo"}]),title:`Modo horario: ${S.value==="auto"?"Automático":S.value==="activo"?"Solo horas activas":"Día completo"}`},[t[27]||(t[27]=e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"})],-1)),e("span",Lo,i(At.value),1)],10,Eo)):v("",!0),e("button",{onClick:t[3]||(t[3]=a=>q.value=!q.value),class:g(["p-1.5 rounded-lg border border-gray-200 text-gray-500 hover:bg-gray-50 transition-all",{"bg-violet-50 border-violet-300 text-violet-600":q.value}]),title:"Filtros"},[...t[28]||(t[28]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})],-1)])],2),e("button",{onClick:t[4]||(t[4]=a=>de.value=!0),class:"flex items-center gap-1.5 px-3 py-1.5 bg-violet-500 text-white font-medium text-sm rounded-lg hover:bg-violet-600 shadow-sm transition-all",title:"Agendar nueva cita (doble clic en hora vacía para crear rápido)"},[...t[29]||(t[29]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),e("span",{class:"hidden sm:inline"},"+ Cita",-1),e("span",{class:"sm:hidden"},"+",-1)])])])])]),e("div",Io,[e("div",Fo,[e("div",Po,[e("button",{onClick:t[5]||(t[5]=a=>Ve("pendiente")),class:g(["flex items-center gap-2 px-3 py-1.5 rounded-lg border transition-all",L.value.includes("pendiente")?"bg-amber-50 border-amber-200":"bg-white border-gray-200 opacity-60 hover:opacity-100"])},[t[31]||(t[31]=e("div",{class:"w-6 h-6 rounded-md bg-amber-100 flex items-center justify-center"},[e("svg",{class:"w-3.5 h-3.5 text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",No,[e("p",To,i(le.value.pendiente),1),t[30]||(t[30]=e("p",{class:"text-[9px] text-amber-600/70 font-medium"},"Pendientes",-1))])],2),e("button",{onClick:t[6]||(t[6]=a=>Ve("confirmada")),class:g(["flex items-center gap-2 px-3 py-1.5 rounded-lg border transition-all",L.value.includes("confirmada")?"bg-emerald-50 border-emerald-200":"bg-white border-gray-200 opacity-60 hover:opacity-100"])},[t[33]||(t[33]=e("div",{class:"w-6 h-6 rounded-md bg-emerald-100 flex items-center justify-center"},[e("svg",{class:"w-3.5 h-3.5 text-emerald-600",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"})])],-1)),e("div",Oo,[e("p",Ro,i(le.value.confirmada),1),t[32]||(t[32]=e("p",{class:"text-[9px] text-emerald-600/70 font-medium"},"Confirmadas",-1))])],2),t[41]||(t[41]=e("div",{class:"w-px h-8 bg-gray-200"},null,-1)),e("div",qo,[e("div",Uo,[e("span",Ko,i(j.value.ocupacion)+"%",1)]),e("div",Yo,[t[34]||(t[34]=e("p",{class:"text-xs font-medium text-violet-700"},"Ocupación",-1)),e("p",Jo,i(j.value.citasAdicionales>0?`Puedes agendar ${j.value.citasAdicionales} más`:"Agenda completa"),1)]),h.value==="semana"&&j.value.diferenciaSemanaAnterior!==0?(s(),l("div",{key:0,class:g(["flex items-center gap-0.5 px-1.5 py-0.5 rounded text-[10px] font-medium",j.value.tendencia==="up"?"bg-emerald-100 text-emerald-700":"bg-red-100 text-red-700"])},[j.value.tendencia==="up"?(s(),l("svg",Go,[...t[35]||(t[35]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 10l7-7m0 0l7 7m-7-7v18"},null,-1)])])):(s(),l("svg",Xo,[...t[36]||(t[36]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 14l-7 7m0 0l-7-7m7 7V3"},null,-1)])])),w(" "+i(Math.abs(j.value.diferenciaSemanaAnterior))+"% ",1)],2)):v("",!0)]),e("div",{class:g(["flex items-center gap-2 px-3 py-1.5 rounded-lg border",j.value.tasaConfirmacion>=80?"bg-emerald-50 border-emerald-200":"bg-amber-50 border-amber-200"])},[e("span",{class:g(["text-sm font-bold",j.value.tasaConfirmacion>=80?"text-emerald-700":"text-amber-700"])},i(j.value.tasaConfirmacion)+"% ",3),e("div",Qo,[e("p",{class:g(["text-xs font-medium",j.value.tasaConfirmacion>=80?"text-emerald-700":"text-amber-700"])}," Confirmación ",2),j.value.pendientesRequierenSeguimiento>0?(s(),l("p",Wo,i(j.value.pendientesRequierenSeguimiento)+" requieren seguimiento ",1)):v("",!0)])],2),t[42]||(t[42]=e("div",{class:"w-px h-8 bg-gray-200 hidden lg:block"},null,-1)),e("div",Zo,[t[38]||(t[38]=e("div",{class:"w-6 h-6 rounded-md bg-gray-100 flex items-center justify-center"},[e("svg",{class:"w-3.5 h-3.5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",ea,[e("p",ta,i(ze(ue.value.previstos)),1),t[37]||(t[37]=e("p",{class:"text-[9px] text-gray-500 font-medium"},"Previstos",-1))])]),ue.value.porCobrar>0?(s(),l("div",oa,[t[40]||(t[40]=e("div",{class:"w-6 h-6 rounded-md bg-white/20 flex items-center justify-center"},[e("svg",{class:"w-3.5 h-3.5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",aa,[e("p",ra,i(ze(ue.value.porCobrar)),1),t[39]||(t[39]=e("p",{class:"text-[9px] text-white/80 font-medium"},"Por cobrar",-1))])])):v("",!0)]),e("div",sa,[e("div",na,[e("button",{onClick:t[7]||(t[7]=a=>pe.value=!pe.value),class:g(["flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-xs font-medium transition-all",pe.value?"bg-gray-700 text-white":"bg-gray-100 text-gray-500 hover:bg-gray-150"]),title:"Ctrl+Clic en un slot para marcar/desmarcar como no disponible"},[t[43]||(t[43]=e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"})],-1)),e("span",la,i(pe.value?"Editando bloques":"Bloquear"),1)],2),t[44]||(t[44]=e("div",{class:"absolute right-0 top-full mt-1 w-48 p-2 bg-gray-900 text-white text-[10px] rounded-lg shadow-lg opacity-0 group-hover/bloques:opacity-100 pointer-events-none transition-opacity z-50"},[e("p",{class:"font-medium mb-1"},"Marcar horas no disponibles"),e("p",{class:"text-gray-300"},[w("Usa "),e("kbd",{class:"px-1 py-0.5 bg-gray-700 rounded"},"Ctrl"),w("+Clic en cualquier slot para bloquear/desbloquear.")])],-1))]),e("button",{onClick:t[8]||(t[8]=a=>q.value=!q.value),class:g(["flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-xs font-medium transition-all",q.value?"bg-gray-200 text-gray-700":"bg-gray-100 text-gray-500 hover:bg-gray-150"])},[t[46]||(t[46]=e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})],-1)),t[47]||(t[47]=w(" Más filtros ",-1)),(s(),l("svg",{class:g(["w-3 h-3 transition-transform",{"rotate-180":q.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[45]||(t[45]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))],2)])]),we(Ee,{"enter-active-class":"transition-all duration-200 ease-out","enter-from-class":"opacity-0 max-h-0","enter-to-class":"opacity-100 max-h-20","leave-active-class":"transition-all duration-150 ease-in","leave-from-class":"opacity-100 max-h-20","leave-to-class":"opacity-0 max-h-0"},{default:Ae(()=>[q.value?(s(),l("div",ia,[t[51]||(t[51]=e("span",{class:"text-[10px] text-gray-400 uppercase tracking-wider"},"Histórico:",-1)),e("button",{onClick:t[9]||(t[9]=a=>Ve("realizada")),class:g(["flex items-center gap-1.5 px-2.5 py-1 rounded-md border text-xs transition-all",L.value.includes("realizada")?"bg-blue-50 border-blue-200 text-blue-700":"bg-white border-gray-200 text-gray-500 opacity-60 hover:opacity-100"])},[t[48]||(t[48]=e("div",{class:"w-4 h-4 rounded bg-blue-100 flex items-center justify-center"},[e("svg",{class:"w-2.5 h-2.5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),w(" "+i(le.value.realizada)+" Realizadas ",1)],2),e("button",{onClick:t[10]||(t[10]=a=>Ve("cancelada")),class:g(["flex items-center gap-1.5 px-2.5 py-1 rounded-md border text-xs transition-all",L.value.includes("cancelada")?"bg-red-50 border-red-200 text-red-700":"bg-white border-gray-200 text-gray-500 opacity-60 hover:opacity-100"])},[t[49]||(t[49]=e("div",{class:"w-4 h-4 rounded bg-red-100 flex items-center justify-center"},[e("svg",{class:"w-2.5 h-2.5 text-red-600",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})])],-1)),w(" "+i(le.value.cancelada)+" Canceladas ",1)],2),ue.value.sesionesCanceladas>0?(s(),l("div",da,[t[50]||(t[50]=e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"})],-1)),w(" -"+i(ze(ue.value.perdido))+" perdido ",1)])):v("",!0)])):v("",!0)]),_:1})]),we(Ee,{"enter-active-class":"transition-all duration-200 ease-out","enter-from-class":"opacity-0 -translate-y-2","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition-all duration-150 ease-in","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 -translate-y-2"},{default:Ae(()=>[gt.value&&vt.value.length>0?(s(),l("div",ca,[e("div",ua,[t[53]||(t[53]=e("div",{class:"flex items-center gap-2"},[e("div",{class:"w-6 h-6 rounded-lg bg-blue-100 flex items-center justify-center"},[e("svg",{class:"w-3.5 h-3.5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})])]),e("span",{class:"text-xs font-semibold text-blue-700"},"Sugerencias para tu agenda")],-1)),e("button",{onClick:t[11]||(t[11]=a=>gt.value=!1),class:"w-6 h-6 rounded-full flex items-center justify-center hover:bg-blue-100 transition-colors"},[...t[52]||(t[52]=[e("svg",{class:"w-4 h-4 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",ma,[(s(!0),l(B,null,V(vt.value,a=>(s(),l("div",{key:a.id,class:g(["flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs transition-all cursor-pointer",{"bg-white/80 border border-amber-200 text-amber-700 hover:bg-amber-50":a.tipo==="hueco_disponible","bg-white/80 border border-gray-200 text-gray-600 hover:bg-gray-50":a.tipo==="dia_libre","bg-white/80 border border-red-200 text-red-700 hover:bg-red-50":a.tipo==="alta_ocupacion"}]),onClick:d=>ft(a)},[a.tipo==="hueco_disponible"?(s(),l("svg",va,[...t[54]||(t[54]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])])):a.tipo==="dia_libre"?(s(),l("svg",ga,[...t[55]||(t[55]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"},null,-1)])])):(s(),l("svg",fa,[...t[56]||(t[56]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"},null,-1)])])),e("span",ba,i(a.mensaje),1),a.accion?(s(),l("button",{key:3,class:"ml-1 px-2 py-0.5 rounded text-[10px] font-semibold bg-current/10 hover:bg-current/20 transition-colors",onClick:M(d=>ft(a),["stop"])},i(a.accion),9,ha)):v("",!0)],10,pa))),128))])])):v("",!0)]),_:1}),e("div",{ref_key:"scrollContainerRef",ref:Qe,class:"flex-1 overflow-auto scroll-smooth",style:{height:"calc(100vh - 100px)"}},[Le(Dt)?(s(),l("div",xa,[...t[57]||(t[57]=[e("div",{class:"flex items-center gap-3 text-gray-500"},[e("svg",{class:"w-6 h-6 animate-spin",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]),w(" Cargando agenda... ")],-1)])])):h.value==="mes"?(s(),l("div",ya,[e("div",wa,[(s(),l(B,null,V(["Lun","Mar","Mié","Jue","Vie","Sáb","Dom"],a=>e("div",{key:a,class:"text-center text-xs font-medium text-gray-500 uppercase py-2"},i(a),1)),64))]),e("div",ka,[(s(!0),l(B,null,V(Pt.value,a=>(s(),l("div",{key:"empty-"+a,class:"aspect-square"}))),128)),(s(!0),l(B,null,V(k.value,a=>(s(),l("div",{key:a.fecha,class:g(["min-h-[80px] border rounded-lg p-1.5 cursor-pointer transition-all hover:border-violet-300 hover:shadow-sm",{"bg-violet-50 border-violet-300":a.esHoy,"border-gray-200":!a.esHoy}]),onClick:d=>Tt(a.fecha)},[e("div",_a,[e("span",{class:g(["text-sm font-medium",a.esHoy?"text-violet-600":"text-gray-700"])},i(a.numeroDia),3),ve(a.fecha).length>0?(s(),l("span",{key:0,class:g(["text-[10px] font-medium px-1.5 py-0.5 rounded-full",a.esHoy?"bg-violet-200 text-violet-700":"bg-gray-100 text-gray-600"])},i(ve(a.fecha).length),3)):v("",!0)]),e("div",Ma,[(s(!0),l(B,null,V(ve(a.fecha).slice(0,3),d=>(s(),l("div",{key:d.id,class:g(["text-[9px] px-1 py-0.5 rounded truncate",Nt(d.estado)]),title:d.paciente?.nombre_completo||"Paciente"},i(d.hora_inicio?.substring(0,5))+" "+i(d.paciente?.nombre_completo?.split(" ")[0]||""),11,Sa))),128)),ve(a.fecha).length>3?(s(),l("div",Da," +"+i(ve(a.fecha).length-3)+" más ",1)):v("",!0)])],10,Ca))),128))])])):(s(),l("div",ja,[e("div",{class:"sticky top-0 z-20 bg-white border-b border-gray-200 grid",style:ke({gridTemplateColumns:`70px repeat(${k.value.length}, 1fr)`})},[t[58]||(t[58]=e("div",{class:"border-r border-gray-100"},null,-1)),(s(!0),l(B,null,V(k.value,a=>(s(),l("div",{key:a.fecha,class:g(["px-4 py-3 text-center border-r border-gray-100 last:border-r-0",{"bg-violet-50/50":a.esHoy}])},[e("p",za,i(a.diaSemana),1),e("p",{class:g(["text-2xl font-bold mt-1",a.esHoy?"text-violet-600":"text-gray-800"])},i(a.numeroDia),3),a.esHoy?(s(),l("div",$a)):v("",!0)],2))),128))],4),e("div",{ref_key:"gridHorasRef",ref:qt,class:"relative"},[ee.value!==null&&ne.value?(s(),l("div",{key:0,ref_key:"nowIndicatorRef",ref:Ut,class:"absolute z-30 flex items-center pointer-events-none",style:ke({top:`${ee.value}px`,left:"70px",right:"0"})},[t[59]||(t[59]=e("div",{class:"absolute -left-1.5 w-3 h-3 bg-red-500 rounded-full shadow-sm ring-2 ring-red-200"},null,-1)),e("div",Ba,[e("span",Va,i(Kt.value),1)]),t[60]||(t[60]=e("div",{class:"flex-1 h-0.5 bg-red-500 shadow-sm"},null,-1))],4)):v("",!0),(s(!0),l(B,null,V(Ht.value,(a,d)=>(s(),l("div",{key:a,class:"grid border-b border-gray-100",style:ke({gridTemplateColumns:`70px repeat(${k.value.length}, 1fr)`})},[e("div",{class:g(["px-3 py-2 text-xs font-medium text-right border-r border-gray-100 flex items-start justify-end",[Be(a,k.value.find(u=>u.esHoy)?.fecha||"")?"text-red-500 font-semibold":"text-gray-400"]]),style:{height:"88px"}},i(a),3),(s(!0),l(B,null,V(k.value,u=>(s(),l("div",{key:`${u.fecha}-${a}`,class:g(["relative border-r border-gray-100 last:border-r-0 transition-colors cursor-pointer group",[u.esHoy?"bg-violet-50/20":"",$e(a,u.fecha)?"bg-gray-100/60":"",Be(a,u.fecha)?"bg-red-50/30 ring-1 ring-inset ring-red-100":"",!$e(a,u.fecha)&&!Be(a,u.fecha)&&!me(u.fecha,a)?"hover:bg-violet-50/30":"",!$e(a,u.fecha)&&!Be(a,u.fecha)&&me(u.fecha,a)?"hover:bg-gray-200/40":"",pe.value?"cursor-crosshair":""]]),style:{height:"88px"},onClick:r=>Wt(u.fecha,a,r)},[me(u.fecha,a)?(s(),l("div",{key:0,class:"absolute inset-0 flex items-center justify-center z-20",style:{background:"repeating-linear-gradient(45deg, transparent, transparent 4px, rgba(156, 163, 175, 0.15) 4px, rgba(156, 163, 175, 0.15) 8px)"},onClick:M(r=>bt(u.fecha,a,r),["stop"])},[...t[61]||(t[61]=[e("div",{class:"flex items-center gap-1.5 px-2 py-1 bg-gray-200/90 rounded-lg border border-gray-300/50"},[e("svg",{class:"w-3.5 h-3.5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"})]),e("span",{class:"text-xs font-medium text-gray-500"},"No disponible")],-1)])],8,Aa)):v("",!0),Xe(u.fecha,a).length===0&&!$e(a,u.fecha)&&!me(u.fecha,a)?(s(),l("div",Ea,[...t[62]||(t[62]=[e("div",{class:"w-6 h-6 rounded-full bg-violet-500/80 text-white flex items-center justify-center"},[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})])],-1)])])):v("",!0),(s(!0),l(B,null,V(Xe(u.fecha,a),r=>(s(),l("div",{key:r.id,onClick:M(m=>He(r.id),["stop"]),onKeydown:[G(M(m=>He(r.id),["stop"]),["enter"]),G(M(m=>He(r.id),["prevent","stop"]),["space"])],role:"button",tabindex:"0","aria-label":`Cita ${y(r).label} de ${r.paciente?.nombre_completo||"paciente"}, ${D(r.hora_inicio)} a ${D(r.hora_fin)}`,class:g(["absolute inset-x-0.5 p-2 rounded-lg border-l-4 cursor-pointer hover:shadow-lg hover:z-30 transition-all z-10 group/card overflow-hidden",[y(r).bg,y(r).border,{"ring-2 ring-orange-300 ring-opacity-60":y(r).esUrgente},{"ring-2 ring-teal-300 ring-opacity-60":y(r).esInminente},{"ring-2 ring-orange-400 ring-offset-1":r.bono_id&&r.bono&&!r.bono.pagado}]]),style:ke({height:`${Rt(r)}px`,top:`${Ot(r)+2}px`})},[r.estado==="pendiente"?(s(),l("button",{key:0,onClick:M(m=>to(r.id,m),["stop"]),class:g(["absolute top-1 right-1 flex items-center gap-0.5 px-1.5 py-0.5 rounded-full text-[9px] font-bold border transition-all cursor-pointer hover:bg-emerald-100 hover:border-emerald-300 hover:text-emerald-700 active:scale-95 group/badge",[N.value===r.id?"bg-emerald-100 border-emerald-300 text-emerald-700 animate-pulse":y(r).badge]]),disabled:N.value===r.id,title:N.value===r.id?"Confirmando...":"Clic para confirmar",type:"button"},[N.value===r.id?(s(),l("svg",Fa,[...t[63]||(t[63]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"},null,-1)])])):(s(),l(B,{key:1},[t[64]||(t[64]=e("svg",{class:"w-2.5 h-2.5 group-hover/badge:hidden",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),t[65]||(t[65]=e("svg",{class:"w-2.5 h-2.5 hidden group-hover/badge:block",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"})],-1))],64)),e("span",Pa,i(N.value===r.id?"...":"Pendiente"),1),N.value!==r.id?(s(),l("span",Na,"Confirmar")):v("",!0)],10,Ia)):(s(),l("div",{key:1,class:g(["absolute top-1 right-1 flex items-center gap-0.5 px-1.5 py-0.5 rounded-full text-[9px] font-bold border transition-all",y(r).badge])},[y(r).icon==="check"?(s(),l("svg",Ta,[...t[66]||(t[66]=[e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)])])):y(r).icon==="arrow-right"?(s(),l("svg",Oa,[...t[67]||(t[67]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7l5 5m0 0l-5 5m5-5H6"},null,-1)])])):y(r).icon==="bolt"?(s(),l("svg",Ra,[...t[68]||(t[68]=[e("path",{"fill-rule":"evenodd",d:"M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z","clip-rule":"evenodd"},null,-1)])])):y(r).icon==="check-circle"?(s(),l("svg",qa,[...t[69]||(t[69]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])])):y(r).icon==="x-circle"?(s(),l("svg",Ua,[...t[70]||(t[70]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])])):y(r).icon==="exclamation"?(s(),l("svg",Ka,[...t[71]||(t[71]=[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"},null,-1)])])):v("",!0),e("span",Ya,i(y(r).label),1)],2)),e("div",Ja,[e("div",Ga,[r.estado!=="cancelada"&&r.estado!=="realizada"&&r.estado!=="completada"?(s(),l("button",{key:0,onClick:m=>wt(r.id,m),onKeydown:G(M(m=>wt(r.id,m),["stop"]),["enter"]),class:"w-5 h-5 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center hover:bg-blue-500 hover:text-white hover:scale-110 transition-all focus:outline-none focus:ring-2 focus:ring-blue-400",title:"Reprogramar cita","aria-label":`Reprogramar cita de ${r.paciente?.nombre_completo||"paciente"}`,type:"button"},[...t[72]||(t[72]=[e("svg",{class:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)])],40,Xa)):v("",!0),e("button",{onClick:M(m=>He(r.id),["stop"]),class:"w-5 h-5 rounded-full bg-violet-100 text-violet-600 flex items-center justify-center hover:bg-violet-500 hover:text-white hover:scale-110 transition-all focus:outline-none focus:ring-2 focus:ring-violet-400",title:"Ver detalles","aria-label":`Ver detalles de cita de ${r.paciente?.nombre_completo||"paciente"}`,type:"button"},[...t[73]||(t[73]=[e("svg",{class:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1)])],8,Qa)]),r.estado!=="cancelada"&&r.estado!=="realizada"&&r.estado!=="completada"?(s(),l("div",Wa,[e("button",{onClick:m=>yt(r.id,m),onKeydown:G(M(m=>yt(r.id,m),["stop"]),["enter"]),class:"w-5 h-5 rounded-full bg-red-100 text-red-500 flex items-center justify-center hover:bg-red-500 hover:text-white hover:scale-110 transition-all focus:outline-none focus:ring-2 focus:ring-red-400",title:"Cancelar cita","aria-label":`Cancelar cita de ${r.paciente?.nombre_completo||"paciente"}`,type:"button"},[...t[74]||(t[74]=[e("svg",{class:"w-2.5 h-2.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)])],40,Za),e("button",{onClick:m=>kt(r.id,m),onKeydown:G(M(m=>kt(r.id,m),["stop"]),["enter"]),class:"w-5 h-5 rounded-full bg-red-100 text-red-600 flex items-center justify-center hover:bg-red-600 hover:text-white hover:scale-110 transition-all focus:outline-none focus:ring-2 focus:ring-red-400",title:"Eliminar cita","aria-label":`Eliminar cita de ${r.paciente?.nombre_completo||"paciente"}`,type:"button"},[...t[75]||(t[75]=[e("svg",{class:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],40,er)])):v("",!0)]),e("div",tr,[e("div",or,[r.modalidad?(s(),l("span",{key:0,class:g(["flex-shrink-0 w-4 h-4 rounded flex items-center justify-center",r.modalidad==="online"?"bg-teal-100 text-teal-600":"bg-blue-100 text-blue-600"]),title:r.modalidad==="online"?"Sesión Online":"Sesión Presencial"},[r.modalidad==="online"?(s(),l("svg",rr,[...t[76]||(t[76]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"},null,-1)])])):(s(),l("svg",sr,[...t[77]||(t[77]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"},null,-1)])]))],10,ar)):v("",!0),e("p",{class:g(["text-sm font-bold leading-tight flex-1",[y(r).text,{"line-clamp-2":h.value==="semana","line-clamp-1":h.value==="5dias"}]]),title:r.paciente?.nombre_completo||"Sin paciente"},i(r.paciente?.nombre_completo||"Sin paciente"),11,nr)]),e("p",lr,[e("span",null,i(D(r.hora_inicio))+"–"+i(D(r.hora_fin)),1),r.bono_id&&r.bono&&!r.bono.pagado?(s(),l("span",ir,[...t[78]||(t[78]=[e("svg",{class:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a2 2 0 100-4 2 2 0 000 4z","clip-rule":"evenodd"})],-1)])])):v("",!0)])]),e("div",dr,[e("div",cr,[e("div",ur,[e("p",mr,i(r.paciente?.nombre_completo||"Sin paciente"),1),e("span",{class:g(["flex-shrink-0 inline-flex items-center gap-1 px-1.5 py-0.5 rounded-full text-[10px] font-medium",y(r).badge])},i(y(r).label),3)]),e("div",pr,[t[79]||(t[79]=e("svg",{class:"w-3.5 h-3.5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",null,i(D(r.hora_inicio))+" - "+i(D(r.hora_fin)),1),t[80]||(t[80]=e("span",{class:"text-gray-500"},"|",-1)),e("span",{class:g(r.modalidad==="online"?"text-teal-400":"text-blue-400")},i(r.modalidad==="online"?"Online":"Presencial"),3)]),r.paciente?.telefono?(s(),l("div",vr,[t[81]||(t[81]=e("svg",{class:"w-3.5 h-3.5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})],-1)),e("span",gr,i(r.paciente.telefono),1)])):v("",!0),t[87]||(t[87]=e("div",{class:"border-t border-gray-700 my-2"},null,-1)),r.bono_id&&r.bono?(s(),l("div",fr,[e("div",br,[t[82]||(t[82]=e("svg",{class:"w-3.5 h-3.5 text-violet-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"})],-1)),e("span",hr,"Bono "+i(r.bono.tipo||"activo"),1)]),e("div",xr,[e("span",yr,[t[83]||(t[83]=w(" Sesiones: ",-1)),e("span",wr,i(r.bono.sesiones_restantes||0)+"/"+i(r.bono.sesiones_totales||0),1)]),r.bono.pagado?(s(),l("span",Cr," Pagado ")):(s(),l("span",kr," Pendiente pago "))])])):(s(),l("div",_r," Sin bono asociado ")),r.precio_sesion?(s(),l("div",Mr,[t[84]||(t[84]=e("svg",{class:"w-3.5 h-3.5 text-emerald-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",null,i(ze(r.precio_sesion))+" / sesión",1)])):v("",!0),r.observaciones?(s(),l("div",Sr,[t[85]||(t[85]=e("p",{class:"text-gray-400 text-[10px] uppercase tracking-wider mb-1"},"Notas",-1)),e("p",Dr,i(r.observaciones),1)])):v("",!0),r.paciente_id?(s(),l("button",{key:5,onClick:M(m=>Ft(r.paciente_id),["stop"]),class:"mt-3 w-full flex items-center justify-center gap-1.5 px-3 py-2 bg-violet-600 hover:bg-violet-700 text-white text-xs font-medium rounded-lg transition-colors pointer-events-auto"},[...t[86]||(t[86]=[e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),w(" Revisar notas última sesión ",-1)])],8,jr)):v("",!0),t[88]||(t[88]=e("div",{class:"mt-3 pt-2 border-t border-gray-700 flex items-center gap-1 text-gray-500 text-[10px]"},[e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("span",null,"Clic para ver detalles completos")],-1))])])],46,La))),128))],10,Ha))),128))],4))),128))],512)]))],512),we(n,{"is-open":de.value,"fecha-inicial":Te.value||void 0,"hora-inicial":Oe.value||void 0,onCreated:t[12]||(t[12]=a=>{de.value=!1,Le(Ne)()}),onClose:t[13]||(t[13]=a=>{de.value=!1,Te.value=null,Oe.value=null})},null,8,["is-open","fecha-inicial","hora-inicial"]),(s(),oe(ie,{to:"body"},[Re.value&&Me.value?(s(),oe(c,{key:0,"cita-id":Me.value,onClose:t[14]||(t[14]=a=>{Re.value=!1,Me.value=null}),onCitaActualizada:t[15]||(t[15]=a=>Le(Ne)()),onActualizado:t[16]||(t[16]=a=>Le(Ne)())},null,8,["cita-id"])):v("",!0)])),(s(),oe(ie,{to:"body"},[qe.value&&I.value?(s(),l("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:M(fe,["self"]),onKeydown:G(fe,["escape"]),role:"dialog","aria-modal":"true","aria-labelledby":"modal-cancelar-titulo"},[e("div",zr,[e("div",{class:"px-6 py-4 border-b border-gray-100 bg-gradient-to-r from-red-50 to-rose-50"},[e("div",{class:"flex items-center justify-between"},[t[90]||(t[90]=e("div",null,[e("h2",{id:"modal-cancelar-titulo",class:"text-lg font-semibold text-gray-900"},"Cancelar Cita"),e("p",{class:"text-sm text-gray-500 mt-0.5"},"Esta acción no se puede deshacer")],-1)),e("button",{onClick:fe,class:"w-8 h-8 rounded-full bg-white/80 flex items-center justify-center text-gray-400 hover:text-gray-600 hover:bg-white transition-all focus:outline-none focus:ring-2 focus:ring-red-400","aria-label":"Cerrar modal"},[...t[89]||(t[89]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),e("div",$r,[e("div",Br,[t[94]||(t[94]=e("p",{class:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-3"},"Resumen de la cita",-1)),e("div",Vr,[e("div",Hr,[t[92]||(t[92]=e("div",{class:"w-10 h-10 rounded-lg bg-violet-100 flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-violet-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})])],-1)),e("div",null,[e("p",Ar,i(I.value.paciente?.nombre_completo||"Paciente"),1),t[91]||(t[91]=e("p",{class:"text-sm text-gray-500"},"Paciente",-1))])]),e("div",Er,[t[93]||(t[93]=e("div",{class:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1)),e("div",null,[e("p",Lr,i(Ze(I.value.fecha_cita)),1),e("p",Ir,i(D(I.value.hora_inicio))+" - "+i(D(I.value.hora_fin)),1)])])])]),e("div",null,[t[95]||(t[95]=e("label",{for:"motivo-cancelacion",class:"block text-sm font-medium text-gray-700 mb-2"},[w(" Motivo de cancelación "),e("span",{class:"text-gray-400"},"(opcional)")],-1)),Ce(e("textarea",{id:"motivo-cancelacion","onUpdate:modelValue":t[17]||(t[17]=a=>Se.value=a),rows:"3",placeholder:"Ej: Solicitud del paciente, reagendamiento...",class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-red-500/30 focus:border-red-400 transition-all resize-none"},null,512),[[st,Se.value]])]),t[96]||(t[96]=e("div",{class:"flex items-start gap-3 p-4 bg-amber-50 rounded-xl border border-amber-200"},[e("svg",{class:"w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})]),e("p",{class:"text-sm text-amber-800"}," Al cancelar esta cita, el paciente podría recibir una notificación. ")],-1))]),e("div",Fr,[e("button",{onClick:fe,class:"px-5 py-2.5 text-gray-700 font-medium rounded-xl hover:bg-gray-100 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-300"}," Volver "),e("button",{onClick:oo,disabled:ae.value!==null,class:"px-5 py-2.5 bg-red-600 text-white font-medium rounded-xl hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2 focus:outline-none focus:ring-2 focus:ring-red-400"},[ae.value?(s(),l("svg",Nr,[...t[97]||(t[97]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"},null,-1)])])):v("",!0),w(" "+i(ae.value?"Cancelando...":"Cancelar cita"),1)],8,Pr)])])],32)):v("",!0)])),(s(),oe(ie,{to:"body"},[Ue.value&&F.value?(s(),l("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:M(be,["self"]),onKeydown:G(be,["escape"]),role:"dialog","aria-modal":"true","aria-labelledby":"modal-reprogramar-titulo"},[e("div",Tr,[e("div",Or,[e("div",Rr,[e("div",null,[t[98]||(t[98]=e("h2",{id:"modal-reprogramar-titulo",class:"text-lg font-semibold text-gray-900"},"Reprogramar Cita",-1)),e("p",qr,i(F.value.paciente?.nombre_completo||"Paciente"),1)]),e("button",{onClick:be,class:"w-8 h-8 rounded-full bg-white/80 flex items-center justify-center text-gray-400 hover:text-gray-600 hover:bg-white transition-all focus:outline-none focus:ring-2 focus:ring-blue-400","aria-label":"Cerrar modal"},[...t[99]||(t[99]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),e("div",Ur,[e("div",Kr,[t[101]||(t[101]=e("p",{class:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-2"},"Cita actual",-1)),e("div",Yr,[t[100]||(t[100]=e("div",{class:"w-10 h-10 rounded-lg bg-gray-200 flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1)),e("div",null,[e("p",Jr,i(Ze(F.value.fecha_cita)),1),e("p",Gr,i(D(F.value.hora_inicio))+" - "+i(D(F.value.hora_fin)),1)])])]),t[105]||(t[105]=e("div",{class:"flex justify-center"},[e("div",{class:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 14l-7 7m0 0l-7-7m7 7V3"})])])],-1)),e("div",null,[t[102]||(t[102]=e("label",{for:"nueva-fecha",class:"block text-sm font-medium text-gray-700 mb-2"},"Nueva fecha",-1)),Ce(e("input",{id:"nueva-fecha",type:"date","onUpdate:modelValue":t[18]||(t[18]=a=>U.value=a),min:new Date().toISOString().split("T")[0],class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 transition-all"},null,8,Xr),[[st,U.value]])]),e("div",Qr,[e("div",null,[t[103]||(t[103]=e("label",{for:"nueva-hora-inicio",class:"block text-sm font-medium text-gray-700 mb-2"},"Hora inicio",-1)),Ce(e("select",{id:"nueva-hora-inicio","onUpdate:modelValue":t[19]||(t[19]=a=>P.value=a),class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 transition-all"},[(s(!0),l(B,null,V(ge.value,a=>(s(),l("option",{key:a,value:a},i(a),9,Wr))),128))],512),[[Mt,P.value]])]),e("div",null,[t[104]||(t[104]=e("label",{for:"nueva-hora-fin",class:"block text-sm font-medium text-gray-700 mb-2"},"Hora fin",-1)),Ce(e("select",{id:"nueva-hora-fin","onUpdate:modelValue":t[20]||(t[20]=a=>X.value=a),class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 transition-all"},[(s(!0),l(B,null,V(eo.value,a=>(s(),l("option",{key:a,value:a},i(a),9,Zr))),128))],512),[[Mt,X.value]])])])]),e("div",es,[e("button",{onClick:be,class:"px-5 py-2.5 text-gray-700 font-medium rounded-xl hover:bg-gray-100 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-300"}," Cancelar "),e("button",{onClick:ao,disabled:!U.value||!P.value||!X.value||re.value!==null,class:"px-5 py-2.5 bg-blue-600 text-white font-medium rounded-xl hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2 focus:outline-none focus:ring-2 focus:ring-blue-400"},[re.value?(s(),l("svg",os,[...t[106]||(t[106]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"},null,-1)])])):v("",!0),w(" "+i(re.value?"Reprogramando...":"Confirmar"),1)],8,ts)])])],32)):v("",!0)])),(s(),oe(ie,{to:"body"},[Ke.value&&A.value?(s(),l("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:M(he,["self"]),onKeydown:G(he,["escape"]),role:"dialog","aria-modal":"true","aria-labelledby":"modal-eliminar-titulo"},[e("div",as,[e("div",{class:"px-6 py-4 border-b border-gray-100 bg-gradient-to-r from-gray-50 to-slate-50"},[e("div",{class:"flex items-center justify-between"},[t[108]||(t[108]=e("div",null,[e("h2",{id:"modal-eliminar-titulo",class:"text-lg font-semibold text-gray-900"},"Eliminar Cita"),e("p",{class:"text-sm text-gray-500 mt-0.5"},"Esta acción eliminará la cita permanentemente")],-1)),e("button",{onClick:he,class:"w-8 h-8 rounded-full bg-white/80 flex items-center justify-center text-gray-400 hover:text-gray-600 hover:bg-white transition-all focus:outline-none focus:ring-2 focus:ring-gray-400","aria-label":"Cerrar modal"},[...t[107]||(t[107]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),e("div",rs,[e("div",ss,[t[114]||(t[114]=e("p",{class:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-3"},"Cita a eliminar",-1)),e("div",ns,[e("div",ls,[t[110]||(t[110]=e("div",{class:"w-10 h-10 rounded-lg bg-violet-100 flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-violet-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})])],-1)),e("div",null,[e("p",is,i(A.value.paciente?.nombre_completo||"Paciente"),1),t[109]||(t[109]=e("p",{class:"text-sm text-gray-500"},"Paciente",-1))])]),e("div",ds,[t[111]||(t[111]=e("div",{class:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1)),e("div",null,[e("p",cs,i(Ze(A.value.fecha_cita)),1),e("p",us,i(D(A.value.hora_inicio))+" - "+i(D(A.value.hora_fin)),1)])]),e("div",ms,[t[113]||(t[113]=e("div",{class:"w-10 h-10 rounded-lg bg-amber-100 flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",null,[e("p",ps,i(A.value.estado),1),t[112]||(t[112]=e("p",{class:"text-sm text-gray-500"},"Estado actual",-1))])])])]),t[115]||(t[115]=e("div",{class:"flex items-start gap-3 p-4 bg-red-50 rounded-xl border border-red-200"},[e("svg",{class:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})]),e("div",{class:"text-sm text-red-800"},[e("p",{class:"font-semibold"},"Esta acción no se puede deshacer"),e("p",{class:"mt-1"},"La cita se eliminará permanentemente del sistema. Si la cita tiene un bono asociado, la sesión se reintegrará automáticamente.")])],-1))]),e("div",vs,[e("button",{onClick:he,class:"px-5 py-2.5 text-gray-700 font-medium rounded-xl hover:bg-gray-100 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-300"}," Cancelar "),e("button",{onClick:ro,disabled:se.value!==null,class:"px-5 py-2.5 bg-gray-700 text-white font-medium rounded-xl hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2 focus:outline-none focus:ring-2 focus:ring-gray-500"},[se.value?(s(),l("svg",fs,[...t[116]||(t[116]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"},null,-1)])])):(s(),l("svg",bs,[...t[117]||(t[117]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"},null,-1)])])),w(" "+i(se.value?"Eliminando...":"Eliminar cita"),1)],8,gs)])])],32)):v("",!0)])),(s(),oe(ie,{to:"body"},[we(Ee,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:Ae(()=>[Ye.value?(s(),l("div",{key:0,class:"fixed inset-0 z-[60] flex items-center justify-center p-4",onClick:M(Ge,["self"])},[t[127]||(t[127]=e("div",{class:"absolute inset-0 bg-black/50"},null,-1)),e("div",hs,[e("div",xs,[e("div",ys,[t[119]||(t[119]=e("div",{class:"w-10 h-10 rounded-xl bg-violet-100 flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-violet-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1)),e("div",null,[t[118]||(t[118]=e("h3",{class:"font-semibold text-gray-900"},"Notas última sesión",-1)),C.value?.paciente?.nombre_completo?(s(),l("p",ws,i(C.value.paciente.nombre_completo),1)):v("",!0)])]),e("button",{onClick:Ge,class:"w-8 h-8 rounded-full flex items-center justify-center hover:bg-gray-100 transition-colors"},[...t[120]||(t[120]=[e("svg",{class:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",ks,[Je.value?(s(),l("div",Cs,[...t[121]||(t[121]=[e("svg",{class:"w-8 h-8 text-violet-500 animate-spin",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})],-1)])])):C.value?(s(),l("div",Ms,[e("div",Ss,[t[123]||(t[123]=e("div",{class:"w-10 h-10 rounded-lg bg-white border border-gray-200 flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1)),e("div",null,[e("p",Ds,i(new Date(C.value.fecha_cita+"T00:00:00").toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"})),1),e("p",js,i(C.value.hora_inicio?.substring(0,5))+" - "+i(C.value.hora_fin?.substring(0,5)),1)])]),C.value.notas_terapeuta?(s(),l("div",zs,[t[124]||(t[124]=e("h4",{class:"text-xs font-semibold text-gray-500 uppercase tracking-wider flex items-center gap-2"},[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})]),w(" Notas del terapeuta ")],-1)),e("div",$s,[e("p",Bs,i(C.value.notas_terapeuta),1)])])):v("",!0),C.value.observaciones?(s(),l("div",Vs,[t[125]||(t[125]=e("h4",{class:"text-xs font-semibold text-gray-500 uppercase tracking-wider flex items-center gap-2"},[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})]),w(" Observaciones ")],-1)),e("div",Hs,[e("p",As,i(C.value.observaciones),1)])])):v("",!0),!C.value.notas_terapeuta&&!C.value.observaciones?(s(),l("div",Es,[...t[126]||(t[126]=[e("p",{class:"text-gray-400 italic"},"Esta sesión no tiene notas registradas.",-1)])])):v("",!0)])):(s(),l("div",_s,[...t[122]||(t[122]=[e("div",{class:"w-16 h-16 mx-auto rounded-full bg-gray-100 flex items-center justify-center mb-4"},[e("svg",{class:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1),e("p",{class:"text-gray-500 font-medium"},"Sin sesiones previas",-1),e("p",{class:"text-gray-400 text-sm mt-1"},"Este paciente no tiene sesiones completadas registradas.",-1)])]))]),e("div",{class:"px-6 py-4 border-t border-gray-100 bg-gray-50 flex justify-end"},[e("button",{onClick:Ge,class:"px-4 py-2 text-gray-700 font-medium rounded-xl hover:bg-gray-100 transition-colors"}," Cerrar ")])])])):v("",!0)]),_:1})])),(s(),oe(ie,{to:"body"},[we(Ee,{"enter-active-class":"transition ease-out duration-300","enter-from-class":"transform translate-y-4 opacity-0","enter-to-class":"transform translate-y-0 opacity-100","leave-active-class":"transition ease-in duration-200","leave-from-class":"transform translate-y-0 opacity-100","leave-to-class":"transform translate-y-4 opacity-0"},{default:Ae(()=>[De.value?(s(),l("div",Ls,[e("div",{class:g(["flex items-center gap-3 px-4 py-3 rounded-xl shadow-lg border",{"bg-emerald-50 border-emerald-200 text-emerald-800":T.value==="success","bg-red-50 border-red-200 text-red-800":T.value==="error","bg-blue-50 border-blue-200 text-blue-800":T.value==="info"}])},[e("div",{class:g(["w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",{"bg-emerald-100":T.value==="success","bg-red-100":T.value==="error","bg-blue-100":T.value==="info"}])},[T.value==="success"?(s(),l("svg",Is,[...t[128]||(t[128]=[e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)])])):T.value==="error"?(s(),l("svg",Fs,[...t[129]||(t[129]=[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"},null,-1)])])):(s(),l("svg",Ps,[...t[130]||(t[130]=[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"},null,-1)])]))],2),e("p",Ns,i(mt.value),1),e("button",{onClick:t[21]||(t[21]=a=>De.value=!1),class:"w-6 h-6 rounded-full flex items-center justify-center hover:bg-black/5 transition-colors","aria-label":"Cerrar notificación"},[...t[131]||(t[131]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])],2)])):v("",!0)]),_:1})]))])}}}),Js=Object.assign(ho(Ts,[["__scopeId","data-v-6c821b5b"]]),{__name:"AgendaCalendario"});export{Js as _};
