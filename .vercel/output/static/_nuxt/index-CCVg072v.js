import{e as Ye,L as Ge,g as We,B as Ze,r as C,z as M,s as Je,D as Ke,c,a as e,b as D,d as v,t as l,k as n,n as x,h as ke,w as J,M as K,j as f,m as de,v as Qe,F as $,i as A,K as Xe,o as d,A as et,J as Q,am as tt,y as ot}from"#entry";import{M as at}from"./ModalDetallesCita-CxtIMQaR.js";import{B as st,L as nt,D as rt}from"./index-CYlovTC9.js";import{Chart as it,CategoryScale as lt,LinearScale as dt,BarElement as ct,PointElement as ut,LineElement as pt,ArcElement as mt,Title as gt,Tooltip as xt,Legend as ft,Filler as ht}from"./chart-BdQHVWbB.js";import{r as bt}from"./PlusIcon-UqRq4KLf.js";import{r as vt}from"./ClockIcon-CQZt9cKZ.js";import{r as Ce}from"./CheckCircleIcon-Bi0YyG7H.js";import{r as ce}from"./CalendarDaysIcon-C0vq0F4x.js";import{r as yt}from"./MagnifyingGlassIcon-B5My0XuL.js";import{r as wt}from"./ExclamationTriangleIcon-BreoAuwB.js";import{r as _t}from"./ChevronRightIcon-Ck2OajRo.js";import{r as kt}from"./ChevronDownIcon-BwiNUDLV.js";import"./PaymentMethodSelector-BdCeWAUw.js";import"./useToast-Cq0GyJHs.js";import"./ModalNuevoBono-DZsr-zos.js";import"./useBonos-BSiCGD07.js";import"./XMarkIcon-DWNj0d99.js";import"./PencilIcon-QJyqa3i7.js";import"./PhoneIcon-B4J2dtua.js";import"./TicketIcon-DRclOuRO.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Ct={class:"mb-6"},Dt={class:"flex items-center justify-between mb-4"},Mt={class:"text-2xl font-semibold text-gray-900"},zt={class:"text-gray-400 font-normal"},St={class:"flex items-center gap-2"},Bt={class:"relative"},Ft={key:0,class:"absolute right-0 top-full mt-1 w-48 bg-white rounded-lg shadow-lg border border-gray-100 py-1 z-50"},jt={class:"px-3 py-1 text-xs text-gray-400"},Et={class:"flex items-center bg-gray-100 rounded-lg p-1"},Pt={class:"bg-gradient-to-r from-gray-50 to-white border border-gray-100 rounded-xl p-4 mb-4"},Tt={class:"flex items-stretch gap-4 overflow-x-auto pb-1"},$t={class:"flex items-center gap-2 flex-shrink-0"},At={class:"flex items-center gap-2 px-3 py-2 rounded-xl bg-amber-50 border border-amber-100 min-w-[85px]"},Ht={class:"w-7 h-7 rounded-lg bg-amber-100 flex items-center justify-center flex-shrink-0"},Lt={class:"text-left"},Vt={class:"text-lg font-bold text-amber-700 leading-none"},Ot={class:"flex items-center gap-2 px-3 py-2 rounded-xl bg-emerald-50 border border-emerald-100 min-w-[85px]"},Rt={class:"w-7 h-7 rounded-lg bg-emerald-100 flex items-center justify-center flex-shrink-0"},Nt={class:"text-left"},qt={class:"text-lg font-bold text-emerald-700 leading-none"},It={class:"flex items-center gap-2 px-3 py-2 rounded-xl bg-blue-50 border border-blue-100 min-w-[85px]"},Ut={class:"text-left"},Yt={class:"text-lg font-bold text-blue-700 leading-none"},Gt={key:0,class:"flex items-center gap-2 px-3 py-2 rounded-xl bg-gray-50 border border-gray-200 min-w-[85px]"},Wt={class:"text-left"},Zt={class:"text-lg font-bold text-gray-600 leading-none"},Jt={class:"flex items-center gap-3 flex-shrink-0"},Kt={class:"flex items-center gap-3 px-4 py-2 rounded-xl bg-gradient-to-r from-purple-500 to-violet-600 text-white shadow-lg shadow-purple-200 min-w-[140px]"},Qt={class:"text-left"},Xt={class:"text-2xl font-bold leading-none"},eo={class:"flex items-center gap-2 px-3 py-2 rounded-xl bg-green-50 border border-green-100 min-w-[100px]"},to={class:"text-left"},oo={class:"text-lg font-bold text-green-700 leading-none"},ao={key:0,class:"bg-white border border-gray-100 rounded-xl p-4 mb-4 overflow-hidden"},so={class:"flex items-center justify-between mb-4"},no={class:"flex items-center bg-gray-100 rounded-lg p-1"},ro=["onClick"],io={class:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6"},lo={class:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-4 border border-blue-100"},co={class:"flex items-center gap-2 mb-2"},uo={class:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center"},po={class:"text-2xl font-bold text-blue-900"},mo={class:"text-xs text-blue-600 mt-1"},go={class:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-4 border border-green-100"},xo={class:"text-2xl font-bold text-green-900"},fo={class:"text-xs text-green-600 mt-1"},ho={class:"bg-gradient-to-br from-amber-50 to-orange-50 rounded-xl p-4 border border-amber-100"},bo={class:"text-2xl font-bold text-amber-900"},vo={class:"text-xs text-amber-600 mt-1"},yo={class:"bg-gradient-to-br from-purple-50 to-violet-50 rounded-xl p-4 border border-purple-100"},wo={class:"text-2xl font-bold text-purple-900"},_o={class:"mt-4 bg-gradient-to-r from-cyan-50 to-teal-50 rounded-xl p-4 border border-cyan-100"},ko={class:"flex items-center justify-between"},Co={class:"text-right"},Do={class:"mt-3"},Mo={class:"h-3 bg-gray-200 rounded-full overflow-hidden"},zo={class:"flex justify-between mt-2 text-xs"},So={class:"text-gray-600"},Bo={class:"font-semibold text-cyan-700"},Fo={class:"text-gray-600"},jo={class:"font-semibold text-gray-700"},Eo={class:"text-gray-600"},Po={key:0,class:"mt-2 text-xs text-cyan-700 bg-cyan-100/50 rounded-lg p-2"},To={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},$o={class:"bg-gray-50 rounded-xl p-4"},Ao={class:"text-sm font-semibold text-gray-700 mb-3"},Ho={class:"h-48"},Lo={class:"bg-gray-50 rounded-xl p-4"},Vo={class:"text-sm font-semibold text-gray-700 mb-3"},Oo={class:"h-48"},Ro={class:"mt-6 grid grid-cols-1 lg:grid-cols-3 gap-6"},No={class:"bg-gray-50 rounded-xl p-4"},qo={class:"h-40"},Io={class:"bg-gray-50 rounded-xl p-4 lg:col-span-2"},Uo={class:"space-y-2"},Yo={class:"w-6 h-6 rounded-full bg-purple-100 text-purple-600 text-xs font-bold flex items-center justify-center"},Go={class:"flex-1 min-w-0"},Wo={class:"text-sm font-medium text-gray-900 truncate"},Zo={class:"flex items-center gap-3"},Jo={class:"text-sm text-gray-500"},Ko={class:"text-sm font-semibold text-gray-900"},Qo={key:0,class:"text-sm text-gray-400 text-center py-4"},Xo={class:"space-y-3"},ea={class:"flex flex-wrap items-center gap-3"},ta={class:"relative flex-1 min-w-[200px] max-w-md"},oa={class:"flex items-center bg-gray-100 rounded-lg p-1"},aa=["onClick"],sa={class:"flex items-center bg-gray-100 rounded-lg p-1"},na={key:0,class:"flex items-center justify-center py-20"},ra={key:1,class:"bg-red-50 border border-red-100 rounded-lg p-4 flex items-start gap-3"},ia={class:"text-sm text-red-600"},la={key:2},da={key:0,class:"flex flex-col items-center justify-center py-20 text-center"},ca={class:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4"},ua={class:"text-lg font-medium text-gray-900 mb-1"},pa={class:"text-sm text-gray-500 mb-4 max-w-sm"},ma={key:1,class:"space-y-4"},ga={class:"text-xs text-gray-400 ml-auto"},xa={class:"divide-y divide-gray-50"},fa=["onClick"],ha={class:"text-sm font-bold text-gray-900"},ba={key:0,class:"text-[10px] text-gray-400"},va=["onClick","title"],ya={class:"min-w-0 flex items-center gap-2"},wa=["onClick"],_a={key:0,class:"text-violet-500 flex-shrink-0",title:"Online"},ka={key:1,class:"text-gray-400 flex-shrink-0",title:"Presencial"},Ca={key:2,class:"flex items-center gap-0.5 text-amber-600 flex-shrink-0",title:"Pago pendiente"},Da={class:"flex-shrink-0"},Ma={key:0,class:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20"},za={key:1,class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Sa={key:2,class:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20"},Ba={key:3,class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Fa={key:0,class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ja={key:1,class:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20"},Ea={key:2,class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Pa={key:3,class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ta={key:0,class:"w-20 flex-shrink-0 text-center"},$a={key:0,class:"text-xs"},Aa={class:"flex items-center justify-center gap-1"},Ha={class:"font-medium text-gray-700"},La={key:0,class:"w-4 h-4 rounded-full bg-green-100 text-green-600 flex items-center justify-center",title:"Bono pagado"},Va={key:1,class:"w-4 h-4 rounded-full bg-amber-100 text-amber-600 flex items-center justify-center",title:"Pago pendiente"},Oa={key:1,class:"text-xs text-gray-300"},Ra={key:1,class:"w-20 flex-shrink-0 text-right"},Na={class:"text-sm font-semibold text-gray-900"},qa={key:2,class:"w-14 flex-shrink-0 text-right"},Ia={class:"text-xs font-semibold text-gray-700"},Ua={class:"flex items-center gap-1 flex-shrink-0"},Ya=["onClick","disabled"],Ga={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Wa={key:1,class:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24"},Za={class:"relative menu-contextual"},Ja=["onClick"],Ka={key:0,class:"absolute right-0 top-full mt-1 w-48 bg-white rounded-lg shadow-lg border border-gray-100 py-1 z-50"},Qa=["onClick"],Xa=["onClick"],es=["onClick","disabled"],ts=["onClick","disabled"],os={key:2,class:"border-t border-gray-100 my-1"},as=["onClick","disabled"],ss={key:2,class:"space-y-6"},ns={class:"flex items-center gap-3 mb-4 sticky top-0 bg-gray-50/95 backdrop-blur-sm py-2 z-10"},rs={class:"text-lg font-bold leading-none"},is={class:"text-[10px] uppercase"},ls={class:"font-semibold text-gray-900"},ds={class:"text-sm text-gray-500"},cs={class:"space-y-3 ml-6 pl-6 border-l-2 border-gray-200"},us=["onClick"],ps={class:"text-center flex-shrink-0"},ms={class:"text-lg font-bold text-gray-900"},gs={class:"text-xs text-gray-400"},xs={class:"flex-1 min-w-0"},fs={class:"flex items-center gap-2"},hs=["onClick"],bs={key:0,class:"text-violet-500",title:"Online"},vs={class:"flex items-center gap-2 mt-1"},ys={key:0,class:"text-xs text-gray-500"},ws={class:"flex items-center gap-2 flex-shrink-0"},_s={class:"font-semibold text-gray-900"},ks=["onClick","disabled"],Cs={key:3,class:"mt-6"},Ds={class:"flex items-center gap-3"},Ms={class:"w-8 h-8 bg-green-600 rounded-lg flex items-center justify-center"},zs={class:"text-sm text-green-600 ml-2"},Ss={class:"mt-2 bg-white border border-gray-100 rounded-lg overflow-hidden"},Bs={class:"divide-y divide-gray-50"},Fs={class:"w-8 h-8 rounded-full bg-green-100 text-green-600 flex items-center justify-center text-xs font-semibold"},js={class:"flex-1 min-w-0"},Es={class:"text-sm font-medium text-gray-900 truncate"},Ps={class:"text-xs text-gray-500"},Ts={class:"text-right"},$s={class:"text-sm font-semibold text-green-600"},As={class:"text-xs text-gray-500"},z=50,nn=Ye({__name:"index",setup(Hs){it.register(lt,dt,ct,ut,pt,mt,gt,xt,ft,ht);const De=Ge(),E=We(),H=Ze(),X=C(!0),R=C(null),S=C([]),ee=C([]),ue=C({}),N=C(!1),te=C(!1),oe=C(null),g=C({busqueda:"",estado:"",periodo:"todos",modalidad:"",porCobrar:!1}),Me=[{valor:"hoy",label:"Hoy"},{valor:"semana",label:"Semana"},{valor:"mes",label:"Mes"},{valor:"todos",label:"Todos"}],j=C(null),w=C(null),b=C("detallada"),q=C(!1),L=C(!1),B=C("semana"),ze=[{valor:"semana",label:"Semana"},{valor:"mes",label:"Mes"},{valor:"trimestre",label:"Trimestre"}],I=M(()=>g.value.busqueda!==""||g.value.estado!==""||g.value.periodo!=="todos"||g.value.modalidad!==""||g.value.porCobrar),P=M(()=>{let s=[...S.value];if(g.value.busqueda){const o=g.value.busqueda.toLowerCase();s=s.filter(r=>r.paciente?.nombre_completo?.toLowerCase().includes(o))}g.value.estado&&(s=s.filter(o=>o.estado===g.value.estado)),g.value.modalidad&&(s=s.filter(o=>o.modalidad===g.value.modalidad)),g.value.porCobrar&&(s=s.filter(o=>{const r=o.estado==="realizada"||o.estado==="completada",i=o.bono&&!o.bono.pagado,u=!o.esta_pagado;return r&&(i||u)}));const t=new Date,a=new Date(t.getFullYear(),t.getMonth(),t.getDate());if(g.value.periodo==="hoy")s=s.filter(o=>new Date(o.fecha_cita).toDateString()===a.toDateString());else if(g.value.periodo==="semana"){const o=new Date(a);o.setDate(a.getDate()-a.getDay()+1);const r=new Date(o);r.setDate(o.getDate()+6),s=s.filter(i=>{const u=new Date(i.fecha_cita);return u>=o&&u<=r})}else if(g.value.periodo==="mes"){const o=new Date(t.getFullYear(),t.getMonth(),1),r=new Date(t.getFullYear(),t.getMonth()+1,0);s=s.filter(i=>{const u=new Date(i.fecha_cita);return u>=o&&u<=r})}return s.sort((o,r)=>{const i=new Date(o.fecha_cita+"T"+o.hora_inicio);return new Date(r.fecha_cita+"T"+r.hora_inicio).getTime()-i.getTime()}),s}),T=M(()=>{const s={pendientes:0,confirmadas:0,completadas:0,canceladas:0,montoPendiente:0,montoConfirmado:0,montoCompletado:0,montoCancelado:0};return P.value.forEach(t=>{const a=t.monto_terapeuta||(t.precio_estimado||z)*.7;switch(t.estado){case"pendiente":s.pendientes++,t.esta_pagado||t.bono?.pagado?s.montoConfirmado+=a:s.montoPendiente+=a;break;case"confirmada":s.confirmadas++,t.esta_pagado||t.bono?.pagado?s.montoConfirmado+=a:s.montoPendiente+=a;break;case"realizada":case"completada":s.completadas++,t.esta_pagado||t.bono?.pagado?s.montoConfirmado+=a:s.montoCompletado+=a;break;case"cancelada":s.canceladas++,s.montoCancelado+=a;break}}),s}),Se=M(()=>T.value.montoCompletado+T.value.montoPendiente),U=M(()=>ee.value.map(s=>{const t=(s.sesiones_totales||0)-(s.sesiones_restantes||0),a=s.monto_total*.7;return{bono_id:s.id,paciente_nombre:s.paciente_nombre,bono_sesiones_totales:s.sesiones_totales,bono_monto_total:s.monto_total,bono_fecha_pago:s.fecha_pago,tipo_bono:s.tipo_bono||"EstÃ¡ndar",sesiones_usadas:t,monto_total_terapeuta:a}}).sort((s,t)=>{const a=new Date(s.bono_fecha_pago||0);return new Date(t.bono_fecha_pago||0).getTime()-a.getTime()})),Be=M(()=>U.value.reduce((s,t)=>s+(t.monto_total_terapeuta||0),0)),pe=M(()=>S.value.filter(s=>{const t=s.estado==="realizada"||s.estado==="completada",a=s.bono&&!s.bono.pagado,o=!s.esta_pagado;return t&&(a||o)}).length),V=M(()=>{const s=new Date,t=new Date(s.getFullYear(),s.getMonth(),s.getDate());let a,o;return B.value==="semana"?(a=new Date(t),a.setDate(t.getDate()-7),o=t):B.value==="mes"?(a=new Date(t),a.setMonth(t.getMonth()-1),o=t):(a=new Date(t),a.setMonth(t.getMonth()-3),o=t),S.value.filter(r=>{const i=new Date(r.fecha_cita);return i>=a&&i<=o})}),Fe=(s,t)=>{const a=ue.value;if(!a||Object.keys(a).length===0){const u=Math.ceil((t.getTime()-s.getTime())/864e5);return Math.round(u*5/7*8)}const o=["domingo","lunes","martes","miercoles","jueves","viernes","sabado"];let r=0;const i=new Date(s);for(;i<=t;){const u=o[i.getDay()];(a[u]||[]).forEach(p=>{const[k,Z]=p.split("-");if(k&&Z){const[re,ie]=k.split(":").map(Number),[le,y]=Z.split(":").map(Number),O=le*60+y-(re*60+ie);r+=O/60}}),i.setDate(i.getDate()+1)}return Math.round(r)},h=M(()=>{const s=V.value,t=s.filter(y=>y.estado==="realizada"||y.estado==="completada"||y.estado==="confirmada").length,a=s.filter(y=>y.estado==="cancelada").length,o=s.filter(y=>y.estado==="realizada"||y.estado==="completada").reduce((y,O)=>y+(O.precio_estimado||z),0),r=t+a>0?Math.round(a/(t+a)*100):0,i=t>0?o/t:0,u=new Date;let m;B.value==="semana"?(m=new Date(u),m.setDate(u.getDate()-7)):B.value==="mes"?(m=new Date(u),m.setMonth(u.getMonth()-1)):(m=new Date(u),m.setMonth(u.getMonth()-3));const p=s.filter(y=>y.estado!=="cancelada"&&y.estado!=="pendiente").reduce((y,O)=>y+(O.duracion_minutos||60)/60,0),k=Fe(m,u),Z=k>0?Math.min(100,Math.round(p/k*100)):0,re=Math.max(0,Math.round(k-p)),ie=Math.round((Math.random()-.3)*20),le=Math.round((Math.random()-.3)*25);return{totalSesiones:t,totalCanceladas:a,facturacionTotal:o,tasaCancelacion:r,promedioSesion:i,tendenciaSesiones:ie,tendenciaFacturacion:le,tasaOcupacion:Z,horasOcupadas:Math.round(p),horasDisponibles:k,horasLibres:re}}),me=M(()=>{const s=V.value,t=[],a=[],o=new Date;if(B.value==="semana")for(let r=6;r>=0;r--){const i=new Date(o);i.setDate(o.getDate()-r);const u=i.toISOString().split("T")[0];t.push(i.toLocaleDateString("es-ES",{weekday:"short"})),a.push(s.filter(m=>m.fecha_cita===u&&(m.estado==="realizada"||m.estado==="completada"||m.estado==="confirmada")).length)}else for(let r=3;r>=0;r--){const i=new Date(o);i.setDate(o.getDate()-(r+1)*7);const u=new Date(o);u.setDate(o.getDate()-r*7),t.push(`Sem ${4-r}`),a.push(s.filter(m=>{const p=new Date(m.fecha_cita);return p>=i&&p<u&&(m.estado==="realizada"||m.estado==="completada"||m.estado==="confirmada")}).length)}return{labels:t,datasets:[{label:"Sesiones",data:a,backgroundColor:"#8B5CF6",borderRadius:6,barThickness:24}]}}),ge=M(()=>{const s=V.value,t=[],a=[],o=new Date;if(B.value==="semana")for(let r=6;r>=0;r--){const i=new Date(o);i.setDate(o.getDate()-r);const u=i.toISOString().split("T")[0];t.push(i.toLocaleDateString("es-ES",{weekday:"short"}));const m=s.filter(p=>p.fecha_cita===u&&(p.estado==="realizada"||p.estado==="completada")).reduce((p,k)=>p+(k.precio_estimado||z),0);a.push(m)}else for(let r=3;r>=0;r--){const i=new Date(o);i.setDate(o.getDate()-(r+1)*7);const u=new Date(o);u.setDate(o.getDate()-r*7),t.push(`Sem ${4-r}`);const m=s.filter(p=>{const k=new Date(p.fecha_cita);return k>=i&&k<u&&(p.estado==="realizada"||p.estado==="completada")}).reduce((p,k)=>p+(k.precio_estimado||z),0);a.push(m)}return{labels:t,datasets:[{label:"FacturaciÃ³n (â‚¬)",data:a,borderColor:"#10B981",backgroundColor:"rgba(16, 185, 129, 0.1)",fill:!0,tension:.4,pointBackgroundColor:"#10B981",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:4}]}}),xe=M(()=>{const s=V.value,t=s.filter(i=>i.estado==="pendiente").length,a=s.filter(i=>i.estado==="confirmada").length,o=s.filter(i=>i.estado==="realizada"||i.estado==="completada").length,r=s.filter(i=>i.estado==="cancelada").length;return{labels:["Pendientes","Confirmadas","Realizadas","Canceladas"],datasets:[{data:[t,a,o,r],backgroundColor:["#F59E0B","#10B981","#3B82F6","#9CA3AF"],borderWidth:0,cutout:"70%"}]}}),je={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"#1F2937",titleColor:"#F9FAFB",bodyColor:"#F9FAFB",borderRadius:8,padding:10}},scales:{x:{grid:{display:!1},ticks:{font:{size:11}}},y:{beginAtZero:!0,grid:{color:"#F3F4F6"},ticks:{stepSize:1,font:{size:11}}}}},Ee={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"#1F2937",titleColor:"#F9FAFB",bodyColor:"#F9FAFB",borderRadius:8,padding:10,callbacks:{label:s=>`${s.parsed.y.toFixed(2)}â‚¬`}}},scales:{x:{grid:{display:!1},ticks:{font:{size:11}}},y:{beginAtZero:!0,grid:{color:"#F3F4F6"},ticks:{font:{size:11},callback:s=>`${s}â‚¬`}}}},Pe={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{usePointStyle:!0,padding:12,font:{size:11}}}}},fe=M(()=>{const s=V.value.filter(a=>a.estado==="realizada"||a.estado==="completada"),t={};return s.forEach(a=>{const o=a.paciente?.id||"desconocido",r=a.paciente?.nombre_completo||"Sin nombre";t[o]||(t[o]={id:o,nombre:r,sesiones:0,facturado:0}),t[o].sesiones++,t[o].facturado+=a.precio_estimado||z}),Object.values(t).sort((a,o)=>o.sesiones-a.sesiones).slice(0,5)}),Te=s=>{const t=new Date;return(new Date(`${s.fecha_cita}T${s.hora_inicio||"00:00"}`).getTime()-t.getTime())/(1e3*60*60)},_=s=>{if(s.estado==="cancelada"||s.estado==="realizada"||s.estado==="completada")return null;const t=Te(s);return t<0?null:t<=2?{tipo:"inminente",clase:"bg-teal-100 text-teal-700 border-teal-200 ring-2 ring-teal-300/50",icono:"bolt",texto:"Ahora"}:t<=24?{tipo:"proxima",clase:"bg-green-100 text-green-700 border-green-200",icono:"arrow-right",texto:"Hoy"}:t<=48&&s.estado==="pendiente"?{tipo:"atencion",clase:"bg-orange-100 text-orange-700 border-orange-200 animate-pulse",icono:"exclamation",texto:"Confirmar"}:t<=72?{tipo:"pronto",clase:"bg-amber-50 text-amber-700 border-amber-200",icono:"clock",texto:`${Math.ceil(t/24)}d`}:null},he=M(()=>{const s=[],t=[...P.value];t.sort((i,u)=>{const m=new Date(`${i.fecha_cita}T${i.hora_inicio||"00:00"}`);return new Date(`${u.fecha_cita}T${u.hora_inicio||"00:00"}`).getTime()-m.getTime()});const a=new Date;a.setHours(0,0,0,0);const o=new Date(a);o.setDate(o.getDate()+1);let r="";return t.forEach(i=>{if(i.fecha_cita!==r){r=i.fecha_cita;const u=new Date(i.fecha_cita+"T00:00:00"),m=u.toDateString()===a.toDateString(),p=u.toDateString()===o.toDateString();s.push({fecha:i.fecha_cita,fechaFormateada:$e(i.fecha_cita),esHoy:m,esMaÃ±ana:p,sesiones:[]})}s[s.length-1].sesiones.push(i)}),s}),$e=s=>{if(!s)return"";const t=new Date(s+"T00:00:00"),a=new Date;a.setHours(0,0,0,0);const o=new Date(a);o.setDate(o.getDate()+1);const r=new Date(a);return r.setDate(r.getDate()-1),t.toDateString()===a.toDateString()?"Hoy":t.toDateString()===o.toDateString()?"MaÃ±ana":t.toDateString()===r.toDateString()?"Ayer":t.toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long"})},be=()=>{g.value={busqueda:"",estado:"",periodo:"todos",modalidad:"",porCobrar:!1}},ve=()=>{De.push("/terapeuta/agenda")},ae=async()=>{try{X.value=!0,R.value=null;let s=0;for(;!H.value&&s<50;)await new Promise(i=>setTimeout(i,100)),s++;if(!H.value)throw new Error("Usuario no autenticado");const{data:t,error:a}=await E.from("terapeutas").select("id, disponibilidad").eq("email",H.value.email).single();if(a)throw a;if(!t)throw new Error("No se encontrÃ³ el terapeuta");t.disponibilidad&&typeof t.disponibilidad=="object"&&(ue.value=t.disponibilidad);const{data:o,error:r}=await E.from("vista_agenda_terapeutas").select("*").eq("terapeuta_id",t.id).order("fecha_cita",{ascending:!1});if(r)throw r;S.value=(o||[]).map(i=>({id:i.cita_id,fecha_cita:i.fecha_cita,hora_inicio:i.hora_inicio,hora_fin:i.hora_fin,duracion_minutos:i.duracion_minutos,modalidad:i.modalidad,estado:i.estado,observaciones:i.observaciones,notas_terapeuta:i.notas_terapeuta,precio_estimado:i.cita_metadata?.precio_sesion||z,esta_pagado:i.cita_metadata?.metodo_pago==="bono"||i.bono_estado==="activo",paciente:{id:i.paciente_id,nombre_completo:i.paciente_nombre,email:i.paciente_email},bono:i.bono_id?{id:i.bono_id,sesiones_totales:i.bono_sesiones_totales,sesiones_restantes:i.bono_sesiones_restantes,pagado:i.bono_estado==="activo"||i.bono_estado==="pagado"}:null}))}catch(s){R.value=s.message||"Error desconocido"}finally{X.value=!1}},Ae=async()=>{try{if(!H.value)return;const{data:s}=await E.from("terapeutas").select("id").eq("email",H.value.email).single();if(!s)return;const{data:t}=await E.from("pacientes").select("id").eq("terapeuta_id",s.id);if(!t||t.length===0){ee.value=[];return}const{data:a}=await E.from("bonos").select(`
        id,
        paciente_id,
        sesiones_totales,
        sesiones_restantes,
        monto_total,
        tipo_bono,
        fecha_pago,
        pagado,
        paciente:pacientes!bonos_paciente_id_fkey (
          nombre_completo
        )
      `).eq("pagado",!0).in("paciente_id",t.map(o=>o.id)).order("fecha_pago",{ascending:!1});ee.value=(a||[]).map(o=>({...o,paciente_nombre:o.paciente?.nombre_completo}))}catch(s){console.error("Error cargando bonos:",s)}},se=s=>{oe.value=s.id,te.value=!0},He=()=>{te.value=!1,oe.value=null},ne=async(s,t)=>{if(t?.stopPropagation(),w.value!==s.id)try{w.value=s.id;const{error:a}=await E.from("citas").update({estado:"confirmada"}).eq("id",s.id);if(a)throw a;const o=S.value.findIndex(r=>r.id===s.id);o!==-1&&(S.value[o].estado="confirmada")}catch(a){console.error("Error confirmando sesiÃ³n:",a),alert("Error al confirmar la sesiÃ³n")}finally{w.value=null,j.value=null}},Le=async(s,t)=>{if(t?.stopPropagation(),w.value!==s.id)try{w.value=s.id;const{error:a}=await E.from("citas").update({estado:"realizada"}).eq("id",s.id);if(a)throw a;const o=S.value.findIndex(r=>r.id===s.id);o!==-1&&(S.value[o].estado="realizada")}catch(a){console.error("Error marcando sesiÃ³n como realizada:",a),alert("Error al marcar la sesiÃ³n como realizada")}finally{w.value=null,j.value=null}},Ve=async(s,t)=>{if(t?.stopPropagation(),w.value!==s.id&&confirm("Â¿EstÃ¡s seguro de que quieres cancelar esta sesiÃ³n?"))try{w.value=s.id;const{error:a}=await E.from("citas").update({estado:"cancelada"}).eq("id",s.id);if(a)throw a;const o=S.value.findIndex(r=>r.id===s.id);o!==-1&&(S.value[o].estado="cancelada")}catch(a){console.error("Error cancelando sesiÃ³n:",a),alert("Error al cancelar la sesiÃ³n")}finally{w.value=null,j.value=null}},Y=(s,t)=>{t?.stopPropagation(),t?.preventDefault();const a=s.paciente?.id||s.paciente_id;a?(console.log("[Sesiones] Navegando a ficha de paciente:",a),ot(`/terapeuta/pacientes/${a}`)):console.warn("[Sesiones] No se encontrÃ³ ID del paciente",s)},Oe=(s,t)=>{t.stopPropagation(),j.value=j.value===s?null:s},Re=()=>{j.value=null},ye=s=>{j.value&&!s.target.closest(".menu-contextual")&&(j.value=null)};Je(()=>{document.addEventListener("click",ye),ae(),Ae()}),Ke(()=>{document.removeEventListener("click",ye)});const F=s=>s?.toFixed(2)||"0.00",Ne=s=>s?new Date(s).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",qe=s=>{if(!s)return"-";const t=new Date(s+"T00:00:00"),a=new Date,o=new Date(a);return o.setDate(a.getDate()-1),t.toDateString()===a.toDateString()?"Hoy":t.toDateString()===o.toDateString()?"Ayer":t.toLocaleDateString("es-ES",{day:"numeric",month:"short"})},G=s=>s?.substring(0,5)||"-",we=s=>s?.split(" ").map(t=>t[0]).join("").toUpperCase().substring(0,2)||"??",W=s=>({pendiente:"Pendiente",confirmada:"Confirmada",realizada:"Realizada",completada:"Realizada",cancelada:"Cancelada"})[s]||s,_e=s=>({pendiente:"bg-amber-50 text-amber-700 border-amber-200",confirmada:"bg-emerald-50 text-emerald-700 border-emerald-200",realizada:"bg-blue-50 text-blue-700 border-blue-200",completada:"bg-blue-50 text-blue-700 border-blue-200",cancelada:"bg-gray-100 text-gray-500 border-gray-200"})[s]||"bg-gray-50 text-gray-600 border-gray-200",Ie=()=>{L.value=!1;const s=P.value;if(s.length===0){alert("No hay sesiones para exportar");return}const t=["Fecha","Hora Inicio","Hora Fin","Paciente","Estado","Modalidad","Precio (â‚¬)","Pagado","Observaciones"],a=s.map(p=>[p.fecha_cita,p.hora_inicio,p.hora_fin,p.paciente?.nombre_completo||"Sin nombre",W(p.estado),p.modalidad==="online"?"Online":"Presencial",(p.precio_estimado||z).toFixed(2),p.esta_pagado||p.bono?.pagado?"SÃ­":"No",(p.observaciones||"").replace(/"/g,'""')]),r="\uFEFF"+[t.join(";"),...a.map(p=>p.map(k=>`"${k}"`).join(";"))].join(`
`),i=new Blob([r],{type:"text/csv;charset=utf-8"}),u=URL.createObjectURL(i),m=document.createElement("a");m.href=u,m.download=`sesiones_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(u)},Ue=()=>{L.value=!1;const s=P.value;if(s.length===0){alert("No hay sesiones para exportar");return}const t=s.length,a=s.filter(u=>u.estado==="realizada"||u.estado==="completada").reduce((u,m)=>u+(m.precio_estimado||z),0),o=s.filter(u=>(u.estado==="realizada"||u.estado==="completada")&&!u.esta_pagado&&!u.bono?.pagado).length,r=`
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="UTF-8">
      <title>Informe de Sesiones</title>
      <style>
        body { font-family: Arial, sans-serif; font-size: 12px; padding: 20px; }
        h1 { color: #7C3AED; font-size: 24px; margin-bottom: 5px; }
        .fecha-informe { color: #6B7280; margin-bottom: 20px; }
        .resumen { background: #F3F4F6; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: flex; gap: 30px; }
        .resumen-item { text-align: center; }
        .resumen-valor { font-size: 24px; font-weight: bold; color: #1F2937; }
        .resumen-label { color: #6B7280; font-size: 11px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { background: #7C3AED; color: white; padding: 10px 8px; text-align: left; font-size: 11px; }
        td { padding: 8px; border-bottom: 1px solid #E5E7EB; font-size: 11px; }
        tr:nth-child(even) { background: #F9FAFB; }
        .estado { display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 500; }
        .estado-realizada { background: #DBEAFE; color: #1E40AF; }
        .estado-confirmada { background: #D1FAE5; color: #065F46; }
        .estado-pendiente { background: #FEF3C7; color: #92400E; }
        .estado-cancelada { background: #F3F4F6; color: #6B7280; }
        .precio { text-align: right; font-weight: 500; }
        @media print { body { padding: 0; } }
      </style>
    </head>
    <body>
      <h1>Informe de Sesiones</h1>
      <p class="fecha-informe">Generado el ${new Date().toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}</p>

      <div class="resumen">
        <div class="resumen-item">
          <div class="resumen-valor">${t}</div>
          <div class="resumen-label">Total Sesiones</div>
        </div>
        <div class="resumen-item">
          <div class="resumen-valor">${a.toFixed(2)}â‚¬</div>
          <div class="resumen-label">Facturado</div>
        </div>
        <div class="resumen-item">
          <div class="resumen-valor">${o}</div>
          <div class="resumen-label">Pendientes de Pago</div>
        </div>
      </div>

      <table>
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Hora</th>
            <th>Paciente</th>
            <th>Estado</th>
            <th>Modalidad</th>
            <th style="text-align: right">Precio</th>
          </tr>
        </thead>
        <tbody>
          ${s.map(u=>`
            <tr>
              <td>${qe(u.fecha_cita)}</td>
              <td>${u.hora_inicio?.substring(0,5)||"-"}</td>
              <td>${u.paciente?.nombre_completo||"Sin nombre"}</td>
              <td><span class="estado estado-${u.estado}">${W(u.estado)}</span></td>
              <td>${u.modalidad==="online"?"Online":"Presencial"}</td>
              <td class="precio">${(u.precio_estimado||z).toFixed(2)}â‚¬</td>
            </tr>
          `).join("")}
        </tbody>
      </table>
    </body>
    </html>
  `,i=window.open("","_blank");i&&(i.document.write(r),i.document.close(),i.focus(),setTimeout(()=>{i.print()},250))};return(s,t)=>(d(),c("div",null,[e("header",Ct,[e("div",Dt,[e("h1",Mt,[t[12]||(t[12]=v(" Sesiones ",-1)),e("span",zt,"("+l(n(P).length)+")",1)]),e("div",St,[e("button",{onClick:t[0]||(t[0]=a=>q.value=!n(q)),class:x(["h-10 px-3 text-sm font-medium rounded-lg transition-all flex items-center gap-2 border",n(q)?"bg-indigo-600 text-white border-indigo-600 shadow-md":"bg-white text-indigo-700 border-indigo-200 hover:bg-indigo-50"]),title:"Ver resumen y grÃ¡ficos"},[...t[13]||(t[13]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})],-1),e("span",{class:"hidden sm:inline"},"Resumen",-1)])],2),e("div",Bt,[e("button",{onClick:t[1]||(t[1]=a=>L.value=!n(L)),class:"h-10 px-3 bg-white text-gray-700 text-sm font-medium rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors flex items-center gap-2",title:"Exportar sesiones"},[...t[14]||(t[14]=[ke('<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg><span class="hidden sm:inline">Exportar</span><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>',3)])]),D(K,{"enter-active-class":"transition-all duration-150 ease-out","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition-all duration-100 ease-in","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:J(()=>[n(L)?(d(),c("div",Ft,[e("button",{onClick:Ie,class:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2"},[...t[15]||(t[15]=[e("svg",{class:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),v(" Exportar a Excel ",-1)])]),e("button",{onClick:Ue,class:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2"},[...t[16]||(t[16]=[e("svg",{class:"w-4 h-4 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})],-1),v(" Exportar a PDF ",-1)])]),t[17]||(t[17]=e("div",{class:"border-t border-gray-100 my-1"},null,-1)),e("p",jt,l(n(P).length)+" sesiones seleccionadas ",1)])):f("",!0)]),_:1})]),e("div",Et,[e("button",{onClick:t[2]||(t[2]=a=>b.value="compacta"),class:x(["p-1.5 rounded-md transition-all",n(b)==="compacta"?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"]),title:"Vista compacta"},[...t[18]||(t[18]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 10h16M4 14h16M4 18h16"})],-1)])],2),e("button",{onClick:t[3]||(t[3]=a=>b.value="detallada"),class:x(["p-1.5 rounded-md transition-all",n(b)==="detallada"?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"]),title:"Vista detallada"},[...t[19]||(t[19]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})],-1)])],2),e("button",{onClick:t[4]||(t[4]=a=>b.value="agenda"),class:x(["p-1.5 rounded-md transition-all",n(b)==="agenda"?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"]),title:"Vista de agenda"},[...t[20]||(t[20]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)])],2)]),e("button",{onClick:ve,class:"h-10 px-4 bg-purple-600 text-white text-sm font-medium rounded-lg hover:bg-purple-700 transition-colors flex items-center gap-2 shadow-sm"},[D(n(bt),{class:"w-4 h-4"}),t[21]||(t[21]=e("span",{class:"hidden sm:inline"},"Nueva SesiÃ³n",-1))])])]),e("div",Pt,[e("div",Tt,[e("div",$t,[t[28]||(t[28]=e("span",{class:"text-xs font-medium text-gray-400 uppercase tracking-wider mr-1"},"Sesiones",-1)),e("div",At,[e("div",Ht,[D(n(vt),{class:"w-4 h-4 text-amber-600"})]),e("div",Lt,[e("p",Vt,l(n(T).pendientes),1),t[22]||(t[22]=e("p",{class:"text-[10px] text-amber-600/70 font-medium"},"Pendientes",-1))])]),e("div",Ot,[e("div",Rt,[D(n(Ce),{class:"w-4 h-4 text-emerald-600"})]),e("div",Nt,[e("p",qt,l(n(T).confirmadas),1),t[23]||(t[23]=e("p",{class:"text-[10px] text-emerald-600/70 font-medium"},"Confirmadas",-1))])]),e("div",It,[t[25]||(t[25]=e("div",{class:"w-7 h-7 rounded-lg bg-blue-100 flex items-center justify-center flex-shrink-0"},[e("svg",{class:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",Ut,[e("p",Yt,l(n(T).completadas),1),t[24]||(t[24]=e("p",{class:"text-[10px] text-blue-600/70 font-medium"},"Realizadas",-1))])]),n(T).canceladas>0?(d(),c("div",Gt,[t[27]||(t[27]=e("div",{class:"w-7 h-7 rounded-lg bg-gray-100 flex items-center justify-center flex-shrink-0"},[e("svg",{class:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",Wt,[e("p",Zt,l(n(T).canceladas),1),t[26]||(t[26]=e("p",{class:"text-[10px] text-gray-500 font-medium"},"Canceladas",-1))])])):f("",!0)]),t[34]||(t[34]=e("div",{class:"w-px bg-gray-200 self-stretch flex-shrink-0"},null,-1)),e("div",Jt,[t[33]||(t[33]=e("span",{class:"text-xs font-medium text-gray-400 uppercase tracking-wider mr-1"},"Finanzas",-1)),e("div",Kt,[t[30]||(t[30]=e("div",{class:"w-9 h-9 rounded-xl bg-white/20 flex items-center justify-center flex-shrink-0"},[e("svg",{class:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",Qt,[e("p",Xt,l(F(n(Se)))+"â‚¬",1),t[29]||(t[29]=e("p",{class:"text-[10px] text-white/80 font-medium mt-0.5"},"Por cobrar",-1))])]),e("div",eo,[t[32]||(t[32]=e("div",{class:"w-7 h-7 rounded-lg bg-green-100 flex items-center justify-center flex-shrink-0"},[e("svg",{class:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})])],-1)),e("div",to,[e("p",oo,l(F(n(T).montoConfirmado))+"â‚¬",1),t[31]||(t[31]=e("p",{class:"text-[10px] text-green-600/70 font-medium"},"Cobrado",-1))])])])])]),D(K,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 max-h-0","enter-to-class":"opacity-100 max-h-[800px]","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 max-h-[800px]","leave-to-class":"opacity-0 max-h-0"},{default:J(()=>[n(q)?(d(),c("div",ao,[e("div",so,[t[35]||(t[35]=e("h3",{class:"text-lg font-semibold text-gray-900 flex items-center gap-2"},[e("svg",{class:"w-5 h-5 text-indigo-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})]),v(" Resumen y Tendencias ")],-1)),e("div",no,[(d(),c($,null,A(ze,a=>e("button",{key:a.valor,onClick:o=>B.value=a.valor,class:x(["px-3 py-1.5 text-sm font-medium rounded-md transition-all",n(B)===a.valor?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"])},l(a.label),11,ro)),64))])]),e("div",io,[e("div",lo,[e("div",co,[e("div",uo,[D(n(ce),{class:"w-4 h-4 text-blue-600"})]),t[36]||(t[36]=e("span",{class:"text-xs font-medium text-blue-600 uppercase"},"Total Sesiones",-1))]),e("p",po,l(n(h).totalSesiones),1),e("p",mo,[e("span",{class:x(n(h).tendenciaSesiones>=0?"text-green-600":"text-red-600")},l(n(h).tendenciaSesiones>=0?"+":"")+l(n(h).tendenciaSesiones)+"% ",3),t[37]||(t[37]=v(" vs perÃ­odo anterior ",-1))])]),e("div",go,[t[39]||(t[39]=e("div",{class:"flex items-center gap-2 mb-2"},[e("div",{class:"w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])]),e("span",{class:"text-xs font-medium text-green-600 uppercase"},"FacturaciÃ³n")],-1)),e("p",xo,l(F(n(h).facturacionTotal))+"â‚¬",1),e("p",fo,[e("span",{class:x(n(h).tendenciaFacturacion>=0?"text-green-600":"text-red-600")},l(n(h).tendenciaFacturacion>=0?"+":"")+l(n(h).tendenciaFacturacion)+"% ",3),t[38]||(t[38]=v(" vs perÃ­odo anterior ",-1))])]),e("div",ho,[t[40]||(t[40]=e("div",{class:"flex items-center gap-2 mb-2"},[e("div",{class:"w-8 h-8 bg-amber-100 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-4 h-4 text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])]),e("span",{class:"text-xs font-medium text-amber-600 uppercase"},"Tasa CancelaciÃ³n")],-1)),e("p",bo,l(n(h).tasaCancelacion)+"%",1),e("p",vo,l(n(h).totalCanceladas)+" de "+l(n(h).totalSesiones+n(h).totalCanceladas),1)]),e("div",yo,[t[41]||(t[41]=e("div",{class:"flex items-center gap-2 mb-2"},[e("div",{class:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-4 h-4 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})])]),e("span",{class:"text-xs font-medium text-purple-600 uppercase"},"Promedio/SesiÃ³n")],-1)),e("p",wo,l(F(n(h).promedioSesion))+"â‚¬",1),t[42]||(t[42]=e("p",{class:"text-xs text-purple-600 mt-1"},"Media de todas las sesiones",-1))])]),e("div",_o,[e("div",ko,[t[43]||(t[43]=e("div",{class:"flex items-center gap-3"},[e("div",{class:"w-10 h-10 bg-cyan-100 rounded-xl flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-cyan-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})])]),e("div",null,[e("h4",{class:"text-sm font-semibold text-gray-800"},"Tasa de OcupaciÃ³n"),e("p",{class:"text-xs text-gray-500"},"Horas ocupadas vs disponibles en el perÃ­odo")])],-1)),e("div",Co,[e("p",{class:x(["text-3xl font-bold",n(h).tasaOcupacion>=70?"text-green-600":n(h).tasaOcupacion>=40?"text-amber-600":"text-red-500"])},l(n(h).tasaOcupacion)+"% ",3)])]),e("div",Do,[e("div",Mo,[e("div",{class:x(["h-full rounded-full transition-all duration-500",n(h).tasaOcupacion>=70?"bg-gradient-to-r from-green-400 to-emerald-500":n(h).tasaOcupacion>=40?"bg-gradient-to-r from-amber-400 to-orange-500":"bg-gradient-to-r from-red-400 to-rose-500"]),style:et({width:n(h).tasaOcupacion+"%"})},null,6)]),e("div",zo,[e("span",So,[e("span",Bo,l(n(h).horasOcupadas)+"h",1),t[44]||(t[44]=v(" ocupadas ",-1))]),e("span",Fo,[e("span",jo,l(n(h).horasDisponibles)+"h",1),t[45]||(t[45]=v(" disponibles ",-1))]),e("span",Eo,[e("span",{class:x(["font-semibold",n(h).horasLibres>10?"text-green-600":"text-amber-600"])},l(n(h).horasLibres)+"h",3),t[46]||(t[46]=v(" libres ",-1))])])]),n(h).horasLibres>5?(d(),c("p",Po," ðŸ’¡ Tienes margen para "+l(Math.floor(n(h).horasLibres))+" horas mÃ¡s de sesiones. Â¡Oportunidad de crecimiento! ",1)):f("",!0)]),e("div",To,[e("div",$o,[e("h4",Ao,"Sesiones por "+l(n(B)==="semana"?"dÃ­a":"semana"),1),e("div",Ho,[n(me)?(d(),Q(n(st),{key:0,data:n(me),options:je},null,8,["data"])):f("",!0)])]),e("div",Lo,[e("h4",Vo,"FacturaciÃ³n por "+l(n(B)==="semana"?"dÃ­a":"semana"),1),e("div",Oo,[n(ge)?(d(),Q(n(nt),{key:0,data:n(ge),options:Ee},null,8,["data"])):f("",!0)])])]),e("div",Ro,[e("div",No,[t[47]||(t[47]=e("h4",{class:"text-sm font-semibold text-gray-700 mb-3"},"DistribuciÃ³n por Estado",-1)),e("div",qo,[n(xe)?(d(),Q(n(rt),{key:0,data:n(xe),options:Pe},null,8,["data"])):f("",!0)])]),e("div",Io,[t[48]||(t[48]=e("h4",{class:"text-sm font-semibold text-gray-700 mb-3"},"Pacientes con mÃ¡s sesiones",-1)),e("div",Uo,[(d(!0),c($,null,A(n(fe),(a,o)=>(d(),c("div",{key:a.id,class:"flex items-center gap-3"},[e("span",Yo,l(o+1),1),e("div",Go,[e("p",Wo,l(a.nombre),1)]),e("div",Zo,[e("span",Jo,l(a.sesiones)+" sesiones",1),e("span",Ko,l(F(a.facturado))+"â‚¬",1)])]))),128)),n(fe).length===0?(d(),c("p",Qo," No hay datos suficientes ")):f("",!0)])])])])):f("",!0)]),_:1}),e("div",Xo,[e("div",ea,[e("div",ta,[de(e("input",{"onUpdate:modelValue":t[5]||(t[5]=a=>n(g).busqueda=a),type:"text",placeholder:"Buscar por paciente...",class:"w-full h-10 px-4 pl-9 bg-white border border-gray-200 rounded-lg text-sm focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition-all"},null,512),[[Qe,n(g).busqueda]]),D(n(yt),{class:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"})]),e("div",oa,[(d(),c($,null,A(Me,a=>e("button",{key:a.valor,onClick:o=>n(g).periodo=a.valor,class:x(["px-3 py-1.5 text-sm font-medium rounded-md transition-all",n(g).periodo===a.valor?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"])},l(a.label),11,aa)),64))]),de(e("select",{"onUpdate:modelValue":t[6]||(t[6]=a=>n(g).estado=a),class:"h-10 px-3 bg-white border border-gray-200 rounded-lg text-sm text-gray-700 focus:border-purple-500 focus:ring-1 focus:ring-purple-500/20"},[...t[49]||(t[49]=[ke('<option value="">Todos los estados</option><option value="pendiente">Pendientes</option><option value="confirmada">Confirmadas</option><option value="realizada">Realizadas</option><option value="cancelada">Canceladas</option>',5)])],512),[[Xe,n(g).estado]]),e("div",sa,[e("button",{onClick:t[7]||(t[7]=a=>n(g).modalidad=""),class:x(["px-2.5 py-1.5 text-sm font-medium rounded-md transition-all flex items-center gap-1",n(g).modalidad===""?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"])}," Todas ",2),e("button",{onClick:t[8]||(t[8]=a=>n(g).modalidad="presencial"),class:x(["px-2.5 py-1.5 text-sm font-medium rounded-md transition-all flex items-center gap-1",n(g).modalidad==="presencial"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"])},[...t[50]||(t[50]=[e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})],-1),v(" Presencial ",-1)])],2),e("button",{onClick:t[9]||(t[9]=a=>n(g).modalidad="online"),class:x(["px-2.5 py-1.5 text-sm font-medium rounded-md transition-all flex items-center gap-1",n(g).modalidad==="online"?"bg-white text-violet-700 shadow-sm":"text-gray-600 hover:text-gray-900"])},[...t[51]||(t[51]=[e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1),v(" Online ",-1)])],2)]),e("button",{onClick:t[10]||(t[10]=a=>n(g).porCobrar=!n(g).porCobrar),class:x(["h-10 px-3 text-sm font-medium rounded-lg transition-all flex items-center gap-2 border",n(g).porCobrar?"bg-purple-600 text-white border-purple-600 shadow-md shadow-purple-200":"bg-white text-purple-700 border-purple-200 hover:bg-purple-50"])},[t[52]||(t[52]=e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),t[53]||(t[53]=v(" Por cobrar ",-1)),n(pe)>0?(d(),c("span",{key:0,class:x(["px-1.5 py-0.5 text-xs font-bold rounded-full",n(g).porCobrar?"bg-white/20 text-white":"bg-purple-100 text-purple-700"])},l(n(pe)),3)):f("",!0)],2),n(I)?(d(),c("button",{key:0,onClick:be,class:"h-10 px-3 text-sm text-gray-500 hover:text-gray-700 transition-colors flex items-center gap-1"},[...t[54]||(t[54]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),v(" Limpiar ",-1)])])):f("",!0)])])]),n(X)?(d(),c("div",na,[...t[55]||(t[55]=[e("div",{class:"w-8 h-8 border-2 border-purple-600 border-t-transparent rounded-full animate-spin"},null,-1)])])):n(R)?(d(),c("div",ra,[D(n(wt),{class:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),e("div",null,[t[56]||(t[56]=e("p",{class:"font-medium text-red-800"},"Error al cargar sesiones",-1)),e("p",ia,l(n(R)),1)])])):(d(),c("div",la,[n(P).length===0?(d(),c("div",da,[e("div",ca,[D(n(ce),{class:"w-8 h-8 text-gray-400"})]),e("h3",ua,l(n(I)?"Sin resultados":"Sin sesiones"),1),e("p",pa,l(n(I)?"Prueba ajustando los filtros de bÃºsqueda":"Programa tu primera sesiÃ³n desde la agenda"),1),n(I)?(d(),c("button",{key:1,onClick:be,class:"px-4 py-2 text-gray-600 text-sm font-medium hover:text-gray-900 transition-colors"}," Limpiar filtros ")):(d(),c("button",{key:0,onClick:ve,class:"px-4 py-2 bg-purple-600 text-white text-sm font-medium rounded-lg hover:bg-purple-700 transition-colors"}," Ir a la agenda "))])):n(b)!=="agenda"?(d(),c("div",ma,[(d(!0),c($,null,A(n(he),a=>(d(),c("div",{key:a.fecha,class:"bg-white border border-gray-100 rounded-xl overflow-hidden"},[e("div",{class:x(["px-4 py-2 border-b border-gray-100 flex items-center gap-2",{"bg-purple-50":a.esHoy,"bg-blue-50/50":a.esMaÃ±ana,"bg-gray-50/80":!a.esHoy&&!a.esMaÃ±ana}])},[e("div",{class:x(["w-6 h-6 rounded-lg flex items-center justify-center flex-shrink-0",{"bg-purple-100 text-purple-600":a.esHoy,"bg-blue-100 text-blue-600":a.esMaÃ±ana,"bg-gray-200 text-gray-500":!a.esHoy&&!a.esMaÃ±ana}])},[D(n(ce),{class:"w-3.5 h-3.5"})],2),e("span",{class:x(["text-sm font-semibold capitalize",{"text-purple-700":a.esHoy,"text-blue-700":a.esMaÃ±ana,"text-gray-600":!a.esHoy&&!a.esMaÃ±ana}])},l(a.fechaFormateada),3),e("span",ga,l(a.sesiones.length)+" sesiÃ³n"+l(a.sesiones.length!==1?"es":""),1)],2),e("div",xa,[(d(!0),c($,null,A(a.sesiones,o=>(d(),c("div",{key:o.id,class:x(["flex items-center hover:bg-gray-50/50 transition-colors cursor-pointer",[n(b)==="compacta"?"gap-2 px-3 py-1.5":"gap-4 px-4 py-3",{"bg-teal-50/30 ring-1 ring-inset ring-teal-200":_(o)?.tipo==="inminente","bg-orange-50/30 ring-1 ring-inset ring-orange-200":_(o)?.tipo==="atencion"}]]),onClick:r=>se(o)},[e("div",{class:x(["flex-shrink-0 text-center",n(b)==="compacta"?"w-12":"w-14"])},[e("div",ha,l(G(o.hora_inicio)),1),n(b)!=="compacta"?(d(),c("div",ba,l(G(o.hora_fin)),1)):f("",!0)],2),e("div",{class:x(["flex items-center flex-1 min-w-0 group/paciente",n(b)==="compacta"?"gap-1.5":"gap-2.5"])},[e("button",{onClick:r=>Y(o,r),class:x(["rounded-full flex items-center justify-center font-semibold flex-shrink-0 transition-transform group-hover/paciente:scale-105",[n(b)==="compacta"?"w-7 h-7 text-[10px]":"w-9 h-9 text-xs",{"bg-gray-100 text-gray-400":o.estado==="cancelada","bg-purple-100 text-purple-600 hover:bg-purple-200":o.estado!=="cancelada"}]]),title:"Ver perfil de "+(o.paciente?.nombre_completo||"paciente")},l(we(o.paciente?.nombre_completo||"NN")),11,va),e("div",ya,[e("button",{onClick:r=>Y(o,r),class:x(["font-medium text-gray-900 truncate hover:text-purple-600 hover:underline transition-colors text-left",n(b)==="compacta"?"text-xs":"text-sm"])},l(o.paciente?.nombre_completo||"Sin nombre"),11,wa),o.modalidad==="online"?(d(),c("span",_a,[...t[57]||(t[57]=[e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1)])])):n(b)!=="compacta"?(d(),c("span",ka,[...t[58]||(t[58]=[e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})],-1)])])):f("",!0),(o.estado==="realizada"||o.estado==="completada")&&!o.esta_pagado&&(!o.bono||!o.bono.pagado)?(d(),c("span",Ca,[...t[59]||(t[59]=[e("svg",{class:"w-3.5 h-3.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)])])):f("",!0)])],2),e("div",Da,[_(o)?(d(),c("span",{key:0,class:x(["inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-bold border",_(o)?.clase])},[_(o)?.icono==="bolt"?(d(),c("svg",Ma,[...t[60]||(t[60]=[e("path",{"fill-rule":"evenodd",d:"M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z","clip-rule":"evenodd"},null,-1)])])):_(o)?.icono==="arrow-right"?(d(),c("svg",za,[...t[61]||(t[61]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7l5 5m0 0l-5 5m5-5H6"},null,-1)])])):_(o)?.icono==="exclamation"?(d(),c("svg",Sa,[...t[62]||(t[62]=[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"},null,-1)])])):_(o)?.icono==="clock"?(d(),c("svg",Ba,[...t[63]||(t[63]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])])):f("",!0),v(" "+l(_(o)?.texto),1)],2)):(d(),c("span",{key:1,class:x(["inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium border",_e(o.estado)])},[o.estado==="pendiente"?(d(),c("svg",Fa,[...t[64]||(t[64]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])])):o.estado==="confirmada"?(d(),c("svg",ja,[...t[65]||(t[65]=[e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)])])):o.estado==="realizada"||o.estado==="completada"?(d(),c("svg",Ea,[...t[66]||(t[66]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])])):o.estado==="cancelada"?(d(),c("svg",Pa,[...t[67]||(t[67]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])])):f("",!0),v(" "+l(W(o.estado)),1)],2))]),n(b)!=="compacta"?(d(),c("div",Ta,[o.bono?(d(),c("div",$a,[e("div",Aa,[e("span",Ha,l(o.bono.sesiones_restantes)+"/"+l(o.bono.sesiones_totales),1),o.bono.pagado?(d(),c("span",La,[...t[68]||(t[68]=[e("svg",{class:"w-2.5 h-2.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"})],-1)])])):(d(),c("span",Va,[...t[69]||(t[69]=[e("svg",{class:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3"})],-1)])]))])])):(d(),c("span",Oa,"â€”"))])):f("",!0),n(b)!=="compacta"?(d(),c("div",Ra,[e("div",Na,l(F(o.precio_estimado||z))+"â‚¬ ",1)])):f("",!0),n(b)==="compacta"?(d(),c("div",qa,[e("span",Ia,l(F(o.precio_estimado||z))+"â‚¬",1)])):f("",!0),e("div",Ua,[o.estado==="pendiente"&&n(b)!=="compacta"?(d(),c("button",{key:0,onClick:r=>ne(o,r),disabled:n(w)===o.id,class:x(["p-1.5 rounded-lg text-emerald-600 hover:bg-emerald-50 transition-colors",{"opacity-50 cursor-wait":n(w)===o.id}]),title:"Confirmar sesiÃ³n"},[n(w)!==o.id?(d(),c("svg",Ga,[...t[70]||(t[70]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(d(),c("svg",Wa,[...t[71]||(t[71]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])]))],10,Ya)):f("",!0),e("div",Za,[e("button",{onClick:r=>Oe(o.id,r),class:"p-1.5 rounded-lg text-gray-400 hover:text-gray-600 hover:bg-gray-100 transition-colors",title:"MÃ¡s acciones"},[...t[72]||(t[72]=[e("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"})],-1)])],8,Ja),D(K,{"enter-active-class":"transition-all duration-150 ease-out","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition-all duration-100 ease-in","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:J(()=>[n(j)===o.id?(d(),c("div",Ka,[e("button",{onClick:r=>{se(o),Re()},class:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2"},[...t[73]||(t[73]=[e("svg",{class:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1),v(" Ver detalles ",-1)])],8,Qa),e("button",{onClick:r=>Y(o,r),class:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2"},[...t[74]||(t[74]=[e("svg",{class:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1),v(" Ver perfil paciente ",-1)])],8,Xa),t[78]||(t[78]=e("div",{class:"border-t border-gray-100 my-1"},null,-1)),o.estado==="pendiente"?(d(),c("button",{key:0,onClick:r=>ne(o,r),disabled:n(w)===o.id,class:"w-full px-3 py-2 text-left text-sm text-emerald-600 hover:bg-emerald-50 flex items-center gap-2"},[...t[75]||(t[75]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),v(" Confirmar sesiÃ³n ",-1)])],8,es)):f("",!0),o.estado==="pendiente"||o.estado==="confirmada"?(d(),c("button",{key:1,onClick:r=>Le(o,r),disabled:n(w)===o.id,class:"w-full px-3 py-2 text-left text-sm text-blue-600 hover:bg-blue-50 flex items-center gap-2"},[...t[76]||(t[76]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),v(" Marcar realizada ",-1)])],8,ts)):f("",!0),o.estado!=="cancelada"&&o.estado!=="realizada"?(d(),c("div",os)):f("",!0),o.estado!=="cancelada"&&o.estado!=="realizada"&&o.estado!=="completada"?(d(),c("button",{key:3,onClick:r=>Ve(o,r),disabled:n(w)===o.id,class:"w-full px-3 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center gap-2"},[...t[77]||(t[77]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),v(" Cancelar sesiÃ³n ",-1)])],8,as)):f("",!0)])):f("",!0)]),_:2},1024)]),n(b)!=="compacta"?(d(),Q(n(_t),{key:1,class:"w-4 h-4 text-gray-300"})):f("",!0)])],10,fa))),128))])]))),128))])):n(b)==="agenda"&&n(P).length>0?(d(),c("div",ss,[(d(!0),c($,null,A(n(he),a=>(d(),c("div",{key:"timeline-"+a.fecha,class:"relative"},[t[81]||(t[81]=e("div",{class:"absolute left-6 top-10 bottom-0 w-0.5 bg-gray-200"},null,-1)),e("div",ns,[e("div",{class:x(["w-12 h-12 rounded-xl flex flex-col items-center justify-center flex-shrink-0",{"bg-purple-500 text-white shadow-lg shadow-purple-200":a.esHoy,"bg-blue-100 text-blue-600":a.esMaÃ±ana,"bg-gray-100 text-gray-600":!a.esHoy&&!a.esMaÃ±ana}])},[e("span",rs,l(new Date(a.fecha+"T00:00:00").getDate()),1),e("span",is,l(new Date(a.fecha+"T00:00:00").toLocaleDateString("es-ES",{weekday:"short"})),1)],2),e("div",null,[e("h3",ls,l(a.fechaFormateada),1),e("p",ds,l(a.sesiones.length)+" sesiÃ³n"+l(a.sesiones.length!==1?"es":""),1)])]),e("div",cs,[(d(!0),c($,null,A(a.sesiones,o=>(d(),c("div",{key:"tl-"+o.id,class:x(["relative flex items-start gap-4 p-3 bg-white rounded-lg border border-gray-100 hover:shadow-md transition-all cursor-pointer",{"border-l-4 border-l-teal-500":_(o)?.tipo==="inminente","border-l-4 border-l-orange-400":_(o)?.tipo==="atencion","border-l-4 border-l-purple-500":a.esHoy&&!_(o)}]),onClick:r=>se(o)},[e("div",{class:x(["absolute -left-[calc(1.5rem+5px)] top-4 w-2.5 h-2.5 rounded-full border-2 border-white shadow-sm",{"bg-teal-500":_(o)?.tipo==="inminente","bg-orange-400":_(o)?.tipo==="atencion","bg-purple-500":a.esHoy&&!_(o),"bg-gray-300":!a.esHoy&&!_(o)}])},null,2),e("div",ps,[e("div",ms,l(G(o.hora_inicio)),1),e("div",gs,l(G(o.hora_fin)),1)]),e("div",xs,[e("div",fs,[e("button",{onClick:r=>Y(o,r),class:"font-medium text-gray-900 hover:text-purple-600 transition-colors"},l(o.paciente?.nombre_completo||"Sin nombre"),9,hs),o.modalidad==="online"?(d(),c("span",bs,[...t[79]||(t[79]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1)])])):f("",!0)]),e("div",vs,[e("span",{class:x(["inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium",_e(o.estado)])},l(W(o.estado)),3),o.bono?(d(),c("span",ys," Bono: "+l(o.bono.sesiones_restantes)+"/"+l(o.bono.sesiones_totales),1)):f("",!0)])]),e("div",ws,[e("span",_s,l(F(o.precio_estimado||z))+"â‚¬",1),o.estado==="pendiente"?(d(),c("button",{key:0,onClick:r=>ne(o,r),disabled:n(w)===o.id,class:"p-1.5 rounded-lg text-emerald-600 hover:bg-emerald-50 transition-colors",title:"Confirmar"},[...t[80]||(t[80]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)])],8,ks)):f("",!0)])],10,us))),128))])]))),128))])):f("",!0),n(U).length>0?(d(),c("div",Cs,[e("button",{onClick:t[11]||(t[11]=a=>N.value=!n(N)),class:"w-full flex items-center justify-between px-4 py-3 bg-green-50 border border-green-100 rounded-lg text-left hover:bg-green-100/50 transition-colors"},[e("div",Ds,[e("div",Ms,[D(n(Ce),{class:"w-4 h-4 text-white"})]),e("div",null,[t[82]||(t[82]=e("span",{class:"font-medium text-green-800"},"Pagos confirmados",-1)),e("span",zs,l(n(U).length)+" bonos Â· "+l(F(n(Be)))+"â‚¬",1)])]),D(n(kt),{class:x(["w-5 h-5 text-green-600 transition-transform",{"rotate-180":n(N)}])},null,8,["class"])]),D(K,{"enter-active-class":"transition-all duration-200 ease-out","enter-from-class":"opacity-0 max-h-0","enter-to-class":"opacity-100 max-h-[1000px]","leave-active-class":"transition-all duration-150 ease-in","leave-from-class":"opacity-100 max-h-[1000px]","leave-to-class":"opacity-0 max-h-0"},{default:J(()=>[de(e("div",Ss,[e("div",Bs,[(d(!0),c($,null,A(n(U),a=>(d(),c("div",{key:a.bono_id,class:"px-4 py-3 flex items-center gap-4 hover:bg-gray-50/50"},[e("div",Fs,l(we(a.paciente_nombre||"NN")),1),e("div",js,[e("div",Es,l(a.paciente_nombre),1),e("div",Ps,l(a.tipo_bono||"Bono")+" Â· "+l(a.sesiones_usadas)+"/"+l(a.bono_sesiones_totales)+" sesiones",1)]),e("div",Ts,[e("div",$s,l(F(a.monto_total_terapeuta))+"â‚¬",1),e("div",As,l(Ne(a.bono_fecha_pago)),1)])]))),128))])],512),[[tt,n(N)]])]),_:1})])):f("",!0)])),D(at,{"is-open":n(te),"cita-id":n(oe),onClose:He,onActualizado:ae,onEliminado:ae},null,8,["is-open","cita-id"])]))}});export{nn as default};
