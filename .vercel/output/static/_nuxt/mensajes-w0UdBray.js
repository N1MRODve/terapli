import{e as T,r,g as I,c as a,a as s,l,h as p,i as _,F as N,y as z,j,k as R,v as V,E as A,m as H,p as K,N as F,o as n,A as g,t as w}from"#entry";import{u as U}from"./usePacientes-CwDVOsC8.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";const q={class:"flex flex-col h-[calc(100vh-8rem)] max-w-4xl mx-auto px-4 py-8"},G={key:0,class:"flex-1 flex flex-col items-center justify-center"},J={key:1,class:"flex-1 flex flex-col bg-white rounded-xl shadow-sm border border-[#E2E8F0]/30 overflow-hidden"},O={key:0,class:"flex flex-col items-center justify-center h-full text-center py-12"},Q={key:0,class:"text-xs font-sans font-medium mb-1 opacity-70"},W={class:"text-sm font-sans whitespace-pre-wrap break-words"},X={key:0},Y={key:0,class:"w-4 h-4 inline",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Z={key:1,class:"w-4 h-4 inline",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},$={key:1,class:"flex justify-start"},ee={class:"flex-shrink-0 border-t border-[#E2E8F0]/30 p-4 bg-[#F2F2F2]/30"},te=["onKeydown"],se=["disabled"],oe={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ae={key:1,class:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"},ne=T({__name:"mensajes",setup(re){const{getMensajes:D,enviarMensaje:E,marcarComoLeido:M}=U(),h=r(!0),c=r([]),i=r(""),f=r(!1),x=r(!1),v=r(null),d=r(null),y=r(""),C=async()=>{h.value=!0;try{{const t=K(),{data:{user:u}}=await t.auth.getUser();u&&(y.value=u.id)}const o=await D();c.value=o||[];const e=c.value.filter(t=>!t.leido&&t.autor_id!==y.value).map(t=>t.id);e.length>0&&await M(e),F(()=>k())}catch(o){console.error("Error al cargar mensajes:",o)}finally{h.value=!1}},b=async()=>{if(!i.value.trim()||f.value)return;const o=i.value.trim();i.value="",f.value=!0,d.value&&(d.value.style.height="auto");try{const t=await E(o,"coord-uuid-1234");c.value.push(t),F(()=>k()),setTimeout(()=>{x.value=!0,setTimeout(()=>{x.value=!1},2e3)},1e3)}catch(e){console.error("Error al enviar mensaje:",e),alert("No se pudo enviar el mensaje. Intenta nuevamente.")}finally{f.value=!1}},m=o=>o.autor_id===y.value,S=o=>{if(!o)return"";const e=new Date(o),t=new Date,u=new Date(t);return u.setDate(u.getDate()-1),e.toDateString()===t.toDateString()?e.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}):e.toDateString()===u.toDateString()?"Ayer "+e.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}):e.toLocaleDateString("es-ES",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})},k=(o=!0)=>{v.value&&v.value.scrollTo({top:v.value.scrollHeight,behavior:o?"smooth":"auto"})},L=()=>{d.value&&(d.value.style.height="auto",d.value.style.height=d.value.scrollHeight+"px")},B=()=>{};return I(()=>{C()}),(o,e)=>(n(),a("div",q,[e[7]||(e[7]=s("header",{class:"mb-6 flex-shrink-0"},[s("h1",{class:"text-2xl sm:text-3xl font-serif font-medium text-[#2D3748]"}," Mensajes "),s("p",{class:"text-sm text-[#2D3748] opacity-70 font-sans mt-1"}," Conversación con tu coordinadora ")],-1)),l(h)?(n(),a("div",G,[...e[1]||(e[1]=[s("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#5550F2]"},null,-1),s("p",{class:"mt-4 text-[#2D3748] opacity-70 font-sans"},"Cargando mensajes...",-1)])])):(n(),a("div",J,[s("div",{ref_key:"mensajesContainer",ref:v,class:"flex-1 overflow-y-auto p-6 space-y-4",onScroll:B},[l(c).length===0?(n(),a("div",O,[...e[2]||(e[2]=[_('<div class="w-20 h-20 rounded-full bg-[#E2E8F0]/30 flex items-center justify-center mb-4" data-v-43787c8e><svg class="w-10 h-10 text-[#5550F2]" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-43787c8e><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" data-v-43787c8e></path></svg></div><h3 class="text-xl font-serif font-medium text-[#2D3748] mb-2" data-v-43787c8e>No hay mensajes</h3><p class="text-sm text-[#2D3748] opacity-70 font-sans max-w-md" data-v-43787c8e> Inicia la conversación enviando un mensaje a tu coordinadora. </p>',3)])])):p("",!0),(n(!0),a(N,null,z(l(c),t=>(n(),a("div",{key:t.id,class:g(["flex",m(t)?"justify-end":"justify-start"])},[s("div",{class:g(["max-w-[70%] rounded-2xl px-4 py-3 shadow-sm",m(t)?"bg-[#5550F2] text-white rounded-br-sm":"bg-[#F2F2F2] text-[#2D3748] rounded-bl-sm"])},[m(t)?p("",!0):(n(),a("p",Q,w(t.autor?.nombre_completo||"Coordinadora"),1)),s("p",W,w(t.contenido),1),s("div",{class:g(["flex items-center gap-1 mt-1 text-xs","font-['Lato']",m(t)?"text-white/70":"text-[#2D3748]/50"])},[s("span",null,w(S(t.created_at)),1),m(t)?(n(),a("span",X,[t.leido?(n(),a("svg",Y,[...e[3]||(e[3]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1),s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 13l4 4L23 7"},null,-1)])])):(n(),a("svg",Z,[...e[4]||(e[4]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])]))])):p("",!0)],2)],2)],2))),128)),l(x)?(n(),a("div",$,[...e[5]||(e[5]=[_('<div class="bg-[#F2F2F2] rounded-2xl rounded-bl-sm px-4 py-3 shadow-sm" data-v-43787c8e><div class="flex gap-1" data-v-43787c8e><span class="w-2 h-2 bg-[#5550F2] rounded-full animate-bounce" style="animation-delay:0ms;" data-v-43787c8e></span><span class="w-2 h-2 bg-[#5550F2] rounded-full animate-bounce" style="animation-delay:150ms;" data-v-43787c8e></span><span class="w-2 h-2 bg-[#5550F2] rounded-full animate-bounce" style="animation-delay:300ms;" data-v-43787c8e></span></div></div>',1)])])):p("",!0)],544),s("div",ee,[s("form",{onSubmit:j(b,["prevent"]),class:"flex gap-2"},[R(s("textarea",{"onUpdate:modelValue":e[0]||(e[0]=t=>H(i)?i.value=t:null),placeholder:"Escribe tu mensaje...",rows:"1",class:"flex-1 px-4 py-3 border border-[#E2E8F0] rounded-xl focus:outline-none focus:ring-2 focus:ring-[#5550F2] focus:border-transparent resize-none font-sans text-[#2D3748] placeholder:text-[#2D3748]/40 bg-white",onKeydown:A(j(b,["exact","prevent"]),["enter"]),onInput:L,ref_key:"textareaRef",ref:d},null,40,te),[[V,l(i)]]),s("button",{type:"submit",disabled:!l(i).trim()||l(f),class:"flex-shrink-0 w-12 h-12 bg-[#5550F2] hover:bg-[#C89B8A] disabled:bg-[#E2E8F0] disabled:cursor-not-allowed text-white rounded-xl transition-colors flex items-center justify-center"},[l(f)?(n(),a("div",ae)):(n(),a("svg",oe,[...e[6]||(e[6]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"},null,-1)])]))],8,se)],32)])]))]))}}),ue=P(ne,[["__scopeId","data-v-43787c8e"]]);export{ue as default};
