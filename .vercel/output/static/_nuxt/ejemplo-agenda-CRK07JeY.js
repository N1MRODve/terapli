import{c as s,o,a as e,e as ce,z as F,j as _,t as u,n as C,A as Ne,F as U,k as j,d as de,g as mt,B as It,r as $,C as Rt,D as pt,b as q,i as J,E as _e,l as G,G as nt,H as Pe,I as lt,m as Ae,v as Oe,J as Se,s as Pt,T as it,K as dt}from"#entry";import{_ as fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as Vt,_ as Nt}from"./ModalNuevaCitaEnhanced-BP__1SyS.js";import{M as Ot}from"./ModalDetallesCita-CxtIMQaR.js";import{a as ie}from"./usePacientes-CaQyEVfZ.js";import{r as ct}from"./CheckCircleIcon-BzuOBYCH.js";import{r as Ut}from"./ArrowPathIcon-CzZelkbp.js";import{r as qt}from"./ClipboardDocumentListIcon-CSBwmCjC.js";import{r as Kt}from"./PlusIcon-UqRq4KLf.js";import{r as Yt}from"./MagnifyingGlassIcon-B5My0XuL.js";import{r as ut}from"./XMarkIcon-DWNj0d99.js";import{r as Gt}from"./UserIcon-G1mM6o1b.js";import{r as Wt}from"./FunnelIcon-CO-pjLeZ.js";import"./PaymentMethodSelector-BdCeWAUw.js";import"./useToast-Cq0GyJHs.js";import"./ModalNuevoBono-DZsr-zos.js";import"./useBonos-BSiCGD07.js";import"./CheckCircleIcon-Bi0YyG7H.js";import"./PencilIcon-QJyqa3i7.js";import"./PhoneIcon-B4J2dtua.js";import"./CalendarDaysIcon-C0vq0F4x.js";import"./ClockIcon-CQZt9cKZ.js";import"./TicketIcon-DRclOuRO.js";import"./ChevronDownIcon-BwiNUDLV.js";import"./ExclamationTriangleIcon-BreoAuwB.js";function vt(d,M){return o(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15"})])}const Jt={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},Zt={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-5"},Qt={class:"flex items-center justify-between"},Xt={class:"text-3xl font-bold text-blue-600 mt-1"},ea={class:"text-xs text-gray-500 mt-1"},ta={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-5"},aa={class:"flex items-center justify-between"},oa={class:"text-3xl font-bold text-green-600 mt-1"},sa={class:"text-xs text-gray-500 mt-1"},ra={class:"flex items-center justify-between"},na={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-5"},la={class:"flex items-center justify-between"},ia={class:"text-3xl font-bold text-gray-600 mt-1"},da={key:0,class:"col-span-full bg-white rounded-lg shadow-sm border border-gray-200 p-5"},ca={class:"flex items-center justify-between mb-2"},ua={class:"text-sm font-bold text-gray-900"},va={class:"w-full bg-gray-200 rounded-full h-3 overflow-hidden"},ma={class:"flex justify-between text-xs text-gray-500 mt-1"},pa={key:0,class:"mt-4 bg-gradient-to-r from-yellow-50 to-orange-50 border-l-4 border-yellow-400 p-4 rounded-r-lg"},ga={class:"flex items-start"},ba={class:"ml-3 flex-1"},fa={class:"mt-2 text-sm text-yellow-700"},ha={key:0},xa={key:1},ya={key:2,class:"ml-2"},wa=ce({__name:"EstadisticasBonos",props:{citas:{}},setup(d){const M=d,c=F(()=>{const b=M.citas.filter(z=>z.bono),p=new Map;b.forEach(z=>{z.bono&&p.set(z.bono.id,z.bono)});const y=Array.from(p.values()),D=y.length,E=y.filter(z=>z.estado==="activo").length,A=y.filter(z=>z.sesiones_restantes<=2&&z.sesiones_restantes>0).length,R=y.filter(z=>z.sesiones_restantes===0||z.estado==="completado").length,g=y.reduce((z,S)=>z+S.sesiones_restantes,0),k=y.reduce((z,S)=>z+S.sesiones_totales,0),P=k>0?Math.round((k-g)/k*100):0;return{totalBonos:D,bonosActivos:E,bonosConPocasSesiones:A,bonosAgotados:R,totalSesionesDisponibles:g,totalSesionesProgramadas:k,porcentajeUsado:P}}),h=F(()=>c.value.bonosConPocasSesiones>0||c.value.bonosAgotados>0);return(b,p)=>(o(),s(U,null,[e("div",Jt,[e("div",Zt,[e("div",Qt,[e("div",null,[p[0]||(p[0]=e("p",{class:"text-sm font-medium text-gray-600"},"Bonos Activos",-1)),e("p",Xt,u(c.value.bonosActivos),1),e("p",ea,"de "+u(c.value.totalBonos)+" totales",1)]),p[1]||(p[1]=e("div",{class:"h-12 w-12 bg-blue-100 rounded-full flex items-center justify-center"},[e("svg",{class:"h-6 w-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"})])],-1))])]),e("div",ta,[e("div",aa,[e("div",null,[p[2]||(p[2]=e("p",{class:"text-sm font-medium text-gray-600"},"Sesiones Disponibles",-1)),e("p",oa,u(c.value.totalSesionesDisponibles),1),e("p",sa," de "+u(c.value.totalSesionesProgramadas)+" programadas ",1)]),p[3]||(p[3]=e("div",{class:"h-12 w-12 bg-green-100 rounded-full flex items-center justify-center"},[e("svg",{class:"h-6 w-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})])],-1))])]),e("div",{class:C(["rounded-lg shadow-sm border p-5",c.value.bonosConPocasSesiones>0?"bg-yellow-50 border-yellow-300":"bg-white border-gray-200"])},[e("div",ra,[e("div",null,[p[4]||(p[4]=e("p",{class:"text-sm font-medium text-gray-600"},"Bonos por Renovar",-1)),e("p",{class:C(["text-3xl font-bold mt-1",c.value.bonosConPocasSesiones>0?"text-yellow-600":"text-gray-400"])},u(c.value.bonosConPocasSesiones),3),p[5]||(p[5]=e("p",{class:"text-xs text-gray-500 mt-1"},"‚â§2 sesiones restantes",-1))]),e("div",{class:C(["h-12 w-12 rounded-full flex items-center justify-center",c.value.bonosConPocasSesiones>0?"bg-yellow-200":"bg-gray-100"])},[(o(),s("svg",{class:C(["h-6 w-6",c.value.bonosConPocasSesiones>0?"text-yellow-600":"text-gray-400"]),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[...p[6]||(p[6]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"},null,-1)])],2))],2)])],2),e("div",na,[e("div",la,[e("div",null,[p[7]||(p[7]=e("p",{class:"text-sm font-medium text-gray-600"},"Bonos Completados",-1)),e("p",ia,u(c.value.bonosAgotados),1),p[8]||(p[8]=e("p",{class:"text-xs text-gray-500 mt-1"},"0 sesiones restantes",-1))]),p[9]||(p[9]=e("div",{class:"h-12 w-12 bg-gray-100 rounded-full flex items-center justify-center"},[e("svg",{class:"h-6 w-6 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1))])]),c.value.totalSesionesProgramadas>0?(o(),s("div",da,[e("div",ca,[p[10]||(p[10]=e("p",{class:"text-sm font-medium text-gray-700"},"Uso General de Bonos",-1)),e("p",ua,u(c.value.porcentajeUsado)+"% usado",1)]),e("div",va,[e("div",{class:C(["h-full rounded-full transition-all duration-500",c.value.porcentajeUsado>=80?"bg-red-500":c.value.porcentajeUsado>=60?"bg-yellow-500":"bg-green-500"]),style:Ne({width:`${c.value.porcentajeUsado}%`})},null,6)]),e("div",ma,[e("span",null,u(c.value.totalSesionesProgramadas-c.value.totalSesionesDisponibles)+" usadas",1),e("span",null,u(c.value.totalSesionesDisponibles)+" disponibles",1)])])):_("",!0)]),h.value?(o(),s("div",pa,[e("div",ga,[p[13]||(p[13]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-yellow-400 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})])],-1)),e("div",ba,[p[12]||(p[12]=e("h3",{class:"text-sm font-medium text-yellow-800"}," Acci√≥n Requerida ",-1)),e("div",fa,[e("p",null,[c.value.bonosConPocasSesiones>0?(o(),s("strong",ha,u(c.value.bonosConPocasSesiones)+" bono"+u(c.value.bonosConPocasSesiones>1?"s":""),1)):_("",!0),c.value.bonosConPocasSesiones>0?(o(),s("span",xa,u(c.value.bonosConPocasSesiones>1?" necesitan":" necesita")+" renovaci√≥n pronto. ",1)):_("",!0),c.value.bonosAgotados>0?(o(),s("strong",ya,u(c.value.bonosAgotados)+" bono"+u(c.value.bonosAgotados>1?"s":"")+" completado"+u(c.value.bonosAgotados>1?"s":"")+". ",1)):_("",!0)]),p[11]||(p[11]=e("p",{class:"mt-1 text-xs"}," üí° Contacta a los pacientes para ofrecer renovaci√≥n de bonos ",-1))])])])])):_("",!0)],64))}}),_a=Object.assign(fe(wa,[["__scopeId","data-v-44ce82a9"]]),{__name:"EstadisticasBonos"}),ka={class:"flex items-start justify-between gap-4"},Ca={class:"flex-1 min-w-0"},$a={class:"flex items-center gap-3 mb-2 flex-wrap"},Da={class:"flex items-center gap-2"},Aa={class:"truncate"},Sa={key:0,class:"text-gray-400"},Ma={key:1,class:"capitalize truncate"},za={key:0,class:"flex items-center gap-2"},ja={class:"truncate"},Ea={class:"flex items-center justify-between gap-2"},Ba={class:"flex-1 min-w-0"},Ta={class:"text-xs font-medium text-gray-700 mb-1"},La={class:"flex items-center gap-2 flex-wrap"},Fa={class:"text-xs text-gray-500 capitalize"},Ha={key:1,class:"mt-3 p-3 bg-gray-50 border border-gray-200 rounded-lg"},Ia={key:2,class:"mt-3 p-2 bg-gray-50 rounded text-xs text-gray-700"},Ra={class:"flex flex-col gap-2"},Pa=ce({__name:"TarjetaCita",props:{cita:{},compact:{type:Boolean}},emits:["completar","verHistorial"],setup(d,{emit:M}){const c=d,h=M,b=E=>E.substring(0,5),p=F(()=>{const E=c.cita.estado;return{pendiente:"bg-yellow-100 text-yellow-800 border-yellow-300",confirmada:"bg-blue-100 text-blue-800 border-blue-300",completada:"bg-green-100 text-green-800 border-green-300",realizada:"bg-green-100 text-green-800 border-green-300",cancelada:"bg-red-100 text-red-800 border-red-300"}[E]||"bg-gray-100 text-gray-800 border-gray-300"}),y=F(()=>{if(!c.cita.bono)return null;const E=c.cita.bono.sesiones_restantes,A=c.cita.bono.estado;return A==="completado"||E===0?{color:"text-red-600",icono:"üö´",alerta:!0,mensajeAlerta:"Bono agotado",clase:"bg-red-50 border-red-200"}:E===1?{color:"text-orange-600",icono:"‚ö†Ô∏è",alerta:!0,mensajeAlerta:"√öltima sesi√≥n del bono",clase:"bg-orange-50 border-orange-200"}:E<=2?{color:"text-yellow-600",icono:"‚ö†Ô∏è",alerta:!0,mensajeAlerta:"Pocas sesiones restantes",clase:"bg-yellow-50 border-yellow-200"}:A==="activo"?{color:"text-green-600",icono:"‚úì",alerta:!1,mensajeAlerta:null,clase:"bg-green-50 border-green-200"}:{color:"text-gray-600",icono:"‚ÑπÔ∏è",alerta:!1,mensajeAlerta:null,clase:"bg-gray-50 border-gray-200"}}),D=F(()=>c.cita.estado==="pendiente"||c.cita.estado==="confirmada");return(E,A)=>(o(),s("div",{class:C(["border rounded-xl shadow-sm hover:shadow-md transition-all duration-200 bg-white overflow-hidden",d.compact?"p-3":"p-5"])},[e("div",ka,[e("div",Ca,[e("div",$a,[e("h3",{class:C([d.compact?"text-base":"text-lg","font-semibold text-gray-900 truncate"])},u(d.cita.paciente?.nombre_completo||"Paciente"),3),e("span",{class:C(["px-3 py-1 text-xs font-medium rounded-full border",j(p)])},u(d.cita.estado.toUpperCase()),3)]),e("div",{class:C(["space-y-1",d.compact?"text-xs":"text-sm","text-gray-600"])},[e("div",Da,[A[2]||(A[2]=e("svg",{class:"h-4 w-4 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",Aa,u(b(d.cita.hora_inicio))+" - "+u(b(d.cita.hora_fin)),1),d.cita.modalidad?(o(),s("span",Sa,"‚Ä¢")):_("",!0),d.cita.modalidad?(o(),s("span",Ma,u(d.cita.modalidad),1)):_("",!0)]),d.cita.paciente?.telefono&&!d.compact?(o(),s("div",za,[A[3]||(A[3]=e("svg",{class:"h-4 w-4 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})],-1)),e("span",ja,u(d.cita.paciente.telefono),1)])):_("",!0)],2),d.cita.bono?(o(),s("div",{key:0,class:C(["mt-3 p-3 rounded-lg border",j(y)?.clase||"bg-gray-50 border-gray-200"])},[e("div",Ea,[e("div",Ba,[e("p",Ta,u(j(y)?.icono)+" Bono de Sesiones ",1),e("div",La,[e("p",{class:C(["text-sm font-semibold",j(y)?.color||"text-gray-900"])},u(d.cita.bono.sesiones_restantes)+" / "+u(d.cita.bono.sesiones_totales)+" sesiones ",3),e("span",Fa," ("+u(d.cita.bono.estado)+") ",1)]),j(y)?.alerta?(o(),s("p",{key:0,class:C(["mt-2 text-xs font-medium",j(y).color])},u(j(y).mensajeAlerta),3)):_("",!0)]),d.compact?_("",!0):(o(),s("button",{key:0,onClick:A[0]||(A[0]=R=>h("verHistorial",d.cita.bono.id)),class:"text-xs text-blue-600 hover:text-blue-800 font-medium whitespace-nowrap px-2 py-1 hover:bg-blue-50 rounded transition-colors",type:"button"}," üìä Historial "))])],2)):(o(),s("div",Ha,[...A[4]||(A[4]=[e("p",{class:"text-xs text-gray-500 italic flex items-center gap-2"},[e("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),de(" Sin bono activo - Consulta individual ")],-1)])])),d.cita.observaciones&&!d.compact?(o(),s("div",Ia,[A[5]||(A[5]=e("p",{class:"font-medium text-gray-500 mb-1"},"Observaciones:",-1)),de(" "+u(d.cita.observaciones),1)])):_("",!0)]),e("div",Ra,[j(D)?(o(),s("button",{key:0,onClick:A[1]||(A[1]=R=>h("completar",d.cita.id)),class:C(["px-4 py-2 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 transition-colors",d.compact?"text-xs":"text-sm"]),type:"button"}," ‚úÖ Completar ",2)):d.cita.estado==="completada"||d.cita.estado==="realizada"?(o(),s("span",{key:1,class:C(["px-4 py-2 bg-green-100 text-green-800 font-medium rounded-lg text-center",d.compact?"text-xs":"text-sm"])}," ‚úì Completada ",2)):_("",!0)])])],2))}}),gt=Object.assign(fe(Pa,[["__scopeId","data-v-3085384e"]]),{__name:"TarjetaCita"});function bt(){const d=mt(),M=It(),c=$([]),h=$(!1),b=$(null),p=$(null),y=$({});$(new Map);const D=F(()=>{const l=new Date().toISOString().split("T")[0];return c.value.filter(n=>n.fecha_cita===l)}),E=F(()=>c.value.filter(l=>l.estado==="pendiente"||l.estado==="confirmada")),A=F(()=>c.value.filter(l=>l.estado==="completada"||l.estado==="realizada")),R=F(()=>c.value.filter(l=>l.bono&&l.bono.sesiones_restantes<=2&&l.bono.sesiones_restantes>0&&(l.estado==="pendiente"||l.estado==="confirmada"))),g=async l=>{try{if(h.value=!0,b.value=null,!M.value?.id)throw new Error("Usuario no autenticado");let n=d.from("citas").select(`
          id,
          fecha_cita,
          hora_inicio,
          hora_fin,
          estado,
          modalidad,
          observaciones,
          paciente_id,
          terapeuta_id,
          bono_id,
          sesion_descontada,
          consumo_registrado,
          paciente:pacientes (
            id,
            nombre_completo,
            telefono,
            email
          ),
          bono:bonos (
            id,
            sesiones_restantes,
            sesiones_totales,
            estado
          )
        `).eq("terapeuta_id",M.value.id);l?.fechaInicio&&(n=n.gte("fecha_cita",l.fechaInicio)),l?.fechaFin&&(n=n.lte("fecha_cita",l.fechaFin)),l?.incluirCompletadas||(n=n.in("estado",["pendiente","confirmada"])),n=n.order("fecha_cita",{ascending:!0}).order("hora_inicio",{ascending:!0});const{data:x,error:m}=await n;if(m)throw m;return c.value=x||[],console.log(`‚úÖ [Agenda] Cargadas ${c.value.length} citas`),c.value}catch(n){throw console.error("‚ùå [Agenda] Error al cargar citas:",n),b.value=n.message||"Error al cargar citas",n}finally{h.value=!1}},k=async l=>{try{console.log(`üîÑ [Agenda] Completando cita: ${l}`);const{data:n,error:x}=await d.rpc("completar_cita",{p_cita_id:l});if(x)throw console.error("‚ùå [Agenda] Error en RPC:",x),x;const m=n;if(m.success){console.log("‚úÖ [Agenda] Cita completada exitosamente");const B=c.value.findIndex(T=>T.id===l);if(B!==-1){const T=c.value[B];T&&(T.estado="completada",T.sesion_descontada=!0,T.consumo_registrado=!0,T.bono&&m.sesiones_despues!==void 0&&(T.bono.sesiones_restantes=m.sesiones_despues,m.bono_completado&&(T.bono.estado="completado")))}return m.alerta?xe(m):K("success",m.message),await g(),m}else return m.warning?(console.warn("‚ö†Ô∏è [Agenda] Advertencia:",m.message),K("warning",m.message)):(console.error("‚ùå [Agenda] Error:",m.message),K("error",m.message||"No se pudo completar la cita")),m}catch(n){console.error("‚ùå [Agenda] Error al completar cita:",n);const x=n.message||"Error desconocido al completar cita";return K("error",x),{success:!1,message:x,error:n.code||"unknown_error"}}},P=async l=>{try{const{data:n,error:x}=await d.rpc("obtener_historial_bono",{p_bono_id:l});if(x)throw x;return console.log(`‚úÖ [Agenda] Historial de bono obtenido: ${n?.length||0} movimientos`),n||[]}catch(n){throw console.error("‚ùå [Agenda] Error al obtener historial:",n),n}},z=async l=>{try{const{data:n,error:x}=await d.rpc("verificar_bono_citas",{p_bono_id:l});if(x)throw x;return console.log("‚úÖ [Agenda] Verificaci√≥n de bono:",n),n?.alerta&&console.warn("‚ö†Ô∏è [Agenda] Alerta en bono:",n.mensaje_alerta),n}catch(n){throw console.error("‚ùå [Agenda] Error al verificar bono:",n),n}},S=$([]),v=async()=>{try{console.log("üîç [Agenda] Detectando inconsistencias...");const{data:l,error:n}=await d.from("citas").select(`
          id,
          fecha_cita,
          hora_inicio,
          hora_fin,
          estado,
          modalidad,
          observaciones,
          paciente_id,
          terapeuta_id,
          bono_id,
          sesion_descontada,
          consumo_registrado,
          paciente:pacientes (
            id,
            nombre_completo,
            telefono,
            email
          ),
          bono:bonos (
            id,
            sesiones_restantes,
            sesiones_totales,
            estado
          )
        `).in("estado",["completada","realizada"]).not("bono_id","is",null).or("sesion_descontada.eq.false,consumo_registrado.eq.false").eq("terapeuta_id",M.value?.id||"");if(n)throw n;return S.value=l||[],S.value.length>0?console.warn(`‚ö†Ô∏è [Agenda] ${S.value.length} cita(s) con inconsistencias detectadas`):console.log("‚úÖ [Agenda] No se detectaron inconsistencias"),S.value}catch(l){return console.error("‚ùå [Agenda] Error al detectar inconsistencias:",l),S.value=[],[]}},f=async l=>{try{console.log(`üîÑ [Agenda] Re-sincronizando bono para cita: ${l}`);const{data:n,error:x}=await d.rpc("actualizar_bono_por_cita",{p_cita_id:l});if(x)throw x;const m=n;return m.success?(console.log("‚úÖ [Agenda] Bono re-sincronizado exitosamente"),m.warning==="ya_descontada"?K("info","Esta sesi√≥n ya estaba descontada"):(K("success","Bono re-sincronizado correctamente"),m.alerta&&m.mensaje_alerta&&setTimeout(()=>{K("warning",m.mensaje_alerta)},500)),await Promise.all([g(),v()]),m):(console.warn("‚ö†Ô∏è [Agenda] No se pudo re-sincronizar:",m.message),K("warning",m.message||"No se pudo re-sincronizar"),m)}catch(n){throw console.error("‚ùå [Agenda] Error al re-sincronizar bono:",n),K("error","Error al re-sincronizar el bono"),n}},H=async()=>{if(S.value.length===0){K("info","No hay citas pendientes de sincronizaci√≥n");return}try{console.log(`üîÑ [Agenda] Re-sincronizando ${S.value.length} citas...`);let l=0,n=0,x=0;for(const T of S.value)try{const L=await f(T.id);L.success?L.warning==="ya_descontada"?x++:l++:n++,await new Promise(V=>setTimeout(V,300))}catch{n++}const m=[];l>0&&m.push(`${l} sincronizada(s)`),x>0&&m.push(`${x} ya estaba(n) descontada(s)`),n>0&&m.push(`${n} fallida(s)`);const B=`‚úÖ Re-sincronizaci√≥n completa: ${m.join(", ")}`;K(n===0?"success":"warning",B),console.log("‚úÖ [Agenda] Re-sincronizaci√≥n masiva completada:",{exitosos:l,yaDescontados:x,fallidos:n})}catch(l){console.error("‚ùå [Agenda] Error en re-sincronizaci√≥n masiva:",l),K("error","Error al re-sincronizar todas las citas")}},W=()=>{if(!M.value?.id){console.warn("‚ö†Ô∏è [Agenda] No se puede suscribir sin usuario autenticado");return}p.value&&d.removeChannel(p.value),console.log("üì° [Agenda] Iniciando suscripci√≥n Realtime..."),p.value=d.channel(`citas_terapeuta_${M.value.id}`).on("postgres_changes",{event:"*",schema:"public",table:"citas",filter:`terapeuta_id=eq.${M.value.id}`},async l=>{console.log("üì° [Realtime] Cambio detectado en citas:",l.eventType),await g(),l.eventType==="INSERT"?K("info","Nueva cita agregada a tu agenda"):l.eventType==="UPDATE"?K("info","Una cita ha sido actualizada"):l.eventType==="DELETE"&&K("warning","Una cita ha sido eliminada")}).subscribe(l=>{l==="SUBSCRIBED"?console.log("‚úÖ [Realtime] Suscripci√≥n activa"):l==="CHANNEL_ERROR"?console.error("‚ùå [Realtime] Error en suscripci√≥n"):l==="TIMED_OUT"&&console.warn("‚ö†Ô∏è [Realtime] Tiempo de espera agotado")})},he=()=>{p.value&&(console.log("üì° [Realtime] Cerrando suscripci√≥n..."),d.removeChannel(p.value),p.value=null)},K=(l,n)=>{typeof window<"u"&&window.$toast?window.$toast[l](n):console.log(`${{success:"‚úÖ",error:"‚ùå",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è"}[l]} [Agenda] ${n}`)},xe=l=>{if(!l.alerta||!l.mensaje_alerta)return;const n=l.tipo_alerta==="bono_agotado"?"success":(l.tipo_alerta==="ultima_sesion","warning");K(n,l.mensaje_alerta)};Rt(()=>{M.value?.id&&(g(),W())}),pt(()=>{he()});const te=F(()=>{let l=c.value;if(y.value.paciente&&(l=l.filter(n=>n.paciente?.nombre_completo.toLowerCase().includes(y.value.paciente.toLowerCase()))),y.value.busqueda){const n=y.value.busqueda.toLowerCase();l=l.filter(x=>x.paciente?.nombre_completo.toLowerCase().includes(n)||x.observaciones?.toLowerCase().includes(n)||x.fecha_cita.includes(n))}return y.value.estado&&y.value.estado.length>0&&(l=l.filter(n=>y.value.estado.includes(n.estado))),y.value.area_terapeutica&&(l=l.filter(n=>n.area_terapeutica===y.value.area_terapeutica)),y.value.tipo_sesion&&y.value.tipo_sesion.length>0&&(l=l.filter(n=>n.tipo_sesion&&y.value.tipo_sesion.includes(n.tipo_sesion))),y.value.fecha_desde&&(l=l.filter(n=>n.fecha_cita>=y.value.fecha_desde)),y.value.fecha_hasta&&(l=l.filter(n=>n.fecha_cita<=y.value.fecha_hasta)),l}),ke=l=>{y.value={...l}},ye=()=>{y.value={}},Me=async(l,n,x,m)=>{try{h.value=!0;const{data:B,error:T}=await d.from("citas").update({fecha_cita:n,hora_inicio:x,hora_fin:m||x,updated_at:new Date().toISOString()}).eq("id",l).select().single();if(T)throw T;const L=c.value.findIndex(V=>V.id===l);return L!==-1&&B&&(c.value[L]={...c.value[L],...B}),{success:!0,cita:B}}catch(B){return console.error("Error al reprogramar cita:",B),{success:!1,error:B.message}}finally{h.value=!1}},ue=async(l,n,x)=>{try{const{data:m,error:B}=await d.from("citas").update({notas_rapidas:n,enlace_videollamada:x,updated_at:new Date().toISOString()}).eq("id",l).select().single();if(B)throw B;const T=c.value.findIndex(L=>L.id===l);return T!==-1&&m&&(c.value[T]={...c.value[T],...m}),{success:!0}}catch(m){return console.error("Error al actualizar notas:",m),{success:!1,error:m.message}}},X=async l=>{try{const n=l||M.value?.id;if(!n)throw new Error("ID de terapeuta requerido");const{data:x,error:m}=await d.from("terapeutas").select("disponibilidad").eq("id",n).single();if(m)throw m;return x?.disponibilidad||[]}catch(n){return console.error("Error al obtener disponibilidad:",n),[]}},Ee=(l,n)=>{const x=new Date(l+"T00:00:00").getDay(),m=c.value.filter(L=>L.fecha_cita===l),B=n.filter(L=>L.dia_semana===x&&L.disponible);if(B.length===0)return[];const T=[];return B.forEach(L=>{const V=L.hora_inicio,me=L.hora_fin;m.some(ee=>ee.hora_inicio>=V&&ee.hora_inicio<me||ee.hora_fin>V&&ee.hora_fin<=me||ee.hora_inicio<=V&&ee.hora_fin>=me)||T.push({hora_inicio:V,hora_fin:me})}),T},ze=async l=>{try{const n=c.value.find(L=>L.id===l);if(!n||!n.paciente)return{success:!1,error:"Cita no encontrada"};const x=new Date(n.fecha_cita+"T"+n.hora_inicio),m=new Date;return new Date(x.getTime()-1440*60*1e3)>m&&!n.recordatorio_24h_enviado&&(await d.from("notificaciones").insert({usuario_id:n.paciente_id,tipo:"cita",titulo:"üìÖ Recordatorio: Cita ma√±ana",mensaje:`Tu cita est√° programada para ma√±ana ${n.fecha_cita} a las ${n.hora_inicio}`,metadata:{cita_id:l,tipo_recordatorio:"24h",fecha_cita:n.fecha_cita,hora:n.hora_inicio}}),await d.from("citas").update({recordatorio_24h_enviado:!0}).eq("id",l)),new Date(x.getTime()-14400*1e3)>m&&!n.recordatorio_4h_enviado&&(await d.from("notificaciones").insert({usuario_id:n.paciente_id,tipo:"cita",titulo:"‚è∞ Recordatorio: Cita en 4 horas",mensaje:`Tu cita est√° programada para hoy ${n.fecha_cita} a las ${n.hora_inicio}`,metadata:{cita_id:l,tipo_recordatorio:"4h",fecha_cita:n.fecha_cita,hora:n.hora_inicio,enlace_videollamada:n.enlace_videollamada}}),await d.from("citas").update({recordatorio_4h_enviado:!0}).eq("id",l)),{success:!0}}catch(n){return console.error("Error al programar recordatorios:",n),{success:!1,error:n.message}}},Ce=(l,n)=>{const x=c.value.filter(m=>{const B=m.fecha_cita===l,T=n?m.terapeuta_id===n:!0,L=["pendiente","confirmada"].includes(m.estado);return B&&T&&L});return{total:x.length,confirmadas:x.filter(m=>m.estado==="confirmada").length,pendientes:x.filter(m=>m.estado==="pendiente").length}};return{citas:c,loading:h,error:b,filtros:y,citasDelDia:D,citasPendientes:E,citasCompletadas:A,citasConBonoProximoAgotar:R,citasFiltradas:te,getCitasDelTerapeuta:g,completarCita:k,obtenerHistorialBono:P,verificarBonoCitas:z,citasPendientesSync:S,detectarInconsistencias:v,resincronizarBono:f,resincronizarTodos:H,aplicarFiltros:ke,limpiarFiltros:ye,reprogramarCita:Me,actualizarNotasRapidas:ue,obtenerDisponibilidad:X,calcularHuecosLibres:Ee,programarRecordatorios:ze,calcularCargaDiaria:Ce,obtenerResumenSemanal:l=>{const n=new Date(l+"T00:00:00"),x=[];for(let m=0;m<7;m++){const B=new Date(n);B.setDate(n.getDate()+m);const T=B.toISOString().split("T")[0]||"";if(!T)continue;const L=Ce(T);x.push({fecha:T,dia:B.toLocaleDateString("es-ES",{weekday:"short"}),citas:L.total,confirmadas:L.confirmadas,pendientes:L.pendientes})}return x},obtenerResumenMensual:(l,n)=>{const x=new Date(l,n+1,0),m=new Map;for(let B=1;B<=x.getDate();B++){const L=new Date(l,n,B).toISOString().split("T")[0]||"";if(!L)continue;const V=Ce(L);m.set(L,{dia:B,citas:V.total,confirmadas:V.confirmadas,pendientes:V.pendientes})}return m},suscribirCitasRealtime:W,desuscribirCitasRealtime:he}}function Va(d,M){return o(),s("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M19.916 4.626a.75.75 0 0 1 .208 1.04l-9 13.5a.75.75 0 0 1-1.154.114l-6-6a.75.75 0 0 1 1.06-1.06l5.353 5.353 8.493-12.74a.75.75 0 0 1 1.04-.207Z","clip-rule":"evenodd"})])}const Na={class:"space-y-3"},Oa={class:"flex items-center justify-between"},Ua={class:"flex items-center gap-3"},qa={key:0,class:"px-3 py-1 bg-gradient-to-r from-teal-500 to-teal-600 text-white text-xs font-bold rounded-full shadow-sm"},Ka={key:1,class:"px-3 py-1 bg-gray-100 text-gray-700 text-xs font-semibold rounded-full"},Ya={key:2,class:"px-3 py-1 bg-orange-100 text-orange-700 text-xs font-bold rounded-full animate-pulse"},Ga={class:"flex items-center gap-2"},Wa={class:"flex flex-wrap gap-3"},Ja=["onClick","aria-pressed","onKeydown"],Za={class:"text-lg leading-none"},Qa={class:"font-bold"},Xa={key:0,class:"mt-4 text-center py-8 px-4 bg-orange-50 rounded-xl border-2 border-orange-200"},eo={key:1,class:"mt-4 text-center py-8 px-4 bg-gray-50 rounded-xl border-2 border-gray-200"},to=ce({__name:"AgendaStatusFilters",props:{citas:{},estadosActivos:{default:()=>["pendiente","confirmada","realizada","cancelada"]}},emits:["filtrar","update:estadosActivos"],setup(d,{emit:M}){const c=d,h=M,b=$(new Set(c.estadosActivos)),p=[{key:"pendiente",label:"Pendientes",emoji:"‚è≥",bgInactive:"bg-white hover:bg-yellow-50",textInactive:"text-yellow-700",borderInactive:"border-yellow-300",bgActive:"bg-yellow-500",textActive:"text-white",borderActive:"border-yellow-600",ringColor:"ring-yellow-500"},{key:"confirmada",label:"Confirmadas",emoji:"‚úì",bgInactive:"bg-white hover:bg-emerald-50",textInactive:"text-emerald-700",borderInactive:"border-emerald-300",bgActive:"bg-emerald-500",textActive:"text-white",borderActive:"border-emerald-600",ringColor:"ring-emerald-500"},{key:"realizada",label:"Realizadas",emoji:"‚úî",bgInactive:"bg-white hover:bg-blue-50",textInactive:"text-blue-700",borderInactive:"border-blue-300",bgActive:"bg-blue-500",textActive:"text-white",borderActive:"border-blue-600",ringColor:"ring-blue-500"},{key:"cancelada",label:"Canceladas",emoji:"‚úï",bgInactive:"bg-white hover:bg-red-50",textInactive:"text-red-700",borderInactive:"border-red-300",bgActive:"bg-red-500",textActive:"text-white",borderActive:"border-red-600",ringColor:"ring-red-500"}],y=v=>c.citas.filter(f=>f.estado===v).length,D=F(()=>c.citas.length),E=F(()=>b.value.size===0?c.citas.length:c.citas.filter(v=>b.value.has(v.estado)).length),A=F(()=>b.value.size<p.length&&b.value.size>0),R=F(()=>b.value.size===p.length),g=v=>{b.value.has(v)?b.value.delete(v):b.value.add(v);const f=Array.from(b.value);h("update:estadosActivos",f),h("filtrar",f)},k=()=>{p.forEach(f=>b.value.add(f.key));const v=Array.from(b.value);h("update:estadosActivos",v),h("filtrar",v)},P=()=>{b.value.clear(),h("update:estadosActivos",[]),h("filtrar",[])},z=v=>b.value.has(v),S=v=>["relative flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-semibold border-2 transition-all duration-200 cursor-pointer select-none","hover:shadow-md hover:-translate-y-0.5 active:translate-y-0","focus:outline-none focus:ring-2 focus:ring-offset-2",z(v.key)?[v.bgActive,v.textActive,v.borderActive,"shadow-sm"]:[v.bgInactive,v.textInactive,v.borderInactive],v.ringColor];return(v,f)=>(o(),s("div",Na,[e("div",Oa,[e("div",Ua,[f[0]||(f[0]=e("h3",{class:"text-sm font-bold text-gray-800 uppercase tracking-wide"},"Filtrar por Estado",-1)),A.value?(o(),s("div",qa,u(E.value)+" de "+u(D.value)+" citas ",1)):R.value?(o(),s("div",Ka,u(D.value)+" citas totales ",1)):(o(),s("div",Ya," Sin filtros - 0 citas visibles "))]),e("div",Ga,[R.value?_("",!0):(o(),s("button",{key:0,onClick:k,class:"text-xs font-medium text-teal-600 hover:text-teal-700 hover:underline transition-colors flex items-center gap-1"},[q(j(ct),{class:"w-4 h-4"}),f[1]||(f[1]=de(" Seleccionar todos ",-1))])),A.value||!R.value?(o(),s("button",{key:1,onClick:P,class:"text-xs font-medium text-gray-500 hover:text-gray-700 hover:underline transition-colors flex items-center gap-1"},[...f[2]||(f[2]=[e("svg",{class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),de(" Limpiar filtros ",-1)])])):_("",!0)])]),e("div",Wa,[(o(),s(U,null,J(p,H=>e("div",{key:H.key,onClick:W=>g(H.key),class:C(S(H)),role:"button","aria-pressed":z(H.key),tabindex:"0",onKeydown:[_e(W=>g(H.key),["enter"]),_e(G(W=>g(H.key),["prevent"]),["space"])]},[z(H.key)?(o(),s("div",{key:0,class:C(["absolute -top-2 -right-2 w-6 h-6 bg-white rounded-full flex items-center justify-center shadow-lg border-2",H.borderActive])},[q(j(ct),{class:C(["w-5 h-5",H.textInactive])},null,8,["class"])],2)):_("",!0),e("span",Za,u(H.emoji),1),e("span",Qa,u(H.label),1),e("span",{class:C(["ml-1 px-2 py-0.5 rounded-full text-xs font-bold",z(H.key)?"bg-white/30":"bg-gray-100"])},u(y(H.key)),3)],42,Ja)),64))]),b.value.size===0?(o(),s("div",Xa,[f[3]||(f[3]=e("div",{class:"text-4xl mb-2"},"üîç",-1)),f[4]||(f[4]=e("p",{class:"text-sm font-semibold text-orange-800 mb-1"}," No hay filtros activos ",-1)),f[5]||(f[5]=e("p",{class:"text-xs text-orange-600 mb-3"}," Selecciona al menos un estado para ver las citas ",-1)),e("button",{onClick:k,class:"px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white text-sm font-semibold rounded-lg transition-colors shadow-sm"}," Mostrar todas las citas ")])):E.value===0&&b.value.size>0?(o(),s("div",eo,[f[6]||(f[6]=e("div",{class:"text-4xl mb-2"},"üì≠",-1)),f[7]||(f[7]=e("p",{class:"text-sm font-semibold text-gray-700 mb-1"}," No hay citas con los estados seleccionados ",-1)),f[8]||(f[8]=e("p",{class:"text-xs text-gray-500 mb-3"}," Prueba seleccionando otros estados o todos ",-1)),e("button",{onClick:k,class:"text-sm font-medium text-teal-600 hover:text-teal-700 hover:underline"}," Ver todas las citas ")])):_("",!0)]))}}),ao=Object.assign(fe(to,[["__scopeId","data-v-8acd89bc"]]),{__name:"AgendaStatusFilters"}),oo=d=>new Date(d+"T00:00:00").toLocaleDateString("es-ES",{day:"2-digit",month:"long",year:"numeric"}),Ve=d=>new Date(d+"T00:00:00").toLocaleDateString("es-ES",{month:"long",year:"numeric"}),so=d=>{const M=new Date(d+"T00:00:00"),c=new Date(M.getFullYear(),0,1),h=M.getTime()-c.getTime(),b=1e3*60*60*24;return Math.ceil((h/b+c.getDay()+1)/7)},ro=(d,M)=>{const c=typeof M=="string"?M:M.toISOString().split("T")[0];switch(d){case"dia":return oo(c);case"5dias":return`${Ve(c)} ‚Äî 5 d√≠as`;case"semana":return`${Ve(c)} ‚Äî Semana ${so(c)}`;case"mes":return Ve(c);default:return""}},no={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 px-4 py-3 bg-white dark:bg-gray-900 border-b border-cafe/10 dark:border-gray-800"},lo={class:"flex items-center gap-3"},io={class:"text-lg sm:text-xl font-['Elms_Sans'] font-bold text-neutral-800 dark:text-gray-100 capitalize"},co={class:"flex items-center gap-3"},uo={class:"flex items-center bg-gray-100 dark:bg-gray-800 rounded-lg p-1"},vo=["onClick","title"],mo=["title"],po={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},go={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},bo={key:0,class:"hidden lg:flex items-center gap-2"},fo={class:"px-3 py-1.5 bg-purple-50 dark:bg-purple-900/30 border border-purple-200 dark:border-purple-700 rounded-lg"},ho={class:"text-sm font-semibold text-purple-700 dark:text-purple-400"},xo=ce({__name:"AgendaHeader",props:nt({rolActivo:{default:"terapeuta"},mostrarRol:{type:Boolean,default:!1}},{vista:{default:"semana"},vistaModifiers:{},fechaActual:{default:()=>new Date},fechaActualModifiers:{},darkMode:{type:Boolean,default:!1},darkModeModifiers:{}}),emits:nt(["nueva-cita"],["update:vista","update:fechaActual","update:darkMode"]),setup(d,{emit:M}){const c=Pe(d,"vista"),h=Pe(d,"fechaActual"),b=Pe(d,"darkMode"),p=M,y=[{value:"dia",label:"D√≠a",shortcut:"1"},{value:"5dias",label:"5 D√≠as",shortcut:"4"},{value:"semana",label:"Semana",shortcut:"2"},{value:"mes",label:"Mes",shortcut:"3"}],D=F(()=>ro(c.value,h.value)),E=()=>{h.value=new Date},A=()=>{const g=new Date(h.value);switch(c.value){case"dia":g.setDate(g.getDate()-1);break;case"5dias":g.setDate(g.getDate()-5);break;case"semana":g.setDate(g.getDate()-7);break;case"mes":g.setMonth(g.getMonth()-1);break}h.value=g},R=()=>{const g=new Date(h.value);switch(c.value){case"dia":g.setDate(g.getDate()+1);break;case"5dias":g.setDate(g.getDate()+5);break;case"semana":g.setDate(g.getDate()+7);break;case"mes":g.setMonth(g.getMonth()+1);break}h.value=g};return(g,k)=>(o(),s("div",no,[e("div",lo,[e("div",{class:"flex items-center gap-1"},[e("button",{onClick:A,class:"p-2 rounded-lg hover:bg-purple-50 dark:hover:bg-gray-800 text-cafe/70 dark:text-gray-400 hover:text-purple-600 dark:hover:text-purple-400 transition-colors",title:"Anterior"},[...k[2]||(k[2]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),e("button",{onClick:E,class:"px-3 py-1.5 text-sm font-medium rounded-lg border border-purple-200 dark:border-purple-700 text-purple-600 dark:text-purple-400 hover:bg-purple-50 dark:hover:bg-purple-900/30 transition-colors"}," Hoy "),e("button",{onClick:R,class:"p-2 rounded-lg hover:bg-purple-50 dark:hover:bg-gray-800 text-cafe/70 dark:text-gray-400 hover:text-purple-600 dark:hover:text-purple-400 transition-colors",title:"Siguiente"},[...k[3]||(k[3]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])])]),e("h1",io,u(j(D)),1)]),e("div",co,[e("div",uo,[(o(),s(U,null,J(y,P=>e("button",{key:P.value,onClick:z=>c.value=P.value,class:C(["px-3 py-1.5 text-sm font-medium rounded-md transition-all",c.value===P.value?"bg-white dark:bg-gray-700 text-purple-600 dark:text-purple-400 shadow-sm":"text-cafe/70 dark:text-gray-400 hover:text-cafe dark:hover:text-gray-200"]),title:`Vista ${P.label} (${P.shortcut})`},u(P.label),11,vo)),64))]),e("button",{onClick:k[0]||(k[0]=P=>b.value=!b.value),class:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-cafe/70 dark:text-gray-400 transition-colors",title:b.value?"Modo claro":"Modo oscuro"},[b.value?(o(),s("svg",go,[...k[5]||(k[5]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"},null,-1)])])):(o(),s("svg",po,[...k[4]||(k[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"},null,-1)])]))],8,mo),e("button",{onClick:k[1]||(k[1]=P=>p("nueva-cita")),class:"flex items-center gap-2 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white text-sm font-medium rounded-lg shadow-sm hover:shadow transition-all"},[...k[6]||(k[6]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("span",{class:"hidden sm:inline"},"Nueva Cita",-1)])]),d.mostrarRol?(o(),s("div",bo,[e("div",fo,[e("span",ho,u(d.rolActivo==="coordinadora"?"Coordinadora":"Terapeuta"),1)])])):_("",!0)])]))}}),yo=Object.assign(xo,{__name:"AgendaHeader"}),wo={class:"flex items-center justify-between gap-4 flex-wrap"},_o={class:"flex items-center gap-3"},ko={class:"text-sm"},Co={class:"font-medium text-neutral-800"},$o={class:"flex items-center gap-1 border border-neutral-200 rounded-lg p-1 bg-white"},Do=["aria-label"],Ao=["aria-label"],So={class:"flex items-center gap-3"},Mo={class:"flex bg-neutral-100 rounded-lg p-1",role:"tablist"},zo=["aria-selected"],jo=["aria-selected"],Eo=["aria-selected"],Bo=["disabled"],To={key:0,class:"text-sm font-medium text-neutral-700"},Lo={key:1,class:"text-sm font-medium text-neutral-500"},Fo={key:0,class:"mt-2 text-right"},Ho={class:"text-xs text-neutral-400"},Io=ce({__name:"AgendaViewControls",props:{vista:{},fechaActual:{},loading:{type:Boolean,default:!1},lastUpdateTime:{default:null}},emits:["cambiar-vista","navegar-fecha","ir-hoy","actualizar"],setup(d,{emit:M}){const c=d,h=M,b=F(()=>c.fechaActual.toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long",year:"numeric"})),p=F(()=>b.value.charAt(0).toUpperCase()+b.value.slice(1));return(y,D)=>(o(),s(U,null,[e("div",wo,[e("div",_o,[e("div",ko,[e("span",Co,u(p.value),1)]),e("div",$o,[e("button",{onClick:D[0]||(D[0]=E=>h("navegar-fecha",-1)),class:"p-1.5 rounded hover:bg-neutral-100 text-neutral-600 hover:text-neutral-800 transition-colors","aria-label":d.vista==="dia"?"D√≠a anterior":"Semana anterior",title:"Anterior"},[...D[7]||(D[7]=[e("svg",{class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])],8,Do),e("button",{onClick:D[1]||(D[1]=E=>h("ir-hoy")),class:"px-3 py-1.5 text-xs font-semibold text-teal-700 hover:bg-teal-50 rounded transition-colors"}," Hoy "),e("button",{onClick:D[2]||(D[2]=E=>h("navegar-fecha",1)),class:"p-1.5 rounded hover:bg-neutral-100 text-neutral-600 hover:text-neutral-800 transition-colors","aria-label":d.vista==="dia"?"D√≠a siguiente":"Semana siguiente",title:"Siguiente"},[...D[8]||(D[8]=[e("svg",{class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])],8,Ao)])]),e("div",So,[e("div",Mo,[e("button",{onClick:D[3]||(D[3]=E=>h("cambiar-vista","dia")),role:"tab","aria-selected":d.vista==="dia",class:C(["px-3 py-1.5 rounded-md text-sm font-medium transition-all",d.vista==="dia"?"bg-white text-neutral-800 shadow-sm":"text-neutral-600 hover:text-neutral-800"])}," D√≠a ",10,zo),e("button",{onClick:D[4]||(D[4]=E=>h("cambiar-vista","calendario")),role:"tab","aria-selected":d.vista==="calendario",class:C(["px-3 py-1.5 rounded-md text-sm font-medium transition-all",d.vista==="calendario"?"bg-white text-neutral-800 shadow-sm":"text-neutral-600 hover:text-neutral-800"])}," Semana ",10,jo),e("button",{onClick:D[5]||(D[5]=E=>h("cambiar-vista","lista")),role:"tab","aria-selected":d.vista==="lista",class:C(["px-3 py-1.5 rounded-md text-sm font-medium transition-all",d.vista==="lista"?"bg-white text-neutral-800 shadow-sm":"text-neutral-600 hover:text-neutral-800"])}," Lista ",10,Eo)]),e("button",{onClick:D[6]||(D[6]=E=>h("actualizar")),disabled:d.loading,class:"flex items-center gap-2 px-3 py-2 bg-white border border-neutral-200 rounded-lg hover:bg-neutral-50 transition-colors shadow-sm disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Actualizar agenda"},[(o(),s("svg",{class:C(["w-4 h-4 text-teal-600",d.loading?"animate-spin":""]),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[...D[9]||(D[9]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])],2)),d.loading?(o(),s("span",Lo,"Actualizando...")):(o(),s("span",To,"Actualizar"))],8,Bo)])]),d.lastUpdateTime&&!d.loading?(o(),s("div",Fo,[e("span",Ho,u(d.lastUpdateTime),1)])):_("",!0)],64))}}),Ro=Object.assign(fe(Io,[["__scopeId","data-v-c3b9a6c3"]]),{__name:"AgendaViewControls"}),Po={class:"agenda-unified-header"},Vo={class:"header-left"},No={class:"header-title"},Oo={class:"nav-controls","aria-label":"Navegaci√≥n temporal"},Uo=["aria-label","title"],qo=["aria-label","title"],Ko={class:"header-center"},Yo={class:"view-selector",role:"tablist"},Go=["onClick","aria-selected"],Wo={class:"header-right"},Jo=["disabled"],Zo=ce({__name:"AgendaUnifiedHeader",props:{vista:{},fechaActual:{},loading:{type:Boolean,default:!1},modoCoordinadora:{type:Boolean,default:!1}},emits:["cambiar-vista","navegar-fecha","ir-hoy","actualizar","nueva-cita","nueva-tarea"],setup(d,{emit:M}){const c=d,h=M,b=F(()=>{const R=new Date(c.fechaActual),g=new Date(R.getFullYear(),0,1),k=Math.floor((R.getTime()-g.getTime())/(1440*60*1e3));return Math.ceil((k+g.getDay()+1)/7)}),p=F(()=>{const R=new Date(c.fechaActual),g=R.getDay(),k=g===0?-6:1-g,P=new Date(R);P.setDate(R.getDate()+k);const z=new Date(P);z.setDate(P.getDate()+6);const S=H=>H.getDate(),v=H=>H.toLocaleDateString("es-ES",{month:"short"}),f=H=>H.getFullYear();return P.getMonth()===z.getMonth()?`${S(P)}‚Äì${S(z)} ${v(z)} ${f(z)}`:`${S(P)} ${v(P)} ‚Äì ${S(z)} ${v(z)} ${f(z)}`}),y=F(()=>c.fechaActual.toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long",year:"numeric"})),D=F(()=>{if(c.vista==="dia"){const R=y.value;return R.charAt(0).toUpperCase()+R.slice(1)}return`Semana ${b.value} ¬∑ ${p.value}`}),E=[{value:"dia",label:"D√≠a"},{value:"calendario",label:"Semana"},{value:"lista",label:"Lista"}],A=F(()=>c.vista==="dia"?{anterior:"D√≠a anterior",siguiente:"D√≠a siguiente"}:{anterior:"Semana anterior",siguiente:"Semana siguiente"});return(R,g)=>(o(),s("header",Po,[e("div",Vo,[e("h1",No,u(D.value),1),e("nav",Oo,[e("button",{onClick:g[0]||(g[0]=k=>h("navegar-fecha",-1)),class:"nav-btn","aria-label":A.value.anterior,title:A.value.anterior},[...g[6]||(g[6]=[e("svg",{class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])],8,Uo),e("button",{onClick:g[1]||(g[1]=k=>h("ir-hoy")),class:"nav-today"}," Hoy "),e("button",{onClick:g[2]||(g[2]=k=>h("navegar-fecha",1)),class:"nav-btn","aria-label":A.value.siguiente,title:A.value.siguiente},[...g[7]||(g[7]=[e("svg",{class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])],8,qo)])]),e("div",Ko,[e("div",Yo,[(o(),s(U,null,J(E,k=>e("button",{key:k.value,onClick:P=>h("cambiar-vista",k.value),role:"tab","aria-selected":d.vista===k.value,class:C(["view-btn",{active:d.vista===k.value}])},u(k.label),11,Go)),64))])]),e("div",Wo,[e("button",{onClick:g[3]||(g[3]=k=>h("actualizar")),disabled:d.loading,class:"action-btn action-btn-secondary","aria-label":"Actualizar agenda",title:"Actualizar"},[q(j(Ut),{class:C(["w-4 h-4",d.loading?"animate-spin":""])},null,8,["class"])],8,Jo),d.modoCoordinadora?(o(),s("button",{key:0,onClick:g[4]||(g[4]=k=>h("nueva-tarea")),class:"action-btn action-btn-secondary","aria-label":"Crear nueva tarea"},[q(j(qt),{class:"w-4 h-4"}),g[8]||(g[8]=e("span",{class:"hidden sm:inline"},"Nueva tarea",-1))])):_("",!0),e("button",{onClick:g[5]||(g[5]=k=>h("nueva-cita")),class:"action-btn action-btn-primary","aria-label":"Crear nueva cita"},[q(j(Kt),{class:"w-4 h-4"}),g[9]||(g[9]=e("span",null,"Nueva cita",-1))])])]))}}),Qo=Object.assign(fe(Zo,[["__scopeId","data-v-e95c8bd7"]]),{__name:"AgendaUnifiedHeader"}),Xo={class:"filter-bar"},es={class:"filter-row-main"},ts={class:"search-container"},as={key:0,class:"terapeuta-selector"},os=["value"],ss=["value"],rs={class:"filter-row-states"},ns={class:"states-label"},ls={class:"states-chips"},is=["onClick","aria-pressed"],ds={class:"chip-label"},cs={class:"chip-count"},us={class:"results-count"},vs={key:0,class:"results-filtered"},ms={key:1,class:"results-total"},ps={key:0,class:"search-indicator"},gs={class:"search-indicator-text"},bs=ce({__name:"AgendaFilterBar",props:{citas:{},modoCoordinadora:{type:Boolean,default:!1},terapeutas:{default:()=>[]},terapeutaSeleccionado:{default:null},estadosActivos:{default:()=>["pendiente","confirmada","realizada","cancelada"]},busqueda:{default:""}},emits:["update:busqueda","update:terapeutaSeleccionado","update:estadosActivos","filtrar-estados"],setup(d,{emit:M}){const c=d,h=M,b=$(c.busqueda),p=$(new Set(c.estadosActivos));lt(()=>c.busqueda,S=>{b.value=S}),lt(()=>c.estadosActivos,S=>{p.value=new Set(S)});const y=[{key:"pendiente",label:"Pendientes",color:"#F59E0B",bgLight:"rgba(245, 158, 11, 0.1)"},{key:"confirmada",label:"Confirmadas",color:"#10B981",bgLight:"rgba(16, 185, 129, 0.1)"},{key:"realizada",label:"Realizadas",color:"#6366F1",bgLight:"rgba(99, 102, 241, 0.1)"},{key:"cancelada",label:"Canceladas",color:"#EF4444",bgLight:"rgba(239, 68, 68, 0.1)"}],D=S=>c.citas.filter(v=>v.estado===S).length,E=F(()=>p.value.size===0?0:c.citas.filter(S=>p.value.has(S.estado)).length),A=S=>p.value.has(S),R=F(()=>p.value.size===y.length),g=()=>{h("update:busqueda",b.value)},k=()=>{b.value="",h("update:busqueda","")},P=S=>{p.value.has(S)?p.value.delete(S):p.value.add(S);const v=Array.from(p.value);h("update:estadosActivos",v),h("filtrar-estados",v)},z=()=>{y.forEach(v=>p.value.add(v.key));const S=Array.from(p.value);h("update:estadosActivos",S),h("filtrar-estados",S)};return(S,v)=>(o(),s("div",Xo,[e("div",es,[e("div",ts,[q(j(Yt),{class:"search-icon"}),Ae(e("input",{"onUpdate:modelValue":v[0]||(v[0]=f=>b.value=f),onInput:g,type:"search",placeholder:"Buscar por paciente, terapeuta o nota...",class:"search-input","aria-label":"Buscar en la agenda"},null,544),[[Oe,b.value]]),b.value?(o(),s("button",{key:0,onClick:k,class:"search-clear","aria-label":"Limpiar b√∫squeda"},[q(j(ut),{class:"w-4 h-4"})])):_("",!0)]),d.modoCoordinadora&&d.terapeutas.length>0?(o(),s("div",as,[q(j(Gt),{class:"w-4 h-4 text-gray-400"}),e("select",{value:d.terapeutaSeleccionado,onChange:v[1]||(v[1]=f=>h("update:terapeutaSeleccionado",f.target.value||null)),class:"terapeuta-select","aria-label":"Filtrar por terapeuta"},[v[2]||(v[2]=e("option",{value:""},"Todos los terapeutas",-1)),(o(!0),s(U,null,J(d.terapeutas,f=>(o(),s("option",{key:f.id,value:f.id},u(f.nombre),9,ss))),128))],40,os)])):_("",!0)]),e("div",rs,[e("div",ns,[q(j(Wt),{class:"w-3.5 h-3.5"}),v[3]||(v[3]=e("span",null,"Estado",-1))]),e("div",ls,[(o(),s(U,null,J(y,f=>e("button",{key:f.key,onClick:H=>P(f.key),class:C(["state-chip",{active:A(f.key)}]),style:Ne({"--chip-color":f.color,"--chip-bg":f.bgLight}),"aria-pressed":A(f.key)},[e("span",{class:"chip-dot",style:Ne({backgroundColor:f.color})},null,4),e("span",ds,u(f.label),1),e("span",cs,u(D(f.key)),1),A(f.key)?(o(),Se(j(Va),{key:0,class:"chip-check"})):_("",!0)],14,is)),64))]),e("div",us,[R.value?(o(),s("span",ms,u(d.citas.length)+" citas ",1)):(o(),s("span",vs,u(E.value)+" de "+u(d.citas.length),1)),R.value?_("",!0):(o(),s("button",{key:2,onClick:z,class:"show-all-btn"}," Ver todas "))])]),b.value?(o(),s("div",ps,[e("span",gs,[v[4]||(v[4]=de(" Buscando: ",-1)),e("strong",null,'"'+u(b.value)+'"',1)]),e("button",{onClick:k,class:"search-indicator-clear"},[q(j(ut),{class:"w-3.5 h-3.5"}),v[5]||(v[5]=de(" Limpiar ",-1))])])):_("",!0)]))}}),fs=Object.assign(fe(bs,[["__scopeId","data-v-06d28784"]]),{__name:"AgendaFilterBar"}),hs={class:"bg-white/90 backdrop-blur-sm rounded-2xl shadow-sm border border-white/30 p-4"},xs={class:"bg-white/90 backdrop-blur-sm rounded-2xl shadow-sm border border-white/30 p-4"},ys={class:"bg-white/90 backdrop-blur-sm rounded-2xl shadow-sm border border-white/30 p-4 space-y-4"},ws={class:"flex-1 relative"},_s={key:0,class:"flex items-center gap-2 text-sm"},ks={class:"text-neutral-500"},Cs={class:"px-2 py-0.5 bg-teal-50 text-teal-700 rounded-md font-medium"},$s={key:2,class:"bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200 rounded-2xl p-4 mb-4 shadow-sm"},Ds={class:"flex items-center gap-3"},As={class:"flex-1"},Ss={class:"text-sm font-medium text-amber-900"},Ms={key:3,class:"bg-white/90 backdrop-blur-sm rounded-2xl shadow-sm border border-white/30 overflow-hidden flex flex-col",style:{height:"calc(100vh - 200px)"}},zs={class:"sticky top-0 z-10 bg-gradient-to-r from-white/95 via-white/90 to-white/95 backdrop-blur-md border-b border-neutral-200 shadow-sm p-4"},js={class:"flex items-center justify-between"},Es={class:"font-['Elms_Sans'] font-semibold text-lg text-neutral-800"},Bs={class:"text-sm text-neutral-600 mt-1"},Ts={class:"flex-1 overflow-y-auto"},Ls={key:0,class:"flex items-center justify-center py-16"},Fs={class:"text-center"},Hs={class:"text-neutral-600 text-sm"},Is={key:1,class:"divide-y divide-neutral-100"},Rs=["data-hora"],Ps={class:"w-20 p-3 text-sm font-medium text-neutral-600 border-r border-neutral-200 bg-neutral-50/50 flex-shrink-0"},Vs=["onClick"],Ns=["onClick"],Os=["onDragstart","aria-label","title","onClick","onKeydown"],Us={class:"absolute top-2 right-2 flex items-center gap-1 opacity-0 group-hover:opacity-100 group-focus-within:opacity-100 transition-all z-10"},qs=["onClick","disabled","title","aria-label"],Ks={key:0,class:"w-3.5 h-3.5 animate-spin",fill:"none",viewBox:"0 0 24 24"},Ys={key:1,class:"w-3.5 h-3.5",fill:"currentColor",viewBox:"0 0 20 20"},Gs=["onClick","disabled","title","aria-label"],Ws={key:0,class:"w-3.5 h-3.5 animate-spin",fill:"none",viewBox:"0 0 24 24"},Js={key:1,class:"w-3.5 h-3.5",fill:"currentColor",viewBox:"0 0 20 20"},Zs=["onClick","disabled","aria-label"],Qs=["onClick","disabled","title","aria-label"],Xs={key:0,class:"w-3.5 h-3.5 animate-spin",fill:"none",viewBox:"0 0 24 24"},er={key:1,class:"w-3.5 h-3.5",fill:"currentColor",viewBox:"0 0 20 20"},tr={class:"flex items-start justify-between gap-3"},ar={class:"opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0"},or={class:"flex-1 min-w-0"},sr={class:"font-medium text-sm text-neutral-800 truncate"},rr={class:"flex items-center flex-wrap gap-2 mt-1"},nr={class:"text-xs text-neutral-600 font-medium"},lr={class:"inline-flex items-center gap-1 text-xs px-2 py-0.5 rounded-lg bg-white/60 text-neutral-700"},ir={key:0,title:"Online"},dr={key:1,title:"Presencial"},cr={key:0,class:"text-xs text-neutral-500 mt-1 flex items-center gap-1"},ur={class:"flex items-center gap-2 flex-shrink-0"},vr={key:4,class:"bg-white/90 backdrop-blur-sm rounded-2xl shadow-sm border border-white/30 overflow-hidden flex flex-col",style:{height:"calc(100vh - 200px)"}},mr={class:"min-w-[800px] overflow-x-auto flex-1 flex flex-col"},pr={class:"sticky top-0 z-10 bg-white border-b border-gray-200 shadow-sm"},gr={class:"grid grid-cols-8"},br={class:"flex items-center justify-center gap-1"},fr={class:"text-xs font-medium text-gray-600 uppercase"},hr={class:"text-xs text-gray-500"},xr={class:"flex-1 overflow-y-auto"},yr={class:"divide-y divide-gray-100"},wr=["data-hora"],_r={class:"p-3 text-sm font-medium text-gray-600 border-r border-gray-100 bg-gray-50 sticky left-0"},kr=["onDragover","onDrop","onMousedown","onMouseenter","onClick"],Cr={key:0,class:"absolute inset-0 flex items-center justify-center opacity-0 group-hover/cell:opacity-100 transition-all duration-200 pointer-events-none"},$r=["title"],Dr=["onDragstart","aria-label","title","onClick","onKeydown"],Ar={class:"absolute top-0.5 right-0.5 flex items-center gap-0.5 opacity-0 group-hover:opacity-100 group-focus-within:opacity-100 transition-all z-10"},Sr=["onClick","disabled","title","aria-label"],Mr={key:0,class:"w-2.5 h-2.5 animate-spin",fill:"none",viewBox:"0 0 24 24"},zr={key:1,class:"w-2.5 h-2.5",fill:"currentColor",viewBox:"0 0 20 20"},jr=["onClick","disabled","title","aria-label"],Er={key:0,class:"w-2.5 h-2.5 animate-spin",fill:"none",viewBox:"0 0 24 24"},Br={key:1,class:"w-2.5 h-2.5",fill:"currentColor",viewBox:"0 0 20 20"},Tr=["onClick","disabled","aria-label"],Lr=["onClick","disabled","title","aria-label"],Fr={key:0,class:"w-2.5 h-2.5 animate-spin",fill:"none",viewBox:"0 0 24 24"},Hr={key:1,class:"w-2.5 h-2.5",fill:"currentColor",viewBox:"0 0 20 20"},Ir={class:"w-5 h-5 flex items-center justify-center"},Rr={class:"pr-8"},Pr={class:"font-semibold truncate text-sm text-gray-800"},Vr={class:"text-xs text-gray-500 mt-0.5 font-medium"},Nr={class:"flex items-center gap-1.5 mt-1.5 flex-wrap"},Or={class:"inline-flex items-center gap-0.5 text-xs px-1.5 py-0.5 rounded bg-white/70 text-gray-600"},Ur={key:0,title:"Online"},qr={key:1,title:"Presencial"},Kr={key:2,title:"Telef√≥nica"},Yr={class:"hidden sm:inline"},Gr=["title"],Wr={key:0,class:"text-[10px] text-gray-400 mt-1 truncate"},Jr={key:5},Zr={class:"flex flex-wrap gap-2 mb-6"},Qr=["onClick"],Xr={key:0,class:"bg-red-50 border-l-4 border-red-400 p-4 mb-6"},en={class:"text-red-700"},tn={key:1,class:"text-center py-12"},an={key:2,class:"text-center py-12 bg-gray-50 rounded-lg"},on={class:"mt-1 text-sm text-gray-500"},sn={key:3,class:"space-y-4"},rn={class:"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-hidden"},nn={class:"px-6 py-4 overflow-y-auto max-h-[calc(90vh-140px)]"},ln={key:0,class:"text-center py-8"},dn={key:1},cn={key:0,class:"mb-6 p-4 bg-blue-50 rounded-lg"},un={class:"grid grid-cols-3 gap-4 text-center"},vn={class:"text-2xl font-bold text-blue-600"},mn={class:"text-2xl font-bold text-green-600"},pn={key:0,class:"mt-3 p-2 bg-yellow-100 border border-yellow-300 rounded text-sm text-yellow-800"},gn={key:0,class:"text-center py-8 text-gray-500"},bn={key:1,class:"space-y-3"},fn={class:"flex items-start justify-between"},hn={class:"flex-1"},xn={class:"flex items-center gap-2 mb-1"},yn={class:"text-xs text-gray-500"},wn={class:"text-sm text-gray-700"},_n={class:"text-right ml-4"},kn={class:"text-sm font-semibold text-gray-900"},Cn={class:"bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden"},$n={class:"px-6 py-4 border-b border-gray-100 bg-gradient-to-r from-blue-50 to-indigo-50"},Dn={class:"flex items-center justify-between"},An={class:"text-sm text-gray-500 mt-0.5"},Sn={class:"p-6 space-y-5"},Mn={class:"bg-gray-50 rounded-xl p-4"},zn={class:"flex items-center gap-3"},jn={class:"font-medium text-gray-900"},En={class:"text-sm text-gray-500"},Bn=["min"],Tn={class:"grid grid-cols-2 gap-4"},Ln=["value"],Fn=["value"],Hn={class:"px-6 py-4 border-t border-gray-100 bg-gray-50 flex items-center justify-end gap-3"},In=["disabled"],Rn={key:0,class:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24"},Pn=ce({__name:"AgendaTerapeuta",props:{modoCoordinadora:{type:Boolean,default:!1},mostrarFiltroTerapeuta:{type:Boolean,default:!1}},setup(d){const M=d,{citas:c,loading:h,error:b,citasConBonoProximoAgotar:p,lastUpdateTime:y,moveAppointment:D,changeAppointmentStatus:E,loadTerapeutaAppointments:A,loadAllAppointments:R,refreshAppointments:g}=Vt(),{completarCita:k,obtenerHistorialBono:P,verificarBonoCitas:z}=bt(),S=mt(),v={success:r=>{console.info("[SUCCESS]",r)},error:r=>{console.error("[ERROR]",r),alert(r)},info:r=>{console.info("[INFO]",r)}},f=$("hoy"),H=$("calendario"),W=$(new Date),he=$(!1),K=$(null),xe=$([]),te=$(null),ke=$(!1),ye=$(null),Me=$([]),ue=$(["pendiente","confirmada","realizada","cancelada"]),X=$(""),Ee=F(()=>!M.modoCoordinadora||!ye.value?c.value:c.value.filter(r=>r.terapeuta?.id===ye.value)),ze=F(()=>ue.value.length===0?[]:Ee.value.filter(r=>ue.value.includes(r.estado))),Ce=F(()=>{if(!X.value.trim())return ze.value;const r=X.value.toLowerCase().trim();return ze.value.filter(t=>{const w=(t.paciente_nombre||t.paciente?.nombre_completo||"").toLowerCase(),O=(t.terapeuta_nombre||t.terapeuta?.nombre_completo||"").toLowerCase(),Y=(t.observaciones||"").toLowerCase(),i=(t.modalidad||"").toLowerCase();return w.includes(r)||O.includes(r)||Y.includes(r)||i.includes(r)})}),re=F(()=>Ce.value),ve=$(null),l=$(null),n=$(!1),x=$(null),m=$(null),B=$(null),T=$(!1),L=$(null),V=$(null),me=$(null),Be=$(null),ee=$(!1),ne=$(null),ae=["11:00","12:00","13:00","17:00","18:00","19:00","20:00","21:00","22:00"],Ue=F(()=>{const r=new Date(W.value),t=r.getDay(),w=t===0?-6:1-t;r.setDate(r.getDate()+w);const O=[];for(let Y=0;Y<7;Y++){const i=new Date(r);i.setDate(r.getDate()+Y),O.push({fecha:i.toISOString().split("T")[0],nombreDia:i.toLocaleDateString("es-ES",{weekday:"short"}),numeroDia:i.getDate(),mes:i.toLocaleDateString("es-ES",{month:"short"})})}return O}),Te=F(()=>{const r=re.value,t=new Date().toISOString().split("T")[0];switch(f.value){case"hoy":return r.filter(w=>w.fecha_cita===t);case"pendientes":return r.filter(w=>w.estado==="pendiente");case"completadas":return r.filter(w=>w.estado==="completada"||w.estado==="realizada");default:return r}}),Z=r=>r.substring(0,5),ft=r=>new Date(r+"T00:00:00").toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long",year:"numeric"}),qe=r=>r.toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long",year:"numeric"}),Ke=r=>({pendiente:"bg-amber-100 text-amber-700 border border-amber-200",confirmada:"bg-green-100 text-green-700 border border-green-200",completada:"bg-blue-100 text-blue-700 border border-blue-200",realizada:"bg-blue-100 text-blue-700 border border-blue-200",cancelada:"bg-red-100 text-red-700 border border-red-200"})[r]||"bg-gray-100 text-gray-700 border border-gray-200",Le=r=>{const t=new Date().toISOString().split("T")[0];return r===t},Ye=r=>{const t=new Date(W.value);H.value==="dia"?t.setDate(t.getDate()+r):t.setDate(t.getDate()+r*7),W.value=t},Ge=()=>{W.value=new Date},$e=r=>{const t=W.value.toISOString().split("T")[0];return re.value.filter(w=>w.fecha_cita===t&&w.hora_inicio?.startsWith(r))},We=r=>({pendiente:"bg-yellow-100 border-l-4 border-yellow-500",confirmada:"bg-green-100 border-l-4 border-green-500",completada:"bg-blue-100 border-l-4 border-blue-500",realizada:"bg-blue-100 border-l-4 border-blue-500",cancelada:"bg-red-100 border-l-4 border-red-500"})[r]||"bg-gray-100 border-l-4 border-gray-500",Je=r=>({pendiente:"Pendiente",confirmada:"Confirmada",completada:"Completada",realizada:"Realizada",cancelada:"Cancelada"})[r]||r,ht=r=>r===0?"text-red-600 font-bold":r===1?"text-orange-600 font-semibold":r<=2?"text-yellow-600 font-medium":"text-green-600",De=(r,t)=>re.value.filter(w=>w.fecha_cita===r&&w.hora_inicio?.startsWith(t)),Fe=r=>{ie.clickCreate(r.date,r.horaInicio),x.value=r.date,m.value=r.horaInicio,n.value=!0,v.info(`Click en ${r.date} a las ${r.horaInicio}`)},xt=async()=>{n.value=!1,x.value=null,m.value=null,await g(),v.success("Cita creada exitosamente")},yt=()=>{n.value=!1,x.value=null,m.value=null,B.value=null,ne.value=null},we=r=>{L.value=r,T.value=!0},wt=()=>{T.value=!1,setTimeout(()=>{L.value=null},300)},Ze=async()=>{await g(),v.success("Cita actualizada correctamente")},Qe=async r=>{if(!V.value){V.value=r;try{const t=await E(r,"confirmada");t.success?v.success("‚úì Cita confirmada"):v.error(t.error||"Error al confirmar la cita")}catch(t){console.error("Error al confirmar cita:",t),v.error("Error al confirmar la cita")}finally{V.value=null}}},oe=$(null),pe=$(null),se=$(null),je=$(!1),Q=$(null),ge=$(""),le=$(""),be=$(""),_t=F(()=>{if(!le.value)return ae;const r=ae.indexOf(le.value);return r===-1?ae:[...ae.slice(r+1),"23:00"]}),Xe=async r=>{if(!se.value){se.value=r;try{const t=await E(r,"realizada");t.success?v.success("‚úì Cita marcada como realizada"):v.error(t.error||"Error al marcar como realizada")}catch(t){console.error("Error al marcar cita como realizada:",t),v.error("Error al marcar como realizada")}finally{se.value=null}}},et=async r=>{if(!(oe.value||!confirm("¬øEst√°s seguro de que deseas cancelar esta cita?"))){oe.value=r;try{const w=await E(r,"cancelada");w.success?v.success("‚úì Cita cancelada"):v.error(w.error||"Error al cancelar la cita")}catch(w){console.error("Error al cancelar cita:",w),v.error("Error al cancelar la cita")}finally{oe.value=null}}},tt=r=>{const t=c.value.find(w=>w.id===r);if(!t){v.error("Cita no encontrada");return}Q.value=t,ge.value=t.fecha_cita,le.value=Z(t.hora_inicio),be.value=Z(t.hora_fin),je.value=!0},kt=async(r,t,w)=>{if(Q.value){pe.value=Q.value.id;try{const O=await D(Q.value.id,r,t,w);O.success?(v.success("‚úì Cita reprogramada"),je.value=!1,Q.value=null):v.error(O.error||"Error al reprogramar la cita")}catch(O){console.error("Error al reprogramar cita:",O),v.error("Error al reprogramar la cita")}finally{pe.value=null}}},He=()=>{je.value=!1,Q.value=null,ge.value="",le.value="",be.value=""},Ct=async()=>{if(Q.value){if(!ge.value||!le.value||!be.value){v.error("Por favor completa todos los campos");return}await kt(ge.value,le.value,be.value)}},$t=(r,t,w)=>{ve.value||De(r,t).length>0||(w.preventDefault(),ee.value=!0,ne.value={fechaInicio:r,horaInicio:t,fechaFin:r,horaFin:t},ie.debug("range_select","Iniciando selecci√≥n de rango",{fecha:r,hora:t}))},Dt=(r,t)=>{!ee.value||!ne.value||(ne.value.fechaFin=r,ne.value.horaFin=t)},at=r=>{if(!ee.value||!ne.value)return;r.preventDefault(),ee.value=!1;const{fechaInicio:t,horaInicio:w,fechaFin:O,horaFin:Y}=ne.value,i=At(Y,60);ie.debug("range_select","Rango seleccionado",{fechaInicio:t,horaInicio:w,fechaFin:O,horaFin:i}),x.value=t,m.value=w,B.value=i,n.value=!0,v.info(`Rango seleccionado: ${w} - ${i}`),setTimeout(()=>{ne.value=null},100)},At=(r,t)=>{const[w,O]=r.split(":").map(Number),Y=w*60+O+t,i=Math.floor(Y/60),I=Y%60;return`${String(i).padStart(2,"0")}:${String(I).padStart(2,"0")}`},St=(r,t)=>{if(!ne.value)return!1;const{fechaInicio:w,horaInicio:O,fechaFin:Y,horaFin:i}=ne.value;if(r===w&&r===Y){const I=ae.indexOf(t),a=ae.indexOf(O),N=ae.indexOf(i);if(I===-1||a===-1||N===-1)return!1;const Ft=Math.min(a,N),Ht=Math.max(a,N);return I>=Ft&&I<=Ht}return!1},ot=(r,t)=>{ve.value=t,r.dataTransfer&&(r.dataTransfer.effectAllowed="move",r.dataTransfer.setData("text/html",r.target.innerHTML)),r.target.style.opacity="0.5"},st=r=>{r.target.style.opacity="1",ve.value=null,l.value=null},Mt=(r,t,w)=>{r.preventDefault(),r.dataTransfer&&(r.dataTransfer.dropEffect="move"),l.value={fecha:t,hora:w}},zt=r=>{l.value=null},jt=(r,t)=>l.value?.fecha===r&&l.value?.hora===t,Et=async(r,t,w)=>{if(r.preventDefault(),!ve.value){ie.warn("drag_end","No hay cita arrastrada",{fecha:t,hora:w});return}const O=ve.value,Y=O.id,i=t,I=w;me.value="moving",Be.value=Y,ie.dragStart(Y,{date:O.fecha_cita,time:O.hora_inicio});try{const a=await D(Y,i,I);a.success?(v.success("Cita movida exitosamente"),ie.dragEnd(Y,{date:i,time:I},!0)):(v.error(a.error||"No se pudo mover la cita"),ie.dragEnd(Y,{date:i,time:I},!1))}catch(a){console.error("[DROP] Error inesperado:",a),v.error("Error inesperado al mover la cita"),ie.apiError("onDrop",a)}finally{ve.value=null,l.value=null,me.value=null,Be.value=null}},Bt=async r=>{if(confirm("¬øEst√°s seguro de marcar esta cita como completada?"))try{(await k(r)).success&&console.log("Cita completada")}catch(t){console.error("Error al completar cita:",t)}},Tt=async r=>{try{ke.value=!0,K.value=r,he.value=!0;const[t,w]=await Promise.all([P(r),z(r)]);xe.value=t,te.value=w}catch(t){console.error("Error al cargar historial:",t)}finally{ke.value=!1}},Ie=()=>{he.value=!1,K.value=null,xe.value=[],te.value=null},rt=async()=>{try{await g(),v.success("Agenda actualizada")}catch(r){console.error("Error al recargar citas:",r),v.error("Error al actualizar la agenda")}},Lt=async()=>{if(M.modoCoordinadora)try{const{data:r,error:t}=await S.from("terapeutas").select("id, nombre_completo").eq("activo",!0).order("nombre_completo",{ascending:!0});if(t){console.error("Error al cargar terapeutas:",t);return}Me.value=(r||[]).map(w=>({id:w.id,nombre:w.nombre_completo}))}catch(r){console.error("Error al cargar terapeutas:",r)}},Re=r=>{ue.value=r,ie.debug("filter_change","Filtros de estado actualizados",{estados:r})};return Pt(async()=>{M.modoCoordinadora?(await R(),await Lt()):await A(),document.addEventListener("mouseup",at)}),pt(()=>{document.removeEventListener("mouseup",at)}),(r,t)=>{const w=gt,O=Nt,Y=Ot;return o(),s("div",{class:C(["agenda-layout",{"modo-coordinadora":d.modoCoordinadora}])},[d.modoCoordinadora?(o(),s(U,{key:0},[q(Qo,{vista:H.value,"fecha-actual":W.value,loading:j(h),"modo-coordinadora":!0,onCambiarVista:t[0]||(t[0]=i=>H.value=i),onNavegarFecha:Ye,onIrHoy:Ge,onActualizar:rt,onNuevaCita:t[1]||(t[1]=i=>n.value=!0),onNuevaTarea:()=>{}},null,8,["vista","fecha-actual","loading"]),q(fs,{citas:j(c),"modo-coordinadora":!0,terapeutas:Me.value,"terapeuta-seleccionado":ye.value,"estados-activos":ue.value,busqueda:X.value,"onUpdate:busqueda":t[2]||(t[2]=i=>X.value=i),"onUpdate:terapeutaSeleccionado":t[3]||(t[3]=i=>ye.value=i),"onUpdate:estadosActivos":Re,onFiltrarEstados:Re},null,8,["citas","terapeutas","terapeuta-seleccionado","estados-activos","busqueda"])],64)):(o(),s(U,{key:1},[e("div",hs,[q(yo,{titulo:"Mi Agenda",subtitulo:"Tus citas programadas","rol-activo":"terapeuta","mostrar-rol":!1})]),e("div",xs,[q(Ro,{vista:H.value,"fecha-actual":W.value,loading:j(h),"last-update-time":j(y),onCambiarVista:t[4]||(t[4]=i=>H.value=i),onNavegarFecha:Ye,onIrHoy:Ge,onActualizar:rt},null,8,["vista","fecha-actual","loading","last-update-time"])]),e("div",ys,[e("div",ws,[t[14]||(t[14]=e("label",{for:"buscar-citas",class:"sr-only"},"Buscar paciente o cita",-1)),t[15]||(t[15]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("svg",{class:"h-4 w-4 text-neutral-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1)),Ae(e("input",{id:"buscar-citas","onUpdate:modelValue":t[5]||(t[5]=i=>X.value=i),type:"search",placeholder:"Buscar por paciente o nota...",class:"block w-full pl-10 pr-4 py-2.5 bg-white border border-neutral-200 rounded-xl text-sm text-neutral-800 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-teal-500/30 focus:border-teal-500 transition-all","aria-label":"Buscar paciente o cita"},null,512),[[Oe,X.value]]),X.value?(o(),s("button",{key:0,onClick:t[6]||(t[6]=i=>X.value=""),class:"absolute inset-y-0 right-0 pr-3 flex items-center text-neutral-400 hover:text-neutral-600","aria-label":"Limpiar b√∫squeda"},[...t[13]||(t[13]=[e("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])):_("",!0)]),X.value?(o(),s("div",_s,[e("span",ks,u(re.value.length)+" resultado"+u(re.value.length!==1?"s":"")+" para ",1),e("span",Cs,' "'+u(X.value)+'" ',1)])):_("",!0),q(ao,{citas:j(c),"estados-activos":ue.value,onFiltrar:Re},null,8,["citas","estados-activos"])])],64)),j(p).length>0?(o(),s("div",$s,[e("div",Ds,[t[17]||(t[17]=e("div",{class:"w-10 h-10 rounded-xl bg-gradient-to-br from-[#F2B33D] to-[#F2B33D]/70 flex items-center justify-center flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-white",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})])],-1)),e("div",As,[e("p",Ss," Atenci√≥n: "+u(j(p).length)+" paciente(s) con pocas sesiones restantes ",1),t[16]||(t[16]=e("p",{class:"text-xs text-amber-700 mt-1"}," Considera informar a estos pacientes para renovar sus bonos ",-1))])])])):_("",!0),H.value==="dia"?(o(),s("div",Ms,[e("div",zs,[e("div",js,[e("div",null,[e("h3",Es,u(qe(W.value)),1),e("p",Bs,u($e?Object.values(ae).reduce((i,I)=>i+$e(I).length,0):0)+" citas programadas ",1)])])]),e("div",Ts,[Te.value.length===0?(o(),s("div",Ls,[e("div",Fs,[t[18]||(t[18]=e("div",{class:"w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-br from-[#027368]/10 to-[#04BF9D]/10 flex items-center justify-center"},[e("svg",{class:"w-8 h-8 text-[#027368]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1)),t[19]||(t[19]=e("h3",{class:"font-['Elms_Sans'] font-medium text-neutral-800 mb-2"},"No hay citas programadas",-1)),e("p",Hs,u(qe(W.value))+" est√° libre",1)])])):(o(),s("div",Is,[(o(),s(U,null,J(ae,(i,I)=>e("div",{key:i,"data-hora":i,class:"flex hover:bg-neutral-50/50 transition-colors"},[e("div",Ps,u(i),1),e("div",{class:"flex-1 p-3 cursor-pointer hover:bg-[#027368]/5 transition-colors relative group/cell",onClick:a=>$e(i).length===0?Fe({date:W.value.toISOString().split("T")[0],horaInicio:i}):null},[$e(i).length===0?(o(),s("button",{key:0,class:"absolute right-3 top-1/2 -translate-y-1/2 w-7 h-7 rounded-full bg-[#027368] text-white flex items-center justify-center opacity-0 group-hover/cell:opacity-100 transition-all hover:bg-[#025a52] hover:scale-110 shadow-sm",onClick:G(a=>Fe({date:W.value.toISOString().split("T")[0],horaInicio:i}),["stop"]),title:"Crear nueva cita","aria-label":"Crear nueva cita a las {{ hora }}"},[...t[20]||(t[20]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])],8,Ns)):_("",!0),(o(!0),s(U,null,J($e(i),a=>(o(),s("div",{key:a.id,draggable:"true",onDragstart:N=>ot(N,a),onDragend:t[7]||(t[7]=N=>st(N)),class:C(["mb-2 p-3 rounded-xl transition-all hover:shadow-md hover:ring-2 hover:ring-[#027368]/30 group relative backdrop-blur-sm",[We(a.estado),V.value===a.id?"opacity-60 pointer-events-none":"cursor-pointer"]]),role:"button",tabindex:"0","aria-label":`Cita ${a.estado} de ${a.paciente_nombre||"paciente"}, ${Z(a.hora_inicio)} a ${Z(a.hora_fin)}, ${a.modalidad}${a.estado==="pendiente"?". Pulsa para ver detalles o confirmar.":". Pulsa para ver detalles."}`,title:`${a.paciente_nombre||"Sin paciente"} - ${Z(a.hora_inicio)} a ${Z(a.hora_fin)}. Click para ver detalles.`,onClick:G(N=>we(a.id),["stop"]),onKeydown:[_e(G(N=>we(a.id),["stop"]),["enter"]),_e(G(N=>we(a.id),["prevent","stop"]),["space"])]},[e("div",Us,[a.estado==="pendiente"?(o(),s("button",{key:0,onClick:G(N=>Qe(a.id),["stop"]),class:C(["w-6 h-6 rounded-full bg-emerald-500 text-white flex items-center justify-center hover:bg-emerald-600 hover:scale-110 shadow-sm transition-all",{"animate-pulse":V.value===a.id}]),disabled:V.value===a.id,title:V.value===a.id?"Confirmando...":"Confirmar cita","aria-label":`Confirmar cita de ${a.paciente_nombre||"paciente"}`,type:"button"},[V.value===a.id?(o(),s("svg",Ks,[...t[21]||(t[21]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"},null,-1)])])):(o(),s("svg",Ys,[...t[22]||(t[22]=[e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)])]))],10,qs)):_("",!0),a.estado==="confirmada"||a.estado==="pendiente"?(o(),s("button",{key:1,onClick:G(N=>Xe(a.id),["stop"]),class:C(["w-6 h-6 rounded-full bg-blue-500 text-white flex items-center justify-center hover:bg-blue-600 hover:scale-110 shadow-sm transition-all",{"animate-pulse":se.value===a.id}]),disabled:se.value===a.id,title:se.value===a.id?"Marcando...":"Marcar como realizada","aria-label":`Marcar como realizada cita de ${a.paciente_nombre||"paciente"}`,type:"button"},[se.value===a.id?(o(),s("svg",Ws,[...t[23]||(t[23]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"},null,-1)])])):(o(),s("svg",Js,[...t[24]||(t[24]=[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"},null,-1)])]))],10,Gs)):_("",!0),a.estado!=="cancelada"?(o(),s("button",{key:2,onClick:G(N=>tt(a.id),["stop"]),class:"w-6 h-6 rounded-full bg-indigo-500 text-white flex items-center justify-center hover:bg-indigo-600 hover:scale-110 shadow-sm transition-all",disabled:pe.value===a.id,title:"Reprogramar cita","aria-label":`Reprogramar cita de ${a.paciente_nombre||"paciente"}`,type:"button"},[...t[25]||(t[25]=[e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)])],8,Zs)):_("",!0),a.estado!=="cancelada"&&a.estado!=="completada"&&a.estado!=="realizada"?(o(),s("button",{key:3,onClick:G(N=>et(a.id),["stop"]),class:C(["w-6 h-6 rounded-full bg-red-500 text-white flex items-center justify-center hover:bg-red-600 hover:scale-110 shadow-sm transition-all",{"animate-pulse":oe.value===a.id}]),disabled:oe.value===a.id,title:oe.value===a.id?"Cancelando...":"Cancelar cita","aria-label":`Cancelar cita de ${a.paciente_nombre||"paciente"}`,type:"button"},[oe.value===a.id?(o(),s("svg",Xs,[...t[26]||(t[26]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"},null,-1)])])):(o(),s("svg",er,[...t[27]||(t[27]=[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"},null,-1)])]))],10,Qs)):_("",!0)]),e("div",tr,[e("div",ar,[q(j(vt),{class:"w-4 h-4 text-neutral-500"})]),e("div",or,[e("p",sr,u(a.paciente_nombre||a.paciente?.nombre_completo||"Sin paciente"),1),e("div",rr,[e("span",nr,u(Z(a.hora_inicio))+" - "+u(Z(a.hora_fin)),1),e("span",lr,[a.modalidad==="online"?(o(),s("span",ir,"üíª")):(o(),s("span",dr,"üè•")),de(" "+u(a.modalidad==="online"?"Online":"Presencial"),1)]),a.bono_sesiones_restantes!==void 0&&a.bono_sesiones_restantes!==null?(o(),s("span",{key:0,class:C(["text-xs px-2 py-0.5 rounded-lg font-medium",{"bg-red-100 text-red-700":a.bono_sesiones_restantes===0,"bg-orange-100 text-orange-700":a.bono_sesiones_restantes===1,"bg-yellow-100 text-yellow-700":a.bono_sesiones_restantes===2,"bg-green-100 text-green-700":a.bono_sesiones_restantes>2}])},u(a.bono_sesiones_restantes)+"/"+u(a.bono_sesiones_totales||"?")+" sesiones ",3)):_("",!0)]),d.modoCoordinadora&&(a.terapeuta_nombre||a.terapeuta?.nombre_completo)?(o(),s("p",cr,[t[28]||(t[28]=e("span",null,"üë§",-1)),de(" "+u(a.terapeuta_nombre||a.terapeuta?.nombre_completo),1)])):_("",!0)]),e("div",ur,[e("span",{class:C(["text-xs px-2 py-1 rounded-lg font-medium whitespace-nowrap",Ke(a.estado)])},u(Je(a.estado)),3)])])],42,Os))),128))],8,Vs)],8,Rs)),64))]))])])):H.value==="calendario"?(o(),s("div",vr,[e("div",mr,[e("div",pr,[e("div",gr,[t[29]||(t[29]=e("div",{class:"p-2 border-r border-gray-200 bg-gray-50"},null,-1)),(o(!0),s(U,null,J(Ue.value,i=>(o(),s("div",{key:i.fecha,class:C(["p-2 text-center border-r border-gray-200 last:border-r-0",Le(i.fecha)?"bg-blue-50":"bg-white"])},[e("div",br,[e("span",fr,u(i.nombreDia),1),e("span",{class:C(["text-lg font-bold text-gray-900",Le(i.fecha)?"text-blue-600":""])},u(i.numeroDia),3)]),e("div",hr,u(i.mes),1)],2))),128))])]),e("div",xr,[e("div",yr,[(o(),s(U,null,J(ae,i=>e("div",{key:i,"data-hora":i,class:"grid grid-cols-8"},[e("div",_r,u(i),1),(o(!0),s(U,null,J(Ue.value,I=>(o(),s("div",{key:`${I.fecha}-${i}`,class:C(["p-2 border-r border-gray-100 last:border-r-0 hover:bg-blue-50/30 transition-colors min-h-[70px] cursor-pointer relative group/cell",[Le(I.fecha)?"bg-blue-50/20":"",jt(I.fecha,i)?"bg-blue-100 ring-2 ring-blue-500 ring-inset":"",St(I.fecha,i)?"bg-[#027368]/20 ring-2 ring-[#027368] ring-inset":""]]),onDragover:a=>Mt(a,I.fecha,i),onDragleave:t[9]||(t[9]=a=>zt()),onDrop:a=>Et(a,I.fecha,i),onMousedown:a=>De(I.fecha,i).length===0?$t(I.fecha,i,a):null,onMouseenter:a=>Dt(I.fecha,i),onClick:a=>De(I.fecha,i).length===0&&!ee.value?Fe({date:I.fecha,horaInicio:i}):null},[De(I.fecha,i).length===0?(o(),s("div",Cr,[e("div",{class:"w-6 h-6 rounded-full bg-teal-500/90 text-white flex items-center justify-center shadow-md transform scale-90 group-hover/cell:scale-100 transition-transform",title:`Crear cita el ${I.nombreDia} ${I.numeroDia} a las ${i}`},[...t[30]||(t[30]=[e("svg",{class:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2.5"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1)])],8,$r)])):_("",!0),(o(!0),s(U,null,J(De(I.fecha,i),a=>(o(),s("div",{key:a.id,draggable:"true",onDragstart:N=>ot(N,a),onDragend:t[8]||(t[8]=N=>st(N)),class:C(["text-xs p-2 rounded-lg mb-1.5 hover:shadow-lg hover:ring-2 hover:ring-teal-400 transition-all group relative border-l-3",[We(a.estado),V.value===a.id?"opacity-60 pointer-events-none":"cursor-pointer"]]),role:"button",tabindex:"0","aria-label":`Cita ${a.estado} de ${a.paciente_nombre||"paciente"}, ${Z(a.hora_inicio)} a ${Z(a.hora_fin)}, ${a.modalidad}${a.estado==="pendiente"?". Pulsa para ver detalles o confirmar.":". Pulsa para ver detalles."}`,title:`${a.paciente_nombre||"Sin paciente"} - ${Z(a.hora_inicio)} a ${Z(a.hora_fin)}. Click para ver detalles.`,onClick:G(N=>we(a.id),["stop"]),onKeydown:[_e(G(N=>we(a.id),["stop"]),["enter"]),_e(G(N=>we(a.id),["prevent","stop"]),["space"])]},[e("div",Ar,[a.estado==="pendiente"?(o(),s("button",{key:0,onClick:G(N=>Qe(a.id),["stop"]),class:C(["w-5 h-5 rounded-full bg-emerald-500 text-white flex items-center justify-center hover:bg-emerald-600 hover:scale-110 shadow-sm transition-all",{"animate-pulse":V.value===a.id}]),disabled:V.value===a.id,title:V.value===a.id?"Confirmando...":"Confirmar cita","aria-label":`Confirmar cita de ${a.paciente_nombre||"paciente"}`,type:"button"},[V.value===a.id?(o(),s("svg",Mr,[...t[31]||(t[31]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"},null,-1)])])):(o(),s("svg",zr,[...t[32]||(t[32]=[e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)])]))],10,Sr)):_("",!0),a.estado==="confirmada"||a.estado==="pendiente"?(o(),s("button",{key:1,onClick:G(N=>Xe(a.id),["stop"]),class:C(["w-5 h-5 rounded-full bg-blue-500 text-white flex items-center justify-center hover:bg-blue-600 hover:scale-110 shadow-sm transition-all",{"animate-pulse":se.value===a.id}]),disabled:se.value===a.id,title:se.value===a.id?"Marcando...":"Marcar como realizada","aria-label":`Marcar como realizada cita de ${a.paciente_nombre||"paciente"}`,type:"button"},[se.value===a.id?(o(),s("svg",Er,[...t[33]||(t[33]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"},null,-1)])])):(o(),s("svg",Br,[...t[34]||(t[34]=[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"},null,-1)])]))],10,jr)):_("",!0),a.estado!=="cancelada"?(o(),s("button",{key:2,onClick:G(N=>tt(a.id),["stop"]),class:"w-5 h-5 rounded-full bg-indigo-500 text-white flex items-center justify-center hover:bg-indigo-600 hover:scale-110 shadow-sm transition-all",disabled:pe.value===a.id,title:"Reprogramar cita","aria-label":`Reprogramar cita de ${a.paciente_nombre||"paciente"}`,type:"button"},[...t[35]||(t[35]=[e("svg",{class:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)])],8,Tr)):_("",!0),a.estado!=="cancelada"&&a.estado!=="completada"&&a.estado!=="realizada"?(o(),s("button",{key:3,onClick:G(N=>et(a.id),["stop"]),class:C(["w-5 h-5 rounded-full bg-red-500 text-white flex items-center justify-center hover:bg-red-600 hover:scale-110 shadow-sm transition-all",{"animate-pulse":oe.value===a.id}]),disabled:oe.value===a.id,title:oe.value===a.id?"Cancelando...":"Cancelar cita","aria-label":`Cancelar cita de ${a.paciente_nombre||"paciente"}`,type:"button"},[oe.value===a.id?(o(),s("svg",Fr,[...t[36]||(t[36]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"},null,-1)])])):(o(),s("svg",Hr,[...t[37]||(t[37]=[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"},null,-1)])]))],10,Lr)):_("",!0),e("div",Ir,[q(j(vt),{class:"w-3 h-3 text-gray-500"})])]),e("div",Rr,[e("p",Pr,u(a.paciente_nombre||a.paciente?.nombre_completo||"Sin paciente"),1),e("p",Vr,u(Z(a.hora_inicio))+" ‚Äì "+u(Z(a.hora_fin)),1),e("div",Nr,[e("span",Or,[a.modalidad==="online"?(o(),s("span",Ur,"üíª")):a.modalidad==="presencial"?(o(),s("span",qr,"üè•")):(o(),s("span",Kr,"üìû")),e("span",Yr,u(a.modalidad),1)]),e("span",{class:C(["text-[10px] px-1.5 py-0.5 rounded-full font-semibold",Ke(a.estado)])},u(Je(a.estado)),3),a.bono_id?(o(),s("span",{key:0,class:"text-[10px] px-1.5 py-0.5 rounded bg-emerald-100 text-emerald-700 font-medium",title:`Bono: ${a.bono_sesiones_restantes||0}/${a.bono_sesiones_totales||0} sesiones`}," üé´ "+u(a.bono_sesiones_restantes||0),9,Gr)):_("",!0)]),d.modoCoordinadora&&(a.terapeuta_nombre||a.terapeuta?.nombre_completo)?(o(),s("p",Wr," üë§ "+u(a.terapeuta_nombre||a.terapeuta?.nombre_completo),1)):_("",!0)])],42,Dr))),128))],42,kr))),128))],8,wr)),64))])])])])):(o(),s("div",Jr,[e("div",Zr,[(o(!0),s(U,null,J([{key:"hoy",label:"Hoy",count:re.value.filter(i=>i.fecha_cita===new Date().toISOString().split("T")[0]).length},{key:"pendientes",label:"Pendientes",count:re.value.filter(i=>i.estado==="pendiente").length},{key:"completadas",label:"Completadas",count:re.value.filter(i=>i.estado==="completada"||i.estado==="realizada").length},{key:"todas",label:"Todas",count:re.value.length}],i=>(o(),s("button",{key:i.key,onClick:I=>f.value=i.key,class:C(["px-4 py-2 rounded-lg font-medium transition-colors",f.value===i.key?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50 border border-gray-300"])},u(i.label)+" ("+u(i.count)+") ",11,Qr))),128))]),j(b)?(o(),s("div",Xr,[e("p",en,u(j(b)),1)])):_("",!0),j(h)&&j(c).length===0?(o(),s("div",tn,[...t[38]||(t[38]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"},null,-1),e("p",{class:"text-gray-600"},"Cargando citas...",-1)])])):Te.value.length===0?(o(),s("div",an,[t[39]||(t[39]=e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),t[40]||(t[40]=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay citas",-1)),e("p",on,u(f.value==="hoy"?"No tienes citas programadas para hoy.":"No hay citas en esta categor√≠a."),1)])):(o(),s("div",sn,[(o(!0),s(U,null,J(Te.value,i=>(o(),Se(w,{key:i.id,cita:i,onCompletar:Bt,onVerHistorial:Tt},null,8,["cita"]))),128))]))])),(o(),Se(it,{to:"body"},[he.value?(o(),s("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:G(Ie,["self"])},[e("div",rn,[e("div",{class:"px-6 py-4 border-b border-gray-200 flex items-center justify-between"},[t[42]||(t[42]=e("h2",{class:"text-xl font-bold text-gray-900"},"Historial del Bono",-1)),e("button",{onClick:Ie,class:"text-gray-400 hover:text-gray-600 transition-colors"},[...t[41]||(t[41]=[e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",nn,[ke.value?(o(),s("div",ln,[...t[43]||(t[43]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"},null,-1)])])):(o(),s("div",dn,[te.value?(o(),s("div",cn,[t[47]||(t[47]=e("h3",{class:"font-semibold text-gray-900 mb-3"},"Resumen",-1)),e("div",un,[e("div",null,[e("p",vn,u(te.value.bono.sesiones_totales),1),t[44]||(t[44]=e("p",{class:"text-xs text-gray-600"},"Sesiones Totales",-1))]),e("div",null,[e("p",mn,u(te.value.bono.sesiones_usadas),1),t[45]||(t[45]=e("p",{class:"text-xs text-gray-600"},"Sesiones Usadas",-1))]),e("div",null,[e("p",{class:C(["text-2xl font-bold",ht(te.value.bono.sesiones_restantes)])},u(te.value.bono.sesiones_restantes),3),t[46]||(t[46]=e("p",{class:"text-xs text-gray-600"},"Sesiones Restantes",-1))])]),te.value.alerta?(o(),s("div",pn,u(te.value.mensaje_alerta),1)):_("",!0)])):_("",!0),e("div",null,[t[48]||(t[48]=e("h3",{class:"font-semibold text-gray-900 mb-3"},"Movimientos",-1)),xe.value.length===0?(o(),s("div",gn," No hay movimientos registrados ")):(o(),s("div",bn,[(o(!0),s(U,null,J(xe.value,i=>(o(),s("div",{key:i.id,class:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors"},[e("div",fn,[e("div",hn,[e("div",xn,[e("span",{class:C(["px-2 py-1 text-xs font-medium rounded",i.tipo_movimiento==="descuento"?"bg-red-100 text-red-700":i.tipo_movimiento==="reembolso"?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"])},u(i.tipo_movimiento),3),e("span",yn,u(new Date(i.fecha).toLocaleString("es-ES")),1)]),e("p",wn,u(i.motivo),1)]),e("div",_n,[e("p",kn,u(i.sesiones_antes)+" ‚Üí "+u(i.sesiones_despues),1),e("p",{class:C(["text-xs font-medium",i.sesiones_modificadas>0?"text-red-600":"text-green-600"])},u(i.sesiones_modificadas>0?"-":"+")+u(Math.abs(i.sesiones_modificadas)),3)])])]))),128))]))])]))]),e("div",{class:"px-6 py-4 border-t border-gray-200 flex justify-end"},[e("button",{onClick:Ie,class:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors"}," Cerrar ")])])])):_("",!0)])),q(O,{"is-open":n.value,"fecha-inicial":x.value||void 0,"hora-inicial":m.value||void 0,"hora-final":B.value||void 0,onCreated:xt,onClose:yt},null,8,["is-open","fecha-inicial","hora-inicial","hora-final"]),q(Y,{"cita-id":L.value,onClose:wt,onCitaActualizada:Ze,onActualizado:Ze},null,8,["cita-id"]),(o(),Se(it,{to:"body"},[je.value&&Q.value?(o(),s("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:G(He,["self"])},[e("div",Cn,[e("div",$n,[e("div",Dn,[e("div",null,[t[49]||(t[49]=e("h2",{class:"text-lg font-semibold text-gray-900"},"Reprogramar Cita",-1)),e("p",An,u(Q.value.paciente_nombre||Q.value.paciente?.nombre_completo||"Paciente"),1)]),e("button",{onClick:He,class:"w-8 h-8 rounded-full bg-white/80 flex items-center justify-center text-gray-400 hover:text-gray-600 hover:bg-white transition-all"},[...t[50]||(t[50]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),e("div",Sn,[e("div",Mn,[t[52]||(t[52]=e("p",{class:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-2"},"Cita actual",-1)),e("div",zn,[t[51]||(t[51]=e("div",{class:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1)),e("div",null,[e("p",jn,u(ft(Q.value.fecha_cita)),1),e("p",En,u(Z(Q.value.hora_inicio))+" - "+u(Z(Q.value.hora_fin)),1)])])]),e("div",null,[t[53]||(t[53]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Nueva fecha",-1)),Ae(e("input",{type:"date","onUpdate:modelValue":t[10]||(t[10]=i=>ge.value=i),min:new Date().toISOString().split("T")[0],class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 transition-all"},null,8,Bn),[[Oe,ge.value]])]),e("div",Tn,[e("div",null,[t[54]||(t[54]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Hora inicio",-1)),Ae(e("select",{"onUpdate:modelValue":t[11]||(t[11]=i=>le.value=i),class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 transition-all"},[(o(),s(U,null,J(ae,i=>e("option",{key:i,value:i},u(i),9,Ln)),64))],512),[[dt,le.value]])]),e("div",null,[t[55]||(t[55]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Hora fin",-1)),Ae(e("select",{"onUpdate:modelValue":t[12]||(t[12]=i=>be.value=i),class:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 transition-all"},[(o(!0),s(U,null,J(_t.value,i=>(o(),s("option",{key:i,value:i},u(i),9,Fn))),128))],512),[[dt,be.value]])])])]),e("div",Hn,[e("button",{onClick:He,class:"px-5 py-2.5 text-gray-700 font-medium rounded-xl hover:bg-gray-100 transition-colors"}," Cancelar "),e("button",{onClick:Ct,disabled:!ge.value||!le.value||!be.value||pe.value,class:"px-5 py-2.5 bg-blue-600 text-white font-medium rounded-xl hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2"},[pe.value?(o(),s("svg",Rn,[...t[56]||(t[56]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"},null,-1)])])):_("",!0),de(" "+u(pe.value?"Reprogramando...":"Confirmar"),1)],8,In)])])])):_("",!0)]))],2)}}}),Vn=Object.assign(fe(Pn,[["__scopeId","data-v-54ce6a32"]]),{__name:"AgendaTerapeuta"}),Nn={class:"p-6 max-w-7xl mx-auto"},On={class:"mb-8"},Un={class:"text-xl font-bold mb-4"},qn={class:"space-y-4"},fl=ce({__name:"ejemplo-agenda",setup(d){const{citas:M,citasDelDia:c}=bt();return(h,b)=>{const p=_a,y=gt,D=Vn;return o(),s("div",Nn,[b[2]||(b[2]=e("h1",{class:"text-3xl font-bold mb-6"},"Dashboard - Ejemplo",-1)),q(p,{citas:j(M),class:"mb-8"},null,8,["citas"]),e("section",On,[e("h2",Un,"Citas de Hoy ("+u(j(c).length)+")",1),e("div",qn,[(o(!0),s(U,null,J(j(c),E=>(o(),Se(y,{key:E.id,cita:E,onCompletar:b[0]||(b[0]=A=>console.log("Completar:",A)),onVerHistorial:b[1]||(b[1]=A=>console.log("Historial:",A))},null,8,["cita"]))),128))])]),q(D)])}}});export{fl as default};
