import{H as Ne,r as u,q as I,C as Re,f as Ve,c as d,a as t,E as L,g as v,t as l,k as n,y as f,j as P,z as xe,l as X,h as Be,v as qe,F as h,s as b,i as $,b as he,o as i,V as We}from"#entry";import{_ as Ue}from"./03NUMCcA.js";import{M as Ye}from"./JG5qHoIo.js";import{_ as Ge}from"./typwfSRi.js";import{_ as Je}from"./C4oGUV45.js";import{u as Ke}from"./Cy0_MzJF.js";import{u as Qe}from"./DJWGcah7.js";import{r as Xe}from"./BqC9m6KG.js";import{r as Ze}from"./CQZt9cKZ.js";import"./C9M7zbam.js";import"./Bi0YyG7H.js";import"./mZ3toP8Y.js";import"./DRclOuRO.js";import"./B5My0XuL.js";import"./G1mM6o1b.js";import"./BreoAuwB.js";import"./Byc3y-S3.js";import"./BaRJRhc1.js";import"./DlAUqK2U.js";import"./DWNj0d99.js";import"./Dyh9f5zH.js";const et={class:"space-y-3"},tt={class:"bg-white rounded-lg shadow-sm border border-gray-100 p-2.5"},ot={class:"flex items-center justify-between gap-3 mb-2"},at={class:"flex items-center gap-3"},st={class:"text-xs text-gray-500"},rt={class:"flex items-center gap-2"},nt={class:"flex bg-gray-100 rounded-lg p-0.5"},it={class:"flex items-center gap-1"},lt={class:"flex flex-wrap gap-2"},dt={key:0,class:"bg-white rounded-lg shadow-sm border border-gray-100 p-8"},ct={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden flex flex-col",style:{height:"calc(100vh - 180px)"}},ut={class:"sticky top-0 z-10 bg-white border-b border-gray-200 shadow-sm p-2.5"},pt={class:"flex items-center justify-between"},gt={class:"font-semibold text-base text-cafe"},vt={class:"text-xs text-gray-500 mt-0.5"},ft={class:"text-xs text-gray-600"},mt={class:"font-medium"},xt={class:"flex-1 overflow-y-auto"},ht={class:"divide-y divide-gray-100"},bt=["data-hora"],yt={class:"w-16 p-2 text-xs font-medium text-gray-600 border-r border-gray-100 bg-gray-50 flex-shrink-0"},_t=["onClick","onDragover","onDrop"],wt={key:0,class:"absolute inset-0 flex items-center justify-center opacity-0 group-hover/cell:opacity-100 transition-opacity pointer-events-none"},Ct=["onDragstart"],kt={class:"flex items-start justify-between gap-2"},Dt={class:"opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0"},St=["onClick"],Mt={class:"font-medium text-xs"},$t={class:"flex items-center gap-1.5 mt-0.5"},Et={class:"text-[10px] text-gray-600"},It={class:"text-[10px] px-1.5 py-0.5 rounded-full bg-white/50"},Tt={class:"flex items-center gap-1.5"},zt=["onClick"],Ot={key:1,class:"text-[10px] text-gray-400 italic"},jt={key:2,class:"bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden flex flex-col",style:{height:"calc(100vh - 180px)"}},Ft={class:"min-w-[800px] overflow-x-auto flex-1 flex flex-col"},At={class:"sticky top-0 z-10 bg-white border-b border-gray-200 shadow-sm"},Ht={class:"grid grid-cols-8"},Lt={class:"flex items-center justify-center gap-1"},Pt={class:"text-[10px] font-medium text-gray-600 uppercase"},Nt={class:"text-[10px] text-gray-500"},Rt={class:"flex-1 overflow-y-auto"},Vt={class:"divide-y divide-gray-100"},Bt=["data-hora"],qt={class:"p-2 text-xs font-medium text-gray-600 border-r border-gray-100 bg-gray-50 sticky left-0"},Wt=["onClick","onDragover","onDrop"],Ut={key:0,class:"absolute inset-0 flex items-center justify-center opacity-0 group-hover/cell:opacity-100 transition-opacity pointer-events-none"},Yt=["onDragstart"],Gt=["onClick"],Jt={class:"font-semibold truncate text-[11px]"},Kt={class:"text-[9px] text-gray-600 mt-0.5"},Qt=["onClick"],Xt={key:3,class:"grid grid-cols-1 lg:grid-cols-2 gap-3"},Zt={class:"font-semibold text-sm text-cafe mb-2 flex items-center justify-between"},eo={class:"text-xs text-gray-500"},to={class:"space-y-1.5"},oo={class:"flex items-center justify-between"},ao=["onClick"],so={class:"font-medium text-xs"},ro={class:"text-[10px] text-gray-600 mt-0.5"},no={class:"flex items-center gap-1.5"},io=["onClick"],lo={key:0,class:"col-span-full text-center py-8 text-gray-400"},co={class:"bg-white rounded-lg shadow-sm border border-gray-100 p-4"},uo={class:"grid grid-cols-2 md:grid-cols-4 gap-3"},po={class:"text-center p-3 bg-yellow-50 rounded-lg"},go={class:"text-xl font-bold text-yellow-700"},vo={class:"text-center p-3 bg-green-50 rounded-lg"},fo={class:"text-xl font-bold text-green-700"},mo={class:"text-center p-3 bg-blue-50 rounded-lg"},xo={class:"text-xl font-bold text-blue-700"},ho={class:"text-center p-3 bg-red-50 rounded-lg"},bo={class:"text-xl font-bold text-red-700"},yo={class:"bg-white rounded-xl shadow-2xl max-w-md w-full p-6"},_o={class:"text-center mb-6"},wo={class:"text-sm text-purple-600 mt-2"},Co={class:"space-y-2 mb-6 max-h-48 overflow-y-auto"},ko={class:"text-sm text-gray-700"},Do={class:"text-xs text-gray-500 ml-auto"},So={class:"flex gap-3"},Mo=["disabled"],Xo={__name:"agenda",setup($o){const Z=Ke();Ne();const g=u("semana"),p=u(new Date),N=u(!0),ee=u([]),_=u(""),w=u(""),C=u(""),S=u(!1),R=u(!1),te=u(!1),T=u(!1),k=u(null),z=u(null),O=u(!1),j=u(!1),V=u(null),B=u(null),M=u(null),D=u(null),{actualizarCita:be}=Qe(),oe=["11:00","12:00","13:00","17:00","18:00","19:00","20:00","21:00","22:00"],m=I(()=>{let o=ee.value;if(_.value&&(o=o.filter(e=>e.estado===_.value)),w.value&&(o=o.filter(e=>e.modalidad===w.value)),C.value.trim()){const e=C.value.toLowerCase();o=o.filter(a=>a.paciente_nombre?.toLowerCase().includes(e))}return o}),F=I(()=>({pendiente:m.value.filter(o=>o.estado==="pendiente").length,confirmada:m.value.filter(o=>o.estado==="confirmada").length,realizada:m.value.filter(o=>o.estado==="realizada").length,cancelada:m.value.filter(o=>o.estado==="cancelada").length})),A=I(()=>{const o=new Date().toISOString().split("T")[0];return m.value.filter(e=>e.fecha_cita===o&&(e.estado==="pendiente"||e.estado==="confirmada"))}),ae=I(()=>{const o=new Date(p.value);return o.setDate(o.getDate()-o.getDay()),Array.from({length:7},(e,a)=>{const s=new Date(o);return s.setDate(o.getDate()+a),{fecha:s.toISOString().split("T")[0],nombreDia:s.toLocaleDateString("es-ES",{weekday:"short"}),numeroDia:s.getDate(),mes:s.toLocaleDateString("es-ES",{month:"short"})}})}),ye=I(()=>{const o=p.value.getFullYear(),e=p.value.getMonth(),a=new Date(o,e,1),s=new Date(o,e+1,0),r=[];for(let c=a;c<=s;c.setDate(c.getDate()+1))r.push({fecha:new Date(c).toISOString().split("T")[0],nombreCompleto:new Date(c).toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long"})});return r}),_e=o=>o.toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),we=o=>o.toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long",year:"numeric"}),Ce=()=>{const o=[];return _.value&&o.push(G(_.value)),w.value&&o.push(w.value),C.value&&o.push(`"${C.value}"`),o.length>0?o.join(" Â· "):"Sin filtros"},q=o=>{const e=new Date().toISOString().split("T")[0];return o===e},se=o=>{const e=new Date(p.value);g.value==="dia"?e.setDate(e.getDate()+o):g.value==="semana"?e.setDate(e.getDate()+o*7):e.setMonth(e.getMonth()+o),p.value=e},ke=()=>{p.value=new Date},De=()=>{const e=`${String(new Date().getHours()).padStart(2,"0")}:00`,a=document.querySelector(`[data-hora="${e}"]`);if(a)a.scrollIntoView({behavior:"smooth",block:"center"});else{const s=document.querySelector('[data-hora="12:00"]');s&&s.scrollIntoView({behavior:"smooth",block:"center"})}},H=o=>{const e=p.value.toISOString().split("T")[0];return m.value.filter(a=>a.fecha_cita===e&&a.hora_inicio?.startsWith(o))},W=(o,e)=>m.value.filter(a=>a.fecha_cita===o&&a.hora_inicio?.startsWith(e)),U=o=>m.value.filter(e=>e.fecha_cita===o),Y=o=>({pendiente:"bg-yellow-100 border-l-4 border-yellow-500",confirmada:"bg-green-100 border-l-4 border-green-500",realizada:"bg-blue-100 border-l-4 border-blue-500",cancelada:"bg-red-100 border-l-4 border-red-500"})[o]||"bg-gray-100 border-l-4 border-gray-500",re=o=>({pendiente:"bg-yellow-200 text-yellow-800",confirmada:"bg-green-200 text-green-800",realizada:"bg-blue-200 text-blue-800",cancelada:"bg-red-200 text-red-800"})[o]||"bg-gray-200 text-gray-800",G=o=>({pendiente:"Pendiente",confirmada:"Confirmada",realizada:"Realizada",cancelada:"Cancelada"})[o]||o,ne=(o,e)=>{M.value=e,o.dataTransfer.effectAllowed="move",o.dataTransfer.setData("text/html",o.target.innerHTML),o.target.style.opacity="0.5"},ie=o=>{o.target.style.opacity="1",M.value=null,D.value=null},le=(o,e,a)=>{o.preventDefault(),o.dataTransfer.dropEffect="move",D.value={fecha:e,hora:a}},de=o=>{D.value=null},ce=async(o,e,a)=>{if(o.preventDefault(),!M.value)return;const s=M.value,r=e,c=a;if(m.value.find(E=>E.fecha_cita===r&&E.hora_inicio?.startsWith(c)&&E.id!==s.id)){x("Ya existe una cita en ese horario","error"),M.value=null,D.value=null;return}const Te=((E,ze)=>{const[Oe,je]=E.split(":").map(Number),[Fe,Ae]=ze.split(":").map(Number),He=Fe*60+Ae-(parseInt(s.hora_inicio.split(":")[0])*60+parseInt(s.hora_inicio.split(":")[1])),me=Oe*60+je+He,Le=Math.floor(me/60),Pe=me%60;return`${String(Le).padStart(2,"0")}:${String(Pe).padStart(2,"0")}:00`})(c,s.hora_fin),fe=await be(s.id,{fecha_cita:r,hora_inicio:`${c}:00`,hora_fin:Te});fe.success?(await y(),x("Cita movida exitosamente","success")):x(fe.error||"Error al mover la cita","error"),M.value=null,D.value=null},ue=(o,e)=>D.value?.fecha===o&&D.value?.hora===e,J=(o=null,e=null)=>{console.log("ðŸŽ¯ Abriendo modal nueva cita",{fecha:o,hora:e}),o&&e?(V.value=o,B.value=e):(V.value=null,B.value=null),S.value=!0,console.log("ðŸ“‹ mostrarModalNueva:",S.value)},K=o=>{k.value=o.id,R.value=!0},pe=()=>{R.value=!1,k.value=null},Se=()=>{te.value=!1,k.value=null},Q=o=>{z.value={id:o.id,fecha_cita:o.fecha_cita,hora_inicio:o.hora_inicio,hora_fin:o.hora_fin,bono_id:o.bono_id,paciente_nombre:o.paciente_nombre||"Paciente",terapeuta_nombre:o.terapeuta_nombre||"Sin asignar",modalidad:o.modalidad,estado:o.estado},T.value=!0},ge=()=>{T.value=!1,z.value=null},Me=o=>{ge(),y();const e=o?.reintegrada?"Cita cancelada y sesiÃ³n reintegrada al bono":"Cita cancelada exitosamente";x(e,"success")},$e=()=>{S.value=!1,y(),x("Cita creada exitosamente","success")},ve=()=>{y(),x("Cita actualizada exitosamente","success")},Ee=()=>{pe(),y(),x("Cita eliminada exitosamente","success")},Ie=async()=>{j.value=!0;try{await new Promise(o=>setTimeout(o,2e3));for(const o of A.value)await Z.from("citas").update({recordatorio_enviado:!0,updated_at:new Date().toISOString()}).eq("id",o.id);O.value=!1,x(`Recordatorios enviados a ${A.value.length} pacientes`,"success"),y()}catch(o){console.error("Error al enviar recordatorios:",o),x("Error al enviar recordatorios","error")}finally{j.value=!1}},x=(o,e="info")=>{console.log(`${{success:"âœ…",error:"âŒ",info:"â„¹ï¸",warning:"âš ï¸"}[e]} ${o}`)},y=async()=>{N.value=!0;try{let o,e;if(g.value==="dia")o=p.value.toISOString().split("T")[0],e=o;else if(g.value==="semana"){const r=new Date(p.value);r.setDate(r.getDate()-r.getDay());const c=new Date(r);c.setDate(r.getDate()+6),o=r.toISOString().split("T")[0],e=c.toISOString().split("T")[0]}else{const r=p.value.getFullYear(),c=p.value.getMonth();o=new Date(r,c,1).toISOString().split("T")[0],e=new Date(r,c+1,0).toISOString().split("T")[0]}const{data:a,error:s}=await Z.from("citas").select(`
        id,
        fecha_cita,
        hora_inicio,
        hora_fin,
        modalidad,
        estado,
        observaciones,
        recordatorio_enviado,
        pacientes (
          nombre_completo,
          email,
          telefono
        )
      `).gte("fecha_cita",o).lte("fecha_cita",e).order("fecha_cita",{ascending:!0}).order("hora_inicio",{ascending:!0});if(s)throw s;ee.value=(a||[]).map(r=>({id:r.id,fecha_cita:r.fecha_cita,hora_inicio:r.hora_inicio?.substring(0,5),hora_fin:r.hora_fin?.substring(0,5),modalidad:r.modalidad||"presencial",estado:r.estado,observaciones:r.observaciones,recordatorio_enviado:r.recordatorio_enviado,paciente_nombre:r.pacientes?.nombre_completo||r.pacientes?.email||"Sin nombre",paciente_telefono:r.pacientes?.telefono}))}catch(o){console.error("Error al cargar citas:",o),x("Error al cargar citas","error")}finally{N.value=!1}};return Re([g,p],()=>{y()}),Ve(()=>{y()}),(o,e)=>(i(),d("div",et,[t("div",tt,[t("div",ot,[t("div",at,[e[17]||(e[17]=t("h1",{class:"text-lg font-serif font-bold text-cafe"},"Agenda General",-1)),t("span",st,l(_e(n(p))),1)]),t("div",rt,[t("div",nt,[t("button",{onClick:e[0]||(e[0]=a=>g.value="dia"),class:f(["px-2.5 py-1 rounded text-xs font-medium transition-colors",n(g)==="dia"?"bg-white text-cafe shadow-sm":"text-gray-600 hover:text-cafe"])}," DÃ­a ",2),t("button",{onClick:e[1]||(e[1]=a=>g.value="semana"),class:f(["px-2.5 py-1 rounded text-xs font-medium transition-colors",n(g)==="semana"?"bg-white text-cafe shadow-sm":"text-gray-600 hover:text-cafe"])}," Semana ",2),t("button",{onClick:e[2]||(e[2]=a=>g.value="mes"),class:f(["px-2.5 py-1 rounded text-xs font-medium transition-colors",n(g)==="mes"?"bg-white text-cafe shadow-sm":"text-gray-600 hover:text-cafe"])}," Mes ",2)]),t("div",it,[t("button",{onClick:e[3]||(e[3]=a=>se(-1)),class:"p-1 rounded hover:bg-gray-100 text-cafe text-sm",title:"Anterior"}," â† "),t("button",{onClick:ke,class:"px-2.5 py-1 bg-gray-100 hover:bg-gray-200 rounded text-xs font-medium text-cafe transition-colors"}," Hoy "),t("button",{onClick:e[4]||(e[4]=a=>se(1)),class:"p-1 rounded hover:bg-gray-100 text-cafe text-sm",title:"Siguiente"}," â†’ ")]),t("button",{onClick:J,class:"px-3 py-1 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-colors text-xs font-medium whitespace-nowrap"}," + Nueva ")])]),t("div",lt,[P(t("select",{"onUpdate:modelValue":e[5]||(e[5]=a=>X(_)?_.value=a:null),class:"px-2 py-1 border border-gray-200 rounded text-xs focus:outline-none focus:ring-2 focus:ring-purple-300/20"},[...e[18]||(e[18]=[Be('<option value="">Todos estados</option><option value="pendiente">Pendientes</option><option value="confirmada">Confirmadas</option><option value="realizada">Realizadas</option><option value="cancelada">Canceladas</option>',5)])],512),[[xe,n(_)]]),P(t("select",{"onUpdate:modelValue":e[6]||(e[6]=a=>X(w)?w.value=a:null),class:"px-2 py-1 border border-gray-200 rounded text-xs focus:outline-none focus:ring-2 focus:ring-purple-300/20"},[...e[19]||(e[19]=[t("option",{value:""},"Modalidades",-1),t("option",{value:"presencial"},"Presencial",-1),t("option",{value:"virtual"},"Virtual",-1)])],512),[[xe,n(w)]]),P(t("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>X(C)?C.value=a:null),type:"text",placeholder:"Buscar paciente...",class:"px-2 py-1 border border-gray-200 rounded text-xs focus:outline-none focus:ring-2 focus:ring-purple-300/20 flex-1 min-w-[150px]"},null,512),[[qe,n(C)]])])]),n(N)?(i(),d("div",dt,[...e[20]||(e[20]=[t("div",{class:"text-center text-gray-400"},[t("span",{class:"text-3xl block mb-2"},"â³"),t("p",{class:"text-sm"},"Cargando agenda...")],-1)])])):n(g)==="dia"?(i(),d("div",ct,[t("div",ut,[t("div",pt,[t("div",null,[t("h3",gt,l(we(n(p))),1),t("p",vt,l(n(m).length)+" citas programadas ",1)]),t("div",ft,[t("span",mt,l(Ce()),1)])])]),t("div",xt,[t("div",ht,[(i(),d(h,null,b(oe,a=>t("div",{key:a,"data-hora":a,class:"flex hover:bg-gray-50 transition-colors"},[t("div",yt,l(a),1),t("div",{class:f(["flex-1 p-2 cursor-pointer hover:bg-purple-600/5 transition-colors relative group/cell",{"bg-purple-600/20 ring-2 ring-purple-300":ue(n(p).toISOString().split("T")[0],a)}]),onClick:s=>H(a).length===0&&J(n(p).toISOString().split("T")[0],a),onDragover:s=>le(s,n(p).toISOString().split("T")[0],a),onDragleave:e[10]||(e[10]=s=>de()),onDrop:s=>ce(s,n(p).toISOString().split("T")[0],a)},[H(a).length===0?(i(),d("div",wt,[...e[21]||(e[21]=[t("span",{class:"text-[10px] text-purple-600 font-medium bg-white px-2 py-1 rounded-full shadow-sm"}," + Agregar cita ",-1)])])):v("",!0),(i(!0),d(h,null,b(H(a),s=>(i(),d("div",{key:s.id,draggable:"true",onDragstart:r=>ne(r,s),onDragend:e[8]||(e[8]=r=>ie(r)),class:f(["mb-1.5 p-2 rounded-lg transition-all hover:shadow-md hover:ring-2 hover:ring-purple-300/30 group relative cursor-move",Y(s.estado)]),onClick:e[9]||(e[9]=$(()=>{},["stop"])),title:"Arrastra para mover a otra hora/dÃ­a"},[t("div",kt,[t("div",Dt,[he(n(Xe),{class:"w-3 h-3 text-gray-400"})]),t("div",{class:"flex-1 cursor-pointer",onClick:r=>K(s)},[t("p",Mt,l(s.paciente_nombre),1),t("div",$t,[t("span",Et,l(s.hora_inicio)+" - "+l(s.hora_fin),1),t("span",It,l(s.modalidad),1)])],8,St),t("div",Tt,[t("span",{class:f(["text-[10px] px-1.5 py-0.5 rounded-full font-medium whitespace-nowrap",re(s.estado)])},l(G(s.estado)),3),s.estado!=="cancelada"?(i(),d("button",{key:0,onClick:$(r=>Q(s),["stop"]),class:"p-1 rounded hover:bg-red-100 text-red-600 transition-colors opacity-0 group-hover:opacity-100",title:"Cancelar cita"},[...e[22]||(e[22]=[t("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,zt)):v("",!0)])])],42,Ct))),128)),H(a).length===0?(i(),d("div",Ot," Sin citas ")):v("",!0)],42,_t)],8,bt)),64))])])])):n(g)==="semana"?(i(),d("div",jt,[t("div",Ft,[t("div",At,[t("div",Ht,[e[23]||(e[23]=t("div",{class:"p-1.5 border-r border-gray-200 bg-gray-50"},null,-1)),(i(!0),d(h,null,b(n(ae),a=>(i(),d("div",{key:a.fecha,class:f(["p-1.5 text-center border-r border-gray-200 last:border-r-0",q(a.fecha)?"bg-purple-600/10":"bg-white"])},[t("div",Lt,[t("span",Pt,l(a.nombreDia),1),t("span",{class:f(["text-base font-bold text-cafe",q(a.fecha)?"text-purple-600":""])},l(a.numeroDia),3)]),t("div",Nt,l(a.mes),1)],2))),128))])]),t("div",Rt,[t("div",Vt,[(i(),d(h,null,b(oe,a=>t("div",{key:a,"data-hora":a,class:"grid grid-cols-8"},[t("div",qt,l(a),1),(i(!0),d(h,null,b(n(ae),s=>(i(),d("div",{key:`${s.fecha}-${a}`,class:f(["p-1.5 border-r border-gray-100 last:border-r-0 hover:bg-purple-600/5 transition-colors min-h-[60px] cursor-pointer relative group/cell",[q(s.fecha)?"bg-purple-600/5":"",ue(s.fecha,a)?"bg-purple-600/20 ring-2 ring-purple-300 ring-inset":""]]),onClick:r=>W(s.fecha,a).length===0&&J(s.fecha,a),onDragover:r=>le(r,s.fecha,a),onDragleave:e[13]||(e[13]=r=>de()),onDrop:r=>ce(r,s.fecha,a)},[W(s.fecha,a).length===0?(i(),d("div",Ut,[...e[24]||(e[24]=[t("span",{class:"text-[9px] text-purple-600 font-medium bg-white px-1.5 py-0.5 rounded-full shadow-sm"}," + ",-1)])])):v("",!0),(i(!0),d(h,null,b(W(s.fecha,a),r=>(i(),d("div",{key:r.id,draggable:"true",onDragstart:c=>ne(c,r),onDragend:e[11]||(e[11]=c=>ie(c)),class:f(["text-[10px] p-1.5 rounded mb-1 hover:shadow-md hover:ring-2 hover:ring-purple-300/30 transition-all group relative cursor-move",Y(r.estado)]),onClick:e[12]||(e[12]=$(()=>{},["stop"])),title:"Arrastra para mover"},[t("div",{onClick:c=>K(r),class:"cursor-pointer"},[t("p",Jt,l(r.paciente_nombre),1),t("p",Kt,l(r.hora_inicio.slice(0,5)),1)],8,Gt),r.estado!=="cancelada"?(i(),d("button",{key:0,onClick:$(c=>Q(r),["stop"]),class:"absolute top-0.5 right-0.5 p-0.5 rounded hover:bg-red-100 text-red-600 transition-colors opacity-0 group-hover:opacity-100",title:"Cancelar"},[...e[25]||(e[25]=[t("svg",{class:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Qt)):v("",!0)],42,Yt))),128))],42,Wt))),128))],8,Bt)),64))])])])])):(i(),d("div",Xt,[(i(!0),d(h,null,b(n(ye),a=>P((i(),d("div",{key:a.fecha,class:"bg-white rounded-lg shadow-sm border border-gray-100 p-3"},[t("h3",Zt,[t("span",null,l(a.nombreCompleto),1),t("span",eo,l(U(a.fecha).length)+" citas",1)]),t("div",to,[(i(!0),d(h,null,b(U(a.fecha),s=>(i(),d("div",{key:s.id,class:f(["p-2 rounded-lg transition-all hover:shadow-md group relative",Y(s.estado)])},[t("div",oo,[t("div",{class:"flex-1 cursor-pointer",onClick:r=>K(s)},[t("p",so,l(s.paciente_nombre),1),t("p",ro,l(s.hora_inicio)+" - "+l(s.hora_fin)+" Â· "+l(s.modalidad),1)],8,ao),t("div",no,[t("span",{class:f(["text-[10px] px-1.5 py-0.5 rounded-full font-medium",re(s.estado)])},l(G(s.estado)),3),s.estado!=="cancelada"?(i(),d("button",{key:0,onClick:$(r=>Q(s),["stop"]),class:"p-1 rounded hover:bg-red-100 text-red-600 transition-colors opacity-0 group-hover:opacity-100",title:"Cancelar cita"},[...e[26]||(e[26]=[t("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,io)):v("",!0)])])],2))),128))])])),[[We,U(a.fecha).length>0]])),128)),n(m).length===0?(i(),d("div",lo,[...e[27]||(e[27]=[t("span",{class:"text-4xl block mb-3"},"ðŸ“…",-1),t("p",{class:"text-sm"},"No hay citas en este mes",-1)])])):v("",!0)])),t("div",co,[e[32]||(e[32]=t("h2",{class:"text-base font-serif font-bold text-cafe mb-3"}," Resumen de Citas ",-1)),t("div",uo,[t("div",po,[t("p",go,l(n(F).pendiente),1),e[28]||(e[28]=t("p",{class:"text-[10px] text-yellow-600 mt-1"},"Pendientes",-1))]),t("div",vo,[t("p",fo,l(n(F).confirmada),1),e[29]||(e[29]=t("p",{class:"text-[10px] text-green-600 mt-1"},"Confirmadas",-1))]),t("div",mo,[t("p",xo,l(n(F).realizada),1),e[30]||(e[30]=t("p",{class:"text-[10px] text-blue-600 mt-1"},"Realizadas",-1))]),t("div",ho,[t("p",bo,l(n(F).cancelada),1),e[31]||(e[31]=t("p",{class:"text-[10px] text-red-600 mt-1"},"Canceladas",-1))])])]),n(S)?(i(),L(Ue,{key:4,mostrar:n(S),"fecha-preseleccionada":n(V),"hora-preseleccionada":n(B),onCerrar:e[14]||(e[14]=a=>S.value=!1),onCitaCreada:$e},null,8,["mostrar","fecha-preseleccionada","hora-preseleccionada"])):v("",!0),n(R)&&n(k)?(i(),L(Ye,{key:5,"cita-id":n(k),onClose:pe,onCitaActualizada:ve,onCitaEliminada:Ee},null,8,["cita-id"])):v("",!0),n(te)&&n(k)?(i(),L(Ge,{key:6,"cita-id":n(k),onClose:Se,onCitaActualizada:ve},null,8,["cita-id"])):v("",!0),n(T)&&n(z)?(i(),L(Je,{key:7,cita:n(z),"is-open":n(T),onClose:ge,onCancelada:Me},null,8,["cita","is-open"])):v("",!0),n(O)?(i(),d("div",{key:8,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:e[16]||(e[16]=$(a=>O.value=!1,["self"]))},[t("div",yo,[t("div",_o,[e[33]||(e[33]=t("span",{class:"text-6xl block mb-4"},"ðŸ’¬",-1)),e[34]||(e[34]=t("h3",{class:"text-xl font-bold text-cafe mb-2"}," Â¿Enviar Recordatorios? ",-1)),e[35]||(e[35]=t("p",{class:"text-gray-600"}," Se enviarÃ¡ un mensaje de WhatsApp a los pacientes con citas programadas para hoy. ",-1)),t("p",wo,l(n(A).length)+" citas pendientes de recordatorio ",1)]),t("div",Co,[(i(!0),d(h,null,b(n(A),a=>(i(),d("div",{key:a.id,class:"flex items-center gap-2 p-2 bg-gray-50 rounded"},[e[36]||(e[36]=t("span",{class:"text-sm"},"âœ“",-1)),t("span",ko,l(a.paciente_nombre),1),t("span",Do,l(a.hora_inicio),1)]))),128))]),t("div",So,[t("button",{onClick:e[15]||(e[15]=a=>O.value=!1),class:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"}," Cancelar "),t("button",{onClick:Ie,class:"flex-1 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors",disabled:n(j)},l(n(j)?"Enviando...":"Enviar Ahora"),9,Mo)])])])):v("",!0),n(g)!=="mes"?(i(),d("button",{key:9,onClick:De,class:"fixed bottom-8 right-8 w-12 h-12 bg-purple-600 text-white rounded-full shadow-lg hover:bg-purple-600/90 transition-all hover:scale-110 flex items-center justify-center z-20 group",title:"Ir a hora actual"},[he(n(Ze),{class:"w-6 h-6"}),e[37]||(e[37]=t("span",{class:"absolute -top-10 right-0 bg-cafe text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap"}," Hora actual ",-1))])):v("",!0)]))}};export{Xo as default};
