import{_ as je}from"./nuxt-link-BZMythwH.js";import{e as q,x,c as r,o as n,h as j,a as t,t as g,A as v,l as s,d as z,j as se,z as $e,D as K,w as Q,af as Se,F as Y,p as Me,J as Be,L as Ue,r as C,g as Te,E as Pe,b as T,i as L,y as G}from"#entry";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{M as ze}from"./ModalDetallesCita-CZ6Vzvt2.js";import"./CalendarIcon-mZ3toP8Y.js";import"./XMarkIcon-DWNj0d99.js";import"./UserIcon-G1mM6o1b.js";import"./ClockIcon-CQZt9cKZ.js";import"./TicketIcon-DRclOuRO.js";import"./XCircleIcon-BaRJRhc1.js";import"./CheckCircleIcon-Bi0YyG7H.js";import"./ExclamationCircleIcon-Dyh9f5zH.js";const Ve={key:0,class:"absolute -top-2 left-4 px-2 py-0.5 text-[10px] font-bold uppercase tracking-wider bg-violet-600 text-white rounded-full shadow-sm"},Ee={class:"flex-shrink-0 w-16 text-center"},He={class:"text-2xl font-bold text-gray-900"},Ae={class:"flex-1 min-w-0"},Ne={class:"text-base font-semibold text-gray-900 truncate"},Le={class:"flex items-center gap-2 mt-1.5"},qe={class:"text-[10px]"},Re={class:"flex items-center gap-2"},Oe=q({__name:"SessionCard",props:{id:{},hora:{},pacienteNombre:{},modalidad:{},estado:{},isNext:{type:Boolean}},emits:["click","confirmar"],setup(o,{emit:d}){const u=o,$=d,M={presencial:{label:"Presencial",icon:"ðŸ¥",class:"bg-blue-100 text-blue-700 border-blue-200"},online:{label:"Online",icon:"ðŸ’»",class:"bg-purple-100 text-purple-700 border-purple-200"},virtual:{label:"Online",icon:"ðŸ’»",class:"bg-purple-100 text-purple-700 border-purple-200"},telefonica:{label:"TelÃ©fono",icon:"ðŸ“ž",class:"bg-amber-100 text-amber-700 border-amber-200"}},f={pendiente:{label:"Pendiente",class:"bg-amber-100 text-amber-800 border-amber-300"},confirmada:{label:"Confirmada",class:"bg-emerald-100 text-emerald-800 border-emerald-300"},realizada:{label:"Realizada",class:"bg-blue-100 text-blue-800 border-blue-300"},cancelada:{label:"Cancelada",class:"bg-red-100 text-red-800 border-red-300"}},_=x(()=>M[u.modalidad]||M.presencial),y=x(()=>f[u.estado]||f.pendiente);return(S,D)=>(n(),r("div",{onClick:D[1]||(D[1]=p=>$("click",o.id)),class:v(["relative flex items-center gap-4 p-4 rounded-xl border bg-white cursor-pointer transition-all duration-200 hover:shadow-md hover:border-violet-200 group",{"ring-2 ring-violet-400 ring-offset-2 shadow-lg border-violet-300":o.isNext,"border-gray-100":!o.isNext}])},[o.isNext?(n(),r("div",Ve," PrÃ³xima ")):j("",!0),t("div",Ee,[t("p",He,g(o.hora),1)]),D[3]||(D[3]=t("div",{class:"w-px h-12 bg-gray-200"},null,-1)),t("div",Ae,[t("p",Ne,g(o.pacienteNombre),1),t("div",Le,[t("span",{class:v(["inline-flex items-center gap-1 px-2 py-0.5 text-xs font-medium rounded-full border",s(_).class])},[t("span",qe,g(s(_).icon),1),z(" "+g(s(_).label),1)],2),t("span",{class:v(["inline-flex items-center px-2 py-0.5 text-xs font-medium rounded-full border",s(y).class])},g(s(y).label),3)])]),t("div",Re,[u.estado==="pendiente"?(n(),r("button",{key:0,onClick:D[0]||(D[0]=se(p=>$("confirmar",o.id),["stop"])),class:"px-3 py-1.5 text-xs font-medium bg-emerald-500 text-white rounded-lg opacity-0 group-hover:opacity-100 hover:bg-emerald-600 transition-all shadow-sm",title:"Confirmar cita"}," Confirmar ")):j("",!0),D[2]||(D[2]=t("button",{class:"p-2 text-gray-400 hover:text-violet-600 hover:bg-violet-50 rounded-lg transition-colors",title:"Ver detalles"},[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})])],-1))])],2))}}),Ie=Object.assign(Oe,{__name:"DashboardSessionCard"}),Fe={class:"flex-1 min-w-0"},Ke={class:"font-semibold text-gray-900 truncate"},Ye={class:"flex items-center gap-3 mt-1 text-sm"},Je={class:"text-gray-500 flex items-center gap-1"},Ge={key:0,class:"mt-2"},Qe={class:"flex items-center justify-between text-xs text-gray-500 mb-1"},We={class:"font-medium"},Xe={class:"h-1.5 bg-gray-100 rounded-full overflow-hidden"},Ze=q({__name:"PatientCard",props:{id:{},nombre:{},ultimaSesion:{},proximaCita:{},sesionesUsadas:{},sesionesTotales:{},estadoBono:{}},emits:["click"],setup(o,{emit:d}){const u=o,$=d,M=x(()=>{if(!u.nombre)return"?";const p=u.nombre.split(" ").filter(Boolean);return p.length>=2?(p[0][0]+p[1][0]).toUpperCase():p[0]?.substring(0,2).toUpperCase()||"?"}),f=x(()=>{const p=["bg-violet-500","bg-blue-500","bg-emerald-500","bg-amber-500","bg-rose-500","bg-cyan-500","bg-indigo-500","bg-teal-500"],w=u.nombre?.charCodeAt(0)||0;return p[w%p.length]}),_=x(()=>!u.sesionesTotales||u.sesionesTotales===0?0:Math.round((u.sesionesUsadas||0)/u.sesionesTotales*100)),y={activo:{label:"Bono activo",class:"text-emerald-600 bg-emerald-50",icon:"âœ“"},por_agotar:{label:"Por agotar",class:"text-amber-600 bg-amber-50",icon:"!"},sin_bono:{label:"Sin bono",class:"text-gray-500 bg-gray-50",icon:"â€“"},agotado:{label:"Bono agotado",class:"text-red-600 bg-red-50",icon:"âœ—"}},S=x(()=>y[u.estadoBono||"sin_bono"]),D=x(()=>{if(!u.ultimaSesion)return"Sin sesiones";const p=new Date(u.ultimaSesion),k=Math.floor((new Date().getTime()-p.getTime())/(1e3*60*60*24));return k===0?"Hoy":k===1?"Ayer":k<7?`Hace ${k} dÃ­as`:p.toLocaleDateString("es-ES",{day:"numeric",month:"short"})});return(p,w)=>(n(),r("div",{onClick:w[0]||(w[0]=k=>$("click",o.id)),class:"flex items-center gap-4 p-4 bg-white rounded-xl border border-gray-100 cursor-pointer transition-all duration-200 hover:shadow-md hover:border-violet-200 group"},[t("div",{class:v(["flex-shrink-0 w-12 h-12 rounded-full flex items-center justify-center text-white font-bold text-sm shadow-sm",s(f)])},g(s(M)),3),t("div",Fe,[t("p",Ke,g(o.nombre),1),t("div",Ye,[t("span",Je,[w[1]||(w[1]=t("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),z(" "+g(s(D)),1)]),s(S)?(n(),r("span",{key:0,class:v(["inline-flex items-center gap-1 px-2 py-0.5 text-xs font-medium rounded-full",s(S).class])},g(s(S).label),3)):j("",!0)]),o.sesionesTotales&&o.sesionesTotales>0?(n(),r("div",Ge,[t("div",Qe,[w[2]||(w[2]=t("span",null,"Sesiones del bono",-1)),t("span",We,g(o.sesionesUsadas||0)+"/"+g(o.sesionesTotales),1)]),t("div",Xe,[t("div",{class:v(["h-full rounded-full transition-all duration-500",{"bg-emerald-500":s(_)<75,"bg-amber-500":s(_)>=75&&s(_)<100,"bg-red-500":s(_)>=100}]),style:$e({width:`${Math.min(s(_),100)}%`})},null,6)])])):j("",!0)]),w[3]||(w[3]=t("button",{class:"flex-shrink-0 p-2 text-gray-400 hover:text-violet-600 hover:bg-violet-50 rounded-lg transition-colors",title:"Ver perfil"},[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})])],-1))]))}}),et=Object.assign(Ze,{__name:"DashboardPatientCard"}),tt={class:"text-xl"},at={key:1,class:"absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity"},ot=q({__name:"MetricCard",props:{value:{},label:{},sublabel:{},icon:{},variant:{},to:{}},setup(o){const d={purple:{bg:"bg-gradient-to-br from-violet-50 to-purple-50",border:"border-violet-200/60",icon:"bg-violet-100 text-violet-600",value:"text-violet-900",label:"text-violet-700/80"},green:{bg:"bg-gradient-to-br from-emerald-50 to-teal-50",border:"border-emerald-200/60",icon:"bg-emerald-100 text-emerald-600",value:"text-emerald-900",label:"text-emerald-700/80"},blue:{bg:"bg-gradient-to-br from-blue-50 to-indigo-50",border:"border-blue-200/60",icon:"bg-blue-100 text-blue-600",value:"text-blue-900",label:"text-blue-700/80"},amber:{bg:"bg-gradient-to-br from-amber-50 to-orange-50",border:"border-amber-200/60",icon:"bg-amber-100 text-amber-600",value:"text-amber-900",label:"text-amber-700/80"},neutral:{bg:"bg-gradient-to-br from-gray-50 to-slate-50",border:"border-gray-200/60",icon:"bg-gray-100 text-gray-600",value:"text-gray-900",label:"text-gray-700/80"}};return(u,$)=>(n(),K(Se(o.to?"NuxtLink":"div"),{to:o.to,class:v(["relative p-5 rounded-2xl border transition-all duration-200",[d[o.variant||"purple"].bg,d[o.variant||"purple"].border,o.to?"hover:shadow-lg hover:scale-[1.02] cursor-pointer group":""]])},{default:Q(()=>[t("div",{class:v(["w-10 h-10 rounded-xl flex items-center justify-center mb-3 transition-transform",[d[o.variant||"purple"].icon,o.to?"group-hover:scale-110":""]])},[t("span",tt,g(o.icon),1)],2),t("p",{class:v(["text-3xl font-bold tracking-tight",d[o.variant||"purple"].value])},g(o.value),3),t("p",{class:v(["text-sm font-medium mt-1",d[o.variant||"purple"].label])},g(o.label),3),o.sublabel?(n(),r("p",{key:0,class:v(["text-xs mt-0.5 font-medium",d[o.variant||"purple"].label])},g(o.sublabel),3)):j("",!0),o.to?(n(),r("div",at,[(n(),r("svg",{class:v(["w-5 h-5",d[o.variant||"purple"].label]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...$[0]||($[0]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])],2))])):j("",!0)]),_:1},8,["to","class"]))}}),st=Object.assign(ot,{__name:"DashboardMetricCard"}),nt={key:0,class:"text-base"},rt={key:1},it={class:"flex-1 min-w-0"},lt={class:"flex items-center gap-2"},ct={key:0,class:"flex-shrink-0 inline-flex items-center px-1.5 py-0.5 text-[10px] font-bold uppercase tracking-wider bg-red-500 text-white rounded-full animate-pulse"},dt={key:0},ut={key:1},mt={key:2},gt={key:3},bt={key:5,class:"font-semibold"},vt=q({__name:"ReminderCard",props:{id:{},tipo:{},mensaje:{},paciente:{},fecha:{},hora:{},urgente:{type:Boolean},accion:{}},emits:["accion"],setup(o,{emit:d}){const u=o,$=d,M={confirmacion:{icon:"ðŸ“…",bgClass:"bg-amber-50 border-amber-200",bgClassUrgent:"bg-red-50 border-red-300 ring-2 ring-red-200",iconBg:"bg-amber-100",iconBgUrgent:"bg-red-100",textClass:"text-amber-900",textClassUrgent:"text-red-900",accionLabel:"Confirmar",accionClass:"bg-amber-500 hover:bg-amber-600 text-white",accionClassUrgent:"bg-red-500 hover:bg-red-600 text-white"},pago:{icon:"ðŸ’³",bgClass:"bg-emerald-50 border-emerald-200",bgClassUrgent:"bg-emerald-50 border-emerald-200",iconBg:"bg-emerald-100",iconBgUrgent:"bg-emerald-100",textClass:"text-emerald-900",textClassUrgent:"text-emerald-900",accionLabel:"Ver pago",accionClass:"bg-emerald-500 hover:bg-emerald-600 text-white",accionClassUrgent:"bg-emerald-500 hover:bg-emerald-600 text-white"},clinico:{icon:"ðŸ“",bgClass:"bg-blue-50 border-blue-200",bgClassUrgent:"bg-blue-50 border-blue-200",iconBg:"bg-blue-100",iconBgUrgent:"bg-blue-100",textClass:"text-blue-900",textClassUrgent:"text-blue-900",accionLabel:"Ver",accionClass:"bg-blue-500 hover:bg-blue-600 text-white",accionClassUrgent:"bg-blue-500 hover:bg-blue-600 text-white"},bono:{icon:"ðŸŽŸï¸",bgClass:"bg-violet-50 border-violet-200",bgClassUrgent:"bg-violet-50 border-violet-200",iconBg:"bg-violet-100",iconBgUrgent:"bg-violet-100",textClass:"text-violet-900",textClassUrgent:"text-violet-900",accionLabel:"Ver bono",accionClass:"bg-violet-500 hover:bg-violet-600 text-white",accionClassUrgent:"bg-violet-500 hover:bg-violet-600 text-white"},general:{icon:"ðŸ””",bgClass:"bg-gray-50 border-gray-200",bgClassUrgent:"bg-gray-50 border-gray-200",iconBg:"bg-gray-100",iconBgUrgent:"bg-gray-100",textClass:"text-gray-900",textClassUrgent:"text-gray-900",accionLabel:"Ver",accionClass:"bg-gray-500 hover:bg-gray-600 text-white",accionClassUrgent:"bg-gray-500 hover:bg-gray-600 text-white"}},f=x(()=>M[u.tipo]||M.general),_=x(()=>u.urgente?f.value.bgClassUrgent:f.value.bgClass),y=x(()=>u.urgente?f.value.iconBgUrgent:f.value.iconBg),S=x(()=>u.urgente?f.value.textClassUrgent:f.value.textClass),D=x(()=>u.urgente?f.value.accionClassUrgent:f.value.accionClass),p=x(()=>u.paciente&&(u.fecha||u.hora)?null:u.mensaje);return(w,k)=>(n(),r("div",{class:v(["flex items-center gap-3 p-3 rounded-xl border transition-all duration-200 hover:shadow-sm cursor-pointer group",s(_)]),onClick:k[1]||(k[1]=V=>$("accion",{id:o.id,tipo:o.tipo,accion:o.accion}))},[t("div",{class:v(["relative flex-shrink-0 w-10 h-10 rounded-lg flex items-center justify-center text-lg",s(y)])},[o.urgente?(n(),r("span",nt,"âš ï¸")):(n(),r("span",rt,g(s(f).icon),1))],2),t("div",it,[o.paciente&&(o.fecha||o.hora)?(n(),r(Y,{key:0},[t("div",lt,[t("p",{class:v(["font-medium truncate",s(S)])},g(o.paciente),3),o.urgente?(n(),r("span",ct," Urgente ")):j("",!0)]),t("p",{class:v(["text-sm flex items-center gap-2 mt-0.5",o.urgente?"text-red-700":"text-gray-600"])},[o.tipo==="confirmacion"?(n(),r("span",dt,"Confirmar cita")):o.tipo==="pago"?(n(),r("span",ut,"Pago pendiente")):o.tipo==="bono"?(n(),r("span",mt,"Bono por agotar")):(n(),r("span",gt,g(o.mensaje),1)),o.fecha||o.hora?(n(),r("span",{key:4,class:v(o.urgente?"text-red-400":"text-gray-400")},"â€¢",2)):j("",!0),o.fecha||o.hora?(n(),r("span",bt,g(o.fecha)+" "+g(o.hora),1)):j("",!0)],2)],64)):(n(),r("p",{key:1,class:v(["text-sm leading-relaxed",s(S)])},g(s(p)||o.mensaje),3))]),o.accion?(n(),r("button",{key:0,onClick:k[0]||(k[0]=se(V=>$("accion",{id:o.id,tipo:o.tipo,accion:o.accion}),["stop"])),class:v(["flex-shrink-0 px-3 py-1.5 text-xs font-medium rounded-lg transition-all shadow-sm",[s(D),o.urgente?"opacity-100":"opacity-0 group-hover:opacity-100"]])},g(s(f).accionLabel),3)):j("",!0),(n(),r("svg",{class:v(["w-4 h-4 flex-shrink-0 transition-opacity",o.urgente?"text-red-400 opacity-100":"text-gray-400 opacity-50 group-hover:opacity-100"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...k[2]||(k[2]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])],2))],2))}}),ft=Object.assign(ne(vt,[["__scopeId","data-v-7055149d"]]),{__name:"DashboardReminderCard"}),pt={class:"dashboard-terapeuta min-h-screen bg-gradient-to-br from-gray-50 via-white to-violet-50/30"},ht={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},xt={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8"},yt={class:"text-gray-500 mt-1 flex items-center gap-2"},wt={class:"font-medium text-gray-700"},kt={class:"grid grid-cols-1 lg:grid-cols-3 gap-6 lg:gap-8"},Ct={class:"lg:col-span-2 bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden"},_t={class:"flex items-center justify-between px-6 py-4 border-b border-gray-100 bg-gradient-to-r from-violet-50/50 to-transparent"},Dt={class:"flex items-center gap-3"},jt={class:"text-sm text-gray-500"},$t={class:"p-4"},St={key:0,class:"flex flex-col items-center justify-center py-12"},Mt={key:1,class:"flex flex-col items-center justify-center py-12 text-center"},Bt={key:2,class:"space-y-3"},Ut={class:"bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden"},Tt={class:"flex items-center justify-between px-6 py-4 border-b border-gray-100 bg-gradient-to-r from-blue-50/50 to-transparent"},Pt={class:"p-4"},zt={key:0,class:"flex flex-col items-center justify-center py-8"},Vt={key:1,class:"flex flex-col items-center justify-center py-8 text-center"},Et={key:2,class:"space-y-3"},Ht={class:"grid grid-cols-1 lg:grid-cols-3 gap-6 lg:gap-8 mt-8"},At={class:"lg:col-span-2 bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden"},Nt={class:"p-6"},Lt={class:"grid grid-cols-2 lg:grid-cols-4 gap-4"},qt={class:"bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden"},Rt={class:"flex items-center justify-between px-6 py-4 border-b border-gray-100"},Ot={class:"p-4"},It={key:0,class:"flex flex-col items-center justify-center py-8"},Ft={key:1,class:"flex flex-col items-center justify-center py-8 text-center"},Kt={key:2,class:"space-y-2"},Yt=q({__name:"dashboard",setup(o){const d=Me(),u=Be(),$=Ue(),M=C(null),f=C(!0),_=C(!0),y=C([]),S=C([]),D=C(0),p=C(0),w=C(0),k=C(!1),V=C(null),E=C(!1),R=C(!1),H=C(0),P=C(0),J=C([]),O=C(!0),re=x(()=>new Date().toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long"})),ie=x(()=>E.value?y.value:y.value.slice(0,5));function W(a,e){return a.getFullYear()===e.getFullYear()&&a.getMonth()===e.getMonth()&&a.getDate()===e.getDate()}function le(a,e){const l=new Date(e);return l.setDate(l.getDate()+1),W(a,l)}function ce(a){return a.toLocaleDateString("es-ES",{weekday:"long"})}function de(a){return a.toLocaleDateString("es-ES",{day:"numeric",month:"short"})}function ue(a,e){const l=new Date,i=new Date(`${a}T${e}:00`),c=(i.getTime()-l.getTime())/(1e3*60*60);if(W(i,l))return`Hoy ${e}`;if(le(i,l))return`MaÃ±ana ${e}`;if(c>0&&c<168){const b=ce(i);return`${b.charAt(0).toUpperCase()+b.slice(1)} ${e}`}return`${de(i)} ${e}`}function me(a,e){if(!a||!e)return!1;const l=new Date,c=(new Date(`${a}T${e}:00`).getTime()-l.getTime())/(1e3*60*60);return c>0&&c<24}const ge=x(()=>J.value.map(a=>{let e=a.fechaCita&&a.horaCita?ue(a.fechaCita,a.horaCita):void 0,l=a.tipo==="confirmacion"&&me(a.fechaCita,a.horaCita),i="",c="";if(e){const b=e.split(" ");c=b.pop()||"",i=b.join(" ")}return{id:a.id,tipo:a.tipo,mensaje:a.mensaje,paciente:a.paciente,fecha:i,hora:c,urgente:l,accion:a.accion}})),A=x(()=>[...ge.value].sort((a,e)=>{if(a.urgente&&!e.urgente)return-1;if(!a.urgente&&e.urgente)return 1;const l=a.fecha||a.hora,i=e.fecha||e.hora;return l&&!i?-1:!l&&i?1:0})),be=x(()=>R.value?A.value:A.value.slice(0,4)),X=()=>{u.push("/terapeuta/agenda")},ve=()=>{u.push("/terapeuta/pacientes")},fe=a=>{u.push(`/terapeuta/pacientes/${a}`)},Z=a=>{V.value=a,k.value=!0},pe=()=>{k.value=!1,V.value=null,N()},ee=async a=>{try{const{error:e}=await d.from("citas").update({estado:"confirmada",updated_at:new Date().toISOString()}).eq("id",a);if(e)throw e;const l=y.value.findIndex(i=>i.id===a);l!==-1&&(y.value[l].estado="confirmada"),await I()}catch(e){console.error("Error al confirmar cita:",e),alert("Error al confirmar la cita")}};async function he(){try{const{data:a}=await d.auth.getUser();if(a.user){const{data:e}=await d.from("profiles").select("*").eq("id",a.user.id).single();M.value={nombre:e?.metadata?.nombre||"Karem",email:a.user.email}}}catch(a){console.error("Error al cargar perfil:",a),M.value={nombre:"Karem"}}}async function N(){f.value=!0;try{const a=new Date;a.setHours(0,0,0,0);const e=new Date(a);e.setDate(e.getDate()+7);const{data:l,error:i}=await d.from("citas").select(`
        id,
        paciente_id,
        fecha_cita,
        hora_inicio,
        modalidad,
        estado,
        observaciones,
        pacientes (
          id,
          nombre_completo,
          email
        )
      `).in("estado",["pendiente","confirmada"]).gte("fecha_cita",a.toISOString().split("T")[0]).lte("fecha_cita",e.toISOString().split("T")[0]).order("fecha_cita",{ascending:!0}).order("hora_inicio",{ascending:!0});if(i)throw i;y.value=(l||[]).map(c=>({id:c.id,hora_inicio:c.hora_inicio?c.hora_inicio.substring(0,5):"--:--",paciente_nombre:c.pacientes?.nombre_completo||c.pacientes?.email||"Paciente",modalidad:c.modalidad||"presencial",estado:c.estado||"pendiente",observaciones:c.observaciones}))}catch(a){console.error("Error al cargar sesiones:",a),y.value=[]}finally{f.value=!1}}async function xe(){_.value=!0;try{const{data:a,error:e}=await d.from("pacientes").select("id, nombre_completo, area_de_acompanamiento, updated_at, metadata").eq("activo",!0).order("updated_at",{ascending:!1}).limit(5);if(e)throw e;const l=await Promise.all((a||[]).map(async i=>{let c=0,b=0,B="sin_bono";try{const{data:U}=await d.from("bonos").select("sesiones_totales, sesiones_restantes, estado").eq("paciente_id",i.id).eq("estado","activo").single();U&&(b=U.sesiones_totales||0,c=b-(U.sesiones_restantes||0),U.sesiones_restantes<=0?B="agotado":U.sesiones_restantes<=2?B="por_agotar":B="activo")}catch{}return{id:i.id,nombre_completo:i.nombre_completo||"Sin nombre",ultima_sesion:i.updated_at,sesiones_usadas:c,sesiones_totales:b,estado_bono:B}}));S.value=l}catch(a){console.error("Error al cargar pacientes:",a),S.value=[]}finally{_.value=!1}}async function ye(){try{const{count:a}=await d.from("pacientes").select("*",{count:"exact",head:!0}).eq("activo",!0);D.value=a||0;const e=new Date;e.setDate(1),e.setHours(0,0,0,0);const{count:l}=await d.from("citas").select("*",{count:"exact",head:!0}).gte("fecha_cita",e.toISOString().split("T")[0]);p.value=l||0;const{data:i}=await d.from("citas").select("estado").gte("fecha_cita",e.toISOString().split("T")[0]).in("estado",["realizada","completada","cancelada"]);if(i&&i.length>0){const c=i.filter(b=>b.estado==="realizada"||b.estado==="completada").length;w.value=Math.round(c/i.length*100)}else w.value=0}catch(a){console.error("Error al cargar mÃ©tricas:",a)}}async function I(){O.value=!0;const a=[];try{const e=new Date,l=new Date(e);l.setHours(0,0,0,0);const i=l.toISOString().split("T")[0],c=new Date(l);c.setDate(l.getDate()+3);const b=c.toISOString().split("T")[0],{data:B}=await d.from("citas").select(`
        id,
        fecha_cita,
        hora_inicio,
        pacientes (
          nombre_completo
        )
      `).eq("estado","pendiente").gte("fecha_cita",i).lte("fecha_cita",b).order("fecha_cita",{ascending:!0}).order("hora_inicio",{ascending:!0});B?.forEach(h=>{const F=h.hora_inicio?.substring(0,5)||"00:00",ae=h.fecha_cita;if(ae===i){const[_e,De]=F.split(":").map(Number),oe=new Date(e);if(oe.setHours(_e,De,0,0),oe<e)return}a.push({id:h.id,tipo:"confirmacion",mensaje:`Confirmar cita de ${h.pacientes?.nombre_completo||"paciente"}`,paciente:h.pacientes?.nombre_completo||"Paciente",fechaCita:ae,horaCita:F,accion:"confirmar"})});const{data:U}=await d.from("citas").select(`
        id,
        fecha_cita,
        hora_inicio,
        pacientes (
          nombre_completo
        )
      `).lt("fecha_cita",i).neq("estado","completada").neq("estado","cancelada").neq("estado","realizada").order("fecha_cita",{ascending:!1}).limit(3);U?.forEach(h=>{const F=new Date(h.fecha_cita).toLocaleDateString("es-ES",{day:"numeric",month:"short"});a.push({id:h.id,tipo:"clinico",mensaje:`Revisa la sesiÃ³n pendiente de ${h.pacientes?.nombre_completo||"paciente"} del ${F}`,paciente:h.pacientes?.nombre_completo||"Paciente",accion:"ver"})});const{data:m}=await d.from("bonos").select(`
        id,
        sesiones_restantes,
        pacientes (
          nombre_completo
        )
      `).eq("estado","activo").lte("sesiones_restantes",2).gt("sesiones_restantes",0).limit(3);m?.forEach(h=>{a.push({id:h.id,tipo:"bono",mensaje:`El bono estÃ¡ por agotarse (quedan ${h.sesiones_restantes} sesiones)`,paciente:h.pacientes?.nombre_completo||"Paciente",accion:"ver"})}),J.value=a.slice(0,8)}catch(e){console.error("Error al generar recordatorios:",e),J.value=[]}finally{O.value=!1}}async function we(){try{if(!$.value?.email)return;const{data:a}=await d.from("terapeutas").select("id").eq("email",$.value.email).single();if(!a)return;const{data:e}=await d.from("pacientes").select("id").eq("terapeuta_id",a.id);if(!e||e.length===0){H.value=0,P.value=0;return}const l=e.map(c=>c.id),{data:i}=await d.from("bonos").select("id, monto_total").eq("pagado",!0).in("paciente_id",l);if(i&&i.length>0){P.value=i.length;const c=i.reduce((b,B)=>b+(B.monto_total||0),0);H.value=c*.7}else H.value=0,P.value=0}catch(a){console.error("Error al cargar pagos confirmados:",a),H.value=0,P.value=0}}const ke=a=>a.toFixed(2),Ce=async a=>{a.tipo==="confirmacion"&&a.accion==="confirmar"&&a.id?(await ee(a.id),await I()):a.tipo==="clinico"&&a.id&&Z(a.id)};Te(async()=>{await he(),await N(),await xe(),await ye(),await we(),await I(),window.addEventListener("citas:actualizadas",te)}),Pe(()=>{window.removeEventListener("citas:actualizadas",te)});function te(a){console.log("ðŸ“¡ [Dashboard] Evento recibido:",a.detail),N()}return(a,e)=>{const l=je,i=Ie,c=et,b=st,B=ft,U=ze;return n(),r("div",pt,[t("div",ht,[t("header",xt,[t("div",null,[e[5]||(e[5]=t("h1",{class:"text-3xl font-bold text-gray-900 tracking-tight"}," Dashboard ",-1)),t("p",yt,[e[3]||(e[3]=t("span",null,"Bienvenida de nuevo,",-1)),t("span",wt,g(s(M)?.nombre||"Karem"),1),e[4]||(e[4]=t("span",{class:"text-xl"},"ðŸ‘‹",-1))])]),t("div",{class:"flex items-center gap-3"},[t("button",{onClick:X,class:"inline-flex items-center gap-2 px-5 py-2.5 bg-violet-600 text-white rounded-xl font-medium hover:bg-violet-700 transition-all shadow-lg shadow-violet-200 hover:shadow-violet-300 hover:-translate-y-0.5"},[...e[6]||(e[6]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),z(" Nueva Cita ",-1)])]),t("button",{onClick:ve,class:"inline-flex items-center gap-2 px-5 py-2.5 bg-white text-gray-700 rounded-xl font-medium border border-gray-200 hover:border-violet-300 hover:text-violet-700 transition-all hover:-translate-y-0.5"},[...e[7]||(e[7]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"})],-1),z(" Nuevo Paciente ",-1)])])])]),t("div",kt,[t("section",Ct,[t("div",_t,[t("div",Dt,[e[9]||(e[9]=t("div",{class:"w-10 h-10 rounded-xl bg-violet-100 flex items-center justify-center"},[t("svg",{class:"w-5 h-5 text-violet-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1)),t("div",null,[e[8]||(e[8]=t("h2",{class:"text-lg font-semibold text-gray-900"},"PrÃ³ximas Sesiones",-1)),t("p",jt,g(s(re)),1)])]),T(l,{to:"/terapeuta/agenda",class:"inline-flex items-center gap-1 text-sm font-medium text-violet-600 hover:text-violet-700 transition-colors"},{default:Q(()=>[...e[10]||(e[10]=[z(" Ver agenda ",-1),t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])]),_:1})]),t("div",$t,[s(f)?(n(),r("div",St,[...e[11]||(e[11]=[t("div",{class:"w-10 h-10 border-3 border-violet-200 border-t-violet-600 rounded-full animate-spin mb-3"},null,-1),t("p",{class:"text-sm text-gray-500"},"Cargando sesiones...",-1)])])):s(y).length===0?(n(),r("div",Mt,[e[12]||(e[12]=L('<div class="w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mb-4" data-v-ea049a3c><svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-ea049a3c><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" data-v-ea049a3c></path></svg></div><p class="text-gray-600 font-medium" data-v-ea049a3c>No hay sesiones programadas</p><p class="text-sm text-gray-400 mt-1" data-v-ea049a3c>Las prÃ³ximas citas aparecerÃ¡n aquÃ­</p>',3)),t("button",{onClick:X,class:"mt-4 px-4 py-2 text-sm font-medium text-violet-600 hover:text-violet-700 hover:bg-violet-50 rounded-lg transition-colors"}," + Agendar una cita ")])):(n(),r("div",Bt,[(n(!0),r(Y,null,G(s(ie),(m,h)=>(n(),K(i,{key:m.id,id:m.id,hora:m.hora_inicio,"paciente-nombre":m.paciente_nombre,modalidad:m.modalidad,estado:m.estado,"is-next":h===0,onClick:Z,onConfirmar:ee},null,8,["id","hora","paciente-nombre","modalidad","estado","is-next"]))),128)),s(y).length>5&&!s(E)?(n(),r("button",{key:0,onClick:e[0]||(e[0]=m=>E.value=!0),class:"w-full py-3 text-sm font-medium text-violet-600 hover:text-violet-700 hover:bg-violet-50 rounded-xl transition-colors flex items-center justify-center gap-2"},[t("span",null,"Ver "+g(s(y).length-5)+" sesiones mÃ¡s",1),e[13]||(e[13]=t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1))])):j("",!0),s(E)&&s(y).length>5?(n(),r("button",{key:1,onClick:e[1]||(e[1]=m=>E.value=!1),class:"w-full py-3 text-sm font-medium text-gray-500 hover:text-gray-700 hover:bg-gray-50 rounded-xl transition-colors flex items-center justify-center gap-2"},[...e[14]||(e[14]=[t("span",null,"Mostrar menos",-1),t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 15l7-7 7 7"})],-1)])])):j("",!0)]))])]),t("section",Ut,[t("div",Tt,[e[16]||(e[16]=L('<div class="flex items-center gap-3" data-v-ea049a3c><div class="w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center" data-v-ea049a3c><svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-ea049a3c><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" data-v-ea049a3c></path></svg></div><h2 class="text-lg font-semibold text-gray-900" data-v-ea049a3c>Pacientes</h2></div>',1)),T(l,{to:"/terapeuta/pacientes",class:"inline-flex items-center gap-1 text-sm font-medium text-blue-600 hover:text-blue-700 transition-colors"},{default:Q(()=>[...e[15]||(e[15]=[z(" Ver todos ",-1),t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])]),_:1})]),t("div",Pt,[s(_)?(n(),r("div",zt,[...e[17]||(e[17]=[t("div",{class:"w-8 h-8 border-2 border-blue-200 border-t-blue-600 rounded-full animate-spin mb-2"},null,-1),t("p",{class:"text-sm text-gray-500"},"Cargando...",-1)])])):s(S).length===0?(n(),r("div",Vt,[...e[18]||(e[18]=[t("div",{class:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center mb-3"},[t("svg",{class:"w-6 h-6 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})])],-1),t("p",{class:"text-gray-500 text-sm"},"Sin pacientes activos",-1)])])):(n(),r("div",Et,[(n(!0),r(Y,null,G(s(S),m=>(n(),K(c,{key:m.id,id:m.id,nombre:m.nombre_completo,"ultima-sesion":m.ultima_sesion,"sesiones-usadas":m.sesiones_usadas,"sesiones-totales":m.sesiones_totales,"estado-bono":m.estado_bono,onClick:fe},null,8,["id","nombre","ultima-sesion","sesiones-usadas","sesiones-totales","estado-bono"]))),128))]))])])]),t("div",Ht,[t("section",At,[e[19]||(e[19]=L('<div class="flex items-center gap-3 px-6 py-4 border-b border-gray-100" data-v-ea049a3c><div class="w-10 h-10 rounded-xl bg-gradient-to-br from-violet-100 to-purple-100 flex items-center justify-center" data-v-ea049a3c><svg class="w-5 h-5 text-violet-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-ea049a3c><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" data-v-ea049a3c></path></svg></div><h2 class="text-lg font-semibold text-gray-900" data-v-ea049a3c>AnalÃ­tica del Profesional</h2></div>',1)),t("div",Nt,[t("div",Lt,[T(b,{value:s(D),label:"Pacientes activos",icon:"ðŸ‘¥",variant:"blue"},null,8,["value"]),T(b,{value:s(p),label:"Sesiones este mes",icon:"ðŸ“…",variant:"purple"},null,8,["value"]),T(b,{value:`${s(w)}%`,label:"Asistencia promedio",icon:"âœ“",variant:"neutral"},null,8,["value"]),T(b,{value:`${ke(s(H))}â‚¬`,label:"Pagos confirmados",sublabel:`${s(P)} ${s(P)===1?"bono":"bonos"}`,icon:"ðŸ’¶",variant:"green",to:"/terapeuta/sesiones"},null,8,["value","sublabel"])])])]),t("section",qt,[t("div",Rt,[e[21]||(e[21]=L('<div class="flex items-center gap-3" data-v-ea049a3c><div class="w-10 h-10 rounded-xl bg-amber-100 flex items-center justify-center" data-v-ea049a3c><svg class="w-5 h-5 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-ea049a3c><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" data-v-ea049a3c></path></svg></div><h2 class="text-lg font-semibold text-gray-900" data-v-ea049a3c>Recordatorios</h2></div>',1)),s(O)?j("",!0):(n(),r("button",{key:0,onClick:I,class:"p-2 text-gray-400 hover:text-violet-600 hover:bg-violet-50 rounded-lg transition-colors",title:"Actualizar recordatorios"},[...e[20]||(e[20]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)])]))]),t("div",Ot,[s(O)?(n(),r("div",It,[...e[22]||(e[22]=[t("div",{class:"w-8 h-8 border-2 border-amber-200 border-t-amber-600 rounded-full animate-spin mb-2"},null,-1),t("p",{class:"text-sm text-gray-500"},"Cargando...",-1)])])):s(A).length===0?(n(),r("div",Ft,[...e[23]||(e[23]=[L('<div class="w-12 h-12 rounded-full bg-emerald-100 flex items-center justify-center mb-3" data-v-ea049a3c><svg class="w-6 h-6 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-ea049a3c><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" data-v-ea049a3c></path></svg></div><p class="text-gray-600 font-medium" data-v-ea049a3c>Todo al dÃ­a</p><p class="text-sm text-gray-400 mt-1" data-v-ea049a3c>No hay recordatorios pendientes</p>',3)])])):(n(),r("div",Kt,[(n(!0),r(Y,null,G(s(be),(m,h)=>(n(),K(B,{key:m.id||h,id:m.id,tipo:m.tipo,mensaje:m.mensaje,paciente:m.paciente,fecha:m.fecha,hora:m.hora,urgente:m.urgente,accion:m.accion,onAccion:Ce},null,8,["id","tipo","mensaje","paciente","fecha","hora","urgente","accion"]))),128)),s(A).length>4?(n(),r("button",{key:0,onClick:e[2]||(e[2]=m=>R.value=!s(R)),class:"w-full py-2 text-sm font-medium text-gray-500 hover:text-gray-700 hover:bg-gray-50 rounded-lg transition-colors"},g(s(R)?"Mostrar menos":`Ver ${s(A).length-4} mÃ¡s`),1)):j("",!0)]))])])])]),T(U,{"is-open":s(k),"cita-id":s(V),onClose:pe,onCitaActualizada:N,onActualizado:N},null,8,["is-open","cita-id"])])}}}),ra=ne(Yt,[["__scopeId","data-v-ea049a3c"]]);export{ra as default};
