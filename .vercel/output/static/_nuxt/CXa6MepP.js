import{_ as $}from"./CIxdp835.js";import{e as V,f as F,r as i,g as B,c as b,o as x,a as o,h as L,i as A,j as D,v as E,k as r,l as h,t as y,d as k,b as M,w as O,m as j,n as C}from"#entry";const q={class:"min-h-screen flex items-center justify-center bg-[#F9F7F3]"},z={class:"max-w-md w-full bg-white rounded-lg shadow-lg p-8"},W={key:0,class:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm font-['Lato']"},G={key:1,class:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg text-sm font-['Lato']"},H=["disabled"],J={class:"mt-6 text-center space-y-2"},K={class:"text-sm font-['Lato'] text-[#5D4A44] opacity-70"},Q={class:"bg-white rounded-lg p-6 max-w-md w-full"},X={class:"flex gap-3"},Y=["disabled"],ae=V({__name:"login",setup(Z){const{signInWithEmail:R,resetPassword:U,isAuthenticated:S}=F(),p=i(""),v=i(""),u=i(""),l=i(!1),m=i(!1),a=i(""),d=i(""),c=i(!1),I=async s=>{try{console.log("[Login] Esperando a que el usuario y perfil estén disponibles...");const{waitForUser:e,userProfile:t,loadUserProfile:n,getUserId:P}=F();if(console.log("[Login] Estado ANTES de waitForUser:",{userProfileExists:!!t.value,userId:P()}),await e(),console.log("[Login] Estado DESPUÉS de waitForUser:",{userProfileExists:!!t.value,userId:P(),profile:t.value}),!t.value){console.log("[Login] Perfil no cargado después de waitForUser, intentando carga manual...");for(let g=1;g<=3&&(await n(),console.log(`[Login] Intento ${g} de loadUserProfile:`,{userProfileExists:!!t.value,profile:t.value}),!t.value);g++)await new Promise(T=>setTimeout(T,500))}if(!t.value){console.error("[Login] No se pudo cargar el perfil después de todos los intentos"),a.value="Error al cargar tu perfil. Por favor, intenta de nuevo.";return}const f=t.value.rol;console.log("[Login] Perfil obtenido:",t.value.email,"Rol:",f);const w={psicologa:"/terapeuta/dashboard",terapeuta:"/terapeuta/dashboard",coordinadora:"/coordinadora/dashboard",admin:"/admin"}[f];if(!w){console.error(`[Login] Rol no reconocido: '${f}'`),a.value=`Acceso no autorizado. Tu rol '${f}' no tiene permisos para acceder al sistema.`,await j().auth.signOut();return}console.log(`[Login] Redirigiendo usuario con rol '${f}' a ${w}`),await C(w,{replace:!0})}catch(e){console.error("[Login] Error al redirigir:",e),a.value="Error al iniciar sesión. Por favor, intenta de nuevo."}};B(async()=>{S.value&&await I()});const _=async()=>{a.value="",d.value="",l.value=!0;try{localStorage.clear(),sessionStorage.clear(),document.cookie.split(";").forEach(function(t){document.cookie=t.replace(/^ +/,"").replace(/=.*/,"=;expires="+new Date().toUTCString()+";path=/")});const{data:s,error:e}=await R(p.value,v.value);if(e){console.error("[Login] Error de autenticación:",e),a.value="Credenciales incorrectas. Por favor, verifica tu correo y contraseña.",l.value=!1;return}if(!s?.user){a.value="Error al iniciar sesión. Por favor, intenta de nuevo.",l.value=!1;return}console.log("[Login] Usuario autenticado:",s.user.email,"ID:",s.user.id),d.value="Inicio de sesión exitoso. Redirigiendo...",await C("/dashboard",{replace:!0})}catch(s){console.error("[Login] Error en handleLogin:",s),a.value="Ocurrió un error. Por favor, intenta de nuevo."}finally{l.value=!1}},N=async()=>{a.value="",d.value="",m.value=!0;try{const{error:s}=await U(u.value);s?a.value="No se pudo enviar el correo de recuperación.":(d.value="Correo de recuperación enviado. Revisa tu bandeja de entrada.",c.value=!1,u.value="")}catch{a.value="Ocurrió un error. Por favor, intenta de nuevo."}finally{m.value=!1}};return(s,e)=>{const t=$;return x(),b("div",q,[o("div",z,[e[12]||(e[12]=o("div",{class:"text-center mb-8"},[o("h1",{class:"text-3xl font-['Lora'] font-medium text-[#5D4A44]"},"Bienvenida"),o("p",{class:"font-['Lato'] text-[#5D4A44] opacity-70 mt-2"}," Inicia sesión para acceder a tu espacio "),o("p",{class:"font-['Lato'] text-sm text-[#D8AFA0] mt-3"}," Sistema de gestión para psicólogas y espacio de bienestar para pacientes ")],-1)),o("form",{onSubmit:A(_,["prevent"]),class:"space-y-6"},[o("div",null,[e[6]||(e[6]=o("label",{for:"email",class:"block font-['Lato'] text-sm font-medium text-[#5D4A44] mb-2"}," Correo electrónico ",-1)),D(o("input",{id:"email","onUpdate:modelValue":e[0]||(e[0]=n=>h(p)?p.value=n:null),type:"email",required:"",class:"w-full px-4 py-3 border border-[#EAD5D3] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D8AFA0] transition-all font-['Lato']",placeholder:"tu@email.com"},null,512),[[E,r(p)]])]),o("div",null,[e[7]||(e[7]=o("label",{for:"password",class:"block font-['Lato'] text-sm font-medium text-[#5D4A44] mb-2"}," Contraseña ",-1)),D(o("input",{id:"password","onUpdate:modelValue":e[1]||(e[1]=n=>h(v)?v.value=n:null),type:"password",required:"",class:"w-full px-4 py-3 border border-[#EAD5D3] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D8AFA0] transition-all font-['Lato']",placeholder:"••••••••"},null,512),[[E,r(v)]])]),r(a)?(x(),b("div",W,y(r(a)),1)):L("",!0),r(d)?(x(),b("div",G,y(r(d)),1)):L("",!0),o("button",{type:"submit",disabled:r(l),class:"w-full bg-[#D8AFA0] hover:bg-[#c99d8d] text-white py-3 rounded-lg transition-all duration-300 font-['Lato'] font-medium disabled:opacity-50 disabled:cursor-not-allowed"},y(r(l)?"Iniciando sesión...":"Iniciar Sesión"),9,H)],32),o("div",J,[o("button",{onClick:e[2]||(e[2]=n=>c.value=!0),class:"text-sm font-['Lato'] text-[#5D4A44] hover:text-[#D8AFA0] underline"}," ¿Olvidaste tu contraseña? "),o("p",K,[e[9]||(e[9]=k(" ¿Necesitas acceso? ",-1)),M(t,{to:"/contacto",class:"text-[#D8AFA0] hover:text-[#c99d8d] font-medium"},{default:O(()=>[...e[8]||(e[8]=[k(" Contáctame ",-1)])]),_:1})])]),r(c)?(x(),b("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",onClick:e[5]||(e[5]=A(n=>c.value=!1,["self"]))},[o("div",Q,[e[10]||(e[10]=o("h3",{class:"text-xl font-['Lora'] font-medium text-[#5D4A44] mb-4"},"Recuperar Contraseña",-1)),e[11]||(e[11]=o("p",{class:"font-['Lato'] text-[#5D4A44] opacity-70 mb-4"}," Ingresa tu correo electrónico y te enviaremos un enlace para restablecer tu contraseña. ",-1)),o("form",{onSubmit:A(N,["prevent"]),class:"space-y-4"},[D(o("input",{"onUpdate:modelValue":e[3]||(e[3]=n=>h(u)?u.value=n:null),type:"email",required:"",class:"w-full px-4 py-3 border border-[#EAD5D3] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D8AFA0] font-['Lato']",placeholder:"tu@email.com"},null,512),[[E,r(u)]]),o("div",X,[o("button",{type:"button",onClick:e[4]||(e[4]=n=>c.value=!1),class:"flex-1 px-4 py-2 border border-[#EAD5D3] text-[#5D4A44] rounded-lg hover:bg-[#F9F7F3] transition-colors font-['Lato']"}," Cancelar "),o("button",{type:"submit",disabled:r(m),class:"flex-1 px-4 py-2 bg-[#D8AFA0] text-white rounded-lg hover:bg-[#c99d8d] transition-colors disabled:opacity-50 font-['Lato']"},y(r(m)?"Enviando...":"Enviar"),9,Y)])],32)])])):L("",!0)])])}}});export{ae as default};
