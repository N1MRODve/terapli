import{e as ge,L as me,p as xe,f as ye,r as g,x as $,g as be,c as i,a as e,h as x,J as z,A as c,l as s,d as k,t as r,b as m,F as N,y as U,k as b,v as P,m as H,K as W,i as fe,w as ve,M as _e,T as he,o as l,z as X,j as we}from"#entry";import{u as ke}from"./useBonos-yaUVQI0C.js";import{r as Pe}from"./PlusIcon-UqRq4KLf.js";import{r as A}from"./TicketIcon-DRclOuRO.js";import{r as Y}from"./ChevronRightIcon-Ck2OajRo.js";import{r as Ce}from"./CheckIcon-BAcWvHoW.js";import{r as Se}from"./CheckCircleIcon-Bi0YyG7H.js";import{r as qe}from"./PencilIcon-QJyqa3i7.js";import{r as Te}from"./TrashIcon-c8JhvyFk.js";import{r as $e}from"./MagnifyingGlassIcon-B5My0XuL.js";import{r as je}from"./XMarkIcon-DWNj0d99.js";const Me={class:"mb-6"},Ve={class:"flex items-center justify-between mb-4"},Be={class:"flex items-center gap-6"},Ee={class:"flex items-center gap-1 bg-gray-100 rounded-lg p-1"},Ne={key:0,class:"bg-white border border-gray-100 rounded-lg p-3 mb-4"},Ue={class:"flex flex-wrap items-center gap-x-6 gap-y-2 text-sm"},Ae={class:"flex items-center gap-2"},De={class:"font-semibold text-gray-900"},Fe={class:"flex items-center gap-2"},Le={class:"font-semibold text-gray-900"},ze={class:"flex items-center gap-2"},Oe={class:"font-semibold text-gray-900"},Ge={class:"ml-auto flex items-center gap-2 pl-4 border-l border-gray-200"},Qe={class:"font-bold text-green-600"},Ie={key:0,class:"space-y-6"},Je={key:0,class:"flex items-center justify-center py-20"},Re={key:1,class:"bg-white border border-gray-100 rounded-lg py-12 text-center"},Ke={key:2,class:"grid gap-4"},He={class:"px-5 py-4 border-b border-gray-100 bg-gray-50/50"},We={class:"flex items-center justify-between"},Xe={class:"flex items-center gap-3"},Ye={class:"font-semibold text-gray-900"},Ze={class:"text-sm text-gray-500"},et={class:"flex items-center gap-4 text-sm"},tt={class:"text-right"},st={class:"font-semibold text-green-600"},ot={class:"text-right"},at={class:"font-semibold text-gray-600"},rt={class:"text-right"},nt={class:"font-semibold text-gray-900"},lt={class:"divide-y divide-gray-50"},it=["onClick"],dt={class:"flex items-center gap-3"},ut={class:"w-8 h-8 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center text-xs font-semibold"},ct={class:"text-sm font-medium text-gray-900"},pt={class:"flex items-center gap-2 text-xs text-gray-500"},gt={class:"flex items-center gap-4"},mt={class:"w-24 h-1.5 bg-gray-200 rounded-full overflow-hidden"},xt={class:"text-right min-w-[80px]"},yt={class:"text-sm font-medium text-gray-900"},bt={class:"px-5 py-3 bg-gray-50/50 border-t border-gray-100 flex items-center justify-between text-sm"},ft={class:"flex items-center gap-4"},vt={class:"text-gray-500"},_t={class:"font-medium text-gray-700"},ht={class:"text-gray-500"},wt={class:"font-medium text-gray-700"},kt={class:"flex items-center gap-2"},Pt={class:"font-semibold text-amber-600"},Ct={key:1,class:"space-y-4"},St={class:"bg-white border border-gray-100 rounded-lg p-4"},qt={class:"flex flex-wrap items-center gap-4"},Tt={class:"flex items-center gap-2"},$t={class:"relative"},jt={class:"flex items-center gap-2"},Mt={class:"relative"},Vt={class:"flex items-center gap-2"},Bt={class:"relative"},Et=["disabled"],Nt={key:1,class:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"},Ut={class:"bg-white border border-gray-100 rounded-lg overflow-hidden"},At={key:0,class:"py-12 text-center"},Dt={key:1,class:"w-full"},Ft={class:"divide-y divide-gray-50"},Lt={class:"px-4 py-3"},zt={class:"text-sm font-medium text-gray-900"},Ot={key:0,class:"text-xs text-gray-500"},Gt={class:"px-4 py-3"},Qt={class:"px-4 py-3 text-center text-sm text-gray-600"},It={class:"px-4 py-3 text-right text-sm font-medium text-gray-900"},Jt={class:"px-4 py-3"},Rt={class:"flex items-center justify-end gap-1"},Kt=["onClick"],Ht=["onClick"],Wt={key:2,class:"space-y-4"},Xt={class:"flex flex-wrap items-center gap-3"},Yt={class:"relative flex-1 min-w-[200px] max-w-md"},Zt={key:0,class:"flex items-center justify-center py-20"},es={key:1,class:"bg-white border border-gray-100 rounded-lg overflow-hidden"},ts={key:0,class:"py-12 text-center"},ss={class:"text-gray-600 font-medium mb-1"},os={class:"text-sm text-gray-400"},as={key:1,class:"w-full"},rs={class:"divide-y divide-gray-50"},ns=["onClick"],ls={class:"px-4 py-3"},is={class:"flex items-center gap-2"},ds={class:"w-8 h-8 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center text-xs font-semibold flex-shrink-0"},us={class:"text-sm font-medium text-gray-900 truncate"},cs={class:"px-4 py-3"},ps={class:"text-sm text-gray-600"},gs={class:"px-4 py-3"},ms={class:"flex items-center gap-2 justify-center"},xs={class:"w-16 h-1.5 bg-gray-200 rounded-full overflow-hidden"},ys={class:"text-xs text-gray-500"},bs={class:"px-4 py-3"},fs={class:"px-4 py-3 text-right"},vs={class:"text-sm font-medium text-gray-900"},_s={class:"px-4 py-3 text-right"},hs={class:"bg-white rounded-xl shadow-2xl w-full max-w-md"},ws={class:"px-5 py-4 border-b border-gray-100 flex items-center justify-between"},ks={class:"font-semibold text-gray-900"},Ps={class:"p-5 space-y-4"},Cs={class:"grid grid-cols-2 gap-3"},Ss={class:"px-5 py-4 border-t border-gray-100 flex items-center justify-end gap-3"},qs=["disabled"],Ls=ge({__name:"bonos",setup(Ts){const Z=me(),T=xe(),{user:D}=ye(),{calcularPorcentajeUso:ee}=ke(),p=g("resumen"),f=g([]),j=g(!1),C=g(null),d=g({nombre:"",descripcion:"",sesiones:4,precio:160,frecuencia:"mensual"}),y=g({semanal:40,quincenal:50,unica:60}),F=g({semanal:40,quincenal:50,unica:60}),S=g(!1),q=g(!1),te=$(()=>JSON.stringify(y.value)!==JSON.stringify(F.value)),v=g([]),M=g(!1),_=g(""),h=g(""),L=$(()=>{const a=new Map;for(const t of v.value){const o=t.tipo||"otro";a.has(o)||a.set(o,{tipo:o,pacientes:[],activos:0,completados:0,montoTotal:0,montoPendiente:0,precioPromedio:0,sesionesPromedio:0});const n=a.get(o);n.pacientes.push({bono_id:t.id,paciente_id:t.paciente_id,nombre:t.paciente_nombre||"Desconocido",sesiones_usadas:t.sesiones_totales-t.sesiones_restantes,sesiones_totales:t.sesiones_totales,estado:t.estado,monto:t.monto_total||0,pagado:t.pagado}),n.montoTotal+=t.monto_total||0,t.pagado||(n.montoPendiente+=t.monto_total||0),t.estado==="activo"&&n.activos++,t.estado==="completado"&&n.completados++}for(const t of a.values())if(t.pacientes.length>0){t.precioPromedio=t.montoTotal/t.pacientes.length;const o=t.pacientes.reduce((n,u)=>n+u.sesiones_totales,0);t.sesionesPromedio=Math.round(o/t.pacientes.length)}return Array.from(a.values()).sort((t,o)=>o.pacientes.length-t.pacientes.length)});$(()=>v.value.filter(a=>a.estado==="activo").length);const V=$(()=>{const a=v.value.filter(u=>u.estado==="activo").length,t=v.value.filter(u=>u.estado==="pendiente").length,o=v.value.filter(u=>u.estado==="completado").length,n=v.value.filter(u=>!u.pagado).reduce((u,w)=>u+(w.monto_total||0),0);return{activos:a,pendientes:t,completados:o,montoPendiente:n}}),O=$(()=>{let a=v.value;if(_.value){const t=_.value.toLowerCase();a=a.filter(o=>o.paciente_nombre?.toLowerCase().includes(t))}return h.value&&(a=a.filter(t=>t.estado===h.value)),a}),G=()=>{d.value={nombre:"",descripcion:"",sesiones:4,precio:160,frecuencia:"mensual"},C.value=null,j.value=!0},se=a=>{const t=f.value[a];d.value={...t},C.value=a,j.value=!0},oe=a=>{confirm("¿Eliminar esta plantilla?")&&(f.value.splice(a,1),Q())},B=()=>{j.value=!1,C.value=null},ae=async()=>{C.value!==null?f.value[C.value]={...d.value}:f.value.push({...d.value}),await Q(),B()},Q=async()=>{try{const{error:a}=await T.from("terapeutas").update({plantillas_bonos:f.value}).eq("email",D.value?.email);if(a)throw a}catch(a){console.error("Error al guardar plantillas:",a)}},re=async()=>{S.value=!0,q.value=!1;try{const{error:a}=await T.from("terapeutas").update({precios_frecuencia:y.value}).eq("email",D.value?.email);if(a)throw a;F.value={...y.value},q.value=!0,setTimeout(()=>{q.value=!1},2e3)}catch(a){console.error("Error al guardar precios:",a)}finally{S.value=!1}},I=a=>{Z.push(`/terapeuta/pacientes/${a.paciente_id}/bonos`)},E=a=>a?.toFixed(2)||"0.00",J=a=>({semanal:"Semanal",quincenal:"Quincenal",mensual:"Mensual",cualquiera:"Cualquiera",otro:"Otro"})[a]||a||"Otro",ne=a=>({semanal:"bg-blue-100 text-blue-700",quincenal:"bg-purple-100 text-purple-700",mensual:"bg-amber-100 text-amber-700",cualquiera:"bg-gray-100 text-gray-700"})[a]||"bg-gray-100 text-gray-700",R=a=>a?a.split(" ").map(t=>t[0]).join("").substring(0,2).toUpperCase():"?",K=a=>({activo:"Activo",pendiente:"Pendiente",completado:"Completado",vencido:"Vencido",agotado:"Agotado"})[a]||a,le=a=>({activo:"text-green-600",pendiente:"text-amber-600",completado:"text-gray-600",vencido:"text-red-600",agotado:"text-gray-500"})[a]||"text-gray-600",ie=a=>({activo:"bg-green-500",pendiente:"bg-amber-500",completado:"bg-gray-400",vencido:"bg-red-500",agotado:"bg-gray-400"})[a]||"bg-gray-400",de=a=>a.estado==="activo"?"bg-purple-500":a.estado==="completado"||a.estado==="agotado"?"bg-green-500":"bg-gray-400",ue=a=>({semanal:"Bono Semanal",quincenal:"Bono Quincenal",mensual:"Bono Mensual","5_sesiones":"Bono 5 Sesiones","10_sesiones":"Bono 10 Sesiones",personalizado:"Bono Personalizado",otro:"Otros Bonos"})[a]||`Bono ${a.charAt(0).toUpperCase()+a.slice(1)}`,ce=a=>({semanal:"bg-blue-100 text-blue-600",quincenal:"bg-purple-100 text-purple-600",mensual:"bg-amber-100 text-amber-600","5_sesiones":"bg-emerald-100 text-emerald-600","10_sesiones":"bg-teal-100 text-teal-600",personalizado:"bg-pink-100 text-pink-600",otro:"bg-gray-100 text-gray-600"})[a]||"bg-gray-100 text-gray-600",pe=async()=>{try{const{data:a}=await T.from("terapeutas").select("id, plantillas_bonos, precios_frecuencia").eq("email",D.value?.email).single();if(a){f.value=a.plantillas_bonos||[],a.precios_frecuencia&&(y.value=a.precios_frecuencia,F.value={...a.precios_frecuencia}),M.value=!0;const{data:t}=await T.from("pacientes").select("id, nombre_completo").eq("terapeuta_id",a.id);if(t&&t.length>0){const o=t.map(w=>w.id),n=new Map(t.map(w=>[w.id,w.nombre_completo])),{data:u}=await T.from("bonos").select("*").in("paciente_id",o).order("created_at",{ascending:!1});u&&(v.value=u.map(w=>({...w,paciente_nombre:n.get(w.paciente_id)||"Desconocido"})))}}}catch(a){console.error("Error al cargar datos:",a)}finally{M.value=!1}};return be(()=>{pe()}),(a,t)=>(l(),i("div",null,[e("header",Me,[e("div",Ve,[e("div",Be,[t[17]||(t[17]=e("h1",{class:"text-2xl font-semibold text-gray-900"},"Bonos",-1)),e("nav",Ee,[e("button",{onClick:t[0]||(t[0]=o=>p.value="resumen"),class:c(["px-3 py-1.5 text-sm font-medium rounded-md transition-all",s(p)==="resumen"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"])},[t[14]||(t[14]=k(" Por Tipo ",-1)),e("span",{class:c(["ml-1 text-xs",s(p)==="resumen"?"text-gray-500":"text-gray-400"])},r(s(L).length),3)],2),e("button",{onClick:t[1]||(t[1]=o=>p.value="bonos"),class:c(["px-3 py-1.5 text-sm font-medium rounded-md transition-all",s(p)==="bonos"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"])},[t[15]||(t[15]=k(" Todos ",-1)),e("span",{class:c(["ml-1 text-xs",s(p)==="bonos"?"text-gray-500":"text-gray-400"])},r(s(v).length),3)],2),e("button",{onClick:t[2]||(t[2]=o=>p.value="plantillas"),class:c(["px-3 py-1.5 text-sm font-medium rounded-md transition-all",s(p)==="plantillas"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"])},[t[16]||(t[16]=k(" Plantillas ",-1)),e("span",{class:c(["ml-1 text-xs",s(p)==="plantillas"?"text-gray-500":"text-gray-400"])},r(s(f).length),3)],2)])]),s(p)==="plantillas"?(l(),i("button",{key:0,onClick:G,class:"h-10 px-4 bg-purple-600 text-white text-sm font-medium rounded-lg hover:bg-purple-700 transition-colors flex items-center gap-2 shadow-sm"},[m(s(Pe),{class:"w-4 h-4"}),t[18]||(t[18]=k(" Nueva Plantilla ",-1))])):x("",!0)]),s(p)==="bonos"||s(p)==="resumen"?(l(),i("div",Ne,[e("div",Ue,[e("div",Ae,[t[19]||(t[19]=e("span",{class:"w-2 h-2 rounded-full bg-green-500"},null,-1)),t[20]||(t[20]=e("span",{class:"text-gray-600"},"Activos:",-1)),e("span",De,r(s(V).activos),1)]),t[26]||(t[26]=e("span",{class:"text-gray-200"},"|",-1)),e("div",Fe,[t[21]||(t[21]=e("span",{class:"w-2 h-2 rounded-full bg-amber-500"},null,-1)),t[22]||(t[22]=e("span",{class:"text-gray-600"},"Pendientes:",-1)),e("span",Le,r(s(V).pendientes),1)]),t[27]||(t[27]=e("span",{class:"text-gray-200"},"|",-1)),e("div",ze,[t[23]||(t[23]=e("span",{class:"w-2 h-2 rounded-full bg-gray-400"},null,-1)),t[24]||(t[24]=e("span",{class:"text-gray-600"},"Completados:",-1)),e("span",Oe,r(s(V).completados),1)]),e("div",Ge,[t[25]||(t[25]=e("span",{class:"text-gray-600"},"Por cobrar:",-1)),e("span",Qe,r(E(s(V).montoPendiente))+"€",1)])])])):x("",!0)]),s(p)==="resumen"?(l(),i("div",Ie,[s(M)?(l(),i("div",Je,[...t[28]||(t[28]=[e("div",{class:"w-8 h-8 border-2 border-purple-600 border-t-transparent rounded-full animate-spin"},null,-1)])])):s(L).length===0?(l(),i("div",Re,[m(s(A),{class:"w-12 h-12 text-gray-300 mx-auto mb-3"}),t[29]||(t[29]=e("p",{class:"text-gray-600 font-medium mb-1"},"Sin bonos asignados",-1)),t[30]||(t[30]=e("p",{class:"text-sm text-gray-400"},"Los bonos de tus pacientes apareceran aqui agrupados por tipo",-1))])):(l(),i("div",Ke,[(l(!0),i(N,null,U(s(L),o=>(l(),i("div",{key:o.tipo,class:"bg-white border border-gray-100 rounded-lg overflow-hidden"},[e("div",He,[e("div",We,[e("div",Xe,[e("div",{class:c(["w-10 h-10 rounded-lg flex items-center justify-center",ce(o.tipo)])},[m(s(A),{class:"w-5 h-5"})],2),e("div",null,[e("h3",Ye,r(ue(o.tipo)),1),e("p",Ze,r(o.pacientes.length)+" "+r(o.pacientes.length===1?"paciente":"pacientes"),1)])]),e("div",et,[e("div",tt,[t[31]||(t[31]=e("p",{class:"text-gray-500"},"Activos",-1)),e("p",st,r(o.activos),1)]),e("div",ot,[t[32]||(t[32]=e("p",{class:"text-gray-500"},"Completados",-1)),e("p",at,r(o.completados),1)]),e("div",rt,[t[33]||(t[33]=e("p",{class:"text-gray-500"},"Total facturado",-1)),e("p",nt,r(E(o.montoTotal))+"€",1)])])])]),e("div",lt,[(l(!0),i(N,null,U(o.pacientes,n=>(l(),i("div",{key:n.bono_id,class:"px-5 py-3 hover:bg-gray-50/50 transition-colors cursor-pointer flex items-center justify-between",onClick:u=>I({paciente_id:n.paciente_id})},[e("div",dt,[e("div",ut,r(R(n.nombre)),1),e("div",null,[e("p",ct,r(n.nombre),1),e("div",pt,[e("span",null,r(n.sesiones_usadas)+"/"+r(n.sesiones_totales)+" sesiones",1),t[34]||(t[34]=e("span",{class:"text-gray-300"},"|",-1)),e("span",{class:c(n.estado==="activo"?"text-green-600":"text-gray-500")},r(K(n.estado)),3)])])]),e("div",gt,[e("div",mt,[e("div",{class:c(["h-full rounded-full transition-all",n.estado==="activo"?"bg-purple-500":"bg-gray-400"]),style:X({width:`${n.sesiones_usadas/n.sesiones_totales*100}%`})},null,6)]),e("div",xt,[e("p",yt,r(n.monto)+"€",1),e("p",{class:c(["text-xs",n.pagado?"text-green-600":"text-amber-600"])},r(n.pagado?"Pagado":"Pendiente"),3)]),m(s(Y),{class:"w-4 h-4 text-gray-400"})])],8,it))),128))]),e("div",bt,[e("div",ft,[e("span",vt,[t[35]||(t[35]=k(" Precio promedio: ",-1)),e("span",_t,r(E(o.precioPromedio))+"€",1)]),t[37]||(t[37]=e("span",{class:"text-gray-300"},"|",-1)),e("span",ht,[t[36]||(t[36]=k(" Sesiones promedio: ",-1)),e("span",wt,r(o.sesionesPromedio),1)])]),e("div",kt,[t[38]||(t[38]=e("span",{class:"text-gray-500"},"Por cobrar:",-1)),e("span",Pt,r(E(o.montoPendiente))+"€",1)])])]))),128))]))])):x("",!0),s(p)==="plantillas"?(l(),i("div",Ct,[e("div",St,[e("div",qt,[t[45]||(t[45]=e("span",{class:"text-sm font-medium text-gray-700"},"Precios base:",-1)),e("div",Tt,[t[40]||(t[40]=e("label",{class:"text-sm text-gray-500"},"Semanal",-1)),e("div",$t,[b(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>s(y).semanal=o),type:"number",step:"0.01",min:"0",class:"w-20 h-9 px-2 pr-6 text-sm bg-gray-50 border border-gray-200 rounded-lg focus:ring-1 focus:ring-purple-500 focus:border-purple-500"},null,512),[[P,s(y).semanal,void 0,{number:!0}]]),t[39]||(t[39]=e("span",{class:"absolute right-2 top-1/2 -translate-y-1/2 text-xs text-gray-400"},"€",-1))])]),t[46]||(t[46]=e("span",{class:"text-gray-300"},"|",-1)),e("div",jt,[t[42]||(t[42]=e("label",{class:"text-sm text-gray-500"},"Quincenal",-1)),e("div",Mt,[b(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>s(y).quincenal=o),type:"number",step:"0.01",min:"0",class:"w-20 h-9 px-2 pr-6 text-sm bg-gray-50 border border-gray-200 rounded-lg focus:ring-1 focus:ring-purple-500 focus:border-purple-500"},null,512),[[P,s(y).quincenal,void 0,{number:!0}]]),t[41]||(t[41]=e("span",{class:"absolute right-2 top-1/2 -translate-y-1/2 text-xs text-gray-400"},"€",-1))])]),t[47]||(t[47]=e("span",{class:"text-gray-300"},"|",-1)),e("div",Vt,[t[44]||(t[44]=e("label",{class:"text-sm text-gray-500"},"Única",-1)),e("div",Bt,[b(e("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>s(y).unica=o),type:"number",step:"0.01",min:"0",class:"w-20 h-9 px-2 pr-6 text-sm bg-gray-50 border border-gray-200 rounded-lg focus:ring-1 focus:ring-purple-500 focus:border-purple-500"},null,512),[[P,s(y).unica,void 0,{number:!0}]]),t[43]||(t[43]=e("span",{class:"absolute right-2 top-1/2 -translate-y-1/2 text-xs text-gray-400"},"€",-1))])]),e("button",{onClick:re,disabled:s(S),class:c(["ml-auto h-9 px-4 text-sm font-medium rounded-lg transition-colors flex items-center gap-2",s(te)?"bg-purple-600 text-white hover:bg-purple-700":"bg-gray-100 text-gray-500"])},[!s(S)&&!s(q)?(l(),z(s(Ce),{key:0,class:"w-4 h-4"})):x("",!0),s(S)?(l(),i("span",Nt)):x("",!0),s(q)?(l(),z(s(Se),{key:2,class:"w-4 h-4 text-green-500"})):x("",!0),k(" "+r(s(q)?"Guardado":s(S)?"Guardando...":"Guardar"),1)],10,Et)])]),e("div",Ut,[s(f).length===0?(l(),i("div",At,[m(s(A),{class:"w-12 h-12 text-gray-300 mx-auto mb-3"}),t[48]||(t[48]=e("p",{class:"text-gray-600 font-medium mb-1"},"Sin plantillas",-1)),t[49]||(t[49]=e("p",{class:"text-sm text-gray-400 mb-4"},"Crea plantillas para asignar bonos rápidamente",-1)),e("button",{onClick:G,class:"text-sm text-purple-600 font-medium hover:text-purple-700"}," + Crear primera plantilla ")])):(l(),i("table",Dt,[t[50]||(t[50]=e("thead",null,[e("tr",{class:"border-b border-gray-100 bg-gray-50/50"},[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Nombre"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Frecuencia"),e("th",{class:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"},"Sesiones"),e("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Precio"),e("th",{class:"px-4 py-3 w-20"})])],-1)),e("tbody",Ft,[(l(!0),i(N,null,U(s(f),(o,n)=>(l(),i("tr",{key:n,class:"hover:bg-gray-50/50 transition-colors"},[e("td",Lt,[e("div",zt,r(o.nombre),1),o.descripcion?(l(),i("div",Ot,r(o.descripcion),1)):x("",!0)]),e("td",Gt,[e("span",{class:c(["inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",ne(o.frecuencia)])},r(J(o.frecuencia)),3)]),e("td",Qt,r(o.sesiones),1),e("td",It,r(o.precio)+"€",1),e("td",Jt,[e("div",Rt,[e("button",{onClick:u=>se(n),class:"p-1.5 text-gray-400 hover:text-purple-600 hover:bg-purple-50 rounded transition-colors"},[m(s(qe),{class:"w-4 h-4"})],8,Kt),e("button",{onClick:u=>oe(n),class:"p-1.5 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded transition-colors"},[m(s(Te),{class:"w-4 h-4"})],8,Ht)])])]))),128))])]))])])):x("",!0),s(p)==="bonos"?(l(),i("div",Wt,[e("div",Xt,[e("div",Yt,[b(e("input",{"onUpdate:modelValue":t[6]||(t[6]=o=>H(_)?_.value=o:null),type:"text",placeholder:"Buscar por paciente...",class:"w-full h-10 px-4 pl-9 bg-white border border-gray-200 rounded-lg text-sm focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20"},null,512),[[P,s(_)]]),m(s($e),{class:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"})]),b(e("select",{"onUpdate:modelValue":t[7]||(t[7]=o=>H(h)?h.value=o:null),class:"h-10 px-3 bg-white border border-gray-200 rounded-lg text-sm text-gray-700 focus:border-purple-500 focus:ring-1 focus:ring-purple-500/20"},[...t[51]||(t[51]=[fe('<option value="">Todos</option><option value="activo">Activos</option><option value="pendiente">Pendientes</option><option value="completado">Completados</option><option value="vencido">Vencidos</option>',5)])],512),[[W,s(h)]]),s(_)||s(h)?(l(),i("button",{key:0,onClick:t[8]||(t[8]=o=>{_.value="",h.value=""}),class:"h-10 px-3 text-sm text-gray-500 hover:text-gray-700"}," Limpiar ")):x("",!0)]),s(M)?(l(),i("div",Zt,[...t[52]||(t[52]=[e("div",{class:"w-8 h-8 border-2 border-purple-600 border-t-transparent rounded-full animate-spin"},null,-1)])])):(l(),i("div",es,[s(O).length===0?(l(),i("div",ts,[m(s(A),{class:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e("p",ss,r(s(_)||s(h)?"Sin resultados":"Sin bonos"),1),e("p",os,r(s(_)||s(h)?"Prueba ajustando los filtros":"Los bonos de tus pacientes aparecerán aquí"),1)])):(l(),i("table",as,[t[53]||(t[53]=e("thead",null,[e("tr",{class:"border-b border-gray-100 bg-gray-50/50"},[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Paciente"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Tipo"),e("th",{class:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"},"Progreso"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Estado"),e("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Monto"),e("th",{class:"px-4 py-3 w-10"})])],-1)),e("tbody",rs,[(l(!0),i(N,null,U(s(O),o=>(l(),i("tr",{key:o.id,class:"hover:bg-gray-50/50 transition-colors cursor-pointer",onClick:n=>I(o)},[e("td",ls,[e("div",is,[e("div",ds,r(R(o.paciente_nombre)),1),e("span",us,r(o.paciente_nombre),1)])]),e("td",cs,[e("span",ps,r(J(o.tipo)),1)]),e("td",gs,[e("div",ms,[e("div",xs,[e("div",{class:c(["h-full rounded-full transition-all",de(o)]),style:X({width:`${s(ee)(o)}%`})},null,6)]),e("span",ys,r(o.sesiones_totales-o.sesiones_restantes)+"/"+r(o.sesiones_totales),1)])]),e("td",bs,[e("span",{class:c(["inline-flex items-center gap-1.5 text-sm",le(o.estado)])},[e("span",{class:c(["w-1.5 h-1.5 rounded-full",ie(o.estado)])},null,2),k(" "+r(K(o.estado)),1)],2)]),e("td",fs,[e("div",vs,r(o.monto_total)+"€",1),e("div",{class:c(["text-xs",o.pagado?"text-green-600":"text-amber-600"])},r(o.pagado?"Pagado":"Pendiente"),3)]),e("td",_s,[m(s(Y),{class:"w-4 h-4 text-gray-400"})])],8,ns))),128))])]))]))])):x("",!0),(l(),z(he,{to:"body"},[m(_e,{"enter-active-class":"transition-all duration-200","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-all duration-150","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:ve(()=>[s(j)?(l(),i("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",onClick:we(B,["self"])},[e("div",hs,[e("div",ws,[e("h3",ks,r(s(C)!==null?"Editar Plantilla":"Nueva Plantilla"),1),e("button",{onClick:B,class:"p-1 text-gray-400 hover:text-gray-600 rounded"},[m(s(je),{class:"w-5 h-5"})])]),e("div",Ps,[e("div",null,[t[54]||(t[54]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nombre",-1)),b(e("input",{"onUpdate:modelValue":t[9]||(t[9]=o=>s(d).nombre=o),type:"text",placeholder:"Ej: Bono Mensual",class:"w-full h-10 px-3 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-1 focus:ring-purple-500 focus:border-purple-500"},null,512),[[P,s(d).nombre]])]),e("div",null,[t[55]||(t[55]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Descripción (opcional)",-1)),b(e("input",{"onUpdate:modelValue":t[10]||(t[10]=o=>s(d).descripcion=o),type:"text",placeholder:"Descripción breve...",class:"w-full h-10 px-3 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-1 focus:ring-purple-500 focus:border-purple-500"},null,512),[[P,s(d).descripcion]])]),e("div",Cs,[e("div",null,[t[56]||(t[56]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Sesiones",-1)),b(e("input",{"onUpdate:modelValue":t[11]||(t[11]=o=>s(d).sesiones=o),type:"number",min:"1",class:"w-full h-10 px-3 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-1 focus:ring-purple-500 focus:border-purple-500"},null,512),[[P,s(d).sesiones,void 0,{number:!0}]])]),e("div",null,[t[57]||(t[57]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Precio (€)",-1)),b(e("input",{"onUpdate:modelValue":t[12]||(t[12]=o=>s(d).precio=o),type:"number",step:"0.01",min:"0",class:"w-full h-10 px-3 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-1 focus:ring-purple-500 focus:border-purple-500"},null,512),[[P,s(d).precio,void 0,{number:!0}]])])]),e("div",null,[t[59]||(t[59]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Frecuencia",-1)),b(e("select",{"onUpdate:modelValue":t[13]||(t[13]=o=>s(d).frecuencia=o),class:"w-full h-10 px-3 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-1 focus:ring-purple-500 focus:border-purple-500"},[...t[58]||(t[58]=[e("option",{value:"semanal"},"Semanal",-1),e("option",{value:"quincenal"},"Quincenal",-1),e("option",{value:"mensual"},"Mensual",-1),e("option",{value:"cualquiera"},"Cualquiera",-1)])],512),[[W,s(d).frecuencia]])])]),e("div",Ss,[e("button",{onClick:B,class:"h-10 px-4 text-sm text-gray-700 hover:bg-gray-100 rounded-lg transition-colors"}," Cancelar "),e("button",{onClick:ae,disabled:!s(d).nombre||!s(d).sesiones||!s(d).precio,class:"h-10 px-4 bg-purple-600 text-white text-sm font-medium rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50"},r(s(C)!==null?"Guardar":"Crear"),9,qs)])])])):x("",!0)]),_:1})]))]))}});export{Ls as default};
