import{e as le,g as Re,L as Ee,r as h,z as x,s as ke,D as Le,c as r,o as a,a as e,b as ee,m as ct,j as k,n as q,k as s,v as dt,p as ut,w as ae,t as i,F,i as K,M as mt,y as ue,d as Q,l as se,h as we,A as pt,B as gt,J as ie}from"#entry";import{_ as ft}from"./nuxt-link-CqfhJJkZ.js";import{u as vt,M as xt}from"./ModalDetallesCita-CxtIMQaR.js";import{_ as ht}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./PaymentMethodSelector-BdCeWAUw.js";import"./useToast-Cq0GyJHs.js";import"./ModalNuevoBono-DZsr-zos.js";import"./useBonos-BSiCGD07.js";import"./XMarkIcon-DWNj0d99.js";import"./CheckCircleIcon-Bi0YyG7H.js";import"./PencilIcon-QJyqa3i7.js";import"./PhoneIcon-B4J2dtua.js";import"./CalendarDaysIcon-C0vq0F4x.js";import"./ClockIcon-CQZt9cKZ.js";import"./TicketIcon-DRclOuRO.js";import"./ChevronDownIcon-BwiNUDLV.js";import"./ExclamationTriangleIcon-BreoAuwB.js";import"./PlusIcon-UqRq4KLf.js";const bt={class:"search-container relative w-full max-w-xl"},yt={class:"relative"},_t={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},wt={key:0,class:"absolute inset-y-0 right-0 pr-3 flex items-center"},kt={key:0,class:"absolute z-50 mt-2 w-full bg-white rounded-xl shadow-xl border border-gray-100 overflow-hidden max-h-[70vh] overflow-y-auto"},Ct={key:0,class:"p-4 text-center text-gray-500"},$t={class:"text-sm"},Dt={key:1},St={key:0,class:"border-b border-gray-100"},Mt=["onClick"],jt={class:"flex-1 min-w-0"},Bt={class:"text-sm font-medium text-gray-900 truncate"},Pt={key:0,class:"text-xs text-gray-500 truncate"},Tt={key:1,class:"border-b border-gray-100"},Vt=["onClick"],zt={class:"flex-1 min-w-0"},At={class:"text-sm font-medium text-gray-900 truncate"},Ht={class:"text-xs text-gray-500"},Rt={key:2,class:"border-b border-gray-100"},Et=["onClick"],Lt={class:"flex-1 min-w-0"},Ot={class:"text-sm font-medium text-gray-900 truncate"},It={class:"text-xs text-gray-500"},qt={key:3},Nt=["onClick"],Ft={class:"flex-1 min-w-0"},Ut={class:"text-sm font-medium text-gray-900 truncate"},Kt={class:"text-xs text-gray-500"},Yt={class:"px-4 py-2 bg-gray-50 border-t border-gray-100 flex items-center justify-between"},Qt={class:"text-xs text-gray-400"},Jt=le({__name:"SearchBar",emits:["abrir-cita"],setup(w,{emit:b}){const c=Re();Ee();const C=h(""),A=h(!1),y=h(!1),z=h(null),u=h({pacientes:[],sesionesProximas:[],sesionesPasadas:[],bonos:[],pagos:[]});let $=null;const L=()=>{if($&&clearTimeout($),C.value.length<2){u.value={pacientes:[],sesionesProximas:[],sesionesPasadas:[],bonos:[],pagos:[]},A.value=!1;return}y.value=!0,$=setTimeout(async()=>{await B()},300)},B=async()=>{if(!(C.value.length<2))try{const S=`%${C.value}%`,m=new Date().toISOString().split("T")[0],[v,O,ge]=await Promise.all([c.from("pacientes").select("id, nombre_completo, email").or(`nombre_completo.ilike.${S},email.ilike.${S}`).eq("activo",!0).limit(5),c.from("citas").select(`
          id,
          fecha_cita,
          hora_inicio,
          estado,
          pacientes (nombre_completo)
        `).or("estado.neq.cancelada").limit(10),c.from("bonos").select(`
          id,
          tipo,
          sesiones_restantes,
          pacientes (nombre_completo)
        `).eq("estado","activo").limit(5)]);u.value.pacientes=(v.data||[]).map(_=>({id:_.id,nombre:_.nombre_completo||"Sin nombre",email:_.email}));const me=(O.data||[]).filter(_=>_.pacientes?.nombre_completo?.toLowerCase().includes(C.value.toLowerCase()));u.value.sesionesProximas=me.filter(_=>_.fecha_cita>=m).slice(0,3).map(_=>({id:_.id,paciente:_.pacientes?.nombre_completo||"Paciente",fecha:_.fecha_cita,hora:_.hora_inicio?.substring(0,5)||"--:--"})),u.value.sesionesPasadas=me.filter(_=>_.fecha_cita<m).slice(0,3).map(_=>({id:_.id,paciente:_.pacientes?.nombre_completo||"Paciente",fecha:_.fecha_cita,hora:_.hora_inicio?.substring(0,5)||"--:--"})),u.value.bonos=(ge.data||[]).filter(_=>_.pacientes?.nombre_completo?.toLowerCase().includes(C.value.toLowerCase())).slice(0,3).map(_=>({id:_.id,paciente:_.pacientes?.nombre_completo||"Paciente",tipo:_.tipo||"Bono",sesionesRestantes:_.sesiones_restantes||0})),u.value.pagos=[],A.value=!0}catch(S){console.error("Error en b√∫squeda:",S)}finally{y.value=!1}},p=S=>{if(!S){console.error("[SearchBar] ERROR: ID de paciente no v√°lido");return}D(),console.log("[SearchBar] Navegando a ficha de paciente:",S),ue(`/terapeuta/pacientes/${S}`)},j=S=>{te("abrir-cita",S),D()},Y=S=>{D()},D=()=>{A.value=!1,C.value=""},g=x(()=>u.value.pacientes.length+u.value.sesionesProximas.length+u.value.sesionesPasadas.length+u.value.bonos.length+u.value.pagos.length),V=x(()=>g.value>0),G=S=>new Date(S).toLocaleDateString("es-ES",{day:"numeric",month:"short"}),te=b,U=S=>{S.target.closest(".search-container")||(A.value=!1)};ke(()=>{document.addEventListener("click",U)}),Le(()=>{document.removeEventListener("click",U)});const ne=S=>{S.key==="Escape"&&D()};return(S,m)=>(a(),r("div",bt,[e("div",yt,[e("div",_t,[(a(),r("svg",{class:q(["w-5 h-5 transition-colors",s(y)?"text-violet-500 animate-pulse":"text-gray-400"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...m[2]||(m[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"},null,-1)])],2))]),ct(e("input",{ref_key:"inputRef",ref:z,"onUpdate:modelValue":m[0]||(m[0]=v=>ut(C)?C.value=v:null),onInput:L,onKeydown:ne,onFocus:m[1]||(m[1]=v=>s(C).length>=2&&(A.value=!0)),type:"text",placeholder:"Buscar paciente, sesi√≥n o bono...",class:"w-full pl-10 pr-4 py-2.5 text-sm bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-violet-500 focus:border-transparent placeholder-gray-400 transition-all"},null,544),[[dt,s(C)]]),s(y)?(a(),r("div",wt,[...m[3]||(m[3]=[e("div",{class:"w-4 h-4 border-2 border-gray-200 border-t-violet-500 rounded-full animate-spin"},null,-1)])])):k("",!0)]),ee(mt,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 translate-y-1","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 translate-y-1"},{default:ae(()=>[s(A)&&s(C).length>=2?(a(),r("div",kt,[!s(y)&&!s(V)?(a(),r("div",Ct,[m[4]||(m[4]=e("svg",{class:"w-8 h-8 mx-auto text-gray-300 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",$t,'No se encontraron resultados para "'+i(s(C))+'"',1)])):(a(),r("div",Dt,[s(u).pacientes.length>0?(a(),r("div",St,[m[7]||(m[7]=e("div",{class:"px-4 py-2 bg-gray-50"},[e("span",{class:"text-xs font-semibold text-gray-500 uppercase tracking-wider"},"Pacientes")],-1)),(a(!0),r(F,null,K(s(u).pacientes,v=>(a(),r("button",{key:v.id,onClick:O=>p(v.id),class:"w-full flex items-center gap-3 px-4 py-3 hover:bg-violet-50 transition-colors text-left"},[m[5]||(m[5]=e("div",{class:"w-8 h-8 rounded-full bg-violet-100 flex items-center justify-center flex-shrink-0"},[e("svg",{class:"w-4 h-4 text-violet-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})])],-1)),e("div",jt,[e("p",Bt,i(v.nombre),1),v.email?(a(),r("p",Pt,i(v.email),1)):k("",!0)]),m[6]||(m[6]=e("span",{class:"text-xs text-violet-600 font-medium"},"Ver ficha",-1))],8,Mt))),128))])):k("",!0),s(u).sesionesProximas.length>0?(a(),r("div",Tt,[m[10]||(m[10]=e("div",{class:"px-4 py-2 bg-gray-50"},[e("span",{class:"text-xs font-semibold text-gray-500 uppercase tracking-wider"},"Sesiones pr√≥ximas")],-1)),(a(!0),r(F,null,K(s(u).sesionesProximas,v=>(a(),r("button",{key:v.id,onClick:O=>j(v.id),class:"w-full flex items-center gap-3 px-4 py-3 hover:bg-violet-50 transition-colors text-left"},[m[8]||(m[8]=e("div",{class:"w-8 h-8 rounded-full bg-emerald-100 flex items-center justify-center flex-shrink-0"},[e("svg",{class:"w-4 h-4 text-emerald-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1)),e("div",zt,[e("p",At,i(v.paciente),1),e("p",Ht,i(G(v.fecha))+" ¬∑ "+i(v.hora),1)]),m[9]||(m[9]=e("span",{class:"text-xs text-emerald-600 font-medium"},"Ver cita",-1))],8,Vt))),128))])):k("",!0),s(u).sesionesPasadas.length>0?(a(),r("div",Rt,[m[13]||(m[13]=e("div",{class:"px-4 py-2 bg-gray-50"},[e("span",{class:"text-xs font-semibold text-gray-500 uppercase tracking-wider"},"Sesiones pasadas")],-1)),(a(!0),r(F,null,K(s(u).sesionesPasadas,v=>(a(),r("button",{key:v.id,onClick:O=>j(v.id),class:"w-full flex items-center gap-3 px-4 py-3 hover:bg-gray-50 transition-colors text-left"},[m[11]||(m[11]=e("div",{class:"w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center flex-shrink-0"},[e("svg",{class:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",Lt,[e("p",Ot,i(v.paciente),1),e("p",It,i(G(v.fecha))+" ¬∑ "+i(v.hora),1)]),m[12]||(m[12]=e("span",{class:"text-xs text-gray-500 font-medium"},"Ver historial",-1))],8,Et))),128))])):k("",!0),s(u).bonos.length>0?(a(),r("div",qt,[m[16]||(m[16]=e("div",{class:"px-4 py-2 bg-gray-50"},[e("span",{class:"text-xs font-semibold text-gray-500 uppercase tracking-wider"},"Bonos")],-1)),(a(!0),r(F,null,K(s(u).bonos,v=>(a(),r("button",{key:v.id,onClick:O=>Y(v.id),class:"w-full flex items-center gap-3 px-4 py-3 hover:bg-amber-50 transition-colors text-left"},[m[14]||(m[14]=e("div",{class:"w-8 h-8 rounded-full bg-amber-100 flex items-center justify-center flex-shrink-0"},[e("svg",{class:"w-4 h-4 text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"})])],-1)),e("div",Ft,[e("p",Ut,i(v.paciente),1),e("p",Kt,i(v.tipo)+" ¬∑ "+i(v.sesionesRestantes)+" sesiones restantes",1)]),m[15]||(m[15]=e("span",{class:"text-xs text-amber-600 font-medium"},"Ver bono",-1))],8,Nt))),128))])):k("",!0)])),e("div",Yt,[e("span",Qt,i(s(g))+" resultado"+i(s(g)!==1?"s":""),1),m[17]||(m[17]=e("span",{class:"text-xs text-gray-400"},"ESC para cerrar",-1))])])):k("",!0)]),_:1})]))}}),Gt=Object.assign(Jt,{__name:"DashboardSearchBar"}),Wt={key:0,class:"text-[10px] font-semibold uppercase tracking-wider text-violet-500 mt-0.5"},Xt={class:"flex-1 flex items-center justify-between py-3 px-4 min-w-0"},Zt={class:"min-w-0"},es={class:"text-base font-semibold text-gray-900 truncate mb-1"},ts={class:"flex items-center gap-2 text-sm"},ss={class:"inline-flex items-center gap-1 text-gray-500"},os={key:0,class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},as={key:1,class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ns={key:2,class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},rs={key:0,class:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20"},is={class:"flex items-center gap-2 ml-3"},ls={key:0,class:"absolute top-0 left-0 w-1 h-full bg-violet-500"},cs=le({__name:"SessionCard",props:{id:{},fecha:{},hora:{},pacienteNombre:{},modalidad:{},estado:{},isNext:{type:Boolean}},emits:["click","confirmar","registrar-pago"],setup(w,{emit:b}){const c=w,C=x(()=>{if(!c.fecha)return!1;const B=new Date().toISOString().split("T")[0];return c.fecha===B}),A=x(()=>{if(!c.fecha||!c.hora)return!1;const B=new Date;return new Date(`${c.fecha}T${c.hora}:00`)<B}),y=x(()=>A.value||c.estado==="realizada"||c.estado==="completada"),z=b,u={presencial:{label:"Presencial",icon:"location"},online:{label:"Online",icon:"video"},virtual:{label:"Online",icon:"video"},telefonica:{label:"Tel√©fono",icon:"phone"}},$=x(()=>u[c.modalidad]||u.presencial),L=x(()=>{switch(c.estado){case"confirmada":return{label:"Confirmada",color:"text-emerald-600",bg:"bg-emerald-50"};case"pendiente":return{label:"Pendiente",color:"text-amber-600",bg:"bg-amber-50"};case"realizada":case"completada":return{label:"Realizada",color:"text-blue-600",bg:"bg-blue-50"};case"cancelada":return{label:"Cancelada",color:"text-gray-400",bg:"bg-gray-50"};default:return{label:c.estado,color:"text-gray-500",bg:"bg-gray-50"}}});return(B,p)=>(a(),r("div",{onClick:p[3]||(p[3]=j=>z("click",w.id)),class:q(["relative flex items-stretch gap-0 bg-white rounded-xl border cursor-pointer transition-all duration-200 hover:shadow-md group overflow-hidden",[w.isNext?"border-violet-200 ring-1 ring-violet-100":"border-gray-200",w.estado==="cancelada"?"opacity-60":""]])},[e("div",{class:q(["flex-shrink-0 w-24 flex flex-col items-center justify-center py-4 px-3",s(C)?"bg-violet-50":"bg-gray-50"])},[e("span",{class:q(["text-2xl font-bold tracking-tight",s(C)?"text-violet-700":"text-gray-800"])},i(w.hora),3),s(C)?(a(),r("span",Wt," Hoy ")):k("",!0)],2),e("div",Xt,[e("div",Zt,[e("p",es,i(w.pacienteNombre),1),e("div",ts,[e("span",ss,[s($).icon==="location"?(a(),r("svg",os,[...p[4]||(p[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"},null,-1),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"},null,-1)])])):s($).icon==="video"?(a(),r("svg",as,[...p[5]||(p[5]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"},null,-1)])])):s($).icon==="phone"?(a(),r("svg",ns,[...p[6]||(p[6]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"},null,-1)])])):k("",!0),e("span",null,i(s($).label),1)]),p[8]||(p[8]=e("span",{class:"text-gray-300"},"¬∑",-1)),e("span",{class:q(["inline-flex items-center gap-1 text-xs font-medium px-1.5 py-0.5 rounded",[s(L).color,s(L).bg]])},[w.estado==="confirmada"?(a(),r("svg",rs,[...p[7]||(p[7]=[e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)])])):k("",!0),Q(" "+i(s(L).label),1)],2)])]),e("div",is,[w.estado==="pendiente"?(a(),r("button",{key:0,onClick:p[0]||(p[0]=se(j=>z("confirmar",w.id),["stop"])),class:"px-3 py-1.5 text-xs font-semibold bg-violet-600 text-white rounded-lg hover:bg-violet-700 transition-colors",title:"Confirmar cita"}," Confirmar ")):k("",!0),s(y)&&w.estado!=="cancelada"?(a(),r("button",{key:1,onClick:p[1]||(p[1]=se(j=>z("registrar-pago",w.id),["stop"])),class:"px-3 py-1.5 text-xs font-semibold border border-emerald-500 text-emerald-600 rounded-lg hover:bg-emerald-50 transition-colors",title:"Registrar pago"}," Registrar pago ")):k("",!0),e("button",{onClick:p[2]||(p[2]=se(j=>z("click",w.id),["stop"])),class:"px-3 py-1.5 text-xs font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",title:"Ver detalles"}," Ver detalles ")])]),w.isNext?(a(),r("div",ls)):k("",!0)],2))}}),ds=Object.assign(cs,{__name:"DashboardSessionCard"}),us={class:"bg-white rounded-lg border border-gray-200 overflow-hidden"},ms={class:"flex items-center justify-between px-6 py-4 border-b border-gray-200"},ps={class:"flex items-center gap-3"},gs={class:"text-sm text-gray-500"},fs=["disabled"],vs={class:"p-4"},xs={key:0,class:"flex flex-col items-center justify-center py-8"},hs={key:0,class:"mb-5"},bs={class:"flex items-center gap-2 mb-3"},ys={class:"text-base font-semibold text-gray-900"},_s={class:"space-y-2"},ws={class:"flex items-center justify-between mb-2"},ks={class:"text-sm font-medium text-gray-900"},Cs={class:"flex items-center justify-between"},$s={class:"text-2xl font-bold text-amber-700"},Ds={class:"flex items-center gap-2"},Ss=["onClick"],Ms=["onClick"],js={key:1,class:"mb-5 p-4 bg-emerald-50 border border-emerald-200 rounded-xl text-center"},Bs={key:2},Ps={class:"flex items-center justify-between mb-3"},Ts={class:"text-sm font-semibold text-emerald-600"},Vs={class:"space-y-1.5"},zs=["onClick"],As={class:"flex items-center gap-2"},Hs={class:"text-sm text-gray-700"},Rs={class:"text-xs text-gray-400"},Es={class:"text-sm font-medium text-gray-900"},Ls={key:3,class:"text-center py-6"},Os=le({__name:"PaymentsTodayCard",emits:["abrirCita","cobrar"],setup(w,{expose:b,emit:c}){const{getPaymentsOfDay:C,loading:A,resumenDia:y}=vt(),z=h(!1),u=h(!1);ke(async()=>{await C()});const $=x(()=>{const D=y.value.pagos;return z.value?D:D.slice(0,3)}),L=x(()=>u.value?y.value.pendientes:y.value.pendientes.slice(0,4));x(()=>new Date().toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long",year:"numeric"})),x(()=>{const D=y.value.porMetodo;return Object.entries(D).filter(([g,V])=>V.cantidad>0).map(([g,V])=>({metodo:g,...V}))});const B=c;function p(D){B("abrirCita",D)}function j(D){B("cobrar",D)}async function Y(){await C()}return b({refrescar:Y}),(D,g)=>(a(),r("div",us,[e("div",ms,[e("div",ps,[g[3]||(g[3]=e("div",{class:"w-10 h-10 rounded-lg bg-emerald-100 flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-emerald-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",null,[g[2]||(g[2]=e("h2",{class:"text-lg font-semibold text-gray-900"},"Pagos de hoy",-1)),e("p",gs,i(s(y).cantidadPagos)+" "+i(s(y).cantidadPagos===1?"pago registrado":"pagos registrados")+" hoy ",1)])]),e("button",{onClick:Y,disabled:s(A),class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-50 rounded-lg transition-colors disabled:opacity-50",title:"Actualizar"},[(a(),r("svg",{class:q(["w-4 h-4",s(A)&&"animate-spin"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...g[4]||(g[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])],2))],8,fs)]),e("div",vs,[s(A)?(a(),r("div",xs,[...g[5]||(g[5]=[e("div",{class:"w-8 h-8 border-2 border-gray-200 border-t-emerald-600 rounded-full animate-spin mb-2"},null,-1),e("p",{class:"text-sm text-gray-500"},"Cargando pagos...",-1)])])):(a(),r(F,{key:1},[s(y).pendientes.length>0?(a(),r("div",hs,[e("div",bs,[g[6]||(g[6]=e("div",{class:"w-2 h-2 rounded-full bg-amber-500"},null,-1)),e("h3",ys," Pendientes de cobro ("+i(s(y).pendientes.length)+") ",1)]),e("div",_s,[(a(!0),r(F,null,K(s(L),V=>(a(),r("div",{key:V.id,class:"bg-amber-50 border border-amber-200 rounded-xl p-3"},[e("div",ws,[e("p",ks,[Q(i(V.paciente_nombre)+" ",1),g[7]||(g[7]=e("span",{class:"text-gray-400 font-normal"},"¬∑",-1)),Q(" "+i(V.hora_inicio?.substring(0,5)||"--:--"),1)])]),e("div",Cs,[e("p",$s,i((V.precio_sesion||50).toFixed(2).replace(".",","))+"‚Ç¨ ",1),e("div",Ds,[e("button",{onClick:se(G=>p(V.id),["stop"]),class:"text-sm text-gray-500 hover:text-gray-700 underline underline-offset-2 transition-colors"}," Ver sesi√≥n ",8,Ss),e("button",{onClick:se(G=>j(V.id),["stop"]),class:"px-4 py-1.5 bg-amber-600 hover:bg-amber-700 text-white text-sm font-semibold rounded-lg transition-colors"}," Cobrar ",8,Ms)])])]))),128)),s(y).pendientes.length>4&&!s(u)?(a(),r("button",{key:0,onClick:g[0]||(g[0]=V=>u.value=!0),class:"w-full py-2 text-sm font-medium text-amber-600 hover:text-amber-700 hover:bg-amber-50 rounded-lg transition-colors"}," Ver "+i(s(y).pendientes.length-4)+" m√°s ",1)):k("",!0)])])):(a(),r("div",js,[...g[8]||(g[8]=[we('<div class="flex items-center justify-center gap-2 text-emerald-700"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg><p class="font-semibold">Al d√≠a</p></div><p class="text-sm text-emerald-600 mt-1">No tienes cobros pendientes hoy</p>',2)])])),s(y).pagos.length>0?(a(),r("div",Bs,[e("div",Ps,[g[9]||(g[9]=e("h3",{class:"text-sm font-medium text-gray-500"},"Pagos registrados",-1)),e("span",Ts,i(s(y).total.toFixed(2).replace(".",","))+"‚Ç¨",1)]),e("div",Vs,[(a(!0),r(F,null,K(s($),V=>(a(),r("button",{key:V.id,onClick:G=>p(V.id),class:"w-full flex items-center justify-between px-3 py-2 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors text-left"},[e("div",As,[g[10]||(g[10]=e("svg",{class:"w-4 h-4 text-emerald-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)),e("span",Hs,i(V.paciente_nombre),1),e("span",Rs,i(V.hora_inicio?.substring(0,5)||""),1)]),e("span",Es,i((V.precio_sesion||0).toFixed(2).replace(".",","))+"‚Ç¨",1)],8,zs))),128)),s(y).pagos.length>3&&!s(z)?(a(),r("button",{key:0,onClick:g[1]||(g[1]=V=>z.value=!0),class:"w-full py-2 text-sm font-medium text-gray-500 hover:text-gray-700 hover:bg-gray-50 rounded-lg transition-colors"}," Ver "+i(s(y).pagos.length-3)+" m√°s ",1)):k("",!0)])])):k("",!0),s(y).pagos.length===0&&s(y).pendientes.length===0?(a(),r("div",Ls,[...g[11]||(g[11]=[we('<div class="w-14 h-14 rounded-full bg-emerald-50 flex items-center justify-center mx-auto mb-3"><svg class="w-7 h-7 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div><p class="text-gray-700 font-medium mb-1">Sin movimientos hoy</p><p class="text-sm text-gray-400 max-w-[220px] mx-auto">Los cobros aparecer√°n aqu√≠ autom√°ticamente cuando registres pagos en tus sesiones</p>',3)])])):k("",!0)],64))])]))}}),Is=Object.assign(Os,{__name:"DashboardPaymentsTodayCard"}),qs={class:"flex-shrink-0 w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-500 font-medium text-sm"},Ns={class:"flex-1 min-w-0"},Fs={class:"font-semibold text-gray-900 truncate text-sm"},Us={class:"flex items-center gap-2 mt-0.5"},Ks=["title"],Ys={class:"flex items-center gap-2 mt-1.5"},Qs={key:0,class:"flex-1 max-w-16 h-1 bg-gray-100 rounded-full overflow-hidden"},Js=le({__name:"PatientCard",props:{id:{},nombre:{},ultimaSesion:{},proximaCita:{},sesionesUsadas:{},sesionesTotales:{},estadoBono:{}},emits:["click"],setup(w,{emit:b}){const c=w,C=b,A=x(()=>{if(!c.nombre)return"?";const p=c.nombre.split(" ").filter(Boolean);return p.length>=2?(p[0][0]+p[1][0]).toUpperCase():p[0]?.substring(0,2).toUpperCase()||"?"}),y=x(()=>c.sesionesTotales?c.sesionesTotales-(c.sesionesUsadas||0):0),z=x(()=>!c.sesionesTotales||c.sesionesTotales===0?0:Math.round((c.sesionesUsadas||0)/c.sesionesTotales*100)),u=x(()=>{if(!c.ultimaSesion)return"Sin actividad";const p=new Date(c.ultimaSesion),Y=new Date().getTime()-p.getTime(),D=Math.floor(Y/(1e3*60*60*24));return D===0?"Hoy":D===1?"Ayer":D<7?`Hace ${D} d√≠as`:D<14?"Hace 1 semana":D<30?`Hace ${Math.floor(D/7)} semanas`:D<60?"Hace 1 mes":`Hace ${Math.floor(D/30)} meses`}),$=x(()=>c.ultimaSesion?new Date(c.ultimaSesion).toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long",year:"numeric"}):""),L=x(()=>!c.estadoBono||c.estadoBono==="sin_bono"?{texto:"Sin bono",color:"text-gray-400"}:c.estadoBono==="agotado"?{texto:"Bono agotado",color:"text-red-500"}:c.estadoBono==="por_agotar"?{texto:`Bono activo ¬∑ ${y.value}/${c.sesionesTotales}`,color:"text-amber-600"}:{texto:`Bono activo ¬∑ ${y.value}/${c.sesionesTotales}`,color:"text-emerald-600"}),B=x(()=>c.estadoBono==="por_agotar"?"bg-amber-500":c.estadoBono==="agotado"?"bg-red-400":c.estadoBono==="activo"?"bg-emerald-500":"bg-gray-300");return(p,j)=>(a(),r("div",{onClick:j[1]||(j[1]=Y=>C("click",w.id)),class:"flex items-center gap-3 p-3 bg-white rounded-xl border border-gray-100 cursor-pointer transition-all duration-200 hover:shadow-md hover:border-gray-200 group"},[e("div",qs,i(s(A)),1),e("div",Ns,[e("p",Fs,i(w.nombre),1),e("div",Us,[e("span",{class:"text-xs text-gray-500 flex items-center gap-1",title:s($)},[j[2]||(j[2]=e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),Q(" "+i(s(u)),1)],8,Ks)]),e("div",Ys,[e("span",{class:q(["text-xs font-medium",s(L).color])},i(s(L).texto),3),w.sesionesTotales&&w.sesionesTotales>0&&w.estadoBono!=="sin_bono"?(a(),r("div",Qs,[e("div",{class:q(["h-full rounded-full transition-all duration-300",s(B)]),style:pt({width:`${Math.min(s(z),100)}%`})},null,6)])):k("",!0)])]),e("button",{onClick:j[0]||(j[0]=se(Y=>C("click",w.id),["stop"])),class:"flex-shrink-0 px-3 py-1.5 text-xs font-medium text-gray-600 hover:text-violet-700 hover:bg-violet-50 rounded-lg transition-colors opacity-0 group-hover:opacity-100"}," Ver ficha "),j[3]||(j[3]=e("svg",{class:"w-4 h-4 text-gray-300 group-hover:text-gray-400 transition-colors flex-shrink-0 lg:hidden",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1))]))}}),Gs=Object.assign(Js,{__name:"DashboardPatientCard"}),Ws={class:"flex items-center justify-between mb-1.5"},Xs={class:"font-semibold text-gray-900 text-sm"},Zs={class:"text-gray-600 font-medium"},eo={class:"flex items-center gap-2 text-xs"},to={class:"text-gray-500"},so={class:"flex items-center gap-2 mt-3"},oo=le({__name:"BonoCard",props:{id:{},pacienteId:{},pacienteNombre:{},tipoBono:{},sesionesRestantes:{},sesionesTotales:{},ultimaSesion:{}},emits:["ver-bono","programar-cita"],setup(w,{emit:b}){const c=w,C=b,A=x(()=>{if(!c.ultimaSesion)return"Sin sesiones recientes";const u=new Date(c.ultimaSesion),L=new Date().getTime()-u.getTime(),B=Math.floor(L/(1e3*60*60*24));return B===0?"√öltima sesi√≥n: hoy":B===1?"√öltima sesi√≥n: ayer":B<7?`√öltima sesi√≥n: hace ${B} d√≠as`:B<14?"√öltima sesi√≥n: hace 1 semana":B<30?`√öltima sesi√≥n: hace ${Math.floor(B/7)} semanas`:`√öltima sesi√≥n: hace ${Math.floor(B/30)} meses`}),y=x(()=>c.sesionesRestantes<=1?"border-l-red-500 bg-red-50/50":c.sesionesRestantes<=2?"border-l-amber-500 bg-amber-50/50":"border-l-gray-300 bg-white"),z=x(()=>c.sesionesRestantes===1?"Queda 1 sesi√≥n":`Quedan ${c.sesionesRestantes} sesiones`);return(u,$)=>(a(),r("div",{class:q(["p-3 rounded-xl border border-gray-200 border-l-[3px] transition-all duration-200 hover:shadow-sm",s(y)])},[e("div",Ws,[e("p",Xs,[Q(i(w.pacienteNombre)+" ",1),$[2]||($[2]=e("span",{class:"text-gray-400 font-normal"},"¬∑",-1)),e("span",Zs,i(w.tipoBono),1)])]),e("div",eo,[e("span",{class:q(["font-semibold",w.sesionesRestantes<=1?"text-red-600":w.sesionesRestantes<=2?"text-amber-600":"text-gray-600"])},i(s(z)),3),$[3]||($[3]=e("span",{class:"text-gray-300"},"¬∑",-1)),e("span",to,i(s(A)),1)]),e("div",so,[e("button",{onClick:$[0]||($[0]=se(L=>C("ver-bono",w.id),["stop"])),class:"px-3 py-1.5 text-xs font-medium text-gray-600 hover:text-violet-700 hover:bg-violet-50 border border-gray-200 hover:border-violet-200 rounded-lg transition-colors"}," Ver bono "),e("button",{onClick:$[1]||($[1]=se(L=>C("programar-cita",w.pacienteId),["stop"])),class:"px-3 py-1.5 text-xs font-medium text-violet-600 hover:text-violet-700 hover:bg-violet-50 border border-violet-200 hover:border-violet-300 rounded-lg transition-colors"}," Programar cita ")])],2))}}),ao=Object.assign(oo,{__name:"DashboardBonoCard"}),no={class:"dashboard-terapeuta min-h-screen bg-gray-50"},ro={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},io={class:"mb-8"},lo={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-4"},co={class:"text-2xl sm:text-3xl font-bold text-gray-900 tracking-tight"},uo={class:"text-gray-500 mt-1 flex items-center gap-2 flex-wrap"},mo={key:0,class:"inline-flex items-center gap-1"},po={class:"font-medium text-gray-700"},go={key:1,class:"text-gray-300"},fo={key:2,class:"inline-flex items-center gap-1"},vo={class:"font-medium text-amber-600"},xo={key:3,class:"text-gray-500"},ho={class:"grid grid-cols-1 lg:grid-cols-3 gap-6 lg:gap-8"},bo={class:"lg:col-span-2 bg-white rounded-lg border border-gray-200 overflow-hidden"},yo={class:"flex items-center justify-between px-6 py-4 border-b border-gray-200"},_o={class:"flex items-center gap-3"},wo={class:"text-sm text-gray-500"},ko={class:"p-4"},Co={key:0,class:"flex flex-col items-center justify-center py-12"},$o={key:1,class:"flex flex-col items-center justify-center py-10 text-center"},Do={class:"text-gray-700 font-medium mb-1"},So={class:"text-sm text-gray-400 mb-4"},Mo={key:1,class:"mt-6 pt-6 border-t border-gray-100 w-full"},jo={class:"space-y-2"},Bo={key:2,class:"space-y-3"},Po={key:0,class:"mt-4 pt-4 border-t border-gray-100"},To={class:"space-y-2"},Vo={class:"grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-8 mt-8"},zo={class:"bg-white rounded-lg border border-gray-200 overflow-hidden"},Ao={class:"flex items-center justify-between px-6 py-4 border-b border-gray-200"},Ho={class:"flex items-center gap-3"},Ro={class:"text-xs text-gray-500"},Eo={class:"px-4 py-2 border-b border-gray-100 bg-gray-50/50"},Lo={class:"flex items-center gap-1.5"},Oo=["onClick"],Io={class:"p-4"},qo={key:0,class:"flex flex-col items-center justify-center py-8"},No={key:1,class:"flex flex-col items-center justify-center py-8 text-center"},Fo={class:"text-sm text-gray-400 mb-3 max-w-[220px]"},Uo={key:2,class:"space-y-3"},Ko={class:"bg-white rounded-lg border border-gray-200 overflow-hidden"},Yo={class:"flex items-center justify-between px-6 py-4 border-b border-gray-200"},Qo={class:"flex items-center gap-3"},Jo={class:"text-lg font-semibold text-gray-900"},Go={key:0,class:"text-amber-600"},Wo={class:"p-4"},Xo={key:0,class:"flex flex-col items-center justify-center py-8"},Zo={key:1,class:"flex flex-col items-center justify-center py-8 text-center"},ea={key:2,class:"space-y-2"},ta={class:"mt-8"},sa={class:"bg-white rounded-lg border border-gray-200 overflow-hidden"},oa={class:"flex items-center justify-between px-6 py-4 border-b border-gray-200"},aa={class:"flex items-center gap-3"},na={class:"text-xs text-gray-500"},ra={class:"flex items-center gap-1 bg-gray-100 rounded-lg p-1"},ia=["onClick"],la={class:"p-6"},ca={class:"grid grid-cols-2 lg:grid-cols-5 gap-4"},da={class:"text-3xl font-bold text-gray-900 group-hover:text-violet-700"},ua={class:"text-3xl font-bold text-gray-900 group-hover:text-violet-700"},ma={class:"p-4 bg-gray-50 rounded-xl border border-gray-100"},pa={class:"text-xs text-gray-500 mt-1"},ga={class:"p-4 bg-gray-50 rounded-xl border border-gray-100"},fa={key:0,class:"text-xs text-gray-500 mt-1"},va={key:1,class:"text-xs text-gray-400 mt-1"},xa={class:"flex items-center justify-between mb-2"},ha={class:"text-3xl font-bold text-emerald-700"},ba={class:"text-xs text-emerald-500 mt-1"},ya=le({__name:"dashboard",setup(w){const b=Re(),c=Ee(),C=gt(),A=h(null),y=h(!0),z=h(!0),u=h([]),$=h([]),L=h(0),B=h(0),p=h(0),j=h(0),Y=h(!1),D=h(null),g=h(!1),V=h(!1),G=h(!1),te=h(5),U=h([]),ne=h(!0),S=h("mes"),m=[{valor:"mes",etiqueta:"Mes"},{valor:"3meses",etiqueta:"3 meses"},{valor:"anio",etiqueta:"A√±o"}],v=h({horasDisponibles:0,horasOcupadas:0,cancelaciones:0,totalCitas:0}),O=h(0),ge=h(0),me=h(null),_=h(0),ce=h(0),fe=h([]),Ce=h(!0);x(()=>new Date().toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long"})),x(()=>g.value?u.value:u.value.slice(0,5));const Oe=x(()=>{const o=new Date,t=o.toLocaleDateString("es-ES",{weekday:"long"}),d=o.getDate(),l=o.toLocaleDateString("es-ES",{month:"long"});return`Hoy, ${(t.charAt(0).toUpperCase()+t.slice(1)).toLowerCase()} ${d} de ${l}`}),W=x(()=>{const o=new Date().toISOString().split("T")[0];return u.value.filter(t=>t.fecha_cita===o).length}),Ie=x(()=>{const o=new Date,t=o.toLocaleDateString("es-ES",{weekday:"long"}),d=o.getDate(),l=o.toLocaleDateString("es-ES",{month:"long"});return`${t.charAt(0).toUpperCase()}${t.slice(1)}, ${d} de ${l}`}),ve=x(()=>{const t=new Date().getDay();return t===0||t===6}),qe=x(()=>{const o=new Date().toISOString().split("T")[0];return u.value.filter(t=>t.fecha_cita===o)}),Ne=x(()=>qe.value),re=x(()=>{const o=new Date().toISOString().split("T")[0];return u.value.filter(t=>t.fecha_cita>o)}),Fe=x(()=>g.value?re.value:re.value.slice(0,3)),oe=h(0);function $e(o,t){return o.getFullYear()===t.getFullYear()&&o.getMonth()===t.getMonth()&&o.getDate()===t.getDate()}function Ue(o,t){const d=new Date(t);return d.setDate(d.getDate()+1),$e(o,d)}function Ke(o){return o.toLocaleDateString("es-ES",{weekday:"long"})}function Ye(o){return o.toLocaleDateString("es-ES",{day:"numeric",month:"short"})}function Qe(o,t){const d=new Date,l=new Date(`${o}T${t}:00`),f=(l.getTime()-d.getTime())/(1e3*60*60);if($e(l,d))return`Hoy ${t}`;if(Ue(l,d))return`Ma√±ana ${t}`;if(f>0&&f<168){const M=Ke(l);return`${M.charAt(0).toUpperCase()+M.slice(1)} ${t}`}return`${Ye(l)} ${t}`}function Je(o,t){if(!o||!t)return!1;const d=new Date,f=(new Date(`${o}T${t}:00`).getTime()-d.getTime())/(1e3*60*60);return f>0&&f<24}const Ge=x(()=>fe.value.map(o=>{let t=o.fechaCita&&o.horaCita?Qe(o.fechaCita,o.horaCita):void 0,d=o.tipo==="confirmacion"&&Je(o.fechaCita,o.horaCita),l="",f="";if(t){const M=t.split(" ");f=M.pop()||"",l=M.join(" ")}return{id:o.id,tipo:o.tipo,mensaje:o.mensaje,paciente:o.paciente,fecha:l,hora:f,urgente:d,accion:o.accion}})),De=x(()=>[...Ge.value].sort((o,t)=>{if(o.urgente&&!t.urgente)return-1;if(!o.urgente&&t.urgente)return 1;const d=o.fecha||o.hora,l=t.fecha||t.hora;return d&&!l?-1:!d&&l?1:0}));x(()=>V.value?De.value:De.value.slice(0,4));const We=x(()=>G.value?U.value:U.value.slice(0,4)),Xe=x(()=>{const o=new Date,t=o.toLocaleDateString("es-ES",{month:"long"}),d=o.getFullYear();if(S.value==="mes")return`Datos de ${t} ${d}`;if(S.value==="3meses"){const l=new Date(o);l.setMonth(l.getMonth()-2);const f=l.toLocaleDateString("es-ES",{month:"short"}),M=o.toLocaleDateString("es-ES",{month:"short"});return`√öltimos 3 meses (${f} - ${M} ${d})`}return`A√±o ${d}`}),Ze=()=>{ue("/terapeuta/agenda")},et=()=>{ue("/terapeuta/pacientes")},tt=o=>{if(!o){console.error("[Dashboard] ERROR: ID de paciente no v√°lido");return}console.log("[Dashboard] Navegando a ficha de paciente:",o),ue(`/terapeuta/pacientes/${o}`)},Se=async o=>{te.value=o,await Me()},st=o=>{const t=U.value.find(d=>d.id===o);t&&t.paciente_id&&(console.log("[Dashboard] Navegando a ficha desde bono:",t.paciente_id),ue(`/terapeuta/pacientes/${t.paciente_id}`))},ot=o=>{c.push(`/terapeuta/agenda?paciente=${o}`)},at=async o=>{S.value=o,await Be(),await Te()},X=o=>{D.value=o,Y.value=!0},nt=()=>{Y.value=!1,D.value=null,de()},xe=async o=>{try{const{error:t}=await b.from("citas").update({estado:"confirmada",updated_at:new Date().toISOString()}).eq("id",o);if(t)throw t;const d=u.value.findIndex(l=>l.id===o);d!==-1&&(u.value[d].estado="confirmada"),await Pe()}catch(t){console.error("Error al confirmar cita:",t),alert("Error al confirmar la cita")}};async function rt(){try{const{data:o}=await b.auth.getUser();if(o.user){const{data:t}=await b.from("profiles").select("*").eq("id",o.user.id).single();A.value={nombre:t?.metadata?.nombre||"Karem",email:o.user.email}}}catch(o){console.error("Error al cargar perfil:",o),A.value={nombre:"Karem"}}}async function de(){y.value=!0;try{const o=new Date;o.setHours(0,0,0,0);const t=new Date(o);t.setDate(t.getDate()+7);const{data:d,error:l}=await b.from("citas").select(`
        id,
        paciente_id,
        fecha_cita,
        hora_inicio,
        modalidad,
        estado,
        observaciones,
        pacientes (
          id,
          nombre_completo,
          email
        )
      `).in("estado",["pendiente","confirmada"]).gte("fecha_cita",o.toISOString().split("T")[0]).lte("fecha_cita",t.toISOString().split("T")[0]).order("fecha_cita",{ascending:!0}).order("hora_inicio",{ascending:!0});if(l)throw l;u.value=(d||[]).map(f=>({id:f.id,fecha_cita:f.fecha_cita,hora_inicio:f.hora_inicio?f.hora_inicio.substring(0,5):"--:--",paciente_nombre:f.pacientes?.nombre_completo||f.pacientes?.email||"Paciente",modalidad:f.modalidad||"presencial",estado:f.estado||"pendiente",observaciones:f.observaciones}))}catch(o){console.error("Error al cargar sesiones:",o),u.value=[]}finally{y.value=!1}}async function Me(){z.value=!0;try{if(!C.value?.email){$.value=[],z.value=!1;return}const{data:o}=await b.from("terapeutas").select("id").eq("email",C.value.email).single();if(!o){$.value=[],z.value=!1;return}const{data:t}=await b.from("pacientes").select("id").eq("terapeuta_id",o.id).eq("activo",!0);if(!t||t.length===0){$.value=[],z.value=!1;return}const d=t.map(P=>P.id),l=new Date;l.setDate(l.getDate()-te.value);const f=l.toISOString().split("T")[0],M=new Date().toISOString().split("T")[0],{data:H,error:N}=await b.from("citas").select("paciente_id, fecha_cita, estado, pacientes(id, nombre_completo)").in("paciente_id",d).in("estado",["realizada","completada","confirmada","pendiente"]).gte("fecha_cita",f).lte("fecha_cita",M).order("fecha_cita",{ascending:!1});if(N)throw N;const I=new Map;H?.forEach(P=>{P.paciente_id&&P.pacientes&&!I.has(P.paciente_id)&&I.set(P.paciente_id,{id:P.paciente_id,nombre:P.pacientes.nombre_completo||"Sin nombre",ultimaSesion:P.fecha_cita})});const n=Array.from(I.values()).slice(0,5),E=await Promise.all(n.map(async P=>{let Z=0,R=0,T="sin_bono";try{const{data:J}=await b.from("bonos").select("sesiones_totales, sesiones_restantes, estado").eq("paciente_id",P.id).in("estado",["activo","pendiente"]).gt("sesiones_restantes",0).order("created_at",{ascending:!1}).limit(1).maybeSingle();J&&(R=J.sesiones_totales||0,Z=R-(J.sesiones_restantes||0),J.sesiones_restantes<=0?T="agotado":J.sesiones_restantes<=2?T="por_agotar":T="activo")}catch{}return{id:P.id,nombre_completo:P.nombre,ultima_sesion:P.ultimaSesion,sesiones_usadas:Z,sesiones_totales:R,estado_bono:T}}));$.value=E}catch(o){console.error("Error al cargar pacientes:",o),$.value=[]}finally{z.value=!1}}async function je(){ne.value=!0;try{const{data:o,error:t}=await b.from("bonos").select(`
        id,
        paciente_id,
        tipo,
        sesiones_totales,
        sesiones_restantes,
        estado,
        pacientes (
          id,
          nombre_completo
        )
      `).eq("estado","activo").lte("sesiones_restantes",2).gt("sesiones_restantes",0).order("sesiones_restantes",{ascending:!0}).limit(10);if(t)throw t;const d=await Promise.all((o||[]).map(async l=>{let f=null;try{const{data:H}=await b.from("citas").select("fecha_cita").eq("paciente_id",l.paciente_id).in("estado",["realizada","completada"]).order("fecha_cita",{ascending:!1}).limit(1).maybeSingle();H&&(f=H.fecha_cita)}catch{}let M=l.tipo||"Bono";return M.toLowerCase().includes("semanal")?M=`Bono Semanal ${l.sesiones_totales} sesiones`:M.toLowerCase().includes("mensual")?M=`Bono Mensual ${l.sesiones_totales} sesiones`:M=`Bono ${l.sesiones_totales} sesiones`,{id:l.id,paciente_id:l.paciente_id,paciente_nombre:l.pacientes?.nombre_completo||"Paciente",tipo_bono:M,sesiones_totales:l.sesiones_totales||0,sesiones_restantes:l.sesiones_restantes||0,ultima_sesion:f}}));U.value=d}catch(o){console.error("Error al cargar bonos por agotar:",o),U.value=[]}finally{ne.value=!1}}async function Be(){try{const{count:o}=await b.from("pacientes").select("*",{count:"exact",head:!0}).eq("activo",!0);L.value=o||0;const t=new Date;t.setHours(0,0,0,0),S.value==="mes"?t.setDate(1):S.value==="3meses"?(t.setMonth(t.getMonth()-2),t.setDate(1)):(t.setMonth(0),t.setDate(1));const d=t.toISOString().split("T")[0],{count:l}=await b.from("citas").select("*",{count:"exact",head:!0}).gte("fecha_cita",d).lte("fecha_cita",new Date().toISOString().split("T")[0]);B.value=l||0;const f=new Date;let M=0;const H=new Date(t);for(;H<=f;){const n=H.getDay();n!==0&&n!==6&&M++,H.setDate(H.getDate()+1)}const N=M*8,{data:I}=await b.from("citas").select("estado, duracion_minutos").gte("fecha_cita",d).lte("fecha_cita",new Date().toISOString().split("T")[0]);if(I&&I.length>0){const E=I.filter(T=>T.estado!=="cancelada"&&T.estado!=="no_show"&&T.estado!=="ausente").reduce((T,J)=>T+(J.duracion_minutos||60),0),P=Math.round(E/60),Z=I.filter(T=>T.estado==="cancelada").length,R=I.length;v.value={horasDisponibles:N,horasOcupadas:P,cancelaciones:Z,totalCitas:R},N>0?p.value=Math.min(100,Math.round(P/N*100)):p.value=0,R>0?j.value=Math.round(Z/R*100):j.value=0}else v.value={horasDisponibles:N,horasOcupadas:0,cancelaciones:0,totalCitas:0},p.value=0,j.value=0}catch(o){console.error("Error al cargar m√©tricas:",o)}}async function it(){try{const o=new Date().toISOString().split("T")[0],{count:t}=await b.from("citas").select("*",{count:"exact",head:!0}).eq("fecha_cita",o).in("estado",["realizada","completada","confirmada","pendiente"]).or("estado_pago.is.null,estado_pago.eq.pendiente");oe.value=t||0}catch(o){console.error("Error al cargar cobros pendientes:",o),oe.value=0}}async function Pe(){Ce.value=!0;const o=[];try{const t=new Date,d=new Date(t);d.setHours(0,0,0,0);const l=d.toISOString().split("T")[0],f=new Date(d);f.setDate(d.getDate()+3);const M=f.toISOString().split("T")[0],{data:H}=await b.from("citas").select(`
        id,
        fecha_cita,
        hora_inicio,
        pacientes (
          nombre_completo
        )
      `).eq("estado","pendiente").gte("fecha_cita",l).lte("fecha_cita",M).order("fecha_cita",{ascending:!0}).order("hora_inicio",{ascending:!0});H?.forEach(n=>{const E=n.hora_inicio?.substring(0,5)||"00:00",P=n.fecha_cita;if(P===l){const[Z,R]=E.split(":").map(Number),T=new Date(t);if(T.setHours(Z,R,0,0),T<t)return}o.push({id:n.id,tipo:"confirmacion",mensaje:`Confirmar cita de ${n.pacientes?.nombre_completo||"paciente"}`,paciente:n.pacientes?.nombre_completo||"Paciente",fechaCita:P,horaCita:E,accion:"confirmar"})});const{data:N}=await b.from("citas").select(`
        id,
        fecha_cita,
        hora_inicio,
        pacientes (
          nombre_completo
        )
      `).lt("fecha_cita",l).neq("estado","completada").neq("estado","cancelada").neq("estado","realizada").order("fecha_cita",{ascending:!1}).limit(3);N?.forEach(n=>{const E=new Date(n.fecha_cita).toLocaleDateString("es-ES",{day:"numeric",month:"short"});o.push({id:n.id,tipo:"clinico",mensaje:`Revisa la sesi√≥n pendiente de ${n.pacientes?.nombre_completo||"paciente"} del ${E}`,paciente:n.pacientes?.nombre_completo||"Paciente",accion:"ver"})});const{data:I}=await b.from("bonos").select(`
        id,
        sesiones_restantes,
        pacientes (
          nombre_completo
        )
      `).eq("estado","activo").lte("sesiones_restantes",2).gt("sesiones_restantes",0).limit(3);I?.forEach(n=>{o.push({id:n.id,tipo:"bono",mensaje:`El bono est√° por agotarse (quedan ${n.sesiones_restantes} sesiones)`,paciente:n.pacientes?.nombre_completo||"Paciente",accion:"ver"})}),fe.value=o.slice(0,8)}catch(t){console.error("Error al generar recordatorios:",t),fe.value=[]}finally{Ce.value=!1}}async function Te(){try{if(!C.value?.email)return;const{data:o}=await b.from("terapeutas").select("id").eq("email",C.value.email).single();if(!o)return;const{data:t}=await b.from("pacientes").select("id").eq("terapeuta_id",o.id);if(!t||t.length===0){_.value=0,ce.value=0,O.value=0;return}const d=t.map(R=>R.id),l=new Date;l.setHours(0,0,0,0),S.value==="mes"?l.setDate(1):S.value==="3meses"?(l.setMonth(l.getMonth()-2),l.setDate(1)):(l.setMonth(0),l.setDate(1));const f=l.toISOString().split("T")[0],M=new Date().toISOString().split("T")[0],{data:H}=await b.from("bonos").select("id, monto_total, created_at").eq("pagado",!0).in("paciente_id",d).gte("created_at",f).lte("created_at",M);let N=0,I=0;H&&H.length>0&&(I=H.length,N=H.reduce((R,T)=>R+(T.monto_total||0),0));const{data:n}=await b.from("citas").select("id, precio_sesion, fecha_pago").eq("estado_pago","pagado").in("paciente_id",d).gte("fecha_pago",f).lte("fecha_pago",M);let E=0,P=0;n&&n.length>0&&(P=n.length,E=n.reduce((R,T)=>R+(T.precio_sesion||0),0));const Z=N+E;if(_.value=Z,ce.value=I+P,S.value==="mes"){const R=new Date(l);R.setMonth(R.getMonth()-1);const T=new Date(l);T.setDate(T.getDate()-1);const J=R.toISOString().split("T")[0],ze=T.toISOString().split("T")[0],{data:he}=await b.from("bonos").select("monto_total").eq("pagado",!0).in("paciente_id",d).gte("created_at",J).lte("created_at",ze);let Ae=0;he&&he.length>0&&(Ae=he.reduce((ye,_e)=>ye+(_e.monto_total||0),0));const{data:be}=await b.from("citas").select("precio_sesion").eq("estado_pago","pagado").in("paciente_id",d).gte("fecha_pago",J).lte("fecha_pago",ze);let He=0;be&&be.length>0&&(He=be.reduce((ye,_e)=>ye+(_e.precio_sesion||0),0));const pe=Ae+He;ge.value=pe,pe>0?O.value=Math.round((_.value-pe)/pe*100):_.value>0?O.value=100:O.value=0}else O.value=0}catch(o){console.error("Error al cargar pagos confirmados:",o),_.value=0,ce.value=0,O.value=0}}const lt=o=>o.toFixed(2);ke(async()=>{await rt(),await de(),await it(),await Me(),await Be(),await Te(),await je(),await Pe(),window.addEventListener("citas:actualizadas",Ve)}),Le(()=>{window.removeEventListener("citas:actualizadas",Ve)});function Ve(o){console.log("üì° [Dashboard] Evento recibido:",o.detail),de()}return(o,t)=>{const d=Gt,l=ft,f=ds,M=Is,H=Gs,N=ao,I=xt;return a(),r("div",no,[e("div",ro,[e("header",io,[e("div",lo,[e("div",null,[e("h1",co,i(s(Oe)),1),e("p",uo,[s(W)>0?(a(),r("span",mo,[t[4]||(t[4]=e("span",{class:"w-2 h-2 rounded-full bg-violet-500"},null,-1)),e("span",po,i(s(W))+" "+i(s(W)===1?"sesi√≥n":"sesiones"),1)])):k("",!0),s(W)>0&&s(oe)>0?(a(),r("span",go,"‚Ä¢")):k("",!0),s(oe)>0?(a(),r("span",fo,[t[5]||(t[5]=e("span",{class:"w-2 h-2 rounded-full bg-amber-500"},null,-1)),e("span",vo,i(s(oe))+" "+i(s(oe)===1?"cobro pendiente":"cobros pendientes"),1)])):k("",!0),s(W)===0&&s(oe)===0?(a(),r("span",xo," Sin tareas pendientes para hoy ")):k("",!0)])]),e("div",{class:"flex items-center gap-3"},[e("button",{onClick:Ze,class:"inline-flex items-center gap-2 px-5 py-2.5 bg-violet-600 text-white rounded-lg font-semibold hover:bg-violet-700 shadow-sm hover:shadow transition-all"},[...t[6]||(t[6]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),Q(" Nueva cita ",-1)])]),e("button",{onClick:et,class:"inline-flex items-center gap-2 px-5 py-2.5 bg-white text-gray-700 rounded-lg font-medium border border-gray-200 hover:border-violet-300 hover:bg-violet-50 hover:text-violet-700 transition-all"},[...t[7]||(t[7]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"})],-1),Q(" Nuevo paciente ",-1)])])])]),ee(d,{onAbrirCita:X})]),e("div",ho,[e("section",bo,[e("div",yo,[e("div",_o,[t[9]||(t[9]=e("div",{class:"w-10 h-10 rounded-lg bg-violet-100 flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-violet-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1)),e("div",null,[t[8]||(t[8]=e("h2",{class:"text-lg font-semibold text-gray-900"},"Sesiones de hoy",-1)),e("p",wo,[Q(i(s(Ie))+" ¬∑ ",1),e("span",{class:q(s(W)>0?"text-violet-600 font-medium":"text-gray-400")},i(s(W))+" "+i(s(W)===1?"sesi√≥n programada":"sesiones programadas"),3)])])]),ee(l,{to:"/terapeuta/agenda",class:"inline-flex items-center gap-1 text-sm font-medium text-violet-600 hover:text-violet-700 transition-colors"},{default:ae(()=>[...t[10]||(t[10]=[Q(" Ver agenda ",-1),e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])]),_:1})]),e("div",ko,[s(y)?(a(),r("div",Co,[...t[11]||(t[11]=[e("div",{class:"w-8 h-8 border-2 border-gray-200 border-t-violet-600 rounded-full animate-spin mb-3"},null,-1),e("p",{class:"text-sm text-gray-500"},"Cargando sesiones...",-1)])])):s(W)===0?(a(),r("div",$o,[t[14]||(t[14]=e("div",{class:"w-16 h-16 rounded-full bg-violet-50 flex items-center justify-center mb-4"},[e("svg",{class:"w-8 h-8 text-violet-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1)),e("p",Do,i(s(ve)?"D√≠a libre":"Hoy no tienes sesiones programadas"),1),e("p",So,i(s(ve)?"Disfruta de tu descanso":"Aprovecha para organizar tu agenda o a√±adir nuevas citas"),1),s(ve)?k("",!0):(a(),ie(l,{key:0,to:"/terapeuta/agenda",class:"inline-flex items-center gap-2 px-5 py-2.5 bg-violet-600 text-white rounded-lg font-medium hover:bg-violet-700 transition-colors"},{default:ae(()=>[...t[12]||(t[12]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),Q(" Programar cita ",-1)])]),_:1})),s(u).length>0?(a(),r("div",Mo,[t[13]||(t[13]=e("p",{class:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-3"},"Pr√≥ximas sesiones",-1)),e("div",jo,[(a(!0),r(F,null,K(s(u).slice(0,3),(n,E)=>(a(),ie(f,{key:n.id,id:n.id,fecha:n.fecha_cita,hora:n.hora_inicio,"paciente-nombre":n.paciente_nombre,modalidad:n.modalidad,estado:n.estado,"is-next":E===0,onClick:X,onConfirmar:xe,onRegistrarPago:X},null,8,["id","fecha","hora","paciente-nombre","modalidad","estado","is-next"]))),128))])])):k("",!0)])):(a(),r("div",Bo,[(a(!0),r(F,null,K(s(Ne),(n,E)=>(a(),ie(f,{key:n.id,id:n.id,fecha:n.fecha_cita,hora:n.hora_inicio,"paciente-nombre":n.paciente_nombre,modalidad:n.modalidad,estado:n.estado,"is-next":E===0,onClick:X,onConfirmar:xe,onRegistrarPago:X},null,8,["id","fecha","hora","paciente-nombre","modalidad","estado","is-next"]))),128)),s(re).length>0?(a(),r("div",Po,[t[15]||(t[15]=e("p",{class:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-3"},"Pr√≥ximos d√≠as",-1)),e("div",To,[(a(!0),r(F,null,K(s(Fe),(n,E)=>(a(),ie(f,{key:n.id,id:n.id,fecha:n.fecha_cita,hora:n.hora_inicio,"paciente-nombre":n.paciente_nombre,modalidad:n.modalidad,estado:n.estado,"is-next":!1,onClick:X,onConfirmar:xe,onRegistrarPago:X},null,8,["id","fecha","hora","paciente-nombre","modalidad","estado"]))),128))])])):k("",!0),s(re).length>3&&!s(g)?(a(),r("button",{key:1,onClick:t[0]||(t[0]=n=>g.value=!0),class:"w-full py-3 text-sm font-medium text-violet-600 hover:text-violet-700 hover:bg-violet-50 rounded-xl transition-colors flex items-center justify-center gap-2"},[e("span",null,"Ver "+i(s(re).length-3)+" sesiones m√°s",1),t[16]||(t[16]=e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1))])):k("",!0),s(g)&&s(re).length>3?(a(),r("button",{key:2,onClick:t[1]||(t[1]=n=>g.value=!1),class:"w-full py-3 text-sm font-medium text-gray-500 hover:text-gray-700 hover:bg-gray-50 rounded-xl transition-colors flex items-center justify-center gap-2"},[...t[17]||(t[17]=[e("span",null,"Mostrar menos",-1),e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 15l7-7 7 7"})],-1)])])):k("",!0)]))])]),ee(M,{ref_key:"paymentsTodayCardRef",ref:me,onAbrirCita:X,onCobrar:X},null,512)]),e("div",Vo,[e("section",zo,[e("div",Ao,[e("div",Ho,[t[19]||(t[19]=e("div",{class:"w-10 h-10 rounded-lg bg-emerald-100 flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-emerald-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})])],-1)),e("div",null,[t[18]||(t[18]=e("h2",{class:"text-lg font-semibold text-gray-900"},"Actividad reciente de pacientes",-1)),e("p",Ro,"√öltimos "+i(s(te))+" d√≠as",1)])]),ee(l,{to:"/terapeuta/pacientes",class:"inline-flex items-center gap-1 text-sm font-medium text-violet-600 hover:text-violet-700 transition-colors"},{default:ae(()=>[...t[20]||(t[20]=[Q(" Ver todos ",-1),e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])]),_:1})]),e("div",Eo,[e("div",Lo,[t[21]||(t[21]=e("span",{class:"text-xs text-gray-500 mr-1"},"Ver √∫ltimos:",-1)),(a(),r(F,null,K([5,10,30],n=>e("button",{key:n,onClick:E=>Se(n),class:q(["px-2.5 py-1 text-xs font-medium rounded-full transition-colors",s(te)===n?"bg-violet-100 text-violet-700":"text-gray-500 hover:bg-gray-100 hover:text-gray-700"])},i(n)+" d√≠as ",11,Oo)),64))])]),e("div",Io,[s(z)?(a(),r("div",qo,[...t[22]||(t[22]=[e("div",{class:"w-8 h-8 border-2 border-gray-200 border-t-emerald-600 rounded-full animate-spin mb-2"},null,-1),e("p",{class:"text-sm text-gray-500"},"Cargando...",-1)])])):s($).length===0?(a(),r("div",No,[t[23]||(t[23]=e("div",{class:"w-12 h-12 rounded-full bg-violet-50 flex items-center justify-center mb-3"},[e("svg",{class:"w-6 h-6 text-violet-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})])],-1)),t[24]||(t[24]=e("p",{class:"text-gray-700 font-medium mb-1"},"Sin sesiones en este per√≠odo",-1)),e("p",Fo,"No hay pacientes con citas en los √∫ltimos "+i(s(te))+" d√≠as. Prueba ampliando el filtro.",1),s(te)<30?(a(),r("button",{key:0,onClick:t[2]||(t[2]=n=>Se(30)),class:"text-sm font-medium text-violet-600 hover:text-violet-700 hover:underline"}," Ver √∫ltimos 30 d√≠as ")):k("",!0)])):(a(),r("div",Uo,[(a(!0),r(F,null,K(s($),n=>(a(),ie(H,{key:n.id,id:n.id,nombre:n.nombre_completo,"ultima-sesion":n.ultima_sesion,"sesiones-usadas":n.sesiones_usadas,"sesiones-totales":n.sesiones_totales,"estado-bono":n.estado_bono,onClick:tt},null,8,["id","nombre","ultima-sesion","sesiones-usadas","sesiones-totales","estado-bono"]))),128))]))])]),e("section",Ko,[e("div",Yo,[e("div",Qo,[t[27]||(t[27]=e("div",{class:"w-10 h-10 rounded-lg bg-amber-100 flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"})])],-1)),e("div",null,[e("h2",Jo,[t[25]||(t[25]=Q(" Bonos por agotarse ",-1)),s(U).length>0?(a(),r("span",Go,"("+i(s(U).length)+")",1)):k("",!0)]),t[26]||(t[26]=e("p",{class:"text-xs text-gray-500"},"Bonos con 2 sesiones o menos",-1))])]),s(ne)?k("",!0):(a(),r("button",{key:0,onClick:je,class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-50 rounded-lg transition-colors",title:"Actualizar bonos"},[...t[28]||(t[28]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)])]))]),e("div",Wo,[s(ne)?(a(),r("div",Xo,[...t[29]||(t[29]=[e("div",{class:"w-8 h-8 border-2 border-gray-200 border-t-amber-600 rounded-full animate-spin mb-2"},null,-1),e("p",{class:"text-sm text-gray-500"},"Cargando bonos...",-1)])])):s(U).length===0?(a(),r("div",Zo,[...t[30]||(t[30]=[we('<div class="w-12 h-12 rounded-full bg-emerald-50 flex items-center justify-center mb-3" data-v-21d99988><svg class="w-6 h-6 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-21d99988><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" data-v-21d99988></path></svg></div><p class="text-gray-700 font-medium" data-v-21d99988>Todos los bonos bajo control</p><p class="text-sm text-gray-400 mt-1 max-w-[200px]" data-v-21d99988>Ning√∫n paciente necesita renovar su bono pr√≥ximamente</p>',3)])])):(a(),r("div",ea,[(a(!0),r(F,null,K(s(We),n=>(a(),ie(N,{key:n.id,id:n.id,"paciente-id":n.paciente_id,"paciente-nombre":n.paciente_nombre,"tipo-bono":n.tipo_bono,"sesiones-restantes":n.sesiones_restantes,"sesiones-totales":n.sesiones_totales,"ultima-sesion":n.ultima_sesion,onVerBono:st,onProgramarCita:ot},null,8,["id","paciente-id","paciente-nombre","tipo-bono","sesiones-restantes","sesiones-totales","ultima-sesion"]))),128)),s(U).length>4&&!s(G)?(a(),r("button",{key:0,onClick:t[3]||(t[3]=n=>G.value=!0),class:"w-full py-2 text-sm font-medium text-amber-600 hover:text-amber-700 hover:bg-amber-50 rounded-lg transition-colors"}," Ver "+i(s(U).length-4)+" m√°s ",1)):k("",!0)]))])])]),e("div",ta,[e("section",sa,[e("div",oa,[e("div",aa,[t[32]||(t[32]=e("div",{class:"w-10 h-10 rounded-lg bg-violet-100 flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-violet-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})])],-1)),e("div",null,[t[31]||(t[31]=e("h2",{class:"text-lg font-semibold text-gray-900"},"Anal√≠tica del Profesional",-1)),e("p",na,i(s(Xe)),1)])]),e("div",ra,[(a(),r(F,null,K(m,n=>e("button",{key:n.valor,onClick:E=>at(n.valor),class:q(["px-3 py-1.5 text-xs font-medium rounded-md transition-colors",s(S)===n.valor?"bg-white text-violet-700 shadow-sm":"text-gray-500 hover:text-gray-700"])},i(n.etiqueta),11,ia)),64))])]),e("div",la,[e("div",ca,[ee(l,{to:"/terapeuta/pacientes",class:"group p-4 bg-gray-50 hover:bg-violet-50 rounded-xl border border-gray-100 hover:border-violet-200 transition-all cursor-pointer"},{default:ae(()=>[t[33]||(t[33]=e("div",{class:"flex items-center gap-2 mb-2"},[e("svg",{class:"w-5 h-5 text-gray-400 group-hover:text-violet-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"})]),e("span",{class:"text-xs font-medium text-gray-500 group-hover:text-violet-600"},"Pacientes activos")],-1)),e("p",da,i(s(L)),1),t[34]||(t[34]=e("p",{class:"text-xs text-gray-400 mt-1 group-hover:text-violet-500"},"Ver todos ‚Üí",-1))]),_:1}),ee(l,{to:"/terapeuta/sesiones",class:"group p-4 bg-gray-50 hover:bg-violet-50 rounded-xl border border-gray-100 hover:border-violet-200 transition-all cursor-pointer"},{default:ae(()=>[t[35]||(t[35]=e("div",{class:"flex items-center gap-2 mb-2"},[e("svg",{class:"w-5 h-5 text-gray-400 group-hover:text-violet-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})]),e("span",{class:"text-xs font-medium text-gray-500 group-hover:text-violet-600"},"Sesiones")],-1)),e("p",ua,i(s(B)),1),t[36]||(t[36]=e("p",{class:"text-xs text-gray-400 mt-1 group-hover:text-violet-500"},"Ver sesiones ‚Üí",-1))]),_:1}),e("div",ma,[t[37]||(t[37]=e("div",{class:"flex items-center gap-2 mb-2"},[e("svg",{class:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})]),e("span",{class:"text-xs font-medium text-gray-500"},"Ocupaci√≥n")],-1)),e("p",{class:q(["text-3xl font-bold",s(p)>=70?"text-emerald-600":s(p)>=40?"text-amber-600":"text-gray-900"])},i(s(p))+"% ",3),e("p",pa,i(s(v).horasOcupadas)+"h de "+i(s(v).horasDisponibles)+"h disponibles ",1)]),e("div",ga,[t[38]||(t[38]=e("div",{class:"flex items-center gap-2 mb-2"},[e("svg",{class:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M6 18L18 6M6 6l12 12"})]),e("span",{class:"text-xs font-medium text-gray-500"},"Cancelaciones")],-1)),e("p",{class:q(["text-3xl font-bold",s(j)<=10?"text-emerald-600":s(j)<=20?"text-amber-600":"text-red-600"])},i(s(j))+"% ",3),s(v).cancelaciones>0?(a(),r("p",fa,i(s(v).cancelaciones)+" de "+i(s(v).totalCitas)+" citas ",1)):(a(),r("p",va,"Sin cancelaciones"))]),ee(l,{to:"/terapeuta/pagos",class:"group p-4 bg-emerald-50 hover:bg-emerald-100 rounded-xl border border-emerald-200 hover:border-emerald-300 transition-all cursor-pointer"},{default:ae(()=>[e("div",xa,[t[39]||(t[39]=e("div",{class:"flex items-center gap-2"},[e("svg",{class:"w-5 h-5 text-emerald-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("span",{class:"text-xs font-medium text-emerald-600"},"Ingresos")],-1)),s(O)!==0?(a(),r("span",{key:0,class:q(["px-1.5 py-0.5 text-[10px] font-semibold rounded",s(O)>0?"bg-emerald-200 text-emerald-700":"bg-red-100 text-red-600"])},i(s(O)>0?"‚Üë":"‚Üì")+" "+i(Math.abs(s(O)))+"% ",3)):k("",!0)]),e("p",ha,i(lt(s(_)))+"‚Ç¨",1),e("p",ba,i(s(ce))+" "+i(s(ce)===1?"pago":"pagos")+" ¬∑ Ver pagos ‚Üí ",1)]),_:1})])])])])]),ee(I,{"is-open":s(Y),"cita-id":s(D),onClose:nt,onCitaActualizada:de,onActualizado:de},null,8,["is-open","cita-id"])])}}}),La=ht(ya,[["__scopeId","data-v-21d99988"]]);export{La as default};
