import{p as D,L as C,r as c,x as E,c as m,a as o,j as P,h as x,k as s,d as g,v as u,l as a,K as y,i as w,X as _,t as k,o as f}from"#entry";const M={class:"max-w-3xl mx-auto pb-20"},N={class:"bg-white rounded-xl shadow-sm border border-gray-100 p-6"},U={class:"flex items-center gap-3"},A={key:0,class:"p-4 bg-red-50 border border-red-200 rounded-lg flex items-start gap-3"},T={class:"flex-1"},j={class:"text-sm text-red-600 mt-1"},I={class:"flex gap-3 pt-4"},O=["disabled"],q=["disabled"],L={key:0,class:"animate-spin"},F={__name:"nuevo",setup($){const d=D(),p=C(),t=c({nombre_completo:"",email:"",telefono:"",area_de_acompanamiento:"",frecuencia:"",notas_iniciales:"",activo:!0}),l=c(!1),i=c(""),b=E(()=>t.value.nombre_completo.trim()!==""&&t.value.email.trim()!==""&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.value.email)),S=async()=>{if(!b.value){i.value="Por favor completa todos los campos obligatorios";return}l.value=!0,i.value="";try{const r={nombre_completo:t.value.nombre_completo.trim(),email:t.value.email.trim().toLowerCase(),telefono:t.value.telefono.trim()||null,area_de_acompanamiento:t.value.area_de_acompanamiento||null,frecuencia:t.value.frecuencia||null,activo:t.value.activo,created_at:new Date().toISOString()},{data:e}=await d.from("pacientes").select("id").eq("email",r.email).single();if(e){i.value="Ya existe un paciente con este email";return}const{data:n,error:v}=await d.from("pacientes").insert([r]).select().single();if(v)throw v;t.value.notas_iniciales.trim()&&n&&await d.from("sesiones").insert([{paciente_id:n.id,fecha:new Date().toISOString().split("T")[0],notas:t.value.notas_iniciales.trim(),tipo:"evaluacion_inicial"}]),p.push(`/coordinadora/pacientes/${n.id}`)}catch(r){console.error("Error al guardar paciente:",r),i.value=r.message||"Error al guardar el paciente. Por favor intenta de nuevo."}finally{l.value=!1}},V=()=>{l.value||(t.value.nombre_completo||t.value.email?confirm("¿Estás seguro de cancelar? Los datos no guardados se perderán.")&&p.push("/coordinadora/pacientes"):p.push("/coordinadora/pacientes"))};return(r,e)=>(f(),m("div",M,[o("button",{onClick:e[0]||(e[0]=n=>r.$router.push("/coordinadora/pacientes")),class:"mb-6 flex items-center gap-2 text-cafe hover:text-purple-600 transition-colors"},[...e[8]||(e[8]=[o("span",null,"←",-1),o("span",null,"Volver a lista de pacientes",-1)])]),e[21]||(e[21]=o("div",{class:"mb-8"},[o("h1",{class:"text-3xl font-serif font-bold text-cafe mb-2"}," Nuevo Paciente "),o("p",{class:"text-cafe/60"}," Completa la información del nuevo paciente ")],-1)),o("div",N,[o("form",{onSubmit:P(S,["prevent"]),class:"space-y-6"},[o("div",null,[e[9]||(e[9]=o("label",{class:"block text-sm font-medium text-cafe mb-2"},[g(" Nombre Completo "),o("span",{class:"text-red-500"},"*")],-1)),s(o("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>a(t).nombre_completo=n),type:"text",required:"",placeholder:"Ej: María García López",class:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-300 focus:border-transparent"},null,512),[[u,a(t).nombre_completo]])]),o("div",null,[e[10]||(e[10]=o("label",{class:"block text-sm font-medium text-cafe mb-2"},[g(" Email "),o("span",{class:"text-red-500"},"*")],-1)),s(o("input",{"onUpdate:modelValue":e[2]||(e[2]=n=>a(t).email=n),type:"email",required:"",placeholder:"ejemplo@correo.com",class:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-300 focus:border-transparent"},null,512),[[u,a(t).email]])]),o("div",null,[e[11]||(e[11]=o("label",{class:"block text-sm font-medium text-cafe mb-2"}," Teléfono ",-1)),s(o("input",{"onUpdate:modelValue":e[3]||(e[3]=n=>a(t).telefono=n),type:"tel",placeholder:"+34 600 000 000",class:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-300 focus:border-transparent"},null,512),[[u,a(t).telefono]]),e[12]||(e[12]=o("p",{class:"text-xs text-gray-500 mt-1"}," Incluye el código de país para WhatsApp ",-1))]),o("div",null,[e[14]||(e[14]=o("label",{class:"block text-sm font-medium text-cafe mb-2"}," Área de Acompañamiento ",-1)),s(o("select",{"onUpdate:modelValue":e[4]||(e[4]=n=>a(t).area_de_acompanamiento=n),class:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-300 focus:border-transparent"},[...e[13]||(e[13]=[w('<option value="">Selecciona un área</option><option value="Ansiedad">Ansiedad</option><option value="Depresión">Depresión</option><option value="Duelo">Duelo</option><option value="Autoestima">Autoestima</option><option value="Relaciones">Relaciones</option><option value="Familia">Familia</option><option value="Trauma">Trauma</option><option value="Estrés">Estrés</option><option value="Desarrollo Personal">Desarrollo Personal</option><option value="Otro">Otro</option>',11)])],512),[[y,a(t).area_de_acompanamiento]])]),o("div",null,[e[16]||(e[16]=o("label",{class:"block text-sm font-medium text-cafe mb-2"}," Frecuencia de Sesiones ",-1)),s(o("select",{"onUpdate:modelValue":e[5]||(e[5]=n=>a(t).frecuencia=n),class:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-300 focus:border-transparent"},[...e[15]||(e[15]=[w('<option value="">Selecciona una frecuencia</option><option value="semanal">Semanal</option><option value="quincenal">Quincenal</option><option value="mensual">Mensual</option><option value="ocasional">Ocasional</option>',5)])],512),[[y,a(t).frecuencia]])]),o("div",null,[e[17]||(e[17]=o("label",{class:"block text-sm font-medium text-cafe mb-2"}," Notas Iniciales ",-1)),s(o("textarea",{"onUpdate:modelValue":e[6]||(e[6]=n=>a(t).notas_iniciales=n),rows:"4",placeholder:"Información relevante sobre el paciente...",class:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-300 focus:border-transparent resize-none"},null,512),[[u,a(t).notas_iniciales]])]),o("div",U,[s(o("input",{"onUpdate:modelValue":e[7]||(e[7]=n=>a(t).activo=n),type:"checkbox",id:"activo",class:"w-5 h-5 text-purple-600 border-gray-300 rounded focus:ring-2 focus:ring-purple-300"},null,512),[[_,a(t).activo]]),e[18]||(e[18]=o("label",{for:"activo",class:"text-sm font-medium text-cafe cursor-pointer"}," Paciente activo ",-1))]),a(i)?(f(),m("div",A,[e[20]||(e[20]=o("span",{class:"text-red-500 text-lg"},"⚠️",-1)),o("div",T,[e[19]||(e[19]=o("p",{class:"text-sm font-medium text-red-800"},"Error al guardar",-1)),o("p",j,k(a(i)),1)])])):x("",!0),o("div",I,[o("button",{type:"button",onClick:V,disabled:a(l),class:"flex-1 px-6 py-3 border border-gray-300 text-cafe rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50"}," Cancelar ",8,O),o("button",{type:"submit",disabled:a(l)||!a(b),class:"flex-1 px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[a(l)?(f(),m("span",L,"⏳")):x("",!0),o("span",null,k(a(l)?"Guardando...":"Guardar Paciente"),1)],8,q)])],32)])]))}};export{F as default};
