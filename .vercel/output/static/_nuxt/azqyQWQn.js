import{c as l,o as r,a as e,e as Qe,J as We,q as G,r as b,C as oe,f as et,B as tt,g as d,i as se,b as c,t as i,k as o,d as _,j as R,v as ae,l as ot,F as E,s as M,y as w,x as st,V as at,A as nt,z as rt,T as lt,w as it,D as Fe,E as Pe,ac as Se}from"#entry";import{u as dt}from"./C9Vbupfc.js";import{u as ct}from"./BbZO5sJf.js";import{u as $e}from"./DfvkngRd.js";import{r as V}from"./Bi0YyG7H.js";import{r as K}from"./mZ3toP8Y.js";import{r as ue}from"./DRclOuRO.js";import{r as me}from"./B5My0XuL.js";import{r as Ee}from"./G1mM6o1b.js";import{r as Me}from"./BreoAuwB.js";import{r as ut}from"./Byc3y-S3.js";import{r as je}from"./CQZt9cKZ.js";import{r as pe,a as Te}from"./BaRJRhc1.js";import{_ as mt}from"./DlAUqK2U.js";function pt(g,z){return r(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3.75 21h16.5M4.5 3h15M5.25 3v18m13.5-18v18M9 6.75h1.5m-1.5 3h1.5m-1.5 3h1.5m3-6H15m-1.5 3H15m-1.5 3H15M9 21v-3.375c0-.621.504-1.125 1.125-1.125h3.75c.621 0 1.125.504 1.125 1.125V21"})])}function bt(g,z){return r(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12.75 11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 0 1-1.043 3.296 3.745 3.745 0 0 1-3.296 1.043A3.745 3.745 0 0 1 12 21c-1.268 0-2.39-.63-3.068-1.593a3.746 3.746 0 0 1-3.296-1.043 3.745 3.745 0 0 1-1.043-3.296A3.745 3.745 0 0 1 3 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 0 1 1.043-3.296 3.746 3.746 0 0 1 3.296-1.043A3.746 3.746 0 0 1 12 3c1.268 0 2.39.63 3.068 1.593a3.746 3.746 0 0 1 3.296 1.043 3.746 3.746 0 0 1 1.043 3.296A3.745 3.745 0 0 1 21 12Z"})])}function be(g,z){return r(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 17.25v1.007a3 3 0 0 1-.879 2.122L7.5 21h9l-.621-.621A3 3 0 0 1 15 18.257V17.25m6-12V15a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 15V5.25m18 0A2.25 2.25 0 0 0 18.75 3H5.25A2.25 2.25 0 0 0 3 5.25m18 0V12a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 12V5.25"})])}function ne(g,z){return r(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"})])}function ft(g,z){return r(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 0 0 2.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 0 1-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 0 0-1.091-.852H4.5A2.25 2.25 0 0 0 2.25 4.5v2.25Z"})])}const vt={class:"bg-white/95 backdrop-blur-lg rounded-2xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto border border-white/30"},xt={class:"sticky top-0 bg-gradient-to-r from-[#5550F2]/5 via-[#027368]/5 to-[#04BF9D]/5 backdrop-blur-md border-b border-neutral-200 px-6 py-4 flex justify-between items-center shadow-sm"},ht={class:"text-2xl font-['Elms_Sans'] text-neutral-800 font-semibold"},gt={key:0,class:"text-sm text-neutral-600 mt-1"},_t={key:0,class:"p-4 bg-gradient-to-r from-emerald-50 to-teal-50 border border-emerald-200 rounded-xl shadow-sm"},wt={class:"flex items-center justify-between"},yt={class:"flex items-center gap-3"},kt={class:"w-12 h-12 rounded-full bg-emerald-500 flex items-center justify-center flex-shrink-0"},At={class:"font-bold text-emerald-900 text-lg"},Dt={class:"text-sm text-emerald-700 flex items-center gap-1 mt-0.5"},Ct={key:0,class:"mt-2 flex items-center gap-2 text-xs"},Ft={class:"text-emerald-700"},Pt={class:"capitalize"},St={class:"text-right"},$t={key:0,class:"flex items-center gap-1 text-xs text-emerald-700 font-semibold mb-1"},Et={key:1,class:"text-2xl font-bold text-emerald-900"},Mt={key:2,class:"text-xs text-emerald-600"},jt={key:1,class:"space-y-4"},Tt={class:"flex items-center justify-between"},Bt={class:"text-lg font-['Elms_Sans'] text-neutral-800 font-semibold flex items-center gap-2"},It={key:0,class:"w-7 h-7 rounded-full bg-gradient-to-r from-[#5550F2] to-[#027368] text-white flex items-center justify-center text-sm font-bold shadow-sm"},Nt={key:1,class:"w-7 h-7 rounded-full bg-gradient-to-r from-[#04BF9D] to-[#027368] text-white flex items-center justify-center shadow-sm"},Vt={key:0,class:"p-3 bg-blue-50 border-l-4 border-blue-400 rounded"},zt={class:"flex items-center gap-2 text-sm text-blue-800"},Ht={key:1,class:"space-y-3"},Lt={class:"absolute left-3 top-1/2 -translate-y-1/2"},Ut={key:0,class:"absolute right-3 top-1/2 -translate-y-1/2"},qt={key:1,class:"mt-1 flex items-center gap-2 text-xs text-neutral-500"},Ot={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Rt=["onClick"],Jt={class:"flex items-center gap-3"},Zt={class:"w-12 h-12 rounded-xl bg-gradient-to-br from-[#027368]/20 to-[#04BF9D]/20 group-hover:from-[#027368] group-hover:to-[#04BF9D] flex items-center justify-center transition-all"},Gt={class:"flex-1"},Kt={class:"font-medium text-neutral-800 group-hover:text-[#027368] transition-colors"},Xt={class:"text-sm text-neutral-600"},Yt={key:0,class:"text-xs text-neutral-500 mt-1 flex items-center gap-1"},Qt={class:"font-medium capitalize"},Wt={key:1,class:"border border-neutral-200 rounded-xl bg-white/90 backdrop-blur-sm p-6 text-center text-sm text-neutral-600 shadow-sm"},eo={key:2,class:"space-y-3"},to={class:"p-4 bg-gradient-to-r from-emerald-50 to-teal-50 border border-emerald-200 rounded-xl shadow-sm"},oo={class:"flex items-start justify-between gap-3"},so={class:"flex items-center gap-3 flex-1"},ao={class:"w-12 h-12 rounded-full bg-emerald-500 flex items-center justify-center flex-shrink-0"},no={class:"flex-1"},ro={class:"font-bold text-emerald-900 text-lg"},lo={class:"text-sm text-emerald-700 flex items-center gap-1 mt-0.5"},io={key:0,class:"mt-2 flex items-center gap-2 text-sm"},co={class:"px-2 py-0.5 bg-emerald-100 text-emerald-800 rounded-lg font-medium capitalize"},uo={key:0,class:"p-5 bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 border-2 border-blue-300 rounded-xl shadow-md"},mo={class:"flex items-center justify-between mb-4"},po={class:"flex items-center gap-3"},bo={class:"w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center"},fo={class:"text-right"},vo={class:"grid grid-cols-3 gap-3 mb-4"},xo={class:"bg-white p-3 rounded-lg border border-blue-200"},ho={class:"font-bold text-blue-900 capitalize text-sm"},go={class:"bg-white p-3 rounded-lg border border-blue-200"},_o={class:"font-bold text-blue-900 text-sm"},wo={class:"bg-white p-3 rounded-lg border border-blue-200"},yo={class:"font-bold text-blue-900 text-sm"},ko={class:"mb-4"},Ao={class:"flex justify-between text-xs text-blue-700 mb-1"},Do={class:"font-semibold"},Co={class:"w-full bg-blue-200 rounded-full h-3 overflow-hidden"},Fo={key:0,class:"mb-4 flex items-start gap-3 p-3 bg-amber-50 border-l-4 border-amber-500 rounded-lg"},Po={class:"text-sm"},So={class:"font-semibold text-amber-900 mb-1"},$o={class:"text-amber-800"},Eo={class:"flex items-start gap-3 p-3 bg-white border-2 border-blue-300 rounded-lg"},Mo={for:"descontar-bono",class:"flex-1 cursor-pointer"},jo={class:"text-xs text-blue-700"},To={key:1,class:"p-4 bg-gradient-to-r from-amber-50 to-orange-50 border-l-4 border-amber-400 rounded-lg shadow-sm"},Bo={class:"flex items-start gap-3"},Io={key:2,class:"space-y-4 pt-4 border-t-2 border-[#D8AFA0]/30"},No={class:"flex items-center justify-between"},Vo={class:"text-lg font-['Lora'] text-[#5D4A44] font-semibold flex items-center gap-2"},zo={key:0,class:"w-7 h-7 rounded-full bg-[#D8AFA0] text-white flex items-center justify-center text-sm font-bold"},Ho={key:1,class:"w-7 h-7 rounded-full bg-emerald-500 text-white flex items-center justify-center"},Lo={key:0,class:"p-3 bg-purple-50 border-l-4 border-purple-400 rounded"},Uo={class:"flex items-center gap-2 text-sm text-purple-800"},qo={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Oo=["onClick"],Ro={class:"flex items-center gap-3"},Jo={class:"w-12 h-12 rounded-full bg-[#D8AFA0]/20 group-hover:bg-[#D8AFA0] flex items-center justify-center transition-colors"},Zo={class:"flex-1"},Go={class:"font-medium text-[#5D4A44] group-hover:text-[#D8AFA0] transition-colors"},Ko={key:0,class:"text-sm text-[#5D4A44]/60"},Xo={class:"text-xs text-[#5D4A44]/50"},Yo={key:2,class:"p-4 bg-gradient-to-r from-emerald-50 to-teal-50 border border-emerald-200 rounded-xl shadow-sm"},Qo={class:"flex items-start justify-between gap-3"},Wo={class:"flex items-center gap-3 flex-1"},es={class:"w-12 h-12 rounded-full bg-emerald-500 flex items-center justify-center flex-shrink-0"},ts={class:"flex-1"},os={class:"font-bold text-emerald-900 text-lg"},ss={key:0,class:"text-sm text-emerald-700 mt-0.5"},as={class:"space-y-6 pt-4 border-t-2 border-[#D8AFA0]/30"},ns={class:"text-lg font-['Lora'] text-[#5D4A44] font-semibold flex items-center gap-2"},rs={key:0,class:"w-7 h-7 rounded-full bg-[#D8AFA0] text-white flex items-center justify-center text-sm font-bold"},ls={key:1,class:"w-7 h-7 rounded-full bg-green-500 text-white flex items-center justify-center"},is={class:"p-5 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-xl shadow-sm space-y-4"},ds={class:"text-sm font-bold text-blue-900 flex items-center gap-2"},cs={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},us={class:"block text-sm font-medium text-[#5D4A44] mb-2 flex items-center gap-2"},ms={class:"space-y-2"},ps=["min"],bs={class:"flex gap-2 flex-wrap"},fs=["onClick"],vs={key:0,class:"flex items-center gap-2"},xs={class:"block text-sm font-medium text-[#5D4A44] mb-2 flex items-center gap-2"},hs={class:"space-y-3"},gs={class:"grid grid-cols-4 gap-3 max-h-72 overflow-y-auto p-4 bg-white rounded-lg border border-[#D8AFA0]/20 shadow-inner"},_s=["onClick"],ws={class:"text-xs"},ys={class:"cursor-pointer text-[#5D4A44]/60 hover:text-[#5D4A44] select-none flex items-center gap-2"},ks={class:"mt-2"},As={id:"horas-sugeridas"},Ds=["value"],Cs={key:0,class:"flex items-center gap-2"},Fs={key:1,class:"text-xs text-[#5D4A44]/50 flex items-center gap-2"},Ps=["value"],Ss={class:"p-5 bg-gradient-to-r from-purple-50 to-pink-50 border border-purple-200 rounded-xl shadow-sm space-y-4"},$s={class:"text-sm font-bold text-purple-900 flex items-center gap-2"},Es={class:"block text-sm font-medium text-[#5D4A44] mb-2 flex items-center gap-2"},Ms=["onClick"],js={class:"font-medium text-[#5D4A44] text-sm"},Ts={class:"text-xs text-[#5D4A44]/50"},Bs={class:"block text-sm font-medium text-[#5D4A44] mb-2 flex items-center gap-2"},Is={class:"grid grid-cols-2 md:grid-cols-4 gap-3"},Ns=["onClick"],Vs={class:"font-medium text-sm"},zs={class:"p-5 bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200 rounded-xl shadow-sm"},Hs={class:"text-sm font-bold text-amber-900 flex items-center gap-2 mb-3"},Ls={class:"block text-sm font-medium text-[#5D4A44] mb-2 flex items-center gap-2"},Us={key:3,class:"p-4 bg-yellow-50 border-l-4 border-yellow-500 rounded-lg shadow-sm"},qs={class:"flex items-start gap-3"},Os={key:4,class:"p-4 bg-red-50 border-l-4 border-red-500 rounded-lg shadow-sm"},Rs={class:"flex items-start gap-3"},Js={class:"text-sm text-red-800 space-y-1.5"},Zs={key:0,class:"flex items-center gap-2"},Gs={key:1,class:"flex items-center gap-2"},Ks={key:2,class:"flex items-center gap-2"},Xs={key:3,class:"flex items-center gap-2"},Ys={key:4,class:"flex items-center gap-2"},Qs={key:5,class:"p-4 bg-blue-50 border-l-4 border-blue-500 rounded-lg shadow-sm"},Ws={class:"flex items-start gap-3"},ea={class:"flex-1"},ta={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},oa={class:"text-blue-900 font-semibold"},sa={class:"text-blue-900"},aa={class:"text-blue-900 font-semibold"},na={class:"text-blue-900"},ra={class:"text-blue-900 capitalize"},la={class:"text-blue-900 capitalize"},ia={key:0,class:"md:col-span-2 flex items-center gap-2"},da={class:"sticky bottom-0 bg-[#F9F7F3] pt-4 border-t border-[#D8AFA0]/30 flex gap-3 mt-6"},ca={class:"relative flex-1"},ua=["disabled","aria-label"],ma={key:0,class:"absolute -top-12 left-1/2 -translate-x-1/2 bg-gray-800 text-white text-xs px-3 py-2 rounded shadow-lg whitespace-nowrap opacity-0 hover:opacity-100 transition-opacity pointer-events-none"},pa={class:"flex items-start gap-3 text-white"},ba={class:"text-3xl"},fa={class:"flex-1"},va={class:"font-bold text-lg mb-1"},xa={class:"text-sm opacity-90 mb-3"},ha={key:0,class:"flex gap-2"},ga=["onClick"],_a=Qe({__name:"ModalNuevaCita",props:{modelValue:{type:Boolean,default:!1},mostrar:{type:Boolean,default:!1},fechaPreseleccionada:{type:String,default:""},horaPreseleccionada:{type:String,default:""},titulo:{type:String,default:""},pacientePreseleccionado:{type:Object,default:null},citaId:{type:String,default:null}},emits:["cerrar","citaCreada","actualizado","update:modelValue"],setup(g,{emit:z}){const p=g,H=z,{crearCita:Be,actualizarCita:Ie,getCitasPorDia:Ne,verificarBonoActivo:Ve,sugerirProximoHorario:ze}=dt(),re=ct(),He=We(),Le=G(()=>!!p.citaId);b(!1);const h=b(""),C=b(!1),v=b(null),y=b(!1),A=b(!1),J=b(!1),X=b([]),j=b(null),Y=b(!1),k=b(!1),le=b([]),fe=b(!1),D=b(null),S=b(!1),ie=b(""),de=b(""),L=b("exito"),Q=b([]),u=b({tiene_bono:!1,sesiones_restantes:0,sesiones_totales:0,tipo_bono:"",bono_id:void 0}),s=b({paciente_id:"",paciente_nombre:"",terapeuta_id:"",terapeuta_nombre:"",fecha:p.fechaPreseleccionada||N(new Date),fecha_manual:"",hora_inicio:p.horaPreseleccionada||"",hora_fin:"",duracion:"60",tipo:"presencial",estado:"pendiente",notas:"",descontar_de_bono:!1,bono_id:void 0}),T=b(null);b(!1);const U=b([]),ve=["11:00","11:30","12:00","12:30","13:00","13:30","17:00","17:30","18:00","18:30","19:00","19:30","20:00","20:30","21:00","21:30","22:00"],Ue=[{valor:"presencial",nombre:"Presencial",componente:pt,descripcion:"Sesi√≥n presencial en consultorio"},{valor:"online",nombre:"Online",componente:be,descripcion:"Videollamada por plataforma digital"},{valor:"telefonica",nombre:"Telef√≥nica",componente:ft,descripcion:"Llamada telef√≥nica"}],qe=[{valor:"confirmada",nombre:"Confirmada",componente:bt,claseActivo:"border-emerald-500 bg-emerald-50 text-emerald-700",claseInactivo:"border-gray-300 hover:border-emerald-400 bg-white"},{valor:"pendiente",nombre:"Pendiente",componente:je,claseActivo:"border-amber-500 bg-amber-50 text-amber-700",claseInactivo:"border-gray-300 hover:border-amber-400 bg-white"},{valor:"cancelada",nombre:"Cancelada",componente:Te,claseActivo:"border-red-500 bg-red-50 text-red-700",claseInactivo:"border-gray-300 hover:border-red-400 bg-white"},{valor:"completada",nombre:"Completada",componente:V,claseActivo:"border-blue-500 bg-blue-50 text-blue-700",claseInactivo:"border-gray-300 hover:border-blue-400 bg-white"}],Oe=G(()=>N(new Date)),Re=G(()=>{const n=new Date,t=[];t.push({label:"Hoy",fecha:N(n)});const a=new Date(n);a.setDate(a.getDate()+1),t.push({label:"Ma√±ana",fecha:N(a)});const f=["Lun","Mar","Mi√©","Jue","Vie"];let m=new Date(n),x=0;for(;x<5;){m.setDate(m.getDate()+1);const F=m.getDay();F>=1&&F<=5&&(t.push({label:`${f[F-1]} ${m.getDate()}`,fecha:N(m)}),x++)}return t}),ce=G(()=>{if(!h.value)return[];const n=h.value.toLowerCase().trim();return n.length<2?[]:X.value.filter(t=>t.nombre.toLowerCase().includes(n)||t.email.toLowerCase().includes(n))}),$=G(()=>{const n=s.value.paciente_id,t=k.value?s.value.terapeuta_id:!0;return n&&t&&s.value.fecha&&s.value.hora_inicio&&s.value.hora_fin&&s.value.tipo&&s.value.estado});async function xe(){console.log("üìã Cargando pacientes..."),J.value=!0;try{const{data:{user:n}}=await re.auth.getUser();if(!n){console.error("‚ùå No hay usuario autenticado");return}console.log("üë§ Usuario ID:",n.id);const{userProfile:t}=$e();console.log("üé≠ Rol de usuario:",t.value?.rol||"desconocido");let a=re.from("pacientes").select(`
        id,
        nombre_completo,
        email,
        metadata
      `).eq("activo",!0).order("created_at",{ascending:!1});t.value?.rol!=="coordinadora"?(console.log("üë®‚Äç‚öïÔ∏è Filtrando por terapeuta_id:",n.id),a=a.eq("terapeuta_id",n.id)):console.log("üåü Coordinadora - cargando TODOS los pacientes");const{data:f,error:m}=await a;if(m){console.error("‚ùå Error al cargar pacientes:",m);return}X.value=(f||[]).map(x=>({id:x.id,nombre:x.nombre_completo||"Sin nombre",email:x.email||"",frecuencia:x.metadata?.frecuencia||"No definida",area_acompanamiento:x.metadata?.area_de_acompanamiento||""})),console.log(`‚úÖ ${X.value.length} pacientes cargados (rol: ${t.value?.rol||"desconocido"})`),console.log("üìù Pacientes:",X.value)}catch(n){console.error("‚ùå Error al cargar pacientes:",n)}finally{J.value=!1}}function Je(){h.value.length>=2?C.value=!0:C.value=!1}async function he(n){v.value=n,s.value.paciente_id=n.id,s.value.paciente_nombre=n.nombre,h.value=n.nombre,C.value=!1;const t=await Ve(n.id);if(u.value=t,t.tiene_bono&&t.sesiones_restantes>0&&(s.value.descontar_de_bono=!0,s.value.bono_id=t.bono_id),n.frecuencia&&!p.fechaPreseleccionada){Y.value=!0;try{const a=await ze(n.id,n.frecuencia);a&&(T.value=a.fecha,j.value=a.hora,s.value.fecha=a.fecha,s.value.hora_inicio=a.hora,I(),console.log("üí° Horario sugerido:",a))}catch(a){console.error("Error al sugerir horario:",a)}finally{Y.value=!1}}console.log("‚úÖ Paciente seleccionado:",n.nombre)}async function Ze(){v.value=null,s.value.paciente_id="",s.value.paciente_nombre="",s.value.descontar_de_bono=!1,s.value.bono_id=void 0,u.value={tiene_bono:!1,sesiones_restantes:0,sesiones_totales:0,tipo_bono:"",bono_id:void 0},T.value=null,j.value=null,await Fe(),h.value="",C.value=!1}function ge(n,t,a=[]){ie.value=n,de.value=t,L.value="exito",Q.value=a,S.value=!0,setTimeout(()=>{S.value=!1},5e3)}function B(n,t){ie.value=n,de.value=t,L.value="error",Q.value=[],S.value=!0,setTimeout(()=>{S.value=!1},4e3)}function I(){if(!s.value.hora_inicio||!s.value.duracion)return;const n=s.value.hora_inicio.split(":").map(Number),t=n[0]||0,a=n[1]||0,f=parseInt(s.value.duracion),m=new Date;m.setHours(t,a,0,0);const x=new Date(m.getTime()+f*6e4),F=String(x.getHours()).padStart(2,"0"),P=String(x.getMinutes()).padStart(2,"0");s.value.hora_fin=`${F}:${P}`}async function _e(){if(!s.value.fecha||!s.value.hora_inicio||!s.value.hora_fin){A.value=!1;return}try{const t=(await Ne(s.value.fecha)).filter(m=>m.estado!=="cancelada"&&m.estado!=="borrador"&&m.estado!==null&&m.id!==p.citaId),a=s.value.hora_inicio,f=s.value.hora_fin;A.value=t.some(m=>{const x=m.hora_inicio,F=m.hora_fin,P=W(a),O=W(f),ee=W(x),te=W(F),Ce=P>=ee&&P<te||O>ee&&O<=te||P<=ee&&O>=te||P===ee&&O===te;return Ce&&console.log("‚ö†Ô∏è Conflicto detectado:",{nueva:`${a} - ${f}`,existente:`${x} - ${F}`,estado:m.estado,paciente:m.paciente_nombre||"Desconocido"}),Ce}),A.value&&console.warn("‚ö†Ô∏è Hay conflicto de horario")}catch(n){console.error("‚ùå Error al verificar conflicto:",n),A.value=!1}}function W(n){if(!n||!n.includes(":"))return 0;const[t,a]=n.split(":").map(Number);return(t||0)*60+(a||0)}async function we(){y.value=!0;try{if(!s.value.paciente_id){B("Paciente requerido","Por favor, selecciona un paciente antes de continuar."),y.value=!1;return}if(!s.value.fecha||!s.value.hora_inicio||!s.value.hora_fin){B("Datos incompletos","Por favor, completa la fecha y hora de la cita."),y.value=!1;return}if(k.value&&!s.value.terapeuta_id){B("Terapeuta requerido","Por favor, selecciona un terapeuta antes de continuar."),y.value=!1;return}if(await _e(),A.value){B("Conflicto de Horario","Ya existe una cita en este horario. Por favor, selecciona otro."),y.value=!1;return}const n={paciente_id:s.value.paciente_id,paciente_nombre:s.value.paciente_nombre||v.value?.nombre||"Sin nombre",fecha_cita:s.value.fecha,hora_inicio:s.value.hora_inicio,hora_fin:s.value.hora_fin,duracion:parseInt(s.value.duracion),modalidad:s.value.tipo,estado:s.value.estado==="completada"?"realizada":s.value.estado,observaciones:s.value.notas,bono_id:s.value.bono_id};k.value&&s.value.terapeuta_id&&(n.terapeuta_id=s.value.terapeuta_id);let t;if(Le.value&&p.citaId)if(console.log("üìù [ModalNuevaCita] Actualizando cita con ID:",p.citaId,n),t=await Ie(p.citaId,n),t.success){localStorage.removeItem("nueva_cita_temp");const a=Z(s.value.fecha),f=s.value.tipo==="presencial"?"üè•":s.value.tipo==="online"?"üíª":"üìû",m=s.value.paciente_nombre||v.value?.nombre||"Paciente";ge("‚úÖ Cita actualizada con √©xito",`${m} ‚Äì ${a}, ${s.value.hora_inicio} (${f} ${s.value.tipo})`,[]),H("actualizado"),H("citaCreada",t.data),console.log("‚úÖ [ModalNuevaCita] Cita actualizada exitosamente"),setTimeout(()=>{q()},1e3)}else B("Error al actualizar",t.error||"No se pudo actualizar la cita. Intenta de nuevo.");else{console.log("üöÄ [ModalNuevaCita] Creando nueva cita:",n);const a={paciente_id:s.value.paciente_id,paciente_nombre:s.value.paciente_nombre||v.value?.nombre||"Sin nombre",fecha:s.value.fecha,hora_inicio:s.value.hora_inicio,hora_fin:s.value.hora_fin,modalidad:s.value.tipo,estado:s.value.estado==="completada"?"realizada":s.value.estado,notas:s.value.notas,descontar_de_bono:s.value.descontar_de_bono,bono_id:s.value.bono_id};if(k.value&&s.value.terapeuta_id&&(a.terapeuta_id=s.value.terapeuta_id),t=await Be(a),t.success){localStorage.removeItem("nueva_cita_temp");const f=Z(s.value.fecha),m=s.value.tipo==="presencial"?"üè•":s.value.tipo==="online"?"üíª":"üìû";let P=`${s.value.paciente_nombre||v.value?.nombre||"Paciente"} ‚Äì ${f}, ${s.value.hora_inicio} (${m} ${s.value.tipo})`;if(t.data?.bono_id&&u.value.tiene_bono){const O=u.value.sesiones_restantes-1;P+=`
üé´ Bono activo: ${O} sesiones restantes despu√©s de esta`}ge("‚úÖ Cita creada con √©xito",P,[{texto:"üìÖ Ver en Agenda",accion:()=>{He.push("/agenda"),S.value=!1}},{texto:"‚ûï Nueva Cita",accion:()=>{S.value=!1,ye()}}]),H("citaCreada",t.data),H("actualizado"),console.log("‚úÖ [ModalNuevaCita] Cita creada exitosamente:",t.data),setTimeout(()=>{q()},1e3)}else B("Error al crear",t.error||"No se pudo crear la cita. Intenta de nuevo.")}}catch(n){console.error("‚ùå Error al guardar cita:",n),B("Error inesperado",n.message||"Ocurri√≥ un error al guardar la cita")}finally{y.value=!1}}function q(){(s.value.paciente_id||s.value.fecha!==N(new Date))&&localStorage.setItem("nueva_cita_temp",JSON.stringify({...s.value,timestamp:Date.now()})),H("cerrar"),H("update:modelValue",!1),ye()}function ye(){s.value={paciente_id:"",paciente_nombre:"",terapeuta_id:"",terapeuta_nombre:"",fecha:N(new Date),fecha_manual:"",hora_inicio:"",hora_fin:"",duracion:"60",tipo:"presencial",estado:"pendiente",notas:"",descontar_de_bono:!1,bono_id:void 0},h.value="",v.value=null,D.value=null,A.value=!1,T.value=null,j.value=null,U.value=[],u.value={tiene_bono:!1,sesiones_restantes:0,sesiones_totales:0,tipo_bono:"",bono_id:void 0}}function Ge(){const n=localStorage.getItem("nueva_cita_temp");if(n)try{const t=JSON.parse(n);Date.now()-t.timestamp<1440*60*1e3?console.log("üíæ Datos temporales disponibles"):localStorage.removeItem("nueva_cita_temp")}catch(t){console.error("Error al cargar datos temporales:",t)}}function N(n){return n.toISOString().split("T")[0]||""}function Z(n){const t=new Date(n+"T00:00:00"),a={weekday:"long",year:"numeric",month:"long",day:"numeric"};return t.toLocaleDateString("es-MX",a)}function Ke(){const n=[];return s.value.paciente_id||n.push("paciente"),s.value.fecha||n.push("fecha"),s.value.hora_inicio||n.push("hora_inicio"),s.value.tipo||n.push("tipo"),s.value.estado||n.push("estado"),U.value=n,n.length===0}async function Xe(){fe.value=!0;try{const{data:n,error:t}=await re.from("terapeutas").select("id, nombre_completo, email, especialidad").eq("activo",!0).order("nombre_completo",{ascending:!0});if(t){console.error("Error al cargar terapeutas:",t);return}le.value=n||[],console.log(`‚úÖ ${le.value.length} terapeutas cargados`)}catch(n){console.error("Error al cargar terapeutas:",n)}finally{fe.value=!1}}async function ke(){try{console.log("üîç Verificando rol de usuario...");const{userProfile:n}=$e();if(!n.value){console.warn("‚ö†Ô∏è No hay perfil cargado"),k.value=!1;return}console.log("üë§ Usuario:",n.value.email),console.log("üé≠ Rol del perfil:",n.value.rol),k.value=n.value.rol==="coordinadora",console.log(`‚úÖ ¬øEs coordinadora? ${k.value}`),k.value&&(console.log("üåü Usuario es coordinadora - cargando terapeutas"),await Xe())}catch(n){console.error("‚ùå Error al verificar rol:",n),k.value=!1}}function Ye(n){D.value=n,s.value.terapeuta_id=n.id,s.value.terapeuta_nombre=n.nombre_completo,console.log("‚úÖ Terapeuta seleccionado:",n.nombre_completo)}oe([()=>s.value.fecha,()=>s.value.hora_inicio,()=>s.value.hora_fin],()=>{s.value.fecha&&s.value.hora_inicio&&s.value.hora_fin&&_e()}),oe(()=>p.fechaPreseleccionada,n=>{n&&(s.value.fecha=n)}),oe(()=>p.horaPreseleccionada,n=>{n&&(s.value.hora_inicio=n,I())}),et(async()=>{await ke(),xe(),Ge(),p.horaPreseleccionada&&I(),document.addEventListener("click",De),document.addEventListener("keydown",Ae)}),tt(()=>{document.removeEventListener("click",De),document.removeEventListener("keydown",Ae)});function Ae(n){if(p.mostrar&&(n.key==="Escape"&&q(),n.key==="Enter"&&!n.shiftKey)){const a=n.target.tagName;if(a==="INPUT"||a==="TEXTAREA"||a==="SELECT"){n.preventDefault();return}$.value&&!y.value&&(n.preventDefault(),we())}}function De(){C.value&&(C.value=!1)}return oe(()=>p.mostrar,n=>{n&&(console.log("üéØ Modal abierto - verificando rol y cargando datos"),ke(),xe(),p.pacientePreseleccionado&&Fe(()=>{he({id:p.pacientePreseleccionado.id,nombre:p.pacientePreseleccionado.nombre,email:p.pacientePreseleccionado.email,frecuencia:p.pacientePreseleccionado.frecuencia||"No definida",area_acompanamiento:p.pacientePreseleccionado.area_acompanamiento||""})}))}),(n,t)=>g.modelValue||g.mostrar?(r(),l("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:se(q,["self"])},[e("div",vt,[e("div",xt,[e("div",null,[e("h2",ht,i(g.titulo||"Nueva Cita"),1),g.fechaPreseleccionada?(r(),l("p",gt,i(Z(g.fechaPreseleccionada))+" a las "+i(g.horaPreseleccionada),1)):d("",!0)]),e("button",{onClick:q,class:"text-neutral-600 hover:text-[#027368] transition-colors p-2 hover:bg-white/50 rounded-lg","aria-label":"Cerrar modal"},[...t[13]||(t[13]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("form",{onSubmit:se(we,["prevent"]),class:"px-6 py-6 space-y-6 bg-gradient-to-b from-white/50 to-transparent"},[p.pacientePreseleccionado&&o(v)?(r(),l("div",_t,[e("div",wt,[e("div",yt,[e("div",kt,[c(o(V),{class:"w-7 h-7 text-white"})]),e("div",null,[t[15]||(t[15]=e("div",{class:"text-xs font-semibold text-emerald-700 uppercase tracking-wide mb-1"},"Paciente Seleccionado",-1)),e("div",At,i(o(v).nombre),1),e("div",Dt,[e("span",null,i(o(v).email),1)]),o(v).frecuencia?(r(),l("div",Ct,[c(o(K),{class:"w-4 h-4 text-emerald-600"}),e("span",Ft,[t[14]||(t[14]=_("Frecuencia: ",-1)),e("strong",Pt,i(o(v).frecuencia),1)])])):d("",!0)])]),e("div",St,[o(u).tiene_bono?(r(),l("div",$t,[c(o(ue),{class:"w-4 h-4"}),t[16]||(t[16]=e("span",null,"BONO ACTIVO",-1))])):d("",!0),o(u).tiene_bono?(r(),l("div",Et,i(o(u).sesiones_restantes)+"/"+i(o(u).sesiones_totales),1)):d("",!0),o(u).tiene_bono?(r(),l("div",Mt,"sesiones")):d("",!0)])])])):d("",!0),p.pacientePreseleccionado?d("",!0):(r(),l("div",jt,[e("div",Tt,[e("h3",Bt,[o(v)?(r(),l("span",Nt,[c(o(V),{class:"w-5 h-5"})])):(r(),l("span",It," 1 ")),t[17]||(t[17]=_(" Seleccionar Paciente ",-1))])]),o(v)?d("",!0):(r(),l("div",Vt,[e("p",zt,[c(o(me),{class:"w-5 h-5 flex-shrink-0"}),t[18]||(t[18]=e("span",null,"Busca y selecciona un paciente ya registrado en el sistema",-1))]),t[19]||(t[19]=e("p",{class:"text-xs text-blue-700 mt-1.5 ml-7"},[_(" Para crear un paciente nuevo, ve a la secci√≥n "),e("strong",null,"Pacientes"),_(" en el men√∫ principal ")],-1))])),o(v)?d("",!0):(r(),l("div",Ht,[e("div",{class:"relative",onClick:t[2]||(t[2]=se(()=>{},["stop"]))},[R(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>ot(h)?h.value=a:null),type:"text",placeholder:"Buscar paciente por nombre o email...",class:"w-full px-4 py-2.5 pl-10 border border-neutral-300 rounded-xl focus:ring-2 focus:ring-[#027368]/20 focus:border-[#027368] bg-white/90 backdrop-blur-sm transition-all shadow-sm",onFocus:t[1]||(t[1]=a=>C.value=!0),onInput:Je,autocomplete:"off"},null,544),[[ae,o(h)]]),e("span",Lt,[c(o(me),{class:"w-5 h-5 text-neutral-400"})]),o(J)?(r(),l("span",Ut,[...t[20]||(t[20]=[e("svg",{class:"animate-spin h-5 w-5 text-[#027368]",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):d("",!0),!o(h)&&!o(J)?(r(),l("div",qt,[c(o(ne),{class:"w-4 h-4 flex-shrink-0"}),t[21]||(t[21]=e("span",null,"Escribe al menos 2 caracteres para buscar",-1))])):d("",!0)]),o(C)&&o(h)&&o(ce).length>0?(r(),l("div",Ot,[(r(!0),l(E,null,M(o(ce),a=>(r(),l("button",{key:a.id,type:"button",onClick:f=>he(a),class:"p-4 text-left hover:bg-[#027368]/5 transition-all border-2 border-neutral-200 hover:border-[#027368] rounded-xl cursor-pointer group bg-white/90 backdrop-blur-sm shadow-sm hover:shadow-md"},[e("div",Jt,[e("div",Zt,[c(o(Ee),{class:"w-6 h-6 text-[#027368] group-hover:text-white transition-colors"})]),e("div",Gt,[e("div",Kt,i(a.nombre),1),e("div",Xt,i(a.email),1),a.frecuencia?(r(),l("div",Yt,[c(o(K),{class:"w-3 h-3"}),e("span",Qt,i(a.frecuencia),1)])):d("",!0)]),t[22]||(t[22]=e("div",{class:"opacity-0 group-hover:opacity-100 transition-opacity"},[e("svg",{class:"w-5 h-5 text-[#027368]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})])],-1))])],8,Rt))),128))])):d("",!0),o(C)&&o(h)&&o(ce).length===0&&!o(J)?(r(),l("div",Wt,[c(o(me),{class:"w-12 h-12 mx-auto mb-2 text-neutral-400"}),e("p",null,[t[23]||(t[23]=_('No se encontraron pacientes con "',-1)),e("strong",null,i(o(h)),1),t[24]||(t[24]=_('"',-1))])])):d("",!0)])),o(s).paciente_id&&o(v)&&!p.pacientePreseleccionado?(r(),l("div",eo,[e("div",to,[e("div",oo,[e("div",so,[e("div",ao,[c(o(V),{class:"w-7 h-7 text-white"})]),e("div",no,[t[26]||(t[26]=e("div",{class:"text-xs font-semibold text-emerald-700 uppercase tracking-wide mb-1"},"Paciente Seleccionado",-1)),e("div",ro,i(o(v).nombre),1),e("div",lo,[e("span",null,i(o(v).email),1)]),o(v).frecuencia?(r(),l("div",io,[c(o(K),{class:"w-4 h-4 text-emerald-600"}),t[25]||(t[25]=e("span",{class:"font-medium text-emerald-800"},"Frecuencia:",-1)),e("span",co,i(o(v).frecuencia),1)])):d("",!0)])]),e("button",{type:"button",onClick:Ze,class:"px-4 py-2 bg-white border-2 border-emerald-300 text-emerald-700 hover:bg-emerald-50 hover:border-emerald-400 rounded-lg text-sm font-medium transition-all flex items-center gap-2 shadow-sm hover:shadow flex-shrink-0"},[...t[27]||(t[27]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),e("span",null,"Cambiar",-1)])])])]),o(u).tiene_bono?(r(),l("div",uo,[e("div",mo,[e("div",po,[e("div",bo,[c(o(ue),{class:"w-6 h-6 text-white"})]),t[28]||(t[28]=e("div",null,[e("div",{class:"text-sm font-bold text-blue-900 uppercase tracking-wide"},"Bono Activo"),e("div",{class:"text-xs text-blue-600"},"El paciente tiene sesiones disponibles")],-1))]),e("div",fo,[t[29]||(t[29]=e("div",{class:"text-xs text-blue-600 mb-1"},"Sesiones Disponibles",-1)),e("div",{class:w(["text-3xl font-bold",o(u).sesiones_restantes<=1?"text-red-600":o(u).sesiones_restantes<=2?"text-amber-600":"text-blue-700"])},i(o(u).sesiones_restantes),3)])]),e("div",vo,[e("div",xo,[t[30]||(t[30]=e("div",{class:"text-xs text-blue-600 mb-1 font-medium"},"Tipo de Bono",-1)),e("div",ho,i(o(u).tipo_bono||"N/A"),1)]),e("div",go,[t[31]||(t[31]=e("div",{class:"text-xs text-blue-600 mb-1 font-medium"},"Total Sesiones",-1)),e("div",_o,i(o(u).sesiones_totales||"?"),1)]),e("div",wo,[t[32]||(t[32]=e("div",{class:"text-xs text-blue-600 mb-1 font-medium"},"Utilizadas",-1)),e("div",yo,i((o(u).sesiones_totales||0)-(o(u).sesiones_restantes||0)),1)])]),e("div",ko,[e("div",Ao,[t[33]||(t[33]=e("span",null,"Progreso del bono",-1)),e("span",Do,i(Math.round((o(u).sesiones_totales-o(u).sesiones_restantes)/o(u).sesiones_totales*100))+"%",1)]),e("div",Co,[e("div",{class:w(["h-full rounded-full transition-all duration-500",[o(u).sesiones_restantes<=1?"bg-red-500":o(u).sesiones_restantes<=2?"bg-amber-500":"bg-blue-500"]]),style:st({width:`${(o(u).sesiones_totales-o(u).sesiones_restantes)/o(u).sesiones_totales*100}%`})},null,6)])]),o(u).sesiones_restantes<=2?(r(),l("div",Fo,[c(o(Me),{class:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),e("div",Po,[e("div",So,i(o(u).sesiones_restantes===1?"¬°√öltima sesi√≥n del bono!":"¬°Pocas sesiones restantes!"),1),e("div",$o,i(o(u).sesiones_restantes===1?"Esta es la √∫ltima sesi√≥n disponible. Considere informar al paciente para renovar su bono.":`Solo quedan ${o(u).sesiones_restantes} sesiones. Considere informar al paciente para renovar su bono pronto.`),1)])])):d("",!0),e("div",Eo,[R(e("input",{id:"descontar-bono","onUpdate:modelValue":t[3]||(t[3]=a=>o(s).descontar_de_bono=a),type:"checkbox",class:"mt-1 w-5 h-5 text-blue-600 border-blue-300 rounded focus:ring-blue-500 focus:ring-2"},null,512),[[at,o(s).descontar_de_bono]]),e("label",Mo,[t[36]||(t[36]=e("div",{class:"text-sm text-blue-900 font-semibold mb-1"}," Descontar sesi√≥n de este bono ",-1)),e("div",jo,[t[34]||(t[34]=_(" Al completar esta cita, se descontar√° autom√°ticamente 1 sesi√≥n del bono activo. Quedar√°n ",-1)),e("strong",null,i(o(u).sesiones_restantes-1),1),t[35]||(t[35]=_(" sesiones disponibles. ",-1))])])])])):(r(),l("div",To,[e("div",Bo,[c(o(ne),{class:"w-6 h-6 text-amber-600 flex-shrink-0 mt-0.5"}),t[37]||(t[37]=e("div",null,[e("div",{class:"font-semibold text-amber-900 mb-1"},"Sin bono activo"),e("div",{class:"text-sm text-amber-800"}," Este paciente no tiene bonos activos actualmente. Esta sesi√≥n se cobrar√° de forma individual. ")],-1))])]))])):d("",!0)])),o(k)?(r(),l("div",Io,[e("div",No,[e("h3",Vo,[o(D)?(r(),l("span",Ho,[c(o(V),{class:"w-5 h-5"})])):(r(),l("span",zo,i((p.pacientePreseleccionado,"2")),1)),t[38]||(t[38]=_(" Asignar Terapeuta ",-1))])]),o(D)?d("",!0):(r(),l("div",Lo,[e("p",Uo,[c(o(ut),{class:"w-5 h-5 flex-shrink-0"}),t[39]||(t[39]=e("span",null,"Selecciona el terapeuta que atender√° esta cita",-1))])])),o(D)?d("",!0):(r(),l("div",qo,[(r(!0),l(E,null,M(o(le),a=>(r(),l("button",{key:a.id,type:"button",onClick:f=>Ye(a),class:"p-4 text-left hover:bg-[#D8AFA0]/10 transition-all border-2 border-[#D8AFA0]/30 hover:border-[#D8AFA0] rounded-lg cursor-pointer group bg-white"},[e("div",Ro,[e("div",Jo,[c(o(Ee),{class:"w-6 h-6 text-[#5D4A44] group-hover:text-white transition-colors"})]),e("div",Zo,[e("div",Go,i(a.nombre_completo),1),a.especialidad?(r(),l("div",Ko,i(a.especialidad),1)):d("",!0),e("div",Xo,i(a.email),1)]),t[40]||(t[40]=e("div",{class:"opacity-0 group-hover:opacity-100 transition-opacity"},[e("svg",{class:"w-5 h-5 text-[#D8AFA0]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})])],-1))])],8,Oo))),128))])),o(D)?(r(),l("div",Yo,[e("div",Qo,[e("div",Wo,[e("div",es,[c(o(V),{class:"w-7 h-7 text-white"})]),e("div",ts,[t[41]||(t[41]=e("div",{class:"text-xs font-semibold text-emerald-700 uppercase tracking-wide mb-1"},"Terapeuta Asignado",-1)),e("div",os,i(o(D).nombre_completo),1),o(D).especialidad?(r(),l("div",ss,i(o(D).especialidad),1)):d("",!0)])]),e("button",{type:"button",onClick:t[4]||(t[4]=a=>{D.value=null,o(s).terapeuta_id="",o(s).terapeuta_nombre=""}),class:"px-4 py-2 bg-white border-2 border-emerald-300 text-emerald-700 hover:bg-emerald-50 hover:border-emerald-400 rounded-lg text-sm font-medium transition-all flex items-center gap-2 shadow-sm hover:shadow flex-shrink-0"},[...t[42]||(t[42]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),e("span",null,"Cambiar",-1)])])])])):d("",!0)])):d("",!0),e("div",as,[e("h3",ns,[o($)?(r(),l("span",ls," ‚úì ")):(r(),l("span",rs,i(o(k)?"3":p.pacientePreseleccionado?"1":"2"),1)),t[43]||(t[43]=_(" Detalles de la Cita ",-1))]),e("div",is,[e("h4",ds,[c(o(K),{class:"w-5 h-5 text-blue-600"}),t[44]||(t[44]=e("span",null,"Detalles de Programaci√≥n",-1))]),e("div",cs,[e("div",null,[e("label",us,[c(o(K),{class:"w-4 h-4"}),t[45]||(t[45]=e("span",null,"Fecha",-1)),t[46]||(t[46]=e("span",{class:"text-red-500"},"*",-1))]),e("div",ms,[R(e("input",{"onUpdate:modelValue":t[5]||(t[5]=a=>o(s).fecha=a),type:"date",required:"",min:o(Oe),onKeydown:t[6]||(t[6]=nt(se(()=>{},["prevent"]),["enter"])),class:w(["w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-[#D8AFA0] focus:border-transparent bg-white text-base cursor-pointer",o(U).includes("fecha")?"border-red-500 border-2":"border-[#D8AFA0]/30"]),style:{"min-height":"44px"},placeholder:"dd/mm/aaaa"},null,42,ps),[[ae,o(s).fecha]]),e("div",bs,[(r(!0),l(E,null,M(o(Re),(a,f)=>(r(),l("button",{key:f,type:"button",onClick:m=>o(s).fecha=a.fecha,class:w(["text-xs px-3 py-1.5 rounded-lg border transition-all",o(s).fecha===a.fecha?"bg-[#D8AFA0] text-white border-[#D8AFA0] font-semibold":"bg-white text-[#5D4A44] border-[#D8AFA0]/30 hover:border-[#D8AFA0] hover:bg-[#D8AFA0]/10"])},i(a.label),11,fs))),128))]),o(T)&&o(T)!==o(s).fecha?(r(),l("div",vs,[e("button",{type:"button",onClick:t[7]||(t[7]=a=>o(s).fecha=o(T)),class:"text-xs px-2 py-1 bg-green-50 text-green-700 border border-green-200 rounded hover:bg-green-100 transition-colors"}," üí° Usar fecha sugerida: "+i(Z(o(T))),1)])):d("",!0)])]),e("div",null,[e("label",xs,[c(o(je),{class:"w-4 h-4"}),t[47]||(t[47]=e("span",null,"Hora de Inicio",-1)),t[48]||(t[48]=e("span",{class:"text-red-500"},"*",-1))]),e("div",hs,[e("div",gs,[(r(),l(E,null,M(ve,a=>e("button",{key:a,type:"button",onClick:f=>{o(s).hora_inicio=a,I()},class:w(["px-4 py-3 text-sm font-semibold rounded-lg transition-all border-2 flex items-center justify-center min-w-[70px]",o(s).hora_inicio===a?"bg-[#D8AFA0] text-white border-[#D8AFA0] shadow-lg transform scale-105 ring-2 ring-[#D8AFA0]/30":"bg-white text-[#5D4A44] border-gray-300 hover:border-[#D8AFA0] hover:bg-[#D8AFA0]/10 hover:shadow-md hover:scale-102"])},i(a),11,_s)),64))]),e("details",ws,[e("summary",ys,[c(o(pe),{class:"w-4 h-4"}),t[49]||(t[49]=e("span",null,"Ingresar hora manualmente",-1))]),e("div",ks,[R(e("input",{"onUpdate:modelValue":t[8]||(t[8]=a=>o(s).hora_inicio=a),type:"time",step:"1800",onChange:I,class:w(["w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-[#D8AFA0] focus:border-transparent bg-white",o(U).includes("hora_inicio")?"border-red-500 border-2":"border-[#D8AFA0]/30"])},null,34),[[ae,o(s).hora_inicio]])])]),e("datalist",As,[(r(),l(E,null,M(ve,a=>e("option",{key:a,value:a},i(a),9,Ds)),64))]),o(j)&&o(j)!==o(s).hora_inicio&&o(Y)===!1?(r(),l("div",Cs,[e("button",{type:"button",onClick:t[9]||(t[9]=a=>{o(s).hora_inicio=o(j),I()}),class:"flex items-center gap-1.5 text-xs px-3 py-1.5 bg-emerald-50 text-emerald-700 border border-emerald-200 rounded-lg hover:bg-emerald-100 transition-colors font-medium"},[c(o(ne),{class:"w-4 h-4"}),e("span",null,"Usar hora sugerida: "+i(o(j)),1)])])):d("",!0),o(Y)?(r(),l("div",Fs,[...t[50]||(t[50]=[e("svg",{class:"animate-spin h-3 w-3",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),_(" Buscando horario disponible... ",-1)])])):d("",!0)])]),e("div",null,[t[52]||(t[52]=e("label",{class:"block text-sm font-medium text-[#5D4A44] mb-1"},[_(" Duraci√≥n "),e("span",{class:"text-red-500"},"*")],-1)),R(e("select",{"onUpdate:modelValue":t[10]||(t[10]=a=>o(s).duracion=a),required:"",onChange:I,class:"w-full px-4 py-2 border border-[#D8AFA0]/30 rounded-lg focus:ring-2 focus:ring-[#D8AFA0] focus:border-transparent bg-white"},[...t[51]||(t[51]=[e("option",{value:"30"},"30 minutos",-1),e("option",{value:"60",selected:""},"60 minutos (1 hora)",-1),e("option",{value:"90"},"90 minutos (1.5 horas)",-1),e("option",{value:"120"},"120 minutos (2 horas)",-1)])],544),[[rt,o(s).duracion]])]),e("div",null,[t[53]||(t[53]=e("label",{class:"block text-sm font-medium text-[#5D4A44] mb-1"}," Hora de Fin ",-1)),e("input",{value:o(s).hora_fin,type:"text",readonly:"",class:"w-full px-4 py-2 border border-[#D8AFA0]/30 rounded-lg bg-gray-100 text-[#5D4A44]/60",placeholder:"Se calcular√° autom√°ticamente"},null,8,Ps)])])]),e("div",Ss,[e("h4",$s,[c(o(be),{class:"w-5 h-5 text-purple-600"}),t[54]||(t[54]=e("span",null,"Tipo de Sesi√≥n y Estado",-1))]),e("div",null,[e("label",Es,[c(o(be),{class:"w-5 h-5"}),t[55]||(t[55]=e("span",null,"Tipo de Sesi√≥n",-1)),t[56]||(t[56]=e("span",{class:"text-red-500"},"*",-1))]),e("div",{class:w(["grid grid-cols-3 gap-3",o(U).includes("tipo")?"p-3 border-2 border-red-500 bg-red-50 rounded-lg":""])},[(r(),l(E,null,M(Ue,a=>e("button",{key:a.valor,type:"button",onClick:f=>o(s).tipo=a.valor,class:w(["p-4 border-2 rounded-lg transition-all flex flex-col items-center gap-2 group",o(s).tipo===a.valor?"border-[#D8AFA0] bg-[#D8AFA0]/20 shadow-md":"border-[#D8AFA0]/30 hover:border-[#D8AFA0] hover:bg-[#D8AFA0]/5 bg-white"])},[(r(),Pe(Se(a.componente),{class:w(["w-8 h-8 transition-colors",o(s).tipo===a.valor?"text-[#D8AFA0]":"text-[#5D4A44]/60 group-hover:text-[#D8AFA0]"])},null,8,["class"])),e("div",js,i(a.nombre),1),e("div",Ts,i(a.descripcion),1)],10,Ms)),64))],2)]),e("div",null,[e("label",Bs,[c(o(V),{class:"w-5 h-5"}),t[57]||(t[57]=e("span",null,"Estado",-1)),t[58]||(t[58]=e("span",{class:"text-red-500"},"*",-1))]),e("div",Is,[(r(),l(E,null,M(qe,a=>e("button",{key:a.valor,type:"button",onClick:f=>o(s).estado=a.valor,class:w(["p-3 border-2 rounded-lg transition-all flex flex-col items-center gap-2",o(s).estado===a.valor?a.claseActivo+" shadow-md":a.claseInactivo])},[(r(),Pe(Se(a.componente),{class:"w-7 h-7"})),e("div",Vs,i(a.nombre),1)],10,Ns)),64))])])]),e("div",zs,[e("h4",Hs,[c(o(pe),{class:"w-5 h-5 text-amber-600"}),t[59]||(t[59]=e("span",null,"Notas Adicionales",-1))]),e("div",null,[e("label",Ls,[c(o(pe),{class:"w-4 h-4"}),t[60]||(t[60]=e("span",null,"Notas (opcional)",-1))]),R(e("textarea",{"onUpdate:modelValue":t[11]||(t[11]=a=>o(s).notas=a),rows:"3",class:"w-full px-4 py-2 border border-[#D8AFA0]/30 rounded-lg focus:ring-2 focus:ring-[#D8AFA0] focus:border-transparent bg-white resize-none",placeholder:"Notas sobre la cita, recordatorios, etc."},null,512),[[ae,o(s).notas]])])])]),o(A)?(r(),l("div",Us,[e("div",qs,[c(o(Me),{class:"w-6 h-6 text-yellow-600 flex-shrink-0 mt-0.5"}),t[61]||(t[61]=e("div",null,[e("div",{class:"font-semibold text-yellow-900 mb-1 flex items-center gap-2"},[e("span",null,"Conflicto de Horario")]),e("div",{class:"text-sm text-yellow-800"}," Ya existe una cita en este horario. Verifica la disponibilidad. ")],-1))])])):d("",!0),o(U).length>0&&!o($)?(r(),l("div",Os,[e("div",Rs,[c(o(Te),{class:"w-6 h-6 text-red-600 flex-shrink-0 mt-0.5"}),e("div",null,[t[67]||(t[67]=e("div",{class:"font-semibold text-red-900 mb-2"}," Completa los campos obligatorios ",-1)),e("ul",Js,[o(s).paciente_id?d("",!0):(r(),l("li",Zs,[...t[62]||(t[62]=[e("span",{class:"w-1.5 h-1.5 rounded-full bg-red-500"},null,-1),e("span",null,"Selecciona un paciente",-1)])])),o(s).fecha?d("",!0):(r(),l("li",Gs,[...t[63]||(t[63]=[e("span",{class:"w-1.5 h-1.5 rounded-full bg-red-500"},null,-1),e("span",null,"Selecciona una fecha",-1)])])),o(s).hora_inicio?d("",!0):(r(),l("li",Ks,[...t[64]||(t[64]=[e("span",{class:"w-1.5 h-1.5 rounded-full bg-red-500"},null,-1),e("span",null,"Selecciona la hora de inicio",-1)])])),o(s).tipo?d("",!0):(r(),l("li",Xs,[...t[65]||(t[65]=[e("span",{class:"w-1.5 h-1.5 rounded-full bg-red-500"},null,-1),e("span",null,"Selecciona el tipo de sesi√≥n",-1)])])),o(s).estado?d("",!0):(r(),l("li",Ys,[...t[66]||(t[66]=[e("span",{class:"w-1.5 h-1.5 rounded-full bg-red-500"},null,-1),e("span",null,"Selecciona el estado de la cita",-1)])]))])])])])):d("",!0),o($)&&!o(A)?(r(),l("div",Qs,[e("div",Ws,[c(o(ne),{class:"w-6 h-6 text-blue-600 flex-shrink-0 mt-0.5"}),e("div",ea,[t[75]||(t[75]=e("div",{class:"font-semibold text-blue-900 mb-3"}," Resumen de la Cita ",-1)),e("div",ta,[e("div",null,[t[68]||(t[68]=e("span",{class:"text-blue-600 font-medium"},"Paciente:",-1)),e("div",oa,i(o(s).paciente_nombre),1)]),e("div",null,[t[69]||(t[69]=e("span",{class:"text-blue-600 font-medium"},"Fecha:",-1)),e("div",sa,i(Z(o(s).fecha)),1)]),e("div",null,[t[70]||(t[70]=e("span",{class:"text-blue-600 font-medium"},"Horario:",-1)),e("div",aa,i(o(s).hora_inicio)+" - "+i(o(s).hora_fin),1)]),e("div",null,[t[71]||(t[71]=e("span",{class:"text-blue-600 font-medium"},"Duraci√≥n:",-1)),e("div",na,i(o(s).duracion)+" minutos",1)]),e("div",null,[t[72]||(t[72]=e("span",{class:"text-blue-600 font-medium"},"Tipo:",-1)),e("div",ra,i(o(s).tipo),1)]),e("div",null,[t[73]||(t[73]=e("span",{class:"text-blue-600 font-medium"},"Estado:",-1)),e("div",la,i(o(s).estado),1)]),o(s).descontar_de_bono?(r(),l("div",ia,[c(o(ue),{class:"w-5 h-5 text-blue-600"}),t[74]||(t[74]=e("div",null,[e("span",{class:"text-blue-600 font-medium"},"Bono:"),e("span",{class:"text-blue-900 ml-2"},"Se descontar√° 1 sesi√≥n del bono activo")],-1))])):d("",!0)])])])])):d("",!0),e("div",da,[e("button",{type:"button",onClick:q,class:"flex-1 px-6 py-3 border-2 border-[#D8AFA0] text-[#5D4A44] rounded-lg hover:bg-[#D8AFA0]/10 transition-colors font-medium","aria-label":"Cancelar creaci√≥n de cita"}," Cancelar "),e("div",ca,[e("button",{type:"submit",disabled:!o($)||o(y)||o(A),class:w(["w-full px-6 py-3 rounded-lg transition-all font-medium text-white",o($)&&!o(y)&&!o(A)?"bg-[#D8AFA0] hover:bg-[#D8AFA0]/90 hover:shadow-lg cursor-pointer":"bg-gray-400 cursor-not-allowed opacity-60"]),"aria-label":o($)?"Guardar cita":"Completa todos los campos requeridos para guardar",onMouseenter:Ke},i(o(y)?"Guardando...":"‚úì Guardar Cita"),43,ua),!o($)&&!o(y)?(r(),l("div",ma," Completa todos los campos obligatorios (*) ")):d("",!0)])])],32)]),c(lt,{name:"slide-up"},{default:it(()=>[o(S)?(r(),l("div",{key:0,class:w(["fixed bottom-6 right-6 max-w-md rounded-lg shadow-2xl p-4 z-[60]",o(L)==="exito"?"bg-gradient-to-r from-green-500 to-emerald-500":o(L)==="error"?"bg-gradient-to-r from-red-500 to-rose-500":"bg-gradient-to-r from-blue-500 to-indigo-500"])},[e("div",pa,[e("div",ba,i(o(L)==="exito"?"‚úÖ":o(L)==="error"?"‚ùå":"‚ÑπÔ∏è"),1),e("div",fa,[e("div",va,i(o(ie)),1),e("div",xa,i(o(de)),1),o(Q).length>0?(r(),l("div",ha,[(r(!0),l(E,null,M(o(Q),(a,f)=>(r(),l("button",{key:f,onClick:a.accion,class:"px-3 py-1.5 bg-white/20 hover:bg-white/30 rounded text-sm font-medium transition-all"},i(a.texto),9,ga))),128))])):d("",!0)]),e("button",{onClick:t[12]||(t[12]=a=>S.value=!1),class:"text-white/80 hover:text-white transition-colors"}," ‚úï ")])],2)):d("",!0)]),_:1})])):d("",!0)}}),Ba=Object.assign(mt(_a,[["__scopeId","data-v-75e79c96"]]),{__name:"ModalNuevaCita"});export{Ba as _};
