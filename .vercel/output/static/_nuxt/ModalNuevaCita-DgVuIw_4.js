import{c as l,o as r,a as e,e as Ze,p as et,L as tt,x as K,r as b,I as G,g as ot,D as st,h as d,b as c,t as i,j as oe,l as o,d as g,k as O,v as se,m as at,F as T,y as j,A as _,z as nt,Y as rt,E as lt,K as it,w as dt,M as ct,f as Se,O as $e,J as Ee,N as Me}from"#entry";import{u as ut}from"./useCitas-9Z4e1_ch.js";import{r as z}from"./CheckCircleIcon-Bi0YyG7H.js";import{r as Y}from"./CalendarIcon-mZ3toP8Y.js";import{r as ue}from"./TicketIcon-DRclOuRO.js";import{r as me}from"./MagnifyingGlassIcon-B5My0XuL.js";import{r as ae,a as Te}from"./XCircleIcon-DIGsvT-h.js";import{r as je}from"./UserIcon-G1mM6o1b.js";import{r as Ie}from"./ExclamationTriangleIcon-BreoAuwB.js";import{r as mt}from"./UserGroupIcon-Byc3y-S3.js";import{r as Ne}from"./ClockIcon-CQZt9cKZ.js";import{r as pe}from"./DocumentTextIcon-Dp_75vtG.js";import{r as pt}from"./PhoneIcon-B4J2dtua.js";import{r as bt}from"./CheckBadgeIcon-CuVUaEjS.js";import{_ as ft}from"./_plugin-vue_export-helper-DlAUqK2U.js";function vt(F,ne){return r(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3.75 21h16.5M4.5 3h15M5.25 3v18m13.5-18v18M9 6.75h1.5m-1.5 3h1.5m-1.5 3h1.5m3-6H15m-1.5 3H15m-1.5 3H15M9 21v-3.375c0-.621.504-1.125 1.125-1.125h3.75c.621 0 1.125.504 1.125 1.125V21"})])}function be(F,ne){return r(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 17.25v1.007a3 3 0 0 1-.879 2.122L7.5 21h9l-.621-.621A3 3 0 0 1 15 18.257V17.25m6-12V15a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 15V5.25m18 0A2.25 2.25 0 0 0 18.75 3H5.25A2.25 2.25 0 0 0 3 5.25m18 0V12a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 12V5.25"})])}const xt={class:"bg-white/95 backdrop-blur-lg rounded-2xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto border border-white/30"},ht={class:"sticky top-0 bg-gradient-to-r from-[#5550F2]/5 via-[#027368]/5 to-[#04BF9D]/5 backdrop-blur-md border-b border-neutral-200 px-6 py-4 flex justify-between items-center shadow-sm"},gt={class:"text-2xl font-['Elms_Sans'] text-neutral-800 font-semibold"},_t={key:0,class:"text-sm text-neutral-600 mt-1"},wt={key:0,class:"p-4 bg-gradient-to-r from-emerald-50 to-teal-50 border border-emerald-200 rounded-xl shadow-sm"},yt={class:"flex items-center justify-between"},kt={class:"flex items-center gap-3"},Ct={class:"w-12 h-12 rounded-full bg-emerald-500 flex items-center justify-center flex-shrink-0"},Ft={class:"font-bold text-emerald-900 text-lg"},Dt={class:"text-sm text-emerald-700 flex items-center gap-1 mt-0.5"},Pt={key:0,class:"mt-2 flex items-center gap-2 text-xs"},St={class:"text-emerald-700"},$t={class:"capitalize"},Et={class:"text-right"},Mt={key:0,class:"flex items-center gap-1 text-xs text-emerald-700 font-semibold mb-1"},Tt={key:1,class:"text-2xl font-bold text-emerald-900"},jt={key:2,class:"text-xs text-emerald-600"},It={key:1,class:"space-y-4"},Nt={class:"flex items-center justify-between"},Bt={class:"text-lg font-['Elms_Sans'] text-neutral-800 font-semibold flex items-center gap-2"},Vt={key:0,class:"w-7 h-7 rounded-full bg-gradient-to-r from-[#5550F2] to-[#027368] text-white flex items-center justify-center text-sm font-bold shadow-sm"},zt={key:1,class:"w-7 h-7 rounded-full bg-gradient-to-r from-[#04BF9D] to-[#027368] text-white flex items-center justify-center shadow-sm"},At={key:0,class:"p-3 bg-blue-50 border-l-4 border-blue-400 rounded"},Ht={class:"flex items-center gap-2 text-sm text-blue-800"},Lt={key:1,class:"space-y-3"},Ut={class:"absolute left-3 top-1/2 -translate-y-1/2"},qt={key:0,class:"absolute right-3 top-1/2 -translate-y-1/2"},Ot={key:1,class:"mt-1 flex items-center gap-2 text-xs text-neutral-500"},Rt={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Jt=["onClick"],Kt={class:"flex items-center gap-3"},Gt={class:"w-12 h-12 rounded-xl bg-gradient-to-br from-[#027368]/20 to-[#04BF9D]/20 group-hover:from-[#027368] group-hover:to-[#04BF9D] flex items-center justify-center transition-all"},Yt={class:"flex-1"},Xt={class:"font-medium text-neutral-800 group-hover:text-[#027368] transition-colors"},Qt={class:"text-sm text-neutral-600"},Wt={key:0,class:"text-xs text-neutral-500 mt-1 flex items-center gap-1"},Zt={class:"font-medium capitalize"},eo={key:1,class:"border border-neutral-200 rounded-xl bg-white/90 backdrop-blur-sm p-6 text-center text-sm text-neutral-600 shadow-sm"},to={key:2,class:"space-y-3"},oo={class:"p-4 bg-gradient-to-r from-emerald-50 to-teal-50 border border-emerald-200 rounded-xl shadow-sm"},so={class:"flex items-start justify-between gap-3"},ao={class:"flex items-center gap-3 flex-1"},no={class:"w-12 h-12 rounded-full bg-emerald-500 flex items-center justify-center flex-shrink-0"},ro={class:"flex-1"},lo={class:"font-bold text-emerald-900 text-lg"},io={class:"text-sm text-emerald-700 flex items-center gap-1 mt-0.5"},co={key:0,class:"mt-2 flex items-center gap-2 text-sm"},uo={class:"px-2 py-0.5 bg-emerald-100 text-emerald-800 rounded-lg font-medium capitalize"},mo={key:0,class:"p-5 bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 border-2 border-blue-300 rounded-xl shadow-md"},po={class:"flex items-center justify-between mb-4"},bo={class:"flex items-center gap-3"},fo={class:"w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center"},vo={class:"text-right"},xo={class:"grid grid-cols-3 gap-3 mb-4"},ho={class:"bg-white p-3 rounded-lg border border-blue-200"},go={class:"font-bold text-blue-900 capitalize text-sm"},_o={class:"bg-white p-3 rounded-lg border border-blue-200"},wo={class:"font-bold text-blue-900 text-sm"},yo={class:"bg-white p-3 rounded-lg border border-blue-200"},ko={class:"font-bold text-blue-900 text-sm"},Co={class:"mb-4"},Fo={class:"flex justify-between text-xs text-blue-700 mb-1"},Do={class:"font-semibold"},Po={class:"w-full bg-blue-200 rounded-full h-3 overflow-hidden"},So={key:0,class:"mb-4 flex items-start gap-3 p-3 bg-amber-50 border-l-4 border-amber-500 rounded-lg"},$o={class:"text-sm"},Eo={class:"font-semibold text-amber-900 mb-1"},Mo={class:"text-amber-800"},To={class:"flex items-start gap-3 p-3 bg-white border-2 border-blue-300 rounded-lg"},jo={for:"descontar-bono",class:"flex-1 cursor-pointer"},Io={class:"text-xs text-blue-700"},No={key:1,class:"p-4 bg-gradient-to-r from-amber-50 to-orange-50 border-l-4 border-amber-400 rounded-lg shadow-sm"},Bo={class:"flex items-start gap-3"},Vo={key:2,class:"space-y-4 pt-4 border-t-2 border-[#5550F2]/30"},zo={class:"flex items-center justify-between"},Ao={class:"text-lg font-serif text-[#2D3748] font-semibold flex items-center gap-2"},Ho={key:0,class:"w-7 h-7 rounded-full bg-[#5550F2] text-white flex items-center justify-center text-sm font-bold"},Lo={key:1,class:"w-7 h-7 rounded-full bg-emerald-500 text-white flex items-center justify-center"},Uo={key:0,class:"p-3 bg-purple-50 border-l-4 border-purple-400 rounded"},qo={class:"flex items-center gap-2 text-sm text-purple-800"},Oo={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Ro=["onClick"],Jo={class:"flex items-center gap-3"},Ko={class:"w-12 h-12 rounded-full bg-[#5550F2]/20 group-hover:bg-[#5550F2] flex items-center justify-center transition-colors"},Go={class:"flex-1"},Yo={class:"font-medium text-[#2D3748] group-hover:text-[#5550F2] transition-colors"},Xo={key:0,class:"text-sm text-[#2D3748]/60"},Qo={class:"text-xs text-[#2D3748]/50"},Wo={key:2,class:"p-4 bg-gradient-to-r from-emerald-50 to-teal-50 border border-emerald-200 rounded-xl shadow-sm"},Zo={class:"flex items-start justify-between gap-3"},es={class:"flex items-center gap-3 flex-1"},ts={class:"w-12 h-12 rounded-full bg-emerald-500 flex items-center justify-center flex-shrink-0"},os={class:"flex-1"},ss={class:"font-bold text-emerald-900 text-lg"},as={key:0,class:"text-sm text-emerald-700 mt-0.5"},ns={class:"space-y-6 pt-4 border-t-2 border-[#5550F2]/30"},rs={class:"text-lg font-serif text-[#2D3748] font-semibold flex items-center gap-2"},ls={key:0,class:"w-7 h-7 rounded-full bg-[#5550F2] text-white flex items-center justify-center text-sm font-bold"},is={key:1,class:"w-7 h-7 rounded-full bg-green-500 text-white flex items-center justify-center"},ds={class:"p-5 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-xl shadow-sm space-y-4"},cs={class:"text-sm font-bold text-blue-900 flex items-center gap-2"},us={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ms={class:"block text-sm font-medium text-[#2D3748] mb-2 flex items-center gap-2"},ps={class:"space-y-2"},bs=["min"],fs={class:"flex gap-2 flex-wrap"},vs=["onClick"],xs={key:0,class:"flex items-center gap-2"},hs={class:"block text-sm font-medium text-[#2D3748] mb-2 flex items-center gap-2"},gs={class:"space-y-3"},_s={class:"grid grid-cols-4 gap-3 max-h-72 overflow-y-auto p-4 bg-white rounded-lg border border-[#5550F2]/20 shadow-inner"},ws=["onClick"],ys={class:"text-xs"},ks={class:"cursor-pointer text-[#2D3748]/60 hover:text-[#2D3748] select-none flex items-center gap-2"},Cs={class:"mt-2"},Fs={id:"horas-sugeridas"},Ds=["value"],Ps={key:0,class:"flex items-center gap-2"},Ss={key:1,class:"text-xs text-[#2D3748]/50 flex items-center gap-2"},$s=["value"],Es={class:"p-5 bg-gradient-to-r from-purple-50 to-pink-50 border border-purple-200 rounded-xl shadow-sm space-y-4"},Ms={class:"text-sm font-bold text-purple-900 flex items-center gap-2"},Ts={class:"block text-sm font-medium text-[#2D3748] mb-2 flex items-center gap-2"},js=["onClick"],Is={class:"font-medium text-[#2D3748] text-sm"},Ns={class:"text-xs text-[#2D3748]/50"},Bs={class:"block text-sm font-medium text-[#2D3748] mb-2 flex items-center gap-2"},Vs={class:"grid grid-cols-2 md:grid-cols-4 gap-3"},zs=["onClick"],As={class:"font-medium text-sm"},Hs={class:"p-5 bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200 rounded-xl shadow-sm"},Ls={class:"text-sm font-bold text-amber-900 flex items-center gap-2 mb-3"},Us={class:"block text-sm font-medium text-[#2D3748] mb-2 flex items-center gap-2"},qs={key:3,class:"p-4 bg-yellow-50 border-l-4 border-yellow-500 rounded-lg shadow-sm"},Os={class:"flex items-start gap-3"},Rs={key:4,class:"p-4 bg-red-50 border-l-4 border-red-500 rounded-lg shadow-sm"},Js={class:"flex items-start gap-3"},Ks={class:"text-sm text-red-800 space-y-1.5"},Gs={key:0,class:"flex items-center gap-2"},Ys={key:1,class:"flex items-center gap-2"},Xs={key:2,class:"flex items-center gap-2"},Qs={key:3,class:"flex items-center gap-2"},Ws={key:4,class:"flex items-center gap-2"},Zs={key:5,class:"p-4 bg-blue-50 border-l-4 border-blue-500 rounded-lg shadow-sm"},ea={class:"flex items-start gap-3"},ta={class:"flex-1"},oa={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},sa={class:"text-blue-900 font-semibold"},aa={class:"text-blue-900"},na={class:"text-blue-900 font-semibold"},ra={class:"text-blue-900"},la={class:"text-blue-900 capitalize"},ia={class:"text-blue-900 capitalize"},da={key:0,class:"md:col-span-2 flex items-center gap-2"},ca={class:"sticky bottom-0 bg-[#F2F2F2] pt-4 border-t border-[#5550F2]/30 flex gap-3 mt-6"},ua={class:"relative flex-1"},ma=["disabled","aria-label"],pa={key:0,class:"absolute -top-12 left-1/2 -translate-x-1/2 bg-gray-800 text-white text-xs px-3 py-2 rounded shadow-lg whitespace-nowrap opacity-0 hover:opacity-100 transition-opacity pointer-events-none"},ba={class:"flex items-start gap-3 text-white"},fa={class:"text-3xl"},va={class:"flex-1"},xa={class:"font-bold text-lg mb-1"},ha={class:"text-sm opacity-90 mb-3"},ga={key:0,class:"flex gap-2"},_a=["onClick"],wa=Ze({__name:"ModalNuevaCita",props:{modelValue:{type:Boolean,default:!1},mostrar:{type:Boolean,default:!1},fechaPreseleccionada:{type:String,default:""},horaPreseleccionada:{type:String,default:""},titulo:{type:String,default:""},pacientePreseleccionado:{type:Object,default:null},citaId:{type:String,default:null}},emits:["cerrar","citaCreada","actualizado","update:modelValue"],setup(F,{emit:ne}){const u=F,A=ne,{crearCita:Be,actualizarCita:Ve,getCitasPorDia:ze,verificarBonoActivo:Ae,sugerirProximoHorario:He}=ut(),re=et(),Le=tt(),Ue=K(()=>!!u.citaId);b(!1);const h=b(""),D=b(!1),v=b(null),w=b(!1),k=b(!1),R=b(!1),X=b([]),I=b(null),Q=b(!1),y=b(!1),le=b([]),fe=b(!1),C=b(null),$=b(!1),ie=b(""),de=b(""),H=b("exito"),W=b([]),m=b({tiene_bono:!1,sesiones_restantes:0,sesiones_totales:0,tipo_bono:"",bono_id:void 0}),s=b({paciente_id:"",paciente_nombre:"",terapeuta_id:"",terapeuta_nombre:"",fecha:u.fechaPreseleccionada||V(new Date),fecha_manual:"",hora_inicio:u.horaPreseleccionada||"",hora_fin:"",duracion:"60",tipo:"presencial",estado:"pendiente",notas:"",descontar_de_bono:!1,bono_id:void 0}),N=b(null);b(!1);const L=b([]),ve=["11:00","11:30","12:00","12:30","13:00","13:30","17:00","17:30","18:00","18:30","19:00","19:30","20:00","20:30","21:00","21:30","22:00"],qe=[{valor:"presencial",nombre:"Presencial",componente:vt,descripcion:"Sesi√≥n presencial en consultorio"},{valor:"online",nombre:"Online",componente:be,descripcion:"Videollamada por plataforma digital"},{valor:"telefonica",nombre:"Telef√≥nica",componente:pt,descripcion:"Llamada telef√≥nica"}],Oe=[{valor:"confirmada",nombre:"Confirmada",componente:bt,claseActivo:"border-emerald-500 bg-emerald-50 text-emerald-700",claseInactivo:"border-gray-300 hover:border-emerald-400 bg-white"},{valor:"pendiente",nombre:"Pendiente",componente:Ne,claseActivo:"border-amber-500 bg-amber-50 text-amber-700",claseInactivo:"border-gray-300 hover:border-amber-400 bg-white"},{valor:"cancelada",nombre:"Cancelada",componente:Te,claseActivo:"border-red-500 bg-red-50 text-red-700",claseInactivo:"border-gray-300 hover:border-red-400 bg-white"},{valor:"completada",nombre:"Completada",componente:z,claseActivo:"border-blue-500 bg-blue-50 text-blue-700",claseInactivo:"border-gray-300 hover:border-blue-400 bg-white"}],Re=K(()=>V(new Date)),Je=K(()=>{const n=new Date,t=[];t.push({label:"Hoy",fecha:V(n)});const a=new Date(n);a.setDate(a.getDate()+1),t.push({label:"Ma√±ana",fecha:V(a)});const f=["Lun","Mar","Mi√©","Jue","Vie"];let p=new Date(n),x=0;for(;x<5;){p.setDate(p.getDate()+1);const P=p.getDay();P>=1&&P<=5&&(t.push({label:`${f[P-1]} ${p.getDate()}`,fecha:V(p)}),x++)}return t}),ce=K(()=>{if(!h.value)return[];const n=h.value.toLowerCase().trim();return n.length<2?[]:X.value.filter(t=>t.nombre.toLowerCase().includes(n)||t.email.toLowerCase().includes(n))}),E=K(()=>{const n=s.value.paciente_id,t=y.value?s.value.terapeuta_id:!0;return n&&t&&s.value.fecha&&s.value.hora_inicio&&s.value.hora_fin&&s.value.tipo&&s.value.estado});async function xe(){console.log("üìã Cargando pacientes..."),R.value=!0;try{const{data:{user:n}}=await re.auth.getUser();if(!n){console.error("‚ùå No hay usuario autenticado");return}console.log("üë§ Usuario ID:",n.id);const{userProfile:t}=Se();console.log("üé≠ Rol de usuario:",t.value?.rol||"desconocido");let a=re.from("pacientes").select(`
        id,
        nombre_completo,
        email,
        metadata
      `).eq("activo",!0).order("created_at",{ascending:!1});t.value?.rol!=="coordinadora"?(console.log("üë®‚Äç‚öïÔ∏è Filtrando por terapeuta_id:",n.id),a=a.eq("terapeuta_id",n.id)):console.log("üåü Coordinadora - cargando TODOS los pacientes");const{data:f,error:p}=await a;if(p){console.error("‚ùå Error al cargar pacientes:",p);return}X.value=(f||[]).map(x=>({id:x.id,nombre:x.nombre_completo||"Sin nombre",email:x.email||"",frecuencia:x.metadata?.frecuencia||"No definida",area_acompanamiento:x.metadata?.area_de_acompanamiento||""})),console.log(`‚úÖ ${X.value.length} pacientes cargados (rol: ${t.value?.rol||"desconocido"})`),console.log("üìù Pacientes:",X.value)}catch(n){console.error("‚ùå Error al cargar pacientes:",n)}finally{R.value=!1}}function Ke(){h.value.length>=2?D.value=!0:D.value=!1}async function he(n){v.value=n,s.value.paciente_id=n.id,s.value.paciente_nombre=n.nombre,h.value=n.nombre,D.value=!1;const t=await Ae(n.id);if(m.value=t,t.tiene_bono&&t.sesiones_restantes>0&&(s.value.descontar_de_bono=!0,s.value.bono_id=t.bono_id),n.frecuencia&&!u.fechaPreseleccionada){Q.value=!0;try{const a=await He(n.id,n.frecuencia);a&&(N.value=a.fecha,I.value=a.hora,s.value.fecha=a.fecha,s.value.hora_inicio=a.hora,M(),console.log("üí° Horario sugerido:",a))}catch(a){console.error("Error al sugerir horario:",a)}finally{Q.value=!1}}console.log("‚úÖ Paciente seleccionado:",n.nombre)}async function Ge(){v.value=null,s.value.paciente_id="",s.value.paciente_nombre="",s.value.descontar_de_bono=!1,s.value.bono_id=void 0,m.value={tiene_bono:!1,sesiones_restantes:0,sesiones_totales:0,tipo_bono:"",bono_id:void 0},N.value=null,I.value=null,await $e(),h.value="",D.value=!1}function ge(n,t,a=[]){ie.value=n,de.value=t,H.value="exito",W.value=a,$.value=!0,setTimeout(()=>{$.value=!1},5e3)}function B(n,t){ie.value=n,de.value=t,H.value="error",W.value=[],$.value=!0,setTimeout(()=>{$.value=!1},4e3)}function M(){if(!s.value.hora_inicio||!s.value.duracion)return;const n=s.value.hora_inicio.split(":").map(Number),t=n[0]||0,a=n[1]||0,f=parseInt(s.value.duracion),p=new Date;p.setHours(t,a,0,0);const x=new Date(p.getTime()+f*6e4),P=String(x.getHours()).padStart(2,"0"),S=String(x.getMinutes()).padStart(2,"0");s.value.hora_fin=`${P}:${S}`}async function _e(){if(!s.value.fecha||!s.value.hora_inicio||!s.value.hora_fin){k.value=!1;return}try{const t=(await ze(s.value.fecha)).filter(p=>p.estado!=="cancelada"&&p.estado!=="borrador"&&p.estado!==null&&p.id!==u.citaId),a=s.value.hora_inicio,f=s.value.hora_fin;k.value=t.some(p=>{const x=p.hora_inicio,P=p.hora_fin,S=Z(a),q=Z(f),ee=Z(x),te=Z(P),Pe=S>=ee&&S<te||q>ee&&q<=te||S<=ee&&q>=te||S===ee&&q===te;return Pe&&console.log("‚ö†Ô∏è Conflicto detectado:",{nueva:`${a} - ${f}`,existente:`${x} - ${P}`,estado:p.estado,paciente:p.paciente_nombre||"Desconocido"}),Pe}),k.value&&console.warn("‚ö†Ô∏è Hay conflicto de horario")}catch(n){console.error("‚ùå Error al verificar conflicto:",n),k.value=!1}}function Z(n){if(!n||!n.includes(":"))return 0;const[t,a]=n.split(":").map(Number);return(t||0)*60+(a||0)}async function we(){w.value=!0;try{if(!s.value.paciente_id){B("Paciente requerido","Por favor, selecciona un paciente antes de continuar."),w.value=!1;return}if(!s.value.fecha||!s.value.hora_inicio||!s.value.hora_fin){B("Datos incompletos","Por favor, completa la fecha y hora de la cita."),w.value=!1;return}if(y.value&&!s.value.terapeuta_id){B("Terapeuta requerido","Por favor, selecciona un terapeuta antes de continuar."),w.value=!1;return}if(await _e(),k.value){B("Conflicto de Horario","Ya existe una cita en este horario. Por favor, selecciona otro."),w.value=!1;return}const n={paciente_id:s.value.paciente_id,paciente_nombre:s.value.paciente_nombre||v.value?.nombre||"Sin nombre",fecha_cita:s.value.fecha,hora_inicio:s.value.hora_inicio,hora_fin:s.value.hora_fin,duracion:parseInt(s.value.duracion),modalidad:s.value.tipo,estado:s.value.estado==="completada"?"realizada":s.value.estado,observaciones:s.value.notas,bono_id:s.value.bono_id};y.value&&s.value.terapeuta_id&&(n.terapeuta_id=s.value.terapeuta_id);let t;if(Ue.value&&u.citaId)if(console.log("üìù [ModalNuevaCita] Actualizando cita con ID:",u.citaId,n),t=await Ve(u.citaId,n),t.success){localStorage.removeItem("nueva_cita_temp");const a=J(s.value.fecha),f=s.value.tipo==="presencial"?"üè•":s.value.tipo==="online"?"üíª":"üìû",p=s.value.paciente_nombre||v.value?.nombre||"Paciente";ge("‚úÖ Cita actualizada con √©xito",`${p} ‚Äì ${a}, ${s.value.hora_inicio} (${f} ${s.value.tipo})`,[]),A("actualizado"),A("citaCreada",t.data),console.log("‚úÖ [ModalNuevaCita] Cita actualizada exitosamente"),setTimeout(()=>{U()},1e3)}else B("Error al actualizar",t.error||"No se pudo actualizar la cita. Intenta de nuevo.");else{console.log("üöÄ [ModalNuevaCita] Creando nueva cita:",n);const a={paciente_id:s.value.paciente_id,paciente_nombre:s.value.paciente_nombre||v.value?.nombre||"Sin nombre",fecha:s.value.fecha,hora_inicio:s.value.hora_inicio,hora_fin:s.value.hora_fin,modalidad:s.value.tipo,estado:s.value.estado==="completada"?"realizada":s.value.estado,notas:s.value.notas,descontar_de_bono:s.value.descontar_de_bono,bono_id:s.value.bono_id};if(y.value&&s.value.terapeuta_id&&(a.terapeuta_id=s.value.terapeuta_id),t=await Be(a),t.success){localStorage.removeItem("nueva_cita_temp");const f=J(s.value.fecha),p=s.value.tipo==="presencial"?"üè•":s.value.tipo==="online"?"üíª":"üìû";let S=`${s.value.paciente_nombre||v.value?.nombre||"Paciente"} ‚Äì ${f}, ${s.value.hora_inicio} (${p} ${s.value.tipo})`;if(t.data?.bono_id&&m.value.tiene_bono){const q=m.value.sesiones_restantes-1;S+=`
üé´ Bono activo: ${q} sesiones restantes despu√©s de esta`}ge("‚úÖ Cita creada con √©xito",S,[{texto:"üìÖ Ver en Agenda",accion:()=>{Le.push("/agenda"),$.value=!1}},{texto:"‚ûï Nueva Cita",accion:()=>{$.value=!1,ye()}}]),A("citaCreada",t.data),A("actualizado"),console.log("‚úÖ [ModalNuevaCita] Cita creada exitosamente:",t.data),setTimeout(()=>{U()},1e3)}else B("Error al crear",t.error||"No se pudo crear la cita. Intenta de nuevo.")}}catch(n){console.error("‚ùå Error al guardar cita:",n),B("Error inesperado",n.message||"Ocurri√≥ un error al guardar la cita")}finally{w.value=!1}}function U(){(s.value.paciente_id||s.value.fecha!==V(new Date))&&localStorage.setItem("nueva_cita_temp",JSON.stringify({...s.value,timestamp:Date.now()})),A("cerrar"),A("update:modelValue",!1),ye()}function ye(){s.value={paciente_id:"",paciente_nombre:"",terapeuta_id:"",terapeuta_nombre:"",fecha:V(new Date),fecha_manual:"",hora_inicio:"",hora_fin:"",duracion:"60",tipo:"presencial",estado:"pendiente",notas:"",descontar_de_bono:!1,bono_id:void 0},h.value="",v.value=null,C.value=null,k.value=!1,N.value=null,I.value=null,L.value=[],m.value={tiene_bono:!1,sesiones_restantes:0,sesiones_totales:0,tipo_bono:"",bono_id:void 0}}function Ye(){const n=localStorage.getItem("nueva_cita_temp");if(n)try{const t=JSON.parse(n);Date.now()-t.timestamp<1440*60*1e3?console.log("üíæ Datos temporales disponibles"):localStorage.removeItem("nueva_cita_temp")}catch(t){console.error("Error al cargar datos temporales:",t)}}function V(n){return n.toISOString().split("T")[0]||""}function J(n){const t=new Date(n+"T00:00:00"),a={weekday:"long",year:"numeric",month:"long",day:"numeric"};return t.toLocaleDateString("es-MX",a)}function Xe(){const n=[];return s.value.paciente_id||n.push("paciente"),s.value.fecha||n.push("fecha"),s.value.hora_inicio||n.push("hora_inicio"),s.value.tipo||n.push("tipo"),s.value.estado||n.push("estado"),L.value=n,n.length===0}async function Qe(){fe.value=!0;try{const{data:n,error:t}=await re.from("terapeutas").select("id, nombre_completo, email, especialidad").eq("activo",!0).order("nombre_completo",{ascending:!0});if(t){console.error("Error al cargar terapeutas:",t);return}le.value=n||[],console.log(`‚úÖ ${le.value.length} terapeutas cargados`)}catch(n){console.error("Error al cargar terapeutas:",n)}finally{fe.value=!1}}async function ke(){try{console.log("üîç Verificando rol de usuario...");const{userProfile:n}=Se();if(!n.value){console.warn("‚ö†Ô∏è No hay perfil cargado"),y.value=!1;return}console.log("üë§ Usuario:",n.value.email),console.log("üé≠ Rol del perfil:",n.value.rol),y.value=n.value.rol==="coordinadora",console.log(`‚úÖ ¬øEs coordinadora? ${y.value}`),y.value&&(console.log("üåü Usuario es coordinadora - cargando terapeutas"),await Qe())}catch(n){console.error("‚ùå Error al verificar rol:",n),y.value=!1}}function We(n){C.value=n,s.value.terapeuta_id=n.id,s.value.terapeuta_nombre=n.nombre_completo,console.log("‚úÖ Terapeuta seleccionado:",n.nombre_completo)}G([()=>s.value.fecha,()=>s.value.hora_inicio,()=>s.value.hora_fin],()=>{s.value.fecha&&s.value.hora_inicio&&s.value.hora_fin&&_e()}),G(()=>u.fechaPreseleccionada,n=>{n&&(s.value.fecha=n)}),G(()=>u.horaPreseleccionada,n=>{n&&(s.value.hora_inicio=n,M())}),ot(async()=>{await ke(),xe(),Ye(),u.horaPreseleccionada&&M(),document.addEventListener("click",Fe),document.addEventListener("keydown",Ce)}),st(()=>{document.removeEventListener("click",Fe),document.removeEventListener("keydown",Ce)});function Ce(n){if(u.mostrar&&(n.key==="Escape"&&U(),n.key==="Enter"&&!n.shiftKey)){const a=n.target.tagName;if(a==="INPUT"||a==="TEXTAREA"||a==="SELECT"){n.preventDefault();return}E.value&&!w.value&&(n.preventDefault(),we())}}function Fe(){D.value&&(D.value=!1)}const De=()=>{console.log("üéØ Modal abierto - verificando rol y cargando datos"),console.log("üìÖ Fecha preseleccionada:",u.fechaPreseleccionada),console.log("‚è∞ Hora preseleccionada:",u.horaPreseleccionada),ke(),xe(),u.fechaPreseleccionada&&(s.value.fecha=u.fechaPreseleccionada,console.log("‚úÖ Fecha aplicada:",s.value.fecha)),u.horaPreseleccionada&&(s.value.hora_inicio=u.horaPreseleccionada,M(),console.log("‚úÖ Hora aplicada:",s.value.hora_inicio,"- Hora fin:",s.value.hora_fin)),u.pacientePreseleccionado&&$e(()=>{he({id:u.pacientePreseleccionado.id,nombre:u.pacientePreseleccionado.nombre,email:u.pacientePreseleccionado.email,frecuencia:u.pacientePreseleccionado.frecuencia||"No definida",area_acompanamiento:u.pacientePreseleccionado.area_acompanamiento||""})})};return G(()=>u.mostrar,n=>{n&&De()}),G(()=>u.modelValue,n=>{n&&De()}),(n,t)=>F.modelValue||F.mostrar?(r(),l("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:oe(U,["self"])},[e("div",xt,[e("div",ht,[e("div",null,[e("h2",gt,i(F.titulo||"Nueva Cita"),1),F.fechaPreseleccionada?(r(),l("p",_t,i(J(F.fechaPreseleccionada))+" a las "+i(F.horaPreseleccionada),1)):d("",!0)]),e("button",{onClick:U,class:"text-neutral-600 hover:text-[#027368] transition-colors p-2 hover:bg-white/50 rounded-lg","aria-label":"Cerrar modal"},[...t[13]||(t[13]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("form",{onSubmit:oe(we,["prevent"]),class:"px-6 py-6 space-y-6 bg-gradient-to-b from-white/50 to-transparent"},[u.pacientePreseleccionado&&o(v)?(r(),l("div",wt,[e("div",yt,[e("div",kt,[e("div",Ct,[c(o(z),{class:"w-7 h-7 text-white"})]),e("div",null,[t[15]||(t[15]=e("div",{class:"text-xs font-semibold text-emerald-700 uppercase tracking-wide mb-1"},"Paciente Seleccionado",-1)),e("div",Ft,i(o(v).nombre),1),e("div",Dt,[e("span",null,i(o(v).email),1)]),o(v).frecuencia?(r(),l("div",Pt,[c(o(Y),{class:"w-4 h-4 text-emerald-600"}),e("span",St,[t[14]||(t[14]=g("Frecuencia: ",-1)),e("strong",$t,i(o(v).frecuencia),1)])])):d("",!0)])]),e("div",Et,[o(m).tiene_bono?(r(),l("div",Mt,[c(o(ue),{class:"w-4 h-4"}),t[16]||(t[16]=e("span",null,"BONO ACTIVO",-1))])):d("",!0),o(m).tiene_bono?(r(),l("div",Tt,i(o(m).sesiones_restantes)+"/"+i(o(m).sesiones_totales),1)):d("",!0),o(m).tiene_bono?(r(),l("div",jt,"sesiones")):d("",!0)])])])):d("",!0),u.pacientePreseleccionado?d("",!0):(r(),l("div",It,[e("div",Nt,[e("h3",Bt,[o(v)?(r(),l("span",zt,[c(o(z),{class:"w-5 h-5"})])):(r(),l("span",Vt," 1 ")),t[17]||(t[17]=g(" Seleccionar Paciente ",-1))])]),o(v)?d("",!0):(r(),l("div",At,[e("p",Ht,[c(o(me),{class:"w-5 h-5 flex-shrink-0"}),t[18]||(t[18]=e("span",null,"Busca y selecciona un paciente ya registrado en el sistema",-1))]),t[19]||(t[19]=e("p",{class:"text-xs text-blue-700 mt-1.5 ml-7"},[g(" Para crear un paciente nuevo, ve a la secci√≥n "),e("strong",null,"Pacientes"),g(" en el men√∫ principal ")],-1))])),o(v)?d("",!0):(r(),l("div",Lt,[e("div",{class:"relative",onClick:t[2]||(t[2]=oe(()=>{},["stop"]))},[O(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>at(h)?h.value=a:null),type:"text",placeholder:"Buscar paciente por nombre o email...",class:"w-full px-4 py-2.5 pl-10 border border-neutral-300 rounded-xl focus:ring-2 focus:ring-[#027368]/20 focus:border-[#027368] bg-white/90 backdrop-blur-sm transition-all shadow-sm",onFocus:t[1]||(t[1]=a=>D.value=!0),onInput:Ke,autocomplete:"off"},null,544),[[se,o(h)]]),e("span",Ut,[c(o(me),{class:"w-5 h-5 text-neutral-400"})]),o(R)?(r(),l("span",qt,[...t[20]||(t[20]=[e("svg",{class:"animate-spin h-5 w-5 text-[#027368]",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):d("",!0),!o(h)&&!o(R)?(r(),l("div",Ot,[c(o(ae),{class:"w-4 h-4 flex-shrink-0"}),t[21]||(t[21]=e("span",null,"Escribe al menos 2 caracteres para buscar",-1))])):d("",!0)]),o(D)&&o(h)&&o(ce).length>0?(r(),l("div",Rt,[(r(!0),l(T,null,j(o(ce),a=>(r(),l("button",{key:a.id,type:"button",onClick:f=>he(a),class:"p-4 text-left hover:bg-[#027368]/5 transition-all border-2 border-neutral-200 hover:border-[#027368] rounded-xl cursor-pointer group bg-white/90 backdrop-blur-sm shadow-sm hover:shadow-md"},[e("div",Kt,[e("div",Gt,[c(o(je),{class:"w-6 h-6 text-[#027368] group-hover:text-white transition-colors"})]),e("div",Yt,[e("div",Xt,i(a.nombre),1),e("div",Qt,i(a.email),1),a.frecuencia?(r(),l("div",Wt,[c(o(Y),{class:"w-3 h-3"}),e("span",Zt,i(a.frecuencia),1)])):d("",!0)]),t[22]||(t[22]=e("div",{class:"opacity-0 group-hover:opacity-100 transition-opacity"},[e("svg",{class:"w-5 h-5 text-[#027368]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})])],-1))])],8,Jt))),128))])):d("",!0),o(D)&&o(h)&&o(ce).length===0&&!o(R)?(r(),l("div",eo,[c(o(me),{class:"w-12 h-12 mx-auto mb-2 text-neutral-400"}),e("p",null,[t[23]||(t[23]=g('No se encontraron pacientes con "',-1)),e("strong",null,i(o(h)),1),t[24]||(t[24]=g('"',-1))])])):d("",!0)])),o(s).paciente_id&&o(v)&&!u.pacientePreseleccionado?(r(),l("div",to,[e("div",oo,[e("div",so,[e("div",ao,[e("div",no,[c(o(z),{class:"w-7 h-7 text-white"})]),e("div",ro,[t[26]||(t[26]=e("div",{class:"text-xs font-semibold text-emerald-700 uppercase tracking-wide mb-1"},"Paciente Seleccionado",-1)),e("div",lo,i(o(v).nombre),1),e("div",io,[e("span",null,i(o(v).email),1)]),o(v).frecuencia?(r(),l("div",co,[c(o(Y),{class:"w-4 h-4 text-emerald-600"}),t[25]||(t[25]=e("span",{class:"font-medium text-emerald-800"},"Frecuencia:",-1)),e("span",uo,i(o(v).frecuencia),1)])):d("",!0)])]),e("button",{type:"button",onClick:Ge,class:"px-4 py-2 bg-white border-2 border-emerald-300 text-emerald-700 hover:bg-emerald-50 hover:border-emerald-400 rounded-lg text-sm font-medium transition-all flex items-center gap-2 shadow-sm hover:shadow flex-shrink-0"},[...t[27]||(t[27]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),e("span",null,"Cambiar",-1)])])])]),o(m).tiene_bono?(r(),l("div",mo,[e("div",po,[e("div",bo,[e("div",fo,[c(o(ue),{class:"w-6 h-6 text-white"})]),t[28]||(t[28]=e("div",null,[e("div",{class:"text-sm font-bold text-blue-900 uppercase tracking-wide"},"Bono Activo"),e("div",{class:"text-xs text-blue-600"},"El paciente tiene sesiones disponibles")],-1))]),e("div",vo,[t[29]||(t[29]=e("div",{class:"text-xs text-blue-600 mb-1"},"Sesiones Disponibles",-1)),e("div",{class:_(["text-3xl font-bold",o(m).sesiones_restantes<=1?"text-red-600":o(m).sesiones_restantes<=2?"text-amber-600":"text-blue-700"])},i(o(m).sesiones_restantes),3)])]),e("div",xo,[e("div",ho,[t[30]||(t[30]=e("div",{class:"text-xs text-blue-600 mb-1 font-medium"},"Tipo de Bono",-1)),e("div",go,i(o(m).tipo_bono||"N/A"),1)]),e("div",_o,[t[31]||(t[31]=e("div",{class:"text-xs text-blue-600 mb-1 font-medium"},"Total Sesiones",-1)),e("div",wo,i(o(m).sesiones_totales||"?"),1)]),e("div",yo,[t[32]||(t[32]=e("div",{class:"text-xs text-blue-600 mb-1 font-medium"},"Utilizadas",-1)),e("div",ko,i((o(m).sesiones_totales||0)-(o(m).sesiones_restantes||0)),1)])]),e("div",Co,[e("div",Fo,[t[33]||(t[33]=e("span",null,"Progreso del bono",-1)),e("span",Do,i(Math.round((o(m).sesiones_totales-o(m).sesiones_restantes)/o(m).sesiones_totales*100))+"%",1)]),e("div",Po,[e("div",{class:_(["h-full rounded-full transition-all duration-500",[o(m).sesiones_restantes<=1?"bg-red-500":o(m).sesiones_restantes<=2?"bg-amber-500":"bg-blue-500"]]),style:nt({width:`${(o(m).sesiones_totales-o(m).sesiones_restantes)/o(m).sesiones_totales*100}%`})},null,6)])]),o(m).sesiones_restantes<=2?(r(),l("div",So,[c(o(Ie),{class:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),e("div",$o,[e("div",Eo,i(o(m).sesiones_restantes===1?"¬°√öltima sesi√≥n del bono!":"¬°Pocas sesiones restantes!"),1),e("div",Mo,i(o(m).sesiones_restantes===1?"Esta es la √∫ltima sesi√≥n disponible. Considere informar al paciente para renovar su bono.":`Solo quedan ${o(m).sesiones_restantes} sesiones. Considere informar al paciente para renovar su bono pronto.`),1)])])):d("",!0),e("div",To,[O(e("input",{id:"descontar-bono","onUpdate:modelValue":t[3]||(t[3]=a=>o(s).descontar_de_bono=a),type:"checkbox",class:"mt-1 w-5 h-5 text-blue-600 border-blue-300 rounded focus:ring-blue-500 focus:ring-2"},null,512),[[rt,o(s).descontar_de_bono]]),e("label",jo,[t[36]||(t[36]=e("div",{class:"text-sm text-blue-900 font-semibold mb-1"}," Descontar sesi√≥n de este bono ",-1)),e("div",Io,[t[34]||(t[34]=g(" Al completar esta cita, se descontar√° autom√°ticamente 1 sesi√≥n del bono activo. Quedar√°n ",-1)),e("strong",null,i(o(m).sesiones_restantes-1),1),t[35]||(t[35]=g(" sesiones disponibles. ",-1))])])])])):(r(),l("div",No,[e("div",Bo,[c(o(ae),{class:"w-6 h-6 text-amber-600 flex-shrink-0 mt-0.5"}),t[37]||(t[37]=e("div",null,[e("div",{class:"font-semibold text-amber-900 mb-1"},"Sin bono activo"),e("div",{class:"text-sm text-amber-800"}," Este paciente no tiene bonos activos actualmente. Esta sesi√≥n se cobrar√° de forma individual. ")],-1))])]))])):d("",!0)])),o(y)?(r(),l("div",Vo,[e("div",zo,[e("h3",Ao,[o(C)?(r(),l("span",Lo,[c(o(z),{class:"w-5 h-5"})])):(r(),l("span",Ho,i((u.pacientePreseleccionado,"2")),1)),t[38]||(t[38]=g(" Asignar Terapeuta ",-1))])]),o(C)?d("",!0):(r(),l("div",Uo,[e("p",qo,[c(o(mt),{class:"w-5 h-5 flex-shrink-0"}),t[39]||(t[39]=e("span",null,"Selecciona el terapeuta que atender√° esta cita",-1))])])),o(C)?d("",!0):(r(),l("div",Oo,[(r(!0),l(T,null,j(o(le),a=>(r(),l("button",{key:a.id,type:"button",onClick:f=>We(a),class:"p-4 text-left hover:bg-[#5550F2]/10 transition-all border-2 border-[#5550F2]/30 hover:border-[#5550F2] rounded-lg cursor-pointer group bg-white"},[e("div",Jo,[e("div",Ko,[c(o(je),{class:"w-6 h-6 text-[#2D3748] group-hover:text-white transition-colors"})]),e("div",Go,[e("div",Yo,i(a.nombre_completo),1),a.especialidad?(r(),l("div",Xo,i(a.especialidad),1)):d("",!0),e("div",Qo,i(a.email),1)]),t[40]||(t[40]=e("div",{class:"opacity-0 group-hover:opacity-100 transition-opacity"},[e("svg",{class:"w-5 h-5 text-[#5550F2]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})])],-1))])],8,Ro))),128))])),o(C)?(r(),l("div",Wo,[e("div",Zo,[e("div",es,[e("div",ts,[c(o(z),{class:"w-7 h-7 text-white"})]),e("div",os,[t[41]||(t[41]=e("div",{class:"text-xs font-semibold text-emerald-700 uppercase tracking-wide mb-1"},"Terapeuta Asignado",-1)),e("div",ss,i(o(C).nombre_completo),1),o(C).especialidad?(r(),l("div",as,i(o(C).especialidad),1)):d("",!0)])]),e("button",{type:"button",onClick:t[4]||(t[4]=a=>{C.value=null,o(s).terapeuta_id="",o(s).terapeuta_nombre=""}),class:"px-4 py-2 bg-white border-2 border-emerald-300 text-emerald-700 hover:bg-emerald-50 hover:border-emerald-400 rounded-lg text-sm font-medium transition-all flex items-center gap-2 shadow-sm hover:shadow flex-shrink-0"},[...t[42]||(t[42]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),e("span",null,"Cambiar",-1)])])])])):d("",!0)])):d("",!0),e("div",ns,[e("h3",rs,[o(E)?(r(),l("span",is," ‚úì ")):(r(),l("span",ls,i(o(y)?"3":u.pacientePreseleccionado?"1":"2"),1)),t[43]||(t[43]=g(" Detalles de la Cita ",-1))]),e("div",ds,[e("h4",cs,[c(o(Y),{class:"w-5 h-5 text-blue-600"}),t[44]||(t[44]=e("span",null,"Detalles de Programaci√≥n",-1))]),e("div",us,[e("div",null,[e("label",ms,[c(o(Y),{class:"w-4 h-4"}),t[45]||(t[45]=e("span",null,"Fecha",-1)),t[46]||(t[46]=e("span",{class:"text-red-500"},"*",-1))]),e("div",ps,[O(e("input",{"onUpdate:modelValue":t[5]||(t[5]=a=>o(s).fecha=a),type:"date",required:"",min:o(Re),onKeydown:t[6]||(t[6]=lt(oe(()=>{},["prevent"]),["enter"])),class:_(["w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white text-base cursor-pointer",o(L).includes("fecha")?"border-red-500 border-2":"border-[#5550F2]/30"]),style:{"min-height":"44px"},placeholder:"dd/mm/aaaa"},null,42,bs),[[se,o(s).fecha]]),e("div",fs,[(r(!0),l(T,null,j(o(Je),(a,f)=>(r(),l("button",{key:f,type:"button",onClick:p=>o(s).fecha=a.fecha,class:_(["text-xs px-3 py-1.5 rounded-lg border transition-all",o(s).fecha===a.fecha?"bg-[#5550F2] text-white border-[#5550F2] font-semibold":"bg-white text-[#2D3748] border-[#5550F2]/30 hover:border-[#5550F2] hover:bg-[#5550F2]/10"])},i(a.label),11,vs))),128))]),o(N)&&o(N)!==o(s).fecha?(r(),l("div",xs,[e("button",{type:"button",onClick:t[7]||(t[7]=a=>o(s).fecha=o(N)),class:"text-xs px-2 py-1 bg-green-50 text-green-700 border border-green-200 rounded hover:bg-green-100 transition-colors"}," üí° Usar fecha sugerida: "+i(J(o(N))),1)])):d("",!0)])]),e("div",null,[e("label",hs,[c(o(Ne),{class:"w-4 h-4"}),t[47]||(t[47]=e("span",null,"Hora de Inicio",-1)),t[48]||(t[48]=e("span",{class:"text-red-500"},"*",-1))]),e("div",gs,[e("div",_s,[(r(),l(T,null,j(ve,a=>e("button",{key:a,type:"button",onClick:f=>{o(s).hora_inicio=a,M()},class:_(["px-4 py-3 text-sm font-semibold rounded-lg transition-all border-2 flex items-center justify-center min-w-[70px]",o(s).hora_inicio===a?"bg-[#5550F2] text-white border-[#5550F2] shadow-lg transform scale-105 ring-2 ring-[#5550F2]/30":"bg-white text-[#2D3748] border-gray-300 hover:border-[#5550F2] hover:bg-[#5550F2]/10 hover:shadow-md hover:scale-102"])},i(a),11,ws)),64))]),e("details",ys,[e("summary",ks,[c(o(pe),{class:"w-4 h-4"}),t[49]||(t[49]=e("span",null,"Ingresar hora manualmente",-1))]),e("div",Cs,[O(e("input",{"onUpdate:modelValue":t[8]||(t[8]=a=>o(s).hora_inicio=a),type:"time",step:"1800",onChange:M,class:_(["w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white",o(L).includes("hora_inicio")?"border-red-500 border-2":"border-[#5550F2]/30"])},null,34),[[se,o(s).hora_inicio]])])]),e("datalist",Fs,[(r(),l(T,null,j(ve,a=>e("option",{key:a,value:a},i(a),9,Ds)),64))]),o(I)&&o(I)!==o(s).hora_inicio&&o(Q)===!1?(r(),l("div",Ps,[e("button",{type:"button",onClick:t[9]||(t[9]=a=>{o(s).hora_inicio=o(I),M()}),class:"flex items-center gap-1.5 text-xs px-3 py-1.5 bg-emerald-50 text-emerald-700 border border-emerald-200 rounded-lg hover:bg-emerald-100 transition-colors font-medium"},[c(o(ae),{class:"w-4 h-4"}),e("span",null,"Usar hora sugerida: "+i(o(I)),1)])])):d("",!0),o(Q)?(r(),l("div",Ss,[...t[50]||(t[50]=[e("svg",{class:"animate-spin h-3 w-3",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),g(" Buscando horario disponible... ",-1)])])):d("",!0)])]),e("div",null,[t[52]||(t[52]=e("label",{class:"block text-sm font-medium text-[#2D3748] mb-1"},[g(" Duraci√≥n "),e("span",{class:"text-red-500"},"*")],-1)),O(e("select",{"onUpdate:modelValue":t[10]||(t[10]=a=>o(s).duracion=a),required:"",onChange:M,class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white"},[...t[51]||(t[51]=[e("option",{value:"30"},"30 minutos",-1),e("option",{value:"60",selected:""},"60 minutos (1 hora)",-1),e("option",{value:"90"},"90 minutos (1.5 horas)",-1),e("option",{value:"120"},"120 minutos (2 horas)",-1)])],544),[[it,o(s).duracion]])]),e("div",null,[t[53]||(t[53]=e("label",{class:"block text-sm font-medium text-[#2D3748] mb-1"}," Hora de Fin ",-1)),e("input",{value:o(s).hora_fin,type:"text",readonly:"",class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg bg-gray-100 text-[#2D3748]/60",placeholder:"Se calcular√° autom√°ticamente"},null,8,$s)])])]),e("div",Es,[e("h4",Ms,[c(o(be),{class:"w-5 h-5 text-purple-600"}),t[54]||(t[54]=e("span",null,"Tipo de Sesi√≥n y Estado",-1))]),e("div",null,[e("label",Ts,[c(o(be),{class:"w-5 h-5"}),t[55]||(t[55]=e("span",null,"Tipo de Sesi√≥n",-1)),t[56]||(t[56]=e("span",{class:"text-red-500"},"*",-1))]),e("div",{class:_(["grid grid-cols-3 gap-3",o(L).includes("tipo")?"p-3 border-2 border-red-500 bg-red-50 rounded-lg":""])},[(r(),l(T,null,j(qe,a=>e("button",{key:a.valor,type:"button",onClick:f=>o(s).tipo=a.valor,class:_(["p-4 border-2 rounded-lg transition-all flex flex-col items-center gap-2 group",o(s).tipo===a.valor?"border-[#5550F2] bg-[#5550F2]/20 shadow-md":"border-[#5550F2]/30 hover:border-[#5550F2] hover:bg-[#5550F2]/5 bg-white"])},[(r(),Ee(Me(a.componente),{class:_(["w-8 h-8 transition-colors",o(s).tipo===a.valor?"text-[#5550F2]":"text-[#2D3748]/60 group-hover:text-[#5550F2]"])},null,8,["class"])),e("div",Is,i(a.nombre),1),e("div",Ns,i(a.descripcion),1)],10,js)),64))],2)]),e("div",null,[e("label",Bs,[c(o(z),{class:"w-5 h-5"}),t[57]||(t[57]=e("span",null,"Estado",-1)),t[58]||(t[58]=e("span",{class:"text-red-500"},"*",-1))]),e("div",Vs,[(r(),l(T,null,j(Oe,a=>e("button",{key:a.valor,type:"button",onClick:f=>o(s).estado=a.valor,class:_(["p-3 border-2 rounded-lg transition-all flex flex-col items-center gap-2",o(s).estado===a.valor?a.claseActivo+" shadow-md":a.claseInactivo])},[(r(),Ee(Me(a.componente),{class:"w-7 h-7"})),e("div",As,i(a.nombre),1)],10,zs)),64))])])]),e("div",Hs,[e("h4",Ls,[c(o(pe),{class:"w-5 h-5 text-amber-600"}),t[59]||(t[59]=e("span",null,"Notas Adicionales",-1))]),e("div",null,[e("label",Us,[c(o(pe),{class:"w-4 h-4"}),t[60]||(t[60]=e("span",null,"Notas (opcional)",-1))]),O(e("textarea",{"onUpdate:modelValue":t[11]||(t[11]=a=>o(s).notas=a),rows:"3",class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white resize-none",placeholder:"Notas sobre la cita, recordatorios, etc."},null,512),[[se,o(s).notas]])])])]),o(k)?(r(),l("div",qs,[e("div",Os,[c(o(Ie),{class:"w-6 h-6 text-yellow-600 flex-shrink-0 mt-0.5"}),t[61]||(t[61]=e("div",null,[e("div",{class:"font-semibold text-yellow-900 mb-1 flex items-center gap-2"},[e("span",null,"Conflicto de Horario")]),e("div",{class:"text-sm text-yellow-800"}," Ya existe una cita en este horario. Verifica la disponibilidad. ")],-1))])])):d("",!0),o(L).length>0&&!o(E)?(r(),l("div",Rs,[e("div",Js,[c(o(Te),{class:"w-6 h-6 text-red-600 flex-shrink-0 mt-0.5"}),e("div",null,[t[67]||(t[67]=e("div",{class:"font-semibold text-red-900 mb-2"}," Completa los campos obligatorios ",-1)),e("ul",Ks,[o(s).paciente_id?d("",!0):(r(),l("li",Gs,[...t[62]||(t[62]=[e("span",{class:"w-1.5 h-1.5 rounded-full bg-red-500"},null,-1),e("span",null,"Selecciona un paciente",-1)])])),o(s).fecha?d("",!0):(r(),l("li",Ys,[...t[63]||(t[63]=[e("span",{class:"w-1.5 h-1.5 rounded-full bg-red-500"},null,-1),e("span",null,"Selecciona una fecha",-1)])])),o(s).hora_inicio?d("",!0):(r(),l("li",Xs,[...t[64]||(t[64]=[e("span",{class:"w-1.5 h-1.5 rounded-full bg-red-500"},null,-1),e("span",null,"Selecciona la hora de inicio",-1)])])),o(s).tipo?d("",!0):(r(),l("li",Qs,[...t[65]||(t[65]=[e("span",{class:"w-1.5 h-1.5 rounded-full bg-red-500"},null,-1),e("span",null,"Selecciona el tipo de sesi√≥n",-1)])])),o(s).estado?d("",!0):(r(),l("li",Ws,[...t[66]||(t[66]=[e("span",{class:"w-1.5 h-1.5 rounded-full bg-red-500"},null,-1),e("span",null,"Selecciona el estado de la cita",-1)])]))])])])])):d("",!0),o(E)&&!o(k)?(r(),l("div",Zs,[e("div",ea,[c(o(ae),{class:"w-6 h-6 text-blue-600 flex-shrink-0 mt-0.5"}),e("div",ta,[t[75]||(t[75]=e("div",{class:"font-semibold text-blue-900 mb-3"}," Resumen de la Cita ",-1)),e("div",oa,[e("div",null,[t[68]||(t[68]=e("span",{class:"text-blue-600 font-medium"},"Paciente:",-1)),e("div",sa,i(o(s).paciente_nombre),1)]),e("div",null,[t[69]||(t[69]=e("span",{class:"text-blue-600 font-medium"},"Fecha:",-1)),e("div",aa,i(J(o(s).fecha)),1)]),e("div",null,[t[70]||(t[70]=e("span",{class:"text-blue-600 font-medium"},"Horario:",-1)),e("div",na,i(o(s).hora_inicio)+" - "+i(o(s).hora_fin),1)]),e("div",null,[t[71]||(t[71]=e("span",{class:"text-blue-600 font-medium"},"Duraci√≥n:",-1)),e("div",ra,i(o(s).duracion)+" minutos",1)]),e("div",null,[t[72]||(t[72]=e("span",{class:"text-blue-600 font-medium"},"Tipo:",-1)),e("div",la,i(o(s).tipo),1)]),e("div",null,[t[73]||(t[73]=e("span",{class:"text-blue-600 font-medium"},"Estado:",-1)),e("div",ia,i(o(s).estado),1)]),o(s).descontar_de_bono?(r(),l("div",da,[c(o(ue),{class:"w-5 h-5 text-blue-600"}),t[74]||(t[74]=e("div",null,[e("span",{class:"text-blue-600 font-medium"},"Bono:"),e("span",{class:"text-blue-900 ml-2"},"Se descontar√° 1 sesi√≥n del bono activo")],-1))])):d("",!0)])])])])):d("",!0),e("div",ca,[e("button",{type:"button",onClick:U,class:"flex-1 px-6 py-3 border-2 border-[#5550F2] text-[#2D3748] rounded-lg hover:bg-[#5550F2]/10 transition-colors font-medium","aria-label":"Cancelar creaci√≥n de cita"}," Cancelar "),e("div",ua,[e("button",{type:"submit",disabled:!o(E)||o(w)||o(k),class:_(["w-full px-6 py-3 rounded-lg transition-all font-medium text-white",o(E)&&!o(w)&&!o(k)?"bg-[#5550F2] hover:bg-[#5550F2]/90 hover:shadow-lg cursor-pointer":"bg-gray-400 cursor-not-allowed opacity-60"]),"aria-label":o(E)?"Guardar cita":"Completa todos los campos requeridos para guardar",onMouseenter:Xe},i(o(w)?"Guardando...":"‚úì Guardar Cita"),43,ma),!o(E)&&!o(w)?(r(),l("div",pa," Completa todos los campos obligatorios (*) ")):d("",!0)])])],32)]),c(ct,{name:"slide-up"},{default:dt(()=>[o($)?(r(),l("div",{key:0,class:_(["fixed bottom-6 right-6 max-w-md rounded-lg shadow-2xl p-4 z-[60]",o(H)==="exito"?"bg-gradient-to-r from-green-500 to-emerald-500":o(H)==="error"?"bg-gradient-to-r from-red-500 to-rose-500":"bg-gradient-to-r from-blue-500 to-indigo-500"])},[e("div",ba,[e("div",fa,i(o(H)==="exito"?"‚úÖ":o(H)==="error"?"‚ùå":"‚ÑπÔ∏è"),1),e("div",va,[e("div",xa,i(o(ie)),1),e("div",ha,i(o(de)),1),o(W).length>0?(r(),l("div",ga,[(r(!0),l(T,null,j(o(W),(a,f)=>(r(),l("button",{key:f,onClick:a.accion,class:"px-3 py-1.5 bg-white/20 hover:bg-white/30 rounded text-sm font-medium transition-all"},i(a.texto),9,_a))),128))])):d("",!0)]),e("button",{onClick:t[12]||(t[12]=a=>$.value=!1),class:"text-white/80 hover:text-white transition-colors"}," ‚úï ")])],2)):d("",!0)]),_:1})])):d("",!0)}}),Va=Object.assign(ft(wa,[["__scopeId","data-v-adfaa88c"]]),{__name:"ModalNuevaCita"});export{Va as _};
