import{e as U,q as I,c as r,a as e,t as v,y as E,d as q,o as n,r as T,b as H,g as w,j as X,v as ae,T as ue,w as ge,z as se,F as O,s as z,A as ne,i as R,f as de,B as ce,C as j,h as ve,x as B,k as te,D as re,E as oe,G as pe,H as me,I as be}from"#entry";import{u as fe}from"./DJWGcah7.js";import{_ as Y}from"./DlAUqK2U.js";import{s as he}from"./BzLCLO6P.js";import{_ as ye}from"./MsYoDEnI.js";import{_ as ke}from"./03NUMCcA.js";import{M as xe}from"./JG5qHoIo.js";import"./Cy0_MzJF.js";import"./BqC9m6KG.js";import"./C9M7zbam.js";import"./Bi0YyG7H.js";import"./mZ3toP8Y.js";import"./DRclOuRO.js";import"./B5My0XuL.js";import"./G1mM6o1b.js";import"./BreoAuwB.js";import"./Byc3y-S3.js";import"./CQZt9cKZ.js";import"./BaRJRhc1.js";import"./DWNj0d99.js";import"./Dyh9f5zH.js";const le={pendiente:{border:"border-amber-200 dark:border-amber-800",bg:"bg-white dark:bg-zinc-800",badge:"bg-amber-400 dark:bg-amber-500",dot:"bg-amber-400 dark:bg-amber-500",hover:"hover:bg-amber-50 dark:hover:bg-amber-950/20"},confirmada:{border:"border-emerald-200 dark:border-emerald-800",bg:"bg-white dark:bg-zinc-800",badge:"bg-emerald-400 dark:bg-emerald-500",dot:"bg-emerald-400 dark:bg-emerald-500",hover:"hover:bg-emerald-50 dark:hover:bg-emerald-950/20"},cancelada:{border:"border-rose-200 dark:border-rose-800",bg:"bg-white dark:bg-zinc-800",badge:"bg-rose-400 dark:bg-rose-500",dot:"bg-rose-400 dark:bg-rose-500",hover:"hover:bg-rose-50 dark:hover:bg-rose-950/20"},realizada:{border:"border-blue-200 dark:border-blue-800",bg:"bg-white dark:bg-zinc-800",badge:"bg-blue-400 dark:bg-blue-500",dot:"bg-blue-400 dark:bg-blue-500",hover:"hover:bg-blue-50 dark:hover:bg-blue-950/20"}},we=l=>new Date(l+"T00:00:00").toLocaleDateString("es-ES",{day:"2-digit",month:"long",year:"numeric"}),ie=l=>new Date(l+"T00:00:00").toLocaleDateString("es-ES",{month:"long",year:"numeric"}),_e=l=>new Date(l+"T00:00:00").toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"short"}),Ce=l=>{const b=new Date(l+"T00:00:00"),s=new Date(b.getFullYear(),0,1),C=b.getTime()-s.getTime(),g=1e3*60*60*24;return Math.ceil((C/g+s.getDay()+1)/7)},De=(l,b)=>{const s=typeof b=="string"?b:b.toISOString().split("T")[0];switch(l){case"dia":return we(s);case"semana":return`${ie(s)} ‚Äî Semana ${Ce(s)}`;case"mes":return ie(s);default:return""}},Se=(l="08:00",b="20:00",s=30)=>{const C=[],[g,A]=l.split(":").map(Number),[F,D]=b.split(":").map(Number);let h=g,_=A;for(;h<F||h===F&&_<D;)C.push(`${String(h).padStart(2,"0")}:${String(_).padStart(2,"0")}`),_+=s,_>=60&&(h++,_-=60);return C},$e=(l,b)=>{const s=new Date(l+"T00:00:00");return s.setDate(s.getDate()+b),s.toISOString().split("T")[0]},Te=l=>{const b=new Date(l+"T00:00:00"),s=b.getDay(),C=s===0?-6:1-s;return b.setDate(b.getDate()+C),b.toISOString().split("T")[0]},Ie={class:"sticky top-0 z-20 bg-white/70 dark:bg-gray-950/70 backdrop-blur-md border-b border-cafe/10 dark:border-gray-800 shadow-sm"},Ae={class:"px-4 py-2.5 sm:px-6 lg:px-6"},Me={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3"},Fe={class:"flex items-center gap-2.5"},Ee={class:"text-lg sm:text-xl font-serif font-bold text-cafe dark:text-gray-100 ml-1"},Oe={class:"flex items-center gap-2.5 w-full sm:w-auto"},ze={class:"flex border border-cafe/20 dark:border-gray-700 rounded-xl overflow-hidden shadow-xs"},Le=["aria-label"],Ne={key:0,class:"text-lg"},Pe={key:1,class:"text-lg"},qe=U({__name:"AgendaHeader",props:{vista:{},fechaActual:{},darkMode:{type:Boolean}},emits:["update:vista","update:fechaActual","update:darkMode","nueva-cita"],setup(l,{emit:b}){const s=l,C=b,g=I(()=>De(s.vista,s.fechaActual)),A=()=>{C("update:fechaActual",new Date)},F=()=>{const p=new Date(s.fechaActual);s.vista==="dia"?p.setDate(p.getDate()-1):s.vista==="semana"?p.setDate(p.getDate()-7):s.vista==="mes"&&p.setMonth(p.getMonth()-1),C("update:fechaActual",p)},D=()=>{const p=new Date(s.fechaActual);s.vista==="dia"?p.setDate(p.getDate()+1):s.vista==="semana"?p.setDate(p.getDate()+7):s.vista==="mes"&&p.setMonth(p.getMonth()+1),C("update:fechaActual",p)},h=p=>{C("update:vista",p)},_=()=>{C("update:darkMode",!s.darkMode)},x=()=>{C("nueva-cita")};return(p,y)=>(n(),r("header",Ie,[e("div",Ae,[e("div",Me,[e("div",Fe,[e("div",{class:"flex items-center gap-0.5"},[e("button",{onClick:F,class:"px-2.5 py-1.5 border border-cafe/20 dark:border-gray-700 rounded-lg hover:bg-purple-600/10 dark:hover:bg-gray-800 hover:border-purple-600 transition-all duration-200","aria-label":"Periodo anterior"},[...y[3]||(y[3]=[e("svg",{class:"w-4 h-4 text-cafe dark:text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),e("button",{onClick:A,class:"px-3.5 py-1.5 mx-1 border border-cafe/20 dark:border-gray-700 rounded-lg hover:bg-purple-600/10 dark:hover:bg-gray-800 hover:border-purple-600 transition-all duration-200 text-sm font-medium text-cafe dark:text-gray-300"}," Hoy "),e("button",{onClick:D,class:"px-2.5 py-1.5 border border-cafe/20 dark:border-gray-700 rounded-lg hover:bg-purple-600/10 dark:hover:bg-gray-800 hover:border-purple-600 transition-all duration-200","aria-label":"Periodo siguiente"},[...y[4]||(y[4]=[e("svg",{class:"w-4 h-4 text-cafe dark:text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])])]),e("h1",Ee,v(g.value),1)]),e("div",Oe,[e("div",ze,[e("button",{onClick:y[0]||(y[0]=M=>h("dia")),class:E(["px-3 py-1.5 text-sm font-medium transition-all duration-200",l.vista==="dia"?"bg-purple-600 text-white shadow-sm":"bg-white dark:bg-gray-900 text-cafe dark:text-gray-300 hover:bg-purple-600/10 dark:hover:bg-gray-800"]),"aria-label":"Vista de d√≠a"}," üìÖ D√≠a ",2),e("button",{onClick:y[1]||(y[1]=M=>h("semana")),class:E(["px-3 py-1.5 text-sm font-medium transition-all duration-200 border-l border-cafe/10 dark:border-gray-700",l.vista==="semana"?"bg-purple-600 text-white shadow-sm":"bg-white dark:bg-gray-900 text-cafe dark:text-gray-300 hover:bg-purple-600/10 dark:hover:bg-gray-800"]),"aria-label":"Vista de semana"}," üìÜ Semana ",2),e("button",{onClick:y[2]||(y[2]=M=>h("mes")),class:E(["px-3 py-1.5 text-sm font-medium transition-all duration-200 border-l border-cafe/10 dark:border-gray-700",l.vista==="mes"?"bg-purple-600 text-white shadow-sm":"bg-white dark:bg-gray-900 text-cafe dark:text-gray-300 hover:bg-purple-600/10 dark:hover:bg-gray-800"]),"aria-label":"Vista de mes"}," üóìÔ∏è Mes ",2)]),e("button",{onClick:_,class:"flex items-center gap-2 px-2.5 py-1.5 border border-cafe/20 dark:border-gray-700 rounded-xl hover:bg-purple-600/10 dark:hover:bg-gray-800 hover:border-purple-600 transition-all duration-200","aria-label":l.darkMode?"Desactivar modo oscuro":"Activar modo oscuro"},[l.darkMode?(n(),r("span",Ne,"üåô")):(n(),r("span",Pe,"‚òÄÔ∏è"))],8,Le),e("button",{onClick:x,class:"flex items-center gap-2 px-4 py-1.5 bg-purple-600 hover:bg-purple-600/90 text-white rounded-xl transition-all duration-200 shadow-sm hover:shadow-md font-medium text-sm"},[...y[5]||(y[5]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),q(" Nueva Cita ",-1)])])])])])]))}}),He=Object.assign(Y(qe,[["__scopeId","data-v-d4a920f6"]]),{__name:"AgendaHeader"}),Ve={class:"bg-white/60 dark:bg-gray-950/60 backdrop-blur-sm border-b border-cafe/5 dark:border-gray-800 shadow-sm"},je={class:"px-4 py-2 sm:px-6 lg:px-6 space-y-2"},Be={class:"flex items-center gap-3"},Re={class:"flex-1 relative"},Ue={key:0,class:"px-1.5 py-0.5 bg-purple-600 text-white text-xs rounded-full"},Ye={key:0,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 pt-2"},Ge=["value"],Je=["value"],Ke={class:"flex gap-2"},Ze=U({__name:"AgendaFilters",props:{filtros:{},terapeutas:{},pacientes:{}},emits:["update:filtros","update:busqueda"],setup(l,{emit:b}){const s=l,C=b,g=T(""),A=T(!1),F=[{value:"online",label:"Online",emoji:"üíª"},{value:"presencial",label:"Presencial",emoji:"üè¢"}],D=I({get:()=>s.filtros.pacienteId||"",set:$=>y("pacienteId",$||void 0)}),h=I({get:()=>s.filtros.modalidad||"",set:$=>y("modalidad",$||void 0)}),_=I({get:()=>s.filtros.fechaDesde||"",set:$=>y("fechaDesde",$||void 0)}),x=I({get:()=>s.filtros.fechaHasta||"",set:$=>y("fechaHasta",$||void 0)}),p=I(()=>{let $=0;return D.value&&$++,h.value&&$++,(_.value||x.value)&&$++,$}),y=($,m)=>{C("update:filtros",{...s.filtros,[$]:m})},M=()=>{g.value="",C("update:busqueda",""),C("update:filtros",{})},N=()=>{C("update:busqueda",g.value)};return($,m)=>(n(),r("div",Ve,[e("div",je,[e("div",Be,[e("div",Re,[X(e("input",{"onUpdate:modelValue":m[0]||(m[0]=S=>g.value=S),onInput:N,type:"text",placeholder:"Buscar por paciente, terapeuta, notas...",class:"w-full px-3 py-1.5 pl-9 text-sm border border-cafe/20 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-300 focus:border-purple-600 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-all"},null,544),[[ae,g.value]]),m[6]||(m[6]=e("svg",{class:"absolute left-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-cafe/50 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))]),e("button",{onClick:m[1]||(m[1]=S=>A.value=!A.value),class:E(["flex items-center gap-1.5 px-3 py-1.5 text-sm border border-cafe/20 dark:border-gray-700 rounded-lg hover:bg-purple-600/10 dark:hover:bg-gray-800 hover:border-purple-600 transition-all duration-200",{"bg-purple-600/10 border-purple-600 text-purple-600":p.value>0}])},[m[7]||(m[7]=e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})],-1)),m[8]||(m[8]=e("span",null,"Filtros",-1)),p.value>0?(n(),r("span",Ue,v(p.value),1)):w("",!0)],2),p.value>0||g.value?(n(),r("button",{key:0,onClick:M,class:"px-3 py-1.5 text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-950/30 rounded-lg transition-all duration-200"}," Limpiar ")):w("",!0)]),H(ue,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"opacity-0 -translate-y-2","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition duration-150 ease-in","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 -translate-y-2"},{default:ge(()=>[A.value?(n(),r("div",Ye,[e("div",null,[m[10]||(m[10]=e("label",{class:"block text-xs font-medium text-cafe/70 dark:text-gray-300 mb-1"}," Paciente ",-1)),X(e("select",{"onUpdate:modelValue":m[2]||(m[2]=S=>D.value=S),class:"w-full px-3 py-1.5 text-sm border border-cafe/20 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-300 focus:border-purple-600 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100"},[m[9]||(m[9]=e("option",{value:""},"Todos los pacientes",-1)),(n(!0),r(O,null,z(l.pacientes,S=>(n(),r("option",{key:S.id,value:S.id},v(S.nombre),9,Ge))),128))],512),[[se,D.value]])]),e("div",null,[m[12]||(m[12]=e("label",{class:"block text-xs font-medium text-cafe/70 dark:text-gray-300 mb-1"}," Modalidad ",-1)),X(e("select",{"onUpdate:modelValue":m[3]||(m[3]=S=>h.value=S),class:"w-full px-3 py-1.5 text-sm border border-cafe/20 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-300 focus:border-purple-600 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100"},[m[11]||(m[11]=e("option",{value:""},"Todas las modalidades",-1)),(n(),r(O,null,z(F,S=>e("option",{key:S.value,value:S.value},v(S.emoji)+" "+v(S.label),9,Je)),64))],512),[[se,h.value]])]),e("div",null,[m[13]||(m[13]=e("label",{class:"block text-xs font-medium text-cafe/70 dark:text-gray-300 mb-1"}," Rango de fechas ",-1)),e("div",Ke,[X(e("input",{"onUpdate:modelValue":m[4]||(m[4]=S=>_.value=S),type:"date",class:"flex-1 px-3 py-1.5 text-sm border border-cafe/20 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-300 focus:border-purple-600 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100"},null,512),[[ae,_.value]]),X(e("input",{"onUpdate:modelValue":m[5]||(m[5]=S=>x.value=S),type:"date",class:"flex-1 px-3 py-1.5 text-sm border border-cafe/20 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-300 focus:border-purple-600 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100"},null,512),[[ae,x.value]])])])])):w("",!0)]),_:1})])]))}}),Xe=Object.assign(Y(Ze,[["__scopeId","data-v-b7fec026"]]),{__name:"AgendaFilters"}),Qe={class:"flex flex-wrap gap-2 items-center py-1.5"},We={class:"text-base"},ea=U({__name:"AgendaLegend",setup(l){const b=[{key:"pendiente",label:"Pendiente",emoji:"üü°",bgClass:"bg-yellow-100",textClass:"text-yellow-800"},{key:"confirmada",label:"Confirmada",emoji:"üü¢",bgClass:"bg-green-100",textClass:"text-green-700"},{key:"realizada",label:"Realizada",emoji:"üîµ",bgClass:"bg-blue-100",textClass:"text-blue-700"},{key:"cancelada",label:"Cancelada",emoji:"üî¥",bgClass:"bg-red-100",textClass:"text-red-700"}];return(s,C)=>(n(),r("div",Qe,[(n(),r(O,null,z(b,g=>e("div",{key:g.key,class:E(["flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium transition-all duration-200 hover:scale-105",g.bgClass,g.textClass])},[e("span",We,v(g.emoji),1),e("span",null,v(g.label),1)],2)),64))]))}}),aa=Object.assign(Y(ea,[["__scopeId","data-v-5f57fa35"]]),{__name:"AgendaLegend"}),ta=["data-estado","data-compact","draggable","title","onKeydown"],oa={class:"hora"},sa={class:"nombre"},na={key:0,class:"info-adicional"},ra={key:0,class:"modalidad"},la={key:0},ia={key:1},da={key:1,class:"area"},ca=["data-color"],ua={key:3,class:"indicadores"},ga={key:0,title:"Tiene notas"},va=["title"],pa=U({__name:"AgendaEventCard",props:{event:{},compact:{type:Boolean},draggable:{type:Boolean}},emits:["open","menu"],setup(l,{emit:b}){const s=l,C=b;I(()=>le[s.event.estado]||le.cancelada);const g=I(()=>`${s.event.horaInicio} ‚Äì ${s.event.horaFin}`),A=I(()=>s.event.horaInicio),F=I(()=>s.event.pacienteNombre||"Paciente sin nombre");I(()=>({pendiente:"üü°",confirmada:"üü¢",cancelada:"üî¥",completada:"‚ö™",realizada:"üîµ"})[s.event.estado]||"‚ö™");const D=I(()=>s.event.bono&&s.event.bono.sesionesRestantes!==void 0),h=I(()=>{if(!s.event.bono)return"green";const p=s.event.bono.sesionesRestantes||0;return p===0?"red":p===1?"orange":p<=2?"yellow":"green"}),_=()=>{C("open",s.event.id)},x=p=>{p.stopPropagation(),C("menu",s.event.id,p)};return(p,y)=>(n(),r("div",{class:"agenda-event group","data-estado":l.event.estado,"data-compact":l.compact,draggable:l.draggable,role:"button",tabindex:"0",title:`${F.value} - ${g.value}`,onClick:_,onKeydown:[ne(_,["enter"]),ne(R(_,["prevent"]),["space"])]},[e("div",{class:E(["flex flex-col justify-center",l.compact?"gap-0.5":"gap-1"])},[e("span",oa,v(l.compact?A.value:g.value),1),e("span",sa,[y[0]||(y[0]=e("span",{class:"estado-dot"},null,-1)),q(" "+v(F.value),1)]),l.compact?w("",!0):(n(),r("div",na,[l.event.modalidad?(n(),r("span",ra,[l.event.modalidad==="online"?(n(),r("span",la,"üíª")):(n(),r("span",ia,"üè•")),q(" "+v(l.event.modalidad==="online"?"Online":"Presencial"),1)])):w("",!0),l.event.areaTerapeutica?(n(),r("span",da,v(l.event.areaTerapeutica),1)):w("",!0),D.value?(n(),r("span",{key:2,class:"bono-info","data-color":h.value},v(l.event.bono.sesionesRestantes)+"/"+v(l.event.bono.sesionesTotales)+" sesiones ",9,ca)):w("",!0),l.event.notas||l.event.terapeuta?(n(),r("div",ua,[l.event.notas?(n(),r("span",ga,"üìù")):w("",!0),l.event.terapeuta?(n(),r("span",{key:1,title:`Terapeuta: ${l.event.terapeuta.nombre}`},"üë§",8,va)):w("",!0)])):w("",!0)]))],2),l.compact?w("",!0):(n(),r("button",{key:0,onClick:R(x,["stop"]),class:"menu-btn","aria-label":"Abrir men√∫ de acciones",type:"button"},[...y[1]||(y[1]=[e("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"})],-1)])]))],40,ta))}}),ma=Object.assign(Y(pa,[["__scopeId","data-v-6533b09f"]]),{__name:"AgendaEventCard"}),ba={class:"flex-1 flex flex-col overflow-hidden bg-[#FFF9F6] dark:bg-gray-900"},fa={key:0,class:"flex items-center justify-center h-full"},ha={key:1,class:"agenda-controls"},ya={class:"zoom-toggle"},ka={key:2,class:"agenda-container"},xa={class:"texto-tiempo"},wa=["onClick"],_a={class:"hora-dia"},Ca={class:"eventos-container"},Da=["data-estado","onClick"],Sa={class:"hora"},$a={class:"nombre"},Ta={key:0,class:"info-extra"},Ia={key:0,class:"text-[10px]"},Aa={key:1,class:"text-[10px] text-cafe/60"},Ma={class:"tooltip"},Fa={class:"font-semibold"},Ea={key:0},Oa={key:1,class:"text-[10px] opacity-80"},za={key:3,class:"agenda-container"},La={class:"agenda-days"},Na={class:"text-xs font-medium text-cafe/70"},Pa={class:"text-sm font-bold text-cafe"},qa={class:"texto-tiempo"},Ha={class:"agenda-hours"},Va=["onClick"],ja=["data-estado","onClick"],Ba={class:"hora"},Ra={class:"nombre"},Ua={class:"tooltip"},Ya={class:"font-semibold"},Ga={key:0},Ja={key:1,class:"text-[10px] opacity-80"},Ka={key:4,class:"agenda-mes-container"},Za={class:"agenda-mes-grid"},Xa=["data-fecha","onClick"],Qa={class:"agenda-dia-header"},Wa={class:"dia-numero"},et={class:"flex items-center gap-1"},at=["title"],tt={key:1,class:"dia-hoy-badge"},ot={class:"agenda-dia-eventos"},st=["onClick","title"],nt=U({__name:"AgendaGrid",props:{eventos:{},vista:{},fechaActual:{},cargando:{type:Boolean},draggable:{type:Boolean}},emits:["evento-click","evento-menu","slot-click","evento-drop"],setup(l,{emit:b}){const s=l,C=b;T(null);const g=T("normal"),A=T(null),F=T("0px"),D=T(!1),h=T(new Set);let _=null;const x=Se("08:00","22:30",30);I(()=>{switch(g.value){case"compact":return"h-8";case"normal":return"h-10";case"comfortable":return"h-16";default:return"h-10"}});{const d=localStorage.getItem("agenda_zoom");d&&["compact","normal","comfortable"].includes(d)&&(g.value=d)}const p=d=>{g.value=d,localStorage.setItem("agenda_zoom",d)},y=I(()=>{const d=s.fechaActual.toISOString().split("T")[0];if(s.vista==="dia")return[d];if(s.vista==="semana"){const i=Te(d);return Array.from({length:7},(o,f)=>$e(i,f))}else{const i=new Date(s.fechaActual.getFullYear(),s.fechaActual.getMonth(),1),o=new Date(s.fechaActual.getFullYear(),s.fechaActual.getMonth()+1,0);let f=i.getDay();f=f===0?6:f-1;let u=o.getDay();u=u===0?6:u-1;const k=[];for(let t=f-1;t>=0;t--){const c=new Date(i);c.setDate(c.getDate()-(t+1)),k.push(c.toISOString().split("T")[0])}for(let t=new Date(i);t<=o;t.setDate(t.getDate()+1))k.push(t.toISOString().split("T")[0]);const a=6-u;for(let t=1;t<=a;t++){const c=new Date(o);c.setDate(c.getDate()+t),k.push(c.toISOString().split("T")[0])}return k}}),M=I(()=>{const d=new Map;return s.eventos.forEach(i=>{const o=i.fecha;d.has(o)||d.set(o,[]),d.get(o).push(i)}),d.forEach((i,o)=>{i.sort((f,u)=>f.horaInicio.localeCompare(u.horaInicio))}),d}),N=(d,i)=>{C("slot-click",{date:d,horaInicio:i})},$=(d,i)=>(M.value.get(d)||[]).filter(f=>f.horaInicio===i),m=d=>{const i=new Date().toISOString().split("T")[0];return d===i},S=d=>{const i=new Date(d+"T00:00:00");return i.getMonth()===s.fechaActual.getMonth()&&i.getFullYear()===s.fechaActual.getFullYear()},V=(d,i)=>{try{const o=new Date(`1970-01-01T${d}:00`),u=(new Date(`1970-01-01T${i}:00`).getTime()-o.getTime())/6e4,t=(g.value==="compact"?2.25:g.value==="normal"?3.5:5)/30;return`${u*t}rem`}catch{return"2.5rem"}},ee=(d,i)=>{try{const o=new Date(`1970-01-01T${d}:00`),f=new Date(`1970-01-01T${i}:00`),u=(o.getTime()-f.getTime())/6e4;if(u<=0)return"0";const a=(g.value==="compact"?2.25:g.value==="normal"?3.5:5)/30;return`${u*a}rem`}catch{return"0"}},G=async()=>{if(await re(),!A.value||s.cargando)return;const d=new Date,i=`${String(d.getHours()).padStart(2,"0")}:${String(Math.floor(d.getMinutes()/30)*30).padStart(2,"0")}`,o=x.findIndex(f=>f>=i);if(o!==-1){const f=g.value==="compact"?40:g.value==="normal"?56:80,u=Math.max(0,(o-2)*f);A.value.scrollTop=u}},Q=async()=>{if(await re(),s.vista!=="mes")return;const d=new Date().toISOString().split("T")[0],i=document.querySelector(".agenda-mes-grid"),o=document.querySelector(`[data-fecha="${d}"]`);o&&i&&o.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})},W=()=>{const d=new Date,i=8,o=22.5,f=d.getHours()+d.getMinutes()/60;if(f>=i&&f<=o){D.value=!0;const u=(d.getHours()-i)*60+d.getMinutes(),a=(g.value==="compact"?40:g.value==="normal"?56:80)/30,t=u*a;F.value=`${Math.round(t)}px`}else D.value=!1;P()},P=()=>{const d=new Date,i=new Set;s.eventos.forEach(o=>{try{const f=o.fecha,[u,k]=o.horaInicio.split(":").map(Number),[a,t]=o.horaFin.split(":").map(Number),c=new Date(f+"T"+o.horaInicio+":00"),K=new Date(f+"T"+o.horaFin+":00");d>=c&&d<=K&&i.add(o.id)}catch{}}),h.value=i},J=d=>h.value.has(d);return de(()=>{s.vista==="mes"?Q():G(),W(),_=he(W,6e4)}),ce(()=>{_&&(clearInterval(_),_=null)}),j([()=>s.vista,()=>s.cargando,g],()=>{s.cargando||setTimeout(()=>{s.vista==="mes"?Q():G()},100)}),(d,i)=>(n(),r("div",ba,[l.cargando?(n(),r("div",fa,[...i[3]||(i[3]=[e("div",{class:"text-center space-y-3"},[e("div",{class:"w-12 h-12 border-4 border-purple-600/20 border-t-purple-600 rounded-full animate-spin mx-auto"}),e("p",{class:"text-cafe/60 dark:text-gray-400"},"Cargando agenda...")],-1)])])):w("",!0),l.cargando?w("",!0):(n(),r("div",ha,[i[5]||(i[5]=ve('<div class="leyenda-estados" data-v-f5014433><div class="estado" data-v-f5014433><span class="dot" data-color="pendiente" data-v-f5014433></span><span data-v-f5014433>Pendiente</span></div><div class="estado" data-v-f5014433><span class="dot" data-color="confirmada" data-v-f5014433></span><span data-v-f5014433>Confirmada</span></div><div class="estado" data-v-f5014433><span class="dot" data-color="realizada" data-v-f5014433></span><span data-v-f5014433>Realizada</span></div><div class="estado" data-v-f5014433><span class="dot" data-color="cancelada" data-v-f5014433></span><span data-v-f5014433>Cancelada</span></div></div>',1)),e("div",ya,[i[4]||(i[4]=e("span",{class:"text-xs text-cafe/60"},"Zoom:",-1)),e("button",{onClick:i[0]||(i[0]=o=>p("compact")),class:E(["px-2 py-1 rounded-md transition-all",g.value==="compact"?"bg-purple-600 text-white":"hover:bg-purple-600/10"])}," Compacto ",2),e("button",{onClick:i[1]||(i[1]=o=>p("normal")),class:E(["px-2 py-1 rounded-md transition-all",g.value==="normal"?"bg-purple-600 text-white":"hover:bg-purple-600/10"])}," Normal ",2),e("button",{onClick:i[2]||(i[2]=o=>p("comfortable")),class:E(["px-2 py-1 rounded-md transition-all",g.value==="comfortable"?"bg-purple-600 text-white":"hover:bg-purple-600/10"])}," C√≥modo ",2)])])),!l.cargando&&l.vista==="dia"?(n(),r("div",ka,[e("div",{ref_key:"gridContainer",ref:A,class:"agenda-grid-dia"},[D.value?(n(),r("div",{key:0,class:"linea-tiempo-actual",style:B({top:F.value})},[i[6]||(i[6]=e("div",{class:"circulo-tiempo"},null,-1)),e("div",xa,v(new Date().toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})),1)],4)):w("",!0),(n(!0),r(O,null,z(te(x),(o,f)=>(n(),r("div",{key:o,class:E(["agenda-cell-dia",f%2===0?"bg-white":"bg-[#FFFAF7]"]),style:B({minHeight:g.value==="compact"?"2.5rem":g.value==="normal"?"3.5rem":"5rem"}),onClick:u=>N(y.value[0],o)},[e("div",_a,v(o),1),e("div",Ca,[(n(!0),r(O,null,z($(y.value[0],o),(u,k)=>(n(),r("div",{key:`${u.id}-${k}`,class:E(["agenda-event-dia",{"cita-activa":J(u.id)}]),"data-estado":u.estado,style:B({"--event-height":V(u.horaInicio,u.horaFin)}),onClick:R(a=>d.$emit("evento-click",u.id),["stop"])},[e("span",Sa,v(u.horaInicio)+" - "+v(u.horaFin),1),e("span",$a,v(u.pacienteNombre),1),g.value!=="compact"?(n(),r("div",Ta,[u.modalidad?(n(),r("span",Ia,v(u.modalidad==="online"?"üíª":"üè•"),1)):w("",!0),u.areaTerapeutica?(n(),r("span",Aa,v(u.areaTerapeutica),1)):w("",!0)])):w("",!0),e("div",Ma,[e("div",Fa,v(u.pacienteNombre),1),e("div",null,v(u.horaInicio)+" - "+v(u.horaFin),1),u.modalidad?(n(),r("div",Ea,v(u.modalidad==="online"?"üíª Online":"üè• Presencial"),1)):w("",!0),u.areaTerapeutica?(n(),r("div",Oa,v(u.areaTerapeutica),1)):w("",!0)])],14,Da))),128))])],14,wa))),128))],512)])):w("",!0),!l.cargando&&l.vista==="semana"?(n(),r("div",za,[e("div",La,[i[7]||(i[7]=e("div",{class:"col-span-1"},null,-1)),(n(!0),r(O,null,z(y.value,o=>(n(),r("div",{key:o,class:E(["py-2 px-1",m(o)?"bg-purple-600/5 border-b-2 border-purple-600":""])},[e("div",Na,v(te(_e)(o).split(",")[0]),1),e("div",Pa,v(new Date(o+"T00:00:00").getDate()),1)],2))),128))]),e("div",{ref_key:"gridContainer",ref:A,class:"agenda-grid"},[D.value?(n(),r("div",{key:0,class:"linea-tiempo-actual",style:B({top:F.value,left:"0",right:"0",gridColumn:"1 / -1"})},[i[8]||(i[8]=e("div",{class:"circulo-tiempo"},null,-1)),e("div",qa,v(new Date().toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})),1)],4)):w("",!0),(n(!0),r(O,null,z(te(x),(o,f)=>(n(),r(O,{key:o},[e("div",Ha,v(o),1),(n(!0),r(O,null,z(y.value,u=>(n(),r("div",{key:`${u}-${o}`,class:E(["agenda-cell",f%2===0?"bg-white":"bg-[#FFFAF7]"]),onClick:k=>N(u,o)},[(n(!0),r(O,null,z($(u,o),k=>(n(),r("div",{key:k.id,class:E(["agenda-event",{"cita-activa":J(k.id)}]),"data-estado":k.estado,style:B({"--event-height":V(k.horaInicio,k.horaFin),top:ee(k.horaInicio,o)}),onClick:R(a=>d.$emit("evento-click",k.id),["stop"])},[e("span",Ba,v(k.horaInicio)+" - "+v(k.horaFin),1),e("span",Ra,v(k.pacienteNombre),1),e("div",Ua,[e("div",Ya,v(k.pacienteNombre),1),e("div",null,v(k.horaInicio)+" - "+v(k.horaFin),1),k.modalidad?(n(),r("div",Ga,v(k.modalidad==="online"?"üíª Online":"üè• Presencial"),1)):w("",!0),k.areaTerapeutica?(n(),r("div",Ja,v(k.areaTerapeutica),1)):w("",!0)])],14,ja))),128))],10,Va))),128))],64))),128))],512)])):w("",!0),!l.cargando&&l.vista==="mes"?(n(),r("div",Ka,[e("div",Za,[(n(),r(O,null,z(["Lun","Mar","Mi√©","Jue","Vie","S√°b","Dom"],o=>e("div",{key:o,class:"agenda-mes-header"},v(o),1)),64)),(n(!0),r(O,null,z(y.value,o=>(n(),r("div",{key:o,"data-fecha":o,class:E(["agenda-dia-mes",[m(o)?"dia-hoy":"",S(o)?"":"dia-otro-mes"]]),onClick:f=>N(o,"09:00")},[e("div",Qa,[e("span",Wa,v(new Date(o+"T00:00:00").getDate()),1),e("div",et,[(M.value.get(o)||[]).length>0?(n(),r("span",{key:0,class:"contador-citas",title:`${(M.value.get(o)||[]).length} cita${(M.value.get(o)||[]).length>1?"s":""}`},v((M.value.get(o)||[]).length),9,at)):w("",!0),m(o)?(n(),r("span",tt,"Hoy")):w("",!0)])]),e("div",ot,[(n(!0),r(O,null,z((M.value.get(o)||[]).slice(0,2),f=>(n(),oe(ma,{key:f.id,event:f,compact:!0,onOpen:u=>d.$emit("evento-click",f.id)},null,8,["event","onOpen"]))),128)),(M.value.get(o)||[]).length>2?(n(),r("button",{key:0,class:"mas-eventos",onClick:R(f=>N(o,"09:00"),["stop"]),title:`Ver todas las ${(M.value.get(o)||[]).length} citas de este d√≠a`}," +"+v((M.value.get(o)||[]).length-2)+" m√°s ",9,st)):w("",!0)])],10,Xa))),128))])])):w("",!0)]))}}),rt=Object.assign(Y(nt,[["__scopeId","data-v-f5014433"]]),{__name:"AgendaGrid"}),lt={class:"px-4 py-2 bg-white/60 dark:bg-gray-950/60 backdrop-blur-sm border-b border-cafe/5 dark:border-gray-800"},it=U({__name:"index",props:{legacyFallback:{type:Boolean}},setup(l){const b=pe(),s=me(),{getCitasRango:C}=fe(),g=T([]),A=T(!1),F=T(null),D=T("semana"),h=T(new Date),_=T(!1),x=T({}),p=T(""),y=T(!1),M=T(!1),N=T(null),$=T(null),m=T(!1),S=T({x:0,y:0}),V=T(null),ee=I(()=>g.value?.length?g.value.map(a=>({id:a.cita_id||a.id,pacienteNombre:a.paciente_nombre||"Sin paciente",pacienteId:a.paciente_id,estado:a.estado,fecha:a.fecha_cita,horaInicio:a.hora_inicio?.substring(0,5)||a.hora_inicio,horaFin:a.hora_fin?.substring(0,5)||a.hora_fin,modalidad:a.modalidad,bono:a.bono_id?{id:a.bono_id,sesionesRestantes:a.bono_sesiones_restantes,sesionesTotales:a.bono_sesiones_totales}:null,terapeuta:a.terapeuta_id?{id:a.terapeuta_id,nombre:a.terapeuta_nombre}:void 0,notas:a.observaciones||void 0,areaTerapeutica:a.paciente_area||void 0,tipoSesion:a.tipo_sesion||void 0})):[]),G=I(()=>{let a=ee.value;if(p.value.trim()){const t=p.value.toLowerCase();a=a.filter(c=>c.pacienteNombre.toLowerCase().includes(t)||c.terapeuta?.nombre.toLowerCase().includes(t)||c.notas?.toLowerCase().includes(t))}return x.value.estados?.length&&(a=a.filter(t=>x.value.estados.includes(t.estado))),x.value.terapeutaId&&(a=a.filter(t=>t.terapeuta?.id===x.value.terapeutaId)),x.value.pacienteId&&(a=a.filter(t=>t.pacienteId===x.value.pacienteId)),x.value.modalidad&&(a=a.filter(t=>t.modalidad===x.value.modalidad)),x.value.fechaDesde&&(a=a.filter(t=>t.fecha>=x.value.fechaDesde)),x.value.fechaHasta&&(a=a.filter(t=>t.fecha<=x.value.fechaHasta)),a}),Q=I(()=>[]),W=I(()=>{const a=new Map;return g.value?.forEach(t=>{t.paciente_id&&a.set(t.paciente_id,{id:t.paciente_id,nombre:t.paciente_nombre||"Sin nombre"})}),Array.from(a.values())}),P=async()=>{try{A.value=!0,F.value=null;const a=new Date;let t,c;if(D.value==="dia")t=c=h.value.toISOString().split("T")[0];else if(D.value==="semana"){const L=new Date(h.value);L.setDate(L.getDate()-L.getDay()),t=L.toISOString().split("T")[0];const Z=new Date(L);Z.setDate(Z.getDate()+6),c=Z.toISOString().split("T")[0]}else{const L=new Date(h.value.getFullYear(),h.value.getMonth(),1),Z=new Date(h.value.getFullYear(),h.value.getMonth()+1,0);t=L.toISOString().split("T")[0],c=Z.toISOString().split("T")[0]}const K=await C(t,c);g.value=K.filter(L=>L.estado!=="cancelada"&&L.estado!=="borrador"&&L.estado!==null)}catch(a){console.error("‚ùå Error al cargar citas:",a),F.value=a.message}finally{A.value=!1}};de(async()=>{await P();{const a=localStorage.getItem("agenda:vista");a&&(D.value=a);const t=localStorage.getItem("agenda:darkMode");t&&(_.value=t==="true");const c=localStorage.getItem("agenda:filtros");if(c)try{x.value=JSON.parse(c)}catch(K){console.error("Error parsing saved filters",K)}_.value&&document.documentElement.classList.add("dark"),window.addEventListener("citas:actualizadas",J),console.log("‚úÖ [Agenda] Listener de eventos globales registrado")}b.query.vista&&(D.value=b.query.vista),b.query.fecha&&(h.value=new Date(b.query.fecha)),b.query.paciente&&(x.value={...x.value,pacienteId:b.query.paciente},console.log("‚úÖ [Agenda] Filtro de paciente aplicado:",b.query.paciente))}),ce(()=>{window.removeEventListener("citas:actualizadas",J),console.log("üßπ [Agenda] Listener de eventos globales removido")});function J(a){const t=a;console.log("üì° [Agenda] Evento recibido:",t.detail),P(),t.detail?.paciente_nombre&&console.log(`‚úÖ Cita actualizada: ${t.detail.paciente_nombre}`)}j(D,a=>{localStorage.setItem("agenda:vista",a),s.push({query:{...b.query,vista:a}}),P()}),j(h,()=>{P()}),j(h,a=>{{const t=a.toISOString().split("T")[0];s.push({query:{...b.query,fecha:t}})}}),j(_,a=>{localStorage.setItem("agenda:darkMode",String(a)),a?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}),j(x,a=>{localStorage.setItem("agenda:filtros",JSON.stringify(a))},{deep:!0});const d=()=>{$.value=null,y.value=!0},i=a=>{if(G.value.some(c=>c.fecha===a.date&&c.horaInicio===a.horaInicio)){{const c=document.createElement("div");c.className="fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-[9999] animate-slide-in",c.innerHTML=`
        <div class="flex items-center gap-3">
          <span class="text-2xl">‚ö†Ô∏è</span>
          <div>
            <div class="font-semibold">Horario ocupado</div>
            <div class="text-sm opacity-90">Ya existe una cita en este horario</div>
          </div>
        </div>
      `,document.body.appendChild(c),setTimeout(()=>{c.classList.add("animate-fade-out"),setTimeout(()=>c.remove(),300)},3e3)}return}$.value=a,y.value=!0},o=a=>{N.value=a,M.value=!0},f=(a,t)=>{V.value=a,S.value={x:t.clientX,y:t.clientY},m.value=!0},u=()=>{m.value=!1,V.value=null},k=async(a,t)=>{try{console.log("Reprogramar cita:",a,t),await P()}catch(c){console.error("Error al reprogramar cita:",c),alert("No se pudo reprogramar la cita. Intenta nuevamente.")}};return document.addEventListener("click",()=>{m.value&&u()}),document.addEventListener("keydown",a=>{if(!(a.target.tagName==="INPUT"||a.target.tagName==="TEXTAREA"))switch(a.key){case"j":h.value=new Date(h.value.getTime()+864e5);break;case"k":h.value=new Date(h.value.getTime()-864e5);break;case"t":h.value=new Date;break;case"1":D.value="dia";break;case"2":D.value="semana";break;case"3":D.value="mes";break;case"n":d();break;case"f":a.preventDefault(),document.querySelector('input[type="text"]')?.focus();break}}),(a,t)=>(n(),r("div",null,[l.legacyFallback?(n(),oe(ye,{key:0})):(n(),r("div",{key:1,class:E(["h-screen flex flex-col overflow-hidden bg-[#FFF9F6] dark:bg-gray-950",{dark:_.value}])},[H(He,{vista:D.value,"onUpdate:vista":t[0]||(t[0]=c=>D.value=c),fechaActual:h.value,"onUpdate:fechaActual":t[1]||(t[1]=c=>h.value=c),darkMode:_.value,"onUpdate:darkMode":t[2]||(t[2]=c=>_.value=c),onNuevaCita:d},null,8,["vista","fechaActual","darkMode"]),H(Xe,{filtros:x.value,"onUpdate:filtros":t[3]||(t[3]=c=>x.value=c),"onUpdate:busqueda":t[4]||(t[4]=c=>p.value=c),terapeutas:Q.value,pacientes:W.value},null,8,["filtros","terapeutas","pacientes"]),e("div",lt,[H(aa)]),H(rt,{eventos:G.value,vista:D.value,fechaActual:h.value,cargando:A.value,draggable:!0,onEventoClick:o,onEventoMenu:f,onSlotClick:i,onEventoDrop:k},null,8,["eventos","vista","fechaActual","cargando"]),H(ke,{modelValue:y.value,"onUpdate:modelValue":t[5]||(t[5]=c=>y.value=c),"fecha-inicial":$.value?.date,"hora-inicial":$.value?.horaInicio,onGuardado:P},null,8,["modelValue","fecha-inicial","hora-inicial"]),H(xe,{isOpen:M.value,citaId:N.value,onClose:t[6]||(t[6]=c=>{M.value=!1,N.value=null}),onActualizado:P,onEliminado:P},null,8,["isOpen","citaId"]),(n(),oe(be,{to:"body"},[m.value?(n(),r("div",{key:0,style:B({top:`${S.value.y}px`,left:`${S.value.x}px`}),class:"fixed z-50 bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-700 rounded-lg shadow-lg py-1 min-w-[180px]",onClick:t[10]||(t[10]=R(()=>{},["stop"]))},[e("button",{onClick:t[7]||(t[7]=c=>{o(V.value),u()}),class:"w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-800 transition"}," Ver detalles "),e("button",{onClick:t[8]||(t[8]=c=>u()),class:"w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-800 transition"}," Reprogramar "),e("button",{onClick:t[9]||(t[9]=c=>u()),class:"w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-800 transition text-red-600"}," Cancelar cita ")],4)):w("",!0)])),t[11]||(t[11]=e("div",{class:"fixed bottom-4 right-4 bg-gray-900/90 dark:bg-gray-100/90 text-white dark:text-gray-900 px-3 py-2 rounded-lg text-xs opacity-0 hover:opacity-100 transition-opacity"},[e("kbd",null,"j/k"),q(" navegar ¬∑ "),e("kbd",null,"t"),q(" hoy ¬∑ "),e("kbd",null,"1/2/3"),q(" vistas ¬∑ "),e("kbd",null,"n"),q(" nueva ¬∑ "),e("kbd",null,"f"),q(" buscar ")],-1))],2))]))}}),At=Y(it,[["__scopeId","data-v-2e0dca65"]]);export{At as default};
