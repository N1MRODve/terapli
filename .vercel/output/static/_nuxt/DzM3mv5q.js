import{_ as Ae}from"./CjCv-3zV.js";import{u as W,a as ye}from"./CbOSifUi.js";import{e as X,s as g,c as d,o as i,a as e,h as v,t as r,k as o,z as V,y as le,f as ae,r as f,E as ee,d as _,i as K,j as C,A as J,v as O,Y as oe,ae as ne,q as re,F as ie,x as de,l as Z,ag as De,L as we,m as $e,g as _e,b as I,w as Q,H as ke}from"#entry";import{_ as te}from"./DlAUqK2U.js";const Fe={class:"flex items-start justify-between mb-4"},he={class:"flex-1"},Ce={class:"flex items-center gap-3 mb-2"},Pe={class:"font-['Lora'] text-xl font-semibold text-[#5D4A44]"},Be={class:"flex items-center gap-2"},Me={key:0,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-700 border border-orange-300"},Se={key:1,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-700 border border-blue-300"},Ee={class:"flex gap-2"},Ve={class:"mb-4"},je={class:"flex items-center justify-between mb-2"},Te={class:"text-sm font-semibold text-[#5D4A44]"},Re={class:"w-full bg-gray-200 rounded-full h-3"},Ne={class:"flex justify-between mt-1 text-xs text-[#5D4A44]/60"},ze={class:"grid grid-cols-2 gap-3 mb-4"},Ue={class:"p-3 bg-white rounded-lg border border-[#D8AFA0]/20"},Ie={class:"text-sm font-medium text-[#5D4A44] capitalize"},qe={class:"p-3 bg-white rounded-lg border border-[#D8AFA0]/20"},Le={class:"text-sm font-medium text-[#5D4A44] capitalize"},Oe={class:"p-3 bg-white rounded-lg border border-[#D8AFA0]/20"},Ge={class:"text-sm font-medium text-[#5D4A44]"},Qe={class:"p-3 bg-white rounded-lg border border-[#D8AFA0]/20"},He={key:0,class:"mb-4 p-3 bg-gradient-to-r from-[#D8AFA0]/10 to-[#ECC8BA]/10 rounded-lg"},Ye={class:"flex items-center justify-between text-sm"},Je={key:0},Ke={class:"font-medium text-[#5D4A44] ml-1"},We={key:1},Xe={key:0,class:"mt-2 text-xs text-center text-[#5D4A44]/60"},Ze={key:1,class:"flex items-center gap-2 mb-4 p-2 bg-purple-50 border border-purple-200 rounded-lg"},eo={key:2,class:"mb-4"},oo={class:"text-sm text-[#5D4A44]/80 p-2 bg-white rounded-lg border border-[#D8AFA0]/20"},to={class:"flex gap-2 pt-3 border-t border-[#D8AFA0]/20"},so=X({__name:"BonoCard",props:{bono:{}},emits:["renovar","verPagos","editar"],setup(u){const w=u,{getEstadoColor:x,getEstadoTexto:M,calcularPorcentajeUso:q,puedeGestionarBonos:B,puedeConfirmarPagos:l}=W(),{isCoordinadora:k}=ye(),p=g(()=>({quincenal:"Quincenal",mensual:"Mensual",semestral:"Semestral"})[w.bono.tipo]||w.bono.tipo||"Est√°ndar"),S=g(()=>x(w.bono.estado)),j=g(()=>M(w.bono.estado)),F=g(()=>({pendiente:"‚è≥",activo:"‚úÖ",completado:"‚úîÔ∏è",vencido:"‚ùå",cancelado:"üö´"})[w.bono.estado]||"üìã"),h=g(()=>({pendiente:"border-yellow-300",activo:"border-green-300",completado:"border-gray-300",vencido:"border-red-300",cancelado:"border-gray-400"})[w.bono.estado]||"border-gray-300"),P=g(()=>w.bono.sesiones_restantes??0),m=g(()=>(w.bono.sesiones_totales||0)-P.value),t=g(()=>q(w.bono)),s=g(()=>{const y=t.value;return y>=90?"bg-red-500":y>=70?"bg-orange-500":y>=50?"bg-yellow-500":"bg-gradient-to-r from-[#D8AFA0] to-[#ECC8BA]"}),A=g(()=>{if(!w.bono.fecha_fin)return null;const y=new Date,c=new Date(w.bono.fecha_fin);return Math.ceil((c.getTime()-y.getTime())/(1e3*60*60*24))}),N=g(()=>w.bono.estado!=="activo"||A.value===null?!1:A.value>=0&&A.value<=7),G=g(()=>w.bono.estado==="activo"&&P.value>0&&P.value<=2),z=g(()=>B.value||l.value),T=g(()=>B.value),H=g(()=>k.value),Y=y=>{if(!y)return"";try{return new Date(y+"T00:00:00").toLocaleDateString("es-ES",{day:"numeric",month:"short",year:"numeric"})}catch{return y}},R=y=>y?new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR"}).format(y):"$ 0";return(y,c)=>(i(),d("div",{class:V(["bono-card bg-[#F9F7F3] border-2 rounded-xl p-5 hover:shadow-lg transition-all duration-300",[o(h),{"opacity-60":u.bono.estado==="cancelado"}]])},[e("div",Fe,[e("div",he,[e("div",Ce,[c[5]||(c[5]=e("span",{class:"text-2xl"},"üé´",-1)),e("h3",Pe," Bono "+r(o(p)),1)]),e("div",Be,[e("span",{class:V(["inline-flex items-center px-3 py-1 rounded-full text-xs font-medium border",o(S)])},r(o(F))+" "+r(o(j)),3),o(N)?(i(),d("span",Me," ‚ö†Ô∏è Vence pronto ")):v("",!0),o(G)?(i(),d("span",Se," üìä Pocas sesiones ")):v("",!0)])]),e("div",Ee,[o(z)?(i(),d("button",{key:0,onClick:c[0]||(c[0]=U=>y.$emit("verPagos",u.bono)),class:"p-2 hover:bg-[#D8AFA0]/20 rounded-lg transition-colors",title:"Ver pagos"},[...c[6]||(c[6]=[e("span",{class:"text-lg"},"üí∞",-1)])])):v("",!0),o(T)?(i(),d("button",{key:1,onClick:c[1]||(c[1]=U=>y.$emit("renovar",u.bono)),class:"p-2 hover:bg-[#D8AFA0]/20 rounded-lg transition-colors",title:"Renovar bono"},[...c[7]||(c[7]=[e("span",{class:"text-lg"},"üîÑ",-1)])])):v("",!0)])]),e("div",Ve,[e("div",je,[c[8]||(c[8]=e("span",{class:"text-sm text-[#5D4A44]/70"},"Sesiones",-1)),e("span",Te,r(o(P))+" / "+r(u.bono.sesiones_totales)+" disponibles ",1)]),e("div",Re,[e("div",{class:V(["h-3 rounded-full transition-all duration-500",o(s)]),style:le({width:o(t)+"%"})},null,6)]),e("div",Ne,[e("span",null,r(o(m))+" usadas",1),e("span",null,r(o(t))+"% completado",1)])]),e("div",ze,[e("div",Ue,[c[9]||(c[9]=e("div",{class:"text-xs text-[#5D4A44]/60 mb-1"},"Tipo",-1)),e("div",Ie,r(u.bono.tipo||"Est√°ndar"),1)]),e("div",qe,[c[10]||(c[10]=e("div",{class:"text-xs text-[#5D4A44]/60 mb-1"},"Frecuencia",-1)),e("div",Le,r(u.bono.frecuencia||"Semanal"),1)]),e("div",Oe,[c[11]||(c[11]=e("div",{class:"text-xs text-[#5D4A44]/60 mb-1"},"Monto",-1)),e("div",Ge,r(R(u.bono.monto)),1)]),e("div",Qe,[c[12]||(c[12]=e("div",{class:"text-xs text-[#5D4A44]/60 mb-1"},"Pago",-1)),e("div",{class:V(["text-sm font-medium flex items-center gap-1",u.bono.pagado?"text-green-600":"text-orange-600"])},r(u.bono.pagado?"‚úì Pagado":"‚è≥ Pendiente"),3)])]),u.bono.fecha_inicio||u.bono.fecha_fin?(i(),d("div",He,[e("div",Ye,[u.bono.fecha_inicio?(i(),d("div",Je,[c[13]||(c[13]=e("span",{class:"text-[#5D4A44]/60"},"Inicio:",-1)),e("span",Ke,r(Y(u.bono.fecha_inicio)),1)])):v("",!0),u.bono.fecha_fin?(i(),d("div",We,[c[14]||(c[14]=e("span",{class:"text-[#5D4A44]/60"},"Vence:",-1)),e("span",{class:V(["font-medium ml-1",o(N)?"text-orange-600":"text-[#5D4A44]"])},r(Y(u.bono.fecha_fin)),3)])):v("",!0)]),o(A)!==null&&u.bono.estado==="activo"?(i(),d("div",Xe,r(o(A)>0?`${o(A)} d√≠as restantes`:"Vencido"),1)):v("",!0)])):v("",!0),u.bono.renovacion_automatica?(i(),d("div",Ze,[...c[15]||(c[15]=[e("span",{class:"text-sm"},"üîÑ",-1),e("span",{class:"text-xs text-purple-700 font-medium"},"Renovaci√≥n autom√°tica activada",-1)])])):v("",!0),u.bono.notas?(i(),d("div",eo,[c[16]||(c[16]=e("div",{class:"text-xs text-[#5D4A44]/60 mb-1"},"Notas",-1)),e("div",oo,r(u.bono.notas),1)])):v("",!0),e("div",to,[o(z)?(i(),d("button",{key:0,onClick:c[2]||(c[2]=U=>y.$emit("verPagos",u.bono)),class:"flex-1 px-4 py-2 bg-[#D8AFA0] text-white rounded-lg hover:bg-[#C89B8A] transition-colors text-sm font-medium flex items-center justify-center gap-2"},[...c[17]||(c[17]=[e("span",null,"üí∞",-1),e("span",null,"Ver Pagos",-1)])])):v("",!0),o(T)&&u.bono.estado!=="activo"?(i(),d("button",{key:1,onClick:c[3]||(c[3]=U=>y.$emit("renovar",u.bono)),class:"flex-1 px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors text-sm font-medium flex items-center justify-center gap-2"},[...c[18]||(c[18]=[e("span",null,"üîÑ",-1),e("span",null,"Renovar",-1)])])):v("",!0),o(H)?(i(),d("button",{key:2,onClick:c[4]||(c[4]=U=>y.$emit("editar",u.bono)),class:"px-4 py-2 bg-white border border-[#D8AFA0]/30 text-[#5D4A44] rounded-lg hover:bg-[#D8AFA0]/10 transition-colors text-sm font-medium"}," ‚úèÔ∏è ")):v("",!0)])],2))}}),no=Object.assign(te(so,[["__scopeId","data-v-b1b873d2"]]),{__name:"BonoCard"}),lo={class:"bg-[#F9F7F3] rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"},ao={class:"sticky top-0 bg-[#F9F7F3] border-b border-[#D8AFA0]/30 px-6 py-4 flex justify-between items-center"},ro={class:"text-sm text-[#5D4A44]/60 mt-1"},io={class:"grid grid-cols-2 gap-4"},uo={class:"relative"},co={class:"grid grid-cols-2 gap-4"},mo=["min"],po={class:"flex items-start gap-3 p-4 bg-purple-50 border border-purple-200 rounded-lg"},bo={class:"grid grid-cols-2 gap-3"},vo={key:0,class:"p-4 bg-gradient-to-r from-[#D8AFA0]/10 to-[#ECC8BA]/10 rounded-lg border border-[#D8AFA0]/30"},go={class:"grid grid-cols-2 gap-3 text-sm"},xo={class:"font-medium text-[#5D4A44] ml-1 capitalize"},fo={class:"font-medium text-[#5D4A44] ml-1 capitalize"},Ao={class:"font-medium text-[#5D4A44] ml-1"},yo={class:"font-medium text-[#5D4A44] ml-1"},Do={class:"font-medium text-[#5D4A44] ml-1"},wo={key:1,class:"p-4 bg-red-50 border border-red-200 rounded-lg"},$o={class:"text-sm text-red-700 flex items-center gap-2"},_o={class:"flex gap-3 pt-4 border-t border-[#D8AFA0]/30"},ko=["disabled"],Fo=["disabled"],ho=X({__name:"ModalNuevoBono",props:{mostrar:{type:Boolean},pacienteId:{},pacienteNombre:{},psicologaId:{}},emits:["close","created"],setup(u,{emit:w}){const x=u,M=w,{crearBono:q}=W(),{userProfile:B}=ae(),l=f({tipo:"mensual",frecuencia:"semanal",sesiones_totales:4,monto:0,fecha_inicio:new Date().toISOString().split("T")[0],fecha_fin:"",estado:"pendiente",renovacion_automatica:!1,notas:""}),k=f(!1),p=f(""),S=g(()=>l.value.tipo&&l.value.sesiones_totales&&l.value.monto),j=g(()=>!l.value.sesiones_totales||!l.value.monto?"0.00":(l.value.monto/l.value.sesiones_totales).toFixed(2)),F=g(()=>!!(l.value.tipo&&l.value.frecuencia&&l.value.sesiones_totales>0&&l.value.monto>0&&l.value.estado)),h=()=>{k.value||(p.value="",M("close"))},P=async()=>{if(!F.value){p.value="Por favor completa todos los campos requeridos";return}try{k.value=!0,p.value="";const m={paciente_id:x.pacienteId,terapeuta_id:x.psicologaId||B.value?.id,tipo:l.value.tipo,frecuencia:l.value.frecuencia,sesiones_totales:l.value.sesiones_totales,sesiones_restantes:l.value.sesiones_totales,fecha_inicio:l.value.fecha_inicio||null,fecha_fin:l.value.fecha_fin||null,estado:l.value.estado,monto:l.value.monto,pagado:l.value.estado==="activo",renovacion_automatica:l.value.renovacion_automatica,notas:l.value.notas||null},t=await q(m);M("created",t),M("close"),l.value={tipo:"mensual",frecuencia:"semanal",sesiones_totales:4,monto:0,fecha_inicio:new Date().toISOString().split("T")[0],fecha_fin:"",estado:"pendiente",renovacion_automatica:!1,notas:""}}catch(m){console.error("[ModalNuevoBono] Error al crear bono:",m),p.value=m.message||"Error al crear el bono. Int√©ntalo de nuevo."}finally{k.value=!1}};return ee(()=>l.value.tipo,m=>{if(l.value.fecha_inicio&&m){const t=new Date(l.value.fecha_inicio);let s=new Date(t);switch(m){case"quincenal":s.setDate(s.getDate()+15);break;case"mensual":s.setMonth(s.getMonth()+1);break;case"semestral":s.setMonth(s.getMonth()+6);break}l.value.fecha_fin=s.toISOString().split("T")[0]}}),(m,t)=>u.mostrar?(i(),d("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:K(h,["self"])},[e("div",lo,[e("div",ao,[e("div",null,[t[10]||(t[10]=e("h2",{class:"text-2xl font-['Lora'] text-[#5D4A44] font-semibold flex items-center gap-2"},[e("span",{class:"text-2xl"},"üé´"),_(" Nuevo Bono ")],-1)),e("p",ro," Crea un nuevo bono para "+r(u.pacienteNombre),1)]),e("button",{onClick:h,class:"text-[#5D4A44] hover:text-[#D8AFA0] transition-colors","aria-label":"Cerrar modal"},[...t[11]||(t[11]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("form",{onSubmit:K(P,["prevent"]),class:"px-6 py-6 space-y-6"},[e("div",io,[e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-[#5D4A44] mb-2"},[_(" Tipo de Bono "),e("span",{class:"text-red-500"},"*")],-1)),C(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>o(l).tipo=s),required:"",class:"w-full px-4 py-2 border border-[#D8AFA0]/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D8AFA0] bg-white"},[...t[12]||(t[12]=[e("option",{value:""},"Seleccionar tipo",-1),e("option",{value:"quincenal"},"Quincenal",-1),e("option",{value:"mensual"},"Mensual",-1),e("option",{value:"semestral"},"Semestral",-1)])],512),[[J,o(l).tipo]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-[#5D4A44] mb-2"},[_(" Frecuencia Sugerida "),e("span",{class:"text-red-500"},"*")],-1)),C(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>o(l).frecuencia=s),required:"",class:"w-full px-4 py-2 border border-[#D8AFA0]/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D8AFA0] bg-white"},[...t[14]||(t[14]=[e("option",{value:""},"Seleccionar frecuencia",-1),e("option",{value:"semanal"},"Semanal",-1),e("option",{value:"quincenal"},"Quincenal",-1),e("option",{value:"mensual"},"Mensual",-1)])],512),[[J,o(l).frecuencia]])])]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-[#5D4A44] mb-2"},[_(" Sesiones Totales "),e("span",{class:"text-red-500"},"*")],-1)),C(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>o(l).sesiones_totales=s),type:"number",min:"1",max:"100",required:"",placeholder:"Ej: 4, 8, 12...",class:"w-full px-4 py-2 border border-[#D8AFA0]/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D8AFA0]"},null,512),[[O,o(l).sesiones_totales,void 0,{number:!0}]]),t[17]||(t[17]=e("p",{class:"text-xs text-[#5D4A44]/60 mt-1"}," N√∫mero de sesiones incluidas en el bono ",-1))]),e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-[#5D4A44] mb-2"},[_(" Monto Total "),e("span",{class:"text-red-500"},"*")],-1)),e("div",uo,[t[18]||(t[18]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-[#5D4A44]/60"},"‚Ç¨",-1)),C(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>o(l).monto=s),type:"number",min:"0",step:"0.01",required:"",placeholder:"0.00",class:"w-full pl-8 pr-4 py-2 border border-[#D8AFA0]/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D8AFA0]"},null,512),[[O,o(l).monto,void 0,{number:!0}]])]),t[20]||(t[20]=e("p",{class:"text-xs text-[#5D4A44]/60 mt-1"}," Precio total del bono (todas las sesiones) ",-1))]),e("div",co,[e("div",null,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-[#5D4A44] mb-2"}," Fecha de Inicio ",-1)),C(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>o(l).fecha_inicio=s),type:"date",class:"w-full px-4 py-2 border border-[#D8AFA0]/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D8AFA0]"},null,512),[[O,o(l).fecha_inicio]])]),e("div",null,[t[22]||(t[22]=e("label",{class:"block text-sm font-medium text-[#5D4A44] mb-2"}," Fecha de Vencimiento ",-1)),C(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>o(l).fecha_fin=s),type:"date",min:o(l).fecha_inicio,class:"w-full px-4 py-2 border border-[#D8AFA0]/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D8AFA0]"},null,8,mo),[[O,o(l).fecha_fin]])])]),e("div",po,[C(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>o(l).renovacion_automatica=s),type:"checkbox",id:"renovacion-auto",class:"mt-1 w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500"},null,512),[[oe,o(l).renovacion_automatica]]),t[23]||(t[23]=e("label",{for:"renovacion-auto",class:"flex-1 cursor-pointer"},[e("div",{class:"text-sm font-medium text-purple-900"}," üîÑ Renovaci√≥n Autom√°tica "),e("div",{class:"text-xs text-purple-700 mt-1"}," El bono se renovar√° autom√°ticamente cuando se complete o venza ")],-1))]),e("div",null,[t[26]||(t[26]=e("label",{class:"block text-sm font-medium text-[#5D4A44] mb-2"}," Estado Inicial ",-1)),e("div",bo,[e("label",{class:V(["flex items-center gap-2 p-3 border-2 rounded-lg cursor-pointer transition-all",o(l).estado==="pendiente"?"border-yellow-400 bg-yellow-50":"border-gray-300 hover:border-yellow-300"])},[C(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>o(l).estado=s),type:"radio",value:"pendiente",class:"w-4 h-4 text-yellow-600"},null,512),[[ne,o(l).estado]]),t[24]||(t[24]=e("div",null,[e("div",{class:"text-sm font-medium text-[#5D4A44]"},"‚è≥ Pendiente"),e("div",{class:"text-xs text-[#5D4A44]/60"},"Requiere pago")],-1))],2),e("label",{class:V(["flex items-center gap-2 p-3 border-2 rounded-lg cursor-pointer transition-all",o(l).estado==="activo"?"border-green-400 bg-green-50":"border-gray-300 hover:border-green-300"])},[C(e("input",{"onUpdate:modelValue":t[8]||(t[8]=s=>o(l).estado=s),type:"radio",value:"activo",class:"w-4 h-4 text-green-600"},null,512),[[ne,o(l).estado]]),t[25]||(t[25]=e("div",null,[e("div",{class:"text-sm font-medium text-[#5D4A44]"},"‚úÖ Activo"),e("div",{class:"text-xs text-[#5D4A44]/60"},"Ya pagado")],-1))],2)])]),e("div",null,[t[27]||(t[27]=e("label",{class:"block text-sm font-medium text-[#5D4A44] mb-2"}," Notas (Opcional) ",-1)),C(e("textarea",{"onUpdate:modelValue":t[9]||(t[9]=s=>o(l).notas=s),rows:"3",placeholder:"Informaci√≥n adicional sobre el bono...",class:"w-full px-4 py-2 border border-[#D8AFA0]/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D8AFA0] resize-none"},null,512),[[O,o(l).notas]])]),o(S)?(i(),d("div",vo,[t[34]||(t[34]=e("div",{class:"font-medium text-[#5D4A44] mb-3 flex items-center gap-2"},[e("span",null,"üìã"),_(" Resumen del Bono ")],-1)),e("div",go,[e("div",null,[t[28]||(t[28]=e("span",{class:"text-[#5D4A44]/60"},"Tipo:",-1)),e("span",xo,r(o(l).tipo||"-"),1)]),e("div",null,[t[29]||(t[29]=e("span",{class:"text-[#5D4A44]/60"},"Frecuencia:",-1)),e("span",fo,r(o(l).frecuencia||"-"),1)]),e("div",null,[t[30]||(t[30]=e("span",{class:"text-[#5D4A44]/60"},"Sesiones:",-1)),e("span",Ao,r(o(l).sesiones_totales||0),1)]),e("div",null,[t[31]||(t[31]=e("span",{class:"text-[#5D4A44]/60"},"Monto:",-1)),e("span",yo,"‚Ç¨"+r(o(l).monto||0),1)]),e("div",null,[t[32]||(t[32]=e("span",{class:"text-[#5D4A44]/60"},"Precio/sesi√≥n:",-1)),e("span",Do,"‚Ç¨"+r(o(j)),1)]),e("div",null,[t[33]||(t[33]=e("span",{class:"text-[#5D4A44]/60"},"Estado:",-1)),e("span",{class:V(["font-medium capitalize ml-1",o(l).estado==="activo"?"text-green-600":"text-yellow-600"])},r(o(l).estado||"-"),3)])])])):v("",!0),o(p)?(i(),d("div",wo,[e("p",$o,[t[35]||(t[35]=e("span",null,"‚ùå",-1)),_(" "+r(o(p)),1)])])):v("",!0),e("div",_o,[e("button",{type:"button",onClick:h,class:"flex-1 px-6 py-3 bg-white border border-[#D8AFA0]/30 text-[#5D4A44] rounded-lg hover:bg-[#D8AFA0]/10 transition-colors font-medium",disabled:o(k)}," Cancelar ",8,ko),e("button",{type:"submit",class:"flex-1 px-6 py-3 bg-[#D8AFA0] text-white rounded-lg hover:bg-[#C89B8A] transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",disabled:o(k)||!o(F)},r(o(k)?"Creando...":"Crear Bono"),9,Fo)])],32)])])):v("",!0)}}),Co=Object.assign(ho,{__name:"ModalNuevoBono"}),Po={class:"bg-[#F9F7F3] rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto"},Bo={class:"sticky top-0 bg-[#F9F7F3] border-b border-[#D8AFA0]/30 px-6 py-4"},Mo={key:0,class:"mt-4 p-4 bg-gradient-to-r from-[#D8AFA0]/10 to-[#ECC8BA]/10 rounded-lg"},So={class:"grid grid-cols-3 gap-4 text-sm"},Eo={class:"font-medium text-[#5D4A44] capitalize"},Vo={class:"font-bold text-[#D8AFA0] text-lg"},jo={class:"px-6 py-6 space-y-6"},To={class:"p-4 bg-white border-2 border-[#D8AFA0]/30 rounded-xl"},Ro={class:"grid grid-cols-3 gap-4 text-center"},No={class:"text-2xl font-bold text-green-600"},zo={class:"text-2xl font-bold text-orange-600"},Uo={class:"text-2xl font-bold text-[#5D4A44]"},Io={class:"mt-4"},qo={class:"flex justify-between text-xs text-[#5D4A44]/60 mb-1"},Lo={class:"w-full bg-gray-200 rounded-full h-2"},Oo={key:0,class:"flex justify-end"},Go={key:1,class:"p-5 bg-green-50 border-2 border-green-300 rounded-xl"},Qo={class:"grid grid-cols-2 gap-4"},Ho={class:"relative"},Yo={key:0,class:"flex items-center gap-2 p-3 bg-white border border-green-300 rounded-lg"},Jo={class:"flex gap-3"},Ko=["disabled"],Wo={class:"font-['Lora'] text-lg font-semibold text-[#5D4A44] mb-4 flex items-center gap-2"},Xo={key:0,class:"text-center py-8"},Zo={key:1,class:"text-center py-12"},et={key:2,class:"space-y-3"},ot={class:"flex items-start justify-between gap-4"},tt={class:"flex-1"},st={class:"flex items-center gap-3 mb-2"},nt={class:"space-y-1 text-sm text-[#5D4A44]/70"},lt={class:"flex items-center gap-2"},at={class:"capitalize"},rt={class:"flex items-center gap-2"},it={key:0,class:"flex items-center gap-2"},dt={key:0},ut=["onClick","disabled"],ct={key:2,class:"p-4 bg-red-50 border border-red-200 rounded-lg"},mt={class:"text-sm text-red-700 flex items-center gap-2"},pt={key:3,class:"p-4 bg-green-50 border border-green-200 rounded-lg"},bt={class:"text-sm text-green-700 flex items-center gap-2"},vt=X({__name:"ModalPagosBono",props:{mostrar:{type:Boolean},bono:{}},emits:["close","updated"],setup(u,{emit:w}){const x=u,M=w,{getPagosPorBono:q,registrarPago:B,confirmarPago:l,puedeGestionarBonos:k,puedeConfirmarPagos:p}=W(),S=f([]),j=f(!1),F=f(!1),h=f(!1),P=f(null),m=f(""),t=f(""),s=f({monto:0,metodo:"",confirmado:!1}),A=g(()=>[...S.value].sort((b,a)=>new Date(a.fecha_pago).getTime()-new Date(b.fecha_pago).getTime())),N=g(()=>S.value.filter(b=>b.confirmado).reduce((b,a)=>b+(a.monto||0),0)),G=g(()=>{const b=x.bono?.monto||0;return Math.max(0,b-N.value)}),z=g(()=>{const b=x.bono?.monto||0;return b===0?0:Math.round(N.value/b*100)}),T=async()=>{if(x.bono?.id)try{j.value=!0,m.value="",S.value=await q(x.bono.id)}catch(b){console.error("[ModalPagosBono] Error al cargar pagos:",b),m.value="Error al cargar los pagos"}finally{j.value=!1}},H=async()=>{if(!x.bono?.id||!s.value.monto||!s.value.metodo){m.value="Por favor completa todos los campos";return}try{h.value=!0,m.value="",t.value="",await B(x.bono.id,s.value.monto,s.value.metodo,s.value.confirmado),t.value="Pago registrado correctamente",F.value=!1,s.value={monto:0,metodo:"",confirmado:!1},await T(),M("updated"),setTimeout(()=>{t.value=""},3e3)}catch(b){console.error("[ModalPagosBono] Error al registrar pago:",b),m.value=b.message||"Error al registrar el pago"}finally{h.value=!1}},Y=async b=>{try{P.value=b,m.value="",t.value="";const a=await l(b);t.value=a.mensaje||"Pago confirmado correctamente",await T(),M("updated"),setTimeout(()=>{t.value=""},3e3)}catch(a){console.error("[ModalPagosBono] Error al confirmar pago:",a),m.value=a.message||"Error al confirmar el pago"}finally{P.value=null}},R=()=>{m.value="",t.value="",F.value=!1,M("close")},y=b=>{if(!b)return"";try{return new Date(b).toLocaleDateString("es-ES",{day:"numeric",month:"short",year:"numeric"})}catch{return b}},c=b=>b?new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR"}).format(b):"‚Ç¨ 0.00",U=b=>({efectivo:"Efectivo",transferencia:"Transferencia Bancaria",tarjeta:"Tarjeta de Cr√©dito/D√©bito",bizum:"Bizum",paypal:"PayPal"})[b]||b;return ee(()=>x.mostrar,b=>{b&&T()},{immediate:!0}),(b,a)=>u.mostrar?(i(),d("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:K(R,["self"])},[e("div",Po,[e("div",Bo,[e("div",{class:"flex justify-between items-start"},[a[6]||(a[6]=e("div",{class:"flex-1"},[e("h2",{class:"text-2xl font-['Lora'] text-[#5D4A44] font-semibold flex items-center gap-2"},[e("span",{class:"text-2xl"},"üí∞"),_(" Pagos del Bono ")]),e("p",{class:"text-sm text-[#5D4A44]/60 mt-1"}," Gestiona los pagos y confirma transacciones ")],-1)),e("button",{onClick:R,class:"text-[#5D4A44] hover:text-[#D8AFA0] transition-colors","aria-label":"Cerrar modal"},[...a[5]||(a[5]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),u.bono?(i(),d("div",Mo,[e("div",So,[e("div",null,[a[7]||(a[7]=e("div",{class:"text-[#5D4A44]/60 mb-1"},"Tipo",-1)),e("div",Eo,r(u.bono.tipo),1)]),e("div",null,[a[8]||(a[8]=e("div",{class:"text-[#5D4A44]/60 mb-1"},"Monto Total",-1)),e("div",Vo,r(c(u.bono.monto)),1)]),e("div",null,[a[9]||(a[9]=e("div",{class:"text-[#5D4A44]/60 mb-1"},"Estado",-1)),e("div",{class:V(["font-medium capitalize",u.bono.pagado?"text-green-600":"text-orange-600"])},r(u.bono.pagado?"‚úì Pagado":"‚è≥ Pendiente"),3)])])])):v("",!0)]),e("div",jo,[e("div",To,[e("div",Ro,[e("div",null,[e("div",No,r(c(o(N))),1),a[10]||(a[10]=e("div",{class:"text-xs text-[#5D4A44]/60 mt-1"},"Total Pagado",-1))]),e("div",null,[e("div",zo,r(c(o(G))),1),a[11]||(a[11]=e("div",{class:"text-xs text-[#5D4A44]/60 mt-1"},"Pendiente",-1))]),e("div",null,[e("div",Uo,r(o(S).length),1),a[12]||(a[12]=e("div",{class:"text-xs text-[#5D4A44]/60 mt-1"},"Transacciones",-1))])]),e("div",Io,[e("div",qo,[a[13]||(a[13]=e("span",null,"Progreso de pago",-1)),e("span",null,r(o(z))+"%",1)]),e("div",Lo,[e("div",{class:V(["h-2 rounded-full transition-all duration-500",o(z)>=100?"bg-green-500":"bg-gradient-to-r from-[#D8AFA0] to-[#ECC8BA]"]),style:le({width:Math.min(o(z),100)+"%"})},null,6)])])]),o(k)?(i(),d("div",Oo,[e("button",{onClick:a[0]||(a[0]=D=>F.value=!o(F)),class:"px-4 py-2 bg-[#D8AFA0] text-white rounded-lg hover:bg-[#C89B8A] transition-colors font-medium flex items-center gap-2"},[e("span",null,r(o(F)?"‚úï":"+"),1),e("span",null,r(o(F)?"Cancelar":"Registrar Pago"),1)])])):v("",!0),o(F)?(i(),d("div",Go,[a[19]||(a[19]=e("h3",{class:"font-['Lora'] text-lg font-semibold text-[#5D4A44] mb-4 flex items-center gap-2"},[e("span",null,"üí≥"),_(" Registrar Nuevo Pago ")],-1)),e("form",{onSubmit:K(H,["prevent"]),class:"space-y-4"},[e("div",Qo,[e("div",null,[a[15]||(a[15]=e("label",{class:"block text-sm font-medium text-[#5D4A44] mb-2"},[_(" Monto "),e("span",{class:"text-red-500"},"*")],-1)),e("div",Ho,[a[14]||(a[14]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-[#5D4A44]/60"},"‚Ç¨",-1)),C(e("input",{"onUpdate:modelValue":a[1]||(a[1]=D=>o(s).monto=D),type:"number",min:"0",step:"0.01",required:"",placeholder:"0.00",class:"w-full pl-8 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D8AFA0] bg-white"},null,512),[[O,o(s).monto,void 0,{number:!0}]])])]),e("div",null,[a[17]||(a[17]=e("label",{class:"block text-sm font-medium text-[#5D4A44] mb-2"},[_(" M√©todo de Pago "),e("span",{class:"text-red-500"},"*")],-1)),C(e("select",{"onUpdate:modelValue":a[2]||(a[2]=D=>o(s).metodo=D),required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D8AFA0] bg-white"},[...a[16]||(a[16]=[re('<option value="" data-v-f2590954>Seleccionar m√©todo</option><option value="efectivo" data-v-f2590954>üíµ Efectivo</option><option value="transferencia" data-v-f2590954>üè¶ Transferencia</option><option value="tarjeta" data-v-f2590954>üí≥ Tarjeta</option><option value="bizum" data-v-f2590954>üì± Bizum</option><option value="paypal" data-v-f2590954>üÖøÔ∏è PayPal</option>',6)])],512),[[J,o(s).metodo]])])]),o(p)?(i(),d("div",Yo,[C(e("input",{"onUpdate:modelValue":a[3]||(a[3]=D=>o(s).confirmado=D),type:"checkbox",id:"confirmar-pago",class:"w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500"},null,512),[[oe,o(s).confirmado]]),a[18]||(a[18]=e("label",{for:"confirmar-pago",class:"text-sm text-[#5D4A44] cursor-pointer"}," ‚úì Confirmar pago inmediatamente (ya verificado) ",-1))])):v("",!0),e("div",Jo,[e("button",{type:"button",onClick:a[4]||(a[4]=D=>F.value=!1),class:"flex-1 px-4 py-2 bg-white border border-gray-300 text-[#5D4A44] rounded-lg hover:bg-gray-50 transition-colors"}," Cancelar "),e("button",{type:"submit",class:"flex-1 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors font-medium disabled:opacity-50",disabled:o(h)},r(o(h)?"Registrando...":"Guardar Pago"),9,Ko)])],32)])):v("",!0),e("div",null,[e("h3",Wo,[a[20]||(a[20]=e("span",null,"üìú",-1)),_(" Historial de Pagos ("+r(o(S).length)+") ",1)]),o(j)?(i(),d("div",Xo,[...a[21]||(a[21]=[e("div",{class:"animate-spin w-10 h-10 border-4 border-[#D8AFA0] border-t-transparent rounded-full mx-auto mb-3"},null,-1),e("p",{class:"text-[#5D4A44]/60"},"Cargando pagos...",-1)])])):o(S).length===0?(i(),d("div",Zo,[...a[22]||(a[22]=[e("span",{class:"text-6xl mb-3 block opacity-40"},"üí∏",-1),e("p",{class:"text-[#5D4A44]/60"},"No hay pagos registrados a√∫n",-1)])])):(i(),d("div",et,[(i(!0),d(ie,null,de(o(A),D=>(i(),d("div",{key:D.id,class:V(["p-4 border-2 rounded-lg transition-all",D.confirmado?"bg-green-50 border-green-300":"bg-yellow-50 border-yellow-300"])},[e("div",ot,[e("div",tt,[e("div",st,[e("span",{class:V(["text-2xl font-bold",D.confirmado?"text-green-600":"text-yellow-600"])},r(c(D.monto)),3),e("span",{class:V(["px-2 py-1 rounded-full text-xs font-medium capitalize",D.confirmado?"bg-green-200 text-green-800":"bg-yellow-200 text-yellow-800"])},r(D.confirmado?"‚úì Confirmado":"‚è≥ Pendiente"),3)]),e("div",nt,[e("div",lt,[a[23]||(a[23]=e("span",null,"üí≥",-1)),e("span",at,r(U(D.metodo_pago)),1)]),e("div",rt,[a[24]||(a[24]=e("span",null,"üìÖ",-1)),e("span",null,r(y(D.fecha_pago)),1)]),D.confirmado&&D.fecha_confirmacion?(i(),d("div",it,[a[25]||(a[25]=e("span",null,"‚úÖ",-1)),e("span",null,"Confirmado el "+r(y(D.fecha_confirmacion)),1)])):v("",!0)])]),o(p)&&!D.confirmado?(i(),d("div",dt,[e("button",{onClick:se=>Y(D.id),class:"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors text-sm font-medium",disabled:o(P)===D.id},r(o(P)===D.id?"Confirmando...":"‚úì Confirmar"),9,ut)])):v("",!0)])],2))),128))]))]),o(m)?(i(),d("div",ct,[e("p",mt,[a[26]||(a[26]=e("span",null,"‚ùå",-1)),_(" "+r(o(m)),1)])])):v("",!0),o(t)?(i(),d("div",pt,[e("p",bt,[a[27]||(a[27]=e("span",null,"‚úÖ",-1)),_(" "+r(o(t)),1)])])):v("",!0)]),e("div",{class:"sticky bottom-0 bg-[#F9F7F3] border-t border-[#D8AFA0]/30 px-6 py-4"},[e("button",{onClick:R,class:"w-full px-6 py-3 bg-[#5D4A44] text-white rounded-lg hover:bg-[#4A3A34] transition-colors font-medium"}," Cerrar ")])])])):v("",!0)}}),gt=Object.assign(te(vt,[["__scopeId","data-v-f2590954"]]),{__name:"ModalPagosBono"}),xt={class:"bg-[#F9F7F3] rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"},ft={class:"px-6 py-6 space-y-6"},At={class:"p-5 bg-gradient-to-r from-gray-100 to-gray-50 border-2 border-gray-300 rounded-xl"},yt={class:"grid grid-cols-2 gap-4 text-sm"},Dt={class:"p-3 bg-white rounded-lg"},wt={class:"font-medium text-[#5D4A44] capitalize"},$t={class:"p-3 bg-white rounded-lg"},_t={class:"font-medium text-[#5D4A44] capitalize"},kt={class:"p-3 bg-white rounded-lg"},Ft={class:"font-medium text-[#5D4A44]"},ht={class:"p-3 bg-white rounded-lg"},Ct={class:"font-medium text-[#5D4A44]"},Pt={class:"p-3 bg-white rounded-lg"},Bt={class:"font-bold text-[#D8AFA0] text-lg"},Mt={class:"p-3 bg-white rounded-lg"},St={class:"p-5 bg-gradient-to-r from-purple-50 to-indigo-50 border-2 border-purple-300 rounded-xl"},Et={class:"mb-5 p-3 bg-white border border-purple-200 rounded-lg"},Vt={class:"flex items-center gap-3 cursor-pointer"},jt={key:0,class:"space-y-4"},Tt={class:"grid grid-cols-2 gap-4"},Rt={class:"relative"},Nt={class:"p-3 bg-purple-100 rounded-lg text-sm"},zt={class:"flex justify-between mb-1"},Ut={class:"font-bold text-purple-700"},It={class:"flex justify-between"},qt={class:"font-medium text-[#5D4A44]/60"},Lt={key:1,class:"p-4 bg-green-50 border border-green-300 rounded-lg"},Ot={class:"text-sm text-green-700 flex items-center gap-2"},Gt={key:0,class:"p-4 bg-red-50 border border-red-200 rounded-lg"},Qt={class:"text-sm text-red-700 flex items-center gap-2"},Ht={class:"flex gap-3 pt-4 border-t border-[#D8AFA0]/30"},Yt=["disabled"],Jt=["disabled"],Kt={key:0},Wt={key:1},Xt=X({__name:"ModalRenovacionBono",props:{mostrar:{type:Boolean},bono:{}},emits:["close","renovated"],setup(u,{emit:w}){const x=u,M=w,{renovarBono:q}=W(),B=f(!0),l=f(!1),k=f(""),p=f({sesiones_nuevas:x.bono?.sesiones_totales||0,monto_nuevo:x.bono?.monto||0,motivo:""}),S=g(()=>({pendiente:"text-yellow-600",activo:"text-green-600",completado:"text-gray-600",vencido:"text-red-600",cancelado:"text-gray-500"})[x.bono?.estado]||"text-gray-600"),j=g(()=>!x.bono?.sesiones_totales||!x.bono?.monto?"0.00":(x.bono.monto/x.bono.sesiones_totales).toFixed(2)),F=g(()=>!p.value.sesiones_nuevas||!p.value.monto_nuevo?"0.00":(p.value.monto_nuevo/p.value.sesiones_nuevas).toFixed(2)),h=()=>{l.value||(k.value="",M("close"))},P=async()=>{if(!x.bono?.id){k.value="Bono no v√°lido";return}try{l.value=!0,k.value="";const t=B.value?null:p.value.sesiones_nuevas,s=B.value?null:p.value.monto_nuevo,A=await q(x.bono.id,p.value.motivo||"Renovaci√≥n manual solicitada",t,s);M("renovated",A),M("close"),p.value={sesiones_nuevas:x.bono?.sesiones_totales||0,monto_nuevo:x.bono?.monto||0,motivo:""},B.value=!0}catch(t){console.error("[ModalRenovacionBono] Error al renovar:",t),k.value=t.message||"Error al renovar el bono. Int√©ntalo de nuevo."}finally{l.value=!1}},m=t=>t?new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR"}).format(t):"‚Ç¨ 0.00";return ee(()=>x.bono,t=>{t&&(p.value.sesiones_nuevas=t.sesiones_totales||0,p.value.monto_nuevo=t.monto||0)},{immediate:!0}),(t,s)=>u.mostrar?(i(),d("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:K(h,["self"])},[e("div",xt,[e("div",{class:"sticky top-0 bg-[#F9F7F3] border-b border-[#D8AFA0]/30 px-6 py-4 flex justify-between items-center"},[s[5]||(s[5]=e("div",null,[e("h2",{class:"text-2xl font-['Lora'] text-[#5D4A44] font-semibold flex items-center gap-2"},[e("span",{class:"text-2xl"},"üîÑ"),_(" Renovar Bono ")]),e("p",{class:"text-sm text-[#5D4A44]/60 mt-1"}," Crea una nueva renovaci√≥n basada en el bono actual ")],-1)),e("button",{onClick:h,class:"text-[#5D4A44] hover:text-[#D8AFA0] transition-colors","aria-label":"Cerrar modal"},[...s[4]||(s[4]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",ft,[e("div",At,[s[12]||(s[12]=e("h3",{class:"font-['Lora'] text-lg font-semibold text-[#5D4A44] mb-4 flex items-center gap-2"},[e("span",null,"üìã"),_(" Bono Actual ")],-1)),e("div",yt,[e("div",Dt,[s[6]||(s[6]=e("div",{class:"text-[#5D4A44]/60 mb-1"},"Tipo",-1)),e("div",wt,r(u.bono.tipo),1)]),e("div",$t,[s[7]||(s[7]=e("div",{class:"text-[#5D4A44]/60 mb-1"},"Frecuencia",-1)),e("div",_t,r(u.bono.frecuencia),1)]),e("div",kt,[s[8]||(s[8]=e("div",{class:"text-[#5D4A44]/60 mb-1"},"Sesiones Totales",-1)),e("div",Ft,r(u.bono.sesiones_totales),1)]),e("div",ht,[s[9]||(s[9]=e("div",{class:"text-[#5D4A44]/60 mb-1"},"Sesiones Restantes",-1)),e("div",Ct,r(u.bono.sesiones_restantes||0),1)]),e("div",Pt,[s[10]||(s[10]=e("div",{class:"text-[#5D4A44]/60 mb-1"},"Monto",-1)),e("div",Bt,r(m(u.bono.monto)),1)]),e("div",Mt,[s[11]||(s[11]=e("div",{class:"text-[#5D4A44]/60 mb-1"},"Estado",-1)),e("div",{class:V(["font-medium capitalize",o(S)])},r(u.bono.estado),3)])])]),e("form",{onSubmit:K(P,["prevent"]),class:"space-y-5"},[e("div",St,[s[22]||(s[22]=e("h3",{class:"font-['Lora'] text-lg font-semibold text-[#5D4A44] mb-4 flex items-center gap-2"},[e("span",null,"‚ú®"),_(" Datos del Nuevo Bono ")],-1)),e("div",Et,[e("label",Vt,[C(e("input",{"onUpdate:modelValue":s[0]||(s[0]=A=>Z(B)?B.value=A:null),type:"checkbox",class:"w-5 h-5 text-purple-600 border-gray-300 rounded focus:ring-purple-500"},null,512),[[oe,o(B)]]),s[13]||(s[13]=e("div",null,[e("div",{class:"text-sm font-medium text-[#5D4A44]"}," Mantener los mismos valores del bono original "),e("div",{class:"text-xs text-[#5D4A44]/60 mt-1"}," Si lo desmarcas, podr√°s personalizar las sesiones y el monto ")],-1))])]),o(B)?(i(),d("div",Lt,[e("p",Ot,[s[19]||(s[19]=e("span",null,"‚úì",-1)),s[20]||(s[20]=_(" Se duplicar√°n los valores originales: ",-1)),e("strong",null,r(u.bono.sesiones_totales)+" sesiones",1),s[21]||(s[21]=_(" por ",-1)),e("strong",null,r(m(u.bono.monto)),1)])])):(i(),d("div",jt,[e("div",Tt,[e("div",null,[s[14]||(s[14]=e("label",{class:"block text-sm font-medium text-[#5D4A44] mb-2"}," Sesiones Totales ",-1)),C(e("input",{"onUpdate:modelValue":s[1]||(s[1]=A=>o(p).sesiones_nuevas=A),type:"number",min:"1",max:"100",required:"",class:"w-full px-4 py-2 border border-purple-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 bg-white"},null,512),[[O,o(p).sesiones_nuevas,void 0,{number:!0}]])]),e("div",null,[s[16]||(s[16]=e("label",{class:"block text-sm font-medium text-[#5D4A44] mb-2"}," Monto Total ",-1)),e("div",Rt,[s[15]||(s[15]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-[#5D4A44]/60"},"‚Ç¨",-1)),C(e("input",{"onUpdate:modelValue":s[2]||(s[2]=A=>o(p).monto_nuevo=A),type:"number",min:"0",step:"0.01",required:"",placeholder:"0.00",class:"w-full pl-8 pr-4 py-2 border border-purple-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 bg-white"},null,512),[[O,o(p).monto_nuevo,void 0,{number:!0}]])])])]),e("div",Nt,[e("div",zt,[s[17]||(s[17]=e("span",{class:"text-[#5D4A44]/70"},"Precio por sesi√≥n (nuevo):",-1)),e("span",Ut,"‚Ç¨"+r(o(F)),1)]),e("div",It,[s[18]||(s[18]=e("span",{class:"text-[#5D4A44]/70"},"Precio por sesi√≥n (original):",-1)),e("span",qt,"‚Ç¨"+r(o(j)),1)])])]))]),e("div",null,[s[23]||(s[23]=e("label",{class:"block text-sm font-medium text-[#5D4A44] mb-2"}," Motivo de la Renovaci√≥n (Opcional) ",-1)),C(e("textarea",{"onUpdate:modelValue":s[3]||(s[3]=A=>o(p).motivo=A),rows:"3",placeholder:"Explica por qu√© se renueva este bono...",class:"w-full px-4 py-2 border border-[#D8AFA0]/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D8AFA0] resize-none"},null,512),[[O,o(p).motivo]])]),s[25]||(s[25]=re('<div class="p-4 bg-blue-50 border-2 border-blue-300 rounded-lg"><h4 class="font-medium text-blue-900 mb-2 flex items-center gap-2"><span>‚ÑπÔ∏è</span> Informaci√≥n Importante </h4><ul class="text-sm text-blue-800 space-y-1.5"><li class="flex items-start gap-2"><span class="mt-0.5">‚Ä¢</span><span>El bono actual se marcar√° como <strong>completado</strong></span></li><li class="flex items-start gap-2"><span class="mt-0.5">‚Ä¢</span><span>Se crear√° un <strong>nuevo bono</strong> con estado <strong>pendiente</strong> hasta que se confirme el pago</span></li><li class="flex items-start gap-2"><span class="mt-0.5">‚Ä¢</span><span>La fecha de inicio ser√° <strong>hoy</strong> y la de vencimiento se calcular√° autom√°ticamente</span></li><li class="flex items-start gap-2"><span class="mt-0.5">‚Ä¢</span><span>Se guardar√° un registro en el historial de renovaciones</span></li></ul></div>',1)),o(k)?(i(),d("div",Gt,[e("p",Qt,[s[24]||(s[24]=e("span",null,"‚ùå",-1)),_(" "+r(o(k)),1)])])):v("",!0),e("div",Ht,[e("button",{type:"button",onClick:h,class:"flex-1 px-6 py-3 bg-white border border-[#D8AFA0]/30 text-[#5D4A44] rounded-lg hover:bg-[#D8AFA0]/10 transition-colors font-medium",disabled:o(l)}," Cancelar ",8,Yt),e("button",{type:"submit",class:"flex-1 px-6 py-3 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",disabled:o(l)},[o(l)?(i(),d("span",Kt,"‚è≥")):(i(),d("span",Wt,"üîÑ")),e("span",null,r(o(l)?"Renovando...":"Confirmar Renovaci√≥n"),1)],8,Jt)])],32)])])])):v("",!0)}}),Zt=Object.assign(Xt,{__name:"ModalRenovacionBono"}),es={class:"bonos-container pb-20"},os={class:"mb-6"},ts={class:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4"},ss={class:"text-3xl font-['Lora'] font-bold text-[#5D4A44] mb-2 flex items-center gap-3"},ns={key:0,class:"text-center py-16"},ls={key:1,class:"text-center py-16"},as={class:"text-[#5D4A44]/60 mb-4"},rs={key:2},is={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8"},ds={class:"flex items-center justify-between"},us={class:"text-3xl font-bold text-purple-700"},cs={class:"flex items-center justify-between"},ms={class:"text-3xl font-bold text-green-700"},ps={class:"flex items-center justify-between"},bs={class:"text-3xl font-bold text-orange-700"},vs={class:"flex items-center justify-between"},gs={class:"text-3xl font-bold text-yellow-700"},xs={class:"mb-6"},fs={class:"flex flex-col md:flex-row gap-4"},As={class:"flex-1"},ys={class:"flex-1"},Ds={class:"flex-1"},ws={key:0,class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},$s={key:1,class:"text-center py-16"},_s={class:"text-xl font-['Lora'] font-semibold text-[#5D4A44] mb-2"},ks={class:"text-[#5D4A44]/60 mb-6"},Fs={key:2,class:"mt-8 space-y-3"},hs={key:0,class:"p-4 bg-orange-50 border-2 border-orange-300 rounded-lg"},Cs={class:"flex items-start gap-3"},Ps={class:"flex-1"},Bs={class:"font-medium text-orange-900 mb-1"},Ms={key:1,class:"p-4 bg-blue-50 border-2 border-blue-300 rounded-lg"},Ss={class:"flex items-start gap-3"},Es={class:"flex-1"},Vs={class:"font-medium text-blue-900 mb-1"},js=X({__name:"bonos",setup(u){const w=De(),x=we(),M=$e(),{userProfile:q}=ae(),{getBonosPorPaciente:B,calcularMetricas:l,puedeGestionarBonos:k}=W(),p=g(()=>w.params.id),S=g(()=>q.value?.id||""),j=f(!0),F=f(null),h=f([]),P=f(""),m=f({total:0,activos:0,completados:0,vencidos:0,pendientes:0,proximosAVencer:0,pocasSesiones:0}),t=f("todos"),s=f("todos"),A=f("reciente"),N=f(!1),G=f(!1),z=f(!1),T=f(null),H=g(()=>{let $=[...h.value];return t.value!=="todos"&&($=$.filter(n=>n.estado===t.value)),s.value!=="todos"&&($=$.filter(n=>n.tipo===s.value)),A.value==="reciente"?$.sort((n,E)=>new Date(E.created_at).getTime()-new Date(n.created_at).getTime()):A.value==="antiguo"?$.sort((n,E)=>new Date(n.created_at).getTime()-new Date(E.created_at).getTime()):A.value==="vencimiento"&&$.sort((n,E)=>n.fecha_fin?E.fecha_fin?new Date(n.fecha_fin).getTime()-new Date(E.fecha_fin).getTime():-1:1),$}),Y=g(()=>m.value.proximosAVencer>0||m.value.pocasSesiones>0),R=async()=>{try{j.value=!0,F.value=null;const{data:$,error:n}=await M.from("pacientes").select("nombre, email").eq("id",p.value).single();if(n)throw n;P.value=$?.nombre||$?.email||"Paciente",h.value=await B(p.value),m.value=await l(p.value)}catch($){console.error("[BonosPage] Error al cargar bonos:",$),F.value=$.message||"Error al cargar los bonos"}finally{j.value=!1}},y=()=>{t.value="todos",s.value="todos",A.value="reciente"},c=()=>{x.push(`/terapeuta/pacientes/${p.value}`)},U=()=>{N.value=!0},b=()=>{N.value=!1},a=async()=>{await R()},D=$=>{T.value=$,G.value=!0},se=()=>{G.value=!1,T.value=null},ue=async()=>{await R()},ce=$=>{T.value=$,z.value=!0},me=()=>{z.value=!1,T.value=null},pe=async()=>{await R()},be=$=>{console.log("Editar bono:",$),alert("Funci√≥n de edici√≥n en desarrollo")};return _e(()=>{R()}),($,n)=>{const E=Ae,ve=no,ge=Co,xe=gt,fe=Zt;return i(),d("div",es,[e("button",{onClick:c,class:"mb-6 flex items-center gap-2 text-[#5D4A44] hover:text-[#D8AFA0] transition-colors"},[...n[4]||(n[4]=[e("span",null,"‚Üê",-1),e("span",null,"Volver a ficha del paciente",-1)])]),e("header",os,[e("div",ts,[e("div",null,[e("h1",ss,[n[5]||(n[5]=e("span",{class:"text-4xl"},"üé´",-1)),_(" Bonos de "+r(o(P)),1)]),n[6]||(n[6]=e("p",{class:"text-[#5D4A44]/60"}," Gestiona los bonos, pagos y renovaciones del paciente ",-1))]),o(k)?(i(),d("button",{key:0,onClick:U,class:"px-6 py-3 bg-[#D8AFA0] text-white rounded-lg hover:bg-[#C89B8A] transition-colors font-medium flex items-center gap-2 shadow-lg"},[...n[7]||(n[7]=[e("span",{class:"text-xl"},"+",-1),e("span",null,"Nuevo Bono",-1)])])):v("",!0)])]),o(j)?(i(),d("div",ns,[...n[8]||(n[8]=[e("div",{class:"animate-spin w-16 h-16 border-4 border-[#D8AFA0] border-t-transparent rounded-full mx-auto mb-4"},null,-1),e("p",{class:"text-[#5D4A44]/60"},"Cargando bonos...",-1)])])):o(F)?(i(),d("div",ls,[I(E,null,{default:Q(()=>[n[9]||(n[9]=e("span",{class:"text-7xl mb-4 block"},"‚ùå",-1)),n[10]||(n[10]=e("h3",{class:"text-xl font-['Lora'] font-semibold text-[#5D4A44] mb-2"}," Error al cargar bonos ",-1)),e("p",as,r(o(F)),1),e("button",{onClick:R,class:"px-6 py-3 bg-[#D8AFA0] text-white rounded-lg hover:bg-[#C89B8A] transition-colors"}," Intentar de nuevo ")]),_:1})])):(i(),d("div",rs,[e("section",is,[I(E,{class:"bg-gradient-to-br from-purple-50 to-indigo-50 border-2 border-purple-200"},{default:Q(()=>[e("div",ds,[e("div",null,[n[11]||(n[11]=e("p",{class:"text-sm text-purple-600 font-medium mb-1"},"Total Bonos",-1)),e("p",us,r(o(m).total),1)]),n[12]||(n[12]=e("span",{class:"text-4xl"},"üé´",-1))])]),_:1}),I(E,{class:"bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200"},{default:Q(()=>[e("div",cs,[e("div",null,[n[13]||(n[13]=e("p",{class:"text-sm text-green-600 font-medium mb-1"},"Activos",-1)),e("p",ms,r(o(m).activos),1)]),n[14]||(n[14]=e("span",{class:"text-4xl"},"‚úÖ",-1))])]),_:1}),I(E,{class:"bg-gradient-to-br from-orange-50 to-amber-50 border-2 border-orange-200"},{default:Q(()=>[e("div",ps,[e("div",null,[n[15]||(n[15]=e("p",{class:"text-sm text-orange-600 font-medium mb-1"},"Por Vencer",-1)),e("p",bs,r(o(m).proximosAVencer),1)]),n[16]||(n[16]=e("span",{class:"text-4xl"},"‚ö†Ô∏è",-1))])]),_:1}),I(E,{class:"bg-gradient-to-br from-yellow-50 to-amber-50 border-2 border-yellow-200"},{default:Q(()=>[e("div",vs,[e("div",null,[n[17]||(n[17]=e("p",{class:"text-sm text-yellow-600 font-medium mb-1"},"Pendientes",-1)),e("p",gs,r(o(m).pendientes),1)]),n[18]||(n[18]=e("span",{class:"text-4xl"},"‚è≥",-1))])]),_:1})]),e("section",xs,[I(E,null,{default:Q(()=>[e("div",fs,[e("div",As,[n[20]||(n[20]=e("label",{class:"block text-sm font-medium text-[#5D4A44] mb-2"}," Filtrar por Estado ",-1)),C(e("select",{"onUpdate:modelValue":n[0]||(n[0]=L=>Z(t)?t.value=L:null),class:"w-full px-4 py-2 border border-[#D8AFA0]/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D8AFA0] bg-white"},[...n[19]||(n[19]=[e("option",{value:"todos"},"Todos los estados",-1),e("option",{value:"activo"},"‚úÖ Activos",-1),e("option",{value:"pendiente"},"‚è≥ Pendientes",-1),e("option",{value:"completado"},"‚úîÔ∏è Completados",-1),e("option",{value:"vencido"},"‚ùå Vencidos",-1),e("option",{value:"cancelado"},"üö´ Cancelados",-1)])],512),[[J,o(t)]])]),e("div",ys,[n[22]||(n[22]=e("label",{class:"block text-sm font-medium text-[#5D4A44] mb-2"}," Filtrar por Tipo ",-1)),C(e("select",{"onUpdate:modelValue":n[1]||(n[1]=L=>Z(s)?s.value=L:null),class:"w-full px-4 py-2 border border-[#D8AFA0]/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D8AFA0] bg-white"},[...n[21]||(n[21]=[e("option",{value:"todos"},"Todos los tipos",-1),e("option",{value:"quincenal"},"Quincenal",-1),e("option",{value:"mensual"},"Mensual",-1),e("option",{value:"semestral"},"Semestral",-1)])],512),[[J,o(s)]])]),e("div",Ds,[n[24]||(n[24]=e("label",{class:"block text-sm font-medium text-[#5D4A44] mb-2"}," Ordenar por ",-1)),C(e("select",{"onUpdate:modelValue":n[2]||(n[2]=L=>Z(A)?A.value=L:null),class:"w-full px-4 py-2 border border-[#D8AFA0]/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D8AFA0] bg-white"},[...n[23]||(n[23]=[e("option",{value:"reciente"},"M√°s recientes",-1),e("option",{value:"antiguo"},"M√°s antiguos",-1),e("option",{value:"vencimiento"},"Por vencimiento",-1)])],512),[[J,o(A)]])])])]),_:1})]),o(H).length>0?(i(),d("section",ws,[(i(!0),d(ie,null,de(o(H),L=>(i(),ke(ve,{key:L.id,bono:L,onRenovar:ce,onVerPagos:D,onEditar:be},null,8,["bono"]))),128))])):(i(),d("section",$s,[I(E,null,{default:Q(()=>[n[25]||(n[25]=e("span",{class:"text-7xl mb-4 block opacity-40"},"üé´",-1)),e("h3",_s,r(o(h).length===0?"No hay bonos registrados":"No hay bonos con estos filtros"),1),e("p",ks,r(o(h).length===0?"Crea el primer bono para este paciente":"Intenta cambiar los filtros para ver m√°s bonos"),1),o(h).length===0&&o(k)?(i(),d("button",{key:0,onClick:U,class:"px-8 py-3 bg-[#D8AFA0] text-white rounded-lg hover:bg-[#C89B8A] transition-colors font-medium"}," + Crear Primer Bono ")):(i(),d("button",{key:1,onClick:y,class:"px-8 py-3 bg-[#5D4A44] text-white rounded-lg hover:bg-[#4A3A34] transition-colors font-medium"}," Limpiar Filtros "))]),_:1})])),o(Y)?(i(),d("section",Fs,[o(m).proximosAVencer>0?(i(),d("div",hs,[e("div",Cs,[n[27]||(n[27]=e("span",{class:"text-2xl"},"‚ö†Ô∏è",-1)),e("div",Ps,[e("h4",Bs,r(o(m).proximosAVencer)+" bono(s) pr√≥ximo(s) a vencer ",1),n[26]||(n[26]=e("p",{class:"text-sm text-orange-700"}," Hay bonos que vencer√°n en los pr√≥ximos 7 d√≠as. Considera renovarlos. ",-1))]),e("button",{onClick:n[3]||(n[3]=L=>t.value="activo"),class:"text-sm text-orange-700 hover:text-orange-900 underline"}," Ver bonos activos ")])])):v("",!0),o(m).pocasSesiones>0?(i(),d("div",Ms,[e("div",Ss,[n[29]||(n[29]=e("span",{class:"text-2xl"},"üìä",-1)),e("div",Es,[e("h4",Vs,r(o(m).pocasSesiones)+" bono(s) con pocas sesiones ",1),n[28]||(n[28]=e("p",{class:"text-sm text-blue-700"}," Algunos bonos tienen 2 o menos sesiones restantes. ",-1))])])])):v("",!0)])):v("",!0)])),I(ge,{mostrar:o(N),"paciente-id":o(p),"paciente-nombre":o(P),"psicologa-id":o(S),onClose:b,onCreated:a},null,8,["mostrar","paciente-id","paciente-nombre","psicologa-id"]),I(xe,{mostrar:o(G),bono:o(T),onClose:se,onUpdated:ue},null,8,["mostrar","bono"]),I(fe,{mostrar:o(z),bono:o(T),onClose:me,onRenovated:pe},null,8,["mostrar","bono"])])}}}),Us=te(js,[["__scopeId","data-v-64cfe15d"]]);export{Us as default};
