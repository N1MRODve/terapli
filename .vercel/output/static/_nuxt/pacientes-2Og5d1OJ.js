import{c as s,o as a,a as e,r as j,x as D,b as _,h as S,j as re,l as o,w as Ce,t as i,M as Ee,z as Pe,A as M,E as Wt,F as J,y as Y,f as Ze,B as wt,I as fe,k as Z,d as V,v as ne,K as Ie,i as vt,Y as Se,e as Re,p as $t,J as le,T as Je,ah as eo,m as _e,C as to,af as at,L as oo,g as ao}from"#entry";import{r as kt}from"./PencilIcon-QJyqa3i7.js";import{r as je}from"./TicketIcon-DRclOuRO.js";import{r as so}from"./TrashIcon-c8JhvyFk.js";import{r as De}from"./ExclamationTriangleIcon-BreoAuwB.js";import{r as ro}from"./ClockIcon-CQZt9cKZ.js";import{r as no}from"./CalendarIcon-mZ3toP8Y.js";import{r as Me}from"./ExclamationCircleIcon-Dyh9f5zH.js";import{r as io}from"./BellAlertIcon-D9Txc_Yy.js";import{r as Ct,a as rt,b as st}from"./EyeIcon-BLuiBrQZ.js";import{_ as lo}from"./ModalNuevaCita-DgVuIw_4.js";import{u as Dt}from"./useBonos-DDT1LxKM.js";import{u as St}from"./useCitas-9Z4e1_ch.js";import{u as qe}from"./useToast-Cq0GyJHs.js";import{_ as Ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as ke}from"./CheckCircleIcon-Bi0YyG7H.js";import{r as nt}from"./XCircleIcon-DIGsvT-h.js";import{r as Be}from"./XMarkIcon-DWNj0d99.js";import{r as ze}from"./DocumentTextIcon-Dp_75vtG.js";import{r as Qe}from"./CalendarDaysIcon-C0vq0F4x.js";import{r as co}from"./EnvelopeIcon-CVHiCNXI.js";import{r as uo}from"./PhoneIcon-B4J2dtua.js";import{L as po,D as mo}from"./index-BAEjFv6V.js";import{Chart as bo,CategoryScale as go,LinearScale as fo,PointElement as vo,LineElement as xo,ArcElement as ho,Title as yo,Tooltip as _o,Legend as wo,Filler as $o}from"./chart-BdQHVWbB.js";import{r as xt}from"./ChartBarIcon-Cii-u9ml.js";import{r as ht}from"./PlusIcon-UqRq4KLf.js";import{r as yt}from"./UserGroupIcon-Byc3y-S3.js";import{r as _t}from"./ClipboardDocumentListIcon-CSBwmCjC.js";import{r as ko}from"./MagnifyingGlassIcon-B5My0XuL.js";import{r as Co}from"./FunnelIcon-CO-pjLeZ.js";import{r as Do}from"./ChevronDownIcon-BwiNUDLV.js";import{r as So}from"./CurrencyDollarIcon-Dge-tWFD.js";import{r as Eo}from"./ChevronRightIcon-Ck2OajRo.js";import"./UserIcon-G1mM6o1b.js";import"./CheckBadgeIcon-CuVUaEjS.js";function Po(k,z){return a(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75"})])}function Fo(k,z){return a(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})])}function Mo(k,z){return a(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M11.35 3.836c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m8.9-4.414c.376.023.75.05 1.124.08 1.131.094 1.976 1.057 1.976 2.192V16.5A2.25 2.25 0 0 1 18 18.75h-2.25m-7.5-10.5H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V18.75m-7.5-10.5h6.375c.621 0 1.125.504 1.125 1.125v9.375m-8.25-3 1.5 1.5 3-3.75"})])}function Ao(k,z){return a(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m.75 12 3 3m0 0 3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})])}function Bo(k,z){return a(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3.75 9.776c.112-.017.227-.026.344-.026h15.812c.117 0 .232.009.344.026m-16.5 0a2.25 2.25 0 0 0-1.883 2.542l.857 6a2.25 2.25 0 0 0 2.227 1.932H19.05a2.25 2.25 0 0 0 2.227-1.932l.857-6a2.25 2.25 0 0 0-1.883-2.542m-16.5 0V6A2.25 2.25 0 0 1 6 3.75h3.879a1.5 1.5 0 0 1 1.06.44l2.122 2.12a1.5 1.5 0 0 0 1.06.44H18A2.25 2.25 0 0 1 20.25 9v.776"})])}function To(k,z){return a(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6a2.25 2.25 0 0 1-2.25-2.25V6ZM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25V18a2.25 2.25 0 0 1-2.25 2.25H6A2.25 2.25 0 0 1 3.75 18v-2.25ZM13.5 6a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 6v2.25A2.25 2.25 0 0 1 18 10.5h-2.25a2.25 2.25 0 0 1-2.25-2.25V6ZM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25H18a2.25 2.25 0 0 1 2.25 2.25V18A2.25 2.25 0 0 1 18 20.25h-2.25A2.25 2.25 0 0 1 13.5 18v-2.25Z"})])}function Vo(k,z){return a(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 0 1-1.125-1.125M3.375 19.5h7.5c.621 0 1.125-.504 1.125-1.125m-9.75 0V5.625m0 12.75v-1.5c0-.621.504-1.125 1.125-1.125m18.375 2.625V5.625m0 12.75c0 .621-.504 1.125-1.125 1.125m1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125m0 3.75h-7.5A1.125 1.125 0 0 1 12 18.375m9.75-12.75c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125m19.5 0v1.5c0 .621-.504 1.125-1.125 1.125M2.25 5.625v1.5c0 .621.504 1.125 1.125 1.125m0 0h17.25m-17.25 0h7.5c.621 0 1.125.504 1.125 1.125M3.375 8.25c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125m17.25-3.75h-7.5c-.621 0-1.125.504-1.125 1.125m8.625-1.125c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125m-17.25 0h7.5m-7.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125M12 10.875v-1.5m0 1.5c0 .621-.504 1.125-1.125 1.125M12 10.875c0 .621.504 1.125 1.125 1.125m-2.25 0c.621 0 1.125.504 1.125 1.125M13.125 12h7.5m-7.5 0c-.621 0-1.125.504-1.125 1.125M20.625 12c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125m-17.25 0h7.5M12 14.625v-1.5m0 1.5c0 .621-.504 1.125-1.125 1.125M12 14.625c0 .621.504 1.125 1.125 1.125m-2.25 0c.621 0 1.125.504 1.125 1.125m0 1.5v-1.5m0 0c0-.621.504-1.125 1.125-1.125m0 0h7.5"})])}const Io=["aria-label"],jo={class:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 group-focus-within:opacity-100 transition-all duration-200 z-10",role:"toolbar"},zo={class:"text-sm text-gray-700 text-center mb-3"},Ro={class:"flex gap-2"},qo={class:"flex items-start gap-3 mb-3"},No={class:"relative flex-shrink-0"},Oo={class:"flex-1 min-w-0 pt-0.5"},Lo={class:"font-semibold text-gray-900 text-base leading-tight truncate pr-16"},Uo={class:"flex items-center gap-2 mt-1"},Ho={key:0,class:"text-xs text-gray-400 truncate"},Go={class:"flex items-center gap-2"},Qo={class:"flex-1 min-w-0"},Zo={key:1,class:"text-sm font-medium text-amber-700"},Jo={class:"grid grid-cols-2 gap-2 text-xs"},Ko={class:"flex items-center gap-1.5"},Xo={class:"flex items-center gap-1.5 text-gray-500 justify-end"},Yo={class:"flex items-center justify-between mb-1.5"},Wo={class:"flex items-center gap-1.5"},ea={class:"flex items-center gap-1.5"},ta={class:"relative h-2 bg-gray-200 rounded-full overflow-hidden"},oa={class:"flex justify-between mt-1"},aa={key:0,class:"mt-2.5 pt-2.5 border-t border-gray-100"},sa={key:0,class:"flex items-center gap-1.5 px-2 py-1.5 bg-red-50 rounded-md text-xs"},ra={key:1,class:"flex items-center gap-1.5 px-2 py-1.5 bg-amber-50 rounded-md text-xs"},na={class:"text-amber-700 font-medium"},ia={key:2,class:"flex items-center gap-1.5 px-2 py-1.5 bg-red-50 rounded-md text-xs"},la={class:"text-red-700 font-medium"},da={__name:"PacienteCard",props:{paciente:{type:Object,required:!0}},emits:["editar","eliminar","ver-citas","gestionar-bonos","editar-cita","ver-ficha"],setup(k,{emit:z}){const m=k,O=z,f=j(!1),$=()=>{f.value=!1,O("eliminar",m.paciente)},P=D(()=>{const B=m.paciente.nombre||"Sin nombre";if(B==="Sin nombre")return"Sin nombre";const N=B.trim().split(" ");return N.length>2?`${N[0]} ${N[1]} ${N[N.length-1].charAt(0)}.`:B}),A=D(()=>{const B=m.paciente.nombre||"";if(!B)return"??";const N=B.trim().split(" ");return`${N[0]?.charAt(0)||"?"}${N[1]?.charAt(0)||""}`.toUpperCase()}),H=D(()=>{if(!m.paciente.activo)return"#9CA3AF";if(m.paciente.en_pausa)return"#F59E0B";const B=["#8B5CF6","#EC4899","#06B6D4","#10B981","#6366F1","#F97316"],N=m.paciente.id.charCodeAt(0)%B.length;return B[N]}),b=D(()=>m.paciente.activo?m.paciente.en_pausa?"ring-amber-300":"ring-purple-200":"ring-gray-300"),r=D(()=>m.paciente.activo?m.paciente.en_pausa?"bg-amber-500":"bg-green-500":"bg-gray-400"),x=D(()=>m.paciente.activo?m.paciente.en_pausa?"Pausa":"Activo":"Finalizado"),L=D(()=>m.paciente.activo?m.paciente.en_pausa?"bg-amber-100 text-amber-700":"bg-green-100 text-green-700":"bg-gray-100 text-gray-600"),C=D(()=>{if(!m.paciente.ultima_sesion)return"Sin registro";const B=new Date(m.paciente.ultima_sesion),R=Math.floor((new Date-B)/(1e3*60*60*24));return R===0?"Hoy":R===1?"Ayer":R<7?`Hace ${R} dÃ­as`:R<30?`Hace ${Math.floor(R/7)} sem`:B.toLocaleDateString("es-ES",{day:"numeric",month:"short"})}),v=D(()=>{if(!m.paciente.ultima_sesion)return"bg-gray-300";const B=c.value;return B<=7?"bg-green-500":B<=14?"bg-blue-500":B<=30?"bg-amber-500":"bg-red-500"}),F=D(()=>{if(!m.paciente.ultima_sesion)return"text-gray-400";const B=c.value;return B<=14?"text-gray-600":B<=30?"text-amber-600":"text-red-600 font-medium"}),h=D(()=>{if(!m.paciente.proxima_sesion)return null;try{let B=m.paciente.proxima_sesion;B.includes("T")||(B+="T00:00:00");const N=new Date(B);return isNaN(N.getTime())?null:N.toLocaleDateString("es-ES",{weekday:"short",day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})}catch{return null}}),y=D(()=>m.paciente.total_sesiones||0),c=D(()=>{if(!m.paciente.ultima_sesion)return 0;const B=new Date(m.paciente.ultima_sesion);return Math.floor((new Date-B)/(1e3*60*60*24))}),w=D(()=>!m.paciente.activo||m.paciente.en_pausa?!1:c.value>30),l=D(()=>m.paciente.bono_activo||null),d=D(()=>l.value?.tipo?{otro:"Demanda",quincenal:"Quinc.",semanal:"Semanal",mensual:"Mensual"}[l.value.tipo]||l.value.tipo:""),E=D(()=>l.value?.sesiones_totales||0),q=D(()=>l.value?E.value-l.value.sesiones_restantes:0),oe=D(()=>!l.value||E.value===0?0:Math.round(q.value/E.value*100)),u=D(()=>{if(!l.value)return"bg-gray-400";const B=l.value.sesiones_restantes;return B===0||B===1?"bg-red-500":B===2?"bg-amber-500":"bg-purple-500"}),t=D(()=>{if(!l.value)return"bg-gray-50";const B=l.value.sesiones_restantes;return B===0||B===1?"bg-red-50 border border-red-100":B===2?"bg-amber-50 border border-amber-100":"bg-purple-50 border border-purple-100"}),g=D(()=>{if(!l.value)return"text-gray-600";const B=l.value.sesiones_restantes;return B===0?"text-red-600":B<=2?"text-amber-600":"text-gray-700"}),U=D(()=>{if(!l.value)return"text-gray-400";const B=l.value.sesiones_restantes;return B<=1?"text-red-500":B===2?"text-amber-500":"text-purple-500"}),I=D(()=>{if(!l.value?.fecha_fin)return"â€”";try{return new Date(l.value.fecha_fin).toLocaleDateString("es-ES",{day:"numeric",month:"short"})}catch{return"â€”"}}),ae=D(()=>{if(!l.value?.fecha_fin)return"â€”";try{const B=new Date(l.value.fecha_fin),R=Math.floor((B-new Date)/(1e3*60*60*24));return R<0?"Vencido":R===0?"Vence hoy":R===1?"Vence maÃ±ana":R<=7?`Vence en ${R}d`:`Hasta ${I.value}`}catch{return"â€”"}}),G=D(()=>{if(!l.value?.fecha_fin)return"text-gray-400";const B=new Date(l.value.fecha_fin),R=Math.floor((B-new Date)/(1e3*60*60*24));return R<0?"text-red-600 font-medium":R<=7?"text-amber-600 font-medium":"text-gray-500"}),K=D(()=>l.value?l.value.sesiones_restantes===1:!1),W=D(()=>l.value?l.value.sesiones_restantes===2:!1),se=D(()=>K.value||W.value||w.value);return(B,N)=>(a(),s("article",{class:"bg-white rounded-xl border border-gray-100 p-4 hover:shadow-lg hover:border-purple-200 transition-all duration-200 group relative cursor-pointer focus-within:ring-2 focus-within:ring-purple-500 focus-within:ring-offset-2",role:"article","aria-label":`Ficha de ${o(P)}`,tabindex:"0",onClick:N[6]||(N[6]=R=>B.$emit("ver-ficha",k.paciente)),onKeydown:N[7]||(N[7]=Wt(R=>B.$emit("ver-ficha",k.paciente),["enter"]))},[e("div",jo,[e("button",{onClick:N[0]||(N[0]=re(R=>B.$emit("editar",k.paciente),["stop"])),class:"w-8 h-8 p-1.5 bg-white text-gray-600 rounded-lg hover:bg-purple-50 hover:text-purple-600 transition-colors shadow-sm border border-gray-200",title:"Editar paciente"},[_(o(kt),{class:"w-full h-full"})]),e("button",{onClick:N[1]||(N[1]=re(R=>B.$emit("gestionar-bonos",k.paciente),["stop"])),class:"w-8 h-8 p-1.5 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors shadow-sm",title:"Gestionar bonos"},[_(o(je),{class:"w-full h-full"})]),e("button",{onClick:N[2]||(N[2]=re(R=>f.value=!0,["stop"])),class:"w-6 h-6 p-1 bg-gray-50 text-gray-400 rounded hover:bg-red-50 hover:text-red-500 transition-colors ml-1",title:"Eliminar"},[_(o(so),{class:"w-full h-full"})])]),_(Ee,{"enter-active-class":"transition-all duration-150 ease-out","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition-all duration-100 ease-in","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:Ce(()=>[o(f)?(a(),s("div",{key:0,class:"absolute top-0 left-0 right-0 bottom-0 bg-white/95 backdrop-blur-sm rounded-xl flex flex-col items-center justify-center z-20 p-4",onClick:N[4]||(N[4]=re(()=>{},["stop"]))},[_(o(De),{class:"w-8 h-8 text-red-500 mb-2"}),e("p",zo,"Â¿Eliminar a "+i(o(P))+"?",1),e("div",Ro,[e("button",{onClick:N[3]||(N[3]=re(R=>f.value=!1,["stop"])),class:"px-3 py-1.5 text-sm text-gray-600 hover:text-gray-800 transition-colors"}," Cancelar "),e("button",{onClick:re($,["stop"]),class:"px-3 py-1.5 text-sm bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors"}," Eliminar ")])])):S("",!0)]),_:1}),e("div",qo,[e("div",No,[e("div",{class:M(["w-12 h-12 rounded-full flex items-center justify-center text-white font-bold text-lg ring-2 ring-offset-1",o(b)]),style:Pe({backgroundColor:o(H)})},i(o(A)),7),e("span",{class:M(["absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 rounded-full border-2 border-white",o(r)])},null,2)]),e("div",Oo,[e("h3",Lo,i(o(P)),1),e("div",Uo,[e("span",{class:M(["inline-flex items-center px-2 py-0.5 text-xs font-medium rounded-full",o(L)])},i(o(x)),3),k.paciente.area_de_acompanamiento?(a(),s("span",Ho,i(k.paciente.area_de_acompanamiento),1)):S("",!0)])])]),e("div",{class:M(["mb-3 p-2.5 rounded-lg",o(h)?"bg-purple-50 border border-purple-100":"bg-amber-50 border border-amber-100"])},[e("div",Go,[_(o(ro),{class:M(["w-4 h-4 flex-shrink-0",o(h)?"text-purple-500":"text-amber-500"])},null,8,["class"]),e("div",Qo,[N[8]||(N[8]=e("p",{class:"text-xs text-gray-500 mb-0.5"},"PrÃ³xima cita",-1)),o(h)?(a(),s("button",{key:0,onClick:N[5]||(N[5]=re(R=>B.$emit("editar-cita",k.paciente.proxima_cita_id),["stop"])),class:"text-sm font-semibold text-purple-700 hover:text-purple-800 transition-colors truncate block w-full text-left"},i(o(h)),1)):(a(),s("p",Zo,"Sin cita programada"))])])],2),e("div",Jo,[e("div",Ko,[e("div",{class:M(["w-2 h-2 rounded-full flex-shrink-0",o(v)])},null,2),_(o(no),{class:"w-3.5 h-3.5 text-gray-400"}),e("span",{class:M(o(F))},i(o(C)),3)]),e("div",Xo,[e("span",null,i(o(y))+" sesiones",1)]),o(l)?(a(),s("div",{key:0,class:M(["col-span-2 mt-2 p-2 rounded-lg",o(t)])},[e("div",Yo,[e("div",Wo,[_(o(je),{class:M(["w-3.5 h-3.5 flex-shrink-0",o(U)])},null,8,["class"]),e("span",{class:M(["font-medium text-xs",o(g)])},i(o(d)),3)]),e("div",ea,[e("span",{class:M(["text-xs",o(G)])},i(o(ae)),3)])]),e("div",ta,[e("div",{class:M(["absolute left-0 top-0 h-full rounded-full transition-all duration-300",o(u)]),style:Pe({width:o(oe)+"%"})},null,6)]),e("div",oa,[e("span",{class:M(["text-[10px]",o(g)])},i(o(q))+" usadas ",3),e("span",{class:M(["text-[10px] font-semibold",o(g)])},i(o(l).sesiones_restantes)+" restantes ",3)])],2)):S("",!0)]),o(se)?(a(),s("div",aa,[o(K)?(a(),s("div",sa,[_(o(De),{class:"w-3.5 h-3.5 text-red-500"}),N[9]||(N[9]=e("span",{class:"text-red-700 font-medium"},"Ãšltima sesiÃ³n del bono",-1))])):o(W)?(a(),s("div",ra,[_(o(Me),{class:"w-3.5 h-3.5 text-amber-500"}),e("span",na,i(o(l).sesiones_restantes)+" sesiones restantes",1)])):o(w)?(a(),s("div",ia,[_(o(io),{class:"w-3.5 h-3.5 text-red-500"}),e("span",la,i(o(c))+" dÃ­as sin sesiÃ³n",1)])):S("",!0)])):S("",!0)],40,Io))}},ca={class:"overflow-x-auto"},ua={class:"min-w-full divide-y divide-gray-200"},pa={class:"bg-white divide-y divide-gray-100"},ma=["onClick"],ba={class:"px-4 py-3 whitespace-nowrap"},ga={class:"flex items-center gap-3"},fa={class:"min-w-0"},va={class:"text-sm font-medium text-gray-900 truncate max-w-[200px]"},xa={key:0,class:"text-xs text-gray-500 truncate max-w-[200px]"},ha={class:"px-4 py-3 whitespace-nowrap"},ya={class:"px-4 py-3 whitespace-nowrap"},_a={key:0,class:"flex items-center gap-1.5"},wa={class:"text-sm text-gray-900"},$a={key:1,class:"text-sm text-amber-600 font-medium"},ka={class:"px-4 py-3 whitespace-nowrap"},Ca={class:"flex items-center gap-1.5"},Da={class:"px-4 py-3 whitespace-nowrap"},Sa={key:0,class:"flex items-center gap-2"},Ea={class:"w-16 h-1.5 bg-gray-200 rounded-full overflow-hidden"},Pa={key:1,class:"text-xs text-gray-400"},Fa={class:"px-4 py-3 whitespace-nowrap text-right"},Ma={class:"flex items-center justify-end gap-1"},Aa=["onClick"],Ba=["onClick"],Ta=["onClick"],Va={key:0,class:"py-12 text-center"},Ia={__name:"PacienteTabla",props:{pacientes:{type:Array,required:!0}},emits:["ver-ficha","editar","gestionar-bonos","ver-preview"],setup(k){const z=C=>{if(!C)return"??";const v=C.trim().split(" ");return`${v[0]?.charAt(0)||"?"}${v[1]?.charAt(0)||""}`.toUpperCase()},m=C=>{if(!C.activo)return"#9CA3AF";if(C.en_pausa)return"#F59E0B";const v=["#8B5CF6","#EC4899","#06B6D4","#10B981","#6366F1","#F97316"],F=C.id.charCodeAt(0)%v.length;return v[F]},O=C=>C.activo?C.en_pausa?"Pausa":"Activo":"Finalizado",f=C=>C.activo?C.en_pausa?"bg-amber-100 text-amber-700":"bg-green-100 text-green-700":"bg-gray-100 text-gray-600",$=C=>{if(!C)return null;try{let v=C;v.includes("T")||(v+="T00:00:00");const F=new Date(v);return isNaN(F.getTime())?null:F.toLocaleDateString("es-ES",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})}catch{return null}},P=C=>{if(!C)return"Sin registro";const v=new Date(C),h=Math.floor((new Date-v)/(1e3*60*60*24));return h===0?"Hoy":h===1?"Ayer":h<7?`Hace ${h}d`:h<30?`Hace ${Math.floor(h/7)}sem`:v.toLocaleDateString("es-ES",{day:"numeric",month:"short"})},A=C=>{if(!C.ultima_sesion)return 999;const v=new Date(C.ultima_sesion);return Math.floor((new Date-v)/864e5)},H=C=>{if(!C.ultima_sesion)return"bg-gray-300";const v=A(C);return v<=7?"bg-green-500":v<=14?"bg-blue-500":v<=30?"bg-amber-500":"bg-red-500"},b=C=>{if(!C.ultima_sesion)return"text-gray-400";const v=A(C);return v<=14?"text-gray-600":v<=30?"text-amber-600":"text-red-600 font-medium"},r=C=>{if(!C||C.sesiones_totales===0)return 0;const v=C.sesiones_totales-C.sesiones_restantes;return Math.round(v/C.sesiones_totales*100)},x=C=>C?C.sesiones_restantes<=1?"bg-red-500":C.sesiones_restantes===2?"bg-amber-500":"bg-purple-500":"bg-gray-400",L=C=>C?C.sesiones_restantes<=1?"text-red-600":C.sesiones_restantes===2?"text-amber-600":"text-gray-700":"text-gray-600";return(C,v)=>(a(),s("div",ca,[e("table",ua,[v[1]||(v[1]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Paciente "),e("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado "),e("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," PrÃ³xima cita "),e("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Ãšltima sesiÃ³n "),e("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Bono "),e("th",{scope:"col",class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," Acciones ")])],-1)),e("tbody",pa,[(a(!0),s(J,null,Y(k.pacientes,F=>(a(),s("tr",{key:F.id,class:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:h=>C.$emit("ver-ficha",F)},[e("td",ba,[e("div",ga,[e("div",{class:"w-8 h-8 rounded-full flex items-center justify-center text-white text-xs font-bold flex-shrink-0",style:Pe({backgroundColor:m(F)})},i(z(F.nombre)),5),e("div",fa,[e("p",va,i(F.nombre||"Sin nombre"),1),F.area_de_acompanamiento?(a(),s("p",xa,i(F.area_de_acompanamiento),1)):S("",!0)])])]),e("td",ha,[e("span",{class:M(["inline-flex items-center px-2 py-0.5 text-xs font-medium rounded-full",f(F)])},i(O(F)),3)]),e("td",ya,[F.proxima_sesion?(a(),s("div",_a,[v[0]||(v[0]=e("div",{class:"w-2 h-2 rounded-full bg-purple-500"},null,-1)),e("span",wa,i($(F.proxima_sesion)),1)])):(a(),s("span",$a,"Sin cita"))]),e("td",ka,[e("div",Ca,[e("div",{class:M(["w-2 h-2 rounded-full",H(F)])},null,2),e("span",{class:M(["text-sm",b(F)])},i(P(F.ultima_sesion)),3)])]),e("td",Da,[F.bono_activo?(a(),s("div",Sa,[e("div",Ea,[e("div",{class:M(["h-full rounded-full",x(F.bono_activo)]),style:Pe({width:r(F.bono_activo)+"%"})},null,6)]),e("span",{class:M(["text-xs font-medium",L(F.bono_activo)])},i(F.bono_activo.sesiones_restantes)+"/"+i(F.bono_activo.sesiones_totales),3)])):(a(),s("span",Pa,"â€”"))]),e("td",Fa,[e("div",Ma,[e("button",{onClick:re(h=>C.$emit("editar",F),["stop"]),class:"p-1.5 text-gray-400 hover:text-purple-600 hover:bg-purple-50 rounded transition-colors",title:"Editar"},[_(o(kt),{class:"w-4 h-4"})],8,Aa),e("button",{onClick:re(h=>C.$emit("gestionar-bonos",F),["stop"]),class:"p-1.5 text-gray-400 hover:text-purple-600 hover:bg-purple-50 rounded transition-colors",title:"Bonos"},[_(o(je),{class:"w-4 h-4"})],8,Ba),e("button",{onClick:re(h=>C.$emit("ver-preview",F),["stop"]),class:"p-1.5 text-gray-400 hover:text-purple-600 hover:bg-purple-50 rounded transition-colors",title:"Vista rÃ¡pida"},[_(o(Ct),{class:"w-4 h-4"})],8,Ta)])])],8,ma))),128))])]),k.pacientes.length===0?(a(),s("div",Va,[...v[2]||(v[2]=[e("p",{class:"text-sm text-gray-500"},"No hay pacientes que mostrar",-1)])])):S("",!0)]))}},ja={class:"bg-white/95 backdrop-blur-lg rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto border border-white/30"},za={class:"space-y-4"},Ra={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},qa={class:"relative"},Na={class:"space-y-4 pt-4 border-t border-neutral-200"},Oa={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},La={class:"relative"},Ua={class:"flex gap-2 flex-wrap mt-2"},Ha=["onClick"],Ga={class:"space-y-4 pt-4 border-t border-[#5550F2]/30"},Qa={class:"border-t pt-6"},Za={key:0,class:"bg-amber-50 border-2 border-amber-200 rounded-lg p-4 mb-3"},Ja={key:1,class:"text-sm text-cafe/70 mb-3"},Ka=["disabled"],Xa={key:0,class:"border-2 border-purple-400/40 rounded-lg p-5 space-y-4 bg-gradient-to-br from-purple-50 to-purple-100/50"},Ya={class:"bg-white border-2 border-purple-300 rounded-lg p-4 shadow-sm"},Wa={class:"flex items-start gap-3"},es={class:"flex-1"},ts={class:"font-semibold text-purple-900 mb-1"},os={class:"grid grid-cols-2 gap-3 text-sm"},as={class:"flex items-center gap-2"},ss={class:"text-purple-800"},rs={key:0,class:"flex items-center gap-2"},ns={class:"text-purple-800"},is={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ls={class:"relative"},ds=["required"],cs={class:"px-4 py-2 bg-purple-100 rounded-lg border border-purple-300"},us={class:"text-lg font-bold text-purple-700"},ps={class:"md:col-span-2"},ms={class:"flex items-start gap-3 p-4 bg-white border-2 border-purple-200 rounded-lg cursor-pointer hover:bg-purple-50 hover:border-purple-300 transition-all"},bs={key:0,class:"p-3 bg-white rounded-lg border border-purple-300"},gs={class:"grid grid-cols-3 gap-2 text-xs"},fs={class:"font-medium text-[#2D3748] ml-1"},vs={class:"font-medium text-[#2D3748] ml-1"},xs={class:"font-medium text-[#2D3748] ml-1"},hs={class:"space-y-4 pt-4 border-t border-[#5550F2]/30"},ys={key:0,class:"bg-red-50 border border-red-200 rounded-lg p-4"},_s={class:"text-sm text-red-600"},ws={class:"sticky bottom-0 bg-gradient-to-r from-white/95 via-white/90 to-white/95 backdrop-blur-md pt-4 pb-2 border-t border-neutral-200 -mx-6 px-6 mt-6 shadow-sm"},$s={class:"flex justify-between items-center gap-3"},ks={class:"flex gap-3"},Cs=["disabled"],Ds=["disabled"],Ss={key:0,class:"inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"},Es={key:1},Ps={__name:"ModalNuevoPaciente",props:{mostrar:{type:Boolean,default:!1}},emits:["cerrar","paciente-creado"],setup(k,{emit:z}){const m=k,O=z,{supabase:f,waitForUser:$,getUserId:P}=Ze(),{crearBono:A}=Dt(),{crearCita:H}=St(),b=wt(),r=j({nombre:"",apellido:"",email:"",telefono:"",fecha_nacimiento:"",tipo_bono:"",primera_sesion:"",activo:!0,notas_iniciales:"",crear_bono:!1,bono_monto:0,bono_renovacion_automatica:!1}),x=j(!1),L=j(""),C={otro:60,quincenal:100,semanal:160,mensual:180},v=D(()=>{const u=r.value.tipo_bono;return u&&{otro:1,quincenal:2,semanal:4,mensual:4}[u]||0}),F=D(()=>{const u=r.value.tipo_bono;return{otro:"A Demanda",quincenal:"Quincenal",semanal:"Semanal",mensual:"Mensual"}[u]||"No seleccionado"}),h=D(()=>{const u=v.value,t=r.value.bono_monto;return!u||!t||u<=0?"0.00":(t/u).toFixed(2)}),y=D(()=>{const u=r.value.tipo_bono;return u&&C[u]||0}),c=D(()=>r.value.tipo_bono==="otro"),w=D(()=>{const u=new Date,t=[],g=(K,W)=>{const se=K.getFullYear(),B=String(K.getMonth()+1).padStart(2,"0"),N=String(K.getDate()).padStart(2,"0");return`${se}-${B}-${N}T${W}`},U=new Date(u);U.setDate(U.getDate()+1),t.push({label:"ðŸŒ… MaÃ±ana 10:00",datetime:g(U,"10:00")});const I=new Date(u),ae=(8-I.getDay())%7;I.setDate(I.getDate()+(ae||7)),t.push({label:"ðŸ“… PrÃ³ximo Lun 09:00",datetime:g(I,"09:00")});const G=new Date(u);return G.setDate(G.getDate()+7),t.push({label:"ðŸ—“ï¸ En 7 dÃ­as 16:00",datetime:g(G,"16:00")}),t}),l=D(()=>{const u=r.value.nombre&&r.value.apellido&&r.value.email&&r.value.tipo_bono&&r.value.primera_sesion;return r.value.crear_bono?u&&r.value.bono_monto>0:u});fe(()=>r.value.tipo_bono,u=>{u==="otro"?(r.value.crear_bono=!1,r.value.bono_monto=0):r.value.crear_bono&&r.value.bono_monto===0&&(r.value.bono_monto=C[u]||0)}),fe(()=>r.value.crear_bono,u=>{u&&r.value.tipo_bono&&r.value.bono_monto===0&&(r.value.bono_monto=C[r.value.tipo_bono]||0)}),fe(()=>m.mostrar,u=>{u&&E()});const d=(u,t)=>{if(u.target&&u.target.showPicker)try{u.target.showPicker()}catch{console.log("showPicker no disponible")}else if(t){const g=document.getElementById(t);g&&(g.focus(),g.click())}},E=()=>{r.value={nombre:"",apellido:"",email:"",telefono:"",fecha_nacimiento:"",tipo_bono:"",primera_sesion:"",activo:!0,notas_iniciales:"",crear_bono:!1,bono_monto:0,bono_renovacion_automatica:!1},L.value=""},q=()=>{x.value||O("cerrar")},oe=async()=>{try{x.value=!0,L.value="",await $();const u=P();if(!u)throw new Error("Usuario no autenticado. Por favor, vuelve a iniciar sesiÃ³n.");console.log("ðŸ†• Creando nuevo paciente...");const t=`${r.value.nombre.trim()} ${r.value.apellido.trim()}`;console.log("ðŸ“ Llamando a crear_paciente_simple...");const{data:g,error:U}=await f.rpc("crear_paciente_simple",{p_email:r.value.email,p_nombre_completo:t,p_telefono:r.value.telefono||null,p_area_acompanamiento:null,p_tipo_bono:r.value.tipo_bono||null,p_terapeuta_id:u,p_metadata:{nombre:r.value.nombre,apellido:r.value.apellido,fecha_nacimiento:r.value.fecha_nacimiento,notas_iniciales:r.value.notas_iniciales,fecha_registro:new Date().toISOString(),primera_sesion:r.value.primera_sesion,estado_registro:"activo"}});if(U)throw console.error("âŒ Error en RPC crear_paciente_simple:",U),new Error(`Error al crear paciente: ${U.message}`);if(!g||!g.id){const G="Error desconocido al crear paciente";throw console.error("âŒ RPC devolviÃ³ resultado invÃ¡lido:",g),new Error(G)}console.log("âœ… Paciente creado exitosamente:",g);const I=g.id,ae=null;if(r.value.crear_bono&&r.value.tipo_bono&&r.value.bono_monto)try{console.log("ðŸ’³ Creando bono inicial ANTES de la cita...");const G=new Date().toISOString().split("T")[0];let K=null;const W=r.value.tipo_bono;if(W==="otro"){const R=new Date;R.setMonth(R.getMonth()+1),K=R.toISOString().split("T")[0]}else if(W==="quincenal"){const R=new Date;R.setDate(R.getDate()+15),K=R.toISOString().split("T")[0]}else if(W==="semanal"){const R=new Date;R.setMonth(R.getMonth()+1),K=R.toISOString().split("T")[0]}else if(W==="mensual"){const R=new Date;R.setMonth(R.getMonth()+1),K=R.toISOString().split("T")[0]}const se=v.value,B={paciente_id:I,terapeuta_id:u,tipo:W,sesiones_totales:se,sesiones_restantes:se,fecha_inicio:G,fecha_fin:K,estado:"pendiente",monto_total:r.value.bono_monto,precio_por_sesion:r.value.bono_monto/se,pagado:!1,renovacion_automatica:r.value.bono_renovacion_automatica,notas:`Bono creado al registrar paciente. ${t}`,metadata:{creado_con_paciente:!0,fecha_creacion:new Date().toISOString()}};console.log("ðŸ“¦ Datos del bono a crear:",B);const N=await A(B);N&&console.log("âœ… Bono creado exitosamente:",N)}catch(G){console.error("âš ï¸ Error al crear bono:",G),L.value=`Paciente creado, pero hubo un error al crear el bono: ${G.message}`}if(r.value.primera_sesion)try{console.log("ðŸ“… Creando cita para primera sesiÃ³n..."),console.log("ðŸ“‹ Datos del paciente:",{pacienteId:I,nombreCompleto:t,userId:u}),console.log("ðŸ“‹ Primera sesiÃ³n:",r.value.primera_sesion);const[G,K]=r.value.primera_sesion.split("T");console.log("ðŸ“‹ Fecha parseada:",G,"Hora parseada:",K);const[W,se]=K.split(":").map(Number),B=`${String(W+1).padStart(2,"0")}:${String(se).padStart(2,"0")}`;console.log("ðŸ“‹ Hora inicio:",K,"Hora fin:",B);const N=await H({paciente_id:I,paciente_nombre:t,terapeuta_id:u,fecha:G,hora_inicio:K,hora_fin:B,modalidad:"online",estado:"pendiente",notas:`Primera sesiÃ³n programada al registrar paciente: ${t}`,descontar_de_bono:!1});console.log("ðŸ“‹ Resultado completo de crearCita:",N),N.success?console.log("âœ… Cita de primera sesiÃ³n creada exitosamente:",N.data):(console.error("âŒ ERROR al crear la cita de primera sesiÃ³n:",N.error),L.value=`Paciente creado, pero hubo un error al crear la cita: ${N.error}`)}catch(G){console.error("âŒ EXCEPCIÃ“N al crear cita de primera sesiÃ³n:",G),L.value=`Paciente creado, pero hubo un error al crear la cita: ${G.message}`}if(r.value.notas_iniciales&&await f.from("notas_terapeuticas").insert({paciente_id:I,terapeuta_id:b.value.id,contenido:r.value.notas_iniciales,tipo:"evaluacion_inicial"}),r.value.crear_bono&&r.value.tipo_bono&&r.value.bono_monto)try{console.log("ðŸ’³ Creando bono inicial...");const G=new Date().toISOString().split("T")[0];let K=null;const W=r.value.tipo_bono;if(W==="otro"){const R=new Date;R.setMonth(R.getMonth()+1),K=R.toISOString().split("T")[0]}else if(W==="quincenal"){const R=new Date;R.setDate(R.getDate()+15),K=R.toISOString().split("T")[0]}else if(W==="semanal"){const R=new Date;R.setMonth(R.getMonth()+1),K=R.toISOString().split("T")[0]}else if(W==="mensual"){const R=new Date;R.setMonth(R.getMonth()+1),K=R.toISOString().split("T")[0]}const se=v.value,B={paciente_id:I,terapeuta_id:u,tipo:W,sesiones_totales:se,sesiones_restantes:se,fecha_inicio:G,fecha_fin:K,estado:"pendiente",monto_total:r.value.bono_monto,precio_por_sesion:r.value.bono_monto/se,pagado:!1,renovacion_automatica:r.value.bono_renovacion_automatica,notas:`Bono creado al registrar paciente. ${t}`,metadata:{creado_con_paciente:!0,fecha_creacion:new Date().toISOString()}};console.log("ðŸ“¦ Datos del bono a crear:",B);const N=await A(B);N&&console.log("âœ… Bono creado exitosamente:",N)}catch(G){console.error("âš ï¸ Error al crear bono:",G),L.value=`Paciente creado, pero hubo un error al crear el bono: ${G.message}`}O("paciente-creado",g),O("cerrar"),E()}catch(u){console.error("Error al crear paciente:",u),L.value=u.message||"Error al crear el paciente. Por favor, intenta nuevamente."}finally{x.value=!1}};return(u,t)=>k.mostrar?(a(),s("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:re(q,["self"])},[e("div",ja,[e("div",{class:"sticky top-0 bg-gradient-to-r from-[#5550F2]/5 via-[#027368]/5 to-[#04BF9D]/5 backdrop-blur-md border-b border-neutral-200 px-6 py-4 flex justify-between items-center shadow-sm"},[t[16]||(t[16]=e("h2",{class:"text-2xl font-['Elms_Sans'] text-neutral-800 font-semibold"}," Nuevo Paciente ",-1)),e("button",{onClick:q,class:"text-neutral-600 hover:text-[#027368] transition-colors p-2 hover:bg-white/50 rounded-lg","aria-label":"Cerrar modal"},[...t[15]||(t[15]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("form",{onSubmit:re(oe,["prevent"]),class:"px-6 py-6 space-y-6 bg-gradient-to-b from-white/50 to-transparent"},[e("div",za,[t[24]||(t[24]=e("h3",{class:"text-lg font-['Elms_Sans'] text-neutral-800 font-semibold"}," InformaciÃ³n Personal ",-1)),e("div",Ra,[e("div",null,[t[17]||(t[17]=e("label",{for:"nombre",class:"block text-sm font-medium text-neutral-700 mb-1"},[V(" Nombre "),e("span",{class:"text-red-500"},"*")],-1)),Z(e("input",{id:"nombre","onUpdate:modelValue":t[0]||(t[0]=g=>r.value.nombre=g),type:"text",required:"",class:"w-full px-4 py-2 border border-neutral-300 rounded-xl focus:ring-2 focus:ring-[#027368]/20 focus:border-[#027368] bg-white/90 backdrop-blur-sm transition-all shadow-sm",placeholder:"Nombre del paciente"},null,512),[[ne,r.value.nombre]])]),e("div",null,[t[18]||(t[18]=e("label",{for:"apellido",class:"block text-sm font-medium text-neutral-700 mb-1"},[V(" Apellido "),e("span",{class:"text-red-500"},"*")],-1)),Z(e("input",{id:"apellido","onUpdate:modelValue":t[1]||(t[1]=g=>r.value.apellido=g),type:"text",required:"",class:"w-full px-4 py-2 border border-neutral-300 rounded-xl focus:ring-2 focus:ring-[#027368]/20 focus:border-[#027368] bg-white/90 backdrop-blur-sm transition-all shadow-sm",placeholder:"Apellido(s) del paciente"},null,512),[[ne,r.value.apellido]])]),e("div",null,[t[19]||(t[19]=e("label",{for:"email",class:"block text-sm font-medium text-neutral-700 mb-1"},[V(" Email "),e("span",{class:"text-red-500"},"*")],-1)),Z(e("input",{id:"email","onUpdate:modelValue":t[2]||(t[2]=g=>r.value.email=g),type:"email",required:"",class:"w-full px-4 py-2 border border-neutral-300 rounded-xl focus:ring-2 focus:ring-[#027368]/20 focus:border-[#027368] bg-white/90 backdrop-blur-sm transition-all shadow-sm",placeholder:"correo@ejemplo.com"},null,512),[[ne,r.value.email]])]),e("div",null,[t[20]||(t[20]=e("label",{for:"telefono",class:"block text-sm font-medium text-neutral-700 mb-1"}," TelÃ©fono ",-1)),Z(e("input",{id:"telefono","onUpdate:modelValue":t[3]||(t[3]=g=>r.value.telefono=g),type:"tel",class:"w-full px-4 py-2 border border-neutral-300 rounded-xl focus:ring-2 focus:ring-[#027368]/20 focus:border-[#027368] bg-white/90 backdrop-blur-sm transition-all shadow-sm",placeholder:"+52 123 456 7890"},null,512),[[ne,r.value.telefono]])]),e("div",null,[t[22]||(t[22]=e("label",{for:"fecha_nacimiento",class:"block text-sm font-medium text-[#2D3748] mb-1"}," Fecha de Nacimiento ",-1)),e("div",qa,[Z(e("input",{id:"fecha_nacimiento","onUpdate:modelValue":t[4]||(t[4]=g=>r.value.fecha_nacimiento=g),type:"date",class:"w-full px-4 py-2 pr-12 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white cursor-pointer",onFocus:t[5]||(t[5]=g=>d(g))},null,544),[[ne,r.value.fecha_nacimiento]]),e("button",{type:"button",onClick:t[6]||(t[6]=g=>d(g,"fecha_nacimiento")),class:"absolute right-2 top-1/2 -translate-y-1/2 p-2 text-[#5550F2] hover:text-[#2D3748] transition-colors",title:"Abrir calendario"},[...t[21]||(t[21]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)])])]),t[23]||(t[23]=e("p",{class:"text-xs text-cafe/60 mt-1"}," ðŸ’¡ Puedes escribir la fecha o usar el calendario ",-1))])])]),e("div",Na,[t[31]||(t[31]=e("h3",{class:"text-lg font-['Elms_Sans'] text-neutral-800 font-semibold"}," InformaciÃ³n TerapÃ©utica ",-1)),e("div",Oa,[e("div",null,[t[26]||(t[26]=e("label",{for:"tipo_bono",class:"block text-sm font-medium text-[#2D3748] mb-1"},[V(" Tipo de Bono "),e("span",{class:"text-red-500"},"*")],-1)),Z(e("select",{id:"tipo_bono","onUpdate:modelValue":t[7]||(t[7]=g=>r.value.tipo_bono=g),required:"",class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white"},[...t[25]||(t[25]=[vt('<option value="">Selecciona tipo de bono</option><option value="otro">A Demanda (1 sesiÃ³n - 60â‚¬ - sin compromiso)</option><option value="quincenal">Quincenal (2 sesiones/mes - 100â‚¬)</option><option value="semanal">Semanal (4 sesiones/mes - 160â‚¬)</option><option value="mensual">Mensual</option>',5)])],512),[[Ie,r.value.tipo_bono]]),t[27]||(t[27]=e("p",{class:"text-xs text-cafe/60 mt-1"}," ðŸŽ« Define el tipo de bono del paciente ",-1))]),e("div",null,[t[29]||(t[29]=e("label",{for:"primera_sesion",class:"block text-sm font-medium text-[#2D3748] mb-1"},[V(" Primera SesiÃ³n "),e("span",{class:"text-red-500"},"*")],-1)),e("div",La,[Z(e("input",{id:"primera_sesion","onUpdate:modelValue":t[8]||(t[8]=g=>r.value.primera_sesion=g),type:"datetime-local",required:"",step:"1800",class:"w-full px-4 py-2 pr-12 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white cursor-pointer",onFocus:t[9]||(t[9]=g=>d(g))},null,544),[[ne,r.value.primera_sesion]]),e("button",{type:"button",onClick:t[10]||(t[10]=g=>d(g,"primera_sesion")),class:"absolute right-2 top-1/2 -translate-y-1/2 p-2 text-[#5550F2] hover:text-[#2D3748] transition-colors",title:"Abrir selector de fecha y hora"},[...t[28]||(t[28]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)])])]),e("div",Ua,[(a(!0),s(J,null,Y(o(w),(g,U)=>(a(),s("button",{key:U,type:"button",onClick:I=>r.value.primera_sesion=g.datetime,class:M(["text-xs px-3 py-1.5 rounded-lg border transition-all",r.value.primera_sesion===g.datetime?"bg-[#5550F2] text-white border-[#5550F2] font-semibold":"bg-white text-[#2D3748] border-[#5550F2]/30 hover:border-[#5550F2] hover:bg-[#5550F2]/10"])},i(g.label),11,Ha))),128))]),t[30]||(t[30]=e("p",{class:"text-xs text-cafe/60 mt-1"}," ðŸ’¡ Puedes escribir la fecha/hora o usar el selector ",-1))])])]),e("div",Ga,[e("div",Qa,[t[33]||(t[33]=e("h3",{class:"text-lg font-serif text-[#2D3748] font-semibold mb-2"}," ðŸ’³ Bono Inicial (Opcional) ",-1)),o(c)?(a(),s("div",Za,[...t[32]||(t[32]=[e("div",{class:"flex items-start gap-3"},[e("span",{class:"text-2xl"},"â„¹ï¸"),e("div",null,[e("p",{class:"text-sm font-semibold text-amber-900 mb-1"},' SesiÃ³n "A Demanda" seleccionada '),e("p",{class:"text-sm text-amber-800"},[V(" Las sesiones a demanda son "),e("strong",null,"sin compromiso"),V(" y se pagan individualmente (60â‚¬ por sesiÃ³n). No es necesario crear un bono prepagado. ")])])],-1)])])):(a(),s("p",Ja," Crea un bono prepagado para que el paciente empiece su tratamiento. PodrÃ¡s confirmar el pago despuÃ©s. ")),e("label",{class:M(["flex items-center gap-3 p-3 rounded-lg transition-colors",o(c)?"bg-gray-100 border-2 border-gray-200 cursor-not-allowed opacity-60":"bg-purple-50 border-2 border-purple-200 cursor-pointer hover:bg-purple-100"])},[Z(e("input",{"onUpdate:modelValue":t[11]||(t[11]=g=>r.value.crear_bono=g),type:"checkbox",disabled:o(c),class:"w-5 h-5 text-purple-600 border-gray-300 rounded focus:ring-purple-500 disabled:opacity-50 disabled:cursor-not-allowed"},null,8,Ka),[[Se,r.value.crear_bono]]),e("span",{class:M(["text-sm font-semibold",o(c)?"text-gray-500":"text-purple-700"])}," âœ… SÃ­, crear bono prepagado para este paciente ",2)],2)]),r.value.crear_bono?(a(),s("div",Xa,[e("div",Ya,[e("div",Wa,[t[38]||(t[38]=e("div",{class:"w-10 h-10 bg-purple-500 rounded-full flex items-center justify-center flex-shrink-0"},[e("span",{class:"text-white text-xl"},"ðŸŽŸï¸")],-1)),e("div",es,[e("h4",ts," Tipo de Bono: "+i(o(F)||"Selecciona un tipo arriba"),1),e("div",os,[e("div",as,[t[34]||(t[34]=e("span",{class:"text-purple-600"},"ðŸ“Š",-1)),e("span",ss,[e("strong",null,i(o(v)),1),V(" "+i(o(v)===1?"sesiÃ³n":"sesiones"),1)])]),o(y)>0?(a(),s("div",rs,[t[36]||(t[36]=e("span",{class:"text-purple-600"},"ðŸ’°",-1)),e("span",ns,[t[35]||(t[35]=V(" Precio sugerido: ",-1)),e("strong",null,"â‚¬"+i(o(y)),1)])])):S("",!0)]),t[37]||(t[37]=e("p",{class:"text-xs text-purple-600 mt-2 bg-purple-50 p-2 rounded"},[V(" ðŸ’¡ "),e("strong",null,"Tip:"),V(" Los precios se calcularÃ¡n automÃ¡ticamente segÃºn el tipo de bono ")],-1))])])]),e("div",is,[e("div",null,[t[40]||(t[40]=e("label",{for:"bono_monto",class:"block text-sm font-medium text-[#2D3748] mb-1"},[V(" Monto Total "),e("span",{class:"text-red-500"},"*")],-1)),e("div",ls,[t[39]||(t[39]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-[#2D3748]/60"},"â‚¬",-1)),Z(e("input",{id:"bono_monto","onUpdate:modelValue":t[12]||(t[12]=g=>r.value.bono_monto=g),type:"number",min:"0",step:"0.01",required:r.value.crear_bono,placeholder:"0.00",class:"w-full pl-8 pr-4 py-2 border border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500 bg-white"},null,8,ds),[[ne,r.value.bono_monto,void 0,{number:!0}]])])]),e("div",null,[t[41]||(t[41]=e("label",{class:"block text-sm font-medium text-[#2D3748] mb-1"}," Precio por SesiÃ³n ",-1)),e("div",cs,[e("span",us,"â‚¬"+i(o(h)),1)])]),e("div",ps,[e("label",ms,[Z(e("input",{"onUpdate:modelValue":t[13]||(t[13]=g=>r.value.bono_renovacion_automatica=g),type:"checkbox",class:"mt-1 w-5 h-5 text-purple-600 border-gray-300 rounded focus:ring-purple-500"},null,512),[[Se,r.value.bono_renovacion_automatica]]),t[42]||(t[42]=vt('<div class="flex-1"><div class="flex items-center gap-2 mb-1"><span class="text-lg">ðŸ”„</span><span class="text-sm font-semibold text-purple-900"> RenovaciÃ³n AutomÃ¡tica </span><span class="ml-auto px-2 py-0.5 bg-purple-100 text-purple-700 text-xs font-medium rounded"> Recomendado </span></div><div class="text-xs text-[#2D3748]/70 space-y-1"><p>âœ“ El bono se renovarÃ¡ automÃ¡ticamente cuando se agoten las sesiones o expire</p><p>âœ“ Mantiene la continuidad del tratamiento sin interrupciones</p><p>âœ“ Puedes desactivar la renovaciÃ³n en cualquier momento</p></div></div>',1))])])]),o(v)>0&&r.value.bono_monto>0?(a(),s("div",bs,[t[46]||(t[46]=e("div",{class:"text-xs font-medium text-purple-800 mb-2"},"ðŸ“‹ Resumen del Bono",-1)),e("div",gs,[e("div",null,[t[43]||(t[43]=e("span",{class:"text-[#2D3748]/60"},"Tipo:",-1)),e("span",fs,i(o(F)),1)]),e("div",null,[t[44]||(t[44]=e("span",{class:"text-[#2D3748]/60"},"Sesiones:",-1)),e("span",vs,i(o(v)),1)]),e("div",null,[t[45]||(t[45]=e("span",{class:"text-[#2D3748]/60"},"Total:",-1)),e("span",xs,"â‚¬"+i(r.value.bono_monto),1)])])])):S("",!0)])):S("",!0)]),e("div",hs,[t[48]||(t[48]=e("h3",{class:"text-lg font-serif text-[#2D3748] font-semibold"}," Notas Iniciales ",-1)),e("div",null,[t[47]||(t[47]=e("label",{for:"notas_iniciales",class:"block text-sm font-medium text-[#2D3748] mb-1"}," Observaciones (Opcional) ",-1)),Z(e("textarea",{id:"notas_iniciales","onUpdate:modelValue":t[14]||(t[14]=g=>r.value.notas_iniciales=g),rows:"3",class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white resize-none",placeholder:"Observaciones iniciales, motivo de consulta, etc."},null,512),[[ne,r.value.notas_iniciales]])])]),L.value?(a(),s("div",ys,[e("p",_s,i(L.value),1)])):S("",!0),e("div",ws,[e("div",$s,[t[49]||(t[49]=e("div",{class:"text-xs text-neutral-600"},[e("span",{class:"inline-block w-2 h-2 bg-red-500 rounded-full mr-1"}),V(" Los campos con * son obligatorios ")],-1)),e("div",ks,[e("button",{type:"button",onClick:q,disabled:x.value,class:"px-6 py-2.5 border-2 border-neutral-300 text-neutral-700 font-medium rounded-xl hover:bg-neutral-50 hover:border-[#027368] transition-all disabled:opacity-50 disabled:cursor-not-allowed"}," Cancelar ",8,Cs),e("button",{type:"submit",disabled:x.value||!o(l),class:"px-8 py-2.5 bg-gradient-to-r from-[#04BF9D] to-[#027368] text-white font-semibold rounded-xl hover:from-[#027368] hover:to-[#04BF9D] transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 shadow-sm hover:shadow-md"},[x.value?(a(),s("span",Ss)):(a(),s("span",Es,"âœ“")),V(" "+i(x.value?"Creando paciente...":"Crear Paciente"),1)],8,Ds)])])])],32)])])):S("",!0)}},Fs={class:"bg-[#F2F2F2] rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"},Ms={class:"space-y-4"},As={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Bs={class:"space-y-4 pt-4 border-t border-[#5550F2]/30"},Ts={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Vs={class:"relative"},Is={class:"md:col-span-2 space-y-3"},js={class:"flex items-center gap-2 cursor-pointer"},zs={key:0,class:"bg-amber-50 border border-amber-200 rounded-lg p-4 space-y-3"},Rs={class:"bg-white/80 rounded-lg p-3 border border-amber-100"},qs={class:"flex items-center justify-between mb-2"},Ns={class:"w-full bg-gray-200 rounded-full h-2"},Os=["disabled"],Ls={class:"space-y-4 pt-4 border-t border-[#5550F2]/30"},Us={key:0,class:"border-2 border-blue-400/40 rounded-lg p-4 space-y-4 bg-blue-50/30"},Hs={class:"flex items-center justify-between"},Gs={class:"flex items-center gap-2"},Qs={class:"font-medium text-[#2D3748]"},Zs={class:"text-xs text-[#2D3748]/60"},Js={class:"grid grid-cols-2 gap-4"},Ks={class:"px-4 py-2 bg-gray-100 border border-gray-300 rounded-lg text-[#2D3748] font-medium"},Xs=["max"],Ys={key:0,class:"text-amber-600 ml-1"},Ws={key:1,class:"bg-gray-50 border border-gray-200 rounded-lg p-4 text-center"},er={key:2,class:"flex items-center justify-center py-4"},tr={class:"flex items-center justify-between pt-2"},or={class:"flex items-center gap-2 cursor-pointer"},ar={key:3,class:"border-2 border-purple-400/40 rounded-lg p-4 space-y-4 bg-purple-50/30"},sr={class:"bg-purple-100 border border-purple-300 rounded-lg p-3 flex items-start gap-2"},rr={class:"text-sm text-purple-800"},nr={class:"font-medium"},ir={class:"text-xs text-purple-700 mt-1"},lr={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},dr={class:"relative"},cr=["required"],ur={class:"px-4 py-2 bg-purple-100 border-2 border-purple-300 rounded-lg text-purple-900 font-bold"},pr={class:"md:col-span-2"},mr={class:"flex items-center gap-2 cursor-pointer"},br={key:0,class:"bg-white border border-purple-300 rounded-lg p-4"},gr={class:"text-sm text-cafe/80 space-y-1"},fr={key:0,class:"text-purple-700"},vr={key:0,class:"bg-red-50 border border-red-200 rounded-lg p-4"},xr={class:"text-sm text-red-600"},hr={class:"flex justify-end gap-3 pt-4 border-t border-[#5550F2]/30"},yr=["disabled"],_r=["disabled"],wr={key:0,class:"inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"},$r={__name:"ModalEditarPaciente",props:{mostrar:{type:Boolean,default:!1},paciente:{type:Object,default:null}},emits:["cerrar","paciente-actualizado"],setup(k,{emit:z}){const m=k,O=z,{supabase:f,userProfile:$}=Ze(),{crearBono:P}=Dt(),{success:A,error:H}=qe(),b=j({nombre:"",apellido:"",email:"",telefono:"",fecha_nacimiento:"",tipo_bono:"",precio_sesion:null,activo:!0,en_pausa:!1,crear_bono:!1,bono_monto:null,bono_renovacion_automatica:!1,bono_sesiones_usadas:0}),r=j(null),x=j(!1),L=j(!1),C=D(()=>{if(!b.value.en_pausa)return 45;const t=(m.paciente?.metadata||{}).fecha_pausa;if(!t)return 45;const g=new Date(t),I=Math.floor((new Date().getTime()-g.getTime())/(1e3*60*60*24));return Math.max(0,45-I)}),v=async()=>{if(!m.paciente?.email){H("El paciente no tiene email registrado");return}L.value=!0;try{await new Promise(u=>setTimeout(u,1500)),A(`Recordatorio enviado a ${m.paciente.email}`)}catch(u){console.error("Error al enviar recordatorio:",u),H("No se pudo enviar el recordatorio")}finally{L.value=!1}},F=D(()=>r.value?Math.max(0,r.value.sesiones_totales-(b.value.bono_sesiones_usadas||0)):0),h=D(()=>{const u=b.value.tipo_bono;return u?{a_demanda:1,quincenal:2,semanal:4}[u]||0:"Selecciona tipo"}),y=D(()=>{const u=b.value.tipo_bono;return{a_demanda:"A Demanda",quincenal:"Quincenal",semanal:"Semanal"}[u]||""}),c=D(()=>{const u=h.value,t=b.value.bono_monto;return u==="Selecciona tipo"||!t||u<=0?"0.00":(t/u).toFixed(2)}),w=j(!1),l=j("");fe(()=>m.mostrar,u=>{u&&m.paciente&&d()});const d=async()=>{const u=m.paciente,t=u.metadata||{},U=(u.nombre_completo||u.nombre||"").split(" "),I=U[0]||t.nombre||"",ae=U.slice(1).join(" ")||t.apellido||t.apellido_paterno||"";b.value={nombre:I,apellido:ae,email:u.email||"",telefono:u.telefono||"",fecha_nacimiento:t.fecha_nacimiento||"",tipo_bono:u.tipo_bono||"",precio_sesion:u.precio_sesion||null,activo:u.activo??!0,en_pausa:u.en_pausa||t.en_pausa||!1,crear_bono:!1,bono_monto:null,bono_renovacion_automatica:!1,bono_sesiones_usadas:0},l.value="",await E()},E=async()=>{if(m.paciente?.id){x.value=!0,r.value=null;try{const{data:u,error:t}=await f.from("bonos").select("*").eq("paciente_id",m.paciente.id).in("estado",["activo","pendiente"]).order("created_at",{ascending:!1}).limit(1).single();u&&!t&&(r.value=u,b.value.bono_sesiones_usadas=u.sesiones_usadas||0)}catch{console.log("No se encontrÃ³ bono activo para el paciente")}finally{x.value=!1}}},q=()=>{w.value||O("cerrar")},oe=async()=>{try{w.value=!0,l.value="",console.log("Actualizando paciente:",m.paciente.id);const u=`${b.value.nombre.trim()} ${b.value.apellido.trim()}`,t=m.paciente.metadata||{},g=t.en_pausa||!1;let U=t.fecha_pausa||null;b.value.en_pausa&&!g?U=new Date().toISOString():b.value.en_pausa||(U=null);const{data:I,error:ae}=await f.from("pacientes").update({email:b.value.email,nombre_completo:u,telefono:b.value.telefono,tipo_bono:b.value.tipo_bono,precio_sesion:b.value.precio_sesion,activo:b.value.activo,en_pausa:b.value.en_pausa,metadata:{...t,nombre:b.value.nombre,apellido:b.value.apellido,fecha_nacimiento:b.value.fecha_nacimiento,en_pausa:b.value.en_pausa,fecha_pausa:U,fecha_actualizacion:new Date().toISOString()}}).eq("id",m.paciente.id).select().single();if(ae)throw console.error("Error al actualizar paciente:",ae),ae;if(console.log("Paciente actualizado:",I),r.value&&b.value.bono_sesiones_usadas!==r.value.sesiones_usadas){console.log("Actualizando sesiones del bono...");const G=b.value.bono_sesiones_usadas||0,K=r.value.sesiones_totales-G,W=K<=0?"agotado":r.value.estado,{error:se}=await f.from("bonos").update({sesiones_usadas:G,sesiones_restantes:K,estado:W}).eq("id",r.value.id);if(se)throw console.error("Error al actualizar bono:",se),H("Error al actualizar las sesiones del bono"),new Error("Error al actualizar las sesiones del bono");console.log("Bono actualizado:",{sesiones_usadas:G,sesiones_restantes:K}),A("Sesiones del bono actualizadas")}if(b.value.crear_bono&&b.value.tipo_bono&&b.value.bono_monto){console.log("[BONO] Iniciando creaciÃ³n de bono para paciente:",m.paciente.id);const G=$.value?.id||m.paciente?.psicologa_id;if(!G)throw console.error("[BONO] ERROR: No se pudo obtener el ID del terapeuta"),new Error("No se pudo identificar al terapeuta para crear el bono");console.log("[BONO] Terapeuta ID:",G);const K=new Date,W=new Date,se=b.value.tipo_bono;se==="a_demanda"?W.setMonth(W.getMonth()+1):se==="quincenal"?W.setDate(W.getDate()+15):se==="semanal"&&W.setMonth(W.getMonth()+1);const B=h.value,N={paciente_id:m.paciente.id,terapeuta_id:G,tipo:se,frecuencia:se,sesiones_totales:B,sesiones_restantes:B,sesiones_usadas:0,monto_total:b.value.bono_monto,fecha_inicio:K.toISOString().split("T")[0],fecha_fin:W.toISOString().split("T")[0],estado:"activo",pagado:!1,renovacion_automatica:b.value.bono_renovacion_automatica};console.log("[BONO] Datos del bono a crear:",N);try{const R=await P(N);console.log("[BONO] Bono creado exitosamente:",R),A("Bono creado correctamente")}catch(R){console.error("[BONO] Error al crear bono:",R),H("Error al crear el bono: "+(R.message||"Error desconocido"))}}A("Paciente actualizado correctamente"),O("paciente-actualizado",I),O("cerrar")}catch(u){console.error("Error al actualizar paciente:",u),l.value=u.message||"Error al actualizar el paciente. Por favor, intenta nuevamente."}finally{w.value=!1}};return(u,t)=>k.mostrar?(a(),s("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:re(q,["self"])},[e("div",Fs,[e("div",{class:"sticky top-0 bg-[#F2F2F2] border-b border-[#5550F2]/30 px-6 py-4 flex justify-between items-center"},[t[14]||(t[14]=e("h2",{class:"text-2xl font-serif text-[#2D3748] font-semibold"}," Editar Paciente ",-1)),e("button",{onClick:q,class:"text-[#2D3748] hover:text-[#5550F2] transition-colors","aria-label":"Cerrar modal"},[...t[13]||(t[13]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("form",{onSubmit:re(oe,["prevent"]),class:"px-6 py-6 space-y-6"},[e("div",Ms,[t[20]||(t[20]=e("h3",{class:"text-lg font-serif text-[#2D3748] font-semibold"}," InformaciÃ³n Personal ",-1)),e("div",As,[e("div",null,[t[15]||(t[15]=e("label",{for:"nombre",class:"block text-sm font-medium text-[#2D3748] mb-1"},[V(" Nombre "),e("span",{class:"text-red-500"},"*")],-1)),Z(e("input",{id:"nombre","onUpdate:modelValue":t[0]||(t[0]=g=>b.value.nombre=g),type:"text",required:"",class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white",placeholder:"Nombre del paciente"},null,512),[[ne,b.value.nombre]])]),e("div",null,[t[16]||(t[16]=e("label",{for:"apellido",class:"block text-sm font-medium text-[#2D3748] mb-1"},[V(" Apellido "),e("span",{class:"text-red-500"},"*")],-1)),Z(e("input",{id:"apellido","onUpdate:modelValue":t[1]||(t[1]=g=>b.value.apellido=g),type:"text",required:"",class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white",placeholder:"Apellido(s) del paciente"},null,512),[[ne,b.value.apellido]])]),e("div",null,[t[17]||(t[17]=e("label",{for:"email",class:"block text-sm font-medium text-[#2D3748] mb-1"},[V(" Email "),e("span",{class:"text-red-500"},"*")],-1)),Z(e("input",{id:"email","onUpdate:modelValue":t[2]||(t[2]=g=>b.value.email=g),type:"email",required:"",class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white",placeholder:"correo@ejemplo.com"},null,512),[[ne,b.value.email]])]),e("div",null,[t[18]||(t[18]=e("label",{for:"telefono",class:"block text-sm font-medium text-[#2D3748] mb-1"}," TelÃ©fono ",-1)),Z(e("input",{id:"telefono","onUpdate:modelValue":t[3]||(t[3]=g=>b.value.telefono=g),type:"tel",class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white",placeholder:"+52 123 456 7890"},null,512),[[ne,b.value.telefono]])]),e("div",null,[t[19]||(t[19]=e("label",{for:"fecha_nacimiento",class:"block text-sm font-medium text-[#2D3748] mb-1"}," Fecha de Nacimiento ",-1)),Z(e("input",{id:"fecha_nacimiento","onUpdate:modelValue":t[4]||(t[4]=g=>b.value.fecha_nacimiento=g),type:"date",class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white"},null,512),[[ne,b.value.fecha_nacimiento]])])])]),e("div",Bs,[t[36]||(t[36]=e("h3",{class:"text-lg font-serif text-[#2D3748] font-semibold"}," InformaciÃ³n TerapÃ©utica ",-1)),e("div",Ts,[e("div",null,[t[22]||(t[22]=e("label",{for:"tipo_bono",class:"block text-sm font-medium text-[#2D3748] mb-1"},[V(" Tipo de Bono "),e("span",{class:"text-red-500"},"*")],-1)),Z(e("select",{id:"tipo_bono","onUpdate:modelValue":t[5]||(t[5]=g=>b.value.tipo_bono=g),required:"",class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white"},[...t[21]||(t[21]=[e("option",{value:""},"Selecciona tipo de bono",-1),e("option",{value:"a_demanda"},"A Demanda (1 sesiÃ³n)",-1),e("option",{value:"quincenal"},"Quincenal (2 sesiones/mes)",-1),e("option",{value:"semanal"},"Semanal (4 sesiones/mes)",-1)])],512),[[Ie,b.value.tipo_bono]])]),e("div",null,[t[24]||(t[24]=e("label",{for:"precio_sesion",class:"block text-sm font-medium text-[#2D3748] mb-1"}," Precio por SesiÃ³n (â‚¬) ",-1)),e("div",Vs,[t[23]||(t[23]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-[#2D3748]/60"},"â‚¬",-1)),Z(e("input",{id:"precio_sesion","onUpdate:modelValue":t[6]||(t[6]=g=>b.value.precio_sesion=g),type:"number",min:"0",step:"0.01",placeholder:"Usar precio del terapeuta",class:"w-full pl-8 pr-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white"},null,512),[[ne,b.value.precio_sesion,void 0,{number:!0}]])]),t[25]||(t[25]=e("p",{class:"text-xs text-[#2D3748]/60 mt-1"}," ðŸ’¡ Precio personalizado para este paciente. Si estÃ¡ vacÃ­o, se usa el precio segÃºn frecuencia del terapeuta. ",-1))]),e("div",null,[t[27]||(t[27]=e("label",{for:"activo",class:"block text-sm font-medium text-[#2D3748] mb-1"}," Estado ",-1)),Z(e("select",{id:"activo","onUpdate:modelValue":t[7]||(t[7]=g=>b.value.activo=g),class:"w-full px-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-[#5550F2] focus:border-transparent bg-white"},[...t[26]||(t[26]=[e("option",{value:!0},"Activo",-1),e("option",{value:!1},"Inactivo",-1)])],512),[[Ie,b.value.activo]])]),e("div",Is,[e("label",js,[Z(e("input",{"onUpdate:modelValue":t[8]||(t[8]=g=>b.value.en_pausa=g),type:"checkbox",class:"w-4 h-4 text-amber-500 border-gray-300 rounded focus:ring-amber-500"},null,512),[[Se,b.value.en_pausa]]),t[28]||(t[28]=e("span",{class:"text-sm font-medium text-[#2D3748]"}," Proceso en pausa temporal ",-1))]),b.value.en_pausa?(a(),s("div",zs,[t[34]||(t[34]=e("div",{class:"flex items-start gap-3"},[e("span",{class:"text-2xl"},"â¸ï¸"),e("div",null,[e("p",{class:"font-medium text-amber-800"},"Cuenta en pausa temporal"),e("p",{class:"text-sm text-amber-700 mt-1"},[V(" El proceso terapeutico esta pausado. El paciente mantendra su espacio reservado durante "),e("strong",null,"45 dias"),V(". ")])])],-1)),e("div",Rs,[e("div",qs,[t[29]||(t[29]=e("span",{class:"text-sm font-medium text-gray-700"},"Dias restantes:",-1)),e("span",{class:M(["text-lg font-bold",C.value<=7?"text-red-600":"text-amber-600"])},i(C.value)+" dias ",3)]),e("div",Ns,[e("div",{class:M(["h-2 rounded-full transition-all",C.value<=7?"bg-red-500":"bg-amber-500"]),style:Pe({width:`${Math.max(0,C.value/45*100)}%`})},null,6)])]),t[35]||(t[35]=e("div",{class:"text-xs text-amber-800 space-y-2 bg-amber-100/50 rounded p-3"},[e("p",{class:"font-medium flex items-center gap-1"},[e("span",null,"âš ï¸"),V(" Importante: ")]),e("ul",{class:"list-disc list-inside space-y-1 text-amber-700"},[e("li",null,[V("Pasados los 45 dias, el perfil se "),e("strong",null,"desactivara automaticamente")]),e("li",null,"Se liberara su espacio en la agenda de Psicologa Karem"),e("li",null,[V("Los datos se eliminaran conforme al "),e("strong",null,"reglamento de proteccion de datos"),V(" para garantizar su privacidad")]),e("li",null,"Al reactivar, los precios de las sesiones podrian haberse modificado")])],-1)),e("button",{type:"button",onClick:v,disabled:L.value,class:"w-full py-2 px-4 bg-amber-600 text-white text-sm font-medium rounded-lg hover:bg-amber-700 disabled:opacity-50 transition-colors flex items-center justify-center gap-2"},[L.value?(a(),s(J,{key:0},[t[30]||(t[30]=e("span",{class:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"},null,-1)),t[31]||(t[31]=V(" Enviando... ",-1))],64)):(a(),s(J,{key:1},[t[32]||(t[32]=e("span",null,"ðŸ“§",-1)),t[33]||(t[33]=V(" Enviar recordatorio al paciente ",-1))],64))],8,Os)])):S("",!0)])])]),e("div",Ls,[t[61]||(t[61]=e("h3",{class:"text-lg font-serif text-[#2D3748] font-semibold"}," GestiÃ³n de Bonos ",-1)),r.value?(a(),s("div",Us,[e("div",Hs,[e("div",Gs,[t[38]||(t[38]=e("span",{class:"text-xl"},"ðŸŽ«",-1)),e("div",null,[e("p",Qs,"Bono "+i(r.value.tipo||"Activo"),1),e("p",Zs,[t[37]||(t[37]=V(" Estado: ",-1)),e("span",{class:M([r.value.estado==="activo"?"text-green-600":"text-amber-600","font-medium capitalize"])},i(r.value.estado),3)])])]),e("span",{class:M(["px-2 py-1 text-xs font-medium rounded-full",r.value.estado==="activo"?"bg-green-100 text-green-700":"bg-amber-100 text-amber-700"])},i(r.value.sesiones_restantes)+"/"+i(r.value.sesiones_totales)+" restantes ",3)]),e("div",Js,[e("div",null,[t[39]||(t[39]=e("label",{class:"block text-sm font-medium text-[#2D3748] mb-1"}," Sesiones Totales ",-1)),e("div",Ks,i(r.value.sesiones_totales),1)]),e("div",null,[t[40]||(t[40]=e("label",{for:"sesiones_usadas_bono",class:"block text-sm font-medium text-[#2D3748] mb-1"}," Sesiones Consumidas ",-1)),Z(e("input",{id:"sesiones_usadas_bono","onUpdate:modelValue":t[9]||(t[9]=g=>b.value.bono_sesiones_usadas=g),type:"number",min:"0",max:r.value.sesiones_totales,class:"w-full px-4 py-2 border border-blue-400/50 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white"},null,8,Xs),[[ne,b.value.bono_sesiones_usadas,void 0,{number:!0}]])])]),e("div",{class:M(["flex items-center gap-2 p-3 rounded-lg",F.value<=0?"bg-red-50 border border-red-200":"bg-blue-50 border border-blue-200"])},[e("span",{class:M(F.value<=0?"text-red-600":"text-blue-600")},i(F.value<=0?"âš ï¸":"â„¹ï¸"),3),e("p",{class:M(["text-sm",F.value<=0?"text-red-800":"text-blue-800"])},[e("strong",null,i(F.value),1),V(" de "+i(r.value.sesiones_totales)+" sesiones disponibles ",1),b.value.bono_sesiones_usadas!==r.value.sesiones_usadas?(a(),s("span",Ys," (modificado) ")):S("",!0)],2)],2),t[41]||(t[41]=e("p",{class:"text-xs text-[#2D3748]/60"}," ðŸ’¡ Ajusta las sesiones consumidas para sincronizar con datos de otra plataforma o corregir errores. ",-1))])):x.value?S("",!0):(a(),s("div",Ws,[...t[42]||(t[42]=[e("p",{class:"text-sm text-[#2D3748]/70"}," Este paciente no tiene un bono activo. ",-1)])])),x.value?(a(),s("div",er,[...t[43]||(t[43]=[e("div",{class:"w-5 h-5 border-2 border-blue-200 border-t-blue-600 rounded-full animate-spin mr-2"},null,-1),e("span",{class:"text-sm text-[#2D3748]/60"},"Cargando bono...",-1)])])):S("",!0),e("div",tr,[e("label",or,[Z(e("input",{"onUpdate:modelValue":t[10]||(t[10]=g=>b.value.crear_bono=g),type:"checkbox",class:"w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500"},null,512),[[Se,b.value.crear_bono]]),t[44]||(t[44]=e("span",{class:"text-sm font-medium text-[#2D3748]"}," ðŸŽ« Crear nuevo bono para este paciente ",-1))])]),b.value.crear_bono?(a(),s("div",ar,[e("div",sr,[t[46]||(t[46]=e("svg",{class:"w-5 h-5 text-purple-600 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})],-1)),e("div",rr,[e("p",nr,[t[45]||(t[45]=V("El bono usarÃ¡ el tipo seleccionado arriba: ",-1)),e("strong",null,i(y.value||"Selecciona un tipo primero"),1)]),e("p",ir," Sesiones incluidas: "+i(h.value==="Selecciona tipo"?"N/A":h.value),1)])]),e("div",lr,[e("div",null,[t[48]||(t[48]=e("label",{for:"bono_monto",class:"block text-sm font-medium text-[#2D3748] mb-1"},[V(" Monto Total "),e("span",{class:"text-red-500"},"*")],-1)),e("div",dr,[t[47]||(t[47]=e("span",{class:"absolute left-3 top-2.5 text-[#2D3748] font-medium"},"â‚¬",-1)),Z(e("input",{id:"bono_monto","onUpdate:modelValue":t[11]||(t[11]=g=>b.value.bono_monto=g),type:"number",min:"0",step:"0.01",required:b.value.crear_bono,class:"w-full pl-8 pr-4 py-2 border border-[#5550F2]/30 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white",placeholder:"0.00"},null,8,cr),[[ne,b.value.bono_monto,void 0,{number:!0}]])])]),e("div",null,[t[49]||(t[49]=e("label",{class:"block text-sm font-medium text-[#2D3748] mb-1"}," Precio por SesiÃ³n ",-1)),e("div",ur," â‚¬"+i(c.value),1)]),e("div",pr,[e("label",mr,[Z(e("input",{"onUpdate:modelValue":t[12]||(t[12]=g=>b.value.bono_renovacion_automatica=g),type:"checkbox",class:"w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500"},null,512),[[Se,b.value.bono_renovacion_automatica]]),t[50]||(t[50]=e("span",{class:"text-sm font-medium text-[#2D3748]"}," ðŸ”„ RenovaciÃ³n automÃ¡tica al vencer ",-1))]),t[51]||(t[51]=e("p",{class:"text-xs text-cafe/60 mt-1 ml-6"}," El sistema crearÃ¡ un nuevo bono idÃ©ntico cuando este expire ",-1))])]),h.value&&b.value.bono_monto?(a(),s("div",br,[t[60]||(t[60]=e("p",{class:"text-sm font-medium text-[#2D3748] mb-2"},"ðŸ“‹ Resumen del Bono:",-1)),e("div",gr,[e("p",null,[t[52]||(t[52]=V("â€¢ ",-1)),t[53]||(t[53]=e("strong",null,"Tipo:",-1)),V(" "+i(y.value),1)]),e("p",null,[t[54]||(t[54]=V("â€¢ ",-1)),t[55]||(t[55]=e("strong",null,"Sesiones:",-1)),V(" "+i(h.value),1)]),e("p",null,[t[56]||(t[56]=V("â€¢ ",-1)),t[57]||(t[57]=e("strong",null,"Total:",-1)),V(" â‚¬"+i(b.value.bono_monto.toFixed(2)),1)]),e("p",null,[t[58]||(t[58]=V("â€¢ ",-1)),t[59]||(t[59]=e("strong",null,"Por sesiÃ³n:",-1)),V(" â‚¬"+i(c.value),1)]),b.value.bono_renovacion_automatica?(a(),s("p",fr,"â€¢ âœ… Con renovaciÃ³n automÃ¡tica")):S("",!0)])])):S("",!0)])):S("",!0)]),l.value?(a(),s("div",vr,[e("p",xr,i(l.value),1)])):S("",!0),e("div",hr,[e("button",{type:"button",onClick:q,disabled:w.value,class:"px-6 py-2 border border-[#5550F2] text-[#2D3748] rounded-lg hover:bg-[#5550F2]/10 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"}," Cancelar ",8,yr),e("button",{type:"submit",disabled:w.value,class:"px-6 py-2 bg-[#5550F2] text-white rounded-lg hover:bg-[#C69F91] transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"},[w.value?(a(),s("span",wr)):S("",!0),V(" "+i(w.value?"Actualizando...":"Guardar Cambios"),1)],8,_r)])],32)])])):S("",!0)}},kr=Ae($r,[["__scopeId","data-v-b27bd45f"]]),Cr={class:"bg-[#F2F2F2] rounded-lg shadow-xl max-w-md w-full"},Dr={class:"px-6 py-6 space-y-4"},Sr={class:"text-[#2D3748]"},Er={class:"font-semibold"},Pr={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},Fr=["disabled"],Mr={key:0,class:"bg-red-50 border border-red-200 rounded-lg p-3"},Ar={class:"text-sm text-red-600"},Br={class:"px-6 py-4 border-t border-[#5550F2]/30 flex justify-end gap-3"},Tr=["disabled"],Vr=["disabled"],Ir={key:0,class:"inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"},jr={__name:"ModalEliminarPaciente",props:{mostrar:{type:Boolean,default:!1},paciente:{type:Object,default:null}},emits:["cerrar","paciente-eliminado","paciente-desactivado"],setup(k,{emit:z}){const m=k,O=z,{supabase:f}=Ze(),$=j(!1),P=j(""),A=D(()=>m.paciente?m.paciente.nombre_completo||m.paciente.nombre||m.paciente.email||"este paciente":""),H=()=>{$.value||(P.value="",O("cerrar"))},b=async()=>{try{$.value=!0,P.value="",console.log("Desactivando paciente:",m.paciente.id);const{error:x}=await f.from("pacientes").update({activo:!1,metadata:{...m.paciente.metadata,fecha_desactivacion:new Date().toISOString()}}).eq("id",m.paciente.id);if(x)throw x;console.log("Paciente desactivado exitosamente"),O("paciente-desactivado",m.paciente.id),O("cerrar")}catch(x){console.error("Error al desactivar paciente:",x),P.value=x.message||"Error al desactivar el paciente."}finally{$.value=!1}},r=async()=>{try{$.value=!0,P.value="",console.log("Eliminando paciente:",m.paciente.id),await f.from("metricas_bienestar").delete().eq("paciente_id",m.paciente.id),await f.from("notas_terapeuticas").delete().eq("paciente_id",m.paciente.id),await f.from("recursos_compartidos").delete().eq("paciente_id",m.paciente.id),await f.from("mensajes").delete().or(`remitente_id.eq.${m.paciente.id},destinatario_id.eq.${m.paciente.id}`),await f.from("bonos").delete().eq("paciente_id",m.paciente.id),await f.from("sesiones").delete().eq("paciente_id",m.paciente.id);const{error:x}=await f.from("pacientes").delete().eq("id",m.paciente.id);if(x)throw x;console.log("Paciente eliminado exitosamente"),O("paciente-eliminado",m.paciente.id),O("cerrar")}catch(x){console.error("Error al eliminar paciente:",x),P.value=x.message||"Error al eliminar el paciente. Por favor, intenta nuevamente."}finally{$.value=!1}};return(x,L)=>k.mostrar?(a(),s("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:re(H,["self"])},[e("div",Cr,[L[5]||(L[5]=e("div",{class:"px-6 py-4 border-b border-[#5550F2]/30"},[e("div",{class:"flex items-center gap-3"},[e("span",{class:"text-3xl"},"âš ï¸"),e("h2",{class:"text-2xl font-serif text-[#2D3748] font-semibold"}," Eliminar Paciente ")])],-1)),e("div",Dr,[e("p",Sr,[L[0]||(L[0]=V(" Â¿EstÃ¡s seguro de que deseas eliminar a ",-1)),e("strong",Er,i(A.value),1),L[1]||(L[1]=V("? ",-1))]),L[4]||(L[4]=e("div",{class:"bg-red-50 border border-red-200 rounded-lg p-4 space-y-2"},[e("p",{class:"text-sm text-red-800 font-medium"}," Esta acciÃ³n no se puede deshacer y eliminarÃ¡: "),e("ul",{class:"text-sm text-red-700 space-y-1 ml-4 list-disc"},[e("li",null,"Todos los datos personales del paciente"),e("li",null,"El historial de sesiones"),e("li",null,"Las notas terapÃ©uticas"),e("li",null,"Las mÃ©tricas de bienestar"),e("li",null,"Los bonos asociados")])],-1)),e("div",Pr,[L[2]||(L[2]=e("p",{class:"text-sm text-blue-800 font-medium mb-2"}," ðŸ’¡ RecomendaciÃ³n: ",-1)),L[3]||(L[3]=e("p",{class:"text-sm text-blue-700 mb-3"},[V(" En lugar de eliminar, considera "),e("strong",null,"desactivar"),V(" al paciente. Esto preservarÃ¡ el historial para consultas futuras. ")],-1)),e("button",{type:"button",onClick:b,disabled:$.value,class:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-sm"}," Desactivar en lugar de eliminar ",8,Fr)]),P.value?(a(),s("div",Mr,[e("p",Ar,i(P.value),1)])):S("",!0)]),e("div",Br,[e("button",{type:"button",onClick:H,disabled:$.value,class:"px-6 py-2 border border-[#5550F2] text-[#2D3748] rounded-lg hover:bg-[#5550F2]/10 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"}," Cancelar ",8,Tr),e("button",{type:"button",onClick:r,disabled:$.value,class:"px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"},[$.value?(a(),s("span",Ir)):S("",!0),V(" "+i($.value?"Eliminando...":"Eliminar Definitivamente"),1)],8,Vr)])])])):S("",!0)}},zr=Ae(jr,[["__scopeId","data-v-941153fc"]]),Rr={class:"bg-white dark:bg-gray-900 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden"},qr={class:"px-6 py-4 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20"},Nr={key:0,class:"text-sm text-gray-600 dark:text-gray-400 mt-1"},Or={key:0,class:"p-12 flex flex-col items-center justify-center"},Lr={class:"space-y-6"},Ur={class:"space-y-2"},Hr={class:"flex gap-2 flex-wrap"},Gr=["onClick"],Qr={class:"text-xs text-gray-500 dark:text-gray-400 capitalize"},Zr={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Jr={class:"md:col-span-2"},Kr={class:"space-y-3"},Xr={class:"grid grid-cols-4 sm:grid-cols-6 gap-2 max-h-48 overflow-y-auto p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg border border-gray-200 dark:border-gray-700"},Yr=["onClick"],Wr={class:"text-xs"},en={class:"mt-2"},tn={key:0,class:"p-4 bg-yellow-50 dark:bg-yellow-900/20 border-2 border-yellow-300 dark:border-yellow-700 rounded-lg"},on={class:"grid grid-cols-3 gap-3"},an=["onClick"],sn={class:"text-2xl mb-1"},rn={class:"text-sm font-medium text-gray-900 dark:text-white"},nn={class:"grid grid-cols-2 md:grid-cols-4 gap-3"},ln=["onClick"],dn={class:"text-xl mb-1"},cn={class:"text-xs font-medium text-gray-900 dark:text-white"},un={class:"px-6 py-4 border-t border-gray-200 dark:border-gray-800 flex gap-3 bg-gray-50 dark:bg-gray-800"},pn=["disabled"],mn={key:0},bn={key:1},gn=Re({__name:"ModalEditarCita",props:{isOpen:{type:Boolean},citaId:{}},emits:["close","actualizado"],setup(k,{emit:z}){const m=k,O=z,f=$t(),{actualizarCita:$,getCitasPorDia:P}=St(),A=j(null),H=j(!1),b=j(!1),r=j(!1),x=j({fecha_cita:"",hora_inicio:"",hora_fin:"",duracion:60,modalidad:"presencial",estado:"pendiente",observaciones:""}),L=D(()=>x.value.fecha_cita?new Date(x.value.fecha_cita+"T00:00:00").toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long",year:"numeric"}):""),C=D(()=>{const l=new Date,d=[],E=g=>g.toISOString().split("T")[0];d.push({label:"Hoy",fecha:E(l)});const q=new Date(l);q.setDate(q.getDate()+1),d.push({label:"MaÃ±ana",fecha:E(q)});const oe=["Lun","Mar","MiÃ©","Jue","Vie"];let u=new Date(l),t=0;for(;t<5;){u.setDate(u.getDate()+1);const g=u.getDay();g>=1&&g<=5&&(d.push({label:`${oe[g-1]} ${u.getDate()}`,fecha:E(u)}),t++)}return d}),v=["08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00","18:30","19:00","19:30","20:00","20:30","21:00","21:30","22:00"],F=async()=>{if(console.log("ðŸ” [ModalEditarCita] Cargando cita con ID:",m.citaId),!m.citaId){console.warn("âš ï¸ [ModalEditarCita] No hay citaId proporcionado");return}try{H.value=!0;const{data:l,error:d}=await f.from("citas").select(`
        *,
        paciente:pacientes!citas_paciente_id_fkey (
          id,
          nombre_completo,
          email,
          telefono
        )
      `).eq("id",m.citaId).single();if(d)throw console.error("âŒ [ModalEditarCita] Error en query:",d),d;console.log("âœ… [ModalEditarCita] Cita cargada:",l),l&&(A.value=l,x.value={fecha_cita:l.fecha_cita,hora_inicio:l.hora_inicio?.substring(0,5)||"",hora_fin:l.hora_fin?.substring(0,5)||"",duracion:l.duracion||60,modalidad:l.modalidad||"presencial",estado:l.estado||"pendiente",observaciones:l.observaciones||""},console.log("ðŸ“ [ModalEditarCita] Formulario llenado:",x.value))}catch(l){console.error("ðŸ’¥ [ModalEditarCita] Error al cargar cita:",l)}finally{H.value=!1}},h=async()=>{if(!x.value.fecha_cita||!x.value.hora_inicio||!x.value.hora_fin){r.value=!1;return}try{const d=(await P(x.value.fecha_cita)).filter(oe=>oe.estado!=="cancelada"&&oe.id!==m.citaId),E=x.value.hora_inicio,q=x.value.hora_fin;r.value=d.some(oe=>{const u=oe.hora_inicio?.substring(0,5),t=oe.hora_fin?.substring(0,5),g=y(E),U=y(q),I=y(u),ae=y(t);return g>=I&&g<ae||U>I&&U<=ae||g<=I&&U>=ae})}catch(l){console.error("Error al verificar conflicto:",l),r.value=!1}},y=l=>{if(!l||!l.includes(":"))return 0;const[d,E]=l.split(":").map(Number);return(d||0)*60+(E||0)};fe(()=>x.value.hora_inicio,l=>{if(l&&x.value.duracion){const[d,E]=l.split(":").map(Number),q=(d||0)*60+(E||0)+x.value.duracion,oe=Math.floor(q/60),u=q%60;x.value.hora_fin=`${String(oe).padStart(2,"0")}:${String(u).padStart(2,"0")}`}}),fe(()=>x.value.duracion,l=>{if(x.value.hora_inicio&&l){const[d,E]=x.value.hora_inicio.split(":").map(Number),q=(d||0)*60+(E||0)+l,oe=Math.floor(q/60),u=q%60;x.value.hora_fin=`${String(oe).padStart(2,"0")}:${String(u).padStart(2,"0")}`}}),fe([()=>x.value.fecha_cita,()=>x.value.hora_inicio,()=>x.value.hora_fin],()=>{h()});const c=async()=>{if(m.citaId&&(await h(),!r.value))try{b.value=!0,(await $(m.citaId,{fecha_cita:x.value.fecha_cita,hora_inicio:x.value.hora_inicio,hora_fin:x.value.hora_fin,modalidad:x.value.modalidad,estado:x.value.estado,observaciones:x.value.observaciones})).success&&(O("actualizado"),O("close"))}catch(l){console.error("Error al actualizar cita:",l)}finally{b.value=!1}},w=()=>{O("close")};return fe(()=>m.isOpen,l=>{console.log("ðŸ‘ï¸ [ModalEditarCita] Modal abierto:",l,"citaId:",m.citaId),l&&m.citaId&&F()}),fe(()=>m.citaId,l=>{console.log("ðŸ”„ [ModalEditarCita] citaId cambiÃ³ a:",l),m.isOpen&&l&&F()}),(l,d)=>(a(),le(Je,{to:"body"},[k.isOpen?(a(),s("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:re(w,["self"])},[e("div",Rr,[e("div",qr,[e("div",null,[d[5]||(d[5]=e("h2",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"âœï¸ Editar Cita",-1)),A.value?(a(),s("p",Nr,i(A.value.paciente?.nombre_completo||A.value.paciente_nombre),1)):S("",!0)]),e("button",{onClick:w,class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors","aria-label":"Cerrar"},[...d[6]||(d[6]=[e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),H.value?(a(),s("div",Or,[...d[7]||(d[7]=[e("div",{class:"w-12 h-12 border-4 border-purple-200 border-t-purple-600 rounded-full animate-spin mb-4"},null,-1),e("p",{class:"text-gray-600 dark:text-gray-400"},"Cargando...",-1)])])):A.value?(a(),s("form",{key:1,onSubmit:re(c,["prevent"]),class:"px-6 py-4 overflow-y-auto max-h-[calc(90vh-200px)]"},[e("div",Lr,[e("div",null,[d[8]||(d[8]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," ðŸ“… Fecha ",-1)),e("div",Ur,[Z(e("input",{"onUpdate:modelValue":d[0]||(d[0]=E=>x.value.fecha_cita=E),type:"date",required:"",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-800 dark:text-white cursor-pointer"},null,512),[[ne,x.value.fecha_cita]]),e("div",Hr,[(a(!0),s(J,null,Y(C.value,(E,q)=>(a(),s("button",{key:q,type:"button",onClick:oe=>E.fecha&&(x.value.fecha_cita=E.fecha),class:M(["text-xs px-3 py-1.5 rounded-lg border transition-all",x.value.fecha_cita===E.fecha?"bg-purple-600 text-white border-purple-600 font-semibold":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 border-gray-300 dark:border-gray-600 hover:border-purple-500 hover:bg-purple-50 dark:hover:bg-purple-900/20"])},i(E.label),11,Gr))),128))]),e("p",Qr,i(L.value),1)])]),e("div",Zr,[e("div",Jr,[d[10]||(d[10]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," ðŸ• Hora Inicio ",-1)),e("div",Kr,[e("div",Xr,[(a(),s(J,null,Y(v,E=>e("button",{key:E,type:"button",onClick:q=>x.value.hora_inicio=E,class:M(["px-3 py-2 text-sm font-medium rounded-lg transition-all border-2",x.value.hora_inicio===E?"bg-purple-600 text-white border-purple-600 shadow-md transform scale-105":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 border-gray-200 dark:border-gray-600 hover:border-purple-500 hover:bg-purple-50 dark:hover:bg-purple-900/20 hover:shadow"])},i(E),11,Yr)),64))]),e("details",Wr,[d[9]||(d[9]=e("summary",{class:"cursor-pointer text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 select-none flex items-center gap-1"},[e("span",null,"âŒ¨ï¸"),e("span",null,"Ingresar hora manualmente")],-1)),e("div",en,[Z(e("input",{"onUpdate:modelValue":d[1]||(d[1]=E=>x.value.hora_inicio=E),type:"time",required:"",step:"1800",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-800 dark:text-white"},null,512),[[ne,x.value.hora_inicio]])])])])]),e("div",null,[d[12]||(d[12]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," â±ï¸ DuraciÃ³n (min) ",-1)),Z(e("select",{"onUpdate:modelValue":d[2]||(d[2]=E=>x.value.duracion=E),class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-800 dark:text-white"},[...d[11]||(d[11]=[e("option",{value:30},"30 min",-1),e("option",{value:45},"45 min",-1),e("option",{value:60},"60 min",-1),e("option",{value:90},"90 min",-1)])],512),[[Ie,x.value.duracion]])]),e("div",null,[d[13]||(d[13]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," ðŸ•‘ Hora Fin ",-1)),Z(e("input",{"onUpdate:modelValue":d[3]||(d[3]=E=>x.value.hora_fin=E),type:"time",required:"",readonly:"",step:"1800",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-800 dark:text-white"},null,512),[[ne,x.value.hora_fin]])])]),r.value?(a(),s("div",tn,[...d[14]||(d[14]=[e("div",{class:"flex items-start gap-3"},[e("span",{class:"text-2xl"},"âš ï¸"),e("div",null,[e("div",{class:"font-semibold text-yellow-800 dark:text-yellow-300 mb-1"}," Conflicto de Horario "),e("div",{class:"text-sm text-yellow-700 dark:text-yellow-400"}," Ya existe otra cita en este horario. Por favor, selecciona otro horario. ")])],-1)])])):S("",!0),e("div",null,[d[15]||(d[15]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," ðŸ’» Modalidad ",-1)),e("div",on,[(a(),s(J,null,Y([{valor:"presencial",icono:"ðŸ¥",nombre:"Presencial"},{valor:"online",icono:"ðŸ’»",nombre:"Online"},{valor:"telefonica",icono:"ðŸ“ž",nombre:"TelÃ©fono"}],E=>e("button",{key:E.valor,type:"button",onClick:q=>x.value.modalidad=E.valor,class:M(["p-3 border-2 rounded-lg transition-all",x.value.modalidad===E.valor?"border-purple-600 bg-purple-50 dark:bg-purple-900/20":"border-gray-300 dark:border-gray-700 hover:border-purple-400"])},[e("div",sn,i(E.icono),1),e("div",rn,i(E.nombre),1)],10,an)),64))])]),e("div",null,[d[16]||(d[16]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," ðŸ“Š Estado ",-1)),e("div",nn,[(a(),s(J,null,Y([{valor:"pendiente",icono:"â³",nombre:"Pendiente"},{valor:"confirmada",icono:"âœ…",nombre:"Confirmada"},{valor:"realizada",icono:"âœ“",nombre:"Realizada"},{valor:"cancelada",icono:"âŒ",nombre:"Cancelada"}],E=>e("button",{key:E.valor,type:"button",onClick:q=>x.value.estado=E.valor,class:M(["p-2 border-2 rounded-lg transition-all",x.value.estado===E.valor?"border-purple-600 bg-purple-50 dark:bg-purple-900/20":"border-gray-300 dark:border-gray-700 hover:border-purple-400"])},[e("div",dn,i(E.icono),1),e("div",cn,i(E.nombre),1)],10,ln)),64))])]),e("div",null,[d[17]||(d[17]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," ðŸ“ Observaciones ",-1)),Z(e("textarea",{"onUpdate:modelValue":d[4]||(d[4]=E=>x.value.observaciones=E),rows:"3",placeholder:"Notas adicionales sobre la cita...",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-800 dark:text-white"},null,512),[[ne,x.value.observaciones]])])])],32)):S("",!0),e("div",un,[e("button",{onClick:w,type:"button",class:"flex-1 px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors font-medium"}," Cancelar "),e("button",{onClick:c,disabled:b.value||r.value,class:M(["flex-1 px-4 py-2 rounded-lg font-medium transition-colors",b.value||r.value?"bg-gray-400 dark:bg-gray-600 text-gray-200 cursor-not-allowed":"bg-purple-600 hover:bg-purple-700 text-white"])},[b.value?(a(),s("span",mn,"Guardando...")):(a(),s("span",bn,"ðŸ’¾ Guardar Cambios"))],10,pn)])])])):S("",!0)]))}}),fn=Object.assign(Ae(gn,[["__scopeId","data-v-e8361a38"]]),{__name:"ModalEditarCita"}),vn={class:"fixed bottom-4 right-4 z-50 flex flex-col gap-3 max-w-sm w-full pointer-events-none",role:"region","aria-live":"polite","aria-label":"Notificaciones"},xn={class:"flex-shrink-0"},hn={class:"text-sm font-medium flex-1"},yn=["onClick","aria-label"],_n={__name:"ToastContainer",setup(k){const{toasts:z,removeToast:m}=qe(),O=f=>{const $={success:"border-green-200 bg-green-50 text-green-800",error:"border-red-200 bg-red-50 text-red-800",warning:"border-amber-200 bg-amber-50 text-amber-800",info:"border-blue-200 bg-blue-50 text-blue-800"};return $[f]||$.info};return(f,$)=>(a(),s("div",vn,[_(eo,{name:"toast"},{default:Ce(()=>[(a(!0),s(J,null,Y(o(z),P=>(a(),s("div",{key:P.id,class:M(["pointer-events-auto bg-white rounded-lg shadow-lg border p-4 flex items-start gap-3 transition-all duration-300",O(P.type)]),role:"alert"},[e("div",xn,[P.type==="success"?(a(),le(o(ke),{key:0,class:"w-5 h-5","aria-hidden":"true"})):P.type==="error"?(a(),le(o(Me),{key:1,class:"w-5 h-5","aria-hidden":"true"})):P.type==="warning"?(a(),le(o(De),{key:2,class:"w-5 h-5","aria-hidden":"true"})):(a(),le(o(nt),{key:3,class:"w-5 h-5","aria-hidden":"true"}))]),e("p",hn,i(P.message),1),e("button",{onClick:A=>o(m)(P.id),class:"min-h-[44px] min-w-[44px] p-2 -mr-2 -mt-2 hover:bg-gray-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-gray-300","aria-label":`Cerrar notificaciÃ³n: ${P.message}`},[_(o(Be),{class:"w-4 h-4","aria-hidden":"true"})],8,yn)],2))),128))]),_:1})]))}},wn=Ae(_n,[["__scopeId","data-v-4b6dd325"]]),$n={class:"mb-4"},kn={key:0},Cn={class:"inline-block"},Dn={class:"min-h-[44px] px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all font-medium shadow-sm hover:shadow-md cursor-pointer inline-flex items-center gap-2"},Sn=["accept","aria-label"],En={class:"text-xs text-gray-400 mt-4"},Pn={class:"text-xs text-gray-400"},Fn={key:1,class:"flex items-center justify-center gap-4"},Mn={class:"text-left flex-1"},An={class:"text-sm font-semibold text-cafe"},Bn={class:"text-xs text-gray-500"},Tn={key:2,class:"mt-4 p-3 bg-red-100 border border-red-300 rounded-lg"},Vn={class:"text-sm text-red-800 font-medium"},In=Re({__name:"FileDropzone",props:{accept:{default:".csv,.xlsx,.xls"},maxSize:{default:10*1024*1024},supportedFormats:{default:"CSV, XLSX"},ariaLabel:{default:"Seleccionar archivo para subir"}},emits:["file-selected","file-removed","error"],setup(k,{expose:z,emit:m}){const O=k,f=m,$=j(null),P=j(!1),A=j(""),H=D(()=>!!A.value),b=D(()=>Math.round(O.maxSize/(1024*1024))),r=y=>{if(A.value="",y.size>O.maxSize)return A.value=`El archivo es demasiado grande. MÃ¡ximo permitido: ${b.value}MB`,f("error",A.value),!1;const c=y.name.split(".").pop()?.toLowerCase(),w=O.accept.split(",").map(l=>l.trim().replace(".",""));return!c||!w.includes(c)?(A.value=`Formato de archivo no vÃ¡lido. Solo se permiten: ${O.supportedFormats}`,f("error",A.value),!1):!0},x=y=>{const c=y.target,w=c.files?.[0];w&&r(w)&&($.value=w,f("file-selected",w)),c.value=""},L=y=>{P.value=!0},C=y=>{P.value=!1},v=y=>{P.value=!1;const c=y.dataTransfer?.files[0];c&&r(c)&&($.value=c,f("file-selected",c))},F=()=>{$.value=null,A.value="",f("file-removed")},h=y=>{if(y===0)return"0 Bytes";const c=1024,w=["Bytes","KB","MB","GB"],l=Math.floor(Math.log(y)/Math.log(c));return Math.round(y/Math.pow(c,l)*100)/100+" "+w[l]};return z({removeFile:F}),(y,c)=>(a(),s("div",{onDragover:re(L,["prevent"]),onDragleave:C,onDrop:re(v,["prevent"]),class:M(["relative border-2 border-dashed rounded-xl p-8 transition-all duration-200 text-center",[o(P)?"border-purple-600 bg-purple-50":"border-gray-300 bg-gray-50",o(H)?"border-red-400 bg-red-50":"",o($)?"border-green-400 bg-green-50":""]])},[e("div",$n,[o($)?(a(),le(o(ze),{key:1,class:"w-12 h-12 mx-auto text-green-600","aria-hidden":"true"})):(a(),le(o(rt),{key:0,class:M(["w-12 h-12 mx-auto",o(P)?"text-purple-600":"text-gray-400"]),"aria-hidden":"true"},null,8,["class"]))]),o($)?(a(),s("div",Fn,[e("div",Mn,[e("p",An,i(o($).name),1),e("p",Bn,i(h(o($).size)),1)]),e("button",{onClick:F,class:"min-h-[44px] min-w-[44px] p-2 text-red-600 hover:bg-red-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-red-300","aria-label":"Eliminar archivo"},[_(o(Be),{class:"w-6 h-6","aria-hidden":"true"})])])):(a(),s("div",kn,[c[1]||(c[1]=e("p",{class:"text-lg font-medium text-cafe mb-2"}," Arrastra tu archivo aquÃ­ ",-1)),c[2]||(c[2]=e("p",{class:"text-sm text-gray-500 mb-4"}," o haz clic para seleccionar ",-1)),e("label",Cn,[e("span",Dn,[_(o(Bo),{class:"w-5 h-5","aria-hidden":"true"}),c[0]||(c[0]=e("span",null,"Seleccionar archivo",-1))]),e("input",{type:"file",accept:k.accept,onChange:x,class:"hidden","aria-label":k.ariaLabel},null,40,Sn)]),e("p",En,i(k.supportedFormats),1),e("p",Pn," TamaÃ±o mÃ¡ximo: "+i(o(b))+"MB ",1)])),o(A)?(a(),s("div",Tn,[e("p",Vn,i(o(A)),1)])):S("",!0)],34))}}),jn=Object.assign(In,{__name:"SharedFileDropzone"}),zn={class:"space-y-6"},Rn={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},qn={class:"flex gap-3"},Nn={class:"overflow-x-auto border border-gray-200 rounded-lg"},On={class:"w-full text-sm"},Ln={class:"divide-y divide-gray-200"},Un={class:"px-4 py-3"},Hn={class:"font-medium text-gray-900"},Gn={class:"px-4 py-3"},Qn={class:"flex flex-wrap gap-1 max-w-xs"},Zn=["title"],Jn={class:"px-4 py-3"},Kn=["value","onChange"],Xn={label:"Campos obligatorios"},Yn=["value","disabled"],Wn={label:"Contacto"},ei=["value","disabled"],ti={label:"Tratamiento"},oi=["value","disabled"],ai={label:"Otros campos"},si=["value","disabled"],ri={class:"px-4 py-3 text-center"},ni={key:0,class:"inline-flex items-center gap-1 px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium"},ii={key:1,class:"inline-flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-medium"},li={key:2,class:"inline-flex items-center gap-1 px-2 py-1 bg-gray-100 text-gray-500 rounded-full text-xs"},di={key:0,class:"bg-red-50 border border-red-200 rounded-lg p-4"},ci={class:"flex gap-3"},ui={class:"list-disc list-inside text-red-800 space-y-1 text-sm"},pi={key:1,class:"bg-amber-50 border border-amber-200 rounded-lg p-4"},mi={class:"flex gap-3"},bi={class:"list-disc list-inside text-amber-800 space-y-1 text-sm"},gi={key:2,class:"space-y-3"},fi={class:"font-semibold text-gray-900 flex items-center gap-2"},vi={class:"overflow-x-auto border border-gray-200 rounded-lg"},xi={class:"w-full text-sm"},hi={class:"bg-purple-50"},yi={class:"divide-y divide-gray-100"},_i={class:"text-xs text-gray-500"},wi=Re({__name:"ColumnMappingTable",props:{detectedColumns:{},mappings:{},validation:{}},emits:["update:mapping"],setup(k,{emit:z}){const m=k,O=z,f=[{field:"nombre_completo",label:"Nombre Completo"},{field:"email",label:"Email"},{field:"telefono",label:"TelÃ©fono"}],$=[{field:"documento_identidad",label:"Documento de Identidad"},{field:"fecha_nacimiento",label:"Fecha de Nacimiento"},{field:"direccion",label:"DirecciÃ³n"},{field:"contacto_emergencia",label:"Contacto de Emergencia"}],P=[{field:"area_de_acompanamiento",label:"Ãrea de AcompaÃ±amiento"},{field:"frecuencia",label:"Frecuencia de Sesiones"},{field:"activo",label:"Estado (Activo/Inactivo)"},{field:"derivacion",label:"DerivaciÃ³n"},{field:"medicacion",label:"MedicaciÃ³n"},{field:"orientacion_diagnostica",label:"OrientaciÃ³n DiagnÃ³stica"},{field:"inicio_tratamiento",label:"Inicio del Tratamiento"}],A=[{field:"precio_sesion",label:"Precio por SesiÃ³n"},{field:"comision",label:"ComisiÃ³n"},{field:"notas",label:"Notas / Observaciones"}],H=[...f,...$,...P,...A],b=h=>m.mappings.find(c=>c.sourceColumn===h)?.targetField||"",r=(h,y)=>m.mappings.some(c=>c.targetField===h&&c.sourceColumn!==y),x=h=>f.some(y=>y.field===h),L=h=>H.find(y=>y.field===h)?.label||h,C=(h,y)=>{O("update:mapping",h,y)},v=D(()=>m.mappings.filter(h=>h.targetField).map(h=>h.targetField)),F=D(()=>{if(!m.detectedColumns.length||!v.value.length)return[];const h=Math.min(m.detectedColumns[0]?.sampleValues?.length||0,3),y=[];for(let c=0;c<h;c++){const w={};for(const l of m.mappings)if(l.targetField){const d=m.detectedColumns.find(E=>E.name===l.sourceColumn);w[l.targetField]=d?.sampleValues?.[c]||""}Object.keys(w).length>0&&y.push(w)}return y});return(h,y)=>(a(),s("div",zn,[e("div",Rn,[e("div",qn,[_(o(nt),{class:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),y[0]||(y[0]=e("div",null,[e("p",{class:"font-semibold text-blue-900 mb-1"}," Relaciona las columnas de tu archivo con los campos de TeraplÃ­ "),e("p",{class:"text-sm text-blue-800"}," Hemos detectado automÃ¡ticamente algunos campos. Revisa y ajusta segÃºn necesites. ")],-1))])]),e("div",Nn,[e("table",On,[y[4]||(y[4]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left font-semibold text-gray-700"}," Columna en tu archivo "),e("th",{class:"px-4 py-3 text-left font-semibold text-gray-700"}," Valores de ejemplo "),e("th",{class:"px-4 py-3 text-left font-semibold text-gray-700"}," Campo TeraplÃ­ "),e("th",{class:"px-4 py-3 text-center font-semibold text-gray-700 w-24"}," Estado ")])],-1)),e("tbody",Ln,[(a(!0),s(J,null,Y(k.detectedColumns,c=>(a(),s("tr",{key:c.name,class:"hover:bg-gray-50"},[e("td",Un,[e("span",Hn,i(c.name),1)]),e("td",Gn,[e("div",Qn,[(a(!0),s(J,null,Y(c.sampleValues.slice(0,3),(w,l)=>(a(),s("span",{key:l,class:"inline-block px-2 py-0.5 bg-gray-100 text-gray-600 rounded text-xs truncate max-w-[120px]",title:w},i(w||"(vacÃ­o)"),9,Zn))),128))])]),e("td",Jn,[e("select",{value:b(c.name),onChange:w=>C(c.name,w.target.value),class:M(["w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-purple-500 focus:border-purple-500",{"border-green-400 bg-green-50":b(c.name)&&x(b(c.name)),"border-blue-300 bg-blue-50":b(c.name)&&!x(b(c.name))}])},[y[1]||(y[1]=e("option",{value:""},"-- No importar --",-1)),e("optgroup",Xn,[(a(),s(J,null,Y(f,w=>e("option",{key:w.field,value:w.field,disabled:r(w.field,c.name)},i(w.label)+" "+i(r(w.field,c.name)?"(ya usado)":"*"),9,Yn)),64))]),e("optgroup",Wn,[(a(),s(J,null,Y($,w=>e("option",{key:w.field,value:w.field,disabled:r(w.field,c.name)},i(w.label)+" "+i(r(w.field,c.name)?"(ya usado)":""),9,ei)),64))]),e("optgroup",ti,[(a(),s(J,null,Y(P,w=>e("option",{key:w.field,value:w.field,disabled:r(w.field,c.name)},i(w.label)+" "+i(r(w.field,c.name)?"(ya usado)":""),9,oi)),64))]),e("optgroup",ai,[(a(),s(J,null,Y(A,w=>e("option",{key:w.field,value:w.field,disabled:r(w.field,c.name)},i(w.label)+" "+i(r(w.field,c.name)?"(ya usado)":""),9,si)),64))])],42,Kn)]),e("td",ri,[b(c.name)&&x(b(c.name))?(a(),s("span",ni,[_(o(ke),{class:"w-3.5 h-3.5"}),y[2]||(y[2]=V(" Obligatorio ",-1))])):b(c.name)?(a(),s("span",ii,[_(o(ke),{class:"w-3.5 h-3.5"}),y[3]||(y[3]=V(" Opcional ",-1))])):(a(),s("span",li," No importar "))])]))),128))])])]),k.validation?.errors?.length?(a(),s("div",di,[e("div",ci,[_(o(De),{class:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e("div",null,[y[5]||(y[5]=e("p",{class:"font-semibold text-red-900 mb-2"}," Errores que impiden la importaciÃ³n: ",-1)),e("ul",ui,[(a(!0),s(J,null,Y(k.validation.errors,(c,w)=>(a(),s("li",{key:w},i(c),1))),128))])])])])):S("",!0),k.validation?.warnings?.length&&!k.validation?.errors?.length?(a(),s("div",pi,[e("div",mi,[_(o(Me),{class:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),e("div",null,[y[6]||(y[6]=e("p",{class:"font-semibold text-amber-900 mb-2"}," Advertencias (puedes continuar): ",-1)),e("ul",bi,[(a(!0),s(J,null,Y(k.validation.warnings,(c,w)=>(a(),s("li",{key:w},i(c),1))),128))])])])])):S("",!0),o(F).length>0?(a(),s("div",gi,[e("h4",fi,[_(o(Ct),{class:"w-5 h-5 text-purple-600"}),y[7]||(y[7]=V(" Vista previa con el mapeo aplicado ",-1))]),e("div",vi,[e("table",xi,[e("thead",hi,[e("tr",null,[(a(!0),s(J,null,Y(o(v),c=>(a(),s("th",{key:c,class:"px-3 py-2 text-left font-medium text-purple-800 whitespace-nowrap"},i(L(c)),1))),128))])]),e("tbody",yi,[(a(!0),s(J,null,Y(o(F),(c,w)=>(a(),s("tr",{key:w,class:"hover:bg-gray-50"},[(a(!0),s(J,null,Y(o(v),l=>(a(),s("td",{key:l,class:"px-3 py-2 text-gray-700 whitespace-nowrap"},i(c[l]||"â€”"),1))),128))]))),128))])])]),e("p",_i," Mostrando las primeras "+i(o(F).length)+" fila"+i(o(F).length!==1?"s":"")+" de tu archivo ",1)])):S("",!0)]))}}),$i=Object.assign(wi,{__name:"PatientsColumnMappingTable"});function ki(){const k=j(null),z=j([]),m=j(null),O=j(null),f=j(!1),$=j(!1),P=j(!1),A=j(null),H=async h=>{f.value=!0,A.value=null;try{const y=new FormData;y.append("file",h);const c=await fetch("/api/patients/import/detect-columns",{method:"POST",body:y});if(!c.ok){const l=await c.json();throw new Error(l.statusMessage||"Error al detectar columnas")}const w=await c.json();if(!w.success||!w.config)throw new Error("Respuesta invÃ¡lida del servidor");return k.value=w.config,z.value=w.config.mappings||[],await r(),!0}catch(y){return A.value=y.message||"Error al detectar columnas",console.error("Error en detectColumns:",y),!1}finally{f.value=!1}},b=(h,y)=>{const c=z.value.findIndex(w=>w.sourceColumn===h);c>=0?z.value[c]={sourceColumn:h,targetField:y}:z.value.push({sourceColumn:h,targetField:y}),r()},r=async()=>{if(!k.value)return A.value="No hay configuraciÃ³n de importaciÃ³n",!1;$.value=!0,A.value=null;try{const h=await fetch("/api/patients/import/validate-mapping",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({configId:k.value.id,mappings:z.value})});if(!h.ok){const c=await h.json();throw new Error(c.statusMessage||"Error al validar mapeo")}const y=await h.json();return m.value=y.validation,y.validation?.isValid||!1}catch(h){return A.value=h.message||"Error al validar mapeo",console.error("Error en validateMapping:",h),!1}finally{$.value=!1}},x=async(h,y)=>{if(!k.value)return A.value="No hay configuraciÃ³n de importaciÃ³n",!1;if(!m.value?.isValid)return A.value="El mapeo no es vÃ¡lido",!1;P.value=!0,A.value=null;try{const c=new FormData;c.append("file",h),c.append("configId",k.value.id),c.append("action",y),c.append("mappings",JSON.stringify(z.value));const w=await fetch("/api/patients/import/execute",{method:"POST",body:c});if(!w.ok){const d=await w.json();throw new Error(d.statusMessage||"Error al importar pacientes")}const l=await w.json();return O.value=l.results,l.success}catch(c){return A.value=c.message||"Error al importar pacientes",console.error("Error en executeImport:",c),!1}finally{P.value=!1}},L=()=>{k.value=null,z.value=[],m.value=null,O.value=null,f.value=!1,$.value=!1,P.value=!1,A.value=null},C=h=>z.value.find(c=>c.sourceColumn===h)?.targetField||"",v=()=>{if(!k.value?.detectedColumns)return[];const h=Math.min(k.value.detectedColumns[0]?.sampleValues?.length||0,3),y=[];for(let c=0;c<h;c++){const w={};for(const l of z.value)if(l.targetField){const d=k.value.detectedColumns.find(E=>E.name===l.sourceColumn);w[l.targetField]=d?.sampleValues?.[c]||""}y.push(w)}return y},F=D(()=>{const h=new Set(z.value.map(w=>w.targetField).filter(w=>w!=="")),y=h.has("nombre_completo"),c=h.has("email")||h.has("telefono");return y&&c});return{config:k,mappings:z,validation:m,importResult:O,detecting:f,validating:$,importing:P,error:A,detectColumns:H,updateMapping:b,validateMapping:r,executeImport:x,reset:L,getMappedField:C,getPreviewData:v,hasRequiredFields:F}}const Ci={class:"bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col"},Di={class:"px-6 py-4 border-b border-gray-200 flex items-center justify-between"},Si={class:"text-sm text-gray-500 mt-1"},Ei={class:"px-6 py-3 bg-gray-50"},Pi={class:"flex items-center gap-2"},Fi={class:"flex justify-between mt-2 text-xs text-gray-500"},Mi={class:"flex-1 overflow-y-auto p-6"},Ai={key:0,class:"space-y-6"},Bi={class:"text-center"},Ti={class:"bg-green-50 border border-green-200 rounded-lg p-4 text-sm"},Vi={class:"flex gap-3"},Ii={class:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-sm"},ji={class:"flex gap-3"},zi={class:"flex gap-3 justify-center pt-2"},Ri=["disabled"],qi=["disabled"],Ni={key:1,class:"space-y-6"},Oi={class:"text-center mb-6"},Li={key:0,class:"bg-green-50 border border-green-200 rounded-lg p-4 text-sm"},Ui={class:"flex gap-3"},Hi={class:"flex-1"},Gi={class:"text-green-800"},Qi={key:1,class:"bg-purple-50 border border-purple-200 rounded-lg p-6"},Zi={key:2,class:"bg-red-50 border border-red-200 rounded-lg p-4 text-sm"},Ji={class:"flex gap-3"},Ki={class:"text-red-800"},Xi={key:2,class:"space-y-6"},Yi={class:"text-center mb-6"},Wi={key:3,class:"space-y-6"},el={class:"text-center mb-6"},tl={class:"bg-gray-50 border border-gray-200 rounded-lg p-4"},ol={class:"flex flex-wrap gap-2"},al={key:0,class:"bg-amber-50 border border-amber-200 rounded-lg p-4"},sl={class:"flex gap-3"},rl={class:"text-sm text-amber-800 space-y-1"},nl={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},il={class:"flex items-start gap-3 cursor-pointer"},ll={key:1,class:"space-y-3"},dl={class:"overflow-x-auto border border-gray-200 rounded-lg"},cl={class:"w-full text-sm"},ul={class:"bg-gray-50"},pl={class:"divide-y divide-gray-100"},ml={key:4,class:"space-y-6"},bl={class:"text-center mb-6"},gl={class:"text-lg font-semibold text-cafe mb-2"},fl={class:"text-sm text-gray-600"},vl={key:0,class:"grid grid-cols-2 md:grid-cols-4 gap-4"},xl={class:"bg-gray-50 rounded-lg p-4 text-center"},hl={class:"text-2xl font-bold text-cafe"},yl={class:"bg-green-50 rounded-lg p-4 text-center"},_l={class:"text-2xl font-bold text-green-700"},wl={class:"bg-blue-50 rounded-lg p-4 text-center"},$l={class:"text-2xl font-bold text-blue-700"},kl={class:"bg-gray-100 rounded-lg p-4 text-center"},Cl={class:"text-2xl font-bold text-gray-700"},Dl={key:1,class:"bg-green-50 border border-green-200 rounded-lg p-4"},Sl={class:"flex gap-3"},El={key:2,class:"bg-amber-50 border border-amber-200 rounded-lg p-4"},Pl={class:"flex gap-3"},Fl={class:"flex-1"},Ml={class:"font-semibold text-amber-900 mb-2"},Al={class:"max-h-40 overflow-y-auto space-y-2"},Bl={class:"font-medium text-amber-900"},Tl={class:"text-amber-700"},Vl={key:0,class:"text-xs text-amber-700 italic"},Il={key:3,class:"bg-red-50 border border-red-200 rounded-lg p-4"},jl={class:"font-semibold text-red-900 mb-3 flex items-center gap-2"},zl={class:"max-h-40 overflow-y-auto space-y-2"},Rl={class:"font-semibold"},ql={class:"px-6 py-4 border-t border-gray-200 flex items-center justify-between bg-gray-50"},Nl=["disabled"],Ol={key:1},Ll={class:"flex gap-3"},Ul=["disabled"],Hl=["disabled"],Gl={key:0,class:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"},Ql=["disabled"],Zl=["disabled"],Jl={key:0,class:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"},Kl=Re({__name:"PatientsImportModal",props:{modelValue:{type:Boolean},existingPatients:{default:()=>[]}},emits:["update:modelValue","import-complete"],setup(k,{emit:z}){const m=z,O=qe(),f=ki(),$=j(1),P=j(null),A=j(!1),H=j(!0),b=j(!1),r={nombre_completo:"Nombre Completo",email:"Email",telefono:"TelÃ©fono",documento_identidad:"Documento",fecha_nacimiento:"Fecha Nac.",direccion:"DirecciÃ³n",contacto_emergencia:"Contacto Emergencia",area_de_acompanamiento:"Ãrea",frecuencia:"Frecuencia",activo:"Estado",derivacion:"DerivaciÃ³n",medicacion:"MedicaciÃ³n",orientacion_diagnostica:"DiagnÃ³stico",inicio_tratamiento:"Inicio Trat.",precio_sesion:"Precio",comision:"ComisiÃ³n",notas:"Notas"},x=u=>u?r[u]||u:"",L=D(()=>P.value!==null||f.config.value!==null||$.value>1),C=()=>{if(f.importing.value){O.warning("No se puede cerrar mientras se estÃ¡ importando");return}L.value&&$.value<5&&!confirm(`Â¿EstÃ¡s seguro de que deseas cancelar?

Se perderÃ¡ todo el progreso de la importaciÃ³n.
TendrÃ¡s que empezar de nuevo si cierras ahora.`)||(m("update:modelValue",!1),setTimeout(v,300))},v=()=>{$.value=1,P.value=null,A.value=!1,H.value=!0,b.value=!1,f.reset()},F=async u=>{try{A.value=!0;const t=await fetch(`/api/patients/template?format=${u}`);if(!t.ok)throw new Error("Error al descargar la plantilla");const g=await t.blob(),U=URL.createObjectURL(g),I=document.createElement("a");I.href=U,I.download=`plantilla_pacientes.${u}`,document.body.appendChild(I),I.click(),document.body.removeChild(I),URL.revokeObjectURL(U),O.success(`Plantilla ${u.toUpperCase()} descargada`)}catch(t){O.error(t.message||"Error al descargar la plantilla")}finally{A.value=!1}},h=u=>{P.value=u,f.error.value=null,O.info("Archivo seleccionado correctamente")},y=()=>{P.value=null,f.reset()},c=u=>{O.error(u)},w=(u,t)=>{f.updateMapping(u,t)},l=()=>{$.value<5&&$.value++},d=()=>{$.value>1&&$.value--},E=async()=>{if(!P.value)return;await f.detectColumns(P.value)?(O.success("Columnas detectadas correctamente"),$.value=3):O.error(f.error.value||"Error al detectar columnas")},q=async()=>{if(!P.value)return;const u=H.value?"update":"skip";if(await f.executeImport(P.value,u)){b.value=(f.importResult.value?.errors?.length||0)===0;const g=(f.importResult.value?.created||0)+(f.importResult.value?.updated||0);O.success(`${g} paciente${g!==1?"s":""} importado${g!==1?"s":""} correctamente`),$.value=5}else O.error(f.error.value||"Error al importar pacientes")},oe=()=>{m("import-complete"),C()};return(u,t)=>{const g=jn,U=$i;return a(),le(Je,{to:"body"},[_(Ee,{name:"modal"},{default:Ce(()=>[k.modelValue?(a(),s("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",onClick:re(C,["self"]),role:"dialog","aria-modal":"true","aria-labelledby":"import-modal-title"},[e("div",Ci,[e("div",Di,[e("div",null,[t[3]||(t[3]=e("h2",{id:"import-modal-title",class:"text-2xl font-serif font-bold text-cafe"}," Importar Pacientes ",-1)),e("p",Si," Paso "+i(o($))+" de 5 ",1)]),e("button",{onClick:C,class:"min-h-[44px] min-w-[44px] p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-gray-300","aria-label":"Cerrar modal"},[_(o(Be),{class:"w-6 h-6","aria-hidden":"true"})])]),e("div",Ei,[e("div",Pi,[(a(),s(J,null,Y(5,I=>e("div",{key:I,class:M(["flex-1 h-2 rounded-full transition-all duration-300",I<=o($)?"bg-purple-600":"bg-gray-200"])},null,2)),64))]),e("div",Fi,[e("span",{class:M({"text-purple-600 font-medium":o($)===1})},"Info",2),e("span",{class:M({"text-purple-600 font-medium":o($)===2})},"Subir",2),e("span",{class:M({"text-purple-600 font-medium":o($)===3})},"Mapear",2),e("span",{class:M({"text-purple-600 font-medium":o($)===4})},"Revisar",2),e("span",{class:M({"text-purple-600 font-medium":o($)===5})},"Resultado",2)])]),e("div",Mi,[o($)===1?(a(),s("div",Ai,[e("div",Bi,[_(o(Ao),{class:"w-16 h-16 mx-auto text-purple-600 mb-4","aria-hidden":"true"}),t[4]||(t[4]=e("h3",{class:"text-lg font-semibold text-cafe mb-2"}," Paso 1: Prepara tu archivo ",-1)),t[5]||(t[5]=e("p",{class:"text-sm text-gray-600 mb-2 max-w-md mx-auto"},[V(" Puedes usar "),e("strong",null,"cualquier Excel o CSV"),V(" con tus pacientes. El sistema detectarÃ¡ las columnas automÃ¡ticamente. ")],-1))]),e("div",Ti,[e("div",Vi,[_(o(ke),{class:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),t[6]||(t[6]=e("div",null,[e("p",{class:"font-semibold text-green-900 mb-2"},"Â¿Ya tienes un Excel con pacientes?"),e("p",{class:"text-green-800"}," Â¡Perfecto! Puedes subirlo directamente. En el siguiente paso podrÃ¡s relacionar las columnas de tu archivo con los campos de TeraplÃ­. ")],-1))])]),e("div",Ii,[e("div",ji,[_(o(nt),{class:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),t[7]||(t[7]=e("div",{class:"space-y-3"},[e("div",null,[e("p",{class:"font-semibold text-blue-900 mb-1"},"Formatos aceptados:"),e("p",{class:"text-blue-800"},"CSV (.csv) y Excel (.xlsx, .xls)"),e("p",{class:"text-xs text-blue-700 mt-1"},"TamaÃ±o mÃ¡ximo: 10MB | MÃ¡ximo 5,000 filas")]),e("div",null,[e("p",{class:"font-semibold text-blue-900 mb-1"},"Campos mÃ­nimos necesarios:"),e("ul",{class:"list-disc list-inside text-blue-800 space-y-1"},[e("li",null,[e("strong",null,"Nombre"),V(" del paciente (obligatorio)")]),e("li",null,[e("strong",null,"Email"),V(" o "),e("strong",null,"TelÃ©fono"),V(" (al menos uno)")])])]),e("div",null,[e("p",{class:"font-semibold text-blue-900 mb-1"},"Campos adicionales soportados:"),e("p",{class:"text-blue-800 text-xs"}," Documento de identidad, DirecciÃ³n, Fecha de nacimiento, Ãrea de tratamiento, Frecuencia, DerivaciÃ³n, MedicaciÃ³n, DiagnÃ³stico, Notas, Precio, y mÃ¡s... ")])],-1))])]),e("div",zi,[e("button",{onClick:t[0]||(t[0]=I=>F("csv")),disabled:o(A),class:"min-h-[44px] px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all text-sm disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"},[_(o(ze),{class:"w-4 h-4","aria-hidden":"true"}),t[8]||(t[8]=e("span",null,"Descargar plantilla CSV",-1))],8,Ri),e("button",{onClick:t[1]||(t[1]=I=>F("xlsx")),disabled:o(A),class:"min-h-[44px] px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all text-sm disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"},[_(o(ze),{class:"w-4 h-4","aria-hidden":"true"}),t[9]||(t[9]=e("span",null,"Descargar plantilla Excel",-1))],8,qi)])])):S("",!0),o($)===2?(a(),s("div",Ni,[e("div",Oi,[_(o(rt),{class:"w-16 h-16 mx-auto text-purple-600 mb-4","aria-hidden":"true"}),t[10]||(t[10]=e("h3",{class:"text-lg font-semibold text-cafe mb-2"}," Paso 2: Sube tu archivo ",-1)),t[11]||(t[11]=e("p",{class:"text-sm text-gray-600 mb-1"}," Arrastra tu archivo o haz clic para seleccionarlo ",-1)),t[12]||(t[12]=e("p",{class:"text-xs text-gray-500"}," Detectaremos las columnas automÃ¡ticamente ",-1))]),_(g,{onFileSelected:h,onFileRemoved:y,onError:c}),o(P)&&!o(f).detecting.value?(a(),s("div",Li,[e("div",Ui,[_(o(ke),{class:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e("div",Hi,[t[13]||(t[13]=e("p",{class:"font-semibold text-green-900 mb-1"},"Archivo seleccionado correctamente",-1)),e("p",Gi,i(o(P).name),1),t[14]||(t[14]=e("p",{class:"text-xs text-green-700 mt-1"},' Haz clic en "Detectar columnas" para continuar ',-1))])])])):S("",!0),o(f).detecting.value?(a(),s("div",Qi,[...t[15]||(t[15]=[e("div",{class:"flex flex-col items-center justify-center gap-4"},[e("div",{class:"animate-spin w-12 h-12 border-4 border-purple-600 border-t-transparent rounded-full"}),e("div",{class:"text-center"},[e("p",{class:"text-purple-900 font-medium mb-1"},"Analizando archivo..."),e("p",{class:"text-sm text-purple-700"},"Detectando columnas y sugiriendo mapeo")])],-1)])])):S("",!0),o(f).error.value?(a(),s("div",Zi,[e("div",Ji,[_(o(De),{class:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e("div",null,[t[16]||(t[16]=e("p",{class:"font-semibold text-red-900 mb-1"},"Error al procesar archivo",-1)),e("p",Ki,i(o(f).error.value),1)])])])):S("",!0)])):S("",!0),o($)===3?(a(),s("div",Xi,[e("div",Yi,[_(o(Po),{class:"w-16 h-16 mx-auto text-purple-600 mb-4","aria-hidden":"true"}),t[17]||(t[17]=e("h3",{class:"text-lg font-semibold text-cafe mb-2"}," Paso 3: Mapea las columnas ",-1)),t[18]||(t[18]=e("p",{class:"text-sm text-gray-600"}," Relaciona las columnas de tu archivo con los campos de TeraplÃ­ ",-1))]),_(U,{"detected-columns":o(f).config.value?.detectedColumns||[],mappings:o(f).mappings.value,validation:o(f).validation.value,"onUpdate:mapping":w},null,8,["detected-columns","mappings","validation"])])):S("",!0),o($)===4?(a(),s("div",Wi,[e("div",el,[_(o(Mo),{class:"w-16 h-16 mx-auto text-purple-600 mb-4","aria-hidden":"true"}),t[19]||(t[19]=e("h3",{class:"text-lg font-semibold text-cafe mb-2"}," Paso 4: Confirma la importaciÃ³n ",-1)),t[20]||(t[20]=e("p",{class:"text-sm text-gray-600"}," Revisa el resumen antes de importar ",-1))]),e("div",tl,[t[21]||(t[21]=e("h4",{class:"font-semibold text-gray-900 mb-3"},"Campos que se importarÃ¡n:",-1)),e("div",ol,[(a(!0),s(J,null,Y(o(f).mappings.value.filter(I=>I.targetField),I=>(a(),s("span",{key:I.sourceColumn,class:"inline-flex items-center gap-1 px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm"},[_(o(ke),{class:"w-4 h-4"}),V(" "+i(x(I.targetField)),1)]))),128))])]),o(f).validation.value?.warnings?.length?(a(),s("div",al,[e("div",sl,[_(o(Me),{class:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e("div",null,[t[22]||(t[22]=e("p",{class:"font-semibold text-amber-900 mb-2"},"Advertencias:",-1)),e("ul",rl,[(a(!0),s(J,null,Y(o(f).validation.value.warnings,(I,ae)=>(a(),s("li",{key:ae}," â€¢ "+i(I),1))),128))])])])])):S("",!0),e("div",nl,[e("label",il,[Z(e("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=I=>_e(H)?H.value=I:null),class:"mt-1 w-5 h-5 text-purple-600 border-gray-300 rounded focus:ring-2 focus:ring-purple-300 cursor-pointer"},null,512),[[Se,o(H)]]),t[23]||(t[23]=e("div",{class:"flex-1"},[e("p",{class:"font-semibold text-blue-900 mb-1"}," Actualizar pacientes existentes "),e("p",{class:"text-sm text-blue-800"}," Si un paciente ya existe (mismo email o telÃ©fono), actualizar sus datos con la informaciÃ³n del archivo. "),e("p",{class:"text-xs text-blue-700 mt-1"}," Si no marcas esta opciÃ³n, los pacientes duplicados se omitirÃ¡n. ")],-1))])]),o(f).getPreviewData().length>0?(a(),s("div",ll,[t[24]||(t[24]=e("h4",{class:"font-semibold text-gray-900"},"Vista previa de datos:",-1)),e("div",dl,[e("table",cl,[e("thead",ul,[e("tr",null,[(a(!0),s(J,null,Y(o(f).mappings.value.filter(I=>I.targetField),I=>(a(),s("th",{key:I.targetField,class:"px-3 py-2 text-left font-medium text-gray-700 whitespace-nowrap"},i(x(I.targetField)),1))),128))])]),e("tbody",pl,[(a(!0),s(J,null,Y(o(f).getPreviewData(),(I,ae)=>(a(),s("tr",{key:ae},[(a(!0),s(J,null,Y(o(f).mappings.value.filter(G=>G.targetField),G=>(a(),s("td",{key:G.targetField,class:"px-3 py-2 text-gray-600 whitespace-nowrap"},i(I[G.targetField]||"â€”"),1))),128))]))),128))])])]),t[25]||(t[25]=e("p",{class:"text-xs text-gray-500"},"Vista previa de las primeras filas",-1))])):S("",!0)])):S("",!0),o($)===5?(a(),s("div",ml,[e("div",bl,[o(b)?(a(),le(o(ke),{key:0,class:"w-16 h-16 mx-auto text-green-600 mb-4","aria-hidden":"true"})):(a(),le(o(Me),{key:1,class:"w-16 h-16 mx-auto text-amber-600 mb-4","aria-hidden":"true"})),e("h3",gl,i(o(b)?"ImportaciÃ³n completada con Ã©xito":"ImportaciÃ³n completada con advertencias"),1),e("p",fl,i(o(b)?"Los pacientes se han importado correctamente":"La importaciÃ³n se completÃ³ pero algunos pacientes tienen perfil incompleto"),1)]),o(f).importResult.value?(a(),s("div",vl,[e("div",xl,[e("p",hl,i(o(f).importResult.value.total),1),t[26]||(t[26]=e("p",{class:"text-xs text-gray-600"},"Total",-1))]),e("div",yl,[e("p",_l,i(o(f).importResult.value.created),1),t[27]||(t[27]=e("p",{class:"text-xs text-gray-600"},"Creados",-1))]),e("div",wl,[e("p",$l,i(o(f).importResult.value.updated),1),t[28]||(t[28]=e("p",{class:"text-xs text-gray-600"},"Actualizados",-1))]),e("div",kl,[e("p",Cl,i(o(f).importResult.value.skipped),1),t[29]||(t[29]=e("p",{class:"text-xs text-gray-600"},"Omitidos",-1))])])):S("",!0),o(b)?(a(),s("div",Dl,[e("div",Sl,[_(o(ke),{class:"w-6 h-6 text-green-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),t[30]||(t[30]=e("div",{class:"flex-1"},[e("p",{class:"font-semibold text-green-900 mb-2"},"Â¡ImportaciÃ³n exitosa!"),e("p",{class:"text-sm text-green-800"}," Los pacientes se han aÃ±adido a tu lista y ya puedes gestionar sus citas y tratamientos. ")],-1))])])):S("",!0),o(f).importResult.value?.incompleteProfiles?.length?(a(),s("div",El,[e("div",Pl,[_(o(Me),{class:"w-6 h-6 text-amber-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e("div",Fl,[e("p",Ml,i(o(f).importResult.value.incompleteProfiles.length)+" paciente"+i(o(f).importResult.value.incompleteProfiles.length!==1?"s":"")+" con perfil incompleto ",1),t[31]||(t[31]=e("p",{class:"text-sm text-amber-800 mb-3"}," Los siguientes pacientes fueron importados pero les faltan datos importantes: ",-1)),e("div",Al,[(a(!0),s(J,null,Y(o(f).importResult.value.incompleteProfiles.slice(0,5),I=>(a(),s("div",{key:I.rowNumber,class:"bg-white border border-amber-200 rounded p-2 text-sm"},[e("span",Bl,i(I.nombre_completo),1),e("span",Tl," â€” Faltan: "+i(I.missingFields.join(", ")),1)]))),128)),o(f).importResult.value.incompleteProfiles.length>5?(a(),s("p",Vl," ... y "+i(o(f).importResult.value.incompleteProfiles.length-5)+" mÃ¡s ",1)):S("",!0)]),t[32]||(t[32]=e("p",{class:"text-xs text-amber-700 mt-3"}," ðŸ’¡ Puedes completar esta informaciÃ³n editando cada paciente desde la lista. ",-1))])])])):S("",!0),o(f).importResult.value?.errors?.length?(a(),s("div",Il,[e("h4",jl,[_(o(De),{class:"w-5 h-5","aria-hidden":"true"}),V(" Errores durante la importaciÃ³n ("+i(o(f).importResult.value.errors.length)+") ",1)]),e("div",zl,[(a(!0),s(J,null,Y(o(f).importResult.value.errors.slice(0,10),(I,ae)=>(a(),s("div",{key:ae,class:"bg-white border border-red-200 rounded p-2 text-sm text-red-800"},[e("span",Rl,"Fila "+i(I.row)+":",1),V(" "+i(I.error),1)]))),128))])])):S("",!0)])):S("",!0)]),e("div",ql,[o($)>1&&o($)<5?(a(),s("button",{key:0,onClick:d,disabled:o(f).importing.value||o(f).detecting.value,class:"min-h-[44px] px-6 py-2.5 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-all font-medium disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-gray-300"}," AtrÃ¡s ",8,Nl)):(a(),s("div",Ol)),e("div",Ll,[o($)<5?(a(),s("button",{key:0,onClick:C,disabled:o(f).importing.value,class:"min-h-[44px] px-6 py-2.5 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all font-medium disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-gray-300"}," Cancelar ",8,Ul)):S("",!0),o($)===1?(a(),s("button",{key:1,onClick:l,class:"min-h-[44px] px-6 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all font-medium shadow-sm hover:shadow-md focus:outline-none focus:ring-2 focus:ring-purple-300"}," Continuar ")):S("",!0),o($)===2?(a(),s("button",{key:2,onClick:E,disabled:!o(P)||o(f).detecting.value,class:"min-h-[44px] px-6 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all font-medium shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-purple-300 flex items-center gap-2"},[o(f).detecting.value?(a(),s("div",Gl)):S("",!0),e("span",null,i(o(f).detecting.value?"Analizando...":"Detectar columnas"),1)],8,Hl)):S("",!0),o($)===3?(a(),s("button",{key:3,onClick:l,disabled:!o(f).validation.value?.isValid,class:"min-h-[44px] px-6 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all font-medium shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-purple-300"}," Continuar ",8,Ql)):S("",!0),o($)===4?(a(),s("button",{key:4,onClick:q,disabled:o(f).importing.value,class:"min-h-[44px] px-6 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all font-medium shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-purple-300 flex items-center gap-2"},[o(f).importing.value?(a(),s("div",Jl)):S("",!0),e("span",null,i(o(f).importing.value?"Importando...":"Importar pacientes"),1)],8,Zl)):S("",!0),o($)===5?(a(),s("button",{key:5,onClick:oe,class:"min-h-[44px] px-6 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all font-medium shadow-sm hover:shadow-md focus:outline-none focus:ring-2 focus:ring-purple-300"}," Finalizar ")):S("",!0)])])])])):S("",!0)]),_:1})])}}}),Xl=Object.assign(Ae(Kl,[["__scopeId","data-v-97261e0d"]]),{__name:"PatientsImportModal"}),Yl={class:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col"},Wl={class:"px-6 py-4 border-b border-gray-200 flex items-center justify-between"},ed={class:"flex-1 overflow-y-auto p-6 space-y-6"},td={class:"flex gap-3"},od={class:"space-y-2"},ad={class:"flex-1"},sd={class:"text-xs text-gray-600"},rd={class:"flex-1"},nd={class:"text-xs text-gray-600"},id={class:"flex-1"},ld={class:"text-xs text-gray-600"},dd={class:"grid grid-cols-2 gap-2"},cd=["value"],ud={class:"text-sm text-cafe"},pd={class:"px-6 py-4 border-t border-gray-200 flex items-center justify-between bg-gray-50"},md=["disabled"],bd=["disabled"],gd={key:1},fd={key:2},vd=Re({__name:"PatientsExportModal",props:{modelValue:{type:Boolean},totalPatients:{},filteredCount:{},selectedCount:{default:0},hasFilters:{type:Boolean,default:!1},currentFilters:{default:()=>({})},selectedIds:{default:()=>[]}},emits:["update:modelValue"],setup(k,{emit:z}){const m=k,O=z,f=qe(),$=j("csv"),P=j("all"),A=j(["nombre_completo","email","telefono","area_de_acompanamiento","frecuencia","activo"]),H=j(!1),b=[{value:"nombre_completo",label:"Nombre Completo"},{value:"email",label:"Email"},{value:"telefono",label:"TelÃ©fono"},{value:"area_de_acompanamiento",label:"Ãrea"},{value:"frecuencia",label:"Frecuencia"},{value:"activo",label:"Estado"},{value:"ultima_sesion",label:"Ãšltima SesiÃ³n"},{value:"proxima_sesion",label:"PrÃ³xima SesiÃ³n"},{value:"total_sesiones",label:"Total Sesiones"},{value:"created_at",label:"Fecha de Registro"}],r=()=>{H.value||O("update:modelValue",!1)},x=()=>{A.value.length===b.length?A.value=[]:A.value=b.map(C=>C.value)},L=async()=>{if(A.value.length===0){f.warning("Selecciona al menos un campo para exportar");return}try{H.value=!0;const C=new URLSearchParams({format:$.value,scope:P.value,fields:A.value.join(",")});P.value==="filtered"&&m.currentFilters&&C.append("filters",JSON.stringify(m.currentFilters)),P.value==="selected"&&m.selectedIds.length>0&&C.append("selectedIds",m.selectedIds.join(","));const v=await fetch(`/api/patients/export?${C.toString()}`);if(!v.ok){const c=await v.json();throw new Error(c.statusMessage||"Error al exportar pacientes")}const F=await v.blob(),h=URL.createObjectURL(F),y=document.createElement("a");y.href=h,y.download=`pacientes_${new Date().toISOString().split("T")[0]}.${$.value}`,document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(h),f.success("Pacientes exportados correctamente"),r()}catch(C){f.error(C.message||"Error al exportar pacientes")}finally{H.value=!1}};return to(()=>{m.selectedCount>0?P.value="selected":m.hasFilters?P.value="filtered":P.value="all"}),(C,v)=>(a(),le(Je,{to:"body"},[_(Ee,{name:"modal"},{default:Ce(()=>[k.modelValue?(a(),s("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",onClick:re(r,["self"]),role:"dialog","aria-modal":"true","aria-labelledby":"export-modal-title"},[e("div",Yl,[e("div",Wl,[v[6]||(v[6]=e("div",null,[e("h2",{id:"export-modal-title",class:"text-2xl font-serif font-bold text-cafe"}," Exportar Pacientes "),e("p",{class:"text-sm text-gray-500 mt-1"}," Selecciona las opciones de exportaciÃ³n ")],-1)),e("button",{onClick:r,class:"min-h-[44px] min-w-[44px] p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-gray-300","aria-label":"Cerrar modal"},[_(o(Be),{class:"w-6 h-6","aria-hidden":"true"})])]),e("div",ed,[e("div",null,[v[9]||(v[9]=e("label",{class:"block text-sm font-semibold text-cafe mb-3"}," Formato de archivo ",-1)),e("div",td,[e("button",{onClick:v[0]||(v[0]=F=>$.value="csv"),class:M(["min-h-[44px] flex-1 px-4 py-3 rounded-lg border-2 transition-all font-medium flex items-center justify-center gap-2",o($)==="csv"?"border-purple-600 bg-purple-50 text-purple-600":"border-gray-200 bg-white text-gray-600 hover:border-gray-300"])},[_(o(ze),{class:"w-5 h-5","aria-hidden":"true"}),v[7]||(v[7]=e("span",null,"CSV",-1))],2),e("button",{onClick:v[1]||(v[1]=F=>$.value="xlsx"),class:M(["min-h-[44px] flex-1 px-4 py-3 rounded-lg border-2 transition-all font-medium flex items-center justify-center gap-2",o($)==="xlsx"?"border-purple-600 bg-purple-50 text-purple-600":"border-gray-200 bg-white text-gray-600 hover:border-gray-300"])},[_(o(ze),{class:"w-5 h-5","aria-hidden":"true"}),v[8]||(v[8]=e("span",null,"XLSX",-1))],2)])]),e("div",null,[v[13]||(v[13]=e("label",{class:"block text-sm font-semibold text-cafe mb-3"}," Â¿QuÃ© pacientes exportar? ",-1)),e("div",od,[e("label",{class:M(["flex items-center gap-3 p-3 border-2 rounded-lg cursor-pointer transition-all",o(P)==="all"?"border-purple-600 bg-purple-50":"border-gray-200 bg-white hover:border-gray-300"])},[Z(e("input",{type:"radio","onUpdate:modelValue":v[2]||(v[2]=F=>_e(P)?P.value=F:null),value:"all",class:"w-4 h-4 text-purple-600 border-gray-300 focus:ring-2 focus:ring-purple-300"},null,512),[[at,o(P)]]),e("div",ad,[v[10]||(v[10]=e("p",{class:"font-medium text-cafe"},"Todos los pacientes",-1)),e("p",sd,"Exportar todos los pacientes ("+i(k.totalPatients)+")",1)])],2),k.hasFilters?(a(),s("label",{key:0,class:M(["flex items-center gap-3 p-3 border-2 rounded-lg cursor-pointer transition-all",o(P)==="filtered"?"border-purple-600 bg-purple-50":"border-gray-200 bg-white hover:border-gray-300"])},[Z(e("input",{type:"radio","onUpdate:modelValue":v[3]||(v[3]=F=>_e(P)?P.value=F:null),value:"filtered",class:"w-4 h-4 text-purple-600 border-gray-300 focus:ring-2 focus:ring-purple-300"},null,512),[[at,o(P)]]),e("div",rd,[v[11]||(v[11]=e("p",{class:"font-medium text-cafe"},"Pacientes filtrados",-1)),e("p",nd,"Exportar solo los pacientes que cumplen los filtros actuales ("+i(k.filteredCount)+")",1)])],2)):S("",!0),k.selectedCount>0?(a(),s("label",{key:1,class:M(["flex items-center gap-3 p-3 border-2 rounded-lg cursor-pointer transition-all",o(P)==="selected"?"border-purple-600 bg-purple-50":"border-gray-200 bg-white hover:border-gray-300"])},[Z(e("input",{type:"radio","onUpdate:modelValue":v[4]||(v[4]=F=>_e(P)?P.value=F:null),value:"selected",class:"w-4 h-4 text-purple-600 border-gray-300 focus:ring-2 focus:ring-purple-300"},null,512),[[at,o(P)]]),e("div",id,[v[12]||(v[12]=e("p",{class:"font-medium text-cafe"},"Pacientes seleccionados",-1)),e("p",ld,"Exportar solo los pacientes seleccionados ("+i(k.selectedCount)+")",1)])],2)):S("",!0)])]),e("div",null,[v[14]||(v[14]=e("label",{class:"block text-sm font-semibold text-cafe mb-3"}," Campos a exportar ",-1)),e("div",dd,[(a(),s(J,null,Y(b,F=>e("label",{key:F.value,class:"flex items-center gap-2 p-2 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors"},[Z(e("input",{type:"checkbox","onUpdate:modelValue":v[5]||(v[5]=h=>_e(A)?A.value=h:null),value:F.value,class:"w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-2 focus:ring-purple-300"},null,8,cd),[[Se,o(A)]]),e("span",ud,i(F.label),1)])),64))]),e("button",{onClick:x,class:"mt-2 text-xs text-purple-600 hover:text-purple-700 font-medium"},i(o(A).length===b.length?"Deseleccionar todos":"Seleccionar todos"),1)])]),e("div",pd,[e("button",{onClick:r,disabled:o(H),class:"min-h-[44px] px-6 py-2.5 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all font-medium disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-gray-300"}," Cancelar ",8,md),e("button",{onClick:L,disabled:o(H)||o(A).length===0,class:"min-h-[44px] px-6 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-600/90 transition-all font-medium shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-purple-300 flex items-center gap-2"},[o(H)?S("",!0):(a(),le(o(st),{key:0,class:"w-5 h-5","aria-hidden":"true"})),o(H)?(a(),s("span",gd,"Exportando...")):(a(),s("span",fd,"Exportar"))],8,bd)])])])):S("",!0)]),_:1})]))}}),xd=Object.assign(Ae(vd,[["__scopeId","data-v-797ad56f"]]),{__name:"PatientsExportModal"}),hd={class:"relative min-h-screen flex items-center justify-center p-4"},yd={class:"relative px-6 pt-6 pb-4 bg-gradient-to-br from-purple-500 to-purple-600"},_d={class:"flex items-center gap-4"},wd={class:"flex-1 min-w-0"},$d={class:"text-xl font-semibold text-white truncate"},kd={class:"flex items-center gap-2 mt-1"},Cd={key:0,class:"text-sm text-white/70"},Dd={class:"px-6 py-4 space-y-4"},Sd={class:"flex items-center gap-2 mb-1"},Ed={key:0,class:"text-sm font-semibold text-purple-700"},Pd={key:1,class:"text-sm font-medium text-amber-700"},Fd={class:"grid grid-cols-2 gap-3"},Md={class:"p-3 bg-gray-50 rounded-lg"},Ad={class:"flex items-center gap-1.5"},Bd={class:"text-sm font-medium text-gray-900"},Td={class:"p-3 bg-gray-50 rounded-lg"},Vd={class:"text-sm font-medium text-gray-900"},Id={class:"flex items-center justify-between mb-2"},jd={class:"flex items-center gap-1.5"},zd={class:"relative h-2 bg-gray-200 rounded-full overflow-hidden mb-1"},Rd={class:"flex justify-between"},qd={class:"text-xs text-gray-500"},Nd={class:"flex flex-col gap-2"},Od={key:0,class:"flex items-center gap-2 text-sm text-gray-600"},Ld={class:"truncate"},Ud={key:1,class:"flex items-center gap-2 text-sm text-gray-600"},Hd={class:"px-6 py-4 bg-gray-50 border-t border-gray-100 flex items-center gap-2"},Gd={__name:"ModalPreviewPaciente",props:{mostrar:{type:Boolean,default:!1},paciente:{type:Object,default:null}},emits:["cerrar","ver-ficha","editar","gestionar-bonos"],setup(k){const z=k,m=D(()=>{if(!z.paciente?.nombre)return"??";const l=z.paciente.nombre.trim().split(" ");return`${l[0]?.charAt(0)||"?"}${l[1]?.charAt(0)||""}`.toUpperCase()}),O=D(()=>{if(!z.paciente||!z.paciente.activo)return"#9CA3AF";if(z.paciente.en_pausa)return"#F59E0B";const l=["#8B5CF6","#EC4899","#06B6D4","#10B981","#6366F1","#F97316"],d=z.paciente.id.charCodeAt(0)%l.length;return l[d]}),f=D(()=>z.paciente?.activo?z.paciente.en_pausa?"Pausa":"Activo":"Finalizado"),$=D(()=>z.paciente?.activo?z.paciente.en_pausa?"bg-amber-400/20 text-amber-100":"bg-green-400/20 text-green-100":"bg-white/20 text-white"),P=l=>{if(!l)return null;try{let d=l;d.includes("T")||(d+="T00:00:00");const E=new Date(d);return isNaN(E.getTime())?null:E.toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long",hour:"2-digit",minute:"2-digit"})}catch{return null}},A=D(()=>{if(!z.paciente?.ultima_sesion)return 999;const l=new Date(z.paciente.ultima_sesion);return Math.floor((new Date-l)/(1e3*60*60*24))}),H=D(()=>{if(!z.paciente?.ultima_sesion)return"Sin registro";const l=new Date(z.paciente.ultima_sesion),d=A.value;return d===0?"Hoy":d===1?"Ayer":d<7?`Hace ${d} dÃ­as`:d<30?`Hace ${Math.floor(d/7)} semanas`:l.toLocaleDateString("es-ES",{day:"numeric",month:"long"})}),b=D(()=>z.paciente?.ultima_sesion?A.value<=7?"bg-green-500":A.value<=14?"bg-blue-500":A.value<=30?"bg-amber-500":"bg-red-500":"bg-gray-300"),r=D(()=>z.paciente?.bono_activo),x=D(()=>r.value?.tipo?{otro:"A demanda",quincenal:"Quincenal",semanal:"Semanal",mensual:"Mensual"}[r.value.tipo]||r.value.tipo:""),L=D(()=>r.value?r.value.sesiones_totales-r.value.sesiones_restantes:0),C=D(()=>!r.value||r.value.sesiones_totales===0?0:Math.round(L.value/r.value.sesiones_totales*100)),v=D(()=>r.value?r.value.sesiones_restantes<=1?"bg-red-500":r.value.sesiones_restantes===2?"bg-amber-500":"bg-purple-500":"bg-gray-400"),F=D(()=>r.value?r.value.sesiones_restantes<=1?"bg-red-50 border border-red-100":r.value.sesiones_restantes===2?"bg-amber-50 border border-amber-100":"bg-purple-50 border border-purple-100":"bg-gray-50"),h=D(()=>r.value?r.value.sesiones_restantes<=1?"text-red-500":r.value.sesiones_restantes===2?"text-amber-500":"text-purple-500":"text-gray-400"),y=D(()=>r.value?r.value.sesiones_restantes<=1?"text-red-700":r.value.sesiones_restantes===2?"text-amber-700":"text-purple-700":"text-gray-600"),c=D(()=>{if(!r.value?.fecha_fin)return"â€”";try{const l=new Date(r.value.fecha_fin),E=Math.floor((l-new Date)/(1e3*60*60*24));return E<0?"Vencido":E===0?"Vence hoy":E===1?"Vence maÃ±ana":E<=7?`Vence en ${E}d`:l.toLocaleDateString("es-ES",{day:"numeric",month:"short"})}catch{return"â€”"}}),w=D(()=>{if(!r.value?.fecha_fin)return"text-gray-400";const l=new Date(r.value.fecha_fin),E=Math.floor((l-new Date)/(1e3*60*60*24));return E<0?"text-red-600 font-medium":E<=7?"text-amber-600 font-medium":"text-gray-500"});return(l,d)=>(a(),le(Je,{to:"body"},[_(Ee,{"enter-active-class":"transition-all duration-200 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-all duration-150 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:Ce(()=>[k.mostrar&&k.paciente?(a(),s("div",{key:0,class:"fixed inset-0 z-50 overflow-y-auto",onClick:d[6]||(d[6]=re(E=>l.$emit("cerrar"),["self"]))},[e("div",{class:"fixed inset-0 bg-black/30 backdrop-blur-sm",onClick:d[0]||(d[0]=E=>l.$emit("cerrar"))}),e("div",hd,[_(Ee,{"enter-active-class":"transition-all duration-200 ease-out","enter-from-class":"opacity-0 scale-95 translate-y-4","enter-to-class":"opacity-100 scale-100 translate-y-0","leave-active-class":"transition-all duration-150 ease-in","leave-from-class":"opacity-100 scale-100 translate-y-0","leave-to-class":"opacity-0 scale-95 translate-y-4"},{default:Ce(()=>[k.mostrar?(a(),s("div",{key:0,class:"relative bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden",onClick:d[5]||(d[5]=re(()=>{},["stop"]))},[e("div",yd,[e("button",{onClick:d[1]||(d[1]=E=>l.$emit("cerrar")),class:"absolute top-4 right-4 p-1.5 text-white/80 hover:text-white hover:bg-white/10 rounded-lg transition-colors"},[_(o(Be),{class:"w-5 h-5"})]),e("div",_d,[e("div",{class:"w-16 h-16 rounded-full flex items-center justify-center text-white text-xl font-bold ring-4 ring-white/20",style:Pe({backgroundColor:o(O)})},i(o(m)),5),e("div",wd,[e("h2",$d,i(k.paciente.nombre||"Sin nombre"),1),e("div",kd,[e("span",{class:M(["inline-flex items-center px-2 py-0.5 text-xs font-medium rounded-full",o($)])},i(o(f)),3),k.paciente.area_de_acompanamiento?(a(),s("span",Cd,i(k.paciente.area_de_acompanamiento),1)):S("",!0)])])])]),e("div",Dd,[e("div",{class:M(["p-3 rounded-lg",k.paciente.proxima_sesion?"bg-purple-50":"bg-amber-50"])},[e("div",Sd,[_(o(Qe),{class:M(["w-4 h-4",k.paciente.proxima_sesion?"text-purple-500":"text-amber-500"])},null,8,["class"]),d[7]||(d[7]=e("span",{class:"text-xs font-medium text-gray-500"},"PrÃ³xima cita",-1))]),k.paciente.proxima_sesion?(a(),s("p",Ed,i(P(k.paciente.proxima_sesion)),1)):(a(),s("p",Pd,"Sin cita programada"))],2),e("div",Fd,[e("div",Md,[d[8]||(d[8]=e("p",{class:"text-xs text-gray-500 mb-0.5"},"Ãšltima sesiÃ³n",-1)),e("div",Ad,[e("div",{class:M(["w-2 h-2 rounded-full",o(b)])},null,2),e("span",Bd,i(o(H)),1)])]),e("div",Td,[d[9]||(d[9]=e("p",{class:"text-xs text-gray-500 mb-0.5"},"Total sesiones",-1)),e("p",Vd,i(k.paciente.total_sesiones||0),1)])]),k.paciente.bono_activo?(a(),s("div",{key:0,class:M(["p-3 rounded-lg",o(F)])},[e("div",Id,[e("div",jd,[_(o(je),{class:M(["w-4 h-4",o(h)])},null,8,["class"]),e("span",{class:M(["text-sm font-medium",o(y)])},i(o(x)),3)]),e("span",{class:M(["text-xs",o(w)])},i(o(c)),3)]),e("div",zd,[e("div",{class:M(["absolute left-0 top-0 h-full rounded-full transition-all",o(v)]),style:Pe({width:o(C)+"%"})},null,6)]),e("div",Rd,[e("span",qd,i(o(L))+" usadas",1),e("span",{class:M(["text-xs font-semibold",o(y)])},i(k.paciente.bono_activo.sesiones_restantes)+" restantes ",3)])],2)):S("",!0),e("div",Nd,[k.paciente.email?(a(),s("div",Od,[_(o(co),{class:"w-4 h-4 text-gray-400"}),e("span",Ld,i(k.paciente.email),1)])):S("",!0),k.paciente.telefono?(a(),s("div",Ud,[_(o(uo),{class:"w-4 h-4 text-gray-400"}),e("span",null,i(k.paciente.telefono),1)])):S("",!0)])]),e("div",Hd,[e("button",{onClick:d[2]||(d[2]=E=>l.$emit("ver-ficha",k.paciente)),class:"flex-1 px-4 py-2 bg-purple-600 text-white text-sm font-medium rounded-lg hover:bg-purple-700 transition-colors"}," Ver ficha completa "),e("button",{onClick:d[3]||(d[3]=E=>l.$emit("editar",k.paciente)),class:"px-4 py-2 text-gray-600 text-sm font-medium hover:bg-gray-100 rounded-lg transition-colors"}," Editar "),e("button",{onClick:d[4]||(d[4]=E=>l.$emit("gestionar-bonos",k.paciente)),class:"px-4 py-2 text-gray-600 text-sm font-medium hover:bg-gray-100 rounded-lg transition-colors"}," Bonos ")])])):S("",!0)]),_:1})])])):S("",!0)]),_:1})]))}},Qd={class:"mb-6"},Zd={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-5"},Jd={class:"text-2xl font-semibold text-gray-900"},Kd={class:"text-gray-400 font-normal"},Xd={class:"flex items-center gap-2"},Yd={key:0,class:"bg-white border border-gray-100 rounded-xl p-4 mb-4 overflow-hidden"},Wd={class:"flex items-center justify-between mb-4"},ec={class:"text-lg font-semibold text-gray-900 flex items-center gap-2"},tc={class:"flex items-center bg-gray-100 rounded-lg p-1"},oc=["onClick"],ac={class:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4 mb-6"},sc={class:"bg-gradient-to-br from-purple-50 to-violet-50 rounded-xl p-4 border border-purple-100"},rc={class:"flex items-center gap-2 mb-2"},nc={class:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center"},ic={class:"text-2xl font-bold text-purple-900"},lc={class:"text-xs text-purple-600 mt-1"},dc={class:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-4 border border-green-100"},cc={class:"flex items-center gap-2 mb-2"},uc={class:"w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center"},pc={class:"text-2xl font-bold text-green-900"},mc={class:"text-xs text-green-600 mt-1"},bc={class:"bg-gradient-to-br from-red-50 to-rose-50 rounded-xl p-4 border border-red-100"},gc={class:"flex items-center gap-2 mb-2"},fc={class:"w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center"},vc={class:"text-2xl font-bold text-red-900"},xc={class:"text-xs text-red-600 mt-1"},hc={class:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-4 border border-blue-100"},yc={class:"text-2xl font-bold text-blue-900"},_c={class:"bg-gradient-to-br from-amber-50 to-orange-50 rounded-xl p-4 border border-amber-100"},wc={class:"flex items-center gap-2 mb-2"},$c={class:"w-8 h-8 bg-amber-100 rounded-lg flex items-center justify-center"},kc={class:"text-2xl font-bold text-amber-900"},Cc={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Dc={class:"bg-gray-50 rounded-xl p-4"},Sc={class:"h-48"},Ec={class:"bg-gray-50 rounded-xl p-4"},Pc={class:"h-48"},Fc={class:"mt-6 bg-gradient-to-r from-rose-50 to-red-50 rounded-xl p-4 border border-red-100"},Mc={class:"flex items-start gap-3"},Ac={class:"w-10 h-10 bg-red-100 rounded-xl flex items-center justify-center flex-shrink-0"},Bc={class:"flex-1"},Tc={class:"text-xs text-gray-600 mb-2"},Vc={class:"flex flex-wrap gap-2"},Ic={class:"px-2 py-1 bg-white rounded text-xs font-medium text-red-700"},jc={class:"px-2 py-1 bg-white rounded text-xs font-medium text-amber-700"},zc={class:"space-y-4"},Rc={class:"relative"},qc={class:"flex items-center justify-between border-b border-gray-100"},Nc={class:"flex gap-1 -mb-px",role:"tablist"},Oc=["onClick","aria-selected"],Lc={key:0,class:"absolute bottom-0 left-0 right-0 h-0.5 bg-purple-600 rounded-full"},Uc={key:0,class:"w-5 h-5 flex items-center justify-center text-xs font-semibold bg-purple-600 text-white rounded-full"},Hc={key:0,class:"bg-gray-50 rounded-lg p-4"},Gc={class:"flex flex-wrap items-center gap-3"},Qc=["value"],Zc={class:"flex items-center justify-between mb-4"},Jc={class:"text-sm text-gray-500"},Kc={key:0},Xc={key:1},Yc={key:2,class:"ml-2 text-gray-400"},Wc={class:"flex items-center gap-1 bg-gray-100 rounded-lg p-1"},eu={key:0,class:"flex flex-col items-center justify-center py-20",role:"status"},tu={key:1,class:"flex flex-col items-center justify-center py-20 text-center"},ou={class:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4"},au={class:"text-lg font-medium text-gray-900 mb-1"},su={class:"text-sm text-gray-500 mb-4 max-w-sm"},ru={key:2,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-4",role:"list"},nu=["onClick","aria-label"],iu={key:3,class:"bg-white rounded-xl border border-gray-200 overflow-hidden"},lu={key:4,class:"mt-6 flex items-center justify-center gap-2",role:"navigation","aria-label":"PaginaciÃ³n"},du=["disabled"],cu={class:"flex items-center gap-1"},uu={key:1,class:"px-2 text-gray-400"},pu=["onClick"],mu={key:2,class:"px-2 text-gray-400"},bu=["disabled"],Ku={__name:"pacientes",setup(k){bo.register(go,fo,vo,xo,ho,yo,_o,wo,$o);const z=oo(),m=$t(),{getUserId:O,waitForUser:f}=Ze();wt();const $=qe(),P=j(!1),A=j(!1),H=j(!1),b=j(!1),r=j(!1),x=j(!1),L=j(!1),C=j(null),v=j(null),F=j(null),h=j([]),y=j(!0),c=j(""),w=j(""),l=j("todos"),d=j(""),E=j(!1),q=j({sinProximaCita:!1,sinSesionRegistrada:!1,requiereAtencion:!1,citasEstaSemana:!1,bonosPorVencer:!1,pagoPendiente:!1}),oe=j("cards"),u=j(!1),t=j<"semana"|"mes"|!0,g=[{valor:"semana",label:"Semana"},{valor:"mes",label:"Mes"},{valor:"trimestre",label:"Trimestre"}],U=j(1),I=j(24),ae=j(!1),G=j(null);let K=null;const W=p=>{clearTimeout(K),K=setTimeout(()=>{c.value=p.target.value},300)},se=[{valor:"todos",label:"Todos"},{valor:"activo",label:"Activos"},{valor:"pausa",label:"En pausa"},{valor:"finalizado",label:"Finalizados"}],B=D(()=>({activos:h.value.filter(p=>p.activo&&!p.en_pausa).length,enPausa:h.value.filter(p=>p.activo&&p.en_pausa).length,finalizados:h.value.filter(p=>!p.activo).length})),N=D(()=>se.map(p=>{let n=0;return p.valor==="todos"?n=h.value.length:p.valor==="activo"?n=B.value.activos:p.valor==="pausa"?n=B.value.enPausa:p.valor==="finalizado"&&(n=B.value.finalizados),{...p,count:n}})),R=D(()=>N.value.find(n=>n.valor===l.value)?.count||0),Et=D(()=>{const p=new Set(h.value.map(n=>n.area_de_acompanamiento).filter(Boolean));return Array.from(p).sort()}),Ne=D(()=>d.value!==""||q.value.sinProximaCita||q.value.sinSesionRegistrada||q.value.requiereAtencion||q.value.citasEstaSemana||q.value.bonosPorVencer||q.value.pagoPendiente),it=D(()=>{let p=0;return d.value&&p++,q.value.sinProximaCita&&p++,q.value.sinSesionRegistrada&&p++,q.value.requiereAtencion&&p++,q.value.citasEstaSemana&&p++,q.value.bonosPorVencer&&p++,q.value.pagoPendiente&&p++,p}),Ke=D(()=>Ne.value||c.value||l.value!=="todos"),Fe=p=>{q.value[p]=!q.value[p]},lt=()=>{d.value="",q.value={sinProximaCita:!1,sinSesionRegistrada:!1,requiereAtencion:!1,citasEstaSemana:!1,bonosPorVencer:!1,pagoPendiente:!1}},Pt=()=>{lt(),l.value="todos",c.value="",w.value=""},we=async()=>{y.value=!0;try{const p=O();if(!p){y.value=!1;return}const{data:n,error:X}=await m.from("pacientes").select(`
        id,
        created_at,
        activo,
        email,
        nombre_completo,
        telefono,
        area_de_acompanamiento,
        frecuencia,
        metadata
      `).eq("terapeuta_id",p).order("created_at",{ascending:!1});if(X)throw X;const Q=await Promise.all(n.map(async te=>{const{data:pe}=await m.from("citas").select("fecha_cita").eq("paciente_id",te.id).eq("estado","realizada").order("fecha_cita",{ascending:!1}).limit(1).maybeSingle(),{data:ce}=await m.from("citas").select("id, fecha_cita, hora_inicio").eq("paciente_id",te.id).in("estado",["pendiente","confirmada"]).gte("fecha_cita",new Date().toISOString().split("T")[0]).order("fecha_cita",{ascending:!0}).order("hora_inicio",{ascending:!0}).limit(1).maybeSingle(),{count:me}=await m.from("citas").select("*",{count:"exact",head:!0}).eq("paciente_id",te.id).eq("estado","realizada");let ie=null;try{const{data:$e}=await m.from("bonos").select("id, tipo, estado, sesiones_totales, sesiones_restantes, fecha_fin, created_at").eq("paciente_id",te.id).in("estado",["activo","pendiente"]).order("created_at",{ascending:!1}).limit(1).maybeSingle();ie=$e}catch($e){console.warn("[Bonos] Error:",$e)}let xe=0,be=0;ie&&(be=ie.sesiones_totales,xe=be-ie.sesiones_restantes);const ue=new Date;ue.setDate(ue.getDate()-7);const{data:he}=await m.from("metricas_bienestar").select("estado_animo, nivel_energia, nivel_estres").eq("paciente_id",te.id).gte("fecha",ue.toISOString());let T=3,ye=!1,He=50;if(he&&he.length>0){const $e=he.reduce((Ve,ot)=>Ve+ot.estado_animo,0)/he.length;T=$e,He=Math.round($e/10*100);const Ge=he.slice(-3);Ge.length>=3&&(ye=Ge.every(Ve=>Ve.estado_animo<=4))}const tt=te.nombre_completo||te.metadata?.nombre_completo||te.email;return{id:te.id,nombre:tt,email:te.email,telefono:te.telefono,activo:te.activo,en_pausa:te.metadata?.en_pausa||!1,area_de_acompanamiento:te.area_de_acompanamiento,frecuencia:te.frecuencia,ultima_sesion:pe?.fecha_cita||null,proxima_sesion:ce?`${ce.fecha_cita}T${ce.hora_inicio}`:null,proxima_cita_id:ce?.id||null,total_sesiones:me||0,estado_emocional_promedio:T,evolucion_porcentaje:He,requiere_atencion:ye,created_at:te.created_at,bono_activo:ie?{tipo:ie.tipo,estado:ie.estado,fecha_fin:ie.fecha_fin,sesiones_completadas:xe,sesiones_totales:be,sesiones_restantes:ie.sesiones_restantes}:null}}));h.value=Q}catch(p){console.error("Error al cargar pacientes:",p),$.error("Error al cargar los pacientes")}finally{y.value=!1}},Ft=p=>{if(!p)return!1;const n=new Date(p),X=new Date,Q=new Date(X);Q.setDate(X.getDate()-X.getDay()),Q.setHours(0,0,0,0);const te=new Date(Q);return te.setDate(Q.getDate()+7),n>=Q&&n<te},dt=p=>{if(!p.bono_activo)return!1;const n=p.bono_activo;if(n.sesiones_restantes<=2)return!0;if(n.fecha_fin){const X=new Date(n.fecha_fin);if(Math.floor((X-new Date)/(1e3*60*60*24))<=7)return!0}return!1},Xe=D(()=>{let p=h.value;if(c.value){const n=c.value.toLowerCase();p=p.filter(X=>{const Q=(X.nombre||"").toLowerCase(),te=(X.email||"").toLowerCase(),pe=(X.telefono||"").toLowerCase(),ce=(X.proxima_sesion||"").toLowerCase();return Q.includes(n)||te.includes(n)||pe.includes(n)||ce.includes(n)})}return l.value!=="todos"&&(p=p.filter(n=>l.value==="activo"?n.activo&&!n.en_pausa:l.value==="pausa"?n.activo&&n.en_pausa:l.value==="finalizado"?!n.activo:!0)),d.value&&(p=p.filter(n=>n.area_de_acompanamiento===d.value)),q.value.sinProximaCita&&(p=p.filter(n=>!n.proxima_sesion)),q.value.sinSesionRegistrada&&(p=p.filter(n=>!n.ultima_sesion)),q.value.requiereAtencion&&(p=p.filter(n=>n.requiere_atencion)),q.value.citasEstaSemana&&(p=p.filter(n=>Ft(n.proxima_sesion))),q.value.bonosPorVencer&&(p=p.filter(n=>dt(n))),q.value.pagoPendiente&&(p=p.filter(n=>n.bono_activo?n.bono_activo.estado==="pendiente":!1)),p}),ve=D(()=>Math.ceil(Xe.value.length/I.value)),Oe=D(()=>{const p=(U.value-1)*I.value,n=p+I.value;return Xe.value.slice(p,n)});fe([c,l,d,q],()=>{U.value=1},{deep:!0});const Te=p=>{p>=1&&p<=ve.value&&(U.value=p,window.scrollTo({top:0,behavior:"smooth"}))},Le=D(()=>h.value.length),ct=D(()=>Xe.value.length),Mt=D(()=>{const p=[],n=Math.max(1,U.value-2),X=Math.min(ve.value,U.value+2);for(let Q=n;Q<=X;Q++)p.push(Q);return p}),Ye=p=>{const n=typeof p=="object"?p.id:p;console.log("[Pacientes] Navegando a ficha:",n),z.push(`/terapeuta/pacientes/${n}`)},ut=()=>{P.value=!0},At=()=>{P.value=!1},We=p=>{v.value=p,A.value=!0},Bt=()=>{A.value=!1,v.value=null},Tt=p=>{v.value=p,H.value=!0},Vt=()=>{H.value=!1,v.value=null},It=async()=>{await we(),$.success("Paciente creado")},jt=async()=>{await we(),$.success("Paciente actualizado")},zt=async p=>{h.value=h.value.filter(n=>n.id!==p),$.success("Paciente eliminado")},Rt=async()=>{await we(),$.success("Paciente desactivado")},qt=p=>{F.value=p,b.value=!0},pt=()=>{b.value=!1,F.value=null},Nt=async()=>{await we(),pt(),$.success("Cita asignada")},Ot=p=>{z.push(`/agenda?paciente=${p.id}`)},et=p=>{z.push(`/terapeuta/pacientes/${p.id}/bonos`)},Lt=p=>{G.value=p,ae.value=!0},Ue=()=>{ae.value=!1,G.value=null},Ut=()=>{x.value=!0},Ht=()=>{L.value=!0},Gt=async()=>{await we(),$.success("ImportaciÃ³n completada")},Qt=D(()=>{const p={};return l.value!=="todos"&&(p.estado=l.value),d.value&&(p.area=d.value),p}),Zt=p=>{C.value=p,r.value=!0},mt=()=>{r.value=!1,C.value=null},Jt=async()=>{await we(),mt(),$.success("Cita actualizada")},bt=p=>{const n=new Date,X=new Date(n),Q=new Date(n);return p==="semana"?Q.setDate(n.getDate()-7):p==="mes"?Q.setMonth(n.getMonth()-1):Q.setMonth(n.getMonth()-3),{inicio:Q,fin:X}},de=D(()=>{const{inicio:p,fin:n}=bt(t.value),X=new Date(p);t.value==="semana"?X.setDate(X.getDate()-7):t.value==="mes"?X.setMonth(X.getMonth()-1):X.setMonth(X.getMonth()-3);const Q=h.value,te=Q.length,pe=Q.filter(ee=>ee.activo&&!ee.en_pausa).length,ce=Q.filter(ee=>!ee.activo).length,me=Q.filter(ee=>ee.activo&&ee.en_pausa).length,ie=Q.filter(ee=>{const ge=new Date(ee.created_at);return ge>=p&&ge<=n}).length,xe=Q.filter(ee=>{const ge=new Date(ee.created_at);return ge>=X&&ge<p}).length,be=xe>0?Math.round((ie-xe)/xe*100):ie>0?100:0,ue=new Date;ue.setDate(ue.getDate()-30);const he=Q.filter(ee=>{if(ee.activo)return!1;if(ee.ultima_sesion){const ge=new Date(ee.ultima_sesion);return ge>=p&&ge<=n}return!1}).length,T=pe+he,ye=T>0?Math.round(he/T*100):0,He=100-ye,tt=Q.reduce((ee,ge)=>ee+(ge.total_sesiones||0),0),$e=pe>0?(tt/pe).toFixed(1):"0",Ge=Q.filter(ee=>{if(!ee.activo||ee.en_pausa)return!1;const ge=!ee.proxima_sesion,Yt=!ee.ultima_sesion||new Date(ee.ultima_sesion)<ue;return ge&&Yt}).length,Ve=Q.filter(ee=>ee.activo&&!ee.en_pausa&&!ee.proxima_sesion).length,ot=Q.filter(ee=>dt(ee)).length;return{total:te,activos:pe,finalizados:ce,enPausa:me,nuevos:ie,tendenciaNuevos:be,churn:ye,retencion:He,promedioSesiones:$e,pacientesEnRiesgo:Ge,sinCitaProxima:Ve,bonosPorVencer:ot}}),gt=D(()=>{const{inicio:p}=bt(t.value),n=[],X=[],Q=[],te=t.value==="semana"?7:t.value==="mes"?4:12,pe=t.value==="semana"?1:(t.value==="mes",7);for(let ce=0;ce<te;ce++){const me=new Date(p);me.setDate(me.getDate()+ce*pe),t.value==="semana"?n.push(me.toLocaleDateString("es-ES",{weekday:"short"})):n.push(me.toLocaleDateString("es-ES",{day:"2-digit",month:"short"}));const ie=h.value.filter(be=>{const ue=new Date(be.created_at);return ue<=me&&ue>=p}).length,xe=h.value.filter(be=>new Date(be.created_at)<=me&&be.activo).length;X.push(ie),Q.push(xe)}return{labels:n,datasets:[{label:"Nuevos",data:X,borderColor:"#10B981",backgroundColor:"rgba(16, 185, 129, 0.1)",fill:!0,tension:.4},{label:"Activos",data:Q,borderColor:"#8B5CF6",backgroundColor:"rgba(139, 92, 246, 0.1)",fill:!0,tension:.4}]}}),Kt={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{boxWidth:12,padding:15}}},scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}}},ft=D(()=>{const{activos:p,enPausa:n,finalizados:X}=de.value;return{labels:["Activos","En Pausa","Finalizados"],datasets:[{data:[p,n,X],backgroundColor:["#8B5CF6","#F59E0B","#6B7280"],borderWidth:0}]}}),Xt={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{boxWidth:12,padding:15}}},cutout:"60%"};return ao(async()=>{try{await f(),O()?await we():y.value=!1}catch(p){console.error("Error en onMounted:",p),y.value=!1}}),fe(()=>O(),p=>{p&&h.value.length===0&&we()}),(p,n)=>{const X=da,Q=Ia,te=lo,pe=Ps,ce=kr,me=zr,ie=fn,xe=wn,be=Xl,ue=xd,he=Gd;return a(),s("div",null,[e("header",Qd,[e("div",Zd,[e("div",null,[e("h1",Jd,[n[22]||(n[22]=V(" Pacientes ",-1)),e("span",Kd,"("+i(o(R))+")",1)])]),e("div",Xd,[e("button",{onClick:n[0]||(n[0]=T=>u.value=!o(u)),class:M(["min-h-[40px] px-3 py-2 text-sm font-medium rounded-lg transition-all flex items-center gap-2 border",o(u)?"bg-indigo-600 text-white border-indigo-600 shadow-md":"bg-white text-indigo-700 border-indigo-200 hover:bg-indigo-50"]),title:"Ver resumen y estadÃ­sticas"},[_(o(xt),{class:"w-4 h-4"}),n[23]||(n[23]=e("span",{class:"hidden sm:inline"},"Resumen",-1))],2),e("button",{onClick:Ut,class:"min-h-[40px] px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors flex items-center gap-1.5 text-sm font-medium","aria-label":"Importar pacientes"},[_(o(rt),{class:"w-4 h-4","aria-hidden":"true"}),n[24]||(n[24]=e("span",{class:"hidden sm:inline"},"Importar",-1))]),e("button",{onClick:Ht,class:"min-h-[40px] px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors flex items-center gap-1.5 text-sm font-medium","aria-label":"Exportar pacientes"},[_(o(st),{class:"w-4 h-4","aria-hidden":"true"}),n[25]||(n[25]=e("span",{class:"hidden sm:inline"},"Exportar",-1))]),e("button",{onClick:ut,class:"min-h-[40px] px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center gap-2 text-sm font-medium shadow-sm","aria-label":"AÃ±adir nuevo paciente"},[_(o(ht),{class:"w-4 h-4","aria-hidden":"true"}),n[26]||(n[26]=e("span",null,"Nuevo",-1))])])]),_(Ee,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 max-h-0","enter-to-class":"opacity-100 max-h-[800px]","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 max-h-[800px]","leave-to-class":"opacity-0 max-h-0"},{default:Ce(()=>[o(u)?(a(),s("div",Yd,[e("div",Wd,[e("h3",ec,[_(o(xt),{class:"w-5 h-5 text-indigo-500"}),n[27]||(n[27]=V(" EstadÃ­sticas de Pacientes ",-1))]),e("div",tc,[(a(),s(J,null,Y(g,T=>e("button",{key:T.valor,onClick:ye=>t=T.valor,class:M(["px-3 py-1.5 text-sm font-medium rounded-md transition-all",t===T.valor?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"])},i(T.label),11,oc)),64))])]),e("div",ac,[e("div",sc,[e("div",rc,[e("div",nc,[_(o(yt),{class:"w-4 h-4 text-purple-600"})]),n[28]||(n[28]=e("span",{class:"text-xs font-medium text-purple-600 uppercase"},"Total",-1))]),e("p",ic,i(o(de).total),1),e("p",lc,i(o(de).activos)+" activos",1)]),e("div",dc,[e("div",cc,[e("div",uc,[_(o(ht),{class:"w-4 h-4 text-green-600"})]),n[29]||(n[29]=e("span",{class:"text-xs font-medium text-green-600 uppercase"},"Nuevos",-1))]),e("p",pc,i(o(de).nuevos),1),e("p",mc,[e("span",{class:M(o(de).tendenciaNuevos>=0?"text-green-600":"text-red-600")},i(o(de).tendenciaNuevos>=0?"+":"")+i(o(de).tendenciaNuevos)+"% ",3),n[30]||(n[30]=V(" vs perÃ­odo ant. ",-1))])]),e("div",bc,[e("div",gc,[e("div",fc,[_(o(st),{class:"w-4 h-4 text-red-600 rotate-90"})]),n[31]||(n[31]=e("span",{class:"text-xs font-medium text-red-600 uppercase"},"Churn",-1))]),e("p",vc,i(o(de).churn)+"%",1),e("p",xc,i(o(de).finalizados)+" finalizados",1)]),e("div",hc,[n[32]||(n[32]=e("div",{class:"flex items-center gap-2 mb-2"},[e("div",{class:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})])]),e("span",{class:"text-xs font-medium text-blue-600 uppercase"},"RetenciÃ³n")],-1)),e("p",yc,i(o(de).retencion)+"%",1),n[33]||(n[33]=e("p",{class:"text-xs text-blue-600 mt-1"},"Pacientes que continÃºan",-1))]),e("div",_c,[e("div",wc,[e("div",$c,[_(o(_t),{class:"w-4 h-4 text-amber-600"})]),n[34]||(n[34]=e("span",{class:"text-xs font-medium text-amber-600 uppercase"},"Prom. Sesiones",-1))]),e("p",kc,i(o(de).promedioSesiones),1),n[35]||(n[35]=e("p",{class:"text-xs text-amber-600 mt-1"},"Por paciente",-1))])]),e("div",Cc,[e("div",Dc,[n[36]||(n[36]=e("h4",{class:"text-sm font-semibold text-gray-700 mb-3"},"EvoluciÃ³n de Pacientes",-1)),e("div",Sc,[o(gt)?(a(),le(o(po),{key:0,data:o(gt),options:Kt},null,8,["data"])):S("",!0)])]),e("div",Ec,[n[37]||(n[37]=e("h4",{class:"text-sm font-semibold text-gray-700 mb-3"},"DistribuciÃ³n por Estado",-1)),e("div",Pc,[o(ft)?(a(),le(o(mo),{key:0,data:o(ft),options:Xt},null,8,["data"])):S("",!0)])])]),e("div",Fc,[e("div",Mc,[e("div",Ac,[_(o(De),{class:"w-5 h-5 text-red-600"})]),e("div",Bc,[n[38]||(n[38]=e("h4",{class:"text-sm font-semibold text-gray-800 mb-1"},"AnÃ¡lisis de Churn",-1)),e("p",Tc,i(o(de).pacientesEnRiesgo)+" pacientes no han tenido sesiÃ³n en los Ãºltimos 30 dÃ­as y podrÃ­an estar en riesgo de abandono. ",1),e("div",Vc,[e("span",Ic,i(o(de).sinCitaProxima)+" sin cita programada ",1),e("span",jc,i(o(de).bonosPorVencer)+" con bono por vencer ",1)])])])])])):S("",!0)]),_:1}),e("div",zc,[e("div",Rc,[Z(e("input",{"onUpdate:modelValue":n[1]||(n[1]=T=>_e(w)?w.value=T:null),onInput:W,type:"text",placeholder:"Buscar por nombre, email o telÃ©fono...",class:"w-full h-11 px-4 pl-10 bg-white border border-gray-200 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition-all text-sm placeholder-gray-400","aria-label":"Buscar pacientes"},null,544),[[ne,o(w)]]),_(o(ko),{class:"w-4 h-4 absolute left-3.5 top-1/2 -translate-y-1/2 text-gray-400","aria-hidden":"true"}),o(c)?(a(),s("button",{key:0,onClick:n[2]||(n[2]=T=>{c.value="",w.value=""}),class:"absolute right-3 top-1/2 -translate-y-1/2 p-1 text-gray-400 hover:text-gray-600 rounded","aria-label":"Limpiar bÃºsqueda"},[_(o(Be),{class:"w-4 h-4"})])):S("",!0)]),e("div",qc,[e("nav",Nc,[(a(!0),s(J,null,Y(o(N),T=>(a(),s("button",{key:T.valor,onClick:ye=>l.value=T.valor,class:M(["px-4 py-2.5 text-sm font-medium transition-colors relative",o(l)===T.valor?"text-purple-600":"text-gray-500 hover:text-gray-700"]),"aria-selected":o(l)===T.valor,role:"tab"},[e("span",null,i(T.label),1),e("span",{class:M(["ml-1.5 text-xs",o(l)===T.valor?"text-purple-500":"text-gray-400"])},i(T.count),3),o(l)===T.valor?(a(),s("span",Lc)):S("",!0)],10,Oc))),128))]),e("button",{onClick:n[3]||(n[3]=T=>E.value=!o(E)),class:M(["flex items-center gap-1.5 px-3 py-2 text-sm font-medium rounded-lg transition-colors",o(Ne)?"text-purple-600 bg-purple-50":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"])},[_(o(Co),{class:"w-4 h-4"}),n[39]||(n[39]=e("span",{class:"hidden sm:inline"},"Filtros",-1)),o(it)>0?(a(),s("span",Uc,i(o(it)),1)):S("",!0),_(o(Do),{class:M(["w-4 h-4 transition-transform",{"rotate-180":o(E)}])},null,8,["class"])],2)]),_(Ee,{"enter-active-class":"transition-all duration-200 ease-out","enter-from-class":"opacity-0 -translate-y-2","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition-all duration-150 ease-in","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 -translate-y-2"},{default:Ce(()=>[o(E)?(a(),s("div",Hc,[e("div",Gc,[Z(e("select",{"onUpdate:modelValue":n[4]||(n[4]=T=>_e(d)?d.value=T:null),class:"h-9 px-3 bg-white border border-gray-200 rounded-lg text-sm text-gray-700 focus:border-purple-500 focus:ring-1 focus:ring-purple-500/20","aria-label":"Filtrar por Ã¡rea"},[n[40]||(n[40]=e("option",{value:""},"Todas las Ã¡reas",-1)),(a(!0),s(J,null,Y(o(Et),T=>(a(),s("option",{key:T,value:T},i(T),9,Qc))),128))],512),[[Ie,o(d)]]),e("button",{onClick:n[5]||(n[5]=T=>Fe("sinProximaCita")),class:M(["h-9 px-3 rounded-lg text-sm font-medium transition-all flex items-center gap-1.5",o(q).sinProximaCita?"bg-orange-100 text-orange-700 border border-orange-200":"bg-white text-gray-600 border border-gray-200 hover:border-gray-300"])},[_(o(Qe),{class:"w-4 h-4"}),n[41]||(n[41]=V(" Sin prÃ³xima cita ",-1))],2),e("button",{onClick:n[6]||(n[6]=T=>Fe("sinSesionRegistrada")),class:M(["h-9 px-3 rounded-lg text-sm font-medium transition-all flex items-center gap-1.5",o(q).sinSesionRegistrada?"bg-amber-100 text-amber-700 border border-amber-200":"bg-white text-gray-600 border border-gray-200 hover:border-gray-300"])},[_(o(_t),{class:"w-4 h-4"}),n[42]||(n[42]=V(" Sin sesiÃ³n ",-1))],2),e("button",{onClick:n[7]||(n[7]=T=>Fe("requiereAtencion")),class:M(["h-9 px-3 rounded-lg text-sm font-medium transition-all flex items-center gap-1.5",o(q).requiereAtencion?"bg-red-100 text-red-700 border border-red-200":"bg-white text-gray-600 border border-gray-200 hover:border-gray-300"])},[_(o(De),{class:"w-4 h-4"}),n[43]||(n[43]=V(" Requiere atenciÃ³n ",-1))],2),e("button",{onClick:n[8]||(n[8]=T=>Fe("citasEstaSemana")),class:M(["h-9 px-3 rounded-lg text-sm font-medium transition-all flex items-center gap-1.5",o(q).citasEstaSemana?"bg-purple-100 text-purple-700 border border-purple-200":"bg-white text-gray-600 border border-gray-200 hover:border-gray-300"])},[_(o(Qe),{class:"w-4 h-4"}),n[44]||(n[44]=V(" Citas esta semana ",-1))],2),e("button",{onClick:n[9]||(n[9]=T=>Fe("bonosPorVencer")),class:M(["h-9 px-3 rounded-lg text-sm font-medium transition-all flex items-center gap-1.5",o(q).bonosPorVencer?"bg-amber-100 text-amber-700 border border-amber-200":"bg-white text-gray-600 border border-gray-200 hover:border-gray-300"])},[_(o(je),{class:"w-4 h-4"}),n[45]||(n[45]=V(" Bonos por vencer ",-1))],2),e("button",{onClick:n[10]||(n[10]=T=>Fe("pagoPendiente")),class:M(["h-9 px-3 rounded-lg text-sm font-medium transition-all flex items-center gap-1.5",o(q).pagoPendiente?"bg-green-100 text-green-700 border border-green-200":"bg-white text-gray-600 border border-gray-200 hover:border-gray-300"])},[_(o(So),{class:"w-4 h-4"}),n[46]||(n[46]=V(" Pago pendiente ",-1))],2),o(Ne)?(a(),s("button",{key:0,onClick:lt,class:"h-9 px-3 text-sm text-gray-500 hover:text-gray-700 transition-colors"}," Limpiar ")):S("",!0)])])):S("",!0)]),_:1})])]),e("div",Zc,[e("p",Jc,[o(ct)===o(Le)?(a(),s("span",Kc,i(o(Le))+" pacientes",1)):(a(),s("span",Xc,i(o(ct))+" de "+i(o(Le))+" pacientes",1)),o(ve)>1?(a(),s("span",Yc," (pÃ¡gina "+i(o(U))+" de "+i(o(ve))+") ",1)):S("",!0)]),e("div",Wc,[e("button",{onClick:n[11]||(n[11]=T=>oe.value="cards"),class:M(["p-1.5 rounded transition-colors",o(oe)==="cards"?"bg-white shadow-sm text-purple-600":"text-gray-500 hover:text-gray-700"]),title:"Vista de tarjetas"},[_(o(To),{class:"w-4 h-4"})],2),e("button",{onClick:n[12]||(n[12]=T=>oe.value="tabla"),class:M(["p-1.5 rounded transition-colors",o(oe)==="tabla"?"bg-white shadow-sm text-purple-600":"text-gray-500 hover:text-gray-700"]),title:"Vista de tabla"},[_(o(Vo),{class:"w-4 h-4"})],2)])]),e("section",null,[o(y)?(a(),s("div",eu,[...n[47]||(n[47]=[e("div",{class:"w-8 h-8 border-2 border-purple-600 border-t-transparent rounded-full animate-spin mb-4"},null,-1),e("p",{class:"text-sm text-gray-500"},"Cargando pacientes...",-1)])])):o(Oe).length===0?(a(),s("div",tu,[e("div",ou,[_(o(yt),{class:"w-8 h-8 text-gray-400"})]),e("h3",au,i(o(Ke)?"Sin resultados":"Sin pacientes"),1),e("p",su,i(o(Ke)?"Prueba ajustando los filtros de bÃºsqueda":"Comienza aÃ±adiendo tu primer paciente"),1),o(Ke)?(a(),s("button",{key:1,onClick:Pt,class:"px-4 py-2 text-gray-600 text-sm font-medium hover:text-gray-900 transition-colors"}," Limpiar filtros ")):(a(),s("button",{key:0,onClick:ut,class:"px-4 py-2 bg-purple-600 text-white text-sm font-medium rounded-lg hover:bg-purple-700 transition-colors"}," AÃ±adir paciente "))])):o(oe)==="cards"?(a(),s("div",ru,[(a(!0),s(J,null,Y(o(Oe),T=>(a(),s("div",{key:T.id,class:"relative group",role:"listitem"},[_(X,{paciente:T,onVerFicha:Ye,onEditar:We,onEliminar:Tt,onVerCitas:Ot,onGestionarBonos:et,onEditarCita:Zt},null,8,["paciente"]),T.activo&&!T.en_pausa?(a(),s("button",{key:0,onClick:re(ye=>qt(T),["stop"]),class:"absolute bottom-4 right-4 min-h-[44px] min-w-[44px] h-11 px-4 bg-purple-600 text-white text-sm font-medium rounded-lg shadow-md hover:bg-purple-700 active:bg-purple-800 transition-all flex items-center justify-center gap-2 opacity-0 group-hover:opacity-100 pointer-events-none group-hover:pointer-events-auto z-10","aria-label":`Asignar cita a ${T.nombre}`},[_(o(Qe),{class:"w-5 h-5"}),n[48]||(n[48]=e("span",{class:"hidden sm:inline"},"Cita",-1))],8,nu)):S("",!0)]))),128))])):o(oe)==="tabla"?(a(),s("div",iu,[_(Q,{pacientes:o(Oe),onVerFicha:Ye,onEditar:We,onGestionarBonos:et,onVerPreview:Lt},null,8,["pacientes"])])):S("",!0),o(ve)>1?(a(),s("nav",lu,[e("button",{onClick:n[13]||(n[13]=T=>Te(o(U)-1)),disabled:o(U)===1,class:"min-h-[44px] min-w-[44px] p-2 rounded-lg border border-gray-200 text-gray-600 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center","aria-label":"PÃ¡gina anterior"},[_(o(Fo),{class:"w-5 h-5"})],8,du),e("div",cu,[o(U)>3?(a(),s("button",{key:0,onClick:n[14]||(n[14]=T=>Te(1)),class:"min-h-[44px] min-w-[44px] px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-50 transition-colors"}," 1 ")):S("",!0),o(U)>4?(a(),s("span",uu,"...")):S("",!0),(a(!0),s(J,null,Y(o(Mt),T=>(a(),s("button",{key:T,onClick:ye=>Te(T),class:M(["min-h-[44px] min-w-[44px] px-3 py-2 rounded-lg text-sm font-medium transition-colors",T===o(U)?"bg-purple-600 text-white":"text-gray-600 hover:bg-gray-50"])},i(T),11,pu))),128)),o(U)<o(ve)-3?(a(),s("span",mu,"...")):S("",!0),o(U)<o(ve)-2?(a(),s("button",{key:3,onClick:n[15]||(n[15]=T=>Te(o(ve))),class:"min-h-[44px] min-w-[44px] px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-50 transition-colors"},i(o(ve)),1)):S("",!0)]),e("button",{onClick:n[16]||(n[16]=T=>Te(o(U)+1)),disabled:o(U)===o(ve),class:"min-h-[44px] min-w-[44px] p-2 rounded-lg border border-gray-200 text-gray-600 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center","aria-label":"PÃ¡gina siguiente"},[_(o(Eo),{class:"w-5 h-5"})],8,bu)])):S("",!0)]),_(te,{mostrar:o(b),"paciente-preseleccionado":o(F),onCerrar:pt,onCitaCreada:Nt},null,8,["mostrar","paciente-preseleccionado"]),_(pe,{mostrar:o(P),onCerrar:At,onPacienteCreado:It},null,8,["mostrar"]),_(ce,{mostrar:o(A),paciente:o(v),onCerrar:Bt,onPacienteActualizado:jt},null,8,["mostrar","paciente"]),_(me,{mostrar:o(H),paciente:o(v),onCerrar:Vt,onPacienteEliminado:zt,onPacienteDesactivado:Rt},null,8,["mostrar","paciente"]),_(ie,{isOpen:o(r),citaId:o(C),onClose:mt,onActualizado:Jt},null,8,["isOpen","citaId"]),_(xe),_(be,{modelValue:o(x),"onUpdate:modelValue":n[17]||(n[17]=T=>_e(x)?x.value=T:null),"existing-patients":o(h),onImportComplete:Gt},null,8,["modelValue","existing-patients"]),_(ue,{modelValue:o(L),"onUpdate:modelValue":n[18]||(n[18]=T=>_e(L)?L.value=T:null),"total-patients":o(Le),"filtered-count":o(Oe).length,"has-filters":o(Ne)||o(l)!=="todos"||o(c)!=="","current-filters":o(Qt)},null,8,["modelValue","total-patients","filtered-count","has-filters","current-filters"]),_(he,{mostrar:o(ae),paciente:o(G),onCerrar:Ue,onVerFicha:n[19]||(n[19]=T=>{Ue(),Ye(T)}),onEditar:n[20]||(n[20]=T=>{Ue(),We(T)}),onGestionarBonos:n[21]||(n[21]=T=>{Ue(),et(T)})},null,8,["mostrar","paciente"])])}}};export{Ku as default};
