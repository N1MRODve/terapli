import{ah as d,M as c,m as p,n as e,ai as f}from"#entry";const w=d(async(i,g)=>{let r,s;if(!i.path.startsWith("/terapeuta")||i.path==="/terapeuta/login")return;const a=c(),u=p();if(!a.value)return console.log("[Middleware] Usuario no autenticado, redirigiendo a login"),e("/terapeuta/login",{replace:!0});try{const o=a.value?.id||a.value?.sub;if(!o)return console.error("[Middleware] No se pudo obtener el ID del usuario:",a.value),e("/terapeuta/login",{replace:!0});const{data:l,error:n}=([r,s]=f(()=>u.from("profiles").select("rol, nombre").eq("id",o).single()),r=await r,s(),r);if(n)return console.error("[Middleware] Error al obtener perfil:",n),e("/terapeuta/login",{replace:!0});const t=l?.rol;if(!t||!["terapeuta","psicologa","admin","coordinadora"].includes(t))return console.log(`[Middleware] Usuario con rol '${t}' sin acceso, redirigiendo a home`),e("/",{replace:!0});console.log(`[Middleware] Acceso autorizado para: ${l?.nombre||"profesional"} (${t})`)}catch(o){return console.error("[Middleware] Error inesperado:",o),e("/terapeuta/login",{replace:!0})}});export{w as default};
